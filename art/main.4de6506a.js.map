{"version":3,"sources":["core/main.js","core/utils/deprecation.ts","core/touch.ts","core/browser_events.ts","core/common.ts","core/utils/dom.ts","core/utils/math.ts","core/utils/style.ts","core/dropdowndiv.ts","core/registry.ts","core/utils/idgenerator.ts","core/events/utils.ts","core/utils/xml.ts","core/dialog.ts","core/variables.ts","core/css.ts","core/utils/svg_math.ts","core/xml.ts","core/utils/string.ts","core/tooltip.ts","core/utils/colour.ts","core/utils/parsing.ts","core/widgetdiv.ts","core/field_registry.ts","core/utils/aria.ts","core/field_dropdown.ts","core/utils/object.ts","core/utils/toolbox.ts","core/extensions.ts","core/utils/array.ts","core/utils/svg_paths.ts","core/utils.ts","core/serialization/registry.ts","core/serialization/blocks.ts","core/connection.ts","core/keyboard_nav/ast_node.ts","core/block_animations.ts","core/clipboard.ts","core/contextmenu.ts","core/positionable_helpers.ts","core/shortcut_items.ts","core/interfaces/i_observable.ts","core/interfaces/i_procedure_block.ts","core/procedures/update_procedures.ts","core/procedures.ts","core/renderers/common/constants.ts","core/renderers/common/debug.ts","core/renderers/common/block_rendering.ts","core/variables_dynamic.ts","core/workspace_svg.ts","core/serialization/procedures.ts","core/bump_objects.ts","core/inject.ts","core/events/events_procedure_parameter_rename.ts","core/contextmenu_items.ts","core/blockly.ts","src/com/google/javascript/jscomp/js/base.js","src/com/google/javascript/jscomp/js/util/defines.js","src/com/google/javascript/jscomp/js/util/defineproperty.js","src/com/google/javascript/jscomp/js/util/global.js","src/com/google/javascript/jscomp/js/util/shouldpolyfill.js","src/com/google/javascript/jscomp/js/util/polyfill.js","src/com/google/javascript/jscomp/js/es6/globalthis.js","src/com/google/javascript/jscomp/js/es6/object/getownpropertydescriptors.js","src/com/google/javascript/jscomp/js/es6/util/arrayiterator.js","src/com/google/javascript/jscomp/js/es6/symbol.js","src/com/google/javascript/jscomp/js/es6/util/iteratorfromarray.js","src/com/google/javascript/jscomp/js/es6/array/values.js","src/com/google/javascript/jscomp/js/util/owns.js","src/com/google/javascript/jscomp/js/es6/object/values.js","src/com/google/javascript/jscomp/js/es6/array/flat.js","src/com/google/javascript/jscomp/js/es6/object/entries.js","closure/goog/goog.js","closure/goog/base_minimal.js","core/utils/useragent.ts","core/blocks.ts","core/utils/rect.ts","core/utils/coordinate.ts","core/utils/size.ts","core/input_types.ts","core/msg.ts","core/events/events_abstract.ts","core/events/events_var_base.ts","core/events/events_var_create.ts","core/variable_model.ts","core/workspace_comment.ts","core/events/events_ui_base.ts","core/events/events_selected.ts","core/utils/svg.ts","core/workspace_comment_svg.ts","core/events/events_block_base.ts","core/events/events_block_change.ts","core/marker_manager.ts","core/utils/sentinel.ts","core/field.ts","core/utils/keycodes.ts","core/menu.ts","core/menuitem.ts","core/events/events_bubble_open.ts","core/scrollbar.ts","core/bubble.ts","core/config.ts","core/icon.ts","core/theme.ts","core/theme/classic.ts","core/options.ts","core/mutator.ts","core/events/events_trashcan_open.ts","core/component_manager.ts","core/serialization/exceptions.ts","core/serialization/priorities.ts","core/events/events_block_create.ts","core/events/events_block_delete.ts","core/connection_type.ts","core/constants.ts","core/field_label.ts","core/input.ts","core/block.ts","core/comment.ts","core/contextmenu_registry.ts","core/internal_constants.ts","core/keyboard_nav/marker.ts","core/keyboard_nav/cursor.ts","core/keyboard_nav/basic_cursor.ts","core/keyboard_nav/tab_navigate_cursor.ts","core/rendered_connection.ts","core/warning.ts","core/block_svg.ts","core/drag_target.ts","core/delete_area.ts","core/sprites.ts","core/trashcan.ts","core/events/events_toolbox_item_select.ts","core/toolbox/toolbox_item.ts","core/toolbox/category.ts","core/toolbox/separator.ts","core/toolbox/collapsible_category.ts","core/toolbox/toolbox.ts","core/theme/zelos.ts","core/theme/themes.ts","core/events/events_click.ts","core/bubble_dragger.ts","core/workspace_dragger.ts","core/gesture.ts","core/shortcut_registry.ts","core/events/events_theme_change.ts","core/events/events_viewport.ts","core/connection_db.ts","core/grid.ts","core/names.ts","core/procedures/observable_procedure_map.ts","core/procedures/observable_procedure_model.ts","core/procedures/observable_parameter_model.ts","core/renderers/measurables/types.ts","core/renderers/measurables/base.ts","core/renderers/measurables/row.ts","core/renderers/measurables/bottom_row.ts","core/renderers/measurables/connection.ts","core/renderers/measurables/input_connection.ts","core/renderers/measurables/external_value_input.ts","core/renderers/measurables/field.ts","core/renderers/measurables/hat.ts","core/renderers/measurables/icon.ts","core/renderers/measurables/in_row_spacer.ts","core/renderers/measurables/inline_input.ts","core/renderers/measurables/statement_input.ts","core/renderers/measurables/input_row.ts","core/renderers/measurables/jagged_edge.ts","core/renderers/measurables/next_connection.ts","core/renderers/measurables/output_connection.ts","core/renderers/measurables/previous_connection.ts","core/renderers/measurables/round_corner.ts","core/renderers/measurables/spacer_row.ts","core/renderers/measurables/square_corner.ts","core/renderers/measurables/top_row.ts","core/renderers/common/debugger.ts","core/renderers/common/drawer.ts","core/renderers/common/info.ts","core/events/events_marker_move.ts","core/renderers/common/marker_svg.ts","core/renderers/common/path_object.ts","core/insertion_marker_manager.ts","core/renderers/common/renderer.ts","core/theme_manager.ts","core/connection_checker.ts","core/events/events_var_delete.ts","core/events/events_var_rename.ts","core/variable_map.ts","core/workspace.ts","core/workspace_audio.ts","core/zoom_controls.ts","core/serialization/workspaces.ts","core/serialization/variables.ts","core/serialization.ts","core/renderers/zelos/constants.ts","core/renderers/zelos/drawer.ts","core/field_image.ts","core/field_input.ts","core/field_textinput.ts","core/renderers/zelos/measurables/bottom_row.ts","core/renderers/zelos/measurables/inputs.ts","core/renderers/zelos/measurables/row_elements.ts","core/renderers/zelos/measurables/top_row.ts","core/renderers/zelos/info.ts","core/renderers/zelos/marker_svg.ts","core/renderers/zelos/path_object.ts","core/renderers/zelos/renderer.ts","core/renderers/zelos/zelos.ts","core/renderers/thrasos/info.ts","core/renderers/thrasos/renderer.ts","core/renderers/thrasos/thrasos.ts","core/renderers/minimalist/constants.ts","core/renderers/minimalist/drawer.ts","core/renderers/minimalist/info.ts","core/renderers/minimalist/renderer.ts","core/renderers/minimalist/minimalist.ts","core/renderers/geras/constants.ts","core/renderers/geras/highlighter.ts","core/renderers/geras/drawer.ts","core/renderers/geras/highlight_constants.ts","core/renderers/geras/measurables/inline_input.ts","core/renderers/geras/measurables/statement_input.ts","core/renderers/geras/info.ts","core/renderers/geras/path_object.ts","core/renderers/geras/renderer.ts","core/renderers/geras/geras.ts","core/workspace_drag_surface_svg.ts","core/block_drag_surface.ts","core/scrollbar_pair.ts","core/generator.ts","core/flyout_button.ts","core/metrics_manager.ts","core/flyout_base.ts","core/flyout_metrics_manager.ts","core/flyout_vertical.ts","core/flyout_horizontal.ts","core/field_variable.ts","core/field_number.ts","core/field_multilineinput.ts","core/field_label_serializable.ts","core/field_colour.ts","core/field_checkbox.ts","core/field_angle.ts","core/events/events_block_move.ts","core/events/events_comment_base.ts","core/events/events_comment_change.ts","core/events/events_comment_create.ts","core/events/events_comment_delete.ts","core/events/events_comment_move.ts","core/events/events_procedure_base.ts","core/events/events_procedure_change_return.ts","core/events/events_procedure_create.ts","core/events/events_procedure_delete.ts","core/events/events_procedure_enable.ts","core/events/events_procedure_rename.ts","core/events/events_procedure_parameter_base.ts","core/events/events_procedure_parameter_create.ts","core/events/events_procedure_parameter_delete.ts","core/events/events_block_drag.ts","core/events/events_ui.ts","core/events/workspace_events.ts","core/events/events.ts","core/block_dragger.ts","../node_modules/blockly/blockly.js","../node_modules/blockly/core-browser.js","../node_modules/blockly/msg/en.js","blocks/blocks.js","blocks/variables_dynamic.js","blocks/variables.js","blocks/text.js","blocks/procedures.js","blocks/math.js","blocks/loops.js","blocks/logic.js","blocks/lists.js","blocks/colour.js","../node_modules/blockly/blocks.js","generators/javascript/all.js","generators/javascript.js","generators/javascript/variables.js","generators/javascript/variables_dynamic.js","generators/javascript/text.js","generators/javascript/procedures.js","generators/javascript/math.js","generators/javascript/loops.js","generators/javascript/logic.js","generators/javascript/lists.js","generators/javascript/colour.js","../node_modules/blockly/javascript.js","../node_modules/blockly/browser.js","../node_modules/blockly/index.js","blockly_controller.js","main.js"],"names":["warn","name","deprecationDate","deletionDate","opt_use","msg","longStart","e","gesture","longStop","setTimeout","handleRightClick","LONGPRESS","longPid_","clearTimeout","clearTouchIdentifier","touchIdentifier_","shouldHandleEvent","type","startsWith","checkTouchIdentifier","getTouchIdentifierFromEvent","pointerId","identifier","conditionalBind","node","thisObject","func","opt_noCaptureIdentifier","opt_noPreventDefault","wrapFunc","call","undefined","bindData","i","TOUCH_MAP","length","addEventListener","push","bind","unbind","callback","bindDatum","pop","removeEventListener","isTargetInput","target","isContentEditable","getAttribute","isRightButton","ctrlKey","MAC","button","mouseToSvg","svg","matrix","svgPoint","createSVGPoint","x","clientX","y","clientY","getScreenCTM","inverse","matrixTransform","getScrollDeltaPixels","deltaMode","deltaX","deltaY","LINE_MODE_MULTIPLIER","PAGE_MODE_MULTIPLIER","getWorkspaceById","id","getAllWorkspaces","workspaces","workspaceId","WorkspaceDB_","registerWorkspace","workspace","unregisterWorkpace","getMainWorkspace","setMainWorkspace","mainWorkspace","getSelected","setSelected","newSelection","selected","getParentContainer","setParentContainer","newParent","parentContainer","svgResize","options","parentWorkspace","getParentSvg","cachedSize","getCachedParentSvgSize","div","parentElement","width","offsetWidth","height","offsetHeight","setAttribute","setCachedParentSvgSize","resize","getBlockTypeCounts","block","opt_stripFollowing","typeCountsMap","Object","create","descendants","getDescendants","nextBlock","getNextBlock","index","indexOf","splice","checkBlock","jsonInitFactory","jsonDef","jsonInit","defineBlocksWithJsonArray","jsonArray","TEST_ONLY","defineBlocksWithJsonArrayInternal","createBlockDefinitionsFromJsonArray","blocks","elem","console","init","defineBlocks","keys","definition","createSvgElement","attrs","opt_parent","document","createElementNS","SVG_NS","String","key","appendChild","addClass","element","className","classNames","split","every","classList","contains","add","removeClasses","remove","removeClass","removeNode","parentNode","removeChild","insertAfter","newNode","refNode","siblingNode","nextSibling","insertBefore","containsNode","parent","descendant","compareDocumentPosition","NodeType","DOCUMENT_POSITION_CONTAINED_BY","setCssTransform","transform","style","startTextWidthCache","cacheReference","cacheWidths","stopTextWidthCache","getFastTextWidth","textElement","fontSize","fontWeight","fontFamily","getFastTextWidthWithSizeString","text","textContent","baseVal","canvasContext","computeCanvas","createElement","body","getContext","font","measureText","measureFontMetrics","span","result","baseline","alignItems","offsetTop","toRadians","angleDegrees","Math","PI","toDegrees","angleRadians","clamp","lowerBound","number","upperBound","temp","max","min","getSize","getSizeInternal","getSizeWithDisplay","Size","getComputedStyle","property","styles","window","getPropertyValue","getPageOffset","el","pos","Coordinate","box","getBoundingClientRect","documentElement","scrollCoord","pageXOffset","scrollLeft","pageYOffset","scrollTop","left","top","getViewportPageOffset","getBorderBox","parseFloat","right","bottom","Rect","scrollIntoContainerView","container","opt_center","offset","getContainerOffsetToScrollInto","elementPos","containerPos","containerBorder","relX","relY","elementSize","spaceX","clientWidth","spaceY","clientHeight","createDom","content","arrow","opacity","transition","ANIMATION_TIME","setBoundsElement","boundsElem","boundsElement","getOwner","getContentDiv","clearContent","setColour","backgroundColour","borderColour","backgroundColor","borderColor","showPositionedByField","field","opt_onHide","opt_secondaryYOffset","showPositionedByRect","positionToField","getScaledBboxOfField","getScaledBboxOfBlock","blockSvg","getSvgRoot","scale","scaledHeight","scaledWidth","xy","bBox","getScaledBBox","primaryX","primaryY","secondaryY","sourceBlock","getSourceBlock","show","RTL","newOwner","rtl","secondaryX","positionInternal","owner","direction","getRenderer","getClassName","getTheme","renderedClassName","themeClassName","getPositionBelowMetrics","boundsInfo","divSize","initialX","xCoords","getPositionX","divX","initialY","finalX","finalY","PADDING_Y","arrowX","arrowY","ARROW_SIZE","BORDER_SIZE","arrowAtTop","arrowVisible","getPositionAboveMetrics","sourceX","boundsLeft","boundsRight","divWidth","horizPadding","ARROW_HORIZONTAL_PADDING","relativeArrowX","isVisible","hideIfOwner","divOwner","opt_withoutAnimation","hideWithoutAnimation","hide","onHide","animateOutTimer","display","markFocused","metrics","internal","getPositionMetrics","floor","register","registryItem","opt_allowOverrides","trim","toLowerCase","caselessName","typeRegistry","typeMap","nameRegistry","nameMap","validate","Type","FIELD","fromJson","unregister","getItem","opt_throwIfMissing","hasItem","getClass","getObject","getAllItems","opt_cased","casedRegistry","getClassFromOptions","plugin","plugins","toString","DEFAULT","getNextUniqueId","nextId","genUid","setRecordUndo","newValue","recordUndo","getRecordUndo","fire","event","fireInternal","fireNow","queue","filter","FIRE_QUEUE","eventWorkspace","fireChangeListener","queueIn","forward","slice","reverse","mergedQueue","hash","isNull","isUiEvent","UI","blockId","join","lastEntry","lastEvent","MOVE","moveEvent","newParentId","newInputName","newCoordinate","CHANGE","VIEWPORT_CHANGE","viewportEvent","viewTop","viewLeft","oldScale","CLICK","BUBBLE_OPEN","unshift","clearPendingUndo","disable","disabled","enable","isEnabled","getGroup","setGroup","state","setGroupInternal","getDescendantIds","ids","json","eventClass","get","eventClassHasStaticFromJson","getOwnPropertyDescriptors","eventType","EVENT","disableOrphans","CREATE","getBlockById","initialUndoFlag","getParent","children","child","setEnabled","outputConnection","previousConnection","isDragging","tagName","NAME_SPACE","createTextNode","textToDomDocument","parseFromString","DOMParser","domToText","dom","serializeToString","XMLSerializer","alert","message","opt_callback","alertImplementation","confirm","confirmInternal","prompt","defaultValue","promptImplementation","allUsedVarModels","ws","getAllBlocks","variables","Set","blockVariables","getVarModels","j","variable","getId","from","values","flyoutCategory","xmlList","registerButtonCallback","createVariableButtonHandler","getTargetWorkspace","blockList","flyoutCategoryBlocks","concat","variableModelList","getVariablesOfType","mostRecentVariable","Blocks","generateVariableFieldDom","value","textToDom","sort","VariableModel","compareByName","generateUniqueName","generateUniqueNameInternal","generateUniqueNameFromOptions","startChar","usedNames","letters","VAR_LETTER_OPTIONS","suffix","letterIndex","inUse","potName","Number","charAt","opt_type","promptAndCheckWithAlert","defaultName","promptName","Msg","existing","nameUsedWithAnyType","replace","createVariable","renameVariable","promptText","newName","nameUsedWithOtherType","renameVariableById","defaultText","newVar","allVariables","getVariableMap","getAllVariables","variableModel","getOrCreateVariablePackage","opt_name","getVariable","potentialVariableMap","getPotentialVariableMap","getVariableById","isFlyout","targetWorkspace","getAddedVariables","originalVariables","allCurrentVariables","addedVariables","cssContent","injected","inject","hasCss","pathToMedia","mediaPath","cssNode","cssTextNode","head","firstChild","getRelativeXY","parseInt","r","match","XY_REGEX","styleComponents","XY_STYLE_REGEX","getInjectionDivXY","is3dSupported","getViewportBBox","scrollOffset","getDocumentScroll","win","screenToWsCoordinates","screenCoordinates","screenX","screenY","boundingRect","getInjectionDiv","clientOffsetPixels","mainOffsetPixels","getOriginOffsetInPixels","difference","variablesToDom","variableList","blockToDomWithXY","opt_noId","isInsertionMarker","getChildren","DocumentFragment","getWidth","blockToDom","getRelativeToSurfaceXY","round","fieldToDom","isSerializable","toXml","isShadow","mutationToDom","mutation","hasChildNodes","hasAttributes","commentText","allFieldsToDom","inputList","input","fieldRow","fieldDom","getCommentText","size","commentModel","pinned","commentElement","data","dataElement","empty","inputTypes","DUMMY","childBlock","connection","targetBlock","VALUE","STATEMENT","childShadow","getShadowDom","cloneShadow","childElem","nodeType","ELEMENT_NODE","inputsInline","inputsInlineDefault","isCollapsed","isDeletable","isMovable","isEditable","nextElem","nextShadow","nextConnection","shadow","textNode","cloneNode","nodeName","removeAttribute","TEXT_NODE","doc","getElementsByTagName","domToWorkspace","xml","newBlockIds","existingGroup","setResizesEnabled","variablesFirst","xmlChild","childNodes","xmlChildElement","domToBlock","blockX","hasAttribute","blockY","isNaN","moveBy","rendered","WorkspaceCommentSvg","fromXmlRendered","WorkspaceComment","fromXml","Error","domToVariables","FINISHED_LOADING","xmlBlock","variablesBeforeCreation","topBlock","domToBlockHeadless","topBlockSvg","setConnectionTracking","initSvg","render","disposed","updateDisabled","resizeContents","initModel","newVariables","thisVariable","VAR_CREATE","xmlVariables","findChildBlocks","xmlNode","childBlockInfo","childBlockElement","childShadowElement","parentConnection","connectedToParentNext","prototypeName","outerHTML","newBlock","xmlChildNameMap","mapSupportedXmlTags","childNodeMap","comment","next","shouldCallInitSvg","applyMutationTagNodes","xmlChildren","domToMutation","applyCommentTagNodes","setCommentText","getCommentIcon","isInFlyout","setVisible","applyDataTagNodes","TypeError","connect","applyFieldTagNodes","applyInputTagNodes","getInput","setShadowDom","applyNextTagNodes","isConnected","inline","setInputsInline","deletable","setDeletable","movable","setMovable","editable","setEditable","collapsed","setCollapsed","setShadow","domToField","fieldName","getField","shortestStringLength","array","reduce","a","b","commonWordPrefix","opt_shortest","wordPrefix","len","letter","commonWordSuffix","substr","wrap","limit","lines","wrapLine","words","score","Infinity","lastText","lineCount","lastScore","wordBreaks","steps","insertedBreaks","wrapMutate","wrapScore","wrapToText","lineLengths","linePunctuation","maxLength","pow","abs","bestBreaks","bestScore","mutatedWordBreaks","mutatedScore","isNumber","str","test","getTooltipOfObject","object","obj","getTargetObject","tooltip","containerDiv","bindMouseEvents","mouseOverWrapper_","onMouseOver","mouseOutWrapper_","onMouseOut","onMouseMove","unbindMouseEvents","blocked","newElement","currentTarget","poisonedElement","mouseOutPid","_e","showPid","visible","dx","lastX","pageX","dy","lastY","pageY","sqrt","RADIUS_OK","HOVER_MS","dispose","unblock","renderDefaultContent","tip","LIMIT","renderContent","customTooltip","getPosition","windowWidth","windowHeight","anchorX","OFFSET_X","anchorY","OFFSET_Y","scrollY","MARGINS","scrollX","getHsvSaturation","getHsvValue","parse","hex","names","substring","rgb","g","rgbToHex","hexToRgb","colour","hsvToHex","h","s","v","red","green","blue","sextant","remainder","val1","val2","val3","blend","colour1","colour2","factor","hex1","hex2","rgb1","rgb2","hueToHex","hue","hsvSaturation","hsvValue","tokenizeInterpolationInternal","parseInterpolationTokens","tokens","chars","buffer","c","rawKey","bklyKey","keyUpper","toUpperCase","rawValue","Array","prototype","apply","mergedTokens","tokenizeInterpolation","replaceMessageReferences","interpolatedResult","checkMessageReferences","validSoFar","msgTable","m","parseBlockColour","dereferenced","errorMsg","getDiv","newDispose","rendererClassName","oldOwner","positionWithAnchor","viewportBBox","anchorBBox","widgetSize","calculateY","calculateX","fieldClass","fromJsonInternal","setRole","roleName","ROLE_ATTRIBUTE","setState","stateName","isArray","ARIA_PREFIX","applyTrim","prefixLength","suffixLength","map","validateOptions","foundError","tuple","error","src","deepMerge","source","convertToolboxDefToJson","toolboxDef","parseToolboxTree","convertToToolboxJson","toolboxJson","validateToolbox","toolboxKind","toolboxContents","FLYOUT_TOOLBOX_KIND","CATEGORY_TOOLBOX_KIND","convertFlyoutDefToJsonArray","flyoutDef","xmlToJsonArray","hasCategories","hasCategoriesInternal","isCategoryCollapsible","categoryInfo","item","addAttributes","arr","attributes","attr","parsedToolboxDef","initFn","allExtensions","isRegistered","isMutator","extensionFn","mutatorProperties","checkNoMutatorProperties","getMutatorProperties","checkHasMutatorProperties","mutatorPropertiesMatch","mutationName","checkMutatorDialog","errorPrefix","compose","decompose","checkHasFunctionPair","func1","func2","hasXmlHooks","checkXmlHooks","hasJsonHooks","checkJsonHooks","saveExtraState","loadExtraState","oldProperties","newProperties","runAfterPageLoad","fn","readyState","readyStateCheckInterval","setInterval","clearInterval","checkDropdownOptionsInTable","dropdownName","lookupTable","dropdown","isOptionListDynamic","getOptions","optionKey","removeElem","point","curve","command","points","moveTo","lineTo","line","lineOnAxis","val","arc","flags","radius","serializer","SERIALIZER","save","addCoordinates","addInputBlocks","addNextBlocks","doFullSerialization","saveCoords","saveInputBlocks","saveNextBlocks","saveAttributes","extraState","saveIcons","saveFields","fields","saveState","inputs","connectionState","saveConnection","getShadowState","append","appendInternal","prevRecordUndo","appendPrivate","BLOCK_CREATE","MissingBlockType","loadCoords","loadAttributes","tryToConnectParent","RealChildOfShadow","childConnection","MissingConnection","checker","connectionChecker","BadConnectionCheck","getErrorMessage","canConnectWithReason","loadIcons","loadFields","fieldState","loadState","loadInputBlocks","inputName","loadConnection","loadNextBlocks","setShadowState","initBlock","icons","getIcons","computeIconLocation","getSingleConnection","orphanBlock","foundConnection","typeChecker","output","getConnectionChecker","canConnect","getParentConnection","topConnection","disposeUiEffect","svgGroup","getAudioManager","play","getSvgXY","clone","cloneRect","Date","disposeUiStep","rect","start","workspaceScale","percent","getTime","connectionUiEffect","ripple","Svg","CIRCLE","connectionUiStep","disconnectPid","disconnectUiEffect","disconnectUiStop","getHeightWidth","magnitude","atan","DISPLACEMENT","disconnectGroup","disconnectUiStep","group","DURATION","skew","sin","WIGGLES","skew_","translate_","copy","toCopy","copyInternal","paste","copyData","typeCounts","isCapacityAvailable","saveInfo","duplicate","toDuplicate","duplicateInternal","getCurrentBlock","setCurrentBlock","currentBlock","dummyOwner","menu","populate_","focus","Menu","Role","MENU","option","menuItem","MenuItem","setRightToLeft","MENUITEM","addChild","enabled","onAction","actionHandler","scope","position_","menuSize","createWidget_","menuDom","haltPropagation","preventDefault","stopPropagation","menu_","commentDeleteOption","deleteOption","commentDuplicateOption","duplicateOption","getStartPositionRect","position","horizontalPadding","verticalPadding","hasVerticalScrollbar","scrollbar","canScrollVertically","horizontal","horizontalPosition","LEFT","absoluteMetrics","Scrollbar","scrollbarThickness","viewMetrics","vertical","verticalPosition","TOP","canScrollHorizontally","getCornerOppositeToolbox","toolboxMetrics","Position","horizontalLayout","RIGHT","BOTTOM","bumpPositionRect","startRect","margin","bumpDir","savedPositions","otherEl","intersects","bumpDirection","UP","registerEscape","ShortcutRegistry","registry","escapeAction","ESCAPE","preconditionFn","readOnly","hideChaff","keyCodes","KeyCodes","ESC","registerDelete","deleteShortcut","DELETE","Gesture","inProgress","checkAndDelete","BACKSPACE","registerCopy","ctrlC","createSerializedKey","C","CTRL","altC","ALT","metaC","META","copyShortcut","COPY","registerCut","ctrlX","X","altX","metaX","cutShortcut","CUT","registerPaste","ctrlV","V","altV","metaV","pasteShortcut","PASTE","registerUndo","ctrlZ","Z","altZ","metaZ","undoShortcut","UNDO","undo","registerRedo","ctrlShiftZ","SHIFT","altShiftZ","metaShiftZ","ctrlY","Y","redoShortcut","REDO","registerDefaultShortcuts","isObservable","startPublishing","stopPublishing","isProcedureBlock","doProcedureUpdate","triggerProceduresUpdate","allProcedures","root","proceduresNoReturn","getBlocksByType","getProcedureDef","proceduresReturn","procTupleComparator","ta","tb","localeCompare","sensitivity","findLegalName","isLegalName","opt_exclude","isNameUsed","procedureBlock","procName","Names","equals","populateProcedures","procedureList","templateName","args","arg","nameField","updateMutatorFlyout","getFieldValue","xmlElement","argBlock","argValue","DEFAULT_ARG","fieldContent","updateToolbox","mutatorOpenListener","bubbleType","isOpen","mutator","getWorkspace","addChangeListener","mutatorChangeListener","BLOCK_DELETE","BLOCK_CHANGE","getCallers","callers","getProcedureCall","isDynamicShape","shape","isDynamic","isDebuggerEnabled","stopDebugger","rendererClass","RENDERER","theme","opt_rendererOverrides","renderer","stringButtonClickHandler","numberButtonClickHandler","colourButtonClickHandler","firstVariable","resizeSvgContents","saveProcedure","proc","getName","returnTypes","getReturnTypes","getParameters","parameters","param","saveParameter","getTypes","types","loadProcedure","procedureModelClass","parameterModelClass","setReturnTypes","entries","insertParameter","loadParameter","model","setTypes","bumpObjectIntoBounds","scrollMetrics","objectMetrics","getBoundingRectangle","leftClamp","rightClamp","bumpIntoBoundsHandler","metricsManager","getMetricsManager","hasFixedEdges","BUMP_EVENTS","scrollMetricsInWsCoords","getScrollMetrics","extractObjectFromEvent","oldGroup","bumpTopObjectsIntoBounds","BLOCK_MOVE","getRootBlock","COMMENT_CREATE","COMMENT_MOVE","getCommentById","commentId","topBlocks","getTopBoundedElements","opt_options","getElementById","querySelector","Options","subContainer","tabIndex","State","LABEL","blockDragSurface","BlockDragSurfaceSvg","workspaceDragSurface","WorkspaceDragSurfaceSvg","createMainWorkspace","SVG","HTML_NS","XLINK_NS","defs","DEFS","rnd","random","gridPattern","Grid","gridOptions","wsOptions","WorkspaceSvg","zoomOptions","startScale","injectionDiv","languageTree","flyout","addFlyout","hasTrashcan","addTrashcan","controls","addZoomControls","getThemeManager","subscribe","translate","workspaceResizeHandler","setResizeHandlerWrapper","toolbox","getToolbox","getFlyout","scrollToStart","trashcan","zoomControls_","moveOptions","scrollbars","ScrollbarPair","setMetrics","hasSounds","loadSounds","onKeyDown","bindDocumentEvents","documentEventsBound","updateInverseScreenCTM","IPAD","unbindSounds","soundBinds","preload","audioMgr","load","findMatchingParameter","modelId","paramId","procedureModel","getProcedureMap","find","p","ContextMenuRegistry","undoOption","displayText","getUndoStack","scopeType","ScopeType","WORKSPACE","weight","redoOption","getRedoStack","registerCleanup","cleanOption","getTopBlocks","cleanUp","toggleOption_","shouldCollapse","timeoutFn","timeoutCounter","ms","DELAY","registerCollapse","collapseOption","collapse","registerExpand","expandOption","addDeletableBlocks_","deleteList","getDeletableBlocks_","deleteNext_","eventGroup","shift","isDeadOrDying","registerDeleteAll","deletableBlocksLength","cancelCurrentGesture","deletableBlocks","ok","registerDuplicate","isDuplicatable","BLOCK","registerComment","commentOption","comments","registerInline","inlineOption","getInputsInline","registerCollapseExpandBlock","collapseExpandOption","registerDisable","disableOption","getInheritedDisabled","descendantCount","registerHelp","helpOption","helpUrl","showHelp","registerDefaultOptions","registerWorkspaceOptions_","registerBlockOptions_","resizeSvgContentsLocal","global","globalThis","$jscomp$tmp$exports$module$name","declareModuleId","namespace","goog","define","goog.define","DEBUG","DISALLOW_TEST_ONLY_CODE","provide","goog.provide","module","goog.module","goog.module.get","declareLegacyNamespace","goog.module.declareLegacyNamespace","setTestOnly","goog.setTestOnly","opt_message","require","goog.require","requireType","goog.requireType","rawUserAgent","isJavaFx","isWebKit","isGecko","isAndroid","isIPad","isIPhone","isMac","isTablet","isMobile","TOUCH_ENABLED","isMouseOrTouchEvent","isTouchEvent","setClientFromTouch","changedTouches","touchPoint","splitEventByTouches","events","newEvent","raw","has","rawUpper","maxTouchPoints","JavaFx","GECKO","ANDROID","IPHONE","MOBILE","draggingConnections","COMMENT_NODE","getTextWidth","getComputedTextLength","hasClass","constructor","other","tx","ty","distance","sum","originalDisplay","originalVisibility","visibility","originalPosition","getCascadedStyle","currentStyle","getBoundsInfo","boundPosition","boundSize","clientTop","getPositionTopOfPageMetrics","repositionForWindowResize","showPositionedByBlock","CONNECTION_CHECKER","CURSOR","TOOLBOX","THEME","TOOLBOX_ITEM","FLYOUTS_VERTICAL_TOOLBOX","FLYOUTS_HORIZONTAL_TOOLBOX","METRICS_MANAGER","BLOCK_DRAGGER","soupLength","xmlDocument","BLOCK_DRAG","COMMENT_CHANGE","COMMENT_DELETE","MARKER_MOVE","PROCEDURE_CHANGE_RETURN","PROCEDURE_CREATE","PROCEDURE_DELETE","PROCEDURE_ENABLE","PROCEDURE_PARAMETER_CREATE","PROCEDURE_PARAMETER_DELETE","PROCEDURE_PARAMETER_RENAME","PROCEDURE_RENAME","SELECTED","THEME_CHANGE","TOOLBOX_ITEM_SELECT","TRASHCAN_OPEN","VAR_DELETE","VAR_RENAME","getDocument","setDocument","setLocale","confirmImplementation","setAlert","alertFunction","setConfirm","confirmFunction","setPrompt","promptFunction","locale","forEach","k","Abstract","toJson","isBlank","run","_forward","getEventWorkspace_","VarBase","opt_variable","varId","VarCreate","varType","varName","deleteVariableById","opt_id","id_","var1","var2","getAllVariableNames","CATEGORY_NAME","allDeveloperVariables","getDeveloperVariables","devVars","editable_","movable_","deletable_","disposed_","isComment","addTopComment","xy_","height_","width_","content_","fireCreateEvent","removeTopComment","getHeight","setHeight","setWidth","getXY","recordNew","getContent","setContent","toXmlWithXY","xmlComment","info","parseAttributes","w","xmlX","xmlY","commentX","NaN","commentY","xmlH","xmlW","xmlId","UiBase","opt_workspaceId","Selected","opt_oldElementId","opt_newElementId","oldElementId","newElementId","ANIMATE","CLIPPATH","FECOMPOSITE","FECOMPONENTTRANSFER","FEFLOOD","FEFUNCA","FEGAUSSIANBLUR","FEPOINTLIGHT","FESPECULARLIGHTING","FILTER","FOREIGNOBJECT","G","IMAGE","LINE","PATH","PATTERN","POLYGON","RECT","TEXT","TSPAN","onMouseMoveWrapper_","onMouseUpWrapper_","eventsInit_","deleteIconBorder_","deleteGroup_","resizeGroup_","foreignObject_","svgHandleTarget_","svgRectTarget_","textarea_","rendered_","autoLayout_","focused_","svgGroup_","svgRect_","useDragSurface_","getBlockDragSurface","unselect","disposeInternal_","opt_noSelect","pathMouseDown_","updateMovable","getBubbleCanvas","select","getGesture","handleBubbleStart","showContextMenu","oldId","addSelect","removeSelect","blurFocus","setFocus","addFocus","removeFocus","dragSurfaceGroup","surfaceTranslation","getSurfaceTranslation","moveToDragSurface","clearTransformAttributes_","translateSurface","setBlocksAndShow","moveDuringDrag","dragSurface","newLoc","blockXY","commentBounds","setDragging","adding","setDeleteStyle","setAutoLayout","_enable","toCopyData","createEditor_","addResizeDom_","addDeleteDom_","setSize_","resizeMouseDown_","deleteMouseDown_","deleteMouseOut_","deleteMouseUp_","TOP_OFFSET","textarea","RESIZE_SIZE","unbindDragEvents_","startDrag","resizeMouseUp_","resizeMouseMove_","newXY","moveDrag","resizeComment_","topOffset","blur","opt_wsWidth","wsWidth","DEFAULT_SIZE","appendDomToWorkspace","getBlocksBoundingBox","bbox","farY","topX","newLeftX","newRightX","newY","offsetY","ySeparation","offsetX","clearWorkspaceAndLoadFromXml","blockIds","clear","deleteNext","domToPrettyText","indent","workspaceToDom","treeXml","variablesElement","getTopComments","BlockBase","opt_block","BlockChange","opt_element","opt_oldValue","opt_newValue","oldValue","setValue","oldState","getExtraBlockState_","JSON","stringify","MarkerManager","cursorSvg_","cursor_","markers","Map","markerSvg_","registerMarker","marker","unregisterMarker","setDrawer","makeMarkerDrawer","setMarkerSvg","getDrawer","set","delete","getCursor","getMarker","setCursor","cursor","drawer","setCursorSvg","cursorSvg","getBlockCanvas","markerSvg","updateMarkers","keyboardAccessibilityMode","draw","markerIds","markerId","LOCAL_MARKER","prefix","getCustomTooltip","setCustomTooltip","customFn","setHsvSaturation","newSaturation","setHsvValue","Sentinel","testOnly_setDiv","newDiv","Field","opt_validator","opt_config","DEFAULT_VALUE","constants_","mouseDownWrapper_","textContent_","textElement_","borderRect_","fieldGroup_","tooltip_","validator_","maxDisplayLength","sourceBlock_","enabled_","visible_","isDirty_","suffixField","prefixField","clickTarget_","EDITABLE","SERIALIZABLE","value_","size_","SKIP_SETUP","configure_","setValidator","config","setTooltip","setSourceBlock","getConstants","initView","updateEditable","bindEvents_","createBorderRect_","createTextElement_","FIELD_BORDER_RECT_RADIUS","FIELD_TEXT_BASELINE_CENTER","clickTarget","getClickTarget_","onMouseDown_","fieldElement","getValue","_doFullSerialization","legacyState","saveLegacyState","loadLegacyState","callingClass","isClickable","showEditor_","isCurrentlyEditable","handler","getValidator","getBorderRect","getTextElement","getTextContent","applyColour","render_","nodeValue","getDisplayText_","updateSize_","showEditor","opt_e","opt_margin","constants","totalWidth","xOffset","FIELD_BORDER_RECT_X_PADDING","totalHeight","FIELD_TEXT_HEIGHT","contentWidth","FIELD_TEXT_FONTSIZE","FIELD_TEXT_FONTWEIGHT","FIELD_TEXT_FONTFAMILY","FIELD_BORDER_RECT_HEIGHT","positionTextElement_","positionBorderRect_","halfHeight","FIELD_TEXT_BASELINE","UnattachedFieldError","getAbsoluteXY_","getText","NBSP","getText_","markDirty","forceRerender","bumpNeighbours","updateMarkers_","validatedValue","doClassValidation_","processValidation_","localValidator","doValueUpdate_","doValueInvalid_","_invalidValue","setStartField","newTip","getTooltip","referencesVariables","refreshVariableName","getParentInput","parentInput","idx","fieldRows","getFlipRtl","isTabNavigable","onShortcut","_shortcut","fieldObject","GRID","GRIDCELL","GROUP","LISTBOX","MENUITEMCHECKBOX","OPTION","PRESENTATION","ROW","TREE","TREEITEM","WIN_KEY_FF_LINUX","MAC_ENTER","TAB","NUM_CENTER","ENTER","PAUSE","CAPS_LOCK","SPACE","PAGE_UP","PAGE_DOWN","END","HOME","DOWN","PLUS_SIGN","PRINT_SCREEN","INSERT","ZERO","ONE","TWO","THREE","FOUR","FIVE","SIX","SEVEN","EIGHT","NINE","FF_SEMICOLON","FF_EQUALS","FF_DASH","FF_HASH","QUESTION_MARK","AT_SIGN","A","B","D","E","F","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","W","WIN_KEY_RIGHT","CONTEXT_MENU","NUM_ZERO","NUM_ONE","NUM_TWO","NUM_THREE","NUM_FOUR","NUM_FIVE","NUM_SIX","NUM_SEVEN","NUM_EIGHT","NUM_NINE","NUM_MULTIPLY","NUM_PLUS","NUM_MINUS","NUM_PERIOD","NUM_DIVISION","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12","NUMLOCK","SCROLL_LOCK","FIRST_MEDIA_KEY","LAST_MEDIA_KEY","SEMICOLON","DASH","EQUALS","COMMA","PERIOD","SLASH","APOSTROPHE","TILDE","SINGLE_QUOTE","OPEN_SQUARE_BRACKET","BACKSLASH","CLOSE_SQUARE_BRACKET","WIN_KEY","MAC_FF_META","MAC_WK_CMD_LEFT","MAC_WK_CMD_RIGHT","WIN_IME","VK_NONAME","PHANTOM","menuItems","onKeyDownHandler","mouseLeaveHandler","mouseEnterHandler","clickHandler","mouseOverHandler","highlightedItem","openingCoords","handleMouseOver","handleClick","handleMouseEnter","handleMouseLeave","handleKeyEvent","getElement","preventScroll","getMenuItem","menuElem","currentElement","setHighlighted","currentHighlighted","ACTIVEDESCENDANT","highlightNext","highlightHelper","highlightPrevious","highlightFirst","highlightLast","startIndex","delta","oldCoords","newCoords","performAction","shiftKey","metaKey","altKey","highlighted","keyCode","scrollHeight","opt_value","rightToLeft","highlight","checked","checkable","checkbox","contentDom","DISABLED","setCheckable","setChecked","nameDep","FieldDropdown","menuGenerator","svgArrow_","arrow_","imageElement_","selectedMenuItem_","generatedOptions_","isMenuGenerator","trimmed","trimOptions","hasImages","trimmedOptions","label","alt","stringLabels","shortest","menuGenerator_","selectedOption_","shouldAddBorderRect_","FIELD_DROPDOWN_SVG_ARROW","createSVGArrow_","createTextArrow_","FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW","ARROW_CHAR","FIELD_DROPDOWN_SVG_ARROW_SIZE","setAttributeNS","FIELD_DROPDOWN_SVG_ARROW_DATAURI","dropdownCreate_","menuElement","FIELD_DROPDOWN_COLOURED_DIV","primaryColour","getColour","colourTertiary","dropdownDispose_","image","Image","handleMenuActionEvent_","onItemSelected_","opt_useCache","some","fill","colourSecondary","colourPrimary","renderSelectedImage_","renderSelectedText_","imageJson","imageHeight","imageWidth","hasBorder","FIELD_DROPDOWN_BORDER_RECT_HEIGHT","IMAGE_Y_PADDING","arrowWidth","xPadding","positionSVGArrow_","textWidth","textPadding","FIELD_DROPDOWN_SVG_ARROW_PADDING","svgArrowSize","CHECKMARK_OVERHANG","MAX_MENU_HEIGHT_VH","IMAGE_Y_OFFSET","BubbleType","BubbleOpen","opt_isOpen","opt_bubbleType","MUTATOR","COMMENT","WARNING","opt_pair","opt_class","oldHostMetrics","ratio","origin","startDragHandle","handlePosition","handleLength","scrollbarLength","startDragMouse","containerVisible","isHandleVisible","pair","DEFAULT_SCROLLBAR_MARGIN","outerSvg","svgBackground","svgHandle","setInitialThickness","lengthAttribute_","positionAttribute_","onMouseDownBarWrapper_","onMouseDownBar","onMouseDownHandleWrapper_","onMouseDownHandle","unsubscribe","constrainHandleLength","setHandleLength","newLength","constrainHandlePosition","setHandlePosition","newPosition","setScrollbarLength","newSize","setPosition","opt_metrics","hostMetrics","getMetrics","metricsAreEquivalent","resizeHorizontal","resizeVertical","updateMetrics","requiresViewResize","viewWidth","viewHeight","absoluteLeft","absoluteTop","resizeViewHorizontal","resizeContentHorizontal","viewSize","xCoordinate","scrollWidth","maxScrollDistance","maxHandleOffset","handleOffset","resizeViewVertical","resizeContentVertical","setContainerVisible","visibilityChanged","updateDisplay_","mouseXY","getInverseScreenCTM","mouseLocation","handleXY","handleStart","pageLength","setupDragSurface","onMouseUpHandle","onMouseMoveHandle","resetDragSurface","getRatio_","setOrigin","first","second","Bubble","anchorXY","bubbleWidth","bubbleHeight","resizeGroup","bubbleBack","bubbleArrow","bubbleGroup","relativeTop","relativeLeft","autoLayout","onMouseDownResizeWrapper","onMouseDownBubbleWrapper","moveCallback","resizeCallback","workspace_","shape_","angle","ARROW_ANGLE","arrowRadians","setAnchorLocation","getBBox","BORDER_WIDTH","setBubbleSize","positionBubble","renderArrow","hasResize","embossFilterId","bubbleEmboss","resizeSize","bubbleMouseDown","resizeMouseDown","setSvgId","promote","unbindDragEvents","onMouseUpWrapper","bubbleMouseUp","onMouseMoveWrapper","resizeMouseMove","registerResizeEvent","registerMoveEvent","lastChild","layoutBubble","getViewMetrics","optimalLeft","getOptimalRelativeLeft","optimalTop","getOptimalRelativeTop","topPosition","MIN_BLOCK_HEIGHT","startPosition","endPosition","bottomPosition","closerPosition","fartherPosition","topPositionOverlap","getOverlap","startPositionOverlap","closerPositionOverlap","fartherPositionOverlap","mostOverlap","relativeMin","bubbleRight","workspaceRight","workspaceLeft","bubbleLeft","bubbleTop","bubbleBottom","workspaceTop","workspaceBottom","getBubbleSize","doubleBorderWidth","relBubbleX","relBubbleY","relAnchorX","relAnchorY","hypotenuse","rise","acos","rightAngle","rightRise","rightRun","cos","bubbleSize","thickness","ARROW_THICKNESS","backoffRatio","ANCHOR_RADIUS","baseX1","baseY1","baseX2","baseY2","swirlAngle","swirlRise","ARROW_BEND","swirlRun","hexColour","paragraph","tspanElement","createNonEditableBubble","paragraphElement","iconXY","bubble","pathObject","svgPath","maxWidth","dragRadius","flyoutDragRadius","snapRadius","connectingSnapRadius","currentConnectionPreference","bumpDelay","Icon","iconGroup_","collapseHidden","SIZE","iconXY_","bubble_","block_","createIcon","getBlock","drawIcon_","iconClick_","setIconLocation","getIconLocation","getCorrectedSize","_group","_visible","inherits","childCtor","parentCtor","superClass_","setPrototypeOf","mixin","Theme","opt_blockStyles","opt_categoryStyles","opt_componentStyles","startHats","blockStyles","categoryStyles","componentStyles","fontStyle","setBlockStyle","blockStyleName","blockStyle","setCategoryStyle","categoryStyleName","categoryStyle","getComponentStyle","componentName","setComponentStyle","styleValue","setFontStyle","setStartHats","defineTheme","themeObj","base","Classic","toolboxJsonDef","hasCollapse","hasComments","hasDisable","rawHasTrashcan","rawHasCollapse","rawHasComments","rawHasDisable","rawHasSounds","maxTrashcanContents","toolboxAtStart","endsWith","rawOneBasedIndex","modalInputs","oneBasedIndex","maxBlocks","maxInstances","parseMoveOptions_","hasScrollbars","parseGridOptions_","parseZoomOptions_","toolboxPosition","parseThemeOptions_","rendererOverrides","move","wheel","drag","zoom","maxScale","minScale","scaleSpeed","pinch","grid","spacing","snap","Mutator","quarkNames","workspaceHeight","workspaceWidth","updateWorkspacePid","sourceListener","rootBlock","svgDialog","setBlock","createEditor","quarkXml","quarkName","workspaceOptions","hasFlyout","newWorkspaceSvg","internalIsMutator","flyoutSvg","background","svgBlockCanvas_","resizeBubble","canvas","getCanvas","workspaceSize","flyoutScrollMetrics","isRtl","onBubbleMove","recordDragTargets","tree","CORNER_RADIUS","saveConnections","thisRootBlock","workspaceChanged","updateWorkspace","removeChangeListener","shouldIgnoreMutatorEvent_","MARGIN","oldExtraState","savedRendered","newExtraState","mutationGroup","updateBlockStyle","workspaceBlocks","setStyle","getStyleName","flyoutBlocks","reconnect","connectionChild","connectionParent","currentParent","targetConnection","disconnect","findParentWs","outerWs","extensionParentTooltip","tooltipWhenNotConnected","buildTooltipForDropdown","blockTypesChecked","warning","buildTooltipWithFieldText","msgTemplate","registerMixin","mixinObj","registerMutator","opt_helperFn","opt_blockList","hasMutatorDialog","setMutator","aria","arrayUtils","arrayRemove","browserEvents","deprecation","extensions","getInjectionDivXY_","idGenerator","math","parsing","stringUtils","svgMath","svgPaths","userAgent","TrashcanOpen","Capability","name_","POSITIONABLE","DRAG_TARGET","DELETE_AREA","AUTOHIDEABLE","ComponentManager","componentData","capabilityToComponentIds","addComponent","componentInfo","component","capabilities","stringCapabilities","capability","removeComponent","addCapability","getComponent","hasCapability","removeCapability","getComponents","sorted","componentIds","components","componentDataList","componentDatum","DeserializationError","toDevString","reason","childState","BLOCKS","PROCEDURES","VARIABLES","BlockSerializer","priority","blockStates","saveBlock","BlockCreate","BlockDelete","oldXml","wasShadow","oldJson","ConnectionType","INPUT_VALUE","OUTPUT_VALUE","NEXT_STATEMENT","PREVIOUS_STATEMENT","Connection","shadowDom_","check_","shadowState_","connect_","INPUT","parentBlock","orphan","shadowState","stashShadowState_","applyShadowState_","connectReciprocally","setParent","orphanConnection","getConnectionForOrphanedConnection","onFailedConnect","setShadowStateInternal_","unplug","isSuperior","_otherConnection","otherConnection","disconnectInternal_","respawnShadow_","createShadowBlock_","onCheckChanged_","setCheck","check","getCheck","shadowDom","returnCurrent","neighbours","_maxLimit","serializeShadow_","attemptToConnect","blockShadow","startBlock","getConnectionForOrphanedOutput","lastConnectionInStack","CAN_CONNECT","REASON_SELF_CONNECTION","REASON_WRONG_TYPE","REASON_TARGET_NULL","REASON_CHECKS_FAILED","REASON_DIFFERENT_WORKSPACES","REASON_SHADOW_PARENT","REASON_DRAG_CHECKS_FAILED","REASON_PREVIOUS_AND_OUTPUT","COLLAPSED_FIELD_NAME","COLLAPSED_INPUT_NAME","FieldLabel","class_","class","setClass","cssClass","Input","align","Align","appendField","insertFieldAt","removeField","opt_quiet","renderList","renderedConnection","startTrackingAll","stopTrackingAll","setAlign","CENTRE","ASTNode","location","opt_params","wsCoordinate_","type_","isConnection_","isConnectionType_","location_","processParams_","params","wsCoordinate","getLocation","getType","getWsCoordinate","isConnection","findNextForInput_","curIdx","NAVIGATE_ALL_FIELDS","createFieldNode","createInputNode","findNextForField_","fieldIdx","newInput","findPrevForInput_","findPrevForField_","navigateBetweenStacks_","curLocation","curLocationAsBlock","curRoot","resultIndex","createStackNode","findTopASTNodeForBlock_","createConnectionNode","createBlockNode","getOutAstNodeForBlock_","getTopStackBlock","findFirstFieldOrInput_","STACK","OUTPUT","PREVIOUS","NEXT","in","prev","out","blockPos","DEFAULT_OFFSET_Y","createWorkspaceNode","createTopNode","astNode","Block","hue_","colour_","styleName_","destroy","suppressPrefixSuffix","contextMenu","parentBlock_","childBlocks_","collapsed_","isShadow_","outputShape_","disposing","isInsertionMarker_","hat","onchangeWrapper_","statementInputCount","setBlockById","isInMutator","assign","addTopBlock","addTypedBlock","doInit_","onchange","setOnChange","healStack","removeTopBlock","removeTypedBlock","removeBlockById","connections","getConnections_","opt_healStack","unplugFromRow_","unplugFromStack_","thisConnection","getOnlyValueConnection_","previousTarget","nextTarget","_all","myConnections","ignoreShadows","getInputWithBlock","getSurroundParent","prevBlock","getPreviousBlock","getFirstStatementConnection","previous","ordered","childBlocks","hasBlockLimits","setInsertionMarker","insertionMarker","isDisposed","getMatchingConnection","otherBlock","conn","otherConnections","setHelpUrl","url","getHue","parsed","onchangeFn","getVars","vars","updateVarName","renameVarById","newId","setFieldValue","setPreviousStatement","newBoolean","opt_check","makeConnection_","setNextStatement","setOutput","setOutputShape","outputShape","getOutputShape","ancestor","opt_maxLength","opt_emptyToken","shouldAddParentheses","checks","checkRoot","rootNode","emptyFieldPlaceholder","prevNavigateFields","current","acc","appendValueInput","appendInput_","appendStatementInput","appendDummyInput","warningPrefix","jsonInitStyle_","jsonInitColour_","interpolate_","localizedText","localizedValue","extensionNames","styleError","opt_disableCheck","overwrites","lastDummyAlign","validateTokens_","elements","interpolateArguments_","fieldStack","isInputKeyword_","inputFromJson_","fieldFromJson_","argsCount","visitedArgsHash","visitedArgsCount","token","stringToFieldJson_","dummyInput","alignmentLookup","alignment","moveInputBefore","refName","inputIndex","refIndex","moveNumberedInputBefore","removeInput","getInputTargetBlock","setWarningText","_text","_opt_id","_mutator","allInputsFilled","opt_shadowBlocksAreFilled","Comment","cachedText","paragraphElement_","foreignObject","onInputWrapper","onChangeWrapper","onWheelWrapper","resizeTextarea","startEdit","disposeBubble","createBubble","onBubbleResize","widthMinusBorder","heightMinusBorder","createEditableBubble","updateText","oldCopyData","pastedThing","callbackFactory","workspaceCommentOption","wsCommentOption","wsCommentOption.callback","finalOffset","registry_","reset","getContextMenuOptions","menuOptions","precondition","menuOption","OPPOSITE_TYPE","RENAME_VARIABLE_ID","COLLAPSE_CHARS","DELETE_VARIABLE_ID","DRAG_STACK","Marker","drawer_","curNode_","getCurNode","setCurNode","oldNode","Cursor","curNode","BasicCursor","getNextNode_","validNode_","getPreviousNode_","isValid","siblingOrParent","findSiblingOrParent_","getRightMostChild_","nextNode","registrationName","TabNavigateCursor","RenderedConnection","highlightPath","db_","connectionDBList","dbOpposite_","offsetInBlock_","trackedState_","TrackedState","WILL_TRACK","TRACKED","removeConnection","distanceFrom","xDiff","yDiff","bumpAwayFrom","staticConnection","addConnection","moveToOffset","blockTL","setOffsetInBlock","getOffsetInBlock","tighten","svgRoot","moveConnections","closest","maxLimit","dxy","searchForClosest","renderConstants","shapeFor","yLen","TAB_OFFSET_FROM_TOP","pathDown","xLen","NOTCH_OFFSET_LEFT","pathLeft","unhighlight","setTracking","doTracking","UNTRACKED","getNeighbours","parentRendered","childRendered","Warning","setText","allWarnings","BlockSvg","renderingDebugger","warningTextDb","commentIcon_","renderIsInProgress_","customContextMenu","getBlockStyle","makePathObject","getColourSecondary","getColourTertiary","oldParent","isClearing","oldXY","eventsEnabled","curXY","moveOffDragSurface","clearAndHide","snapToGrid","getGrid","shouldSnap","getSpacing","half","blockBounds","updateCollapsed_","collapsedInputName","collapsedFieldName","icon","tab","tabCursor","currentNode","handleBlockStart","open","generateContextMenu","INSERTION_MARKER_COLOUR","updateInsertionMarker","animate","blockWorkspace","n","shouldHaveComment","timeout","changedState","collapsedParent","COLLAPSED_WARNING_ID","oldText","newText","updateHighlighted","updateSelected","updateDraggingDelete","styleObj","getBlockStyleForColour","bringToFront","removed","track","all","bumpNeighboursInternal","neighbour","scheduleSnapAndBump","positionNearConnection","sourceConnection","opt_bubble","updateConnectionLocations_","nextHeightWidth","tabHeight","NOTCH_HEIGHT","fadeForReplacement","updateReplacementFade","highlightShapeForInput","updateShapeForInputHighlight","INLINE","DragTarget","onDragEnter","_dragElement","onDragOver","onDragExit","onDrop","getClientRect","shouldPreventMove","DeleteArea","wouldDelete_","wouldDelete","couldConnect","couldDeleteBlock","updateWouldDelete_","SPRITE","Trashcan","contents_","isLidOpen","minOpenness_","lidTask_","svgLid_","top_","left_","lidOpen_","initialized_","flyoutWorkspaceOptions","onDelete_","clip","WIDTH","BODY_HEIGHT","LID_HEIGHT","SPRITE_LEFT","SPRITE_TOP","blockMouseDownWhenOpenable_","click","mouseOver_","mouseOut_","animateLid_","getComponentManager","setLidOpen","hasContents_","contentsIsOpen","openFlyout","contents","string","blocklyStyle","fireUiEvent_","closeFlyout","autoHide","onlyClosePopups","emptyContents","setMinOpenness_","cornerPosition","MARGIN_HORIZONTAL","MARGIN_VERTICAL","positionRect","trashRect","MARGIN_HOTSPOT","frames","ANIMATION_FRAMES","setLidAngle_","MAX_LID_ANGLE","OPACITY_MIN","OPACITY_MAX","ANIMATION_LENGTH","lidAngle","openAtRight","newMin","closeLid","trashcanOpen","uiEvent","cleanedJson","cleanBlockJson_","HAS_BLOCKS_LID_ANGLE","cleanRec","ToolboxItemSelect","opt_oldItem","opt_newItem","oldItem","newItem","ToolboxItem","toolboxItemDef","parentToolbox","level_","parent_","getLevel","toolboxItemDef_","parentToolbox_","getClickTarget","isSelectable","isCollapsible","setVisible_","_isVisible","ToolboxCategory","categoryDef","labelDom_","iconDom_","rowContents_","rowDiv_","htmlDiv_","isDisabled_","isHidden_","flyoutItems_","cssConfig_","makeDefaultCssConfig_","parseCategoryDef_","parseContents_","createDom_","flyoutItem","getColour_","createContainer_","LEVEL","createRowContainer_","pointerEvents","createRowContentsContainer_","createIconDom_","createLabelDom_","LABELLEDBY","addColourBorder_","rowDiv","nestedPadding","paddingRight","paddingLeft","contentsContainer","toolboxIcon","isHorizontal","toolboxLabel","refreshTheme","border","borderWidth","borderRight","borderLeft","styleName","getColourfromStyle_","parseColour_","colourValue","openIcon_","iconDiv","closedIconClass","closeIcon_","openIconClass","getSelectedItem","clearSelection","allAncestorsExpanded_","category","isExpanded","onClick","isSelected","defaultColour","defaultBackgroundColour","setDisabled","isDisabled","getContents","updateFlyoutContents","newDefinition","kind","custom","categorystyle","cssconfig","hidden","ToolboxSeparator","separatorDef","CollapsibleToolboxCategory","subcategoriesDiv_","expanded_","toolboxItems_","cssConfig","prevIsFlyoutItem","itemDef","createToolboxItem_","registryName","toolboxItem","setExpanded","subCategories","getChildToolboxItems","createSubCategoriesDom_","subcategories","newCategory","newCategoryDiv","EXPANDED","handleToolboxItemResize","childToolboxItems","toggleExpanded","Toolbox","contentsDiv_","HtmlDiv","isVisible_","previouslySelectedItem_","selectedItem_","flyout_","boundEvents_","toolboxDef_","horizontalLayout_","contentMap_","createFlyout_","themeManager","createContentsContainer_","attachEvents_","toolboxContainer","flexDirection","clickEvent","onClick_","keyDownEvent","onKeyDown_","itemId","getToolboxItemById","setSelectedItem","handled","selectNext_","selectPrevious_","selectParent_","selectChild_","untypedItem","renderContents_","fragment","createDocumentFragment","ToolboxItemClass","addToolboxItem_","toolboxItemDom","getToolboxItems","addStyle","removeStyle","toolboxRect","BIG_NUM","_couldConnect","updateCursorDeleteStyle_","getPreviouslySelectedItem","workspaceMetrics","toolboxDiv","childAsCategory","refreshSelection","autoClose","shouldDeselectItem_","deselectItem_","shouldSelectItem_","selectItem_","updateFlyout_","fireSelectEvent_","selectItemByPosition","oldElement","collapsibleItem","nextItemIdx","nextItem","prevItemIdx","prevItem","Zelos","ClickTarget","Click","opt_targetType","targetType","ZOOM_CONTROLS","BubbleDragger","dragTarget_","wouldDeleteBubble_","startXY_","dragSurface_","startBubbleDrag","dragBubble","currentDragDeltaXY","pixelsToWorkspaceUnits_","oldDragTarget","getDragTarget","oldWouldDeleteBubble","shouldDelete_","updateCursorDuringBubbleDrag_","dragTarget","endBubbleDrag","fireMoveEvent_","setOldCoordinate","pixelCoord","WorkspaceDragger","horizontalScrollEnabled_","isMovableHorizontally","verticalScrollEnabled_","isMovableVertically","startScrollXY_","endDrag","scroll","creatorWorkspace","mouseDownXY_","startWorkspace_","targetBlock_","startBlock_","startField_","startBubble_","hasExceededDragRadius_","workspaceDragger_","blockDragger_","bubbleDragger_","onUpWrapper_","onMoveWrapper_","isMultiTouch_","isEnding_","hasStarted_","calledUpdateIsDragging_","cachedPoints","startDistance_","previousScale_","currentDropdownOwner","isPinchZoomEnabled_","onStartWrapper_","mostRecentEvent_","currentDragDeltaXY_","healStack_","clearGesture","updateFromEvent_","currentXY","updateDragDelta_","updateIsDragging_","updateIsDraggingFromFlyout_","isBlockCreatable","isScrollable","isDragTowardWorkspace","updateScreenCalculationsIfScrolled","createBlock","updateIsDraggingBubble_","startDraggingBubble_","updateIsDraggingBlock_","startDraggingBlock_","updateIsDraggingWorkspace_","isDraggable","doStart","cancel","pointerType","handleTouchStart","handleMove","handleUp","isMultiTouch","handleTouchMove","handleTouchEnd","log","isBubbleClick_","doBubbleClick_","isFieldClick_","doFieldClick_","isBlockClick_","doBlockClick_","isWorkspaceClick_","doWorkspaceClick_","getTouchPoint","pointers","point0","point1","handlePinch_","gestureScale","bringBlockToFront_","handleWsStart","setStartWorkspace_","fireWorkspaceClick_","handleFlyoutStart","setStartFlyout_","setStartBlock","setStartBubble","setTargetBlock_","hasStarted","getInsertionMarkers","getCurrentDragger","currentGesture_","shortcuts","keyMap","shortcut","addKeyMapping","allowCollision","shortcutName","removeAllKeyMappings","opt_allowCollision","shortcutNames","removeKeyMapping","shortcutIdx","setKeyMap","newKeyMap","getKeyMap","legacyKeyMap","getRegistry","legacyRegistry","serializeKeyEvent_","getShortcutNamesByKeyCode","getKeyCodesByShortcutName","serializedKey","modifier","modifierKeys","getModifierState","checkModifiers_","modifiers","Shift","Control","Alt","Meta","ThemeChange","opt_themeName","themeName","ViewportChange","opt_top","opt_left","opt_scale","opt_oldScale","ConnectionDB","connections_","yPos","calculateIndexForYPos_","findIndexOfConnection_","bestGuess","pointer","pointerMin","pointerMax","pointerMid","maxRadius","checkConnection_","yIndex","currentX","db","currentY","isInYRange_","baseY","baseX","closestIndex","bestConnection","bestRadius","dbList","pattern","line2","line1","getPatternId","update","safeSpacing","end","setLineAttributes","x1","x2","y1","y2","reservedWordsList","opt_variablePrefix","dbReverse","variableMap_","variablePrefix_","reservedWords","setVariableMap","getNameForUserVariable_","populateVariables","NameType","VARIABLE","nameOrId","normalizedName","DEVELOPER_VARIABLE","typeDb","safeName","getDistinctName","getUserNames","userNames","safeName_","encodeURI","name1","name2","PROCEDURE","DEVELOPER_VARIABLE_TYPE","ObservableProcedureMap","existed","getProcedures","ObservableProcedureModel","shouldFireEvents","setName","prevName","parameterModel","setProcedureModel","deleteParameter","oldParam","oldReturnTypes","getParameter","getEnabled","ObservableParameterModel","oldName","_types","getVariableModel","getDefinition","mutateCallers","defBlock","oldRecordUndo","caller","oldMutation","oldMutationDom","newMutationDom","newMutation","rename","legalName","renameProcedure","Types","NONE","HAT","ICON","SPACER","BETWEEN_ROW_SPACER","IN_ROW_SPACER","EXTERNAL_VALUE_INPUT","INLINE_INPUT","STATEMENT_INPUT","CONNECTION","PREVIOUS_CONNECTION","NEXT_CONNECTION","OUTPUT_CONNECTION","CORNER","LEFT_SQUARE_CORNER","LEFT_ROUND_CORNER","RIGHT_SQUARE_CORNER","RIGHT_ROUND_CORNER","JAGGED_EDGE","TOP_ROW","BOTTOM_ROW","INPUT_ROW","LEFT_CORNER","RIGHT_CORNER","nextTypeValue_","hasOwnProperty","isField","isHat","isIcon","isSpacer","isInRowSpacer","isInput","isExternalInput","isInlineInput","isStatementInput","isPreviousConnection","isNextConnection","isPreviousOrNextConnection","isLeftRoundedCorner","isRightRoundedCorner","isLeftSquareCorner","isRightSquareCorner","isCorner","isJaggedEdge","isRow","row","isBetweenRowSpacer","isTopRow","isBottomRow","isTopOrBottomRow","isInputRow","Measurable","centerline","xPos","notchOffset","Row","widthWithConnectedBlocks","minWidth","minHeight","hasStatement","hasExternalInput","statementEdge","hasJaggedEdge","hasDummyInput","hasInlineInput","getLastInput","measure","startsWithElemSpacer","endsWithElemSpacer","getFirstSpacer","getLastSpacer","BottomRow","hasNextConnection","descenderHeight","hasLeftSquareCorner","hasRightSquareCorner","_block","connectionModel","InputConnection","connectionOffsetY","connectionOffsetX","connectedBlock","connectedBlockWidth","connectedBlockHeight","ExternalValueInput","MEDIUM_PADDING","EXTERNAL_VALUE_INPUT_PADDING","connectionHeight","connectionWidth","flipRtl","Hat","START_HAT","ascenderHeight","InRowSpacer","SPACER_DEFAULT_HEIGHT","InlineInput","EMPTY_INLINE_INPUT_HEIGHT","EMPTY_INLINE_INPUT_PADDING","StatementInput","STATEMENT_BOTTOM_SPACER","EMPTY_STATEMENT_INPUT_HEIGHT","STATEMENT_INPUT_NOTCH_OFFSET","InputRow","connectedBlockWidths","JaggedEdge","JAGGED_TEETH","NextConnection","OutputConnection","startX","PreviousConnection","RoundCorner","opt_position","SpacerRow","precedesStatement","followsStatement","SquareCorner","NO_PADDING","TopRow","capline","hasPreviousConnection","hasHat","ADD_START_HATS","ConstantProvider","SMALL_PADDING","MEDIUM_LARGE_PADDING","LARGE_PADDING","TAB_HEIGHT","TAB_VERTICAL_OVERLAP","TAB_WIDTH","NOTCH_WIDTH","MIN_BLOCK_WIDTH","EMPTY_BLOCK_SPACER_HEIGHT","STATEMENT_INPUT_PADDING_LEFT","BETWEEN_STATEMENT_PADDING_Y","START_HAT_HEIGHT","START_HAT_WIDTH","JAGGED_TEETH_HEIGHT","JAGGED_TEETH_WIDTH","FIELD_BORDER_RECT_Y_PADDING","FIELD_BORDER_RECT_COLOUR","FIELD_COLOUR_FULL_BLOCK","FIELD_TEXTINPUT_BOX_SHADOW","FIELD_COLOUR_DEFAULT_WIDTH","defs_","embossFilter_","disabledPatternId","disabledPattern_","debugFilterId","cssNode_","debugFilter_","CURSOR_COLOUR","MARKER_COLOUR","CURSOR_WS_WIDTH","WS_CURSOR_HEIGHT","CURSOR_STACK_PADDING","CURSOR_BLOCK_PADDING","CURSOR_STROKE_WIDTH","FULL_BLOCK_FIELDS","INSERTION_MARKER_OPACITY","SHAPES","PUZZLE","NOTCH","TALL_INPUT_FIELD_OFFSET_Y","DUMMY_INPUT_SHADOW_MIN_HEIGHT","DUMMY_INPUT_MIN_HEIGHT","TOP_ROW_MIN_HEIGHT","TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT","BOTTOM_ROW_MIN_HEIGHT","BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT","START_POINT","FIELD_COLOUR_DEFAULT_HEIGHT","FIELD_CHECKBOX_X_OFFSET","randomIdentifier","makeJaggedTeeth","makeNotch","makeStartHat","PUZZLE_TAB","makePuzzleTab","INSIDE_CORNERS","makeInsideCorners","OUTSIDE_CORNERS","makeOutsideCorners","setTheme","validatedBlockStyle_","setDynamicProperties_","setFontConstants_","setComponentConstants_","fontMetrics","createBlockStyle_","valid","parsedColour","generateSecondaryColour_","generateTertiaryColour_","inputColour","path","makeMainPath","up","back","control1Y","overlap","control2Y","endPoint1","endPoint2","pathUp","dir","outerWidth","innerWidth","pathRight","pathTop","pathBottom","topLeft","topRight","bottomLeft","bottomRight","rightHeight","selector","injectCSS_","embossFilter","feSpecularLighting","disabledPattern","createDebugFilter","debugFilter","debugComponentTransfer","cssArray","getCSS_","cssNodeId","useDebugger","startDebugger","Debug","debugElements_","svgRoot_","randomColour_","clearElems","drawSpacerRow","cursorY","rowSpacers","isNegativeSpacing","drawSpacerElem","rowHeight","elemSpacers","drawRenderedElem","elems","drawConnection","drawRenderedRow","rows","connectedBlockBounds","drawRowWithElements","drawBoundingBox","widthWithChildren","drawDebug","rightSide","drawRender","Drawer","inlinePath_","outlinePath_","info_","topLeft_","hideHiddenIcons_","drawOutline_","drawInternals_","setPath","flipRTL","recordSizeOnBlock_","iconInfo","hiddenIcons","drawTop_","drawJaggedEdge_","drawStatementInput_","drawValueInput_","drawRightSideRow_","drawBottom_","drawLeft_","topRow","positionPreviousConnection_","startY","positionExternalValueConnection_","innerTopLeftCorner","innerHeight","positionStatementInputConnection_","bottomRow","positionNextConnection_","rightCornerYOffset","outlinePath","positionOutputConnection_","tabBottom","drawInlineInput_","layoutField_","fieldInfo","connectionTop","connectionBottom","positionInlineInputConnection_","connX","connInfo","RenderInfo","inputRows","renderer_","isInline","createRows_","addElemSpacing_","addRowSpacing_","computeBounds_","alignRowElements_","finalize_","populateTopRow_","activeRow","lastInput","shouldStartNewRow_","addInput_","populateBottomRow_","hasPrevious","cornerClass","oldElems","getInRowSpacing_","widestStatementRowFields","blockWidth","widestRowWithConnectedBlocks","statementInput","alignStatementRow_","currentWidth","missingSpace","getDesiredRowWidth_","addAlignmentPadding_","_row","firstSpacer","lastSpacer","desiredWidth","oldRows","makeSpacerRow_","getSpacerRowHeight_","getSpacerRowWidth_","spacer","_prev","_next","getElemCenterline_","recordElemPositions_","xCursor","yCursor","MarkerMove","isCursor","opt_oldNode","opt_newNode","MarkerSvg","markerSvgRect_","markerSvgLine_","markerInput_","markerBlock_","currentMarkerSvg","createDomInternal_","setParent_","applyColour_","showAtLocation_","fireMarkerEvent_","beginElement","connectionType","showWithBlock_","showWithOutput_","showWithInput_","showWithNext_","showWithPrevious_","showWithField_","showWithCoordinates_","showWithStack_","showWithBlockPrevOutput_","markerHeight","markerOffset","connectionShape","positionPrevious_","positionOutput_","positionBlock_","showCurrent_","positionLine_","positionRect_","positionInput_","heightWidth","yPadding","markerPath","flipRtl_","curBlock","getBlinkProperties_","blinkProperties","attributeName","_curNode","firstElementChild","PathObject","pathString","updateShadow_","updateDisabled_","setClass_","_conn","InsertionMarkerManager","activeCandidate","lastMarker","lastOnStack","wouldDeleteBlock","fadedBlock","highlightedBlock","markerConnection","firstMarker","createMarkerBlock","availableConnections","initAvailableConnections","updateAvailableConnections","wouldConnectBlock","applyConnections","hidePreview","local","inferiorConnection","newCandidate","getCandidate","shouldDelete","shouldUpdatePreviews","maybeHidePreview","maybeShowPreview","imType","sourceInput","resultInput","sourceField","resultField","available","activeLocal","activeClosest","getStartRadius","candidate","myConnection","showPreview","getConnectionPreviewMethod","PREVIEW_TYPE","INPUT_OUTLINE","showInsertionInputOutline","INSERTION_MARKER","showInsertionMarker","REPLACEMENT_FADE","showReplacementFade","shouldHighlightConnection","localChanged","hideReplacementFade","hideInsertionInputOutline","hideInsertionMarker","imConn","isLastInStack","markerConn","imBlock","markerPrev","markerOutput","isNext","isFirstInOutputStack","innerConnection","previousBlockNextConnection","PreviewType","Renderer","overrides","makeConstants_","refreshDom","previousConstants","makeRenderInfo_","makeDrawer_","makeDebugger_","orphanCanConnectAtEnd","localType","ThemeManager","subscribedWorkspaces_","componentDB","prevTheme","oldClassName","newClassName","componentList","propertyName","subscribeWorkspace","unsubscribeWorkspace","owner_","onCreateVariableButtonClick_Colour","onCreateVariableButtonClick_Number","onCreateVariableButtonClick_String","ConnectionChecker","opt_distance","safety","doSafetyChecks","doTypeChecks","doDragChecks","errorCode","superiorBlock","inferiorBlock","superiorConnection","checkArrayOne","checkArrayTwo","canConnectToPrevious_","VarDelete","VarRename","VariableMap","variableMap","conflictVar","renameVariableWithConflict_","renameVariableAndUses_","deleteVariable","variableId","variableName","uses","getVariableUsesById","procedureName","deleteText","confirmText","deleteVariableInternal","list","getVariableTypes","variableTypes","flat","Workspace","internalIsFlyout","MAX_UNDO","topComments","commentDB","listeners","undoStack_","redoStack_","blockDB","typedBlocksDB","procedureMap","sortObjects_","aXY","bXY","SCAN_ANGLE","remainingCapacity","remainingCapacityOfType","copyableBlocksCount","redo","inputStack","outputStack","inputEvent","clearUndo","createPotentialVariableMap","getById","getAll","WorkspaceAudio","sounds","lastSound_","filenames","audioTest","filename","ext","canPlayType","sound","volume","playPromise","then","pause","catch","opt_volume","now","mySound","ZoomControls","zoomResetGroup","zoomOutGroup","zoomInGroup","onZoomOutWrapper","onZoomInWrapper","onZoomResetWrapper","HEIGHT","SMALL_SPACING","LARGE_SPACING","initialized","createZoomOutSvg","createZoomInSvg","createZoomResetSvg","zoomInTranslateY","zoomOutTranslateY","zoomoutSvg","zoominSvg","amount","zoomCenter","fireZoomEvent","zoomresetSvg","resetZoom","beginCanvasTransition","scrollCenter","endCanvasTransition","opt_blockDragSurface","opt_wsDragSurface","resizeHandlerWrapper","resizesEnabled","startScrollY","startScrollX","dragDeltaXY","oldLeft","oldTop","toolbox_","isDragSurfaceActive","inverseScreenCTM","configureContextMenu","lastRecordedPageScroll","inverseScreenCTMDirty","highlightedBlocks","toolboxCategoryCallbacks","flyoutButtonCallbacks","cachedParentSvg","topBoundedElements","dragTargetAreas","setTopLevelWorkspaceMetrics_","componentManager","useWorkspaceDragSurface","audioManager","markerManager","Variables","registerToolboxCategoryCallback","Procedures","themeManager_","cachedParentSvgSize","getMarkerManager","setMetricsManager","updateBlockStyles_","refreshToolboxSelection","ctm","opt_backgroundClass","svgBackground_","svgBubbleCanvas_","onMouseWheel_","CursorClass","parentSvg","newTrashcan","svgTrashcan","_workspace","svgZoomControls","opt_own","updateScreenCalculations_","positionables","getUiMetrics","positionable","currScroll","maybeFireViewportChangeEvent","translation","translateAndScaleGroup","trans","previousElement","previousSibling","coord","setContentsAndShow","imList","highlightBlock","opt_state","pasteBlock_","pasteWorkspaceComment_","jsonBlock","collide","allBlocks","otherXY","dragTargets","targetArea","clientRect","canWheelZoom","canWheelMove","scrollDelta","commandKey","PIXELS_PER_ZOOM_STEP","topElements","boundary","topElement","blockBoundary","setBrowserFocus","activeElement","setActive","scaleChange","newScale","getCTM","center","f","setScale","svgWidth","svgHeight","zoomToFit","blocksBox","blocksWidth","blocksHeight","ratioX","ratioY","centerOnBlock","pixelX","pixelY","reflow","resizeView","resizeContent","getScale","maxYScroll","addTopBoundedElement","removeTopBoundedElement","reenabled","getButtonCallback","removeButtonCallback","getToolboxCategoryCallback","removeToolboxCategoryCallback","isStart","opt_onlyClosePopups","autoHideable","xyRatio","serializerMap","deserializers","deserializer","VariableSerializer","variableStates","varState","ProcedureSerializer","procState","observableProcedureSerializer","exceptions","priorities","procedures","GRID_UNIT","CURSOR_RADIUS","HEXAGONAL","ROUND","SQUARE","SHAPE_IN_SHAPE_PADDING","SELECTED_GLOW_COLOUR","SELECTED_GLOW_SIZE","REPLACEMENT_GLOW_COLOUR","REPLACEMENT_GLOW_SIZE","selectedGlowFilterId","selectedGlowFilter_","replacementGlowFilterId","SQUARED","ROUNDED","replacementGlowFilter_","STATEMENT_INPUT_SPACER_MIN_WIDTH","MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH","makeHexagonal","makeRounded","makeSquared","rightWidth","selectedGlowSize","replacementGlowSize","pathRightDown","pathRightUp","blockHeight","remainingHeight","maxHeight","_height","curveWidth","quarterHeight","innerTopRightCorner","pathTopRight","pathBottomRight","selectedGlowFilter","selectedComponentTransfer","replacementGlowFilter","replacementComponentTransfer","beginDrawing","outputShapeType","endDrawing","hasStatementInput","drawFlatTop_","drawRightDynamicConnection_","drawFlatBottom_","drawLeftDynamicConnection_","cornerHeight","setOutlinePath","innerBottomLeftCorner","connectedBottomNextConnection","FieldImage","opt_alt","opt_onClick","opt_flipRtl","clickHandler_","altText_","Y_PADDING","imageHeight_","setAlt","setOnClickHandler","FieldInput","spellcheck_","htmlInput_","isTextValid_","isBeingEdited_","onKeyInputWrapper_","onKeyDownWrapper_","fullBlockClickTarget_","spellcheck","nFields","nConnections","resizeEditor_","htmlInput","INVALID","setSpellcheck","_opt_e","opt_quietInput","quietInput","showPromptEditor_","showInlineEditor_","getValueFromEditorText_","widgetDispose_","widgetCreate_","borderRadius","BORDERRADIUS","strokeColour","boxShadow","getEditorText_","bindInputEvents_","onFinishEditing_","unbindInputEvents_","_value","onHtmlInputKeyDown_","onHtmlInputChange_","setEditorValue_","FieldTextInput","RightConnectionShape","isMultiRow","rightAlignedDummyInputs_","WeakMap","adjustXPosition_","alignmentDivider","notchTotalWidth","minXPos","prevSpacer","nextSpacer","hasPrevNotch","hasNextNotch","prevInRowSpacer","finalizeOutputConnection_","outputConnectionShape","rightConnectionWidth","finalizeHorizontalAlignment_","totalNegativeSpacing","lastElem","leftNegPadding","getNegativeSpacing_","rightNegPadding","minBlockWidth","outerShape","innerShape","finalizeVerticalAlignment_","firstRow","hasSingleTextOrImageField","hasNonShadowConnectedBlocks","minVerticalTightNestingHeight","markerCircle_","showWithInputOutput_","offsetInBlock","positionCircle_","svgPathSelected_","outlines","remainingOutlines","outline","getOutlinePath_","removeOutlinePath_","hasExternalInputs","heightWithoutHat","diff","DARK_PATH_OFFSET","MAX_BOTTOM_WIDTH","Highlighter","inlineSteps_","steps_","RTL_","highlightConstants_","getHighlightConstants","highlightOffset_","OFFSET","outsideCornerPaths_","OUTSIDE_CORNER","insideCornerPaths_","INSIDE_CORNER","puzzleTabPaths_","notchPaths_","startPaths_","jaggedTeethPaths_","getPath","drawTopCorner","drawValueInput","belowTabHeight","drawStatementInput","drawRightSideRow","rightEdge","drawBottomRow","cornerElem","drawLeft","drawInlineInput","connectionRight","bottomHighlightWidth","aboveTabHeight","highlighter_","setHighlightPath","HighlightConstantProvider","constantProvider","makeInsideCorner","makeOutsideCorner","distance45outside","SQRT1_2","pathTopRtl","pathBottomRtl","pathBottomLtr","distance45inside","topLeftCornerHighlightRtl","topLeftCornerHighlightLtr","bottomLeftStartY","bottomLeftPath","highlightRtlUp","highlightRtlDown","verticalOverlap","highlightLtrUp","highlightLtrDown","hatHeight","pathRtl","pathLtr","nextRightEdge","rowNextRightEdges","prevInput","prevRightEdge","colourDark","svgPathDark","svgPathLight","mainPath","makeHighlightConstants_","fixedX","fixedY","newSurface","blockCanvas","bubbleCanvas","surfaceXY","childSurfaceXY","dragGroup","roundX","roundY","translateSurfaceInternal_","translateBy","getWsTranslation","opt_newSurface","currentBlockElement","bumpIntoBounds","addHorizontal","addVertical","oldHostMetrics_","corner_","vScroll","hScroll","isPair","resizeH","resizeV","setX","setY","CodeGenerator","FUNCTION_NAME_PLACEHOLDER_","STATEMENT_SUFFIX","STATEMENT_PREFIX","INFINITE_LOOP_TRAP","INDENT","COMMENT_WRAP","ORDER_OVERRIDES","isInitialized","RESERVED_WORDS_","definitions_","functionNames_","nameDB_","FUNCTION_NAME_PLACEHOLDER_REGEXP_","RegExp","workspaceToCode","code","blockToCode","scrubNakedValue","injectId","codeString","finish","prefixLines","allNestedComments","opt_thisOnly","scrub_","SyntaxError","valueToCode","outerOrder","innerOrder","parensNeeded","outerOrderClass","innerOrderClass","statementToCode","addLoopTrap","branch","addReservedWords","provideFunction_","desiredName","functionName","oldCodeText","codeText","_opt_thisOnly","defineProperties","variableDB_","nameDb","FlyoutButton","isLabel_","svgText_","text_","callbackKey_","cssClass_","svgText","TEXT_MARGIN_X","TEXT_MARGIN_Y","updateTransform_","onMouseUp_","isLabel","getButtonText","MetricsManager","getDimensionsPx_","getFlyoutMetrics","flyoutDimensions","getToolboxMetrics","toolboxDimensions","getSvgMetrics","getAbsoluteMetrics","flyoutMetrics","doesToolboxExist","doesFlyoutExist","atLeft","atTop","opt_getWorkspaceCoordinates","svgMetrics","getContentMetrics","blockBox","getComputedFixedEdges_","opt_viewMetrics","hScrollEnabled","vScrollEnabled","edges","getPaddedContent_","contentMetrics","contentBottom","contentRight","halfWidth","opt_contentMetrics","fixedEdges","paddedContent","contentHeight","contentTop","contentLeft","toolboxWidth","toolboxHeight","flyoutWidth","flyoutHeight","FlyoutItemType","FlyoutMetricsManager","getBoundingBox_","blockBoundingBox","BUTTON","Flyout","eventWrappers_","filterWrapper_","reflowWrapper_","mats_","buttons_","listeners_","permanentlyDisabled_","recycledBlocks_","containerVisible_","SCROLLBAR_MARGIN","dragAngleRange_","setMetrics_","toolboxPosition_","tabWidth_","rectMap_","GAP_X","GAP_Y","wheel_","filterForCapacity_","getFlyoutScale","positionAt_","listen","clearOldBlocks_","getDynamicCategoryContents_","parsedContent","flyoutInfo","createFlyoutInfo_","layout_","gaps","deselectAll","emptyRecycledBlocks_","defaultGap","contentInfo","categoryName","parsedDynamicContent","blockInfo","createFlyoutBlock_","addBlockGap_","addSeparatorGap_","createButton_","fnToApply","btnInfo","getRecycledBlock_","blockType","gap","sepInfo","newGap","oldBlocks","blockIsRecyclable_","recycleBlock_","addBlockListeners_","blockMouseDown_","originalBlock","placeNewBlock_","initFlyoutButton_","buttonSvg","createRect_","blockHW","moveRectToBlock_","reflowInternal_","oldBlock","positionNewBlock_","flyoutOffsetPixels","oldBlockPos","oldBlockOffsetPixels","VerticalFlyout","getX","getY","targetWorkspaceViewMetrics","setBackgroundPath_","atRight","cursorX","moveX","dragDirection","atan2","range","flyoutRect","oldX","newX","HorizontalFlyout","buttons","FieldVariable","opt_variableTypes","opt_defaultType","defaultType_","variable_","dropdownCreate","defaultVariableName","setTypes_","defaultType","variableType","typeIsAllowed_","typeList","getVariableTypes_","isInArray","FieldNumber","opt_min","opt_max","opt_precision","min_","max_","precision_","decimalPlaces_","setConstraints","setMinInternal_","setMaxInternal_","setPrecisionInternal_","precision","setMin","getMin","setMax","getMax","setPrecision","precisionString","toLocaleString","maximumFractionDigits","decimalIndex","getPrecision","isFinite","toFixed","VALUEMIN","VALUEMAX","FieldMultilineInput","textGroup_","maxLines_","isOverflowedY_","maxLines","setMaxLines","textLines","displayLinesNumber","currentChild","lineHeight","nodes","actualEditorLines","dummyTextElement","lineWidth","paddingX","paddingY","padding","getMaxLines","FieldLabelSerializable","FieldColour","onMouseLeaveWrapper_","onMouseEnterWrapper_","onClickWrapper_","highlightedIndex_","picker_","titles_","colours_","columns_","colourOptions","colourTitles","columns","setColours","colours","opt_titles","setColumns","cell","moveHighlightBy_","getHighlighted_","COLOURS","COLUMNS","setHighlightedCell_","onMouseMove_","onMouseEnter_","onMouseLeave_","titles","TITLES","selectedColour","table","ROWCOUNT","COLCOUNT","title","FieldCheckbox","checkChar_","CHECK_CHAR","checkCharacter","getValueBoolean","setCheckCharacter","character","convertValueToBool_","Mode","FieldAngle","clockwise_","CLOCKWISE","offset_","wrap_","WRAP","round_","moveSurfaceWrapper_","clickSurfaceWrapper_","clickWrapper_","symbol_","line_","gauge_","editor_","mode","COMPASS","PROTRACTOR","clockwise","updateGraph_","HALF","circle","RADIUS","hide_","ownerSVGElement","displayMouseOrKeyboardValue_","wrapValue_","clockwiseFlag","angle1","largeFlag","multiplier","BlockMove","currentLocation_","oldParentId","parentId","oldInputName","oldCoordinate","coordinate","blockConnection","CommentBase","opt_comment","CommentCreateDeleteHelper","CommentChange","opt_oldContents","opt_newContents","oldContents_","newContents_","CommentCreate","CommentDelete","CommentMove","comment_","oldCoordinate_","newCoordinate_","ProcedureBase","ProcedureChangeReturn","workpace","oldTypes","newTypes","ProcedureCreate","ProcedureDelete","ProcedureEnable","newState","ProcedureRename","ProcedureParameterBase","parameter","ProcedureParameterCreate","procedure","parameterMatches","ProcedureParameterDelete","ProcedureParameterRename","BlockDrag","opt_isStart","opt_blocks","Ui","FinishedLoading","opt_workspace","BlockDragger","wouldDeleteBlock_","draggingBlock_","draggedConnectionManager_","dragIconData_","initIconData","dragIconData","fireDragStartEvent_","shouldDisconnect_","disconnectBlock_","dragIcons_","oldWouldDeleteBlock","updateCursorDuringBlockDrag_","fireDragEndEvent_","newValues","getNewLocationAfterDrag_","newLocation","maybeDeleteBlock_","updateBlockAfterMove_","updateToolboxStyle_","isEnd","ALIGN_LEFT","ALIGN_CENTRE","ALIGN_RIGHT","DUMMY_INPUT","TOOLBOX_AT_TOP","TOOLBOX_AT_BOTTOM","TOOLBOX_AT_LEFT","TOOLBOX_AT_RIGHT","Workspace.prototype.newBlock","WorkspaceSvg.prototype.newBlock","WorkspaceSvg.newTrashcan","WorkspaceCommentSvg.prototype.showContextMenu","Mutator.prototype.newWorkspaceSvg","Names.prototype.populateProcedures","flattenedProcedures","DropDownDiv","connectionTypes","ContextMenu","ContextMenuItems","Css","Events","Extensions","PROCEDURE_CATEGORY_NAME","ShortcutItems","Themes","Tooltip","Touch","VARIABLE_CATEGORY_NAME","VARIABLE_DYNAMIC_CATEGORY_NAME","VERSION","VariablesDynamic","WidgetDiv","Xml","bindEventWithChecks_","_opt_noPreventDefault","bindEvent_","blockAnimations","blockRendering","bumpObjects","clipboard","common","dialog","fieldRegistry","geras","minimalist","serialization","thrasos","uiPosition","unbindEvent_","utils","zelos","Blockly","newAlert","newConfirm","newPrompt","HSV_SATURATION","HSV_VALUE","eventUtils","record","DIV","CUSTOM_CONTEXT_MENU_VARIABLE_GETTER_SETTER_MIXIN","renameOption","renameOptionCallbackFactory","deleteOptionCallbackFactory","oppositeType","contextMenuMsg","xmlField","xmlUtils","updateAt_","isAt1","isAt2","isAt","newAt","OPERATORS","TEXT_PROMPT_COMMON","updateType_","newOp","TYPES","thisBlock","QUOTE_IMAGE_MIXIN","newQuote_","QUOTE_IMAGE_LEFT_DATAURI","QUOTE_IMAGE_RIGHT_DATAURI","QUOTE_IMAGE_WIDTH","QUOTE_IMAGE_HEIGHT","quoteField_","isLeft","TEXT_JOIN_MUTATOR_MIXIN","itemCount_","updateShape_","containerBlock","itemBlock","valueConnection_","TEXT_INDEXOF_TOOLTIP_EXTENSION","TEXT_CHARAT_MUTATOR_MIXIN","isAt_","TEXT_QUOTES_EXTENSION","TEXT_JOIN_EXTENSION","TEXT_CHARAT_EXTENSION","where","PROCEDURE_DEF_COMMON","setStatements_","hasStatements","hasStatements_","updateParams_","paramString","arguments_","opt_paramIds","argumentVarModels_","argModel","paramIds_","childNode","containerBlockNode","statementNode","argBlockNode","fieldNode","argumentName","paramBlock","statementConnection_","stackConnection","stackBlock","oldVariable","change","displayRenamedVar_","xmlMutation","xmlArg","callType_","argOption","argVar","argXmlField","argXmlBlock","initName","oldShowEditorFn_","newShowEditorFn","createdVariables_","deleteIntermediateVars_","otherVar","PROCEDURE_CALL_COMMON","setProcedureParameters_","paramNames","paramIds","mutatorOpen","quarkConnections_","quarkIds_","quarkId","argField","newField","def","defType_","callName","previousEnabledState_","option.callback","hasReturnValue_","legal","FUNCTION_TYPES","IS_DIVISIBLEBY_MUTATOR_MIXIN","divisorInput","inputExists","IS_DIVISIBLE_MUTATOR_EXTENSION","LIST_MODES_MUTATOR_MIXIN","LIST_MODES_MUTATOR_EXTENSION","CUSTOM_CONTEXT_MENU_CREATE_VARIABLES_GET_MIXIN","loopTypes","CONTROL_FLOW_IN_LOOP_CHECK_MIXIN","getSurroundLoop","CONTROLS_IF_MUTATOR_MIXIN","elseifCount_","elseCount_","rebuildShape_","elseifBlock","elseBlock","clauseBlock","valueConnections","statementConnections","elseStatementConnection","reconnectChildBlocks_","inputIf","inputDo","CONTROLS_IF_TOOLTIP_EXTENSION","LOGIC_COMPARE_ONCHANGE_MIXIN","prevBlocks_","blockA","blockB","prevA","prevB","LOGIC_COMPARE_EXTENSION","LOGIC_TERNARY_ONCHANGE_MIXIN","prevParentConnection_","MODE","WHERE_OPTIONS","modeMenu","isStatement","updateStatement_","newStatement","newMode","inputConnection","inputBlock","lists","logic","loops","texts","variablesDynamic","moduleExports","JavaScript","getOwnPropertyNames","ORDER_ATOMIC","ORDER_NEW","ORDER_MEMBER","ORDER_FUNCTION_CALL","ORDER_INCREMENT","ORDER_DECREMENT","ORDER_BITWISE_NOT","ORDER_UNARY_PLUS","ORDER_UNARY_NEGATION","ORDER_LOGICAL_NOT","ORDER_TYPEOF","ORDER_VOID","ORDER_DELETE","ORDER_AWAIT","ORDER_EXPONENTIATION","ORDER_MULTIPLICATION","ORDER_DIVISION","ORDER_MODULUS","ORDER_SUBTRACTION","ORDER_ADDITION","ORDER_BITWISE_SHIFT","ORDER_RELATIONAL","ORDER_IN","ORDER_INSTANCEOF","ORDER_EQUALITY","ORDER_BITWISE_AND","ORDER_BITWISE_XOR","ORDER_BITWISE_OR","ORDER_LOGICAL_AND","ORDER_LOGICAL_OR","ORDER_CONDITIONAL","ORDER_ASSIGNMENT","ORDER_YIELD","ORDER_COMMA","ORDER_NONE","JavaScript.init","getPrototypeOf","defvars","devVarList","JavaScript.finish","definitions","JavaScript.scrubNakedValue","quote_","JavaScript.quote_","multiline_quote_","JavaScript.multiline_quote_","JavaScript.scrub_","commentCode","nextCode","getAdjusted","JavaScript.getAdjusted","atId","opt_delta","opt_negate","opt_order","order","defaultAtIndex","at","argument0","strRegExp","forceString","getSubstringIndex","stringName","opt_at","codeAndOrder","element0","element1","operator","where1","where2","requiresLengthCall","at1","at2","wherePascalCase","sub","to","funcName","xfix1","loopTrap","returnValue","xfix2","argument1","CONSTANTS","PROPERTIES","dropdownProperty","inputOrder","outputOrder","numberToCheck","divisor","argument2","repeats","loopVar","endVar","until","variable0","increment","step","startVar","incVar","listVar","indexVar","xfix","loop","conditionCode","branchCode","defaultArgument","value_else","repeatCount","cacheList","xVar","listName","delimiter","c1","c2","BlocklyController","blocklyDiv","main","injectBlockly"],"mappings":"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","file":"main.4de6506a.js","sourceRoot":"../src","sourcesContent":["/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview The entrypoint for blockly_compressed.js.  Provides\n *     various backwards-compatibility hacks.  Not used when loading\n *     in uncompiled (uncompressed) mode via bootstrap.js.\n */\n'use strict';\n\ngoog.module('Blockly.main');\n\nconst Blockly = goog.require('Blockly');\nconst ContextMenu = goog.require('Blockly.ContextMenu');\nconst Events = goog.require('Blockly.Events');\nconst Msg = goog.require('Blockly.Msg');\nconst Tooltip = goog.require('Blockly.Tooltip');\nconst WidgetDiv = goog.require('Blockly.WidgetDiv');\nconst colour = goog.require('Blockly.utils.colour');\nconst common = goog.require('Blockly.common');\nconst deprecation = goog.require('Blockly.utils.deprecation');\nconst dialog = goog.require('Blockly.dialog');\nconst eventUtils = goog.require('Blockly.Events.utils');\n\n/*\n * Aliased functions and properties that used to be on the Blockly namespace.\n * Everything in this section is deprecated. Both external and internal code\n * should avoid using these functions and use the designated replacements.\n * Everything in this section will be removed in a future version of Blockly.\n */\n\n// Add accessors for properties on Blockly that have now been deprecated.\nObject.defineProperties(Blockly, {\n  /**\n   * Wrapper to window.alert() that app developers may override to\n   * provide alternatives to the modal browser window.\n   * @name Blockly.alert\n   * @type {!function(string, function()=)}\n   * @deprecated Use Blockly.dialog.alert / .setAlert() instead.\n   *     (December 2021)\n   * @suppress {checkTypes}\n   */\n  alert: {\n    set: function(newAlert) {\n      deprecation.warn('Blockly.alert', 'December 2021', 'December 2022');\n      dialog.setAlert(newAlert);\n    },\n    get: function() {\n      deprecation.warn(\n          'Blockly.alert', 'December 2021', 'December 2022',\n          'Blockly.dialog.alert()');\n      return dialog.alert;\n    },\n  },\n  /**\n   * Wrapper to window.confirm() that app developers may override to\n   * provide alternatives to the modal browser window.\n   * @name Blockly.confirm\n   * @type {!function(string, function()=)}\n   * @deprecated Use Blockly.dialog.confirm / .setConfirm() instead.\n   *     (December 2021)\n   * @suppress {checkTypes}\n   */\n  confirm: {\n    set: function(newConfirm) {\n      deprecation.warn('Blockly.confirm', 'December 2021', 'December 2022');\n      dialog.setConfirm(newConfirm);\n    },\n    get: function() {\n      deprecation.warn(\n          'Blockly.confirm', 'December 2021', 'December 2022',\n          'Blockly.dialog.confirm()');\n      return dialog.confirm;\n    },\n  },\n  /**\n   * The main workspace most recently used.\n   * Set by Blockly.WorkspaceSvg.prototype.markFocused\n   * @name Blockly.mainWorkspace\n   * @type {Workspace}\n   * @suppress {checkTypes}\n   */\n  mainWorkspace: {\n    set: function(x) {\n      deprecation.warn(\n          'Blockly.mainWorkspace', 'version 9', 'version 10',\n          'Blockly.getMainWorkspace');\n      common.setMainWorkspace(x);\n    },\n    get: function() {\n      deprecation.warn(\n          'Blockly.mainWorkspace', 'version 9', 'version 10',\n          'Blockly.getMainWorkspace');\n      return common.getMainWorkspace();\n    },\n  },\n  /**\n   * Wrapper to window.prompt() that app developers may override to\n   * provide alternatives to the modal browser window. Built-in\n   * browser prompts are often used for better text input experience\n   * on mobile device. We strongly recommend testing mobile when\n   * overriding this.\n   * @name Blockly.prompt\n   * @type {!function(string, string, function()=)}\n   * @deprecated Use Blockly.dialog.prompt / .setPrompt() instead.\n   *     (December 2021)\n   * @suppress {checkTypes}\n   */\n  prompt: {\n    set: function(newPrompt) {\n      deprecation.warn('Blockly.prompt', 'December 2021', 'December 2022');\n      dialog.setPrompt(newPrompt);\n    },\n    get: function() {\n      deprecation.warn(\n          'Blockly.prompt', 'December 2021', 'December 2022',\n          'Blockly.dialog.prompt()');\n      return dialog.prompt;\n    },\n  },\n  /**\n   * Currently selected block.\n   * @name Blockly.selected\n   * @type {?ICopyable}\n   * @suppress {checkTypes}\n   */\n  selected: {\n    get: function() {\n      deprecation.warn(\n          'Blockly.selected', 'version 9', 'version 10', 'Blockly.getSelected');\n      return common.getSelected();\n    },\n    set: function(newSelection) {\n      deprecation.warn(\n          'Blockly.selected', 'version 9', 'version 10', 'Blockly.getSelected');\n      common.setSelected(newSelection);\n    },\n  },\n  /**\n   * The richness of block colours, regardless of the hue.\n   * Must be in the range of 0 (inclusive) to 1 (exclusive).\n   * @name Blockly.HSV_SATURATION\n   * @type {number}\n   * @suppress {checkTypes}\n   */\n  HSV_SATURATION: {\n    get: function() {\n      return colour.getHsvSaturation();\n    },\n    set: function(newValue) {\n      colour.setHsvSaturation(newValue);\n    },\n  },\n  /**\n   * The intensity of block colours, regardless of the hue.\n   * Must be in the range of 0 (inclusive) to 1 (exclusive).\n   * @name Blockly.HSV_VALUE\n   * @type {number}\n   * @suppress {checkTypes}\n   */\n  HSV_VALUE: {\n    get: function() {\n      return colour.getHsvValue();\n    },\n    set: function(newValue) {\n      colour.setHsvValue(newValue);\n    },\n  },\n});\n\n// Add accessors for properties on Blockly.ContextMenu that have now\n// been deprecated.\nObject.defineProperties(ContextMenu, {\n  /**\n   * Which block is the context menu attached to?\n   * @name Blockly.ContextMenu.currentBlock\n   * @type {Block}\n   * @deprecated Use Blockly.Tooltip.getCurrentBlock() /\n   *     .setCurrentBlock() instead.  (September 2021)\n   * @suppress {checkTypes}\n   */\n  currentBlock: {\n    get: function() {\n      deprecation.warn(\n          'Blockly.ContextMenu.currentBlock', 'September 2021',\n          'September 2022', 'Blockly.Tooltip.getCurrentBlock()');\n      return ContextMenu.getCurrentBlock();\n    },\n    set: function(block) {\n      deprecation.warn(\n          'Blockly.ContextMenu.currentBlock', 'September 2021',\n          'September 2022', 'Blockly.Tooltip.setCurrentBlock(block)');\n      ContextMenu.setCurrentBlock(block);\n    },\n  },\n});\n\n// Add accessors for properties on Blockly.Events that have now been\n// deprecated.\nObject.defineProperties(Events, {\n  /**\n   * Sets whether the next event should be added to the undo stack.\n   * @name Blockly.Evenents.recordUndo\n   * @type {boolean}\n   * @deprecated Use Blockly.Events.getRecordUndo() and\n   *     .setRecordUndo().  (September 2021)\n   * @suppress {checkTypes}\n   */\n  recordUndo: {\n    get: function() {\n      deprecation.warn(\n          'Blockly.Events.recordUndo', 'September 2021', 'September 2022',\n          'Blockly.Events.getRecordUndo()');\n      return eventUtils.getRecordUndo();\n    },\n    set: function(record) {\n      deprecation.warn(\n          'Blockly.Events.recordUndo', 'September 2021', 'September 2022',\n          'Blockly.Events.setRecordUndo()');\n      eventUtils.setRecordUndo(record);\n    },\n  },\n});\n\n\n// Add accessors for properties on Blockly.Tooltip that have now been\n// deprecated.\nObject.defineProperties(Tooltip, {\n  /**\n   * Is a tooltip currently showing?\n   * @name Blockly.Tooltip.visible\n   * @type {boolean}\n   * @deprecated Use Blockly.Tooltip.isVisible() instead.  (September\n   *     2021)\n   * @suppress {checkTypes}\n   */\n  visible: {\n    get: function() {\n      deprecation.warn(\n          'Blockly.Tooltip.visible', 'September 2021', 'September 2022',\n          'Blockly.Tooltip.isVisible()');\n      return Tooltip.isVisible();\n    },\n  },\n  /**\n   * The HTML container.  Set once by createDom.\n   * @name Blockly.Tooltip.DIV\n   * @type {HTMLDivElement}\n   * @deprecated Use Blockly.Tooltip.getDiv() and .setDiv().\n   *     (September 2021)\n   * @suppress {checkTypes}\n   */\n  DIV: {\n    get: function() {\n      deprecation.warn(\n          'Blockly.Tooltip.DIV', 'September 2021', 'September 2022',\n          'Blockly.Tooltip.getDiv()');\n      return Tooltip.getDiv();\n    },\n  },\n});\n\n// Add accessors for properties on Blockly.WidgetDiv that have now been\n// deprecated.\nObject.defineProperties(WidgetDiv, {\n  /**\n   * The HTML container for popup overlays (e.g. editor widgets).\n   * @name Blockly.WidgetDiv.DIV\n   * @type {?Element}\n   * @deprecated Use Blockly.WidgetDiv.getDiv() and .setDiv().\n   *     (September 2021)\n   * @suppress {checkTypes}\n   */\n  DIV: {\n    get: function() {\n      deprecation.warn(\n          'Blockly.WidgetDiv.DIV', 'September 2021', 'September 2022',\n          'Blockly.WidgetDiv.getDiv()');\n      return WidgetDiv.getDiv();\n    },\n  },\n});\n\n// If Blockly is compiled with ADVANCED_COMPILATION and/or loaded as a\n// CJS or ES module there will not be a Blockly global variable\n// created.  This can cause problems because a very common way of\n// loading translations is to use a <script> tag to load one of\n// the generated msg/*.js files, which consists of lines like:\n//\n// Blockly.Msg[\"ADD_COMMENT\"] = \"Add Comment\";\n// Blockly.Msg[\"CLEAN_UP\"] = \"Clean up Blocks\";\n//\n// This obviously only works if Blockly.Msg is the Msg export from the\n// Blockly.Msg module - so make sure it is, but only if there is not\n// yet a Blockly global variable.\nif (!('Blockly' in globalThis)) {\n  globalThis['Blockly'] = {'Msg': Msg};\n}\n","/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Helper function for warning developers about deprecations.\n * This method is not specific to Blockly.\n *\n * @namespace Blockly.utils.deprecation\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.utils.deprecation');\n\n\n/**\n * Warn developers that a function or property is deprecated.\n *\n * @param name The name of the function or property.\n * @param deprecationDate The date of deprecation. Prefer 'version n.0.0'\n *     format, and fall back to 'month yyyy' or 'quarter yyyy' format.\n * @param deletionDate The date of deletion. Prefer 'version n.0.0'\n *     format, and fall back to 'month yyyy' or 'quarter yyyy' format.\n * @param opt_use The name of a function or property to use instead, if any.\n * @alias Blockly.utils.deprecation.warn\n * @internal\n */\nexport function warn(\n    name: string, deprecationDate: string, deletionDate: string,\n    opt_use?: string) {\n  let msg = name + ' was deprecated in ' + deprecationDate +\n      ' and will be deleted in ' + deletionDate + '.';\n  if (opt_use) {\n    msg += '\\nUse ' + opt_use + ' instead.';\n  }\n  console.warn(msg);\n}\n","/**\n * @license\n * Copyright 2016 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Touch handling for Blockly.\n *\n * @namespace Blockly.Touch\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Touch');\n\nimport type {Gesture} from './gesture.js';\nimport * as deprecation from './utils/deprecation.js';\n\n\n/**\n * A mock event, created from either a mouse or touch event,\n * with no more than one entry in the changedTouches array.\n */\ninterface PseudoEvent {\n  type: string;\n  changedTouches: Touch[];\n  target: Element;\n  stopPropagation: () => void;\n  preventDefault: () => void;\n}\n\n/** Length in ms for a touch to become a long press. */\nconst LONGPRESS = 750;\n\n/**\n * Whether touch is enabled in the browser.\n * Copied from Closure's goog.events.BrowserFeature.TOUCH_ENABLED\n */\nexport const TOUCH_ENABLED = 'ontouchstart' in globalThis ||\n    !!(globalThis['document'] && document.documentElement &&\n       'ontouchstart' in\n           document.documentElement) ||  // IE10 uses non-standard touch events,\n    // so it has a different check.\n    !!(globalThis['navigator'] &&\n       (globalThis['navigator']['maxTouchPoints'] ||\n        (globalThis['navigator'] as any)['msMaxTouchPoints']));\n\n/** Which touch events are we currently paying attention to? */\nlet touchIdentifier_: string|null = null;\n\n/**\n * The TOUCH_MAP lookup dictionary specifies additional touch events to fire,\n * in conjunction with mouse events.\n *\n * @alias Blockly.Touch.TOUCH_MAP\n */\nexport const TOUCH_MAP: {[key: string]: string[]} = {\n  'mousedown': ['pointerdown'],\n  'mouseenter': ['pointerenter'],\n  'mouseleave': ['pointerleave'],\n  'mousemove': ['pointermove'],\n  'mouseout': ['pointerout'],\n  'mouseover': ['pointerover'],\n  'mouseup': ['pointerup', 'pointercancel'],\n  'touchend': ['pointerup'],\n  'touchcancel': ['pointercancel'],\n};\n\n/** PID of queued long-press task. */\nlet longPid_: AnyDuringMigration = 0;\n\n/**\n * Context menus on touch devices are activated using a long-press.\n * Unfortunately the contextmenu touch event is currently (2015) only supported\n * by Chrome.  This function is fired on any touchstart event, queues a task,\n * which after about a second opens the context menu.  The tasks is killed\n * if the touch event terminates early.\n *\n * @param e Touch start event.\n * @param gesture The gesture that triggered this longStart.\n * @alias Blockly.Touch.longStart\n * @internal\n */\nexport function longStart(e: PointerEvent, gesture: Gesture) {\n  longStop();\n  longPid_ = setTimeout(function() {\n    // Let the gesture route the right-click correctly.\n    if (gesture) {\n      gesture.handleRightClick(e);\n    }\n  }, LONGPRESS);\n}\n\n/**\n * Nope, that's not a long-press.  Either touchend or touchcancel was fired,\n * or a drag hath begun.  Kill the queued long-press task.\n *\n * @alias Blockly.Touch.longStop\n * @internal\n */\nexport function longStop() {\n  if (longPid_) {\n    clearTimeout(longPid_);\n    longPid_ = 0;\n  }\n}\n\n/**\n * Clear the touch identifier that tracks which touch stream to pay attention\n * to.  This ends the current drag/gesture and allows other pointers to be\n * captured.\n *\n * @alias Blockly.Touch.clearTouchIdentifier\n */\nexport function clearTouchIdentifier() {\n  touchIdentifier_ = null;\n}\n\n/**\n * Decide whether Blockly should handle or ignore this event.\n * Mouse and touch events require special checks because we only want to deal\n * with one touch stream at a time.  All other events should always be handled.\n *\n * @param e The event to check.\n * @returns True if this event should be passed through to the registered\n *     handler; false if it should be blocked.\n * @alias Blockly.Touch.shouldHandleEvent\n */\nexport function shouldHandleEvent(e: Event): boolean {\n  // Do not replace the startsWith with a check for `instanceof PointerEvent`.\n  // `click` and `contextmenu` are PointerEvents in some browsers,\n  // despite not starting with `pointer`, but we want to always handle them\n  // without worrying about touch identifiers.\n  return !(e.type.startsWith('pointer')) ||\n      (e instanceof PointerEvent && checkTouchIdentifier(e));\n}\n\n/**\n * Get the pointer identifier from the given event.\n *\n * @param e Pointer event.\n * @returns The pointerId of the event.\n * @alias Blockly.Touch.getTouchIdentifierFromEvent\n */\nexport function getTouchIdentifierFromEvent(e: PointerEvent): string {\n  return `${e.pointerId}`;\n}\n\n/**\n * Check whether the pointer identifier on the event matches the current saved\n * identifier. If the current identifier was unset, save the identifier from\n * the event. This starts a drag/gesture, during which pointer events with\n * other identifiers will be silently ignored.\n *\n * @param e Pointer event.\n * @returns Whether the identifier on the event matches the current saved\n *     identifier.\n * @alias Blockly.Touch.checkTouchIdentifier\n */\nexport function checkTouchIdentifier(e: PointerEvent): boolean {\n  const identifier = getTouchIdentifierFromEvent(e);\n\n  if (touchIdentifier_) {\n    // We're already tracking some touch/mouse event.  Is this from the same\n    // source?\n    return touchIdentifier_ === identifier;\n  }\n  if (e.type === 'pointerdown') {\n    // No identifier set yet, and this is the start of a drag.  Set it and\n    // return.\n    touchIdentifier_ = identifier;\n    return true;\n  }\n  // There was no identifier yet, but this wasn't a start event so we're going\n  // to ignore it.  This probably means that another drag finished while this\n  // pointer was down.\n  return false;\n}\n\n/**\n * Set an event's clientX and clientY from its first changed touch.  Use this to\n * make a touch event work in a mouse event handler.\n *\n * @param e A touch event.\n * @alias Blockly.Touch.setClientFromTouch\n */\nexport function setClientFromTouch(e: Event|PseudoEvent) {\n  deprecation.warn('setClientFromTouch()', 'version 9', 'version 10');\n  // AnyDuringMigration because:  Property 'changedTouches' does not exist on\n  // type 'PseudoEvent | Event'.\n  if (e.type.startsWith('touch') && (e as AnyDuringMigration).changedTouches) {\n    // Map the touch event's properties to the event.\n    // AnyDuringMigration because:  Property 'changedTouches' does not exist on\n    // type 'PseudoEvent | Event'.\n    const touchPoint = (e as AnyDuringMigration).changedTouches[0];\n    // AnyDuringMigration because:  Property 'clientX' does not exist on type\n    // 'PseudoEvent | Event'.\n    (e as AnyDuringMigration).clientX = touchPoint.clientX;\n    // AnyDuringMigration because:  Property 'clientY' does not exist on type\n    // 'PseudoEvent | Event'.\n    (e as AnyDuringMigration).clientY = touchPoint.clientY;\n  }\n}\n\n/**\n * Check whether a given event is a mouse, touch, or pointer event.\n *\n * @param e An event.\n * @returns True if it is a mouse, touch, or pointer event; false otherwise.\n * @alias Blockly.Touch.isMouseOrTouchEvent\n */\nexport function isMouseOrTouchEvent(e: Event|PseudoEvent): boolean {\n  deprecation.warn('isMouseOrTouchEvent()', 'version 9', 'version 10');\n  return e.type.startsWith('touch') || e.type.startsWith('mouse') ||\n      e.type.startsWith('pointer');\n}\n\n/**\n * Check whether a given event is a touch event or a pointer event.\n *\n * @param e An event.\n * @returns True if it is a touch or pointer event; false otherwise.\n * @alias Blockly.Touch.isTouchEvent\n */\nexport function isTouchEvent(e: Event|PseudoEvent): boolean {\n  deprecation.warn('isTouchEvent()', 'version 9', 'version 10');\n  return e.type.startsWith('touch') || e.type.startsWith('pointer');\n}\n\n/**\n * Split an event into an array of events, one per changed touch or mouse\n * point.\n *\n * @param e A mouse event or a touch event with one or more changed touches.\n * @returns An array of events or pseudo events.\n *     Each pseudo-touch event will have exactly one changed touch and there\n * will be no real touch events.\n * @alias Blockly.Touch.splitEventByTouches\n */\nexport function splitEventByTouches(e: Event): Array<Event|PseudoEvent> {\n  deprecation.warn('splitEventByTouches()', 'version 9', 'version 10');\n  const events = [];\n  // AnyDuringMigration because:  Property 'changedTouches' does not exist on\n  // type 'PseudoEvent | Event'.\n  if ((e as AnyDuringMigration).changedTouches) {\n    // AnyDuringMigration because:  Property 'changedTouches' does not exist on\n    // type 'PseudoEvent | Event'.\n    for (let i = 0; i < (e as AnyDuringMigration).changedTouches.length; i++) {\n      const newEvent = {\n        type: e.type,\n        // AnyDuringMigration because:  Property 'changedTouches' does not exist\n        // on type 'PseudoEvent | Event'.\n        changedTouches: [(e as AnyDuringMigration).changedTouches[i]],\n        target: e.target,\n        stopPropagation() {\n          e.stopPropagation();\n        },\n        preventDefault() {\n          e.preventDefault();\n        },\n      };\n      events[i] = newEvent;\n    }\n  } else {\n    events.push(e);\n  }\n  // AnyDuringMigration because:  Type '(Event | { type: string; changedTouches:\n  // Touch[]; target: EventTarget | null; stopPropagation(): void;\n  // preventDefault(): void; })[]' is not assignable to type '(PseudoEvent |\n  // Event)[]'.\n  return events as AnyDuringMigration;\n}\n","/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Browser event handling.\n *\n * @namespace Blockly.browserEvents\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.browserEvents');\n\nimport * as Touch from './touch.js';\nimport * as deprecation from './utils/deprecation.js';\nimport * as userAgent from './utils/useragent.js';\n\n\n/**\n * Blockly opaque event data used to unbind events when using\n * `bind` and `conditionalBind`.\n *\n * @alias Blockly.browserEvents.Data\n */\nexport type Data = [EventTarget, string, (e: Event) => void][];\n\n/**\n * The multiplier for scroll wheel deltas using the line delta mode.\n * See https://developer.mozilla.org/en-US/docs/Web/API/WheelEvent/deltaMode\n * for more information on deltaMode.\n */\nconst LINE_MODE_MULTIPLIER = 40;\n\n/**\n * The multiplier for scroll wheel deltas using the page delta mode.\n * See https://developer.mozilla.org/en-US/docs/Web/API/WheelEvent/deltaMode\n * for more information on deltaMode.\n */\nconst PAGE_MODE_MULTIPLIER = 125;\n\n/**\n * Bind an event handler that can be ignored if it is not part of the active\n * touch stream.\n * Use this for events that either start or continue a multi-part gesture (e.g.\n * mousedown or mousemove, which may be part of a drag or click).\n *\n * @param node Node upon which to listen.\n * @param name Event name to listen to (e.g. 'mousedown').\n * @param thisObject The value of 'this' in the function.\n * @param func Function to call when event is triggered.\n * @param opt_noCaptureIdentifier True if triggering on this event should not\n *     block execution of other event handlers on this touch or other\n *     simultaneous touches.  False by default.\n * @param opt_noPreventDefault No-op, deprecated and will be removed in v10.\n * @returns Opaque data that can be passed to unbindEvent_.\n * @alias Blockly.browserEvents.conditionalBind\n */\nexport function conditionalBind(\n    node: EventTarget, name: string, thisObject: Object|null, func: Function,\n    opt_noCaptureIdentifier?: boolean, opt_noPreventDefault?: boolean): Data {\n  if (opt_noPreventDefault !== undefined) {\n    deprecation.warn(\n        'The opt_noPreventDefault argument of conditionalBind', 'version 9',\n        'version 10');\n  }\n  /**\n   *\n   * @param e\n   */\n  function wrapFunc(e: Event) {\n    const captureIdentifier = !opt_noCaptureIdentifier;\n\n    if (!(captureIdentifier && !Touch.shouldHandleEvent(e))) {\n      if (thisObject) {\n        func.call(thisObject, e);\n      } else {\n        func(e);\n      }\n    }\n  }\n\n  const bindData: Data = [];\n  if (name in Touch.TOUCH_MAP) {\n    for (let i = 0; i < Touch.TOUCH_MAP[name].length; i++) {\n      const type = Touch.TOUCH_MAP[name][i];\n      node.addEventListener(type, wrapFunc, false);\n      bindData.push([node, type, wrapFunc]);\n    }\n  } else {\n    node.addEventListener(name, wrapFunc, false);\n    bindData.push([node, name, wrapFunc]);\n  }\n  return bindData;\n}\n\n/**\n * Bind an event handler that should be called regardless of whether it is part\n * of the active touch stream.\n * Use this for events that are not part of a multi-part gesture (e.g.\n * mouseover for tooltips).\n *\n * @param node Node upon which to listen.\n * @param name Event name to listen to (e.g. 'mousedown').\n * @param thisObject The value of 'this' in the function.\n * @param func Function to call when event is triggered.\n * @returns Opaque data that can be passed to unbindEvent_.\n * @alias Blockly.browserEvents.bind\n */\nexport function bind(\n    node: EventTarget, name: string, thisObject: Object|null,\n    func: Function): Data {\n  /**\n   *\n   * @param e\n   */\n  function wrapFunc(e: Event) {\n    if (thisObject) {\n      func.call(thisObject, e);\n    } else {\n      func(e);\n    }\n  }\n\n  const bindData: Data = [];\n  if (name in Touch.TOUCH_MAP) {\n    for (let i = 0; i < Touch.TOUCH_MAP[name].length; i++) {\n      const type = Touch.TOUCH_MAP[name][i];\n      node.addEventListener(type, wrapFunc, false);\n      bindData.push([node, type, wrapFunc]);\n    }\n  } else {\n    node.addEventListener(name, wrapFunc, false);\n    bindData.push([node, name, wrapFunc]);\n  }\n  return bindData;\n}\n\n/**\n * Unbind one or more events event from a function call.\n *\n * @param bindData Opaque data from bindEvent_.\n *     This list is emptied during the course of calling this function.\n * @returns The function call.\n * @alias Blockly.browserEvents.unbind\n */\nexport function unbind(bindData: Data): (e: Event) => void {\n  // Accessing an element of the last property of the array is unsafe if the\n  // bindData is an empty array. But that should never happen because developers\n  // should only pass Data from bind or conditionalBind.\n  const callback = bindData[bindData.length - 1][2];\n  while (bindData.length) {\n    const bindDatum = bindData.pop();\n    const node = bindDatum![0];\n    const name = bindDatum![1];\n    const func = bindDatum![2];\n    node.removeEventListener(name, func, false);\n  }\n  return callback;\n}\n\n/**\n * Returns true if this event is targeting a text input widget?\n *\n * @param e An event.\n * @returns True if text input.\n * @alias Blockly.browserEvents.isTargetInput\n */\nexport function isTargetInput(e: Event): boolean {\n  if (e.target instanceof HTMLElement) {\n    if (e.target.isContentEditable ||\n        e.target.getAttribute('data-is-text-input') === 'true') {\n      return true;\n    }\n\n    if (e.target instanceof HTMLInputElement) {\n      const target = e.target;\n      return target.type === 'text' || target.type === 'number' ||\n          target.type === 'email' || target.type === 'password' ||\n          target.type === 'search' || target.type === 'tel' ||\n          target.type === 'url';\n    }\n\n    if (e.target instanceof HTMLTextAreaElement) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\n/**\n * Returns true this event is a right-click.\n *\n * @param e Mouse event.\n * @returns True if right-click.\n * @alias Blockly.browserEvents.isRightButton\n */\nexport function isRightButton(e: MouseEvent): boolean {\n  if (e.ctrlKey && userAgent.MAC) {\n    // Control-clicking on Mac OS X is treated as a right-click.\n    // WebKit on Mac OS X fails to change button to 2 (but Gecko does).\n    return true;\n  }\n  return e.button === 2;\n}\n\n/**\n * Returns the converted coordinates of the given mouse event.\n * The origin (0,0) is the top-left corner of the Blockly SVG.\n *\n * @param e Mouse event.\n * @param svg SVG element.\n * @param matrix Inverted screen CTM to use.\n * @returns Object with .x and .y properties.\n * @alias Blockly.browserEvents.mouseToSvg\n */\nexport function mouseToSvg(\n    e: MouseEvent, svg: SVGSVGElement, matrix: SVGMatrix|null): SVGPoint {\n  const svgPoint = svg.createSVGPoint();\n  svgPoint.x = e.clientX;\n  svgPoint.y = e.clientY;\n\n  if (!matrix) {\n    matrix = svg.getScreenCTM()!.inverse();\n  }\n  return svgPoint.matrixTransform(matrix);\n}\n\n/**\n * Returns the scroll delta of a mouse event in pixel units.\n *\n * @param e Mouse event.\n * @returns Scroll delta object with .x and .y properties.\n * @alias Blockly.browserEvents.getScrollDeltaPixels\n */\nexport function getScrollDeltaPixels(e: WheelEvent): {x: number, y: number} {\n  switch (e.deltaMode) {\n    case 0x00:  // Pixel mode.\n    default:\n      return {x: e.deltaX, y: e.deltaY};\n    case 0x01:  // Line mode.\n      return {\n        x: e.deltaX * LINE_MODE_MULTIPLIER,\n        y: e.deltaY * LINE_MODE_MULTIPLIER,\n      };\n    case 0x02:  // Page mode.\n      return {\n        x: e.deltaX * PAGE_MODE_MULTIPLIER,\n        y: e.deltaY * PAGE_MODE_MULTIPLIER,\n      };\n  }\n}\n","/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Common functions used both internally and externally, but which\n * must not be at the top level to avoid circular dependencies.\n *\n * @namespace Blockly.common\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.common');\n\n/* eslint-disable-next-line no-unused-vars */\nimport type {Block} from './block.js';\nimport {BlockDefinition, Blocks} from './blocks.js';\nimport type {Connection} from './connection.js';\nimport type {ICopyable} from './interfaces/i_copyable.js';\nimport type {Workspace} from './workspace.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/** Database of all workspaces. */\nconst WorkspaceDB_ = Object.create(null);\n\n\n/**\n * Find the workspace with the specified ID.\n *\n * @param id ID of workspace to find.\n * @returns The sought after workspace or null if not found.\n */\nexport function getWorkspaceById(id: string): Workspace|null {\n  return WorkspaceDB_[id] || null;\n}\n\n/**\n * Find all workspaces.\n *\n * @returns Array of workspaces.\n */\nexport function getAllWorkspaces(): Workspace[] {\n  const workspaces = [];\n  for (const workspaceId in WorkspaceDB_) {\n    workspaces.push(WorkspaceDB_[workspaceId]);\n  }\n  return workspaces;\n}\n\n/**\n * Register a workspace in the workspace db.\n *\n * @param workspace\n */\nexport function registerWorkspace(workspace: Workspace) {\n  WorkspaceDB_[workspace.id] = workspace;\n}\n\n/**\n * Unregister a workspace from the workspace db.\n *\n * @param workspace\n */\nexport function unregisterWorkpace(workspace: Workspace) {\n  delete WorkspaceDB_[workspace.id];\n}\n\n/**\n * The main workspace most recently used.\n * Set by Blockly.WorkspaceSvg.prototype.markFocused\n */\nlet mainWorkspace: Workspace;\n\n/**\n * Returns the last used top level workspace (based on focus).  Try not to use\n * this function, particularly if there are multiple Blockly instances on a\n * page.\n *\n * @returns The main workspace.\n * @alias Blockly.common.getMainWorkspace\n */\nexport function getMainWorkspace(): Workspace {\n  return mainWorkspace;\n}\n\n/**\n * Sets last used main workspace.\n *\n * @param workspace The most recently used top level workspace.\n * @alias Blockly.common.setMainWorkspace\n */\nexport function setMainWorkspace(workspace: Workspace) {\n  mainWorkspace = workspace;\n}\n\n/**\n * Currently selected copyable object.\n */\nlet selected: ICopyable|null = null;\n\n/**\n * Returns the currently selected copyable object.\n *\n * @alias Blockly.common.getSelected\n */\nexport function getSelected(): ICopyable|null {\n  return selected;\n}\n\n/**\n * Sets the currently selected block. This function does not visually mark the\n * block as selected or fire the required events. If you wish to\n * programmatically select a block, use `BlockSvg#select`.\n *\n * @param newSelection The newly selected block.\n * @alias Blockly.common.setSelected\n * @internal\n */\nexport function setSelected(newSelection: ICopyable|null) {\n  selected = newSelection;\n}\n\n/**\n * Container element in which to render the WidgetDiv, DropDownDiv and Tooltip.\n */\nlet parentContainer: Element|null;\n\n/**\n * Get the container element in which to render the WidgetDiv, DropDownDiv and\n * Tooltip.\n *\n * @returns The parent container.\n * @alias Blockly.common.getParentContainer\n */\nexport function getParentContainer(): Element|null {\n  return parentContainer;\n}\n\n/**\n * Set the parent container.  This is the container element that the WidgetDiv,\n * DropDownDiv, and Tooltip are rendered into the first time `Blockly.inject`\n * is called.\n * This method is a NOP if called after the first `Blockly.inject`.\n *\n * @param newParent The container element.\n * @alias Blockly.common.setParentContainer\n */\nexport function setParentContainer(newParent: Element) {\n  parentContainer = newParent;\n}\n\n/**\n * Size the SVG image to completely fill its container. Call this when the view\n * actually changes sizes (e.g. on a window resize/device orientation change).\n * See workspace.resizeContents to resize the workspace when the contents\n * change (e.g. when a block is added or removed).\n * Record the height/width of the SVG image.\n *\n * @param workspace Any workspace in the SVG.\n * @alias Blockly.common.svgResize\n */\nexport function svgResize(workspace: WorkspaceSvg) {\n  let mainWorkspace = workspace;\n  while (mainWorkspace.options.parentWorkspace) {\n    mainWorkspace = mainWorkspace.options.parentWorkspace;\n  }\n  const svg = mainWorkspace.getParentSvg();\n  const cachedSize = mainWorkspace.getCachedParentSvgSize();\n  const div = svg.parentElement;\n  if (!(div instanceof HTMLElement)) {\n    // Workspace deleted, or something.\n    return;\n  }\n\n  const width = div.offsetWidth;\n  const height = div.offsetHeight;\n  if (cachedSize.width !== width) {\n    svg.setAttribute('width', width + 'px');\n    mainWorkspace.setCachedParentSvgSize(width, null);\n  }\n  if (cachedSize.height !== height) {\n    svg.setAttribute('height', height + 'px');\n    mainWorkspace.setCachedParentSvgSize(null, height);\n  }\n  mainWorkspace.resize();\n}\n\n/**\n * All of the connections on blocks that are currently being dragged.\n */\nexport const draggingConnections: Connection[] = [];\n\n/**\n * Get a map of all the block's descendants mapping their type to the number of\n *    children with that type.\n *\n * @param block The block to map.\n * @param opt_stripFollowing Optionally ignore all following\n *    statements (blocks that are not inside a value or statement input\n *    of the block).\n * @returns Map of types to type counts for descendants of the bock.\n * @alias Blockly.common.getBlockTypeCounts\n */\nexport function getBlockTypeCounts(\n    block: Block, opt_stripFollowing?: boolean): {[key: string]: number} {\n  const typeCountsMap = Object.create(null);\n  const descendants = block.getDescendants(true);\n  if (opt_stripFollowing) {\n    const nextBlock = block.getNextBlock();\n    if (nextBlock) {\n      const index = descendants.indexOf(nextBlock);\n      descendants.splice(index, descendants.length - index);\n    }\n  }\n  for (let i = 0, checkBlock; checkBlock = descendants[i]; i++) {\n    if (typeCountsMap[checkBlock.type]) {\n      typeCountsMap[checkBlock.type]++;\n    } else {\n      typeCountsMap[checkBlock.type] = 1;\n    }\n  }\n  return typeCountsMap;\n}\n\n/**\n * Helper function for defining a block from JSON.  The resulting function has\n * the correct value of jsonDef at the point in code where jsonInit is called.\n *\n * @param jsonDef The JSON definition of a block.\n * @returns A function that calls jsonInit with the correct value\n *     of jsonDef.\n */\nfunction jsonInitFactory(jsonDef: AnyDuringMigration): () => void {\n  return function(this: Block) {\n    this.jsonInit(jsonDef);\n  };\n}\n\n/**\n * Define blocks from an array of JSON block definitions, as might be generated\n * by the Blockly Developer Tools.\n *\n * @param jsonArray An array of JSON block definitions.\n * @alias Blockly.common.defineBlocksWithJsonArray\n */\nexport function defineBlocksWithJsonArray(jsonArray: AnyDuringMigration[]) {\n  TEST_ONLY.defineBlocksWithJsonArrayInternal(jsonArray);\n}\n\n/**\n * Private version of defineBlocksWithJsonArray for stubbing in tests.\n */\nfunction defineBlocksWithJsonArrayInternal(jsonArray: AnyDuringMigration[]) {\n  defineBlocks(createBlockDefinitionsFromJsonArray(jsonArray));\n}\n\n/**\n * Define blocks from an array of JSON block definitions, as might be generated\n * by the Blockly Developer Tools.\n *\n * @param jsonArray An array of JSON block definitions.\n * @returns A map of the block\n *     definitions created.\n * @alias Blockly.common.defineBlocksWithJsonArray\n */\nexport function createBlockDefinitionsFromJsonArray(\n    jsonArray: AnyDuringMigration[]): {[key: string]: BlockDefinition} {\n  const blocks: {[key: string]: BlockDefinition} = {};\n  for (let i = 0; i < jsonArray.length; i++) {\n    const elem = jsonArray[i];\n    if (!elem) {\n      console.warn(`Block definition #${i} in JSON array is ${elem}. Skipping`);\n      continue;\n    }\n    const type = elem['type'];\n    if (!type) {\n      console.warn(\n          `Block definition #${i} in JSON array is missing a type attribute. ` +\n          'Skipping.');\n      continue;\n    }\n    blocks[type] = {init: jsonInitFactory(elem)};\n  }\n  return blocks;\n}\n\n/**\n * Add the specified block definitions to the block definitions\n * dictionary (Blockly.Blocks).\n *\n * @param blocks A map of block\n *     type names to block definitions.\n * @alias Blockly.common.defineBlocks\n */\nexport function defineBlocks(blocks: {[key: string]: BlockDefinition}) {\n  // Iterate over own enumerable properties.\n  for (const type of Object.keys(blocks)) {\n    const definition = blocks[type];\n    if (type in Blocks) {\n      console.warn(`Block definiton \"${type}\" overwrites previous definition.`);\n    }\n    Blocks[type] = definition;\n  }\n}\n\nexport const TEST_ONLY = {defineBlocksWithJsonArrayInternal};\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Utility methods for DOM manipulation.\n * These methods are not specific to Blockly, and could be factored out into\n * a JavaScript framework such as Closure.\n *\n * @namespace Blockly.utils.dom\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.utils.dom');\n\nimport type {Svg} from './svg.js';\n\n\n/**\n * Required name space for SVG elements.\n *\n * @alias Blockly.utils.dom.SVG_NS\n */\nexport const SVG_NS = 'http://www.w3.org/2000/svg';\n\n/**\n * Required name space for HTML elements.\n *\n * @alias Blockly.utils.dom.HTML_NS\n */\nexport const HTML_NS = 'http://www.w3.org/1999/xhtml';\n\n/**\n * Required name space for XLINK elements.\n *\n * @alias Blockly.utils.dom.XLINK_NS\n */\nexport const XLINK_NS = 'http://www.w3.org/1999/xlink';\n\n/**\n * Node type constants.\n * https://developer.mozilla.org/en-US/docs/Web/API/Node/nodeType\n *\n * @alias Blockly.utils.dom.NodeType\n */\nexport enum NodeType {\n  ELEMENT_NODE = 1,\n  TEXT_NODE = 3,\n  COMMENT_NODE = 8,\n  DOCUMENT_POSITION_CONTAINED_BY = 16\n}\n\n/** Temporary cache of text widths. */\nlet cacheWidths: {[key: string]: number}|null = null;\n\n/** Number of current references to cache. */\nlet cacheReference = 0;\n\n/** A HTML canvas context used for computing text width. */\nlet canvasContext: CanvasRenderingContext2D|null = null;\n\n/**\n * Helper method for creating SVG elements.\n *\n * @param name Element's tag name.\n * @param attrs Dictionary of attribute names and values.\n * @param opt_parent Optional parent on which to append the element.\n * @returns if name is a string or a more specific type if it a member of Svg.\n * @alias Blockly.utils.dom.createSvgElement\n */\nexport function createSvgElement<T extends SVGElement>(\n    name: string|Svg<T>, attrs: {[key: string]: string|number},\n    opt_parent?: Element|null): T {\n  const e = document.createElementNS(SVG_NS, String(name)) as T;\n  for (const key in attrs) {\n    e.setAttribute(key, `${attrs[key]}`);\n  }\n  if (opt_parent) {\n    opt_parent.appendChild(e);\n  }\n  return e;\n}\n\n/**\n * Add a CSS class to a element.\n *\n * Handles multiple space-separated classes for legacy reasons.\n *\n * @param element DOM element to add class to.\n * @param className Name of class to add.\n * @returns True if class was added, false if already present.\n * @alias Blockly.utils.dom.addClass\n */\nexport function addClass(element: Element, className: string): boolean {\n  const classNames = className.split(' ');\n  if (classNames.every((name) => element.classList.contains(name))) {\n    return false;\n  }\n  element.classList.add(...classNames);\n  return true;\n}\n\n/**\n * Removes multiple classes from an element.\n *\n * @param element DOM element to remove classes from.\n * @param classNames A string of one or multiple class names for an element.\n * @alias Blockly.utils.dom.removeClasses\n */\nexport function removeClasses(element: Element, classNames: string) {\n  element.classList.remove(...classNames.split(' '));\n}\n\n/**\n * Remove a CSS class from a element.\n *\n * Handles multiple space-separated classes for legacy reasons.\n *\n * @param element DOM element to remove class from.\n * @param className Name of class to remove.\n * @returns True if class was removed, false if never present.\n * @alias Blockly.utils.dom.removeClass\n */\nexport function removeClass(element: Element, className: string): boolean {\n  const classNames = className.split(' ');\n  if (classNames.every((name) => !element.classList.contains(name))) {\n    return false;\n  }\n  element.classList.remove(...classNames);\n  return true;\n}\n\n/**\n * Checks if an element has the specified CSS class.\n *\n * @param element DOM element to check.\n * @param className Name of class to check.\n * @returns True if class exists, false otherwise.\n * @alias Blockly.utils.dom.hasClass\n */\nexport function hasClass(element: Element, className: string): boolean {\n  return element.classList.contains(className);\n}\n\n/**\n * Removes a node from its parent. No-op if not attached to a parent.\n *\n * @param node The node to remove.\n * @returns The node removed if removed; else, null.\n * @alias Blockly.utils.dom.removeNode\n */\n// Copied from Closure goog.dom.removeNode\nexport function removeNode(node: Node|null): Node|null {\n  return node && node.parentNode ? node.parentNode.removeChild(node) : null;\n}\n\n/**\n * Insert a node after a reference node.\n * Contrast with node.insertBefore function.\n *\n * @param newNode New element to insert.\n * @param refNode Existing element to precede new node.\n * @alias Blockly.utils.dom.insertAfter\n */\nexport function insertAfter(newNode: Element, refNode: Element) {\n  const siblingNode = refNode.nextSibling;\n  const parentNode = refNode.parentNode;\n  if (!parentNode) {\n    throw Error('Reference node has no parent.');\n  }\n  if (siblingNode) {\n    parentNode.insertBefore(newNode, siblingNode);\n  } else {\n    parentNode.appendChild(newNode);\n  }\n}\n\n/**\n * Whether a node contains another node.\n *\n * @param parent The node that should contain the other node.\n * @param descendant The node to test presence of.\n * @returns Whether the parent node contains the descendant node.\n * @alias Blockly.utils.dom.containsNode\n */\nexport function containsNode(parent: Node, descendant: Node): boolean {\n  return !!(\n      parent.compareDocumentPosition(descendant) &\n      NodeType.DOCUMENT_POSITION_CONTAINED_BY);\n}\n\n/**\n * Sets the CSS transform property on an element. This function sets the\n * non-vendor-prefixed and vendor-prefixed versions for backwards compatibility\n * with older browsers. See https://caniuse.com/#feat=transforms2d\n *\n * @param element Element to which the CSS transform will be applied.\n * @param transform The value of the CSS `transform` property.\n * @alias Blockly.utils.dom.setCssTransform\n */\nexport function setCssTransform(\n    element: HTMLElement|SVGElement, transform: string) {\n  element.style['transform'] = transform;\n  element.style['-webkit-transform' as any] = transform;\n}\n\n/**\n * Start caching text widths. Every call to this function MUST also call\n * stopTextWidthCache. Caches must not survive between execution threads.\n *\n * @alias Blockly.utils.dom.startTextWidthCache\n */\nexport function startTextWidthCache() {\n  cacheReference++;\n  if (!cacheWidths) {\n    cacheWidths = Object.create(null);\n  }\n}\n\n/**\n * Stop caching field widths. Unless caching was already on when the\n * corresponding call to startTextWidthCache was made.\n *\n * @alias Blockly.utils.dom.stopTextWidthCache\n */\nexport function stopTextWidthCache() {\n  cacheReference--;\n  if (!cacheReference) {\n    cacheWidths = null;\n  }\n}\n\n/**\n * Gets the width of a text element, caching it in the process.\n *\n * @param textElement An SVG 'text' element.\n * @returns Width of element.\n * @alias Blockly.utils.dom.getTextWidth\n */\nexport function getTextWidth(textElement: SVGTextElement): number {\n  const key = textElement.textContent + '\\n' + textElement.className.baseVal;\n  let width;\n  // Return the cached width if it exists.\n  if (cacheWidths) {\n    width = cacheWidths[key];\n    if (width) {\n      return width;\n    }\n  }\n\n  // Attempt to compute fetch the width of the SVG text element.\n  try {\n    width = textElement.getComputedTextLength();\n  } catch (e) {\n    // In other cases where we fail to get the computed text. Instead, use an\n    // approximation and do not cache the result. At some later point in time\n    // when the block is inserted into the visible DOM, this method will be\n    // called again and, at that point in time, will not throw an exception.\n    return textElement.textContent!.length * 8;\n  }\n\n  // Cache the computed width and return.\n  if (cacheWidths) {\n    cacheWidths[key] = width;\n  }\n  return width;\n}\n\n/**\n * Gets the width of a text element using a faster method than `getTextWidth`.\n * This method requires that we know the text element's font family and size in\n * advance. Similar to `getTextWidth`, we cache the width we compute.\n *\n * @param textElement An SVG 'text' element.\n * @param fontSize The font size to use.\n * @param fontWeight The font weight to use.\n * @param fontFamily The font family to use.\n * @returns Width of element.\n * @alias Blockly.utils.dom.getFastTextWidth\n */\nexport function getFastTextWidth(\n    textElement: SVGTextElement, fontSize: number, fontWeight: string,\n    fontFamily: string): number {\n  return getFastTextWidthWithSizeString(\n      textElement, fontSize + 'pt', fontWeight, fontFamily);\n}\n\n/**\n * Gets the width of a text element using a faster method than `getTextWidth`.\n * This method requires that we know the text element's font family and size in\n * advance. Similar to `getTextWidth`, we cache the width we compute.\n * This method is similar to `getFastTextWidth` but expects the font size\n * parameter to be a string.\n *\n * @param textElement An SVG 'text' element.\n * @param fontSize The font size to use.\n * @param fontWeight The font weight to use.\n * @param fontFamily The font family to use.\n * @returns Width of element.\n * @alias Blockly.utils.dom.getFastTextWidthWithSizeString\n */\nexport function getFastTextWidthWithSizeString(\n    textElement: SVGTextElement, fontSize: string, fontWeight: string,\n    fontFamily: string): number {\n  const text = textElement.textContent;\n  const key = text + '\\n' + textElement.className.baseVal;\n  let width;\n\n  // Return the cached width if it exists.\n  if (cacheWidths) {\n    width = cacheWidths[key];\n    if (width) {\n      return width;\n    }\n  }\n\n  if (!canvasContext) {\n    // Inject the canvas element used for computing text widths.\n    const computeCanvas = (document.createElement('canvas'));\n    computeCanvas.className = 'blocklyComputeCanvas';\n    document.body.appendChild(computeCanvas);\n\n    // Initialize the HTML canvas context and set the font.\n    // The context font must match blocklyText's fontsize and font-family\n    // set in CSS.\n    canvasContext = computeCanvas.getContext('2d') as CanvasRenderingContext2D;\n  }\n  // Set the desired font size and family.\n  canvasContext.font = fontWeight + ' ' + fontSize + ' ' + fontFamily;\n\n  // Measure the text width using the helper canvas context.\n  if (text) {\n    width = canvasContext.measureText(text).width;\n  } else {\n    width = 0;\n  }\n\n  // Cache the computed width and return.\n  if (cacheWidths) {\n    cacheWidths[key] = width;\n  }\n  return width;\n}\n\n/**\n * Measure a font's metrics. The height and baseline values.\n *\n * @param text Text to measure the font dimensions of.\n * @param fontSize The font size to use.\n * @param fontWeight The font weight to use.\n * @param fontFamily The font family to use.\n * @returns Font measurements.\n * @alias Blockly.utils.dom.measureFontMetrics\n */\nexport function measureFontMetrics(\n    text: string, fontSize: string, fontWeight: string,\n    fontFamily: string): {height: number, baseline: number} {\n  const span = (document.createElement('span'));\n  span.style.font = fontWeight + ' ' + fontSize + ' ' + fontFamily;\n  span.textContent = text;\n\n  const block = (document.createElement('div'));\n  block.style.width = '1px';\n  block.style.height = '0';\n\n  const div = (document.createElement('div'));\n  div.setAttribute('style', 'position: fixed; top: 0; left: 0; display: flex;');\n  div.appendChild(span);\n  div.appendChild(block);\n\n  document.body.appendChild(div);\n  const result = {\n    height: 0,\n    baseline: 0,\n  };\n  try {\n    div.style.alignItems = 'baseline';\n    result.baseline = block.offsetTop - span.offsetTop;\n    div.style.alignItems = 'flex-end';\n    result.height = block.offsetTop - span.offsetTop;\n  } finally {\n    document.body.removeChild(div);\n  }\n  return result;\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Utility methods for math.\n * These methods are not specific to Blockly, and could be factored out into\n * a JavaScript framework such as Closure.\n *\n * @namespace Blockly.utils.math\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.utils.math');\n\n\n/**\n * Converts degrees to radians.\n * Copied from Closure's goog.math.toRadians.\n *\n * @param angleDegrees Angle in degrees.\n * @returns Angle in radians.\n * @alias Blockly.utils.math.toRadians\n */\nexport function toRadians(angleDegrees: number): number {\n  return angleDegrees * Math.PI / 180;\n}\n\n/**\n * Converts radians to degrees.\n * Copied from Closure's goog.math.toDegrees.\n *\n * @param angleRadians Angle in radians.\n * @returns Angle in degrees.\n * @alias Blockly.utils.math.toDegrees\n */\nexport function toDegrees(angleRadians: number): number {\n  return angleRadians * 180 / Math.PI;\n}\n\n/**\n * Clamp the provided number between the lower bound and the upper bound.\n *\n * @param lowerBound The desired lower bound.\n * @param number The number to clamp.\n * @param upperBound The desired upper bound.\n * @returns The clamped number.\n * @alias Blockly.utils.math.clamp\n */\nexport function clamp(\n    lowerBound: number, number: number, upperBound: number): number {\n  if (upperBound < lowerBound) {\n    const temp = upperBound;\n    upperBound = lowerBound;\n    lowerBound = temp;\n  }\n  return Math.max(lowerBound, Math.min(number, upperBound));\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Utilities for element styles.\n * These methods are not specific to Blockly, and could be factored out into\n * a JavaScript framework such as Closure.\n *\n * @namespace Blockly.utils.style\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.utils.style');\n\nimport * as deprecation from './deprecation.js';\nimport {Coordinate} from './coordinate.js';\nimport {Rect} from './rect.js';\nimport {Size} from './size.js';\n\n\n/**\n * Gets the height and width of an element.\n * Similar to Closure's goog.style.getSize\n *\n * @param element Element to get size of.\n * @returns Object with width/height properties.\n * @alias Blockly.utils.style.getSize\n */\nexport function getSize(element: Element): Size {\n  return TEST_ONLY.getSizeInternal(element);\n}\n\n/**\n * Private version of getSize for stubbing in tests.\n */\nfunction getSizeInternal(element: Element): Size {\n  if (getComputedStyle(element, 'display') !== 'none') {\n    return getSizeWithDisplay(element);\n  }\n\n  // Evaluate size with a temporary element.\n  // AnyDuringMigration because:  Property 'style' does not exist on type\n  // 'Element'.\n  const style = (element as AnyDuringMigration).style;\n  const originalDisplay = style.display;\n  const originalVisibility = style.visibility;\n  const originalPosition = style.position;\n\n  style.visibility = 'hidden';\n  style.position = 'absolute';\n  style.display = 'inline';\n\n  const offsetWidth = (element as HTMLElement).offsetWidth;\n  const offsetHeight = (element as HTMLElement).offsetHeight;\n\n  style.display = originalDisplay;\n  style.position = originalPosition;\n  style.visibility = originalVisibility;\n\n  return new Size(offsetWidth, offsetHeight);\n}\n\n/**\n * Gets the height and width of an element when the display is not none.\n *\n * @param element Element to get size of.\n * @returns Object with width/height properties.\n */\nfunction getSizeWithDisplay(element: Element): Size {\n  const offsetWidth = (element as HTMLElement).offsetWidth;\n  const offsetHeight = (element as HTMLElement).offsetHeight;\n  return new Size(offsetWidth, offsetHeight);\n}\n\n/**\n * Retrieves a computed style value of a node. It returns empty string\n * if the property requested is an SVG one and it has not been\n * explicitly set (firefox and webkit).\n *\n * Copied from Closure's goog.style.getComputedStyle\n *\n * @param element Element to get style of.\n * @param property Property to get (camel-case).\n * @returns Style value.\n * @alias Blockly.utils.style.getComputedStyle\n */\nexport function getComputedStyle(element: Element, property: string): string {\n  const styles = window.getComputedStyle(element);\n  // element.style[..] is undefined for browser specific styles\n  // as 'filter'.\n  return (styles as AnyDuringMigration)[property] ||\n      styles.getPropertyValue(property);\n}\n\n/**\n * Gets the cascaded style value of a node, or null if the value cannot be\n * computed (only Internet Explorer can do this).\n *\n * Copied from Closure's goog.style.getCascadedStyle\n *\n * @param element Element to get style of.\n * @param style Property to get (camel-case).\n * @returns Style value.\n * @deprecated No longer provided by Blockly.\n * @alias Blockly.utils.style.getCascadedStyle\n */\nexport function getCascadedStyle(element: Element, style: string): string {\n  deprecation.warn(\n      'Blockly.utils.style.getCascadedStyle', 'version 9', 'version 10');\n  // AnyDuringMigration because:  Property 'currentStyle' does not exist on type\n  // 'Element'. AnyDuringMigration because:  Property 'currentStyle' does not\n  // exist on type 'Element'.\n  return (element as AnyDuringMigration).currentStyle ?\n      (element as AnyDuringMigration).currentStyle[style] :\n      '' as string;\n}\n\n/**\n * Returns a Coordinate object relative to the top-left of the HTML document.\n * Similar to Closure's goog.style.getPageOffset\n *\n * @param el Element to get the page offset for.\n * @returns The page offset.\n * @alias Blockly.utils.style.getPageOffset\n */\nexport function getPageOffset(el: Element): Coordinate {\n  const pos = new Coordinate(0, 0);\n  const box = el.getBoundingClientRect();\n  const documentElement = document.documentElement;\n  // Must add the scroll coordinates in to get the absolute page offset\n  // of element since getBoundingClientRect returns relative coordinates to\n  // the viewport.\n  const scrollCoord = new Coordinate(\n      window.pageXOffset || documentElement.scrollLeft,\n      window.pageYOffset || documentElement.scrollTop);\n  pos.x = box.left + scrollCoord.x;\n  pos.y = box.top + scrollCoord.y;\n\n  return pos;\n}\n\n/**\n * Calculates the viewport coordinates relative to the document.\n * Similar to Closure's goog.style.getViewportPageOffset\n *\n * @returns The page offset of the viewport.\n * @alias Blockly.utils.style.getViewportPageOffset\n */\nexport function getViewportPageOffset(): Coordinate {\n  const body = document.body;\n  const documentElement = document.documentElement;\n  const scrollLeft = body.scrollLeft || documentElement.scrollLeft;\n  const scrollTop = body.scrollTop || documentElement.scrollTop;\n  return new Coordinate(scrollLeft, scrollTop);\n}\n\n/**\n * Gets the computed border widths (on all sides) in pixels\n * Copied from Closure's goog.style.getBorderBox\n *\n * @param element  The element to get the border widths for.\n * @returns The computed border widths.\n * @alias Blockly.utils.style.getBorderBox\n */\nexport function getBorderBox(element: Element): Rect {\n  const left = parseFloat(getComputedStyle(element, 'borderLeftWidth'));\n  const right = parseFloat(getComputedStyle(element, 'borderRightWidth'));\n  const top = parseFloat(getComputedStyle(element, 'borderTopWidth'));\n  const bottom = parseFloat(getComputedStyle(element, 'borderBottomWidth'));\n\n  return new Rect(top, bottom, left, right);\n}\n\n/**\n * Changes the scroll position of `container` with the minimum amount so\n * that the content and the borders of the given `element` become visible.\n * If the element is bigger than the container, its top left corner will be\n * aligned as close to the container's top left corner as possible.\n * Copied from Closure's goog.style.scrollIntoContainerView\n *\n * @param element The element to make visible.\n * @param container The container to scroll. If not set, then the document\n *     scroll element will be used.\n * @param opt_center Whether to center the element in the container.\n *     Defaults to false.\n * @alias Blockly.utils.style.scrollIntoContainerView\n */\nexport function scrollIntoContainerView(\n    element: Element, container: Element, opt_center?: boolean) {\n  const offset = getContainerOffsetToScrollInto(element, container, opt_center);\n  container.scrollLeft = offset.x;\n  container.scrollTop = offset.y;\n}\n\n/**\n * Calculate the scroll position of `container` with the minimum amount so\n * that the content and the borders of the given `element` become visible.\n * If the element is bigger than the container, its top left corner will be\n * aligned as close to the container's top left corner as possible.\n * Copied from Closure's goog.style.getContainerOffsetToScrollInto\n *\n * @param element The element to make visible.\n * @param container The container to scroll. If not set, then the document\n *     scroll element will be used.\n * @param opt_center Whether to center the element in the container.\n *     Defaults to false.\n * @returns The new scroll position of the container.\n * @alias Blockly.utils.style.getContainerOffsetToScrollInto\n */\nexport function getContainerOffsetToScrollInto(\n    element: Element, container: Element, opt_center?: boolean): Coordinate {\n  // Absolute position of the element's border's top left corner.\n  const elementPos = getPageOffset(element);\n  // Absolute position of the container's border's top left corner.\n  const containerPos = getPageOffset(container);\n  const containerBorder = getBorderBox(container);\n  // Relative pos. of the element's border box to the container's content box.\n  const relX = elementPos.x - containerPos.x - containerBorder.left;\n  const relY = elementPos.y - containerPos.y - containerBorder.top;\n  // How much the element can move in the container, i.e. the difference between\n  // the element's bottom-right-most and top-left-most position where it's\n  // fully visible.\n  const elementSize = getSizeWithDisplay(element);\n  const spaceX = container.clientWidth - elementSize.width;\n  const spaceY = container.clientHeight - elementSize.height;\n  let scrollLeft = container.scrollLeft;\n  let scrollTop = container.scrollTop;\n  if (opt_center) {\n    // All browsers round non-integer scroll positions down.\n    scrollLeft += relX - spaceX / 2;\n    scrollTop += relY - spaceY / 2;\n  } else {\n    // This formula was designed to give the correct scroll values in the\n    // following cases:\n    // - element is higher than container (spaceY < 0) => scroll down by relY\n    // - element is not higher that container (spaceY >= 0):\n    //   - it is above container (relY < 0) => scroll up by abs(relY)\n    //   - it is below container (relY > spaceY) => scroll down by relY - spaceY\n    //   - it is in the container => don't scroll\n    scrollLeft += Math.min(relX, Math.max(relX - spaceX, 0));\n    scrollTop += Math.min(relY, Math.max(relY - spaceY, 0));\n  }\n  return new Coordinate(scrollLeft, scrollTop);\n}\n\nexport const TEST_ONLY = {\n  getSizeInternal,\n};\n","/**\n * @license\n * Copyright 2016 Massachusetts Institute of Technology\n * All rights reserved.\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * A div that floats on top of the workspace, for drop-down menus.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.dropDownDiv');\n\nimport type {BlockSvg} from './block_svg.js';\nimport * as common from './common.js';\nimport * as dom from './utils/dom.js';\nimport type {Field} from './field.js';\nimport * as math from './utils/math.js';\nimport {Rect} from './utils/rect.js';\nimport type {Size} from './utils/size.js';\nimport * as style from './utils/style.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/**\n * Arrow size in px. Should match the value in CSS\n * (need to position pre-render).\n */\nexport const ARROW_SIZE = 16;\n\n/**\n * Drop-down border size in px. Should match the value in CSS (need to position\n * the arrow).\n */\nexport const BORDER_SIZE = 1;\n\n/**\n * Amount the arrow must be kept away from the edges of the main drop-down div,\n * in px.\n */\nexport const ARROW_HORIZONTAL_PADDING = 12;\n\n/** Amount drop-downs should be padded away from the source, in px. */\nexport const PADDING_Y = 16;\n\n/** Length of animations in seconds. */\nexport const ANIMATION_TIME = 0.25;\n\n/**\n * Timer for animation out, to be cleared if we need to immediately hide\n * without disrupting new shows.\n */\nlet animateOutTimer: ReturnType<typeof setTimeout>|null = null;\n\n/** Callback for when the drop-down is hidden. */\nlet onHide: Function|null = null;\n\n/** A class name representing the current owner's workspace renderer. */\nlet renderedClassName = '';\n\n/** A class name representing the current owner's workspace theme. */\nlet themeClassName = '';\n\n/** The content element. */\nlet div: HTMLDivElement;\n\n/** The content element. */\nlet content: HTMLDivElement;\n\n/** The arrow element. */\nlet arrow: HTMLDivElement;\n\n/**\n * Drop-downs will appear within the bounds of this element if possible.\n * Set in setBoundsElement.\n */\nlet boundsElement: Element|null = null;\n\n/** The object currently using the drop-down. */\nlet owner: Field|null = null;\n\n/** Whether the dropdown was positioned to a field or the source block. */\nlet positionToField: boolean|null = null;\n\n/**\n * Dropdown bounds info object used to encapsulate sizing information about a\n * bounding element (bounding box and width/height).\n */\nexport interface BoundsInfo {\n  top: number;\n  left: number;\n  bottom: number;\n  right: number;\n  width: number;\n  height: number;\n}\n\n/** Dropdown position metrics. */\nexport interface PositionMetrics {\n  initialX: number;\n  initialY: number;\n  finalX: number;\n  finalY: number;\n  arrowX: number|null;\n  arrowY: number|null;\n  arrowAtTop: boolean|null;\n  arrowVisible: boolean;\n}\n\n/**\n * Create and insert the DOM element for this div.\n *\n * @internal\n */\nexport function createDom() {\n  if (div) {\n    return;  // Already created.\n  }\n  div = document.createElement('div');\n  div.className = 'blocklyDropDownDiv';\n  const parentDiv = common.getParentContainer() || document.body;\n  parentDiv.appendChild(div);\n\n  content = document.createElement('div');\n  content.className = 'blocklyDropDownContent';\n  div.appendChild(content);\n\n  arrow = document.createElement('div');\n  arrow.className = 'blocklyDropDownArrow';\n  div.appendChild(arrow);\n\n  div.style.opacity = '0';\n  // Transition animation for transform: translate() and opacity.\n  div.style.transition = 'transform ' + ANIMATION_TIME + 's, ' +\n      'opacity ' + ANIMATION_TIME + 's';\n\n  // Handle focusin/out events to add a visual indicator when\n  // a child is focused or blurred.\n  div.addEventListener('focusin', function() {\n    dom.addClass(div, 'blocklyFocused');\n  });\n  div.addEventListener('focusout', function() {\n    dom.removeClass(div, 'blocklyFocused');\n  });\n}\n\n/**\n * Set an element to maintain bounds within. Drop-downs will appear\n * within the box of this element if possible.\n *\n * @param boundsElem Element to bind drop-down to.\n */\nexport function setBoundsElement(boundsElem: Element|null) {\n  boundsElement = boundsElem;\n}\n\n/**\n * @returns The field that currently owns this, or null.\n */\nexport function getOwner(): Field|null {\n  return owner;\n}\n\n/**\n * Provide the div for inserting content into the drop-down.\n *\n * @returns Div to populate with content.\n */\nexport function getContentDiv(): Element {\n  return content;\n}\n\n/** Clear the content of the drop-down. */\nexport function clearContent() {\n  content.textContent = '';\n  content.style.width = '';\n}\n\n/**\n * Set the colour for the drop-down.\n *\n * @param backgroundColour Any CSS colour for the background.\n * @param borderColour Any CSS colour for the border.\n */\nexport function setColour(backgroundColour: string, borderColour: string) {\n  div.style.backgroundColor = backgroundColour;\n  div.style.borderColor = borderColour;\n}\n\n/**\n * Shortcut to show and place the drop-down with positioning determined\n * by a particular block. The primary position will be below the block,\n * and the secondary position above the block. Drop-down will be\n * constrained to the block's workspace.\n *\n * @param field The field showing the drop-down.\n * @param block Block to position the drop-down around.\n * @param opt_onHide Optional callback for when the drop-down is hidden.\n * @param opt_secondaryYOffset Optional Y offset for above-block positioning.\n * @returns True if the menu rendered below block; false if above.\n */\nexport function showPositionedByBlock<T>(\n    field: Field<T>, block: BlockSvg, opt_onHide?: Function,\n    opt_secondaryYOffset?: number): boolean {\n  return showPositionedByRect(\n      getScaledBboxOfBlock(block), field as Field, opt_onHide,\n      opt_secondaryYOffset);\n}\n\n/**\n * Shortcut to show and place the drop-down with positioning determined\n * by a particular field. The primary position will be below the field,\n * and the secondary position above the field. Drop-down will be\n * constrained to the block's workspace.\n *\n * @param field The field to position the dropdown against.\n * @param opt_onHide Optional callback for when the drop-down is hidden.\n * @param opt_secondaryYOffset Optional Y offset for above-block positioning.\n * @returns True if the menu rendered below block; false if above.\n */\nexport function showPositionedByField<T>(\n    field: Field<T>, opt_onHide?: Function,\n    opt_secondaryYOffset?: number): boolean {\n  positionToField = true;\n  return showPositionedByRect(\n      getScaledBboxOfField(field as Field), field as Field, opt_onHide,\n      opt_secondaryYOffset);\n}\n/**\n * Get the scaled bounding box of a block.\n *\n * @param block The block.\n * @returns The scaled bounding box of the block.\n */\nfunction getScaledBboxOfBlock(block: BlockSvg): Rect {\n  const blockSvg = block.getSvgRoot();\n  const scale = block.workspace.scale;\n  const scaledHeight = block.height * scale;\n  const scaledWidth = block.width * scale;\n  const xy = style.getPageOffset(blockSvg);\n  return new Rect(xy.y, xy.y + scaledHeight, xy.x, xy.x + scaledWidth);\n}\n\n/**\n * Get the scaled bounding box of a field.\n *\n * @param field The field.\n * @returns The scaled bounding box of the field.\n */\nfunction getScaledBboxOfField(field: Field): Rect {\n  const bBox = field.getScaledBBox();\n  return new Rect(bBox.top, bBox.bottom, bBox.left, bBox.right);\n}\n\n/**\n * Helper method to show and place the drop-down with positioning determined\n * by a scaled bounding box.  The primary position will be below the rect,\n * and the secondary position above the rect. Drop-down will be constrained to\n * the block's workspace.\n *\n * @param bBox The scaled bounding box.\n * @param field The field to position the dropdown against.\n * @param opt_onHide Optional callback for when the drop-down is hidden.\n * @param opt_secondaryYOffset Optional Y offset for above-block positioning.\n * @returns True if the menu rendered below block; false if above.\n */\nfunction showPositionedByRect(\n    bBox: Rect, field: Field, opt_onHide?: Function,\n    opt_secondaryYOffset?: number): boolean {\n  // If we can fit it, render below the block.\n  const primaryX = bBox.left + (bBox.right - bBox.left) / 2;\n  const primaryY = bBox.bottom;\n  // If we can't fit it, render above the entire parent block.\n  const secondaryX = primaryX;\n  let secondaryY = bBox.top;\n  if (opt_secondaryYOffset) {\n    secondaryY += opt_secondaryYOffset;\n  }\n  const sourceBlock = field.getSourceBlock() as BlockSvg;\n  // Set bounds to main workspace; show the drop-down.\n  let workspace = sourceBlock.workspace;\n  while (workspace.options.parentWorkspace) {\n    workspace = workspace.options.parentWorkspace;\n  }\n  setBoundsElement(workspace.getParentSvg().parentNode as Element | null);\n  return show(\n      field, sourceBlock.RTL, primaryX, primaryY, secondaryX, secondaryY,\n      opt_onHide);\n}\n\n/**\n * Show and place the drop-down.\n * The drop-down is placed with an absolute \"origin point\" (x, y) - i.e.,\n * the arrow will point at this origin and box will positioned below or above\n * it.  If we can maintain the container bounds at the primary point, the arrow\n * will point there, and the container will be positioned below it.\n * If we can't maintain the container bounds at the primary point, fall-back to\n * the secondary point and position above.\n *\n * @param newOwner The object showing the drop-down\n * @param rtl Right-to-left (true) or left-to-right (false).\n * @param primaryX Desired origin point x, in absolute px.\n * @param primaryY Desired origin point y, in absolute px.\n * @param secondaryX Secondary/alternative origin point x, in absolute px.\n * @param secondaryY Secondary/alternative origin point y, in absolute px.\n * @param opt_onHide Optional callback for when the drop-down is hidden.\n * @returns True if the menu rendered at the primary origin point.\n * @internal\n */\nexport function show<T>(\n    newOwner: Field<T>, rtl: boolean, primaryX: number, primaryY: number,\n    secondaryX: number, secondaryY: number, opt_onHide?: Function): boolean {\n  owner = newOwner as Field;\n  onHide = opt_onHide || null;\n  // Set direction.\n  div.style.direction = rtl ? 'rtl' : 'ltr';\n\n  const mainWorkspace = common.getMainWorkspace() as WorkspaceSvg;\n  renderedClassName = mainWorkspace.getRenderer().getClassName();\n  themeClassName = mainWorkspace.getTheme().getClassName();\n  if (renderedClassName) {\n    dom.addClass(div, renderedClassName);\n  }\n  if (themeClassName) {\n    dom.addClass(div, themeClassName);\n  }\n\n  // When we change `translate` multiple times in close succession,\n  // Chrome may choose to wait and apply them all at once.\n  // Since we want the translation to initial X, Y to be immediate,\n  // and the translation to final X, Y to be animated,\n  // we saw problems where both would be applied after animation was turned on,\n  // making the dropdown appear to fly in from (0, 0).\n  // Using both `left`, `top` for the initial translation and then `translate`\n  // for the animated transition to final X, Y is a workaround.\n  return positionInternal(primaryX, primaryY, secondaryX, secondaryY);\n}\n\nconst internal = {\n  /**\n   * Get sizing info about the bounding element.\n   *\n   * @returns An object containing size information about the bounding element\n   *     (bounding box and width/height).\n   */\n  getBoundsInfo: function(): BoundsInfo {\n    const boundPosition = style.getPageOffset(boundsElement as Element);\n    const boundSize = style.getSize(boundsElement as Element);\n\n    return {\n      left: boundPosition.x,\n      right: boundPosition.x + boundSize.width,\n      top: boundPosition.y,\n      bottom: boundPosition.y + boundSize.height,\n      width: boundSize.width,\n      height: boundSize.height,\n    };\n  },\n\n  /**\n   * Helper to position the drop-down and the arrow, maintaining bounds.\n   * See explanation of origin points in show.\n   *\n   * @param primaryX Desired origin point x, in absolute px.\n   * @param primaryY Desired origin point y, in absolute px.\n   * @param secondaryX Secondary/alternative origin point x, in absolute px.\n   * @param secondaryY Secondary/alternative origin point y, in absolute px.\n   * @returns Various final metrics, including rendered positions for drop-down\n   *     and arrow.\n   */\n  getPositionMetrics: function(\n      primaryX: number, primaryY: number, secondaryX: number,\n      secondaryY: number): PositionMetrics {\n    const boundsInfo = internal.getBoundsInfo();\n    const divSize = style.getSize(div as Element);\n\n    // Can we fit in-bounds below the target?\n    if (primaryY + divSize.height < boundsInfo.bottom) {\n      return getPositionBelowMetrics(primaryX, primaryY, boundsInfo, divSize);\n    }\n    // Can we fit in-bounds above the target?\n    if (secondaryY - divSize.height > boundsInfo.top) {\n      return getPositionAboveMetrics(\n          secondaryX, secondaryY, boundsInfo, divSize);\n    }\n    // Can we fit outside the workspace bounds (but inside the window)\n    // below?\n    if (primaryY + divSize.height < document.documentElement.clientHeight) {\n      return getPositionBelowMetrics(primaryX, primaryY, boundsInfo, divSize);\n    }\n    // Can we fit outside the workspace bounds (but inside the window)\n    // above?\n    if (secondaryY - divSize.height > document.documentElement.clientTop) {\n      return getPositionAboveMetrics(\n          secondaryX, secondaryY, boundsInfo, divSize);\n    }\n\n    // Last resort, render at top of page.\n    return getPositionTopOfPageMetrics(primaryX, boundsInfo, divSize);\n  },\n};\n\n/**\n * Get the metrics for positioning the div below the source.\n *\n * @param primaryX Desired origin point x, in absolute px.\n * @param primaryY Desired origin point y, in absolute px.\n * @param boundsInfo An object containing size information about the bounding\n *     element (bounding box and width/height).\n * @param divSize An object containing information about the size of the\n *     DropDownDiv (width & height).\n * @returns Various final metrics, including rendered positions for drop-down\n *     and arrow.\n */\nfunction getPositionBelowMetrics(\n    primaryX: number, primaryY: number, boundsInfo: BoundsInfo,\n    divSize: Size): PositionMetrics {\n  const xCoords =\n      getPositionX(primaryX, boundsInfo.left, boundsInfo.right, divSize.width);\n\n  const arrowY = -(ARROW_SIZE / 2 + BORDER_SIZE);\n  const finalY = primaryY + PADDING_Y;\n\n  return {\n    initialX: xCoords.divX,\n    initialY: primaryY,\n    finalX: xCoords.divX,  // X position remains constant during animation.\n    finalY,\n    arrowX: xCoords.arrowX,\n    arrowY,\n    arrowAtTop: true,\n    arrowVisible: true,\n  };\n}\n\n/**\n * Get the metrics for positioning the div above the source.\n *\n * @param secondaryX Secondary/alternative origin point x, in absolute px.\n * @param secondaryY Secondary/alternative origin point y, in absolute px.\n * @param boundsInfo An object containing size information about the bounding\n *     element (bounding box and width/height).\n * @param divSize An object containing information about the size of the\n *     DropDownDiv (width & height).\n * @returns Various final metrics, including rendered positions for drop-down\n *     and arrow.\n */\nfunction getPositionAboveMetrics(\n    secondaryX: number, secondaryY: number, boundsInfo: BoundsInfo,\n    divSize: Size): PositionMetrics {\n  const xCoords = getPositionX(\n      secondaryX, boundsInfo.left, boundsInfo.right, divSize.width);\n\n  const arrowY = divSize.height - BORDER_SIZE * 2 - ARROW_SIZE / 2;\n  const finalY = secondaryY - divSize.height - PADDING_Y;\n  const initialY = secondaryY - divSize.height;  // No padding on Y.\n\n  return {\n    initialX: xCoords.divX,\n    initialY,\n    finalX: xCoords.divX,  // X position remains constant during animation.\n    finalY,\n    arrowX: xCoords.arrowX,\n    arrowY,\n    arrowAtTop: false,\n    arrowVisible: true,\n  };\n}\n\n/**\n * Get the metrics for positioning the div at the top of the page.\n *\n * @param sourceX Desired origin point x, in absolute px.\n * @param boundsInfo An object containing size information about the bounding\n *     element (bounding box and width/height).\n * @param divSize An object containing information about the size of the\n *     DropDownDiv (width & height).\n * @returns Various final metrics, including rendered positions for drop-down\n *     and arrow.\n */\nfunction getPositionTopOfPageMetrics(\n    sourceX: number, boundsInfo: BoundsInfo, divSize: Size): PositionMetrics {\n  const xCoords =\n      getPositionX(sourceX, boundsInfo.left, boundsInfo.right, divSize.width);\n\n  // No need to provide arrow-specific information because it won't be visible.\n  return {\n    initialX: xCoords.divX,\n    initialY: 0,\n    finalX: xCoords.divX,  // X position remains constant during animation.\n    finalY: 0,             // Y position remains constant during animation.\n    arrowAtTop: null,\n    arrowX: null,\n    arrowY: null,\n    arrowVisible: false,\n  };\n}\n\n/**\n * Get the x positions for the left side of the DropDownDiv and the arrow,\n * accounting for the bounds of the workspace.\n *\n * @param sourceX Desired origin point x, in absolute px.\n * @param boundsLeft The left edge of the bounding element, in absolute px.\n * @param boundsRight The right edge of the bounding element, in absolute px.\n * @param divWidth The width of the div in px.\n * @returns An object containing metrics for the x positions of the left side of\n *     the DropDownDiv and the arrow.\n * @internal\n */\nexport function getPositionX(\n    sourceX: number, boundsLeft: number, boundsRight: number,\n    divWidth: number): {divX: number, arrowX: number} {\n  let divX = sourceX;\n  // Offset the topLeft coord so that the dropdowndiv is centered.\n  divX -= divWidth / 2;\n  // Fit the dropdowndiv within the bounds of the workspace.\n  divX = math.clamp(boundsLeft, divX, boundsRight - divWidth);\n\n  let arrowX = sourceX;\n  // Offset the arrow coord so that the arrow is centered.\n  arrowX -= ARROW_SIZE / 2;\n  // Convert the arrow position to be relative to the top left of the div.\n  let relativeArrowX = arrowX - divX;\n  const horizPadding = ARROW_HORIZONTAL_PADDING;\n  // Clamp the arrow position so that it stays attached to the dropdowndiv.\n  relativeArrowX = math.clamp(\n      horizPadding, relativeArrowX, divWidth - horizPadding - ARROW_SIZE);\n\n  return {arrowX: relativeArrowX, divX};\n}\n\n/**\n * Is the container visible?\n *\n * @returns True if visible.\n */\nexport function isVisible(): boolean {\n  return !!owner;\n}\n\n/**\n * Hide the menu only if it is owned by the provided object.\n *\n * @param divOwner Object which must be owning the drop-down to hide.\n * @param opt_withoutAnimation True if we should hide the dropdown without\n *     animating.\n * @returns True if hidden.\n */\nexport function hideIfOwner<T>(\n    divOwner: Field<T>, opt_withoutAnimation?: boolean): boolean {\n  if (owner === divOwner) {\n    if (opt_withoutAnimation) {\n      hideWithoutAnimation();\n    } else {\n      hide();\n    }\n    return true;\n  }\n  return false;\n}\n\n/** Hide the menu, triggering animation. */\nexport function hide() {\n  // Start the animation by setting the translation and fading out.\n  // Reset to (initialX, initialY) - i.e., no translation.\n  div.style.transform = 'translate(0, 0)';\n  div.style.opacity = '0';\n  // Finish animation - reset all values to default.\n  animateOutTimer = setTimeout(function() {\n    hideWithoutAnimation();\n  }, ANIMATION_TIME * 1000);\n  if (onHide) {\n    onHide();\n    onHide = null;\n  }\n}\n\n/** Hide the menu, without animation. */\nexport function hideWithoutAnimation() {\n  if (!isVisible()) {\n    return;\n  }\n  if (animateOutTimer) {\n    clearTimeout(animateOutTimer);\n  }\n\n  // Reset style properties in case this gets called directly\n  // instead of hide() - see discussion on #2551.\n  div.style.transform = '';\n  div.style.left = '';\n  div.style.top = '';\n  div.style.opacity = '0';\n  div.style.display = 'none';\n  div.style.backgroundColor = '';\n  div.style.borderColor = '';\n\n  if (onHide) {\n    onHide();\n    onHide = null;\n  }\n  clearContent();\n  owner = null;\n\n  if (renderedClassName) {\n    dom.removeClass(div, renderedClassName);\n    renderedClassName = '';\n  }\n  if (themeClassName) {\n    dom.removeClass(div, themeClassName);\n    themeClassName = '';\n  }\n  (common.getMainWorkspace() as WorkspaceSvg).markFocused();\n}\n\n/**\n * Set the dropdown div's position.\n *\n * @param primaryX Desired origin point x, in absolute px.\n * @param primaryY Desired origin point y, in absolute px.\n * @param secondaryX Secondary/alternative origin point x, in absolute px.\n * @param secondaryY Secondary/alternative origin point y, in absolute px.\n * @returns True if the menu rendered at the primary origin point.\n */\nfunction positionInternal(\n    primaryX: number, primaryY: number, secondaryX: number,\n    secondaryY: number): boolean {\n  const metrics =\n      internal.getPositionMetrics(primaryX, primaryY, secondaryX, secondaryY);\n\n  // Update arrow CSS.\n  if (metrics.arrowVisible) {\n    arrow.style.display = '';\n    arrow.style.transform = 'translate(' + metrics.arrowX + 'px,' +\n        metrics.arrowY + 'px) rotate(45deg)';\n    arrow.setAttribute(\n        'class',\n        metrics.arrowAtTop ? 'blocklyDropDownArrow blocklyArrowTop' :\n                             'blocklyDropDownArrow blocklyArrowBottom');\n  } else {\n    arrow.style.display = 'none';\n  }\n\n  const initialX = Math.floor(metrics.initialX);\n  const initialY = Math.floor(metrics.initialY);\n  const finalX = Math.floor(metrics.finalX);\n  const finalY = Math.floor(metrics.finalY);\n\n  // First apply initial translation.\n  div.style.left = initialX + 'px';\n  div.style.top = initialY + 'px';\n\n  // Show the div.\n  div.style.display = 'block';\n  div.style.opacity = '1';\n  // Add final translate, animated through `transition`.\n  // Coordinates are relative to (initialX, initialY),\n  // where the drop-down is absolutely positioned.\n  const dx = finalX - initialX;\n  const dy = finalY - initialY;\n  div.style.transform = 'translate(' + dx + 'px,' + dy + 'px)';\n\n  return !!metrics.arrowAtTop;\n}\n\n/**\n * Repositions the dropdownDiv on window resize. If it doesn't know how to\n * calculate the new position, it will just hide it instead.\n *\n * @internal\n */\nexport function repositionForWindowResize() {\n  // This condition mainly catches the dropdown div when it is being used as a\n  // dropdown.  It is important not to close it in this case because on Android,\n  // when a field is focused, the soft keyboard opens triggering a window resize\n  // event and we want the dropdown div to stick around so users can type into\n  // it.\n  if (owner) {\n    const block = owner.getSourceBlock() as BlockSvg;\n    const bBox = positionToField ? getScaledBboxOfField(owner) :\n                                   getScaledBboxOfBlock(block);\n    // If we can fit it, render below the block.\n    const primaryX = bBox.left + (bBox.right - bBox.left) / 2;\n    const primaryY = bBox.bottom;\n    // If we can't fit it, render above the entire parent block.\n    const secondaryX = primaryX;\n    const secondaryY = bBox.top;\n    positionInternal(primaryX, primaryY, secondaryX, secondaryY);\n  } else {\n    hide();\n  }\n}\n\nexport const TEST_ONLY = internal;\n","/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * This file is a universal registry that provides generic methods\n *    for registering and unregistering different types of classes.\n *\n * @namespace Blockly.registry\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.registry');\n\nimport type {Abstract} from './events/events_abstract.js';\nimport type {Field} from './field.js';\nimport type {IBlockDragger} from './interfaces/i_block_dragger.js';\nimport type {IConnectionChecker} from './interfaces/i_connection_checker.js';\nimport type {IFlyout} from './interfaces/i_flyout.js';\nimport type {IMetricsManager} from './interfaces/i_metrics_manager.js';\nimport type {ISerializer} from './interfaces/i_serializer.js';\nimport type {IToolbox} from './interfaces/i_toolbox.js';\nimport type {Cursor} from './keyboard_nav/cursor.js';\nimport type {Options} from './options.js';\nimport type {Renderer} from './renderers/common/renderer.js';\nimport type {Theme} from './theme.js';\nimport type {ToolboxItem} from './toolbox/toolbox_item.js';\n\n\n/**\n * A map of maps. With the keys being the type and name of the class we are\n * registering and the value being the constructor function.\n * e.g. {'field': {'field_angle': Blockly.FieldAngle}}\n */\nconst typeMap: {\n  [key: string]:\n      {[key: string]: (new () => AnyDuringMigration)|AnyDuringMigration}\n} = Object.create(null);\nexport const TEST_ONLY = {typeMap};\n\n/**\n * A map of maps. With the keys being the type and caseless name of the class we\n * are registring, and the value being the most recent cased name for that\n * registration.\n */\nconst nameMap: {[key: string]: {[key: string]: string}} = Object.create(null);\n\n/**\n * The string used to register the default class for a type of plugin.\n *\n * @alias Blockly.registry.DEFAULT\n */\nexport const DEFAULT = 'default';\n\n/**\n * A name with the type of the element stored in the generic.\n *\n * @alias Blockly.registry.Type\n */\nexport class Type<_T> {\n  /** @param name The name of the registry type. */\n  constructor(private readonly name: string) {}\n\n  /**\n   * Returns the name of the type.\n   *\n   * @returns The name.\n   */\n  toString(): string {\n    return this.name;\n  }\n\n  static CONNECTION_CHECKER = new Type<IConnectionChecker>('connectionChecker');\n\n  static CURSOR = new Type<Cursor>('cursor');\n\n  static EVENT = new Type<Abstract>('event');\n\n  static FIELD = new Type<Field>('field');\n\n  static RENDERER = new Type<Renderer>('renderer');\n\n  static TOOLBOX = new Type<IToolbox>('toolbox');\n\n  static THEME = new Type<Theme>('theme');\n\n  static TOOLBOX_ITEM = new Type<ToolboxItem>('toolboxItem');\n\n  static FLYOUTS_VERTICAL_TOOLBOX = new Type<IFlyout>('flyoutsVerticalToolbox');\n\n  static FLYOUTS_HORIZONTAL_TOOLBOX =\n      new Type<IFlyout>('flyoutsHorizontalToolbox');\n\n  static METRICS_MANAGER = new Type<IMetricsManager>('metricsManager');\n\n  static BLOCK_DRAGGER = new Type<IBlockDragger>('blockDragger');\n\n  /** @internal */\n  static SERIALIZER = new Type<ISerializer>('serializer');\n}\n\n/**\n * Registers a class based on a type and name.\n *\n * @param type The type of the plugin.\n *     (e.g. Field, Renderer)\n * @param name The plugin's name. (Ex. field_angle, geras)\n * @param registryItem The class or object to register.\n * @param opt_allowOverrides True to prevent an error when overriding an already\n *     registered item.\n * @throws {Error} if the type or name is empty, a name with the given type has\n *     already been registered, or if the given class or object is not valid for\n *     its type.\n * @alias Blockly.registry.register\n */\nexport function register<T>(\n    type: string|Type<T>, name: string,\n    registryItem: (new (...p1: AnyDuringMigration[]) => T)|null|\n    AnyDuringMigration,\n    opt_allowOverrides?: boolean): void {\n  if (!(type instanceof Type) && typeof type !== 'string' ||\n      String(type).trim() === '') {\n    throw Error(\n        'Invalid type \"' + type + '\". The type must be a' +\n        ' non-empty string or a Blockly.registry.Type.');\n  }\n  type = String(type).toLowerCase();\n\n  if (typeof name !== 'string' || name.trim() === '') {\n    throw Error(\n        'Invalid name \"' + name + '\". The name must be a' +\n        ' non-empty string.');\n  }\n  const caselessName = name.toLowerCase();\n  if (!registryItem) {\n    throw Error('Can not register a null value');\n  }\n  let typeRegistry = typeMap[type];\n  let nameRegistry = nameMap[type];\n  // If the type registry has not been created, create it.\n  if (!typeRegistry) {\n    typeRegistry = typeMap[type] = Object.create(null);\n    nameRegistry = nameMap[type] = Object.create(null);\n  }\n\n  // Validate that the given class has all the required properties.\n  validate(type, registryItem);\n\n  // Don't throw an error if opt_allowOverrides is true.\n  if (!opt_allowOverrides && typeRegistry[caselessName]) {\n    throw Error(\n        'Name \"' + caselessName + '\" with type \"' + type +\n        '\" already registered.');\n  }\n  typeRegistry[caselessName] = registryItem;\n  nameRegistry[caselessName] = name;\n}\n\n/**\n * Checks the given registry item for properties that are required based on the\n * type.\n *\n * @param type The type of the plugin. (e.g. Field, Renderer)\n * @param registryItem A class or object that we are checking for the required\n *     properties.\n */\nfunction validate(type: string, registryItem: Function|AnyDuringMigration) {\n  switch (type) {\n    case String(Type.FIELD):\n      if (typeof registryItem.fromJson !== 'function') {\n        throw Error('Type \"' + type + '\" must have a fromJson function');\n      }\n      break;\n  }\n}\n\n/**\n * Unregisters the registry item with the given type and name.\n *\n * @param type The type of the plugin.\n *     (e.g. Field, Renderer)\n * @param name The plugin's name. (Ex. field_angle, geras)\n * @alias Blockly.registry.unregister\n */\nexport function unregister<T>(type: string|Type<T>, name: string) {\n  type = String(type).toLowerCase();\n  name = name.toLowerCase();\n  const typeRegistry = typeMap[type];\n  if (!typeRegistry || !typeRegistry[name]) {\n    console.warn(\n        'Unable to unregister [' + name + '][' + type + '] from the ' +\n        'registry.');\n    return;\n  }\n  delete typeMap[type][name];\n  delete nameMap[type][name];\n}\n\n/**\n * Gets the registry item for the given name and type. This can be either a\n * class or an object.\n *\n * @param type The type of the plugin.\n *     (e.g. Field, Renderer)\n * @param name The plugin's name. (Ex. field_angle, geras)\n * @param opt_throwIfMissing Whether or not to throw an error if we are unable\n *     to find the plugin.\n * @returns The class or object with the given name and type or null if none\n *     exists.\n */\nfunction getItem<T>(\n    type: string|Type<T>, name: string, opt_throwIfMissing?: boolean):\n    (new (...p1: AnyDuringMigration[]) => T)|null|AnyDuringMigration {\n  type = String(type).toLowerCase();\n  name = name.toLowerCase();\n  const typeRegistry = typeMap[type];\n  if (!typeRegistry || !typeRegistry[name]) {\n    const msg = 'Unable to find [' + name + '][' + type + '] in the registry.';\n    if (opt_throwIfMissing) {\n      throw new Error(\n          msg + ' You must require or register a ' + type + ' plugin.');\n    } else {\n      console.warn(msg);\n    }\n    return null;\n  }\n  return typeRegistry[name];\n}\n\n/**\n * Returns whether or not the registry contains an item with the given type and\n * name.\n *\n * @param type The type of the plugin.\n *     (e.g. Field, Renderer)\n * @param name The plugin's name. (Ex. field_angle, geras)\n * @returns True if the registry has an item with the given type and name, false\n *     otherwise.\n * @alias Blockly.registry.hasItem\n */\nexport function hasItem<T>(type: string|Type<T>, name: string): boolean {\n  type = String(type).toLowerCase();\n  name = name.toLowerCase();\n  const typeRegistry = typeMap[type];\n  if (!typeRegistry) {\n    return false;\n  }\n  return !!typeRegistry[name];\n}\n\n/**\n * Gets the class for the given name and type.\n *\n * @param type The type of the plugin.\n *     (e.g. Field, Renderer)\n * @param name The plugin's name. (Ex. field_angle, geras)\n * @param opt_throwIfMissing Whether or not to throw an error if we are unable\n *     to find the plugin.\n * @returns The class with the given name and type or null if none exists.\n * @alias Blockly.registry.getClass\n */\nexport function getClass<T>(\n    type: string|Type<T>, name: string, opt_throwIfMissing?: boolean):\n    (new (...p1: AnyDuringMigration[]) => T)|null {\n  return getItem(type, name, opt_throwIfMissing) as (\n             new (...p1: AnyDuringMigration[]) => T) |\n      null;\n}\n\n/**\n * Gets the object for the given name and type.\n *\n * @param type The type of the plugin.\n *     (e.g. Category)\n * @param name The plugin's name. (Ex. logic_category)\n * @param opt_throwIfMissing Whether or not to throw an error if we are unable\n *     to find the object.\n * @returns The object with the given name and type or null if none exists.\n * @alias Blockly.registry.getObject\n */\nexport function getObject<T>(\n    type: string|Type<T>, name: string, opt_throwIfMissing?: boolean): T|null {\n  return getItem(type, name, opt_throwIfMissing) as T;\n}\n\n/**\n * Returns a map of items registered with the given type.\n *\n * @param type The type of the plugin. (e.g. Category)\n * @param opt_cased Whether or not to return a map with cased keys (rather than\n *     caseless keys). False by default.\n * @param opt_throwIfMissing Whether or not to throw an error if we are unable\n *     to find the object. False by default.\n * @returns A map of objects with the given type, or null if none exists.\n * @alias Blockly.registry.getAllItems\n */\nexport function getAllItems<T>(\n    type: string|Type<T>, opt_cased?: boolean, opt_throwIfMissing?: boolean):\n    {[key: string]: T|null|(new (...p1: AnyDuringMigration[]) => T)}|null {\n  type = String(type).toLowerCase();\n  const typeRegistry = typeMap[type];\n  if (!typeRegistry) {\n    const msg = `Unable to find [${type}] in the registry.`;\n    if (opt_throwIfMissing) {\n      throw new Error(`${msg} You must require or register a ${type} plugin.`);\n    } else {\n      console.warn(msg);\n    }\n    return null;\n  }\n  if (!opt_cased) {\n    return typeRegistry;\n  }\n  const nameRegistry = nameMap[type];\n  const casedRegistry = Object.create(null);\n  const keys = Object.keys(typeRegistry);\n  for (let i = 0; i < keys.length; i++) {\n    const key = keys[i];\n    casedRegistry[nameRegistry[key]] = typeRegistry[key];\n  }\n  return casedRegistry;\n}\n\n/**\n * Gets the class from Blockly options for the given type.\n * This is used for plugins that override a built in feature. (e.g. Toolbox)\n *\n * @param type The type of the plugin.\n * @param options The option object to check for the given plugin.\n * @param opt_throwIfMissing Whether or not to throw an error if we are unable\n *     to find the plugin.\n * @returns The class for the plugin.\n * @alias Blockly.registry.getClassFromOptions\n */\nexport function getClassFromOptions<T>(\n    type: Type<T>, options: Options, opt_throwIfMissing?: boolean):\n    (new (...p1: AnyDuringMigration[]) => T)|null {\n  const typeName = type.toString();\n  const plugin = options.plugins[typeName] || DEFAULT;\n\n  // If the user passed in a plugin class instead of a registered plugin name.\n  if (typeof plugin === 'function') {\n    return plugin;\n  }\n  return getClass(type, plugin, opt_throwIfMissing);\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Generators for unique IDs.\n *\n * @namespace Blockly.utils.idGenerator\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.utils.idGenerator');\n\n/**\n * Legal characters for the universally unique IDs.  Should be all on\n * a US keyboard.  No characters that conflict with XML or JSON.\n * Requests to remove additional 'problematic' characters from this\n * soup will be denied.  That's your failure to properly escape in\n * your own environment.  Issues #251, #625, #682, #1304.\n */\nconst soup = '!#$%()*+,-./:;=?@[]^_`{|}~' +\n    'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n\n/**\n * Namespace object for internal implementations we want to be able to\n * stub in tests. Do not use externally.\n *\n * @internal\n */\nconst internal = {\n  /**\n   * Generate a random unique ID.  This should be globally unique.\n   * 87 characters ^ 20 length is greater than 128 bits (better than a UUID).\n   *\n   * @returns A globally unique ID string.\n   */\n  genUid: () => {\n    const length = 20;\n    const soupLength = soup.length;\n    const id = [];\n    for (let i = 0; i < length; i++) {\n      id[i] = soup.charAt(Math.random() * soupLength);\n    }\n    return id.join('');\n  },\n};\nexport const TEST_ONLY = internal;\n\n/** Next unique ID to use. */\nlet nextId = 0;\n\n/**\n * Generate the next unique element IDs.\n * IDs are compatible with the HTML4 'id' attribute restrictions:\n * Use only ASCII letters, digits, '_', '-' and '.'\n *\n * For UUIDs use genUid (below) instead; this ID generator should\n * primarily be used for IDs that end up in the DOM.\n *\n * @returns The next unique identifier.\n * @alias Blockly.utils.idGenerator.getNextUniqueId\n */\nexport function getNextUniqueId(): string {\n  return 'blockly-' + (nextId++).toString(36);\n}\n\n/**\n * Generate a random unique ID.\n *\n * @see internal.genUid\n * @returns A globally unique ID string.\n * @alias Blockly.utils.idGenerator.genUid\n */\nexport function genUid(): string {\n  return internal.genUid();\n}\n","/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Helper methods for events that are fired as a result of\n * actions in Blockly's editor.\n *\n * @namespace Blockly.Events.utils\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events.utils');\n\nimport type {Block} from '../block.js';\nimport * as common from '../common.js';\nimport * as registry from '../registry.js';\nimport * as idGenerator from '../utils/idgenerator.js';\nimport type {Workspace} from '../workspace.js';\nimport type {WorkspaceSvg} from '../workspace_svg.js';\n\nimport type {Abstract} from './events_abstract.js';\nimport type {BlockChange} from './events_block_change.js';\nimport type {BlockCreate} from './events_block_create.js';\nimport type {BlockMove} from './events_block_move.js';\nimport type {CommentCreate} from './events_comment_create.js';\nimport type {CommentMove} from './events_comment_move.js';\nimport type {ViewportChange} from './events_viewport.js';\n\n\n/** Group ID for new events.  Grouped events are indivisible. */\nlet group = '';\n\n/** Sets whether the next event should be added to the undo stack. */\nlet recordUndo = true;\n\n/**\n * Sets whether events should be added to the undo stack.\n *\n * @param newValue True if events should be added to the undo stack.\n * @alias Blockly.Events.utils.setRecordUndo\n */\nexport function setRecordUndo(newValue: boolean) {\n  recordUndo = newValue;\n}\n\n/**\n * Returns whether or not events will be added to the undo stack.\n *\n * @returns True if events will be added to the undo stack.\n * @alias Blockly.Events.utils.getRecordUndo\n */\nexport function getRecordUndo(): boolean {\n  return recordUndo;\n}\n\n/** Allow change events to be created and fired. */\nlet disabled = 0;\n\n/**\n * Name of event that creates a block. Will be deprecated for BLOCK_CREATE.\n *\n * @alias Blockly.Events.utils.CREATE\n */\nexport const CREATE = 'create';\n\n/**\n * Name of event that creates a block.\n *\n * @alias Blockly.Events.utils.BLOCK_CREATE\n */\nexport const BLOCK_CREATE = CREATE;\n\n/**\n * Name of event that deletes a block. Will be deprecated for BLOCK_DELETE.\n *\n * @alias Blockly.Events.utils.DELETE\n */\nexport const DELETE = 'delete';\n\n/**\n * Name of event that deletes a block.\n *\n * @alias Blockly.Events.utils.BLOCK_DELETE\n */\nexport const BLOCK_DELETE = DELETE;\n\n/**\n * Name of event that changes a block. Will be deprecated for BLOCK_CHANGE.\n *\n * @alias Blockly.Events.utils.CHANGE\n */\nexport const CHANGE = 'change';\n\n/**\n * Name of event that changes a block.\n *\n * @alias Blockly.Events.utils.BLOCK_CHANGE\n */\nexport const BLOCK_CHANGE = CHANGE;\n\n/**\n * Name of event that moves a block. Will be deprecated for BLOCK_MOVE.\n *\n * @alias Blockly.Events.utils.MOVE\n */\nexport const MOVE = 'move';\n\n/**\n * Name of event that moves a block.\n *\n * @alias Blockly.Events.utils.BLOCK_MOVE\n */\nexport const BLOCK_MOVE = MOVE;\n\n/**\n * Name of event that creates a variable.\n *\n * @alias Blockly.Events.utils.VAR_CREATE\n */\nexport const VAR_CREATE = 'var_create';\n\n/**\n * Name of event that deletes a variable.\n *\n * @alias Blockly.Events.utils.VAR_DELETE\n */\nexport const VAR_DELETE = 'var_delete';\n\n/**\n * Name of event that renames a variable.\n *\n * @alias Blockly.Events.utils.VAR_RENAME\n */\nexport const VAR_RENAME = 'var_rename';\n\n/**\n * Name of generic event that records a UI change.\n *\n * @alias Blockly.Events.utils.UI\n */\nexport const UI = 'ui';\n\n/**\n * Name of event that record a block drags a block.\n *\n * @alias Blockly.Events.utils.BLOCK_DRAG\n */\nexport const BLOCK_DRAG = 'drag';\n\n/**\n * Name of event that records a change in selected element.\n *\n * @alias Blockly.Events.utils.SELECTED\n */\nexport const SELECTED = 'selected';\n\n/**\n * Name of event that records a click.\n *\n * @alias Blockly.Events.utils.CLICK\n */\nexport const CLICK = 'click';\n\n/**\n * Name of event that records a marker move.\n *\n * @alias Blockly.Events.utils.MARKER_MOVE\n */\nexport const MARKER_MOVE = 'marker_move';\n\n/**\n * Name of event that records a bubble open.\n *\n * @alias Blockly.Events.utils.BUBBLE_OPEN\n */\nexport const BUBBLE_OPEN = 'bubble_open';\n\n/**\n * Name of event that records a trashcan open.\n *\n * @alias Blockly.Events.utils.TRASHCAN_OPEN\n */\nexport const TRASHCAN_OPEN = 'trashcan_open';\n\n/**\n * Name of event that records a toolbox item select.\n *\n * @alias Blockly.Events.utils.TOOLBOX_ITEM_SELECT\n */\nexport const TOOLBOX_ITEM_SELECT = 'toolbox_item_select';\n\n/**\n * Name of event that records a theme change.\n *\n * @alias Blockly.Events.utils.THEME_CHANGE\n */\nexport const THEME_CHANGE = 'theme_change';\n\n/**\n * Name of event that records a viewport change.\n *\n * @alias Blockly.Events.utils.VIEWPORT_CHANGE\n */\nexport const VIEWPORT_CHANGE = 'viewport_change';\n\n/**\n * Name of event that creates a comment.\n *\n * @alias Blockly.Events.utils.COMMENT_CREATE\n */\nexport const COMMENT_CREATE = 'comment_create';\n\n/**\n * Name of event that deletes a comment.\n *\n * @alias Blockly.Events.utils.COMMENT_DELETE\n */\nexport const COMMENT_DELETE = 'comment_delete';\n\n/**\n * Name of event that changes a comment.\n *\n * @alias Blockly.Events.utils.COMMENT_CHANGE\n */\nexport const COMMENT_CHANGE = 'comment_change';\n\n/**\n * Name of event that moves a comment.\n *\n * @alias Blockly.Events.utils.COMMENT_MOVE\n */\nexport const COMMENT_MOVE = 'comment_move';\n\n/**\n * Name of event that records a workspace load.\n *\n * @alias Blockly.Events.utils.FINISHED_LOADING\n */\nexport const FINISHED_LOADING = 'finished_loading';\n\n/** Name of event that creates a procedure model. */\nexport const PROCEDURE_CREATE = 'procedure_create';\n\n/** Name of event that deletes a procedure model. */\nexport const PROCEDURE_DELETE = 'procedure_delete';\n\n/** Name of event that renames a procedure model. */\nexport const PROCEDURE_RENAME = 'procedure_rename';\n\n/** Name of event that enables/disables a procedure model. */\nexport const PROCEDURE_ENABLE = 'procedure_enable';\n\n/** Name of event that changes the returntype of a procedure model. */\nexport const PROCEDURE_CHANGE_RETURN = 'procedure_change_return';\n\n/** Name of event that creates a procedure parameter. */\nexport const PROCEDURE_PARAMETER_CREATE = 'procedure_parameter_create';\n\n/** Name of event that deletes a procedure parameter. */\nexport const PROCEDURE_PARAMETER_DELETE = 'procedure_parameter_delete';\n\n/** Name of event that renames a procedure parameter. */\nexport const PROCEDURE_PARAMETER_RENAME = 'procedure_parameter_rename';\n\n/**\n * Type of events that cause objects to be bumped back into the visible\n * portion of the workspace.\n *\n * Not to be confused with bumping so that disconnected connections do not\n * appear connected.\n *\n * @alias Blockly.Events.utils.BumpEvent\n */\nexport type BumpEvent = BlockCreate|BlockMove|CommentCreate|CommentMove;\n\n/**\n * List of events that cause objects to be bumped back into the visible\n * portion of the workspace.\n *\n * Not to be confused with bumping so that disconnected connections do not\n * appear connected.\n *\n * @alias Blockly.Events.utils.BUMP_EVENTS\n */\nexport const BUMP_EVENTS: string[] =\n    [BLOCK_CREATE, BLOCK_MOVE, COMMENT_CREATE, COMMENT_MOVE];\n\n/** List of events queued for firing. */\nconst FIRE_QUEUE: Abstract[] = [];\n\n/**\n * Create a custom event and fire it.\n *\n * @param event Custom data for event.\n * @alias Blockly.Events.utils.fire\n */\nexport function fire(event: Abstract) {\n  TEST_ONLY.fireInternal(event);\n}\n\n/**\n * Private version of fireInternal for stubbing in tests.\n */\nfunction fireInternal(event: Abstract) {\n  if (!isEnabled()) {\n    return;\n  }\n  if (!FIRE_QUEUE.length) {\n    // First event added; schedule a firing of the event queue.\n    setTimeout(fireNow, 0);\n  }\n  FIRE_QUEUE.push(event);\n}\n\n\n/** Fire all queued events. */\nfunction fireNow() {\n  const queue = filter(FIRE_QUEUE, true);\n  FIRE_QUEUE.length = 0;\n  for (let i = 0, event; event = queue[i]; i++) {\n    if (!event.workspaceId) {\n      continue;\n    }\n    const eventWorkspace = common.getWorkspaceById(event.workspaceId);\n    if (eventWorkspace) {\n      eventWorkspace.fireChangeListener(event);\n    }\n  }\n}\n\n/**\n * Filter the queued events and merge duplicates.\n *\n * @param queueIn Array of events.\n * @param forward True if forward (redo), false if backward (undo).\n * @returns Array of filtered events.\n * @alias Blockly.Events.utils.filter\n */\nexport function filter(queueIn: Abstract[], forward: boolean): Abstract[] {\n  let queue = queueIn.slice();\n  // Shallow copy of queue.\n  if (!forward) {\n    // Undo is merged in reverse order.\n    queue.reverse();\n  }\n  const mergedQueue = [];\n  const hash = Object.create(null);\n  // Merge duplicates.\n  for (let i = 0, event; event = queue[i]; i++) {\n    if (!event.isNull()) {\n      // Treat all UI events as the same type in hash table.\n      const eventType = event.isUiEvent ? UI : event.type;\n      // TODO(#5927): Check whether `blockId` exists before accessing it.\n      const blockId = (event as AnyDuringMigration).blockId;\n      const key = [eventType, blockId, event.workspaceId].join(' ');\n\n      const lastEntry = hash[key];\n      const lastEvent = lastEntry ? lastEntry.event : null;\n      if (!lastEntry) {\n        // Each item in the hash table has the event and the index of that event\n        // in the input array.  This lets us make sure we only merge adjacent\n        // move events.\n        hash[key] = {event, index: i};\n        mergedQueue.push(event);\n      } else if (event.type === MOVE && lastEntry.index === i - 1) {\n        const moveEvent = event as BlockMove;\n        // Merge move events.\n        lastEvent.newParentId = moveEvent.newParentId;\n        lastEvent.newInputName = moveEvent.newInputName;\n        lastEvent.newCoordinate = moveEvent.newCoordinate;\n        lastEntry.index = i;\n      } else if (\n          event.type === CHANGE &&\n          (event as BlockChange).element === lastEvent.element &&\n          (event as BlockChange).name === lastEvent.name) {\n        const changeEvent = event as BlockChange;\n        // Merge change events.\n        lastEvent.newValue = changeEvent.newValue;\n      } else if (event.type === VIEWPORT_CHANGE) {\n        const viewportEvent = event as ViewportChange;\n        // Merge viewport change events.\n        lastEvent.viewTop = viewportEvent.viewTop;\n        lastEvent.viewLeft = viewportEvent.viewLeft;\n        lastEvent.scale = viewportEvent.scale;\n        lastEvent.oldScale = viewportEvent.oldScale;\n      } else if (event.type === CLICK && lastEvent.type === BUBBLE_OPEN) {\n        // Drop click events caused by opening/closing bubbles.\n      } else {\n        // Collision: newer events should merge into this event to maintain\n        // order.\n        hash[key] = {event, index: i};\n        mergedQueue.push(event);\n      }\n    }\n  }\n  // Filter out any events that have become null due to merging.\n  queue = mergedQueue.filter(function(e) {\n    return !e.isNull();\n  });\n  if (!forward) {\n    // Restore undo order.\n    queue.reverse();\n  }\n  // Move mutation events to the top of the queue.\n  // Intentionally skip first event.\n  for (let i = 1, event; event = queue[i]; i++) {\n    // AnyDuringMigration because:  Property 'element' does not exist on type\n    // 'Abstract'.\n    if (event.type === CHANGE &&\n        (event as AnyDuringMigration).element === 'mutation') {\n      queue.unshift(queue.splice(i, 1)[0]);\n    }\n  }\n  return queue;\n}\n\n/**\n * Modify pending undo events so that when they are fired they don't land\n * in the undo stack.  Called by Workspace.clearUndo.\n *\n * @alias Blockly.Events.utils.clearPendingUndo\n */\nexport function clearPendingUndo() {\n  for (let i = 0, event; event = FIRE_QUEUE[i]; i++) {\n    event.recordUndo = false;\n  }\n}\n\n/**\n * Stop sending events.  Every call to this function MUST also call enable.\n *\n * @alias Blockly.Events.utils.disable\n */\nexport function disable() {\n  disabled++;\n}\n\n/**\n * Start sending events.  Unless events were already disabled when the\n * corresponding call to disable was made.\n *\n * @alias Blockly.Events.utils.enable\n */\nexport function enable() {\n  disabled--;\n}\n\n/**\n * Returns whether events may be fired or not.\n *\n * @returns True if enabled.\n * @alias Blockly.Events.utils.isEnabled\n */\nexport function isEnabled(): boolean {\n  return disabled === 0;\n}\n\n/**\n * Current group.\n *\n * @returns ID string.\n * @alias Blockly.Events.utils.getGroup\n */\nexport function getGroup(): string {\n  return group;\n}\n\n/**\n * Start or stop a group.\n *\n * @param state True to start new group, false to end group.\n *   String to set group explicitly.\n * @alias Blockly.Events.utils.setGroup\n */\nexport function setGroup(state: boolean|string) {\n  TEST_ONLY.setGroupInternal(state);\n}\n\n/**\n * Private version of setGroup for stubbing in tests.\n */\nfunction setGroupInternal(state: boolean|string) {\n  if (typeof state === 'boolean') {\n    group = state ? idGenerator.genUid() : '';\n  } else {\n    group = state;\n  }\n}\n\n/**\n * Compute a list of the IDs of the specified block and all its descendants.\n *\n * @param block The root block.\n * @returns List of block IDs.\n * @alias Blockly.Events.utils.getDescendantIds\n * @internal\n */\nexport function getDescendantIds(block: Block): string[] {\n  const ids = [];\n  const descendants = block.getDescendants(false);\n  for (let i = 0, descendant; descendant = descendants[i]; i++) {\n    ids[i] = descendant.id;\n  }\n  return ids;\n}\n\n/**\n * Decode the JSON into an event.\n *\n * @param json JSON representation.\n * @param workspace Target workspace for event.\n * @returns The event represented by the JSON.\n * @throws {Error} if an event type is not found in the registry.\n * @alias Blockly.Events.utils.fromJson\n */\nexport function fromJson(\n    json: AnyDuringMigration, workspace: Workspace): Abstract {\n  const eventClass = get(json['type']);\n  if (!eventClass) throw Error('Unknown event type.');\n\n  if (eventClassHasStaticFromJson(eventClass)) {\n    return (eventClass as any).fromJson(json, workspace);\n  }\n\n  // Fallback to the old deserialization method.\n  const event = new eventClass();\n  event.fromJson(json);\n  event.workspaceId = workspace.id;\n  return event;\n}\n\n/**\n * Returns true if the given event constructor has /its own/ static fromJson\n * method.\n *\n * Returns false if no static fromJson method exists on the contructor, or if\n * the static fromJson method is inheritted.\n */\nfunction eventClassHasStaticFromJson(eventClass: new (...p: any[]) => Abstract):\n    boolean {\n  const untypedEventClass = eventClass as any;\n  return Object.getOwnPropertyDescriptors(untypedEventClass).fromJson &&\n      typeof untypedEventClass.fromJson === 'function';\n}\n\n/**\n * Gets the class for a specific event type from the registry.\n *\n * @param eventType The type of the event to get.\n * @returns The event class with the given type.\n * @alias Blockly.Events.utils.get\n */\nexport function get(eventType: string):\n    (new (...p1: AnyDuringMigration[]) => Abstract) {\n  const event = registry.getClass(registry.Type.EVENT, eventType);\n  if (!event) {\n    throw new Error(`Event type ${eventType} not found in registry.`);\n  }\n  return event;\n}\n\n/**\n * Enable/disable a block depending on whether it is properly connected.\n * Use this on applications where all blocks should be connected to a top block.\n * Recommend setting the 'disable' option to 'false' in the config so that\n * users don't try to re-enable disabled orphan blocks.\n *\n * @param event Custom data for event.\n * @alias Blockly.Events.utils.disableOrphans\n */\nexport function disableOrphans(event: Abstract) {\n  if (event.type === MOVE || event.type === CREATE) {\n    const blockEvent = event as BlockMove | BlockCreate;\n    if (!blockEvent.workspaceId) {\n      return;\n    }\n    const eventWorkspace =\n        common.getWorkspaceById(blockEvent.workspaceId) as WorkspaceSvg;\n    if (!blockEvent.blockId) {\n      throw new Error('Encountered a blockEvent without a proper blockId');\n    }\n    let block = eventWorkspace.getBlockById(blockEvent.blockId);\n    if (block) {\n      // Changing blocks as part of this event shouldn't be undoable.\n      const initialUndoFlag = recordUndo;\n      try {\n        recordUndo = false;\n        const parent = block.getParent();\n        if (parent && parent.isEnabled()) {\n          const children = block.getDescendants(false);\n          for (let i = 0, child; child = children[i]; i++) {\n            child.setEnabled(true);\n          }\n        } else if (\n            (block.outputConnection || block.previousConnection) &&\n            !eventWorkspace.isDragging()) {\n          do {\n            block.setEnabled(false);\n            block = block.getNextBlock();\n          } while (block);\n        }\n      } finally {\n        recordUndo = initialUndoFlag;\n      }\n    }\n  }\n}\n\nexport const TEST_ONLY = {\n  FIRE_QUEUE,\n  fireNow,\n  fireInternal,\n  setGroupInternal,\n};\n","/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * XML element manipulation.\n * These methods are not specific to Blockly, and could be factored out into\n * a JavaScript framework such as Closure.\n *\n * @namespace Blockly.utils.xml\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.utils.xml');\n\n\n/**\n * Namespace for Blockly's XML.\n *\n * @alias Blockly.utils.xml.NAME_SPACE\n */\nexport const NAME_SPACE = 'https://developers.google.com/blockly/xml';\n\n/**\n * The Document object to use.  By default this is just document, but\n * the Node.js build of Blockly (see scripts/package/node/core.js)\n * calls setDocument to supply a Document implementation from the\n * jsdom package instead.\n */\nlet xmlDocument: Document = globalThis['document'];\n\n/**\n * Get the document object to use for XML serialization.\n *\n * @returns The document object.\n * @alias Blockly.utils.xml.getDocument\n */\nexport function getDocument(): Document {\n  return xmlDocument;\n}\n\n/**\n * Get the document object to use for XML serialization.\n *\n * @param document The document object to use.\n * @alias Blockly.utils.xml.setDocument\n */\nexport function setDocument(document: Document) {\n  xmlDocument = document;\n}\n\n/**\n * Create DOM element for XML.\n *\n * @param tagName Name of DOM element.\n * @returns New DOM element.\n * @alias Blockly.utils.xml.createElement\n */\nexport function createElement(tagName: string): Element {\n  return xmlDocument.createElementNS(NAME_SPACE, tagName);\n}\n\n/**\n * Create text element for XML.\n *\n * @param text Text content.\n * @returns New DOM text node.\n * @alias Blockly.utils.xml.createTextNode\n */\nexport function createTextNode(text: string): Text {\n  return xmlDocument.createTextNode(text);\n}\n\n/**\n * Converts an XML string into a DOM tree.\n *\n * @param text XML string.\n * @returns The DOM document.\n * @throws if XML doesn't parse.\n * @alias Blockly.utils.xml.textToDomDocument\n */\nexport function textToDomDocument(text: string): Document {\n  const oParser = new DOMParser();\n  return oParser.parseFromString(text, 'text/xml');\n}\n\n/**\n * Converts a DOM structure into plain text.\n * Currently the text format is fairly ugly: all one line with no whitespace.\n *\n * @param dom A tree of XML nodes.\n * @returns Text representation.\n * @alias Blockly.utils.xml.domToText\n */\nexport function domToText(dom: Node): string {\n  const oSerializer = new XMLSerializer();\n  return oSerializer.serializeToString(dom);\n}\n","/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Wrapper functions around JS functions for showing alert/confirmation dialogs.\n *\n * @namespace Blockly.dialog\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.dialog');\n\n\nlet alertImplementation = function(message: string, opt_callback?: () => void) {\n  window.alert(message);\n  if (opt_callback) {\n    opt_callback();\n  }\n};\n\nlet confirmImplementation = function(\n    message: string, callback: (result: boolean) => void) {\n  callback(window.confirm(message));\n};\n\nlet promptImplementation = function(\n    message: string, defaultValue: string,\n    callback: (result: string|null) => void) {\n  callback(window.prompt(message, defaultValue));\n};\n\n/**\n * Wrapper to window.alert() that app developers may override via setAlert to\n * provide alternatives to the modal browser window.\n *\n * @param message The message to display to the user.\n * @param opt_callback The callback when the alert is dismissed.\n * @alias Blockly.dialog.alert\n */\nexport function alert(message: string, opt_callback?: () => void) {\n  alertImplementation(message, opt_callback);\n}\n\n/**\n * Sets the function to be run when Blockly.dialog.alert() is called.\n *\n * @param alertFunction The function to be run.\n * @see Blockly.dialog.alert\n * @alias Blockly.dialog.setAlert\n */\nexport function setAlert(alertFunction: (p1: string, p2?: () => void) => void) {\n  alertImplementation = alertFunction;\n}\n\n/**\n * Wrapper to window.confirm() that app developers may override via setConfirm\n * to provide alternatives to the modal browser window.\n *\n * @param message The message to display to the user.\n * @param callback The callback for handling user response.\n * @alias Blockly.dialog.confirm\n */\nexport function confirm(message: string, callback: (p1: boolean) => void) {\n  TEST_ONLY.confirmInternal(message, callback);\n}\n\n/**\n * Private version of confirm for stubbing in tests.\n */\nfunction confirmInternal(message: string, callback: (p1: boolean) => void) {\n  confirmImplementation(message, callback);\n}\n\n\n/**\n * Sets the function to be run when Blockly.dialog.confirm() is called.\n *\n * @param confirmFunction The function to be run.\n * @see Blockly.dialog.confirm\n * @alias Blockly.dialog.setConfirm\n */\nexport function setConfirm(\n    confirmFunction: (p1: string, p2: (p1: boolean) => void) => void) {\n  confirmImplementation = confirmFunction;\n}\n\n/**\n * Wrapper to window.prompt() that app developers may override via setPrompt to\n * provide alternatives to the modal browser window. Built-in browser prompts\n * are often used for better text input experience on mobile device. We strongly\n * recommend testing mobile when overriding this.\n *\n * @param message The message to display to the user.\n * @param defaultValue The value to initialize the prompt with.\n * @param callback The callback for handling user response.\n * @alias Blockly.dialog.prompt\n */\nexport function prompt(\n    message: string, defaultValue: string,\n    callback: (p1: string|null) => void) {\n  promptImplementation(message, defaultValue, callback);\n}\n\n/**\n * Sets the function to be run when Blockly.dialog.prompt() is called.\n *\n * @param promptFunction The function to be run.\n * @see Blockly.dialog.prompt\n * @alias Blockly.dialog.setPrompt\n */\nexport function setPrompt(\n    promptFunction: (p1: string, p2: string, p3: (p1: string|null) => void) =>\n        void) {\n  promptImplementation = promptFunction;\n}\n\nexport const TEST_ONLY = {\n  confirmInternal,\n};\n","/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Utility functions for handling variables.\n *\n * @namespace Blockly.Variables\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Variables');\n\nimport {Blocks} from './blocks.js';\nimport * as dialog from './dialog.js';\nimport {Msg} from './msg.js';\nimport * as utilsXml from './utils/xml.js';\nimport {VariableModel} from './variable_model.js';\nimport type {Workspace} from './workspace.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\nimport * as Xml from './xml.js';\n\n\n/**\n * String for use in the \"custom\" attribute of a category in toolbox XML.\n * This string indicates that the category should be dynamically populated with\n * variable blocks.\n * See also Blockly.Procedures.CATEGORY_NAME and\n * Blockly.VariablesDynamic.CATEGORY_NAME.\n *\n * @alias Blockly.Variables.CATEGORY_NAME\n */\nexport const CATEGORY_NAME = 'VARIABLE';\n\n/**\n * Find all user-created variables that are in use in the workspace.\n * For use by generators.\n * To get a list of all variables on a workspace, including unused variables,\n * call Workspace.getAllVariables.\n *\n * @param ws The workspace to search for variables.\n * @returns Array of variable models.\n * @alias Blockly.Variables.allUsedVarModels\n */\nexport function allUsedVarModels(ws: Workspace): VariableModel[] {\n  const blocks = ws.getAllBlocks(false);\n  const variables = new Set<VariableModel>();\n  // Iterate through every block and add each variable to the set.\n  for (let i = 0; i < blocks.length; i++) {\n    const blockVariables = blocks[i].getVarModels();\n    if (blockVariables) {\n      for (let j = 0; j < blockVariables.length; j++) {\n        const variable = blockVariables[j];\n        const id = variable.getId();\n        if (id) {\n          variables.add(variable);\n        }\n      }\n    }\n  }\n  // Convert the set into a list.\n  return Array.from(variables.values());\n}\n\n/**\n * Find all developer variables used by blocks in the workspace.\n * Developer variables are never shown to the user, but are declared as global\n * variables in the generated code.\n * To declare developer variables, define the getDeveloperVariables function on\n * your block and return a list of variable names.\n * For use by generators.\n *\n * @param workspace The workspace to search.\n * @returns A list of non-duplicated variable names.\n * @alias Blockly.Variables.allDeveloperVariables\n */\nexport function allDeveloperVariables(workspace: Workspace): string[] {\n  const blocks = workspace.getAllBlocks(false);\n  const variables = new Set<string>();\n  for (let i = 0, block; block = blocks[i]; i++) {\n    const getDeveloperVariables = block.getDeveloperVariables;\n    if (getDeveloperVariables) {\n      const devVars = getDeveloperVariables();\n      for (let j = 0; j < devVars.length; j++) {\n        variables.add(devVars[j]);\n      }\n    }\n  }\n  // Convert the set into a list.\n  return Array.from(variables.values());\n}\n\n/**\n * Construct the elements (blocks and button) required by the flyout for the\n * variable category.\n *\n * @param workspace The workspace containing variables.\n * @returns Array of XML elements.\n * @alias Blockly.Variables.flyoutCategory\n */\nexport function flyoutCategory(workspace: WorkspaceSvg): Element[] {\n  let xmlList = new Array<Element>();\n  const button = document.createElement('button');\n  button.setAttribute('text', '%{BKY_NEW_VARIABLE}');\n  button.setAttribute('callbackKey', 'CREATE_VARIABLE');\n\n  workspace.registerButtonCallback('CREATE_VARIABLE', function(button) {\n    createVariableButtonHandler(button.getTargetWorkspace());\n  });\n\n  xmlList.push(button);\n\n  const blockList = flyoutCategoryBlocks(workspace);\n  xmlList = xmlList.concat(blockList);\n  return xmlList;\n}\n\n/**\n * Construct the blocks required by the flyout for the variable category.\n *\n * @param workspace The workspace containing variables.\n * @returns Array of XML block elements.\n * @alias Blockly.Variables.flyoutCategoryBlocks\n */\nexport function flyoutCategoryBlocks(workspace: Workspace): Element[] {\n  const variableModelList = workspace.getVariablesOfType('');\n\n  const xmlList = [];\n  if (variableModelList.length > 0) {\n    // New variables are added to the end of the variableModelList.\n    const mostRecentVariable = variableModelList[variableModelList.length - 1];\n    if (Blocks['variables_set']) {\n      const block = utilsXml.createElement('block');\n      block.setAttribute('type', 'variables_set');\n      block.setAttribute('gap', Blocks['math_change'] ? '8' : '24');\n      block.appendChild(generateVariableFieldDom(mostRecentVariable));\n      xmlList.push(block);\n    }\n    if (Blocks['math_change']) {\n      const block = utilsXml.createElement('block');\n      block.setAttribute('type', 'math_change');\n      block.setAttribute('gap', Blocks['variables_get'] ? '20' : '8');\n      block.appendChild(generateVariableFieldDom(mostRecentVariable));\n      const value = Xml.textToDom(\n          '<value name=\"DELTA\">' +\n          '<shadow type=\"math_number\">' +\n          '<field name=\"NUM\">1</field>' +\n          '</shadow>' +\n          '</value>');\n      block.appendChild(value);\n      xmlList.push(block);\n    }\n\n    if (Blocks['variables_get']) {\n      variableModelList.sort(VariableModel.compareByName);\n      for (let i = 0, variable; variable = variableModelList[i]; i++) {\n        const block = utilsXml.createElement('block');\n        block.setAttribute('type', 'variables_get');\n        block.setAttribute('gap', '8');\n        block.appendChild(generateVariableFieldDom(variable));\n        xmlList.push(block);\n      }\n    }\n  }\n  return xmlList;\n}\n\n/** @alias Blockly.Variables.VAR_LETTER_OPTIONS */\nexport const VAR_LETTER_OPTIONS = 'ijkmnopqrstuvwxyzabcdefgh';\n\n/**\n * Return a new variable name that is not yet being used. This will try to\n * generate single letter variable names in the range 'i' to 'z' to start with.\n * If no unique name is located it will try 'i' to 'z', 'a' to 'h',\n * then 'i2' to 'z2' etc.  Skip 'l'.\n *\n * @param workspace The workspace to be unique in.\n * @returns New variable name.\n * @alias Blockly.Variables.generateUniqueName\n */\nexport function generateUniqueName(workspace: Workspace): string {\n  return TEST_ONLY.generateUniqueNameInternal(workspace);\n}\n\n/**\n * Private version of generateUniqueName for stubbing in tests.\n */\nfunction generateUniqueNameInternal(workspace: Workspace): string {\n  return generateUniqueNameFromOptions(\n      VAR_LETTER_OPTIONS.charAt(0), workspace.getAllVariableNames());\n}\n\n/**\n * Returns a unique name that is not present in the usedNames array. This\n * will try to generate single letter names in the range a - z (skip l). It\n * will start with the character passed to startChar.\n *\n * @param startChar The character to start the search at.\n * @param usedNames A list of all of the used names.\n * @returns A unique name that is not present in the usedNames array.\n * @alias Blockly.Variables.generateUniqueNameFromOptions\n */\nexport function generateUniqueNameFromOptions(\n    startChar: string, usedNames: string[]): string {\n  if (!usedNames.length) {\n    return startChar;\n  }\n\n  const letters = VAR_LETTER_OPTIONS;\n  let suffix = '';\n  let letterIndex = letters.indexOf(startChar);\n  let potName = startChar;\n\n  // eslint-disable-next-line no-constant-condition\n  while (true) {\n    let inUse = false;\n    for (let i = 0; i < usedNames.length; i++) {\n      if (usedNames[i].toLowerCase() === potName) {\n        inUse = true;\n        break;\n      }\n    }\n    if (!inUse) {\n      break;\n    }\n\n    letterIndex++;\n    if (letterIndex === letters.length) {\n      // Reached the end of the character sequence so back to 'i'.\n      letterIndex = 0;\n      suffix = `${Number(suffix) + 1}`;\n    }\n    potName = letters.charAt(letterIndex) + suffix;\n  }\n  return potName;\n}\n\n/**\n * Handles \"Create Variable\" button in the default variables toolbox category.\n * It will prompt the user for a variable name, including re-prompts if a name\n * is already in use among the workspace's variables.\n *\n * Custom button handlers can delegate to this function, allowing variables\n * types and after-creation processing. More complex customization (e.g.,\n * prompting for variable type) is beyond the scope of this function.\n *\n * @param workspace The workspace on which to create the variable.\n * @param opt_callback A callback. It will be passed an acceptable new variable\n *     name, or null if change is to be aborted (cancel button), or undefined if\n *     an existing variable was chosen.\n * @param opt_type The type of the variable like 'int', 'string', or ''. This\n *     will default to '', which is a specific type.\n * @alias Blockly.Variables.createVariableButtonHandler\n */\nexport function createVariableButtonHandler(\n    workspace: Workspace, opt_callback?: (p1?: string|null) => void,\n    opt_type?: string) {\n  const type = opt_type || '';\n  // This function needs to be named so it can be called recursively.\n  function promptAndCheckWithAlert(defaultName: string) {\n    promptName(Msg['NEW_VARIABLE_TITLE'], defaultName, function(text) {\n      if (text) {\n        const existing = nameUsedWithAnyType(text, workspace);\n        if (existing) {\n          let msg;\n          if (existing.type === type) {\n            msg = Msg['VARIABLE_ALREADY_EXISTS'].replace('%1', existing.name);\n          } else {\n            msg = Msg['VARIABLE_ALREADY_EXISTS_FOR_ANOTHER_TYPE'];\n            msg = msg.replace('%1', existing.name).replace('%2', existing.type);\n          }\n          dialog.alert(msg, function() {\n            promptAndCheckWithAlert(text);\n          });\n        } else {\n          // No conflict\n          workspace.createVariable(text, type);\n          if (opt_callback) {\n            opt_callback(text);\n          }\n        }\n      } else {\n        // User canceled prompt.\n        if (opt_callback) {\n          opt_callback(null);\n        }\n      }\n    });\n  }\n  promptAndCheckWithAlert('');\n}\n\n/**\n * Opens a prompt that allows the user to enter a new name for a variable.\n * Triggers a rename if the new name is valid. Or re-prompts if there is a\n * collision.\n *\n * @param workspace The workspace on which to rename the variable.\n * @param variable Variable to rename.\n * @param opt_callback A callback. It will be passed an acceptable new variable\n *     name, or null if change is to be aborted (cancel button), or undefined if\n *     an existing variable was chosen.\n * @alias Blockly.Variables.renameVariable\n */\nexport function renameVariable(\n    workspace: Workspace, variable: VariableModel,\n    opt_callback?: (p1?: string|null) => void) {\n  // This function needs to be named so it can be called recursively.\n  function promptAndCheckWithAlert(defaultName: string) {\n    const promptText =\n        Msg['RENAME_VARIABLE_TITLE'].replace('%1', variable.name);\n    promptName(promptText, defaultName, function(newName) {\n      if (newName) {\n        const existing =\n            nameUsedWithOtherType(newName, variable.type, workspace);\n        if (existing) {\n          const msg = Msg['VARIABLE_ALREADY_EXISTS_FOR_ANOTHER_TYPE']\n                          .replace('%1', existing.name)\n                          .replace('%2', existing.type);\n          dialog.alert(msg, function() {\n            promptAndCheckWithAlert(newName);\n          });\n        } else {\n          workspace.renameVariableById(variable.getId(), newName);\n          if (opt_callback) {\n            opt_callback(newName);\n          }\n        }\n      } else {\n        // User canceled prompt.\n        if (opt_callback) {\n          opt_callback(null);\n        }\n      }\n    });\n  }\n  promptAndCheckWithAlert('');\n}\n\n/**\n * Prompt the user for a new variable name.\n *\n * @param promptText The string of the prompt.\n * @param defaultText The default value to show in the prompt's field.\n * @param callback A callback. It will be passed the new variable name, or null\n *     if the user picked something illegal.\n * @alias Blockly.Variables.promptName\n */\nexport function promptName(\n    promptText: string, defaultText: string,\n    callback: (p1: string|null) => void) {\n  dialog.prompt(promptText, defaultText, function(newVar) {\n    // Merge runs of whitespace.  Strip leading and trailing whitespace.\n    // Beyond this, all names are legal.\n    if (newVar) {\n      newVar = newVar.replace(/[\\s\\xa0]+/g, ' ').trim();\n      if (newVar === Msg['RENAME_VARIABLE'] || newVar === Msg['NEW_VARIABLE']) {\n        // Ok, not ALL names are legal...\n        newVar = null;\n      }\n    }\n    callback(newVar);\n  });\n}\n/**\n * Check whether there exists a variable with the given name but a different\n * type.\n *\n * @param name The name to search for.\n * @param type The type to exclude from the search.\n * @param workspace The workspace to search for the variable.\n * @returns The variable with the given name and a different type, or null if\n *     none was found.\n */\nfunction nameUsedWithOtherType(\n    name: string, type: string, workspace: Workspace): VariableModel|null {\n  const allVariables = workspace.getVariableMap().getAllVariables();\n\n  name = name.toLowerCase();\n  for (let i = 0, variable; variable = allVariables[i]; i++) {\n    if (variable.name.toLowerCase() === name && variable.type !== type) {\n      return variable;\n    }\n  }\n  return null;\n}\n\n/**\n * Check whether there exists a variable with the given name of any type.\n *\n * @param name The name to search for.\n * @param workspace The workspace to search for the variable.\n * @returns The variable with the given name, or null if none was found.\n * @alias Blockly.Variables.nameUsedWithAnyType\n */\nexport function nameUsedWithAnyType(\n    name: string, workspace: Workspace): VariableModel|null {\n  const allVariables = workspace.getVariableMap().getAllVariables();\n\n  name = name.toLowerCase();\n  for (let i = 0, variable; variable = allVariables[i]; i++) {\n    if (variable.name.toLowerCase() === name) {\n      return variable;\n    }\n  }\n  return null;\n}\n\n/**\n * Generate DOM objects representing a variable field.\n *\n * @param variableModel The variable model to represent.\n * @returns The generated DOM.\n * @alias Blockly.Variables.generateVariableFieldDom\n */\nexport function generateVariableFieldDom(variableModel: VariableModel):\n    Element {\n  /* Generates the following XML:\n   * <field name=\"VAR\" id=\"goKTKmYJ8DhVHpruv\" variabletype=\"int\">foo</field>\n   */\n  const field = utilsXml.createElement('field');\n  field.setAttribute('name', 'VAR');\n  field.setAttribute('id', variableModel.getId());\n  field.setAttribute('variabletype', variableModel.type);\n  const name = utilsXml.createTextNode(variableModel.name);\n  field.appendChild(name);\n  return field;\n}\n\n/**\n * Helper function to look up or create a variable on the given workspace.\n * If no variable exists, creates and returns it.\n *\n * @param workspace The workspace to search for the variable.  It may be a\n *     flyout workspace or main workspace.\n * @param id The ID to use to look up or create the variable, or null.\n * @param opt_name The string to use to look up or create the variable.\n * @param opt_type The type to use to look up or create the variable.\n * @returns The variable corresponding to the given ID or name + type\n *     combination.\n * @alias Blockly.Variables.getOrCreateVariablePackage\n */\nexport function getOrCreateVariablePackage(\n    workspace: Workspace, id: string|null, opt_name?: string,\n    opt_type?: string): VariableModel {\n  let variable = getVariable(workspace, id, opt_name, opt_type);\n  if (!variable) {\n    variable = createVariable(workspace, id, opt_name, opt_type);\n  }\n  return variable;\n}\n\n/**\n * Look up  a variable on the given workspace.\n * Always looks in the main workspace before looking in the flyout workspace.\n * Always prefers lookup by ID to lookup by name + type.\n *\n * @param workspace The workspace to search for the variable.  It may be a\n *     flyout workspace or main workspace.\n * @param id The ID to use to look up the variable, or null.\n * @param opt_name The string to use to look up the variable.\n *     Only used if lookup by ID fails.\n * @param opt_type The type to use to look up the variable.\n *     Only used if lookup by ID fails.\n * @returns The variable corresponding to the given ID or name + type\n *     combination, or null if not found.\n * @alias Blockly.Variables.getVariable\n */\nexport function getVariable(\n    workspace: Workspace, id: string|null, opt_name?: string,\n    opt_type?: string): VariableModel|null {\n  const potentialVariableMap = workspace.getPotentialVariableMap();\n  let variable = null;\n  // Try to just get the variable, by ID if possible.\n  if (id) {\n    // Look in the real variable map before checking the potential variable map.\n    variable = workspace.getVariableById(id);\n    if (!variable && potentialVariableMap) {\n      variable = potentialVariableMap.getVariableById(id);\n    }\n    if (variable) {\n      return variable;\n    }\n  }\n  // If there was no ID, or there was an ID but it didn't match any variables,\n  // look up by name and type.\n  if (opt_name) {\n    if (opt_type === undefined) {\n      throw Error('Tried to look up a variable by name without a type');\n    }\n    // Otherwise look up by name and type.\n    variable = workspace.getVariable(opt_name, opt_type);\n    if (!variable && potentialVariableMap) {\n      variable = potentialVariableMap.getVariable(opt_name, opt_type);\n    }\n  }\n  return variable;\n}\n\n/**\n * Helper function to create a variable on the given workspace.\n *\n * @param workspace The workspace in which to create the variable.  It may be a\n *     flyout workspace or main workspace.\n * @param id The ID to use to create the variable, or null.\n * @param opt_name The string to use to create the variable.\n * @param opt_type The type to use to create the variable.\n * @returns The variable corresponding to the given ID or name + type\n *     combination.\n */\nfunction createVariable(\n    workspace: Workspace, id: string|null, opt_name?: string,\n    opt_type?: string): VariableModel {\n  const potentialVariableMap = workspace.getPotentialVariableMap();\n  // Variables without names get uniquely named for this workspace.\n  if (!opt_name) {\n    const ws =\n        (workspace.isFlyout ? (workspace as WorkspaceSvg).targetWorkspace :\n                              workspace);\n    opt_name = generateUniqueName(ws!);\n  }\n\n  // Create a potential variable if in the flyout.\n  let variable = null;\n  if (potentialVariableMap) {\n    variable = potentialVariableMap.createVariable(opt_name, opt_type, id);\n  } else {\n    // In the main workspace, create a real variable.\n    variable = workspace.createVariable(opt_name, opt_type, id);\n  }\n  return variable;\n}\n\n/**\n * Helper function to get the list of variables that have been added to the\n * workspace after adding a new block, using the given list of variables that\n * were in the workspace before the new block was added.\n *\n * @param workspace The workspace to inspect.\n * @param originalVariables The array of variables that existed in the workspace\n *     before adding the new block.\n * @returns The new array of variables that were freshly added to the workspace\n *     after creating the new block, or [] if no new variables were added to the\n *     workspace.\n * @alias Blockly.Variables.getAddedVariables\n * @internal\n */\nexport function getAddedVariables(\n    workspace: Workspace, originalVariables: VariableModel[]): VariableModel[] {\n  const allCurrentVariables = workspace.getAllVariables();\n  const addedVariables = [];\n  if (originalVariables.length !== allCurrentVariables.length) {\n    for (let i = 0; i < allCurrentVariables.length; i++) {\n      const variable = allCurrentVariables[i];\n      // For any variable that is present in allCurrentVariables but not\n      // present in originalVariables, add the variable to addedVariables.\n      if (originalVariables.indexOf(variable) === -1) {\n        addedVariables.push(variable);\n      }\n    }\n  }\n  return addedVariables;\n}\n\nexport const TEST_ONLY = {\n  generateUniqueNameInternal,\n};\n","/**\n * @license\n * Copyright 2013 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Inject Blockly's CSS synchronously.\n *\n * @namespace Blockly.Css\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Css');\n\n\n/** Has CSS already been injected? */\nlet injected = false;\n\n/**\n * Add some CSS to the blob that will be injected later.  Allows optional\n * components such as fields and the toolbox to store separate CSS.\n *\n * @param cssContent Multiline CSS string or an array of single lines of CSS.\n * @alias Blockly.Css.register\n */\nexport function register(cssContent: string) {\n  if (injected) {\n    throw Error('CSS already injected');\n  }\n  content += '\\n' + cssContent;\n}\n\n/**\n * Inject the CSS into the DOM.  This is preferable over using a regular CSS\n * file since:\n * a) It loads synchronously and doesn't force a redraw later.\n * b) It speeds up loading by not blocking on a separate HTTP transfer.\n * c) The CSS content may be made dynamic depending on init options.\n *\n * @param hasCss If false, don't inject CSS (providing CSS becomes the\n *     document's responsibility).\n * @param pathToMedia Path from page to the Blockly media directory.\n * @alias Blockly.Css.inject\n */\nexport function inject(hasCss: boolean, pathToMedia: string) {\n  // Only inject the CSS once.\n  if (injected) {\n    return;\n  }\n  injected = true;\n  if (!hasCss) {\n    return;\n  }\n  // Strip off any trailing slash (either Unix or Windows).\n  const mediaPath = pathToMedia.replace(/[\\\\/]$/, '');\n  const cssContent = content.replace(/<<<PATH>>>/g, mediaPath);\n  // Cleanup the collected css content after injecting it to the DOM.\n  content = '';\n\n  // Inject CSS tag at start of head.\n  const cssNode = document.createElement('style');\n  cssNode.id = 'blockly-common-style';\n  const cssTextNode = document.createTextNode(cssContent);\n  cssNode.appendChild(cssTextNode);\n  document.head.insertBefore(cssNode, document.head.firstChild);\n}\n\n/**\n * The CSS content for Blockly.\n *\n * @alias Blockly.Css.content\n */\nlet content = `\n.blocklySvg {\n  background-color: #fff;\n  outline: none;\n  overflow: hidden;  /* IE overflows by default. */\n  position: absolute;\n  display: block;\n}\n\n.blocklyWidgetDiv {\n  display: none;\n  position: absolute;\n  z-index: 99999;  /* big value for bootstrap3 compatibility */\n}\n\n.injectionDiv {\n  height: 100%;\n  position: relative;\n  overflow: hidden;  /* So blocks in drag surface disappear at edges */\n  touch-action: none;\n}\n\n.blocklyNonSelectable {\n  user-select: none;\n  -ms-user-select: none;\n  -webkit-user-select: none;\n}\n\n.blocklyWsDragSurface {\n  display: none;\n  position: absolute;\n  top: 0;\n  left: 0;\n}\n\n/* Added as a separate rule with multiple classes to make it more specific\n   than a bootstrap rule that selects svg:root. See issue #1275 for context.\n*/\n.blocklyWsDragSurface.blocklyOverflowVisible {\n  overflow: visible;\n}\n\n.blocklyBlockDragSurface {\n  display: none;\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  overflow: visible !important;\n  z-index: 50;  /* Display below toolbox, but above everything else. */\n}\n\n.blocklyBlockCanvas.blocklyCanvasTransitioning,\n.blocklyBubbleCanvas.blocklyCanvasTransitioning {\n  transition: transform .5s;\n}\n\n.blocklyTooltipDiv {\n  background-color: #ffffc7;\n  border: 1px solid #ddc;\n  box-shadow: 4px 4px 20px 1px rgba(0,0,0,.15);\n  color: #000;\n  display: none;\n  font: 9pt sans-serif;\n  opacity: .9;\n  padding: 2px;\n  position: absolute;\n  z-index: 100000;  /* big value for bootstrap3 compatibility */\n}\n\n.blocklyDropDownDiv {\n  position: absolute;\n  left: 0;\n  top: 0;\n  z-index: 1000;\n  display: none;\n  border: 1px solid;\n  border-color: #dadce0;\n  background-color: #fff;\n  border-radius: 2px;\n  padding: 4px;\n  box-shadow: 0 0 3px 1px rgba(0,0,0,.3);\n}\n\n.blocklyDropDownDiv.blocklyFocused {\n  box-shadow: 0 0 6px 1px rgba(0,0,0,.3);\n}\n\n.blocklyDropDownContent {\n  max-height: 300px;  /* @todo: spec for maximum height. */\n  overflow: auto;\n  overflow-x: hidden;\n  position: relative;\n}\n\n.blocklyDropDownArrow {\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 16px;\n  height: 16px;\n  z-index: -1;\n  background-color: inherit;\n  border-color: inherit;\n}\n\n.blocklyDropDownButton {\n  display: inline-block;\n  float: left;\n  padding: 0;\n  margin: 4px;\n  border-radius: 4px;\n  outline: none;\n  border: 1px solid;\n  transition: box-shadow .1s;\n  cursor: pointer;\n}\n\n.blocklyArrowTop {\n  border-top: 1px solid;\n  border-left: 1px solid;\n  border-top-left-radius: 4px;\n  border-color: inherit;\n}\n\n.blocklyArrowBottom {\n  border-bottom: 1px solid;\n  border-right: 1px solid;\n  border-bottom-right-radius: 4px;\n  border-color: inherit;\n}\n\n.blocklyResizeSE {\n  cursor: se-resize;\n  fill: #aaa;\n}\n\n.blocklyResizeSW {\n  cursor: sw-resize;\n  fill: #aaa;\n}\n\n.blocklyResizeLine {\n  stroke: #515A5A;\n  stroke-width: 1;\n}\n\n.blocklyHighlightedConnectionPath {\n  fill: none;\n  stroke: #fc3;\n  stroke-width: 4px;\n}\n\n.blocklyPathLight {\n  fill: none;\n  stroke-linecap: round;\n  stroke-width: 1;\n}\n\n.blocklySelected>.blocklyPathLight {\n  display: none;\n}\n\n.blocklyDraggable {\n  /* backup for browsers (e.g. IE11) that don't support grab */\n  cursor: url(\"<<<PATH>>>/handopen.cur\"), auto;\n  cursor: grab;\n  cursor: -webkit-grab;\n}\n\n  /* backup for browsers (e.g. IE11) that don't support grabbing */\n.blocklyDragging {\n  /* backup for browsers (e.g. IE11) that don't support grabbing */\n  cursor: url(\"<<<PATH>>>/handclosed.cur\"), auto;\n  cursor: grabbing;\n  cursor: -webkit-grabbing;\n}\n\n  /* Changes cursor on mouse down. Not effective in Firefox because of\n     https://bugzilla.mozilla.org/show_bug.cgi?id=771241 */\n.blocklyDraggable:active {\n  /* backup for browsers (e.g. IE11) that don't support grabbing */\n  cursor: url(\"<<<PATH>>>/handclosed.cur\"), auto;\n  cursor: grabbing;\n  cursor: -webkit-grabbing;\n}\n\n/* Change the cursor on the whole drag surface in case the mouse gets\n   ahead of block during a drag. This way the cursor is still a closed hand.\n  */\n.blocklyBlockDragSurface .blocklyDraggable {\n  /* backup for browsers (e.g. IE11) that don't support grabbing */\n  cursor: url(\"<<<PATH>>>/handclosed.cur\"), auto;\n  cursor: grabbing;\n  cursor: -webkit-grabbing;\n}\n\n.blocklyDragging.blocklyDraggingDelete {\n  cursor: url(\"<<<PATH>>>/handdelete.cur\"), auto;\n}\n\n.blocklyDragging>.blocklyPath,\n.blocklyDragging>.blocklyPathLight {\n  fill-opacity: .8;\n  stroke-opacity: .8;\n}\n\n.blocklyDragging>.blocklyPathDark {\n  display: none;\n}\n\n.blocklyDisabled>.blocklyPath {\n  fill-opacity: .5;\n  stroke-opacity: .5;\n}\n\n.blocklyDisabled>.blocklyPathLight,\n.blocklyDisabled>.blocklyPathDark {\n  display: none;\n}\n\n.blocklyInsertionMarker>.blocklyPath,\n.blocklyInsertionMarker>.blocklyPathLight,\n.blocklyInsertionMarker>.blocklyPathDark {\n  fill-opacity: .2;\n  stroke: none;\n}\n\n.blocklyMultilineText {\n  font-family: monospace;\n}\n\n.blocklyNonEditableText>text {\n  pointer-events: none;\n}\n\n.blocklyFlyout {\n  position: absolute;\n  z-index: 20;\n}\n\n.blocklyText text {\n  cursor: default;\n}\n\n/*\n  Don't allow users to select text.  It gets annoying when trying to\n  drag a block and selected text moves instead.\n*/\n.blocklySvg text,\n.blocklyBlockDragSurface text {\n  user-select: none;\n  -ms-user-select: none;\n  -webkit-user-select: none;\n  cursor: inherit;\n}\n\n.blocklyHidden {\n  display: none;\n}\n\n.blocklyFieldDropdown:not(.blocklyHidden) {\n  display: block;\n}\n\n.blocklyIconGroup {\n  cursor: default;\n}\n\n.blocklyIconGroup:not(:hover),\n.blocklyIconGroupReadonly {\n  opacity: .6;\n}\n\n.blocklyIconShape {\n  fill: #00f;\n  stroke: #fff;\n  stroke-width: 1px;\n}\n\n.blocklyIconSymbol {\n  fill: #fff;\n}\n\n.blocklyMinimalBody {\n  margin: 0;\n  padding: 0;\n}\n\n.blocklyHtmlInput {\n  border: none;\n  border-radius: 4px;\n  height: 100%;\n  margin: 0;\n  outline: none;\n  padding: 0;\n  width: 100%;\n  text-align: center;\n  display: block;\n  box-sizing: border-box;\n}\n\n/* Edge and IE introduce a close icon when the input value is longer than a\n   certain length. This affects our sizing calculations of the text input.\n   Hiding the close icon to avoid that. */\n.blocklyHtmlInput::-ms-clear {\n  display: none;\n}\n\n.blocklyMainBackground {\n  stroke-width: 1;\n  stroke: #c6c6c6;  /* Equates to #ddd due to border being off-pixel. */\n}\n\n.blocklyMutatorBackground {\n  fill: #fff;\n  stroke: #ddd;\n  stroke-width: 1;\n}\n\n.blocklyFlyoutBackground {\n  fill: #ddd;\n  fill-opacity: .8;\n}\n\n.blocklyMainWorkspaceScrollbar {\n  z-index: 20;\n}\n\n.blocklyFlyoutScrollbar {\n  z-index: 30;\n}\n\n.blocklyScrollbarHorizontal,\n.blocklyScrollbarVertical {\n  position: absolute;\n  outline: none;\n}\n\n.blocklyScrollbarBackground {\n  opacity: 0;\n}\n\n.blocklyScrollbarHandle {\n  fill: #ccc;\n}\n\n.blocklyScrollbarBackground:hover+.blocklyScrollbarHandle,\n.blocklyScrollbarHandle:hover {\n  fill: #bbb;\n}\n\n/* Darken flyout scrollbars due to being on a grey background. */\n/* By contrast, workspace scrollbars are on a white background. */\n.blocklyFlyout .blocklyScrollbarHandle {\n  fill: #bbb;\n}\n\n.blocklyFlyout .blocklyScrollbarBackground:hover+.blocklyScrollbarHandle,\n.blocklyFlyout .blocklyScrollbarHandle:hover {\n  fill: #aaa;\n}\n\n.blocklyInvalidInput {\n  background: #faa;\n}\n\n.blocklyVerticalMarker {\n  stroke-width: 3px;\n  fill: rgba(255,255,255,.5);\n  pointer-events: none;\n}\n\n.blocklyComputeCanvas {\n  position: absolute;\n  width: 0;\n  height: 0;\n}\n\n.blocklyNoPointerEvents {\n  pointer-events: none;\n}\n\n.blocklyContextMenu {\n  border-radius: 4px;\n  max-height: 100%;\n}\n\n.blocklyDropdownMenu {\n  border-radius: 2px;\n  padding: 0 !important;\n}\n\n.blocklyDropdownMenu .blocklyMenuItem {\n  /* 28px on the left for icon or checkbox. */\n  padding-left: 28px;\n}\n\n/* BiDi override for the resting state. */\n.blocklyDropdownMenu .blocklyMenuItemRtl {\n  /* Flip left/right padding for BiDi. */\n  padding-left: 5px;\n  padding-right: 28px;\n}\n\n.blocklyWidgetDiv .blocklyMenu {\n  background: #fff;\n  border: 1px solid transparent;\n  box-shadow: 0 0 3px 1px rgba(0,0,0,.3);\n  font: normal 13px Arial, sans-serif;\n  margin: 0;\n  outline: none;\n  padding: 4px 0;\n  position: absolute;\n  overflow-y: auto;\n  overflow-x: hidden;\n  max-height: 100%;\n  z-index: 20000;  /* Arbitrary, but some apps depend on it... */\n}\n\n.blocklyWidgetDiv .blocklyMenu.blocklyFocused {\n  box-shadow: 0 0 6px 1px rgba(0,0,0,.3);\n}\n\n.blocklyDropDownDiv .blocklyMenu {\n  background: inherit;  /* Compatibility with gapi, reset from goog-menu */\n  border: inherit;  /* Compatibility with gapi, reset from goog-menu */\n  font: normal 13px \"Helvetica Neue\", Helvetica, sans-serif;\n  outline: none;\n  position: relative;  /* Compatibility with gapi, reset from goog-menu */\n  z-index: 20000;  /* Arbitrary, but some apps depend on it... */\n}\n\n/* State: resting. */\n.blocklyMenuItem {\n  border: none;\n  color: #000;\n  cursor: pointer;\n  list-style: none;\n  margin: 0;\n  /* 7em on the right for shortcut. */\n  min-width: 7em;\n  padding: 6px 15px;\n  white-space: nowrap;\n}\n\n/* State: disabled. */\n.blocklyMenuItemDisabled {\n  color: #ccc;\n  cursor: inherit;\n}\n\n/* State: hover. */\n.blocklyMenuItemHighlight {\n  background-color: rgba(0,0,0,.1);\n}\n\n/* State: selected/checked. */\n.blocklyMenuItemCheckbox {\n  height: 16px;\n  position: absolute;\n  width: 16px;\n}\n\n.blocklyMenuItemSelected .blocklyMenuItemCheckbox {\n  background: url(<<<PATH>>>/sprites.png) no-repeat -48px -16px;\n  float: left;\n  margin-left: -24px;\n  position: static;  /* Scroll with the menu. */\n}\n\n.blocklyMenuItemRtl .blocklyMenuItemCheckbox {\n  float: right;\n  margin-right: -24px;\n}\n`;\n","/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Utility methods realted to figuring out positions of SVG elements.\n *\n * @namespace Blockly.utils.svgMath\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.utils.svgMath');\n\nimport type {WorkspaceSvg} from '../workspace_svg.js';\n\nimport {Coordinate} from './coordinate.js';\nimport * as deprecation from './deprecation.js';\nimport {Rect} from './rect.js';\nimport * as style from './style.js';\n\n\n/**\n * Static regex to pull the x,y values out of an SVG translate() directive.\n * Note that Firefox and IE (9,10) return 'translate(12)' instead of\n * 'translate(12, 0)'.\n * Note that IE (9,10) returns 'translate(16 8)' instead of 'translate(16, 8)'.\n * Note that IE has been reported to return scientific notation (0.123456e-42).\n */\nconst XY_REGEX = /translate\\(\\s*([-+\\d.e]+)([ ,]\\s*([-+\\d.e]+)\\s*)?/;\n\n/**\n * Static regex to pull the x,y values out of a translate() or translate3d()\n * style property.\n * Accounts for same exceptions as XY_REGEX.\n */\nconst XY_STYLE_REGEX =\n    /transform:\\s*translate(?:3d)?\\(\\s*([-+\\d.e]+)\\s*px([ ,]\\s*([-+\\d.e]+)\\s*px)?/;\n\n/**\n * Return the coordinates of the top-left corner of this element relative to\n * its parent.  Only for SVG elements and children (e.g. rect, g, path).\n *\n * @param element SVG element to find the coordinates of.\n * @returns Object with .x and .y properties.\n * @alias Blockly.utils.svgMath.getRelativeXY\n */\nexport function getRelativeXY(element: Element): Coordinate {\n  const xy = new Coordinate(0, 0);\n  // First, check for x and y attributes.\n  // Checking for the existence of x/y properties is faster than getAttribute.\n  // However, x/y contains an SVGAnimatedLength object, so rely on getAttribute\n  // to get the number.\n  const x = (element as any).x && element.getAttribute('x');\n  const y = (element as any).y && element.getAttribute('y');\n  if (x) {\n    xy.x = parseInt(x);\n  }\n  if (y) {\n    xy.y = parseInt(y);\n  }\n  // Second, check for transform=\"translate(...)\" attribute.\n  const transform = element.getAttribute('transform');\n  const r = transform && transform.match(XY_REGEX);\n  if (r) {\n    xy.x += Number(r[1]);\n    if (r[3]) {\n      xy.y += Number(r[3]);\n    }\n  }\n\n  // Then check for style = transform: translate(...) or translate3d(...)\n  const style = element.getAttribute('style');\n  if (style && style.indexOf('translate') > -1) {\n    const styleComponents = style.match(XY_STYLE_REGEX);\n    if (styleComponents) {\n      xy.x += Number(styleComponents[1]);\n      if (styleComponents[3]) {\n        xy.y += Number(styleComponents[3]);\n      }\n    }\n  }\n  return xy;\n}\n\n/**\n * Return the coordinates of the top-left corner of this element relative to\n * the div Blockly was injected into.\n *\n * @param element SVG element to find the coordinates of. If this is not a child\n *     of the div Blockly was injected into, the behaviour is undefined.\n * @returns Object with .x and .y properties.\n * @alias Blockly.utils.svgMath.getInjectionDivXY\n */\nexport function getInjectionDivXY(element: Element): Coordinate {\n  let x = 0;\n  let y = 0;\n  while (element) {\n    const xy = getRelativeXY(element);\n    x = x + xy.x;\n    y = y + xy.y;\n    const classes = element.getAttribute('class') || '';\n    if ((' ' + classes + ' ').indexOf(' injectionDiv ') !== -1) {\n      break;\n    }\n    element = element.parentNode as Element;\n  }\n  return new Coordinate(x, y);\n}\n\n/**\n * Check if 3D transforms are supported by adding an element\n * and attempting to set the property.\n *\n * @returns True if 3D transforms are supported.\n * @deprecated No longer provided by Blockly.\n * @alias Blockly.utils.svgMath.is3dSupported\n */\nexport function is3dSupported(): boolean {\n  // All browsers support translate3d in 2022.\n  deprecation.warn(\n      'Blockly.utils.svgMath.is3dSupported', 'version 9', 'version 10');\n  return true;\n}\n\n/**\n * Get the position of the current viewport in window coordinates.  This takes\n * scroll into account.\n *\n * @returns An object containing window width, height, and scroll position in\n *     window coordinates.\n * @alias Blockly.utils.svgMath.getViewportBBox\n * @internal\n */\nexport function getViewportBBox(): Rect {\n  // Pixels, in window coordinates.\n  const scrollOffset = style.getViewportPageOffset();\n  return new Rect(\n      scrollOffset.y, document.documentElement.clientHeight + scrollOffset.y,\n      scrollOffset.x, document.documentElement.clientWidth + scrollOffset.x);\n}\n\n/**\n * Gets the document scroll distance as a coordinate object.\n * Copied from Closure's goog.dom.getDocumentScroll.\n *\n * @returns Object with values 'x' and 'y'.\n * @alias Blockly.utils.svgMath.getDocumentScroll\n */\nexport function getDocumentScroll(): Coordinate {\n  const el = document.documentElement;\n  const win = window;\n  return new Coordinate(\n      win.pageXOffset || el.scrollLeft, win.pageYOffset || el.scrollTop);\n}\n\n/**\n * Converts screen coordinates to workspace coordinates.\n *\n * @param ws The workspace to find the coordinates on.\n * @param screenCoordinates The screen coordinates to be converted to workspace\n *     coordinates\n * @returns The workspace coordinates.\n * @alias Blockly.utils.svgMath.screenToWsCoordinates\n */\nexport function screenToWsCoordinates(\n    ws: WorkspaceSvg, screenCoordinates: Coordinate): Coordinate {\n  const screenX = screenCoordinates.x;\n  const screenY = screenCoordinates.y;\n\n  const injectionDiv = ws.getInjectionDiv();\n  // Bounding rect coordinates are in client coordinates, meaning that they\n  // are in pixels relative to the upper left corner of the visible browser\n  // window.  These coordinates change when you scroll the browser window.\n  const boundingRect = injectionDiv.getBoundingClientRect();\n\n  // The client coordinates offset by the injection div's upper left corner.\n  const clientOffsetPixels =\n      new Coordinate(screenX - boundingRect.left, screenY - boundingRect.top);\n\n  // The offset in pixels between the main workspace's origin and the upper\n  // left corner of the injection div.\n  const mainOffsetPixels = ws.getOriginOffsetInPixels();\n\n  // The position of the new comment in pixels relative to the origin of the\n  // main workspace.\n  const finalOffsetPixels =\n      Coordinate.difference(clientOffsetPixels, mainOffsetPixels);\n  // The position in main workspace coordinates.\n  const finalOffsetMainWs = finalOffsetPixels.scale(1 / ws.scale);\n  return finalOffsetMainWs;\n}\n\nexport const TEST_ONLY = {\n  XY_REGEX,\n  XY_STYLE_REGEX,\n};\n","/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * XML reader and writer.\n *\n * @namespace Blockly.Xml\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Xml');\n\nimport type {Block} from './block.js';\nimport type {BlockSvg} from './block_svg.js';\nimport type {Connection} from './connection.js';\nimport * as eventUtils from './events/utils.js';\nimport type {Field} from './field.js';\nimport {inputTypes} from './input_types.js';\nimport * as dom from './utils/dom.js';\nimport {Size} from './utils/size.js';\nimport * as utilsXml from './utils/xml.js';\nimport type {VariableModel} from './variable_model.js';\nimport * as Variables from './variables.js';\nimport type {Workspace} from './workspace.js';\nimport {WorkspaceComment} from './workspace_comment.js';\nimport {WorkspaceCommentSvg} from './workspace_comment_svg.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/**\n * Encode a block tree as XML.\n *\n * @param workspace The workspace containing blocks.\n * @param opt_noId True if the encoder should skip the block IDs.\n * @returns XML DOM element.\n * @alias Blockly.Xml.workspaceToDom\n */\nexport function workspaceToDom(\n    workspace: Workspace, opt_noId?: boolean): Element {\n  const treeXml = utilsXml.createElement('xml');\n  const variablesElement =\n      variablesToDom(Variables.allUsedVarModels(workspace));\n  if (variablesElement.hasChildNodes()) {\n    treeXml.appendChild(variablesElement);\n  }\n  const comments = workspace.getTopComments(true);\n  for (let i = 0; i < comments.length; i++) {\n    const comment = comments[i];\n    treeXml.appendChild(comment.toXmlWithXY(opt_noId));\n  }\n  const blocks = workspace.getTopBlocks(true);\n  for (let i = 0; i < blocks.length; i++) {\n    const block = blocks[i];\n    treeXml.appendChild(blockToDomWithXY(block, opt_noId));\n  }\n  return treeXml;\n}\n\n/**\n * Encode a list of variables as XML.\n *\n * @param variableList List of all variable models.\n * @returns Tree of XML elements.\n * @alias Blockly.Xml.variablesToDom\n */\nexport function variablesToDom(variableList: VariableModel[]): Element {\n  const variables = utilsXml.createElement('variables');\n  for (let i = 0; i < variableList.length; i++) {\n    const variable = variableList[i];\n    const element = utilsXml.createElement('variable');\n    element.appendChild(utilsXml.createTextNode(variable.name));\n    if (variable.type) {\n      element.setAttribute('type', variable.type);\n    }\n    element.id = variable.getId();\n    variables.appendChild(element);\n  }\n  return variables;\n}\n\n/**\n * Encode a block subtree as XML with XY coordinates.\n *\n * @param block The root block to encode.\n * @param opt_noId True if the encoder should skip the block ID.\n * @returns Tree of XML elements or an empty document fragment if the block was\n *     an insertion marker.\n * @alias Blockly.Xml.blockToDomWithXY\n */\nexport function blockToDomWithXY(block: Block, opt_noId?: boolean): Element|\n    DocumentFragment {\n  if (block.isInsertionMarker()) {  // Skip over insertion markers.\n    block = block.getChildren(false)[0];\n    if (!block) {\n      // Disappears when appended.\n      return new DocumentFragment();\n    }\n  }\n\n  let width = 0;  // Not used in LTR.\n  if (block.workspace.RTL) {\n    width = block.workspace.getWidth();\n  }\n\n  const element = blockToDom(block, opt_noId);\n  const xy = block.getRelativeToSurfaceXY();\n  // AnyDuringMigration because:  Property 'setAttribute' does not exist on type\n  // 'Element | DocumentFragment'.\n  (element as AnyDuringMigration)\n      .setAttribute('x', Math.round(block.workspace.RTL ? width - xy.x : xy.x));\n  // AnyDuringMigration because:  Property 'setAttribute' does not exist on type\n  // 'Element | DocumentFragment'.\n  (element as AnyDuringMigration).setAttribute('y', Math.round(xy.y));\n  return element;\n}\n\n/**\n * Encode a field as XML.\n *\n * @param field The field to encode.\n * @returns XML element, or null if the field did not need to be serialized.\n */\nfunction fieldToDom(field: Field): Element|null {\n  if (field.isSerializable()) {\n    const container = utilsXml.createElement('field');\n    container.setAttribute('name', field.name || '');\n    return field.toXml(container);\n  }\n  return null;\n}\n\n/**\n * Encode all of a block's fields as XML and attach them to the given tree of\n * XML elements.\n *\n * @param block A block with fields to be encoded.\n * @param element The XML element to which the field DOM should be attached.\n */\nfunction allFieldsToDom(block: Block, element: Element) {\n  for (let i = 0; i < block.inputList.length; i++) {\n    const input = block.inputList[i];\n    for (let j = 0; j < input.fieldRow.length; j++) {\n      const field = input.fieldRow[j];\n      const fieldDom = fieldToDom(field);\n      if (fieldDom) {\n        element.appendChild(fieldDom);\n      }\n    }\n  }\n}\n\n/**\n * Encode a block subtree as XML.\n *\n * @param block The root block to encode.\n * @param opt_noId True if the encoder should skip the block ID.\n * @returns Tree of XML elements or an empty document fragment if the block was\n *     an insertion marker.\n * @alias Blockly.Xml.blockToDom\n */\nexport function blockToDom(block: Block, opt_noId?: boolean): Element|\n    DocumentFragment {\n  // Skip over insertion markers.\n  if (block.isInsertionMarker()) {\n    const child = block.getChildren(false)[0];\n    if (child) {\n      return blockToDom(child);\n    } else {\n      // Disappears when appended.\n      return new DocumentFragment();\n    }\n  }\n\n  const element = utilsXml.createElement(block.isShadow() ? 'shadow' : 'block');\n  element.setAttribute('type', block.type);\n  if (!opt_noId) {\n    // It's important to use setAttribute here otherwise IE11 won't serialize\n    // the block's ID when domToText is called.\n    element.setAttribute('id', block.id);\n  }\n  if (block.mutationToDom) {\n    // Custom data for an advanced block.\n    const mutation = block.mutationToDom();\n    if (mutation && (mutation.hasChildNodes() || mutation.hasAttributes())) {\n      element.appendChild(mutation);\n    }\n  }\n\n  allFieldsToDom(block, element);\n\n  const commentText = block.getCommentText();\n  if (commentText) {\n    const size = block.commentModel.size;\n    const pinned = block.commentModel.pinned;\n\n    const commentElement = utilsXml.createElement('comment');\n    commentElement.appendChild(utilsXml.createTextNode(commentText));\n    // AnyDuringMigration because:  Argument of type 'boolean' is not assignable\n    // to parameter of type 'string'.\n    commentElement.setAttribute('pinned', pinned as AnyDuringMigration);\n    // AnyDuringMigration because:  Argument of type 'number' is not assignable\n    // to parameter of type 'string'.\n    commentElement.setAttribute('h', size.height as AnyDuringMigration);\n    // AnyDuringMigration because:  Argument of type 'number' is not assignable\n    // to parameter of type 'string'.\n    commentElement.setAttribute('w', size.width as AnyDuringMigration);\n\n    element.appendChild(commentElement);\n  }\n\n  if (block.data) {\n    const dataElement = utilsXml.createElement('data');\n    dataElement.appendChild(utilsXml.createTextNode(block.data));\n    element.appendChild(dataElement);\n  }\n\n  for (let i = 0; i < block.inputList.length; i++) {\n    const input = block.inputList[i];\n    let container: Element;\n    let empty = true;\n    if (input.type === inputTypes.DUMMY) {\n      continue;\n    } else {\n      const childBlock = input.connection!.targetBlock();\n      if (input.type === inputTypes.VALUE) {\n        container = utilsXml.createElement('value');\n      } else if (input.type === inputTypes.STATEMENT) {\n        container = utilsXml.createElement('statement');\n      }\n      const childShadow = input.connection!.getShadowDom();\n      if (childShadow && (!childBlock || !childBlock.isShadow())) {\n        container!.appendChild(cloneShadow(childShadow, opt_noId));\n      }\n      if (childBlock) {\n        const childElem = blockToDom(childBlock, opt_noId);\n        if (childElem.nodeType === dom.NodeType.ELEMENT_NODE) {\n          container!.appendChild(childElem);\n          empty = false;\n        }\n      }\n    }\n    container!.setAttribute('name', input.name);\n    if (!empty) {\n      element.appendChild(container!);\n    }\n  }\n  if (block.inputsInline !== undefined &&\n      block.inputsInline !== block.inputsInlineDefault) {\n    element.setAttribute('inline', block.inputsInline.toString());\n  }\n  if (block.isCollapsed()) {\n    element.setAttribute('collapsed', 'true');\n  }\n  if (!block.isEnabled()) {\n    element.setAttribute('disabled', 'true');\n  }\n  if (!block.isDeletable() && !block.isShadow()) {\n    element.setAttribute('deletable', 'false');\n  }\n  if (!block.isMovable() && !block.isShadow()) {\n    element.setAttribute('movable', 'false');\n  }\n  if (!block.isEditable()) {\n    element.setAttribute('editable', 'false');\n  }\n\n  const nextBlock = block.getNextBlock();\n  let container: Element;\n  if (nextBlock) {\n    const nextElem = blockToDom(nextBlock, opt_noId);\n    if (nextElem.nodeType === dom.NodeType.ELEMENT_NODE) {\n      container = utilsXml.createElement('next');\n      container.appendChild(nextElem);\n      element.appendChild(container);\n    }\n  }\n  const nextShadow =\n      block.nextConnection && block.nextConnection.getShadowDom();\n  if (nextShadow && (!nextBlock || !nextBlock.isShadow())) {\n    container!.appendChild(cloneShadow(nextShadow, opt_noId));\n  }\n\n  return element;\n}\n\n/**\n * Deeply clone the shadow's DOM so that changes don't back-wash to the block.\n *\n * @param shadow A tree of XML elements.\n * @param opt_noId True if the encoder should skip the block ID.\n * @returns A tree of XML elements.\n */\nfunction cloneShadow(shadow: Element, opt_noId?: boolean): Element {\n  shadow = shadow.cloneNode(true) as Element;\n  // Walk the tree looking for whitespace.  Don't prune whitespace in a tag.\n  let node: Node|null = shadow;\n  let textNode;\n  while (node) {\n    if (opt_noId && node.nodeName === 'shadow') {\n      // Strip off IDs from shadow blocks.  There should never be a 'block' as\n      // a child of a 'shadow', so no need to check that.\n      (node as Element).removeAttribute('id');\n    }\n    if (node.firstChild) {\n      node = node.firstChild;\n    } else {\n      while (node && !node.nextSibling) {\n        textNode = node;\n        node = node.parentNode;\n        if (textNode.nodeType === dom.NodeType.TEXT_NODE &&\n            (textNode as Text).data.trim() === '' &&\n            node?.firstChild !== textNode) {\n          // Prune whitespace after a tag.\n          dom.removeNode(textNode);\n        }\n      }\n      if (node) {\n        textNode = node;\n        node = node.nextSibling;\n        if (textNode.nodeType === dom.NodeType.TEXT_NODE &&\n            (textNode as Text).data.trim() === '') {\n          // Prune whitespace before a tag.\n          dom.removeNode(textNode);\n        }\n      }\n    }\n  }\n  return shadow;\n}\n\n/**\n * Converts a DOM structure into plain text.\n * Currently the text format is fairly ugly: all one line with no whitespace,\n * unless the DOM itself has whitespace built-in.\n *\n * @param dom A tree of XML nodes.\n * @returns Text representation.\n * @alias Blockly.Xml.domToText\n */\nexport function domToText(dom: Node): string {\n  const text = utilsXml.domToText(dom);\n  // Unpack self-closing tags.  These tags fail when embedded in HTML.\n  // <block name=\"foo\"/> -> <block name=\"foo\"></block>\n  return text.replace(/<(\\w+)([^<]*)\\/>/g, '<$1$2></$1>');\n}\n\n/**\n * Converts a DOM structure into properly indented text.\n *\n * @param dom A tree of XML elements.\n * @returns Text representation.\n * @alias Blockly.Xml.domToPrettyText\n */\nexport function domToPrettyText(dom: Node): string {\n  // This function is not guaranteed to be correct for all XML.\n  // But it handles the XML that Blockly generates.\n  const blob = domToText(dom);\n  // Place every open and close tag on its own line.\n  const lines = blob.split('<');\n  // Indent every line.\n  let indent = '';\n  for (let i = 1; i < lines.length; i++) {\n    const line = lines[i];\n    if (line[0] === '/') {\n      indent = indent.substring(2);\n    }\n    lines[i] = indent + '<' + line;\n    if (line[0] !== '/' && line.slice(-2) !== '/>') {\n      indent += '  ';\n    }\n  }\n  // Pull simple tags back together.\n  // E.g. <foo></foo>\n  let text = lines.join('\\n');\n  text = text.replace(/(<(\\w+)\\b[^>]*>[^\\n]*)\\n *<\\/\\2>/g, '$1</$2>');\n  // Trim leading blank line.\n  return text.replace(/^\\n/, '');\n}\n\n/**\n * Converts an XML string into a DOM structure.\n *\n * @param text An XML string.\n * @returns A DOM object representing the singular child of the document\n *     element.\n * @throws if the text doesn't parse.\n * @alias Blockly.Xml.textToDom\n */\nexport function textToDom(text: string): Element {\n  const doc = utilsXml.textToDomDocument(text);\n  if (!doc || !doc.documentElement ||\n      doc.getElementsByTagName('parsererror').length) {\n    throw Error('textToDom was unable to parse: ' + text);\n  }\n  return doc.documentElement;\n}\n\n/**\n * Clear the given workspace then decode an XML DOM and\n * create blocks on the workspace.\n *\n * @param xml XML DOM.\n * @param workspace The workspace.\n * @returns An array containing new block IDs.\n * @alias Blockly.Xml.clearWorkspaceAndLoadFromXml\n */\nexport function clearWorkspaceAndLoadFromXml(\n    xml: Element, workspace: WorkspaceSvg): string[] {\n  workspace.setResizesEnabled(false);\n  workspace.clear();\n  // AnyDuringMigration because:  Argument of type 'WorkspaceSvg' is not\n  // assignable to parameter of type 'Workspace'.\n  const blockIds = domToWorkspace(xml, workspace as AnyDuringMigration);\n  workspace.setResizesEnabled(true);\n  return blockIds;\n}\n\n/**\n * Decode an XML DOM and create blocks on the workspace.\n *\n * @param xml XML DOM.\n * @param workspace The workspace.\n * @returns An array containing new block IDs.\n * @suppress {strictModuleDepCheck} Suppress module check while workspace\n * comments are not bundled in.\n * @alias Blockly.Xml.domToWorkspace\n */\nexport function domToWorkspace(xml: Element, workspace: Workspace): string[] {\n  let width = 0;  // Not used in LTR.\n  if (workspace.RTL) {\n    width = workspace.getWidth();\n  }\n  const newBlockIds = [];  // A list of block IDs added by this call.\n  dom.startTextWidthCache();\n  const existingGroup = eventUtils.getGroup();\n  if (!existingGroup) {\n    eventUtils.setGroup(true);\n  }\n\n  // Disable workspace resizes as an optimization.\n  // Assume it is rendered so we can check.\n  if ((workspace as WorkspaceSvg).setResizesEnabled) {\n    (workspace as WorkspaceSvg).setResizesEnabled(false);\n  }\n  let variablesFirst = true;\n  try {\n    for (let i = 0, xmlChild; xmlChild = xml.childNodes[i]; i++) {\n      const name = xmlChild.nodeName.toLowerCase();\n      const xmlChildElement = xmlChild as Element;\n      if (name === 'block' ||\n          name === 'shadow' && !eventUtils.getRecordUndo()) {\n        // Allow top-level shadow blocks if recordUndo is disabled since\n        // that means an undo is in progress.  Such a block is expected\n        // to be moved to a nested destination in the next operation.\n        const block = domToBlock(xmlChildElement, workspace);\n        newBlockIds.push(block.id);\n        // AnyDuringMigration because:  Argument of type 'string | null' is not\n        // assignable to parameter of type 'string'.\n        const blockX = xmlChildElement.hasAttribute('x') ?\n            parseInt(xmlChildElement.getAttribute('x') as AnyDuringMigration) :\n            10;\n        // AnyDuringMigration because:  Argument of type 'string | null' is not\n        // assignable to parameter of type 'string'.\n        const blockY = xmlChildElement.hasAttribute('y') ?\n            parseInt(xmlChildElement.getAttribute('y') as AnyDuringMigration) :\n            10;\n        if (!isNaN(blockX) && !isNaN(blockY)) {\n          block.moveBy(workspace.RTL ? width - blockX : blockX, blockY);\n        }\n        variablesFirst = false;\n      } else if (name === 'shadow') {\n        throw TypeError('Shadow block cannot be a top-level block.');\n      } else if (name === 'comment') {\n        if (workspace.rendered) {\n          WorkspaceCommentSvg.fromXmlRendered(\n              xmlChildElement, workspace as WorkspaceSvg, width);\n        } else {\n          WorkspaceComment.fromXml(xmlChildElement, workspace);\n        }\n      } else if (name === 'variables') {\n        if (variablesFirst) {\n          domToVariables(xmlChildElement, workspace);\n        } else {\n          throw Error(\n              '\\'variables\\' tag must exist once before block and ' +\n              'shadow tag elements in the workspace XML, but it was found in ' +\n              'another location.');\n        }\n        variablesFirst = false;\n      }\n    }\n  } finally {\n    if (!existingGroup) {\n      eventUtils.setGroup(false);\n    }\n    dom.stopTextWidthCache();\n  }\n  // Re-enable workspace resizing.\n  if ((workspace as WorkspaceSvg).setResizesEnabled) {\n    (workspace as WorkspaceSvg).setResizesEnabled(true);\n  }\n  eventUtils.fire(new (eventUtils.get(eventUtils.FINISHED_LOADING))(workspace));\n  return newBlockIds;\n}\n\n/**\n * Decode an XML DOM and create blocks on the workspace. Position the new\n * blocks immediately below prior blocks, aligned by their starting edge.\n *\n * @param xml The XML DOM.\n * @param workspace The workspace to add to.\n * @returns An array containing new block IDs.\n * @alias Blockly.Xml.appendDomToWorkspace\n */\nexport function appendDomToWorkspace(\n    xml: Element, workspace: WorkspaceSvg): string[] {\n  // First check if we have a WorkspaceSvg, otherwise the blocks have no shape\n  // and the position does not matter.\n  // Assume it is rendered so we can check.\n  if (!(workspace as WorkspaceSvg).getBlocksBoundingBox) {\n    return domToWorkspace(xml, workspace);\n  }\n\n  const bbox = (workspace as WorkspaceSvg).getBlocksBoundingBox();\n  // Load the new blocks into the workspace and get the IDs of the new blocks.\n  const newBlockIds = domToWorkspace(xml, workspace);\n  if (bbox && bbox.top !== bbox.bottom) {  // Check if any previous block.\n    let offsetY = 0;  // Offset to add to y of the new block.\n    let offsetX = 0;\n    const farY = bbox.bottom;                             // Bottom position.\n    const topX = workspace.RTL ? bbox.right : bbox.left;  // X of bounding box.\n    // Check position of the new blocks.\n    let newLeftX = Infinity;    // X of top left corner.\n    let newRightX = -Infinity;  // X of top right corner.\n    let newY = Infinity;        // Y of top corner.\n    const ySeparation = 10;\n    for (let i = 0; i < newBlockIds.length; i++) {\n      const blockXY =\n          workspace.getBlockById(newBlockIds[i])!.getRelativeToSurfaceXY();\n      if (blockXY.y < newY) {\n        newY = blockXY.y;\n      }\n      if (blockXY.x < newLeftX) {  // if we left align also on x\n        newLeftX = blockXY.x;\n      }\n      if (blockXY.x > newRightX) {  // if we right align also on x\n        newRightX = blockXY.x;\n      }\n    }\n    offsetY = farY - newY + ySeparation;\n    offsetX = workspace.RTL ? topX - newRightX : topX - newLeftX;\n    for (let i = 0; i < newBlockIds.length; i++) {\n      const block = workspace.getBlockById(newBlockIds[i]);\n      block!.moveBy(offsetX, offsetY);\n    }\n  }\n  return newBlockIds;\n}\n\n/**\n * Decode an XML block tag and create a block (and possibly sub blocks) on the\n * workspace.\n *\n * @param xmlBlock XML block element.\n * @param workspace The workspace.\n * @returns The root block created.\n * @alias Blockly.Xml.domToBlock\n */\nexport function domToBlock(xmlBlock: Element, workspace: Workspace): Block {\n  // Create top-level block.\n  eventUtils.disable();\n  const variablesBeforeCreation = workspace.getAllVariables();\n  let topBlock;\n  try {\n    topBlock = domToBlockHeadless(xmlBlock, workspace);\n    // Generate list of all blocks.\n    if (workspace.rendered) {\n      const topBlockSvg = topBlock as BlockSvg;\n      const blocks = topBlock.getDescendants(false);\n      topBlockSvg.setConnectionTracking(false);\n      // Render each block.\n      for (let i = blocks.length - 1; i >= 0; i--) {\n        (blocks[i] as BlockSvg).initSvg();\n      }\n      for (let i = blocks.length - 1; i >= 0; i--) {\n        (blocks[i] as BlockSvg).render(false);\n      }\n      // Populating the connection database may be deferred until after the\n      // blocks have rendered.\n      setTimeout(function() {\n        if (!topBlockSvg.disposed) {\n          topBlockSvg.setConnectionTracking(true);\n        }\n      }, 1);\n      topBlockSvg.updateDisabled();\n      // Allow the scrollbars to resize and move based on the new contents.\n      // TODO(@picklesrus): #387. Remove when domToBlock avoids resizing.\n      (workspace as WorkspaceSvg).resizeContents();\n    } else {\n      const blocks = topBlock.getDescendants(false);\n      for (let i = blocks.length - 1; i >= 0; i--) {\n        blocks[i].initModel();\n      }\n    }\n  } finally {\n    eventUtils.enable();\n  }\n  if (eventUtils.isEnabled()) {\n    // AnyDuringMigration because:  Property 'get' does not exist on type\n    // '(name: string) => void'.\n    const newVariables =\n        Variables.getAddedVariables(workspace, variablesBeforeCreation);\n    // Fire a VarCreate event for each (if any) new variable created.\n    for (let i = 0; i < newVariables.length; i++) {\n      const thisVariable = newVariables[i];\n      eventUtils.fire(\n          new (eventUtils.get(eventUtils.VAR_CREATE))(thisVariable));\n    }\n    // Block events come after var events, in case they refer to newly created\n    // variables.\n    eventUtils.fire(new (eventUtils.get(eventUtils.CREATE))(topBlock));\n  }\n  return topBlock;\n}\n\n/**\n * Decode an XML list of variables and add the variables to the workspace.\n *\n * @param xmlVariables List of XML variable elements.\n * @param workspace The workspace to which the variable should be added.\n * @alias Blockly.Xml.domToVariables\n */\nexport function domToVariables(xmlVariables: Element, workspace: Workspace) {\n  for (let i = 0; i < xmlVariables.children.length; i++) {\n    const xmlChild = xmlVariables.children[i];\n    const type = xmlChild.getAttribute('type');\n    const id = xmlChild.getAttribute('id');\n    const name = xmlChild.textContent;\n\n    // AnyDuringMigration because:  Argument of type 'string | null' is not\n    // assignable to parameter of type 'string'.\n    workspace.createVariable(name as AnyDuringMigration, type, id);\n  }\n}\n\n/** A mapping of nodeName to node for child nodes of xmlBlock. */\ninterface childNodeTagMap {\n  mutation: Element[];\n  comment: Element[];\n  data: Element[];\n  field: Element[];\n  input: Element[];\n  next: Element[];\n}\n\n/**\n * Creates a mapping of childNodes for each supported XML tag for the provided\n * xmlBlock. Logs a warning for any encountered unsupported tags.\n *\n * @param xmlBlock XML block element.\n * @returns The childNode map from nodeName to node.\n */\nfunction mapSupportedXmlTags(xmlBlock: Element): childNodeTagMap {\n  const childNodeMap = {\n    mutation: new Array<Element>(),\n    comment: new Array<Element>(),\n    data: new Array<Element>(),\n    field: new Array<Element>(),\n    input: new Array<Element>(),\n    next: new Array<Element>(),\n  };\n  for (let i = 0; i < xmlBlock.children.length; i++) {\n    const xmlChild = xmlBlock.children[i];\n    if (xmlChild.nodeType === dom.NodeType.TEXT_NODE) {\n      // Ignore any text at the <block> level.  It's all whitespace anyway.\n      continue;\n    }\n    switch (xmlChild.nodeName.toLowerCase()) {\n      case 'mutation':\n        childNodeMap.mutation.push(xmlChild);\n        break;\n      case 'comment':\n        childNodeMap.comment.push(xmlChild);\n        break;\n      case 'data':\n        childNodeMap.data.push(xmlChild);\n        break;\n      case 'title':\n      // Titles were renamed to field in December 2013.\n      // Fall through.\n      case 'field':\n        childNodeMap.field.push(xmlChild);\n        break;\n      case 'value':\n      case 'statement':\n        childNodeMap.input.push(xmlChild);\n        break;\n      case 'next':\n        childNodeMap.next.push(xmlChild);\n        break;\n      default:\n        // Unknown tag; ignore.  Same principle as HTML parsers.\n        console.warn('Ignoring unknown tag: ' + xmlChild.nodeName);\n    }\n  }\n  return childNodeMap;\n}\n\n/**\n * Applies mutation tag child nodes to the given block.\n *\n * @param xmlChildren Child nodes.\n * @param block The block to apply the child nodes on.\n * @returns True if mutation may have added some elements that need\n *     initialization (requiring initSvg call).\n */\nfunction applyMutationTagNodes(xmlChildren: Element[], block: Block): boolean {\n  let shouldCallInitSvg = false;\n  for (let i = 0; i < xmlChildren.length; i++) {\n    const xmlChild = xmlChildren[i];\n    // Custom data for an advanced block.\n    if (block.domToMutation) {\n      block.domToMutation(xmlChild);\n      if ((block as BlockSvg).initSvg) {\n        // Mutation may have added some elements that need initializing.\n        shouldCallInitSvg = true;\n      }\n    }\n  }\n  return shouldCallInitSvg;\n}\n\n/**\n * Applies comment tag child nodes to the given block.\n *\n * @param xmlChildren Child nodes.\n * @param block The block to apply the child nodes on.\n */\nfunction applyCommentTagNodes(xmlChildren: Element[], block: Block) {\n  for (let i = 0; i < xmlChildren.length; i++) {\n    const xmlChild = xmlChildren[i];\n    const text = xmlChild.textContent;\n    const pinned = xmlChild.getAttribute('pinned') === 'true';\n    // AnyDuringMigration because:  Argument of type 'string | null' is not\n    // assignable to parameter of type 'string'.\n    const width = parseInt(xmlChild.getAttribute('w') as AnyDuringMigration);\n    // AnyDuringMigration because:  Argument of type 'string | null' is not\n    // assignable to parameter of type 'string'.\n    const height = parseInt(xmlChild.getAttribute('h') as AnyDuringMigration);\n\n    block.setCommentText(text);\n    block.commentModel.pinned = pinned;\n    if (!isNaN(width) && !isNaN(height)) {\n      block.commentModel.size = new Size(width, height);\n    }\n\n    if (pinned && (block as BlockSvg).getCommentIcon && !block.isInFlyout) {\n      const blockSvg = block as BlockSvg;\n      setTimeout(function() {\n        blockSvg.getCommentIcon()!.setVisible(true);\n      }, 1);\n    }\n  }\n}\n\n/**\n * Applies data tag child nodes to the given block.\n *\n * @param xmlChildren Child nodes.\n * @param block The block to apply the child nodes on.\n */\nfunction applyDataTagNodes(xmlChildren: Element[], block: Block) {\n  for (let i = 0; i < xmlChildren.length; i++) {\n    const xmlChild = xmlChildren[i];\n    block.data = xmlChild.textContent;\n  }\n}\n\n/**\n * Applies field tag child nodes to the given block.\n *\n * @param xmlChildren Child nodes.\n * @param block The block to apply the child nodes on.\n */\nfunction applyFieldTagNodes(xmlChildren: Element[], block: Block) {\n  for (let i = 0; i < xmlChildren.length; i++) {\n    const xmlChild = xmlChildren[i];\n    const nodeName = xmlChild.getAttribute('name');\n    // AnyDuringMigration because:  Argument of type 'string | null' is not\n    // assignable to parameter of type 'string'.\n    domToField(block, nodeName as AnyDuringMigration, xmlChild);\n  }\n}\n\n/**\n * Finds any enclosed blocks or shadows within this XML node.\n *\n * @param xmlNode The XML node to extract child block info from.\n * @returns Any found child block.\n */\nfunction findChildBlocks(xmlNode: Element):\n    {childBlockElement: Element|null, childShadowElement: Element|null} {\n  const childBlockInfo = {childBlockElement: null, childShadowElement: null};\n  for (let i = 0; i < xmlNode.childNodes.length; i++) {\n    const xmlChild = xmlNode.childNodes[i];\n    if (xmlChild.nodeType === dom.NodeType.ELEMENT_NODE) {\n      if (xmlChild.nodeName.toLowerCase() === 'block') {\n        // AnyDuringMigration because:  Type 'Element' is not assignable to type\n        // 'null'.\n        childBlockInfo.childBlockElement =\n            xmlChild as Element as AnyDuringMigration;\n      } else if (xmlChild.nodeName.toLowerCase() === 'shadow') {\n        // AnyDuringMigration because:  Type 'Element' is not assignable to type\n        // 'null'.\n        childBlockInfo.childShadowElement =\n            xmlChild as Element as AnyDuringMigration;\n      }\n    }\n  }\n  return childBlockInfo;\n}\n/**\n * Applies input child nodes (value or statement) to the given block.\n *\n * @param xmlChildren Child nodes.\n * @param workspace The workspace containing the given block.\n * @param block The block to apply the child nodes on.\n * @param prototypeName The prototype name of the block.\n */\nfunction applyInputTagNodes(\n    xmlChildren: Element[], workspace: Workspace, block: Block,\n    prototypeName: string) {\n  for (let i = 0; i < xmlChildren.length; i++) {\n    const xmlChild = xmlChildren[i];\n    const nodeName = xmlChild.getAttribute('name');\n    // AnyDuringMigration because:  Argument of type 'string | null' is not\n    // assignable to parameter of type 'string'.\n    const input = block.getInput(nodeName as AnyDuringMigration);\n    if (!input) {\n      console.warn(\n          'Ignoring non-existent input ' + nodeName + ' in block ' +\n          prototypeName);\n      break;\n    }\n    const childBlockInfo = findChildBlocks(xmlChild);\n    if (childBlockInfo.childBlockElement) {\n      if (!input.connection) {\n        throw TypeError('Input connection does not exist.');\n      }\n      domToBlockHeadless(\n          childBlockInfo.childBlockElement, workspace, input.connection, false);\n    }\n    // Set shadow after so we don't create a shadow we delete immediately.\n    if (childBlockInfo.childShadowElement) {\n      input.connection?.setShadowDom(childBlockInfo.childShadowElement);\n    }\n  }\n}\n\n/**\n * Applies next child nodes to the given block.\n *\n * @param xmlChildren Child nodes.\n * @param workspace The workspace containing the given block.\n * @param block The block to apply the child nodes on.\n */\nfunction applyNextTagNodes(\n    xmlChildren: Element[], workspace: Workspace, block: Block) {\n  for (let i = 0; i < xmlChildren.length; i++) {\n    const xmlChild = xmlChildren[i];\n    const childBlockInfo = findChildBlocks(xmlChild);\n    if (childBlockInfo.childBlockElement) {\n      if (!block.nextConnection) {\n        throw TypeError('Next statement does not exist.');\n      }\n      // If there is more than one XML 'next' tag.\n      if (block.nextConnection.isConnected()) {\n        throw TypeError('Next statement is already connected.');\n      }\n      // Create child block.\n      domToBlockHeadless(\n          childBlockInfo.childBlockElement, workspace, block.nextConnection,\n          true);\n    }\n    // Set shadow after so we don't create a shadow we delete immediately.\n    if (childBlockInfo.childShadowElement && block.nextConnection) {\n      block.nextConnection.setShadowDom(childBlockInfo.childShadowElement);\n    }\n  }\n}\n\n/**\n * Decode an XML block tag and create a block (and possibly sub blocks) on the\n * workspace.\n *\n * @param xmlBlock XML block element.\n * @param workspace The workspace.\n * @param parentConnection The parent connection to to connect this block to\n *     after instantiating.\n * @param connectedToParentNext Whether the provided parent connection is a next\n *     connection, rather than output or statement.\n * @returns The root block created.\n */\nfunction domToBlockHeadless(\n    xmlBlock: Element, workspace: Workspace, parentConnection?: Connection,\n    connectedToParentNext?: boolean): Block {\n  let block = null;\n  const prototypeName = xmlBlock.getAttribute('type');\n  if (!prototypeName) {\n    throw TypeError('Block type unspecified: ' + xmlBlock.outerHTML);\n  }\n  const id = xmlBlock.getAttribute('id');\n  // AnyDuringMigration because:  Argument of type 'string | null' is not\n  // assignable to parameter of type 'string | undefined'.\n  block = workspace.newBlock(prototypeName, id as AnyDuringMigration);\n\n  // Preprocess childNodes so tags can be processed in a consistent order.\n  const xmlChildNameMap = mapSupportedXmlTags(xmlBlock);\n\n  const shouldCallInitSvg =\n      applyMutationTagNodes(xmlChildNameMap.mutation, block);\n  applyCommentTagNodes(xmlChildNameMap.comment, block);\n  applyDataTagNodes(xmlChildNameMap.data, block);\n\n  // Connect parent after processing mutation and before setting fields.\n  if (parentConnection) {\n    if (connectedToParentNext) {\n      if (block.previousConnection) {\n        parentConnection.connect(block.previousConnection);\n      } else {\n        throw TypeError('Next block does not have previous statement.');\n      }\n    } else {\n      if (block.outputConnection) {\n        parentConnection.connect(block.outputConnection);\n      } else if (block.previousConnection) {\n        parentConnection.connect(block.previousConnection);\n      } else {\n        throw TypeError(\n            'Child block does not have output or previous statement.');\n      }\n    }\n  }\n\n  applyFieldTagNodes(xmlChildNameMap.field, block);\n  applyInputTagNodes(xmlChildNameMap.input, workspace, block, prototypeName);\n  applyNextTagNodes(xmlChildNameMap.next, workspace, block);\n\n  if (shouldCallInitSvg) {\n    // This shouldn't even be called here\n    // (ref: https://github.com/google/blockly/pull/4296#issuecomment-884226021\n    // But the XML serializer/deserializer is iceboxed so I'm not going to fix\n    // it.\n    (block as BlockSvg).initSvg();\n  }\n\n  const inline = xmlBlock.getAttribute('inline');\n  if (inline) {\n    block.setInputsInline(inline === 'true');\n  }\n  const disabled = xmlBlock.getAttribute('disabled');\n  if (disabled) {\n    block.setEnabled(disabled !== 'true' && disabled !== 'disabled');\n  }\n  const deletable = xmlBlock.getAttribute('deletable');\n  if (deletable) {\n    block.setDeletable(deletable === 'true');\n  }\n  const movable = xmlBlock.getAttribute('movable');\n  if (movable) {\n    block.setMovable(movable === 'true');\n  }\n  const editable = xmlBlock.getAttribute('editable');\n  if (editable) {\n    block.setEditable(editable === 'true');\n  }\n  const collapsed = xmlBlock.getAttribute('collapsed');\n  if (collapsed) {\n    block.setCollapsed(collapsed === 'true');\n  }\n  if (xmlBlock.nodeName.toLowerCase() === 'shadow') {\n    // Ensure all children are also shadows.\n    const children = block.getChildren(false);\n    for (let i = 0; i < children.length; i++) {\n      const child = children[i];\n      if (!child.isShadow()) {\n        throw TypeError('Shadow block not allowed non-shadow child.');\n      }\n    }\n    // Ensure this block doesn't have any variable inputs.\n    if (block.getVarModels().length) {\n      throw TypeError('Shadow blocks cannot have variable references.');\n    }\n    block.setShadow(true);\n  }\n  return block;\n}\n\n/**\n * Decode an XML field tag and set the value of that field on the given block.\n *\n * @param block The block that is currently being deserialized.\n * @param fieldName The name of the field on the block.\n * @param xml The field tag to decode.\n */\nfunction domToField(block: Block, fieldName: string, xml: Element) {\n  const field = block.getField(fieldName);\n  if (!field) {\n    console.warn(\n        'Ignoring non-existent field ' + fieldName + ' in block ' + block.type);\n    return;\n  }\n  field.fromXml(xml);\n}\n\n/**\n * Remove any 'next' block (statements in a stack).\n *\n * @param xmlBlock XML block element or an empty DocumentFragment if the block\n *     was an insertion marker.\n * @alias Blockly.Xml.deleteNext\n */\nexport function deleteNext(xmlBlock: Element|DocumentFragment) {\n  for (let i = 0; i < xmlBlock.childNodes.length; i++) {\n    const child = xmlBlock.childNodes[i];\n    if (child.nodeName.toLowerCase() === 'next') {\n      xmlBlock.removeChild(child);\n      break;\n    }\n  }\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Utility methods for string manipulation.\n * These methods are not specific to Blockly, and could be factored out into\n * a JavaScript framework such as Closure.\n *\n * @namespace Blockly.utils.string\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.utils.string');\n\nimport * as deprecation from './deprecation.js';\n\n\n/**\n * Fast prefix-checker.\n * Copied from Closure's goog.string.startsWith.\n *\n * @param str The string to check.\n * @param prefix A string to look for at the start of `str`.\n * @returns True if `str` begins with `prefix`.\n * @alias Blockly.utils.string.startsWith\n * @deprecated Use built-in **string.startsWith** instead.\n */\nexport function startsWith(str: string, prefix: string): boolean {\n  deprecation.warn(\n      'Blockly.utils.string.startsWith()', 'April 2022', 'April 2023',\n      'Use built-in string.startsWith');\n  return str.startsWith(prefix);\n}\n\n/**\n * Given an array of strings, return the length of the shortest one.\n *\n * @param array Array of strings.\n * @returns Length of shortest string.\n * @alias Blockly.utils.string.shortestStringLength\n */\nexport function shortestStringLength(array: string[]): number {\n  if (!array.length) {\n    return 0;\n  }\n  return array\n      .reduce(function(a, b) {\n        return a.length < b.length ? a : b;\n      })\n      .length;\n}\n\n/**\n * Given an array of strings, return the length of the common prefix.\n * Words may not be split.  Any space after a word is included in the length.\n *\n * @param array Array of strings.\n * @param opt_shortest Length of shortest string.\n * @returns Length of common prefix.\n * @alias Blockly.utils.string.commonWordPrefix\n */\nexport function commonWordPrefix(\n    array: string[], opt_shortest?: number): number {\n  if (!array.length) {\n    return 0;\n  } else if (array.length === 1) {\n    return array[0].length;\n  }\n  let wordPrefix = 0;\n  const max = opt_shortest || shortestStringLength(array);\n  let len;\n  for (len = 0; len < max; len++) {\n    const letter = array[0][len];\n    for (let i = 1; i < array.length; i++) {\n      if (letter !== array[i][len]) {\n        return wordPrefix;\n      }\n    }\n    if (letter === ' ') {\n      wordPrefix = len + 1;\n    }\n  }\n  for (let i = 1; i < array.length; i++) {\n    const letter = array[i][len];\n    if (letter && letter !== ' ') {\n      return wordPrefix;\n    }\n  }\n  return max;\n}\n\n/**\n * Given an array of strings, return the length of the common suffix.\n * Words may not be split.  Any space after a word is included in the length.\n *\n * @param array Array of strings.\n * @param opt_shortest Length of shortest string.\n * @returns Length of common suffix.\n * @alias Blockly.utils.string.commonWordSuffix\n */\nexport function commonWordSuffix(\n    array: string[], opt_shortest?: number): number {\n  if (!array.length) {\n    return 0;\n  } else if (array.length === 1) {\n    return array[0].length;\n  }\n  let wordPrefix = 0;\n  const max = opt_shortest || shortestStringLength(array);\n  let len;\n  for (len = 0; len < max; len++) {\n    const letter = array[0].substr(-len - 1, 1);\n    for (let i = 1; i < array.length; i++) {\n      if (letter !== array[i].substr(-len - 1, 1)) {\n        return wordPrefix;\n      }\n    }\n    if (letter === ' ') {\n      wordPrefix = len + 1;\n    }\n  }\n  for (let i = 1; i < array.length; i++) {\n    const letter = array[i].charAt(array[i].length - len - 1);\n    if (letter && letter !== ' ') {\n      return wordPrefix;\n    }\n  }\n  return max;\n}\n\n/**\n * Wrap text to the specified width.\n *\n * @param text Text to wrap.\n * @param limit Width to wrap each line.\n * @returns Wrapped text.\n * @alias Blockly.utils.string.wrap\n */\nexport function wrap(text: string, limit: number): string {\n  const lines = text.split('\\n');\n  for (let i = 0; i < lines.length; i++) {\n    lines[i] = wrapLine(lines[i], limit);\n  }\n  return lines.join('\\n');\n}\n\n/**\n * Wrap single line of text to the specified width.\n *\n * @param text Text to wrap.\n * @param limit Width to wrap each line.\n * @returns Wrapped text.\n */\nfunction wrapLine(text: string, limit: number): string {\n  if (text.length <= limit) {\n    // Short text, no need to wrap.\n    return text;\n  }\n  // Split the text into words.\n  const words = text.trim().split(/\\s+/);\n  // Set limit to be the length of the largest word.\n  for (let i = 0; i < words.length; i++) {\n    if (words[i].length > limit) {\n      limit = words[i].length;\n    }\n  }\n\n  let lastScore;\n  let score = -Infinity;\n  let lastText;\n  let lineCount = 1;\n  do {\n    lastScore = score;\n    lastText = text;\n    // Create a list of booleans representing if a space (false) or\n    // a break (true) appears after each word.\n    let wordBreaks = [];\n    // Seed the list with evenly spaced linebreaks.\n    const steps = words.length / lineCount;\n    let insertedBreaks = 1;\n    for (let i = 0; i < words.length - 1; i++) {\n      if (insertedBreaks < (i + 1.5) / steps) {\n        insertedBreaks++;\n        wordBreaks[i] = true;\n      } else {\n        wordBreaks[i] = false;\n      }\n    }\n    wordBreaks = wrapMutate(words, wordBreaks, limit);\n    score = wrapScore(words, wordBreaks, limit);\n    text = wrapToText(words, wordBreaks);\n    lineCount++;\n  } while (score > lastScore);\n  return lastText;\n}\n\n/**\n * Compute a score for how good the wrapping is.\n *\n * @param words Array of each word.\n * @param wordBreaks Array of line breaks.\n * @param limit Width to wrap each line.\n * @returns Larger the better.\n */\nfunction wrapScore(\n    words: string[], wordBreaks: boolean[], limit: number): number {\n  // If this function becomes a performance liability, add caching.\n  // Compute the length of each line.\n  const lineLengths = [0];\n  const linePunctuation = [];\n  for (let i = 0; i < words.length; i++) {\n    lineLengths[lineLengths.length - 1] += words[i].length;\n    if (wordBreaks[i] === true) {\n      lineLengths.push(0);\n      linePunctuation.push(words[i].charAt(words[i].length - 1));\n    } else if (wordBreaks[i] === false) {\n      lineLengths[lineLengths.length - 1]++;\n    }\n  }\n  const maxLength = Math.max(...lineLengths);\n\n  let score = 0;\n  for (let i = 0; i < lineLengths.length; i++) {\n    // Optimize for width.\n    // -2 points per char over limit (scaled to the power of 1.5).\n    score -= Math.pow(Math.abs(limit - lineLengths[i]), 1.5) * 2;\n    // Optimize for even lines.\n    // -1 point per char smaller than max (scaled to the power of 1.5).\n    score -= Math.pow(maxLength - lineLengths[i], 1.5);\n    // Optimize for structure.\n    // Add score to line endings after punctuation.\n    if ('.?!'.indexOf(linePunctuation[i]) !== -1) {\n      score += limit / 3;\n    } else if (',;)]}'.indexOf(linePunctuation[i]) !== -1) {\n      score += limit / 4;\n    }\n  }\n  // All else being equal, the last line should not be longer than the\n  // previous line.  For example, this looks wrong:\n  // aaa bbb\n  // ccc ddd eee\n  if (lineLengths.length > 1 &&\n      lineLengths[lineLengths.length - 1] <=\n          lineLengths[lineLengths.length - 2]) {\n    score += 0.5;\n  }\n  return score;\n}\n/**\n * Mutate the array of line break locations until an optimal solution is found.\n * No line breaks are added or deleted, they are simply moved around.\n *\n * @param words Array of each word.\n * @param wordBreaks Array of line breaks.\n * @param limit Width to wrap each line.\n * @returns New array of optimal line breaks.\n */\nfunction wrapMutate(\n    words: string[], wordBreaks: boolean[], limit: number): boolean[] {\n  let bestScore = wrapScore(words, wordBreaks, limit);\n  let bestBreaks;\n  // Try shifting every line break forward or backward.\n  for (let i = 0; i < wordBreaks.length - 1; i++) {\n    if (wordBreaks[i] === wordBreaks[i + 1]) {\n      continue;\n    }\n    const mutatedWordBreaks = (new Array<boolean>()).concat(wordBreaks);\n    mutatedWordBreaks[i] = !mutatedWordBreaks[i];\n    mutatedWordBreaks[i + 1] = !mutatedWordBreaks[i + 1];\n    const mutatedScore = wrapScore(words, mutatedWordBreaks, limit);\n    if (mutatedScore > bestScore) {\n      bestScore = mutatedScore;\n      bestBreaks = mutatedWordBreaks;\n    }\n  }\n  if (bestBreaks) {\n    // Found an improvement.  See if it may be improved further.\n    return wrapMutate(words, bestBreaks, limit);\n  }\n  // No improvements found.  Done.\n  return wordBreaks;\n}\n\n/**\n * Reassemble the array of words into text, with the specified line breaks.\n *\n * @param words Array of each word.\n * @param wordBreaks Array of line breaks.\n * @returns Plain text.\n */\nfunction wrapToText(words: string[], wordBreaks: boolean[]): string {\n  const text = [];\n  for (let i = 0; i < words.length; i++) {\n    text.push(words[i]);\n    if (wordBreaks[i] !== undefined) {\n      text.push(wordBreaks[i] ? '\\n' : ' ');\n    }\n  }\n  return text.join('');\n}\n\n/**\n * Is the given string a number (includes negative and decimals).\n *\n * @param str Input string.\n * @returns True if number, false otherwise.\n * @alias Blockly.utils.string.isNumber\n */\nexport function isNumber(str: string): boolean {\n  return /^\\s*-?\\d+(\\.\\d+)?\\s*$/.test(str);\n}\n","/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Library to create tooltips for Blockly.\n * First, call createDom() after onload.\n * Second, set the 'tooltip' property on any SVG element that needs a tooltip.\n * If the tooltip is a string, or a function that returns a string, that message\n * will be displayed. If the tooltip is an SVG element, then that object's\n * tooltip will be used. Third, call bindMouseEvents(e) passing the SVG element.\n *\n * @namespace Blockly.Tooltip\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Tooltip');\n\nimport * as browserEvents from './browser_events.js';\nimport * as common from './common.js';\nimport * as blocklyString from './utils/string.js';\n\n\n/**\n * A type which can define a tooltip.\n * Either a string, an object containing a tooltip property, or a function which\n * returns either a string, or another arbitrarily nested function which\n * eventually unwinds to a string.\n *\n * @alias Blockly.Tooltip.TipInfo\n */\nexport type TipInfo =\n    string|{tooltip: AnyDuringMigration}|(() => TipInfo|string|Function);\n\n/**\n * A function that renders custom tooltip UI.\n * 1st parameter: the div element to render content into.\n * 2nd parameter: the element being moused over (i.e., the element for which the\n * tooltip should be shown).\n *\n * @alias Blockly.Tooltip.CustomTooltip\n */\nexport type CustomTooltip = (p1: Element, p2: Element) => AnyDuringMigration;\n\n/**\n * An optional function that renders custom tooltips into the provided DIV. If\n * this is defined, the function will be called instead of rendering the default\n * tooltip UI.\n */\nlet customTooltip: CustomTooltip|undefined = undefined;\n\n/**\n * Sets a custom function that will be called if present instead of the default\n * tooltip UI.\n *\n * @param customFn A custom tooltip used to render an alternate tooltip UI.\n * @alias Blockly.Tooltip.setCustomTooltip\n */\nexport function setCustomTooltip(customFn: CustomTooltip) {\n  customTooltip = customFn;\n}\n\n/**\n * Gets the custom tooltip function.\n *\n * @returns The custom tooltip function, if defined.\n */\nexport function getCustomTooltip(): CustomTooltip|undefined {\n  return customTooltip;\n}\n\n/** Is a tooltip currently showing? */\nlet visible = false;\n\n/**\n * Returns whether or not a tooltip is showing\n *\n * @returns True if a tooltip is showing\n * @alias Blockly.Tooltip.isVisible\n */\nexport function isVisible(): boolean {\n  return visible;\n}\n\n/** Is someone else blocking the tooltip from being shown? */\nlet blocked = false;\n\n/**\n * Maximum width (in characters) of a tooltip.\n *\n * @alias Blockly.Tooltip.LIMIT\n */\nexport const LIMIT = 50;\n\n/** PID of suspended thread to clear tooltip on mouse out. */\nlet mouseOutPid: AnyDuringMigration = 0;\n\n/** PID of suspended thread to show the tooltip. */\nlet showPid: AnyDuringMigration = 0;\n\n/**\n * Last observed X location of the mouse pointer (freezes when tooltip appears).\n */\nlet lastX = 0;\n\n/**\n * Last observed Y location of the mouse pointer (freezes when tooltip appears).\n */\nlet lastY = 0;\n\n/** Current element being pointed at. */\nlet element: AnyDuringMigration = null;\n\n/**\n * Once a tooltip has opened for an element, that element is 'poisoned' and\n * cannot respawn a tooltip until the pointer moves over a different element.\n */\nlet poisonedElement: AnyDuringMigration = null;\n\n/**\n * Horizontal offset between mouse cursor and tooltip.\n *\n * @alias Blockly.Tooltip.OFFSET_X\n */\nexport const OFFSET_X = 0;\n\n/**\n * Vertical offset between mouse cursor and tooltip.\n *\n * @alias Blockly.Tooltip.OFFSET_Y\n */\nexport const OFFSET_Y = 10;\n\n/**\n * Radius mouse can move before killing tooltip.\n *\n * @alias Blockly.Tooltip.RADIUS_OK\n */\nexport const RADIUS_OK = 10;\n\n/**\n * Delay before tooltip appears.\n *\n * @alias Blockly.Tooltip.HOVER_MS\n */\nexport const HOVER_MS = 750;\n\n/**\n * Horizontal padding between tooltip and screen edge.\n *\n * @alias Blockly.Tooltip.MARGINS\n */\nexport const MARGINS = 5;\n\n/** The HTML container.  Set once by createDom. */\nlet containerDiv: HTMLDivElement|null = null;\n\n/**\n * Returns the HTML tooltip container.\n *\n * @returns The HTML tooltip container.\n * @alias Blockly.Tooltip.getDiv\n */\nexport function getDiv(): HTMLDivElement|null {\n  return containerDiv;\n}\n\n/**\n * Returns the tooltip text for the given element.\n *\n * @param object The object to get the tooltip text of.\n * @returns The tooltip text of the element.\n * @alias Blockly.Tooltip.getTooltipOfObject\n */\nexport function getTooltipOfObject(object: AnyDuringMigration|null): string {\n  const obj = getTargetObject(object);\n  if (obj) {\n    let tooltip = obj.tooltip;\n    while (typeof tooltip === 'function') {\n      tooltip = tooltip();\n    }\n    if (typeof tooltip !== 'string') {\n      throw Error('Tooltip function must return a string.');\n    }\n    return tooltip;\n  }\n  return '';\n}\n\n/**\n * Returns the target object that the given object is targeting for its\n * tooltip. Could be the object itself.\n *\n * @param obj The object are trying to find the target tooltip object of.\n * @returns The target tooltip object.\n */\nfunction getTargetObject(obj: object|null): {tooltip: AnyDuringMigration}|null {\n  while (obj && (obj as any).tooltip) {\n    if (typeof (obj as any).tooltip === 'string' ||\n        typeof (obj as any).tooltip === 'function') {\n      return obj as {tooltip: string | (() => string)};\n    }\n    obj = (obj as any).tooltip;\n  }\n  return null;\n}\n\n/**\n * Create the tooltip div and inject it onto the page.\n *\n * @alias Blockly.Tooltip.createDom\n */\nexport function createDom() {\n  if (containerDiv) {\n    return;  // Already created.\n  }\n  // Create an HTML container for popup overlays (e.g. editor widgets).\n  containerDiv = document.createElement('div');\n  containerDiv.className = 'blocklyTooltipDiv';\n  const container = common.getParentContainer() || document.body;\n  container.appendChild(containerDiv);\n}\n\n/**\n * Binds the required mouse events onto an SVG element.\n *\n * @param element SVG element onto which tooltip is to be bound.\n * @alias Blockly.Tooltip.bindMouseEvents\n */\nexport function bindMouseEvents(element: Element) {\n  // TODO (#6097): Don't stash wrapper info on the DOM.\n  (element as AnyDuringMigration).mouseOverWrapper_ =\n      browserEvents.bind(element, 'pointerover', null, onMouseOver);\n  (element as AnyDuringMigration).mouseOutWrapper_ =\n      browserEvents.bind(element, 'pointerout', null, onMouseOut);\n\n  // Don't use bindEvent_ for mousemove since that would create a\n  // corresponding touch handler, even though this only makes sense in the\n  // context of a mouseover/mouseout.\n  element.addEventListener('pointermove', onMouseMove, false);\n}\n\n/**\n * Unbinds tooltip mouse events from the SVG element.\n *\n * @param element SVG element onto which tooltip is bound.\n * @alias Blockly.Tooltip.unbindMouseEvents\n */\nexport function unbindMouseEvents(element: Element|null) {\n  if (!element) {\n    return;\n  }\n  // TODO (#6097): Don't stash wrapper info on the DOM.\n  browserEvents.unbind((element as AnyDuringMigration).mouseOverWrapper_);\n  browserEvents.unbind((element as AnyDuringMigration).mouseOutWrapper_);\n  element.removeEventListener('pointermove', onMouseMove);\n}\n\n/**\n * Hide the tooltip if the mouse is over a different object.\n * Initialize the tooltip to potentially appear for this object.\n *\n * @param e Mouse event.\n */\nfunction onMouseOver(e: PointerEvent) {\n  if (blocked) {\n    // Someone doesn't want us to show tooltips.\n    return;\n  }\n  // If the tooltip is an object, treat it as a pointer to the next object in\n  // the chain to look at.  Terminate when a string or function is found.\n  const newElement = getTargetObject(e.currentTarget);\n  if (element !== newElement) {\n    hide();\n    poisonedElement = null;\n    element = newElement;\n  }\n  // Forget about any immediately preceding mouseOut event.\n  clearTimeout(mouseOutPid);\n}\n\n/**\n * Hide the tooltip if the mouse leaves the object and enters the workspace.\n *\n * @param _e Mouse event.\n */\nfunction onMouseOut(_e: PointerEvent) {\n  if (blocked) {\n    // Someone doesn't want us to show tooltips.\n    return;\n  }\n  // Moving from one element to another (overlapping or with no gap) generates\n  // a mouseOut followed instantly by a mouseOver.  Fork off the mouseOut\n  // event and kill it if a mouseOver is received immediately.\n  // This way the task only fully executes if mousing into the void.\n  mouseOutPid = setTimeout(function() {\n    element = null;\n    poisonedElement = null;\n    hide();\n  }, 1);\n  clearTimeout(showPid);\n}\n\n/**\n * When hovering over an element, schedule a tooltip to be shown.  If a tooltip\n * is already visible, hide it if the mouse strays out of a certain radius.\n *\n * @param e Mouse event.\n */\nfunction onMouseMove(e: Event) {\n  if (!element || !(element as AnyDuringMigration).tooltip) {\n    // No tooltip here to show.\n    return;\n  } else if (blocked) {\n    // Someone doesn't want us to show tooltips.  We are probably handling a\n    // user gesture, such as a click or drag.\n    return;\n  }\n  if (visible) {\n    // Compute the distance between the mouse position when the tooltip was\n    // shown and the current mouse position.  Pythagorean theorem.\n    // AnyDuringMigration because:  Property 'pageX' does not exist on type\n    // 'Event'.\n    const dx = lastX - (e as AnyDuringMigration).pageX;\n    // AnyDuringMigration because:  Property 'pageY' does not exist on type\n    // 'Event'.\n    const dy = lastY - (e as AnyDuringMigration).pageY;\n    if (Math.sqrt(dx * dx + dy * dy) > RADIUS_OK) {\n      hide();\n    }\n  } else if (poisonedElement !== element) {\n    // The mouse moved, clear any previously scheduled tooltip.\n    clearTimeout(showPid);\n    // Maybe this time the mouse will stay put.  Schedule showing of tooltip.\n    // AnyDuringMigration because:  Property 'pageX' does not exist on type\n    // 'Event'.\n    lastX = (e as AnyDuringMigration).pageX;\n    // AnyDuringMigration because:  Property 'pageY' does not exist on type\n    // 'Event'.\n    lastY = (e as AnyDuringMigration).pageY;\n    showPid = setTimeout(show, HOVER_MS);\n  }\n}\n\n/**\n * Dispose of the tooltip.\n *\n * @alias Blockly.Tooltip.dispose\n * @internal\n */\nexport function dispose() {\n  element = null;\n  poisonedElement = null;\n  hide();\n}\n\n/**\n * Hide the tooltip.\n *\n * @alias Blockly.Tooltip.hide\n */\nexport function hide() {\n  if (visible) {\n    visible = false;\n    if (containerDiv) {\n      containerDiv.style.display = 'none';\n    }\n  }\n  if (showPid) {\n    clearTimeout(showPid);\n  }\n}\n\n/**\n * Hide any in-progress tooltips and block showing new tooltips until the next\n * call to unblock().\n *\n * @alias Blockly.Tooltip.block\n * @internal\n */\nexport function block() {\n  hide();\n  blocked = true;\n}\n\n/**\n * Unblock tooltips: allow them to be scheduled and shown according to their own\n * logic.\n *\n * @alias Blockly.Tooltip.unblock\n * @internal\n */\nexport function unblock() {\n  blocked = false;\n}\n\n/** Renders the tooltip content into the tooltip div. */\nfunction renderContent() {\n  if (!containerDiv || !element) {\n    // This shouldn't happen, but if it does, we can't render.\n    return;\n  }\n  if (typeof customTooltip === 'function') {\n    customTooltip(containerDiv, element);\n  } else {\n    renderDefaultContent();\n  }\n}\n\n/** Renders the default tooltip UI. */\nfunction renderDefaultContent() {\n  let tip = getTooltipOfObject(element);\n  tip = blocklyString.wrap(tip, LIMIT);\n  // Create new text, line by line.\n  const lines = tip.split('\\n');\n  for (let i = 0; i < lines.length; i++) {\n    const div = (document.createElement('div'));\n    div.appendChild(document.createTextNode(lines[i]));\n    containerDiv!.appendChild(div);\n  }\n}\n\n/**\n * Gets the coordinates for the tooltip div, taking into account the edges of\n * the screen to prevent showing the tooltip offscreen.\n *\n * @param rtl True if the tooltip should be in right-to-left layout.\n * @returns Coordinates at which the tooltip div should be placed.\n */\nfunction getPosition(rtl: boolean): {x: number, y: number} {\n  // Position the tooltip just below the cursor.\n  const windowWidth = document.documentElement.clientWidth;\n  const windowHeight = document.documentElement.clientHeight;\n\n  let anchorX = lastX;\n  if (rtl) {\n    anchorX -= OFFSET_X + containerDiv!.offsetWidth;\n  } else {\n    anchorX += OFFSET_X;\n  }\n\n  let anchorY = lastY + OFFSET_Y;\n  if (anchorY + containerDiv!.offsetHeight > windowHeight + window.scrollY) {\n    // Falling off the bottom of the screen; shift the tooltip up.\n    anchorY -= containerDiv!.offsetHeight + 2 * OFFSET_Y;\n  }\n\n  if (rtl) {\n    // Prevent falling off left edge in RTL mode.\n    anchorX = Math.max(MARGINS - window.scrollX, anchorX);\n  } else {\n    if (anchorX + containerDiv!.offsetWidth >\n        windowWidth + window.scrollX - 2 * MARGINS) {\n      // Falling off the right edge of the screen;\n      // clamp the tooltip on the edge.\n      anchorX = windowWidth - containerDiv!.offsetWidth - 2 * MARGINS;\n    }\n  }\n\n  return {x: anchorX, y: anchorY};\n}\n\n/** Create the tooltip and show it. */\nfunction show() {\n  if (blocked) {\n    // Someone doesn't want us to show tooltips.\n    return;\n  }\n  poisonedElement = element;\n  if (!containerDiv) {\n    return;\n  }\n  // Erase all existing text.\n  containerDiv.textContent = '';\n\n  // Add new content.\n  renderContent();\n\n  // Display the tooltip.\n  const rtl = (element as any).RTL;\n  containerDiv.style.direction = rtl ? 'rtl' : 'ltr';\n  containerDiv.style.display = 'block';\n  visible = true;\n\n  const {x, y} = getPosition(rtl);\n  containerDiv.style.left = x + 'px';\n  containerDiv.style.top = y + 'px';\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Utility methods for colour manipulation.\n *\n * @namespace Blockly.utils.colour\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.utils.colour');\n\n\n/**\n * The richness of block colours, regardless of the hue.\n * Must be in the range of 0 (inclusive) to 1 (exclusive).\n *\n * @alias Blockly.utils.colour.hsvSaturation\n */\nlet hsvSaturation = 0.45;\n\n/**\n * Get the richness of block colours, regardless of the hue.\n *\n * @alias Blockly.utils.colour.getHsvSaturation\n * @returns The current richness.\n * @internal\n */\nexport function getHsvSaturation(): number {\n  return hsvSaturation;\n}\n\n/**\n * Set the richness of block colours, regardless of the hue.\n *\n * @param newSaturation The new richness, in the range of  0 (inclusive) to 1\n *     (exclusive)\n * @alias Blockly.utils.colour.setHsvSaturation\n * @internal\n */\nexport function setHsvSaturation(newSaturation: number) {\n  hsvSaturation = newSaturation;\n}\n\n/**\n * The intensity of block colours, regardless of the hue.\n * Must be in the range of 0 (inclusive) to 1 (exclusive).\n *\n * @alias Blockly.utils.colour.hsvValue\n */\nlet hsvValue = 0.65;\n\n/**\n * Get the intensity of block colours, regardless of the hue.\n *\n * @alias Blockly.utils.colour.getHsvValue\n * @returns The current intensity.\n * @internal\n */\nexport function getHsvValue(): number {\n  return hsvValue;\n}\n\n/**\n * Set the intensity of block colours, regardless of the hue.\n *\n * @param newValue The new intensity, in the range of  0 (inclusive) to 1\n *     (exclusive)\n * @alias Blockly.utils.colour.setHsvValue\n * @internal\n */\nexport function setHsvValue(newValue: number) {\n  hsvValue = newValue;\n}\n\n/**\n * Parses a colour from a string.\n * .parse('red') = '#ff0000'\n * .parse('#f00') = '#ff0000'\n * .parse('#ff0000') = '#ff0000'\n * .parse('0xff0000') = '#ff0000'\n * .parse('rgb(255, 0, 0)') = '#ff0000'\n *\n * @param str Colour in some CSS format.\n * @returns A string containing a hex representation of the colour, or null if\n *     can't be parsed.\n * @alias Blockly.utils.colour.parse\n */\nexport function parse(str: string|number): string|null {\n  str = String(str).toLowerCase().trim();\n  let hex = names[str];\n  if (hex) {\n    // e.g. 'red'\n    return hex;\n  }\n  hex = str.substring(0, 2) === '0x' ? '#' + str.substring(2) : str;\n  hex = hex[0] === '#' ? hex : '#' + hex;\n  if (/^#[0-9a-f]{6}$/.test(hex)) {\n    // e.g. '#00ff88'\n    return hex;\n  }\n  if (/^#[0-9a-f]{3}$/.test(hex)) {\n    // e.g. '#0f8'\n    return ['#', hex[1], hex[1], hex[2], hex[2], hex[3], hex[3]].join('');\n  }\n  const rgb = str.match(/^(?:rgb)?\\s*\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*\\)$/);\n  if (rgb) {\n    // e.g. 'rgb(0, 128, 255)'\n    const r = Number(rgb[1]);\n    const g = Number(rgb[2]);\n    const b = Number(rgb[3]);\n    if (r >= 0 && r < 256 && g >= 0 && g < 256 && b >= 0 && b < 256) {\n      return rgbToHex(r, g, b);\n    }\n  }\n  return null;\n}\n\n/**\n * Converts a colour from RGB to hex representation.\n *\n * @param r Amount of red, int between 0 and 255.\n * @param g Amount of green, int between 0 and 255.\n * @param b Amount of blue, int between 0 and 255.\n * @returns Hex representation of the colour.\n * @alias Blockly.utils.colour.rgbToHex\n */\nexport function rgbToHex(r: number, g: number, b: number): string {\n  const rgb = r << 16 | g << 8 | b;\n  if (r < 0x10) {\n    return '#' + (0x1000000 | rgb).toString(16).substr(1);\n  }\n  return '#' + rgb.toString(16);\n}\n\n/**\n * Converts a colour to RGB.\n *\n * @param colour String representing colour in any colour format ('#ff0000',\n *     'red', '0xff000', etc).\n * @returns RGB representation of the colour.\n * @alias Blockly.utils.colour.hexToRgb\n */\nexport function hexToRgb(colour: string): number[] {\n  const hex = parse(colour);\n  if (!hex) {\n    return [0, 0, 0];\n  }\n\n  const rgb = parseInt(hex.substr(1), 16);\n  const r = rgb >> 16;\n  const g = rgb >> 8 & 255;\n  const b = rgb & 255;\n\n  return [r, g, b];\n}\n\n/**\n * Converts an HSV triplet to hex representation.\n *\n * @param h Hue value in [0, 360].\n * @param s Saturation value in [0, 1].\n * @param v Brightness in [0, 255].\n * @returns Hex representation of the colour.\n * @alias Blockly.utils.colour.hsvToHex\n */\nexport function hsvToHex(h: number, s: number, v: number): string {\n  let red = 0;\n  let green = 0;\n  let blue = 0;\n  if (s === 0) {\n    red = v;\n    green = v;\n    blue = v;\n  } else {\n    const sextant = Math.floor(h / 60);\n    const remainder = h / 60 - sextant;\n    const val1 = v * (1 - s);\n    const val2 = v * (1 - s * remainder);\n    const val3 = v * (1 - s * (1 - remainder));\n    switch (sextant) {\n      case 1:\n        red = val2;\n        green = v;\n        blue = val1;\n        break;\n      case 2:\n        red = val1;\n        green = v;\n        blue = val3;\n        break;\n      case 3:\n        red = val1;\n        green = val2;\n        blue = v;\n        break;\n      case 4:\n        red = val3;\n        green = val1;\n        blue = v;\n        break;\n      case 5:\n        red = v;\n        green = val1;\n        blue = val2;\n        break;\n      case 6:\n      case 0:\n        red = v;\n        green = val3;\n        blue = val1;\n        break;\n    }\n  }\n  return rgbToHex(Math.floor(red), Math.floor(green), Math.floor(blue));\n}\n\n/**\n * Blend two colours together, using the specified factor to indicate the\n * weight given to the first colour.\n *\n * @param colour1 First colour.\n * @param colour2 Second colour.\n * @param factor The weight to be given to colour1 over colour2.\n *     Values should be in the range [0, 1].\n * @returns Combined colour represented in hex.\n * @alias Blockly.utils.colour.blend\n */\nexport function blend(colour1: string, colour2: string, factor: number): string|\n    null {\n  const hex1 = parse(colour1);\n  if (!hex1) {\n    return null;\n  }\n  const hex2 = parse(colour2);\n  if (!hex2) {\n    return null;\n  }\n  const rgb1 = hexToRgb(hex1);\n  const rgb2 = hexToRgb(hex2);\n  const r = Math.round(rgb2[0] + factor * (rgb1[0] - rgb2[0]));\n  const g = Math.round(rgb2[1] + factor * (rgb1[1] - rgb2[1]));\n  const b = Math.round(rgb2[2] + factor * (rgb1[2] - rgb2[2]));\n  return rgbToHex(r, g, b);\n}\n\n/**\n * A map that contains the 16 basic colour keywords as defined by W3C:\n * https://www.w3.org/TR/2018/REC-css-color-3-20180619/#html4\n * The keys of this map are the lowercase \"readable\" names of the colours,\n * while the values are the \"hex\" values.\n *\n * @alias Blockly.utils.colour.names\n */\nexport const names: {[key: string]: string} = {\n  'aqua': '#00ffff',\n  'black': '#000000',\n  'blue': '#0000ff',\n  'fuchsia': '#ff00ff',\n  'gray': '#808080',\n  'green': '#008000',\n  'lime': '#00ff00',\n  'maroon': '#800000',\n  'navy': '#000080',\n  'olive': '#808000',\n  'purple': '#800080',\n  'red': '#ff0000',\n  'silver': '#c0c0c0',\n  'teal': '#008080',\n  'white': '#ffffff',\n  'yellow': '#ffff00',\n};\n\n/**\n * Convert a hue (HSV model) into an RGB hex triplet.\n *\n * @param hue Hue on a colour wheel (0-360).\n * @returns RGB code, e.g. '#5ba65b'.\n * @alias Blockly.utils.colour.hueToHex\n */\nexport function hueToHex(hue: number): string {\n  return hsvToHex(hue, hsvSaturation, hsvValue * 255);\n}\n","/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @namespace Blockly.utils.parsing\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.utils.parsing');\n\nimport {Msg} from '../msg.js';\n\nimport * as colourUtils from './colour.js';\n\n\n/**\n * Internal implementation of the message reference and interpolation token\n * parsing used by tokenizeInterpolation() and replaceMessageReferences().\n *\n * @param message Text which might contain string table references and\n *     interpolation tokens.\n * @param parseInterpolationTokens Option to parse numeric\n *     interpolation tokens (%1, %2, ...) when true.\n * @returns Array of strings and numbers.\n */\nfunction tokenizeInterpolationInternal(\n    message: string, parseInterpolationTokens: boolean): (string|number)[] {\n  const tokens = [];\n  const chars = message.split('');\n  chars.push('');  // End marker.\n  // Parse the message with a finite state machine.\n  // 0 - Base case.\n  // 1 - % found.\n  // 2 - Digit found.\n  // 3 - Message ref found.\n  let state = 0;\n  const buffer = new Array<string>();\n  let number = null;\n  for (let i = 0; i < chars.length; i++) {\n    const c = chars[i];\n    if (state === 0) {  // Start escape.\n      if (c === '%') {\n        const text = buffer.join('');\n        if (text) {\n          tokens.push(text);\n        }\n        buffer.length = 0;\n        state = 1;\n      } else {\n        buffer.push(c);  // Regular char.\n      }\n    } else if (state === 1) {\n      if (c === '%') {\n        buffer.push(c);  // Escaped %: %%\n        state = 0;\n      } else if (parseInterpolationTokens && '0' <= c && c <= '9') {\n        state = 2;\n        number = c;\n        const text = buffer.join('');\n        if (text) {\n          tokens.push(text);\n        }\n        buffer.length = 0;\n      } else if (c === '{') {\n        state = 3;\n      } else {\n        buffer.push('%', c);  // Not recognized. Return as literal.\n        state = 0;\n      }\n    } else if (state === 2) {\n      if ('0' <= c && c <= '9') {\n        number += c;  // Multi-digit number.\n      } else {\n        tokens.push(parseInt(number ?? '', 10));\n        i--;  // Parse this char again.\n        state = 0;\n      }\n    } else if (state === 3) {  // String table reference\n      if (c === '') {\n        // Premature end before closing '}'\n        buffer.splice(0, 0, '%{');  // Re-insert leading delimiter\n        i--;                        // Parse this char again.\n        state = 0;                  // and parse as string literal.\n      } else if (c !== '}') {\n        buffer.push(c);\n      } else {\n        const rawKey = buffer.join('');\n        if (/[A-Z]\\w*/i.test(rawKey)) {  // Strict matching\n          // Found a valid string key. Attempt case insensitive match.\n          const keyUpper = rawKey.toUpperCase();\n\n          // BKY_ is the prefix used to namespace the strings used in\n          // Blockly core files and the predefined blocks in ../blocks/.\n          // These strings are defined in ../msgs/ files.\n          const bklyKey =\n              keyUpper.startsWith('BKY_') ? keyUpper.substring(4) : null;\n          if (bklyKey && bklyKey in Msg) {\n            const rawValue = Msg[bklyKey];\n            if (typeof rawValue === 'string') {\n              // Attempt to dereference substrings, too, appending to the\n              // end.\n              Array.prototype.push.apply(\n                  tokens,\n                  tokenizeInterpolationInternal(\n                      rawValue, parseInterpolationTokens));\n            } else if (parseInterpolationTokens) {\n              // When parsing interpolation tokens, numbers are special\n              // placeholders (%1, %2, etc). Make sure all other values are\n              // strings.\n              tokens.push(String(rawValue));\n            } else {\n              tokens.push(rawValue);\n            }\n          } else {\n            // No entry found in the string table. Pass reference as string.\n            tokens.push('%{' + rawKey + '}');\n          }\n          buffer.length = 0;  // Clear the array\n          state = 0;\n        } else {\n          tokens.push('%{' + rawKey + '}');\n          buffer.length = 0;\n          state = 0;  // and parse as string literal.\n        }\n      }\n    }\n  }\n  let text = buffer.join('');\n  if (text) {\n    tokens.push(text);\n  }\n\n  // Merge adjacent text tokens into a single string.\n  const mergedTokens = [];\n  buffer.length = 0;\n  for (let i = 0; i < tokens.length; i++) {\n    if (typeof tokens[i] === 'string') {\n      buffer.push(tokens[i] as string);\n    } else {\n      text = buffer.join('');\n      if (text) {\n        mergedTokens.push(text);\n      }\n      buffer.length = 0;\n      mergedTokens.push(tokens[i]);\n    }\n  }\n  text = buffer.join('');\n  if (text) {\n    mergedTokens.push(text);\n  }\n  buffer.length = 0;\n\n  return mergedTokens;\n}\n\n/**\n * Parse a string with any number of interpolation tokens (%1, %2, ...).\n * It will also replace string table references (e.g., %{bky_my_msg} and\n * %{BKY_MY_MSG} will both be replaced with the value in\n * Msg['MY_MSG']). Percentage sign characters '%' may be self-escaped\n * (e.g., '%%').\n *\n * @param message Text which might contain string table references and\n *     interpolation tokens.\n * @returns Array of strings and numbers.\n * @alias Blockly.utils.parsing.tokenizeInterpolation\n */\nexport function tokenizeInterpolation(message: string): (string|number)[] {\n  return tokenizeInterpolationInternal(message, true);\n}\n\n/**\n * Replaces string table references in a message, if the message is a string.\n * For example, \"%{bky_my_msg}\" and \"%{BKY_MY_MSG}\" will both be replaced with\n * the value in Msg['MY_MSG'].\n *\n * @param message Message, which may be a string that contains\n *     string table references.\n * @returns String with message references replaced.\n * @alias Blockly.utils.parsing.replaceMessageReferences\n */\nexport function replaceMessageReferences(message: string|any): string {\n  if (typeof message !== 'string') {\n    return message;\n  }\n  const interpolatedResult = tokenizeInterpolationInternal(message, false);\n  // When parseInterpolationTokens === false, interpolatedResult should be at\n  // most length 1.\n  return interpolatedResult.length ? String(interpolatedResult[0]) : '';\n}\n\n/**\n * Validates that any %{MSG_KEY} references in the message refer to keys of\n * the Msg string table.\n *\n * @param message Text which might contain string table references.\n * @returns True if all message references have matching values.\n *     Otherwise, false.\n * @alias Blockly.utils.parsing.checkMessageReferences\n */\nexport function checkMessageReferences(message: string): boolean {\n  let validSoFar = true;\n\n  const msgTable = Msg;\n  // TODO (#1169): Implement support for other string tables,\n  // prefixes other than BKY_.\n  const m = message.match(/%{BKY_[A-Z]\\w*}/ig);\n  if (m) {\n    for (let i = 0; i < m.length; i++) {\n      const msgKey = m[i].toUpperCase();\n      if (msgTable[msgKey.slice(6, -1)] === undefined) {\n        console.warn('No message string for ' + m[i] + ' in ' + message);\n        validSoFar = false;  // Continue to report other errors.\n      }\n    }\n  }\n\n  return validSoFar;\n}\n\n/**\n * Parse a block colour from a number or string, as provided in a block\n * definition.\n *\n * @param colour HSV hue value (0 to 360), #RRGGBB string,\n *     or a message reference string pointing to one of those two values.\n * @returns An object containing the colour as\n *     a #RRGGBB string, and the hue if the input was an HSV hue value.\n * @throws {Error} If the colour cannot be parsed.\n * @alias Blockly.utils.parsing.parseBlockColour\n */\nexport function parseBlockColour(colour: number|\n                                 string): {hue: number|null, hex: string} {\n  const dereferenced =\n      typeof colour === 'string' ? replaceMessageReferences(colour) : colour;\n\n  const hue = Number(dereferenced);\n  if (!isNaN(hue) && 0 <= hue && hue <= 360) {\n    return {\n      hue: hue,\n      hex: colourUtils.hsvToHex(\n          hue, colourUtils.getHsvSaturation(), colourUtils.getHsvValue() * 255),\n    };\n  } else {\n    const hex = colourUtils.parse(dereferenced);\n    if (hex) {\n      // Only store hue if colour is set as a hue.\n      return {hue: null, hex: hex};\n    } else {\n      let errorMsg = 'Invalid colour: \"' + dereferenced + '\"';\n      if (colour !== dereferenced) {\n        errorMsg += ' (from \"' + colour + '\")';\n      }\n      throw Error(errorMsg);\n    }\n  }\n}\n","/**\n * @license\n * Copyright 2013 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * A div that floats on top of Blockly.  This singleton contains\n *     temporary HTML UI widgets that the user is currently interacting with.\n *     E.g. text input areas, colour pickers, context menus.\n *\n * @namespace Blockly.WidgetDiv\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.WidgetDiv');\n\nimport * as common from './common.js';\nimport * as dom from './utils/dom.js';\nimport type {Rect} from './utils/rect.js';\nimport type {Size} from './utils/size.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/** The object currently using this container. */\nlet owner: unknown = null;\n\n/** Optional cleanup function set by whichever object uses the widget. */\nlet dispose: (() => void)|null = null;\n\n/** A class name representing the current owner's workspace renderer. */\nlet rendererClassName = '';\n\n/** A class name representing the current owner's workspace theme. */\nlet themeClassName = '';\n\n/** The HTML container for popup overlays (e.g. editor widgets). */\nlet containerDiv: HTMLDivElement|null;\n\n/**\n * Returns the HTML container for editor widgets.\n *\n * @returns The editor widget container.\n * @alias Blockly.WidgetDiv.getDiv\n */\nexport function getDiv(): HTMLDivElement|null {\n  return containerDiv;\n}\n\n/**\n * Allows unit tests to reset the div. Do not use outside of tests.\n *\n * @param newDiv The new value for the DIV field.\n * @alias Blockly.WidgetDiv.testOnly_setDiv\n * @internal\n */\nexport function testOnly_setDiv(newDiv: HTMLDivElement|null) {\n  containerDiv = newDiv;\n}\n\n/**\n * Create the widget div and inject it onto the page.\n *\n * @alias Blockly.WidgetDiv.createDom\n */\nexport function createDom() {\n  if (containerDiv) {\n    return;  // Already created.\n  }\n\n  containerDiv = document.createElement('div') as HTMLDivElement;\n  containerDiv.className = 'blocklyWidgetDiv';\n  const container = common.getParentContainer() || document.body;\n  container.appendChild(containerDiv);\n}\n\n/**\n * Initialize and display the widget div.  Close the old one if needed.\n *\n * @param newOwner The object that will be using this container.\n * @param rtl Right-to-left (true) or left-to-right (false).\n * @param newDispose Optional cleanup function to be run when the widget is\n *     closed.\n * @alias Blockly.WidgetDiv.show\n */\nexport function show(newOwner: unknown, rtl: boolean, newDispose: () => void) {\n  hide();\n  owner = newOwner;\n  dispose = newDispose;\n  const div = containerDiv;\n  if (!div) return;\n  div.style.direction = rtl ? 'rtl' : 'ltr';\n  div.style.display = 'block';\n  const mainWorkspace = common.getMainWorkspace() as WorkspaceSvg;\n  rendererClassName = mainWorkspace.getRenderer().getClassName();\n  themeClassName = mainWorkspace.getTheme().getClassName();\n  if (rendererClassName) {\n    dom.addClass(div, rendererClassName);\n  }\n  if (themeClassName) {\n    dom.addClass(div, themeClassName);\n  }\n}\n\n/**\n * Destroy the widget and hide the div.\n *\n * @alias Blockly.WidgetDiv.hide\n */\nexport function hide() {\n  if (!isVisible()) {\n    return;\n  }\n  owner = null;\n\n  const div = containerDiv;\n  if (!div) return;\n  div.style.display = 'none';\n  div.style.left = '';\n  div.style.top = '';\n  dispose && dispose();\n  dispose = null;\n  div.textContent = '';\n\n  if (rendererClassName) {\n    dom.removeClass(div, rendererClassName);\n    rendererClassName = '';\n  }\n  if (themeClassName) {\n    dom.removeClass(div, themeClassName);\n    themeClassName = '';\n  }\n  (common.getMainWorkspace() as WorkspaceSvg).markFocused();\n}\n\n/**\n * Is the container visible?\n *\n * @returns True if visible.\n * @alias Blockly.WidgetDiv.isVisible\n */\nexport function isVisible(): boolean {\n  return !!owner;\n}\n\n/**\n * Destroy the widget and hide the div if it is being used by the specified\n * object.\n *\n * @param oldOwner The object that was using this container.\n * @alias Blockly.WidgetDiv.hideIfOwner\n */\nexport function hideIfOwner(oldOwner: unknown) {\n  if (owner === oldOwner) {\n    hide();\n  }\n}\n/**\n * Set the widget div's position and height.  This function does nothing clever:\n * it will not ensure that your widget div ends up in the visible window.\n *\n * @param x Horizontal location (window coordinates, not body).\n * @param y Vertical location (window coordinates, not body).\n * @param height The height of the widget div (pixels).\n */\nfunction positionInternal(x: number, y: number, height: number) {\n  containerDiv!.style.left = x + 'px';\n  containerDiv!.style.top = y + 'px';\n  containerDiv!.style.height = height + 'px';\n}\n\n/**\n * Position the widget div based on an anchor rectangle.\n * The widget should be placed adjacent to but not overlapping the anchor\n * rectangle.  The preferred position is directly below and aligned to the left\n * (LTR) or right (RTL) side of the anchor.\n *\n * @param viewportBBox The bounding rectangle of the current viewport, in window\n *     coordinates.\n * @param anchorBBox The bounding rectangle of the anchor, in window\n *     coordinates.\n * @param widgetSize The size of the widget that is inside the widget div, in\n *     window coordinates.\n * @param rtl Whether the workspace is in RTL mode.  This determines horizontal\n *     alignment.\n * @alias Blockly.WidgetDiv.positionWithAnchor\n * @internal\n */\nexport function positionWithAnchor(\n    viewportBBox: Rect, anchorBBox: Rect, widgetSize: Size, rtl: boolean) {\n  const y = calculateY(viewportBBox, anchorBBox, widgetSize);\n  const x = calculateX(viewportBBox, anchorBBox, widgetSize, rtl);\n\n  if (y < 0) {\n    positionInternal(x, 0, widgetSize.height + y);\n  } else {\n    positionInternal(x, y, widgetSize.height);\n  }\n}\n\n/**\n * Calculate an x position (in window coordinates) such that the widget will not\n * be offscreen on the right or left.\n *\n * @param viewportBBox The bounding rectangle of the current viewport, in window\n *     coordinates.\n * @param anchorBBox The bounding rectangle of the anchor, in window\n *     coordinates.\n * @param widgetSize The dimensions of the widget inside the widget div.\n * @param rtl Whether the Blockly workspace is in RTL mode.\n * @returns A valid x-coordinate for the top left corner of the widget div, in\n *     window coordinates.\n */\nfunction calculateX(\n    viewportBBox: Rect, anchorBBox: Rect, widgetSize: Size,\n    rtl: boolean): number {\n  if (rtl) {\n    // Try to align the right side of the field and the right side of widget.\n    const widgetLeft = anchorBBox.right - widgetSize.width;\n    // Don't go offscreen left.\n    const x = Math.max(widgetLeft, viewportBBox.left);\n    // But really don't go offscreen right:\n    return Math.min(x, viewportBBox.right - widgetSize.width);\n  } else {\n    // Try to align the left side of the field and the left side of widget.\n    // Don't go offscreen right.\n    const x = Math.min(anchorBBox.left, viewportBBox.right - widgetSize.width);\n    // But left is more important, because that's where the text is.\n    return Math.max(x, viewportBBox.left);\n  }\n}\n\n/**\n * Calculate a y position (in window coordinates) such that the widget will not\n * be offscreen on the top or bottom.\n *\n * @param viewportBBox The bounding rectangle of the current viewport, in window\n *     coordinates.\n * @param anchorBBox The bounding rectangle of the anchor, in window\n *     coordinates.\n * @param widgetSize The dimensions of the widget inside the widget div.\n * @returns A valid y-coordinate for the top left corner of the widget div, in\n *     window coordinates.\n */\nfunction calculateY(\n    viewportBBox: Rect, anchorBBox: Rect, widgetSize: Size): number {\n  // Flip the widget vertically if off the bottom.\n  // The widget could go off the top of the window, but it would also go off\n  // the bottom.  The window is just too small.\n  if (anchorBBox.bottom + widgetSize.height >= viewportBBox.bottom) {\n    // The bottom of the widget is at the top of the field.\n    return anchorBBox.top - widgetSize.height;\n  } else {\n    // The top of the widget is at the bottom of the field.\n    return anchorBBox.bottom;\n  }\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Fields can be created based on a JSON definition. This file\n *    contains methods for registering those JSON definitions, and building the\n *    fields based on JSON.\n *\n * @namespace Blockly.fieldRegistry\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.fieldRegistry');\n\nimport type {Field, FieldProto} from './field.js';\nimport * as registry from './registry.js';\n\ninterface RegistryOptions {\n  type: string;\n  [key: string]: unknown;\n}\n\n/**\n * Registers a field type.\n * fieldRegistry.fromJson uses this registry to\n * find the appropriate field type.\n *\n * @param type The field type name as used in the JSON definition.\n * @param fieldClass The field class containing a fromJson function that can\n *     construct an instance of the field.\n * @throws {Error} if the type name is empty, the field is already registered,\n *     or the fieldClass is not an object containing a fromJson function.\n * @alias Blockly.fieldRegistry.register\n */\nexport function register(type: string, fieldClass: FieldProto) {\n  registry.register(registry.Type.FIELD, type, fieldClass);\n}\n\n/**\n * Unregisters the field registered with the given type.\n *\n * @param type The field type name as used in the JSON definition.\n * @alias Blockly.fieldRegistry.unregister\n */\nexport function unregister(type: string) {\n  registry.unregister(registry.Type.FIELD, type);\n}\n\n/**\n * Construct a Field from a JSON arg object.\n * Finds the appropriate registered field by the type name as registered using\n * fieldRegistry.register.\n *\n * @param options A JSON object with a type and options specific to the field\n *     type.\n * @returns The new field instance or null if a field wasn't found with the\n *     given type name\n * @alias Blockly.fieldRegistry.fromJson\n * @internal\n */\nexport function fromJson<T>(options: RegistryOptions): Field<T>|null {\n  return TEST_ONLY.fromJsonInternal(options);\n}\n\n/**\n * Private version of fromJson for stubbing in tests.\n *\n * @param options\n */\nfunction fromJsonInternal<T>(options: RegistryOptions): Field<T>|null {\n  const fieldObject = registry.getObject(registry.Type.FIELD, options.type);\n  if (!fieldObject) {\n    console.warn(\n        'Blockly could not create a field of type ' + options['type'] +\n        '. The field is probably not being registered. This could be because' +\n        ' the file is not loaded, the field does not register itself (Issue' +\n        ' #1584), or the registration is not being reached.');\n    return null;\n  } else if (typeof (fieldObject as any).fromJson !== 'function') {\n    throw new TypeError('returned Field was not a IRegistrableField');\n  } else {\n    type fromJson = (options: {}) => Field<T>;\n    return (fieldObject as unknown as {fromJson: fromJson}).fromJson(options);\n  }\n}\n\nexport const TEST_ONLY = {\n  fromJsonInternal,\n};\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * ARIA-related constants and utilities.\n * These methods are not specific to Blockly, and could be factored out into\n * a JavaScript framework such as Closure.\n *\n * @namespace Blockly.utils.aria\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.utils.aria');\n\n\n/** ARIA states/properties prefix. */\nconst ARIA_PREFIX = 'aria-';\n\n/** ARIA role attribute. */\nconst ROLE_ATTRIBUTE = 'role';\n\n/**\n * ARIA role values.\n * Copied from Closure's goog.a11y.aria.Role\n *\n * @alias Blockly.utils.aria.Role\n */\nexport enum Role {\n  // ARIA role for an interactive control of tabular data.\n  GRID = 'grid',\n\n  // ARIA role for a cell in a grid.\n  GRIDCELL = 'gridcell',\n  // ARIA role for a group of related elements like tree item siblings.\n  GROUP = 'group',\n\n  // ARIA role for a listbox.\n  LISTBOX = 'listbox',\n\n  // ARIA role for a popup menu.\n  MENU = 'menu',\n\n  // ARIA role for menu item elements.\n  MENUITEM = 'menuitem',\n  // ARIA role for a checkbox box element inside a menu.\n  MENUITEMCHECKBOX = 'menuitemcheckbox',\n  // ARIA role for option items that are  children of combobox, listbox, menu,\n  // radiogroup, or tree elements.\n  OPTION = 'option',\n  // ARIA role for ignorable cosmetic elements with no semantic significance.\n  PRESENTATION = 'presentation',\n\n  // ARIA role for a row of cells in a grid.\n  ROW = 'row',\n  // ARIA role for a tree.\n  TREE = 'tree',\n\n  // ARIA role for a tree item that sometimes may be expanded or collapsed.\n  TREEITEM = 'treeitem'\n}\n\n/**\n * ARIA states and properties.\n * Copied from Closure's goog.a11y.aria.State\n *\n * @alias Blockly.utils.aria.State\n */\nexport enum State {\n  // ARIA property for setting the currently active descendant of an element,\n  // for example the selected item in a list box. Value: ID of an element.\n  ACTIVEDESCENDANT = 'activedescendant',\n  // ARIA property defines the total number of columns in a table, grid, or\n  // treegrid.\n  // Value: integer.\n  COLCOUNT = 'colcount',\n  // ARIA state for a disabled item. Value: one of {true, false}.\n  DISABLED = 'disabled',\n\n  // ARIA state for setting whether the element like a tree node is expanded.\n  // Value: one of {true, false, undefined}.\n  EXPANDED = 'expanded',\n\n  // ARIA state indicating that the entered value does not conform. Value:\n  // one of {false, true, 'grammar', 'spelling'}\n  INVALID = 'invalid',\n\n  // ARIA property that provides a label to override any other text, value, or\n  // contents used to describe this element. Value: string.\n  LABEL = 'label',\n  // ARIA property for setting the element which labels another element.\n  // Value: space-separated IDs of elements.\n  LABELLEDBY = 'labelledby',\n\n  // ARIA property for setting the level of an element in the hierarchy.\n  // Value: integer.\n  LEVEL = 'level',\n  // ARIA property indicating if the element is horizontal or vertical.\n  // Value: one of {'vertical', 'horizontal'}.\n  ORIENTATION = 'orientation',\n\n  // ARIA property that defines an element's number of position in a list.\n  // Value: integer.\n  POSINSET = 'posinset',\n\n  // ARIA property defines the total number of rows in a table, grid, or\n  // treegrid.\n  // Value: integer.\n  ROWCOUNT = 'rowcount',\n\n  // ARIA state for setting the currently selected item in the list.\n  // Value: one of {true, false, undefined}.\n  SELECTED = 'selected',\n  // ARIA property defining the number of items in a list. Value: integer.\n  SETSIZE = 'setsize',\n\n  // ARIA property for slider maximum value. Value: number.\n  VALUEMAX = 'valuemax',\n\n  // ARIA property for slider minimum value. Value: number.\n  VALUEMIN = 'valuemin'\n}\n\n/**\n * Sets the role of an element.\n *\n * Similar to Closure's goog.a11y.aria\n *\n * @param element DOM node to set role of.\n * @param roleName Role name.\n * @alias Blockly.utils.aria.setRole\n */\nexport function setRole(element: Element, roleName: Role) {\n  element.setAttribute(ROLE_ATTRIBUTE, roleName);\n}\n\n/**\n * Sets the state or property of an element.\n * Copied from Closure's goog.a11y.aria\n *\n * @param element DOM node where we set state.\n * @param stateName State attribute being set.\n *     Automatically adds prefix 'aria-' to the state name if the attribute is\n * not an extra attribute.\n * @param value Value for the state attribute.\n * @alias Blockly.utils.aria.setState\n */\nexport function setState(\n    element: Element, stateName: State, value: string|boolean|number|string[]) {\n  if (Array.isArray(value)) {\n    value = value.join(' ');\n  }\n  const attrStateName = ARIA_PREFIX + stateName;\n  element.setAttribute(attrStateName, `${value}`);\n}\n","/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Dropdown input field.  Used for editable titles and variables.\n * In the interests of a consistent UI, the toolbox shares some functions and\n * properties with the context menu.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.FieldDropdown');\n\nimport type {BlockSvg} from './block_svg.js';\nimport * as dropDownDiv from './dropdowndiv.js';\nimport {Field, FieldConfig, FieldValidator, UnattachedFieldError} from './field.js';\nimport * as fieldRegistry from './field_registry.js';\nimport {Menu} from './menu.js';\nimport {MenuItem} from './menuitem.js';\nimport * as aria from './utils/aria.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport * as parsing from './utils/parsing.js';\nimport type {Sentinel} from './utils/sentinel.js';\nimport * as utilsString from './utils/string.js';\nimport {Svg} from './utils/svg.js';\n\nexport type FieldDropdownValidator = FieldValidator<string>;\n\n/**\n * Class for an editable dropdown field.\n *\n * @alias Blockly.FieldDropdown\n */\nexport class FieldDropdown extends Field<string> {\n  /** Horizontal distance that a checkmark overhangs the dropdown. */\n  static CHECKMARK_OVERHANG = 25;\n\n  /**\n   * Maximum height of the dropdown menu, as a percentage of the viewport\n   * height.\n   */\n  static MAX_MENU_HEIGHT_VH = 0.45;\n\n  static ARROW_CHAR = '';\n\n  /** A reference to the currently selected menu item. */\n  private selectedMenuItem_: MenuItem|null = null;\n\n  /** The dropdown menu. */\n  protected menu_: Menu|null = null;\n\n  /**\n   * SVG image element if currently selected option is an image, or null.\n   */\n  private imageElement_: SVGImageElement|null = null;\n\n  /** Tspan based arrow element. */\n  private arrow_: SVGTSpanElement|null = null;\n\n  /** SVG based arrow element. */\n  private svgArrow_: SVGElement|null = null;\n\n  /**\n   * Serializable fields are saved by the serializer, non-serializable fields\n   * are not. Editable fields should also be serializable.\n   */\n  override SERIALIZABLE = true;\n\n  /** Mouse cursor style when over the hotspot that initiates the editor. */\n  override CURSOR = 'default';\n\n  protected menuGenerator_?: MenuGenerator;\n\n  /** A cache of the most recently generated options. */\n  private generatedOptions_: MenuOption[]|null = null;\n\n  /**\n   * The prefix field label, of common words set after options are trimmed.\n   *\n   * @internal\n   */\n  override prefixField: string|null = null;\n\n  /**\n   * The suffix field label, of common words set after options are trimmed.\n   *\n   * @internal\n   */\n  override suffixField: string|null = null;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  private selectedOption_!: Array<string|ImageProperties>;\n  override clickTarget_: SVGElement|null = null;\n\n  /**\n   * @param menuGenerator A non-empty array of options for a dropdown list, or a\n   *     function which generates these options. Also accepts Field.SKIP_SETUP\n   *     if you wish to skip setup (only used by subclasses that want to handle\n   *     configuration and setting the field value after their own constructors\n   *     have run).\n   * @param opt_validator A function that is called to validate changes to the\n   *     field's value. Takes in a language-neutral dropdown option & returns a\n   *     validated language-neutral dropdown option, or null to abort the\n   *     change.\n   * @param opt_config A map of options used to configure the field.\n   *     See the [field creation documentation]{@link\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/dropdown#creation}\n   * for a list of properties this parameter supports.\n   * @throws {TypeError} If `menuGenerator` options are incorrectly structured.\n   */\n  constructor(\n      menuGenerator: MenuGenerator,\n      opt_validator?: FieldDropdownValidator,\n      opt_config?: FieldConfig,\n  );\n  constructor(menuGenerator: Sentinel);\n  constructor(\n      menuGenerator: MenuGenerator|Sentinel,\n      opt_validator?: FieldDropdownValidator,\n      opt_config?: FieldConfig,\n  ) {\n    super(Field.SKIP_SETUP);\n\n    // If we pass SKIP_SETUP, don't do *anything* with the menu generator.\n    if (!isMenuGenerator(menuGenerator)) return;\n\n    if (Array.isArray(menuGenerator)) {\n      validateOptions(menuGenerator);\n      const trimmed = trimOptions(menuGenerator);\n      this.menuGenerator_ = trimmed.options;\n      this.prefixField = trimmed.prefix || null;\n      this.suffixField = trimmed.suffix || null;\n    } else {\n      this.menuGenerator_ = menuGenerator;\n    }\n\n    /**\n     * The currently selected option. The field is initialized with the\n     * first option selected.\n     */\n    this.selectedOption_ = this.getOptions(false)[0];\n\n    if (opt_config) {\n      this.configure_(opt_config);\n    }\n    this.setValue(this.selectedOption_[1]);\n    if (opt_validator) {\n      this.setValidator(opt_validator);\n    }\n  }\n\n  /**\n   * Sets the field's value based on the given XML element. Should only be\n   * called by Blockly.Xml.\n   *\n   * @param fieldElement The element containing info about the field's state.\n   * @internal\n   */\n  override fromXml(fieldElement: Element) {\n    if (this.isOptionListDynamic()) {\n      this.getOptions(false);\n    }\n    this.setValue(fieldElement.textContent);\n  }\n\n  /**\n   * Sets the field's value based on the given state.\n   *\n   * @param state The state to apply to the dropdown field.\n   * @internal\n   */\n  override loadState(state: AnyDuringMigration) {\n    if (this.loadLegacyState(FieldDropdown, state)) {\n      return;\n    }\n    if (this.isOptionListDynamic()) {\n      this.getOptions(false);\n    }\n    this.setValue(state);\n  }\n\n  /**\n   * Create the block UI for this dropdown.\n   *\n   * @internal\n   */\n  override initView() {\n    if (this.shouldAddBorderRect_()) {\n      this.createBorderRect_();\n    } else {\n      this.clickTarget_ = (this.sourceBlock_ as BlockSvg).getSvgRoot();\n    }\n    this.createTextElement_();\n\n    this.imageElement_ = dom.createSvgElement(Svg.IMAGE, {}, this.fieldGroup_);\n\n    if (this.getConstants()!.FIELD_DROPDOWN_SVG_ARROW) {\n      this.createSVGArrow_();\n    } else {\n      this.createTextArrow_();\n    }\n\n    if (this.borderRect_) {\n      dom.addClass(this.borderRect_, 'blocklyDropdownRect');\n    }\n  }\n\n  /**\n   * Whether or not the dropdown should add a border rect.\n   *\n   * @returns True if the dropdown field should add a border rect.\n   */\n  protected shouldAddBorderRect_(): boolean {\n    return !this.getConstants()!.FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW ||\n        this.getConstants()!.FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW &&\n        !this.getSourceBlock()?.isShadow();\n  }\n\n  /** Create a tspan based arrow. */\n  protected createTextArrow_() {\n    this.arrow_ = dom.createSvgElement(Svg.TSPAN, {}, this.textElement_);\n    this.arrow_!.appendChild(document.createTextNode(\n        this.getSourceBlock()?.RTL ? FieldDropdown.ARROW_CHAR + ' ' :\n                                     ' ' + FieldDropdown.ARROW_CHAR));\n    if (this.getSourceBlock()?.RTL) {\n      this.getTextElement().insertBefore(this.arrow_, this.textContent_);\n    } else {\n      this.getTextElement().appendChild(this.arrow_);\n    }\n  }\n\n  /** Create an SVG based arrow. */\n  protected createSVGArrow_() {\n    this.svgArrow_ = dom.createSvgElement(\n        Svg.IMAGE, {\n          'height': this.getConstants()!.FIELD_DROPDOWN_SVG_ARROW_SIZE + 'px',\n          'width': this.getConstants()!.FIELD_DROPDOWN_SVG_ARROW_SIZE + 'px',\n        },\n        this.fieldGroup_);\n    this.svgArrow_!.setAttributeNS(\n        dom.XLINK_NS, 'xlink:href',\n        this.getConstants()!.FIELD_DROPDOWN_SVG_ARROW_DATAURI);\n  }\n\n  /**\n   * Create a dropdown menu under the text.\n   *\n   * @param opt_e Optional mouse event that triggered the field to open, or\n   *     undefined if triggered programmatically.\n   */\n  protected override showEditor_(opt_e?: MouseEvent) {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    this.dropdownCreate_();\n    if (opt_e && typeof opt_e.clientX === 'number') {\n      this.menu_!.openingCoords = new Coordinate(opt_e.clientX, opt_e.clientY);\n    } else {\n      this.menu_!.openingCoords = null;\n    }\n\n    // Remove any pre-existing elements in the dropdown.\n    dropDownDiv.clearContent();\n    // Element gets created in render.\n    const menuElement = this.menu_!.render(dropDownDiv.getContentDiv());\n    dom.addClass(menuElement, 'blocklyDropdownMenu');\n\n    if (this.getConstants()!.FIELD_DROPDOWN_COLOURED_DIV) {\n      const primaryColour =\n          block.isShadow() ? block.getParent()!.getColour() : block.getColour();\n      const borderColour = block.isShadow() ?\n          (block.getParent() as BlockSvg).style.colourTertiary :\n          (this.sourceBlock_ as BlockSvg).style.colourTertiary;\n      dropDownDiv.setColour(primaryColour, borderColour);\n    }\n\n    dropDownDiv.showPositionedByField(this, this.dropdownDispose_.bind(this));\n\n    // Focusing needs to be handled after the menu is rendered and positioned.\n    // Otherwise it will cause a page scroll to get the misplaced menu in\n    // view. See issue #1329.\n    this.menu_!.focus();\n\n    if (this.selectedMenuItem_) {\n      this.menu_!.setHighlighted(this.selectedMenuItem_);\n    }\n\n    this.applyColour();\n  }\n\n  /** Create the dropdown editor. */\n  private dropdownCreate_() {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    const menu = new Menu();\n    menu.setRole(aria.Role.LISTBOX);\n    this.menu_ = menu;\n\n    const options = this.getOptions(false);\n    this.selectedMenuItem_ = null;\n    for (let i = 0; i < options.length; i++) {\n      const [label, value] = options[i];\n      const content = (() => {\n        if (typeof label === 'object') {\n          // Convert ImageProperties to an HTMLImageElement.\n          const image = new Image(label['width'], label['height']);\n          image.src = label['src'];\n          image.alt = label['alt'] || '';\n          return image;\n        }\n        return label;\n      })();\n      const menuItem = new MenuItem(content, value);\n      menuItem.setRole(aria.Role.OPTION);\n      menuItem.setRightToLeft(block.RTL);\n      menuItem.setCheckable(true);\n      menu.addChild(menuItem);\n      menuItem.setChecked(value === this.value_);\n      if (value === this.value_) {\n        this.selectedMenuItem_ = menuItem;\n      }\n      menuItem.onAction(this.handleMenuActionEvent_, this);\n    }\n  }\n\n  /**\n   * Disposes of events and DOM-references belonging to the dropdown editor.\n   */\n  private dropdownDispose_() {\n    if (this.menu_) {\n      this.menu_.dispose();\n    }\n    this.menu_ = null;\n    this.selectedMenuItem_ = null;\n    this.applyColour();\n  }\n\n  /**\n   * Handle an action in the dropdown menu.\n   *\n   * @param menuItem The MenuItem selected within menu.\n   */\n  private handleMenuActionEvent_(menuItem: MenuItem) {\n    dropDownDiv.hideIfOwner(this, true);\n    this.onItemSelected_(this.menu_ as Menu, menuItem);\n  }\n\n  /**\n   * Handle the selection of an item in the dropdown menu.\n   *\n   * @param menu The Menu component clicked.\n   * @param menuItem The MenuItem selected within menu.\n   */\n  protected onItemSelected_(menu: Menu, menuItem: MenuItem) {\n    this.setValue(menuItem.getValue());\n  }\n\n  /**\n   * @returns True if the option list is generated by a function.\n   *     Otherwise false.\n   */\n  isOptionListDynamic(): boolean {\n    return typeof this.menuGenerator_ === 'function';\n  }\n\n  /**\n   * Return a list of the options for this dropdown.\n   *\n   * @param opt_useCache For dynamic options, whether or not to use the cached\n   *     options or to re-generate them.\n   * @returns A non-empty array of option tuples:\n   *     (human-readable text or image, language-neutral name).\n   * @throws {TypeError} If generated options are incorrectly structured.\n   */\n  getOptions(opt_useCache?: boolean): MenuOption[] {\n    if (!this.menuGenerator_) {\n      // A subclass improperly skipped setup without defining the menu\n      // generator.\n      throw TypeError('A menu generator was never defined.');\n    }\n    if (Array.isArray(this.menuGenerator_)) return this.menuGenerator_;\n    if (opt_useCache && this.generatedOptions_) return this.generatedOptions_;\n\n    this.generatedOptions_ = this.menuGenerator_();\n    validateOptions(this.generatedOptions_);\n    return this.generatedOptions_;\n  }\n\n  /**\n   * Ensure that the input value is a valid language-neutral option.\n   *\n   * @param opt_newValue The input value.\n   * @returns A valid language-neutral option, or null if invalid.\n   */\n  protected override doClassValidation_(opt_newValue?: MenuOption[1]): string\n      |null {\n    const options = this.getOptions(true);\n    const isValueValid = options.some((option) => option[1] === opt_newValue);\n\n    if (!isValueValid) {\n      if (this.sourceBlock_) {\n        console.warn(\n            'Cannot set the dropdown\\'s value to an unavailable option.' +\n            ' Block type: ' + this.sourceBlock_.type +\n            ', Field name: ' + this.name + ', Value: ' + opt_newValue);\n      }\n      return null;\n    }\n    return opt_newValue as string;\n  }\n\n  /**\n   * Update the value of this dropdown field.\n   *\n   * @param newValue The value to be saved. The default validator guarantees\n   *     that this is one of the valid dropdown options.\n   */\n  protected override doValueUpdate_(newValue: MenuOption[1]) {\n    super.doValueUpdate_(newValue);\n    const options = this.getOptions(true);\n    for (let i = 0, option; option = options[i]; i++) {\n      if (option[1] === this.value_) {\n        this.selectedOption_ = option;\n      }\n    }\n  }\n\n  /**\n   * Updates the dropdown arrow to match the colour/style of the block.\n   *\n   * @internal\n   */\n  override applyColour() {\n    const style = (this.sourceBlock_ as BlockSvg).style;\n    if (this.borderRect_) {\n      this.borderRect_.setAttribute('stroke', style.colourTertiary);\n      if (this.menu_) {\n        this.borderRect_.setAttribute('fill', style.colourTertiary);\n      } else {\n        this.borderRect_.setAttribute('fill', 'transparent');\n      }\n    }\n    // Update arrow's colour.\n    if (this.sourceBlock_ && this.arrow_) {\n      if (this.sourceBlock_.isShadow()) {\n        this.arrow_.style.fill = style.colourSecondary;\n      } else {\n        this.arrow_.style.fill = style.colourPrimary;\n      }\n    }\n  }\n\n  /** Draws the border with the correct width. */\n  protected override render_() {\n    // Hide both elements.\n    this.getTextContent().nodeValue = '';\n    this.imageElement_!.style.display = 'none';\n\n    // Show correct element.\n    const option = this.selectedOption_ && this.selectedOption_[0];\n    if (option && typeof option === 'object') {\n      this.renderSelectedImage_((option));\n    } else {\n      this.renderSelectedText_();\n    }\n\n    this.positionBorderRect_();\n  }\n\n  /**\n   * Renders the selected option, which must be an image.\n   *\n   * @param imageJson Selected option that must be an image.\n   */\n  private renderSelectedImage_(imageJson: ImageProperties) {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    this.imageElement_!.style.display = '';\n    this.imageElement_!.setAttributeNS(\n        dom.XLINK_NS, 'xlink:href', imageJson.src);\n    this.imageElement_!.setAttribute('height', `${imageJson.height}`);\n    this.imageElement_!.setAttribute('width', `${imageJson.width}`);\n\n    const imageHeight = Number(imageJson.height);\n    const imageWidth = Number(imageJson.width);\n\n    // Height and width include the border rect.\n    const hasBorder = !!this.borderRect_;\n    const height = Math.max(\n        hasBorder ? this.getConstants()!.FIELD_DROPDOWN_BORDER_RECT_HEIGHT : 0,\n        imageHeight + IMAGE_Y_PADDING);\n    const xPadding =\n        hasBorder ? this.getConstants()!.FIELD_BORDER_RECT_X_PADDING : 0;\n    let arrowWidth = 0;\n    if (this.svgArrow_) {\n      arrowWidth = this.positionSVGArrow_(\n          imageWidth + xPadding,\n          height / 2 - this.getConstants()!.FIELD_DROPDOWN_SVG_ARROW_SIZE / 2);\n    } else {\n      arrowWidth = dom.getFastTextWidth(\n          this.arrow_ as SVGTSpanElement,\n          this.getConstants()!.FIELD_TEXT_FONTSIZE,\n          this.getConstants()!.FIELD_TEXT_FONTWEIGHT,\n          this.getConstants()!.FIELD_TEXT_FONTFAMILY);\n    }\n    this.size_.width = imageWidth + arrowWidth + xPadding * 2;\n    this.size_.height = height;\n\n    let arrowX = 0;\n    if (block.RTL) {\n      const imageX = xPadding + arrowWidth;\n      this.imageElement_!.setAttribute('x', imageX.toString());\n    } else {\n      arrowX = imageWidth + arrowWidth;\n      this.getTextElement().setAttribute('text-anchor', 'end');\n      this.imageElement_!.setAttribute('x', xPadding.toString());\n    }\n    this.imageElement_!.setAttribute(\n        'y', (height / 2 - imageHeight / 2).toString());\n\n    this.positionTextElement_(arrowX + xPadding, imageWidth + arrowWidth);\n  }\n\n  /** Renders the selected option, which must be text. */\n  private renderSelectedText_() {\n    // Retrieves the selected option to display through getText_.\n    this.getTextContent().nodeValue = this.getDisplayText_();\n    const textElement = this.getTextElement();\n    dom.addClass(textElement, 'blocklyDropdownText');\n    textElement.setAttribute('text-anchor', 'start');\n\n    // Height and width include the border rect.\n    const hasBorder = !!this.borderRect_;\n    const height = Math.max(\n        hasBorder ? this.getConstants()!.FIELD_DROPDOWN_BORDER_RECT_HEIGHT : 0,\n        this.getConstants()!.FIELD_TEXT_HEIGHT);\n    const textWidth = dom.getFastTextWidth(\n        this.getTextElement(), this.getConstants()!.FIELD_TEXT_FONTSIZE,\n        this.getConstants()!.FIELD_TEXT_FONTWEIGHT,\n        this.getConstants()!.FIELD_TEXT_FONTFAMILY);\n    const xPadding =\n        hasBorder ? this.getConstants()!.FIELD_BORDER_RECT_X_PADDING : 0;\n    let arrowWidth = 0;\n    if (this.svgArrow_) {\n      arrowWidth = this.positionSVGArrow_(\n          textWidth + xPadding,\n          height / 2 - this.getConstants()!.FIELD_DROPDOWN_SVG_ARROW_SIZE / 2);\n    }\n    this.size_.width = textWidth + arrowWidth + xPadding * 2;\n    this.size_.height = height;\n\n    this.positionTextElement_(xPadding, textWidth);\n  }\n\n  /**\n   * Position a drop-down arrow at the appropriate location at render-time.\n   *\n   * @param x X position the arrow is being rendered at, in px.\n   * @param y Y position the arrow is being rendered at, in px.\n   * @returns Amount of space the arrow is taking up, in px.\n   */\n  private positionSVGArrow_(x: number, y: number): number {\n    if (!this.svgArrow_) {\n      return 0;\n    }\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    const hasBorder = !!this.borderRect_;\n    const xPadding =\n        hasBorder ? this.getConstants()!.FIELD_BORDER_RECT_X_PADDING : 0;\n    const textPadding = this.getConstants()!.FIELD_DROPDOWN_SVG_ARROW_PADDING;\n    const svgArrowSize = this.getConstants()!.FIELD_DROPDOWN_SVG_ARROW_SIZE;\n    const arrowX = block.RTL ? xPadding : x + textPadding;\n    this.svgArrow_.setAttribute(\n        'transform', 'translate(' + arrowX + ',' + y + ')');\n    return svgArrowSize + textPadding;\n  }\n\n  /**\n   * Use the `getText_` developer hook to override the field's text\n   * representation.  Get the selected option text. If the selected option is an\n   * image we return the image alt text.\n   *\n   * @returns Selected option text.\n   */\n  protected override getText_(): string|null {\n    if (!this.selectedOption_) {\n      return null;\n    }\n    const option = this.selectedOption_[0];\n    if (typeof option === 'object') {\n      return option['alt'];\n    }\n    return option;\n  }\n\n  /**\n   * Construct a FieldDropdown from a JSON arg object.\n   *\n   * @param options A JSON object with options (options).\n   * @returns The new field instance.\n   * @nocollapse\n   * @internal\n   */\n  static fromJson(options: FieldDropdownFromJsonConfig): FieldDropdown {\n    if (!options.options) {\n      throw new Error(\n          'options are required for the dropdown field. The ' +\n          'options property must be assigned an array of ' +\n          '[humanReadableValue, languageNeutralValue] tuples.');\n    }\n    // `this` might be a subclass of FieldDropdown if that class doesn't\n    // override the static fromJson method.\n    return new this(options.options, undefined, options);\n  }\n}\n\n/**\n * Definition of a human-readable image dropdown option.\n */\nexport interface ImageProperties {\n  src: string;\n  alt: string;\n  width: number;\n  height: number;\n}\n\n/**\n * An individual option in the dropdown menu. The first element is the human-\n * readable value (text or image), and the second element is the language-\n * neutral value.\n */\nexport type MenuOption = [string | ImageProperties, string];\n\n/**\n * A function that generates an array of menu options for FieldDropdown\n * or its descendants.\n */\nexport type MenuGeneratorFunction = (this: FieldDropdown) => MenuOption[];\n\n/**\n * Either an array of menu options or a function that generates an array of\n * menu options for FieldDropdown or its descendants.\n */\nexport type MenuGenerator = MenuOption[]|MenuGeneratorFunction;\n\n/**\n * fromJson config for the dropdown field.\n */\nexport interface FieldDropdownFromJsonConfig extends FieldConfig {\n  options?: MenuOption[];\n}\n\n/**\n * The y offset from the top of the field to the top of the image, if an image\n * is selected.\n */\nconst IMAGE_Y_OFFSET = 5;\n\n/** The total vertical padding above and below an image. */\nconst IMAGE_Y_PADDING: number = IMAGE_Y_OFFSET * 2;\n\n/**\n * NOTE: Because Sentinel is an empty class, proving a value is Sentinel does\n * not resolve in TS that it isn't a MenuGenerator.\n */\nfunction isMenuGenerator(menuGenerator: MenuGenerator|\n                         Sentinel): menuGenerator is MenuGenerator {\n  return menuGenerator !== Field.SKIP_SETUP;\n}\n\n/**\n * Factor out common words in statically defined options.\n * Create prefix and/or suffix labels.\n */\nfunction trimOptions(options: MenuOption[]):\n    {options: MenuOption[]; prefix?: string; suffix?: string;} {\n  let hasImages = false;\n  const trimmedOptions = options.map(([label, value]): MenuOption => {\n    if (typeof label === 'string') {\n      return [parsing.replaceMessageReferences(label), value];\n    }\n\n    hasImages = true;\n    // Copy the image properties so they're not influenced by the original.\n    // NOTE: No need to deep copy since image properties are only 1 level deep.\n    const imageLabel = label.alt !== null ?\n        {...label, alt: parsing.replaceMessageReferences(label.alt)} :\n        {...label};\n    return [imageLabel, value];\n  });\n\n  if (hasImages || options.length < 2) return {options: trimmedOptions};\n\n  const stringOptions = trimmedOptions as [string, string][];\n  const stringLabels = stringOptions.map(([label]) => label);\n\n  const shortest = utilsString.shortestStringLength(stringLabels);\n  const prefixLength = utilsString.commonWordPrefix(stringLabels, shortest);\n  const suffixLength = utilsString.commonWordSuffix(stringLabels, shortest);\n\n  if ((!prefixLength && !suffixLength) ||\n      (shortest <= prefixLength + suffixLength)) {\n    // One or more strings will entirely vanish if we proceed.  Abort.\n    return {options: stringOptions};\n  }\n\n  const prefix =\n      prefixLength ? stringLabels[0].substring(0, prefixLength - 1) : undefined;\n  const suffix =\n      suffixLength ? stringLabels[0].substr(1 - suffixLength) : undefined;\n  return {\n    options: applyTrim(stringOptions, prefixLength, suffixLength),\n    prefix,\n    suffix,\n  };\n}\n\n/**\n * Use the calculated prefix and suffix lengths to trim all of the options in\n * the given array.\n *\n * @param options Array of option tuples:\n *     (human-readable text or image, language-neutral name).\n * @param prefixLength The length of the common prefix.\n * @param suffixLength The length of the common suffix\n * @returns A new array with all of the option text trimmed.\n */\nfunction applyTrim(\n    options: [string, string][], prefixLength: number,\n    suffixLength: number): MenuOption[] {\n  return options.map(\n      ([text, value]) =>\n          [text.substring(prefixLength, text.length - suffixLength),\n           value,\n  ]);\n}\n\n/**\n * Validates the data structure to be processed as an options list.\n *\n * @param options The proposed dropdown options.\n * @throws {TypeError} If proposed options are incorrectly structured.\n */\nfunction validateOptions(options: MenuOption[]) {\n  if (!Array.isArray(options)) {\n    throw TypeError('FieldDropdown options must be an array.');\n  }\n  if (!options.length) {\n    throw TypeError('FieldDropdown options must not be an empty array.');\n  }\n  let foundError = false;\n  for (let i = 0; i < options.length; i++) {\n    const tuple = options[i];\n    if (!Array.isArray(tuple)) {\n      foundError = true;\n      console.error(\n          'Invalid option[' + i + ']: Each FieldDropdown option must be an ' +\n              'array. Found: ',\n          tuple);\n    } else if (typeof tuple[1] !== 'string') {\n      foundError = true;\n      console.error(\n          'Invalid option[' + i + ']: Each FieldDropdown option id must be ' +\n              'a string. Found ' + tuple[1] + ' in: ',\n          tuple);\n    } else if (\n        tuple[0] && typeof tuple[0] !== 'string' &&\n        typeof tuple[0].src !== 'string') {\n      foundError = true;\n      console.error(\n          'Invalid option[' + i + ']: Each FieldDropdown option must have a ' +\n              'string label or image description. Found' + tuple[0] + ' in: ',\n          tuple);\n    }\n  }\n  if (foundError) {\n    throw TypeError('Found invalid FieldDropdown options.');\n  }\n}\n\nfieldRegistry.register('field_dropdown', FieldDropdown);\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Utility methods for objects.\n *\n * @namespace Blockly.utils.object\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.utils.object');\n\nimport * as deprecation from './deprecation.js';\n\n\n/**\n * Inherit the prototype methods from one constructor into another.\n *\n * @param childCtor Child class.\n * @param parentCtor Parent class.\n * @suppress {strictMissingProperties} superClass_ is not defined on Function.\n * @deprecated No longer provided by Blockly.\n * @alias Blockly.utils.object.inherits\n */\nexport function inherits(childCtor: Function, parentCtor: Function) {\n  deprecation.warn('Blockly.utils.object.inherits', 'version 9', 'version 10');\n  // Set a .superClass_ property so that methods can call parent methods\n  // without hard-coding the parent class name.\n  // Could be replaced by ES6's super().\n  // AnyDuringMigration because:  Property 'superClass_' does not exist on type\n  // 'Function'.\n  (childCtor as AnyDuringMigration).superClass_ = parentCtor.prototype;\n\n  // Link the child class to the parent class so that static methods inherit.\n  Object.setPrototypeOf(childCtor, parentCtor);\n\n  // Replace the child constructor's prototype object with an instance\n  // of the parent class.\n  childCtor.prototype = Object.create(parentCtor.prototype);\n  childCtor.prototype.constructor = childCtor;\n}\n// Alternatively, one could use this instead:\n// Object.setPrototypeOf(childCtor.prototype, parentCtor.prototype);\n\n/**\n * Copies all the members of a source object to a target object.\n *\n * @param target Target.\n * @param source Source.\n * @deprecated Use the built-in **Object.assign** instead.\n * @alias Blockly.utils.object.mixin\n */\nexport function mixin(target: AnyDuringMigration, source: AnyDuringMigration) {\n  deprecation.warn(\n      'Blockly.utils.object.mixin', 'May 2022', 'May 2023', 'Object.assign');\n  for (const x in source) {\n    target[x] = source[x];\n  }\n}\n\n/**\n * Complete a deep merge of all members of a source object with a target object.\n *\n * @param target Target.\n * @param source Source.\n * @returns The resulting object.\n * @alias Blockly.utils.object.deepMerge\n */\nexport function deepMerge(\n    target: AnyDuringMigration,\n    source: AnyDuringMigration): AnyDuringMigration {\n  for (const x in source) {\n    if (source[x] !== null && typeof source[x] === 'object') {\n      target[x] = deepMerge(target[x] || Object.create(null), source[x]);\n    } else {\n      target[x] = source[x];\n    }\n  }\n  return target;\n}\n\n/**\n * Returns an array of a given object's own enumerable property values.\n *\n * @param obj Object containing values.\n * @returns Array of values.\n * @deprecated Use the built-in **Object.values** instead.\n * @alias Blockly.utils.object.values\n */\nexport function values(obj: AnyDuringMigration): AnyDuringMigration[] {\n  deprecation.warn(\n      'Blockly.utils.object.values', 'version 9', 'version 10',\n      'Object.values');\n  return Object.values(obj);\n}\n","/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Utility functions for the toolbox and flyout.\n *\n * @namespace Blockly.utils.toolbox\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.utils.toolbox');\n\nimport type {ConnectionState} from '../serialization/blocks.js';\nimport type {CssConfig as CategoryCssConfig} from '../toolbox/category.js';\nimport type {CssConfig as SeparatorCssConfig} from '../toolbox/separator.js';\nimport * as Xml from '../xml.js';\n\n\n/**\n * The information needed to create a block in the toolbox.\n * Note that disabled has a different type for backwards compatibility.\n *\n * @alias Blockly.utils.toolbox.BlockInfo\n */\nexport interface BlockInfo {\n  kind: string;\n  blockxml?: string|Node;\n  type?: string;\n  gap?: string|number;\n  disabled?: string|boolean;\n  enabled?: boolean;\n  id?: string;\n  x?: number;\n  y?: number;\n  collapsed?: boolean;\n  inline?: boolean;\n  data?: string;\n  extraState?: AnyDuringMigration;\n  icons?: {[key: string]: AnyDuringMigration};\n  fields?: {[key: string]: AnyDuringMigration};\n  inputs?: {[key: string]: ConnectionState};\n  next?: ConnectionState;\n}\n\n/**\n * The information needed to create a separator in the toolbox.\n *\n * @alias Blockly.utils.toolbox.SeparatorInfo\n */\nexport interface SeparatorInfo {\n  kind: string;\n  id: string|undefined;\n  gap: number|undefined;\n  cssconfig: SeparatorCssConfig|undefined;\n}\n\n/**\n * The information needed to create a button in the toolbox.\n *\n * @alias Blockly.utils.toolbox.ButtonInfo\n */\nexport interface ButtonInfo {\n  kind: string;\n  text: string;\n  callbackkey: string;\n}\n\n/**\n * The information needed to create a label in the toolbox.\n *\n * @alias Blockly.utils.toolbox.LabelInfo\n */\nexport interface LabelInfo {\n  kind: string;\n  text: string;\n  id: string|undefined;\n}\n\n/**\n * The information needed to create either a button or a label in the flyout.\n *\n * @alias Blockly.utils.toolbox.ButtonOrLabelInfo\n */\nexport type ButtonOrLabelInfo = ButtonInfo|LabelInfo;\n\n/**\n * The information needed to create a category in the toolbox.\n *\n * @alias Blockly.utils.toolbox.StaticCategoryInfo\n */\nexport interface StaticCategoryInfo {\n  kind: string;\n  name: string;\n  contents: ToolboxItemInfo[];\n  id: string|undefined;\n  categorystyle: string|undefined;\n  colour: string|undefined;\n  cssconfig: CategoryCssConfig|undefined;\n  hidden: string|undefined;\n}\n\n/**\n * The information needed to create a custom category.\n *\n * @alias Blockly.utils.toolbox.DynamicCategoryInfo\n */\nexport interface DynamicCategoryInfo {\n  kind: string;\n  custom: string;\n  id: string|undefined;\n  categorystyle: string|undefined;\n  colour: string|undefined;\n  cssconfig: CategoryCssConfig|undefined;\n  hidden: string|undefined;\n}\n\n/**\n * The information needed to create either a dynamic or static category.\n *\n * @alias Blockly.utils.toolbox.CategoryInfo\n */\nexport type CategoryInfo = StaticCategoryInfo|DynamicCategoryInfo;\n\n/**\n * Any information that can be used to create an item in the toolbox.\n *\n * @alias Blockly.utils.toolbox.ToolboxItemInfo\n */\nexport type ToolboxItemInfo = FlyoutItemInfo|StaticCategoryInfo;\n\n/**\n * All the different types that can be displayed in a flyout.\n *\n * @alias Blockly.utils.toolbox.FlyoutItemInfo\n */\nexport type FlyoutItemInfo =\n    BlockInfo|SeparatorInfo|ButtonInfo|LabelInfo|DynamicCategoryInfo;\n\n/**\n * The JSON definition of a toolbox.\n *\n * @alias Blockly.utils.toolbox.ToolboxInfo\n */\nexport interface ToolboxInfo {\n  kind?: string;\n  contents: ToolboxItemInfo[];\n}\n\n/**\n * An array holding flyout items.\n *\n * @alias Blockly.utils.toolbox.FlyoutItemInfoArray\n */\nexport type FlyoutItemInfoArray = FlyoutItemInfo[];\n\n/**\n * All of the different types that can create a toolbox.\n *\n * @alias Blockly.utils.toolbox.ToolboxDefinition\n */\nexport type ToolboxDefinition = Node|ToolboxInfo|string;\n\n/**\n * All of the different types that can be used to show items in a flyout.\n *\n * @alias Blockly.utils.toolbox.FlyoutDefinition\n */\nexport type FlyoutDefinition = FlyoutItemInfoArray|NodeList|ToolboxInfo|Node[];\n\n/**\n * The name used to identify a toolbox that has category like items.\n * This only needs to be used if a toolbox wants to be treated like a category\n * toolbox but does not actually contain any toolbox items with the kind\n * 'category'.\n */\nconst CATEGORY_TOOLBOX_KIND = 'categoryToolbox';\n\n/**\n * The name used to identify a toolbox that has no categories and is displayed\n * as a simple flyout displaying blocks, buttons, or labels.\n */\nconst FLYOUT_TOOLBOX_KIND = 'flyoutToolbox';\n\n/**\n * Position of the toolbox and/or flyout relative to the workspace.\n *\n * @alias Blockly.utils.toolbox.Position\n */\nexport enum Position {\n  TOP,\n  BOTTOM,\n  LEFT,\n  RIGHT\n}\n\n/**\n * Converts the toolbox definition into toolbox JSON.\n *\n * @param toolboxDef The definition of the toolbox in one of its many forms.\n * @returns Object holding information for creating a toolbox.\n * @alias Blockly.utils.toolbox.convertToolboxDefToJson\n * @internal\n */\nexport function convertToolboxDefToJson(toolboxDef: ToolboxDefinition|\n                                        null): ToolboxInfo|null {\n  if (!toolboxDef) {\n    return null;\n  }\n\n  if (toolboxDef instanceof Element || typeof toolboxDef === 'string') {\n    toolboxDef = parseToolboxTree(toolboxDef);\n    // AnyDuringMigration because:  Argument of type 'Node | null' is not\n    // assignable to parameter of type 'Node'.\n    toolboxDef = convertToToolboxJson(toolboxDef as AnyDuringMigration);\n  }\n\n  const toolboxJson = toolboxDef as ToolboxInfo;\n  validateToolbox(toolboxJson);\n  return toolboxJson;\n}\n\n/**\n * Validates the toolbox JSON fields have been set correctly.\n *\n * @param toolboxJson Object holding information for creating a toolbox.\n * @throws {Error} if the toolbox is not the correct format.\n */\nfunction validateToolbox(toolboxJson: ToolboxInfo) {\n  const toolboxKind = toolboxJson['kind'];\n  const toolboxContents = toolboxJson['contents'];\n\n  if (toolboxKind) {\n    if (toolboxKind !== FLYOUT_TOOLBOX_KIND &&\n        toolboxKind !== CATEGORY_TOOLBOX_KIND) {\n      throw Error(\n          'Invalid toolbox kind ' + toolboxKind + '.' +\n          ' Please supply either ' + FLYOUT_TOOLBOX_KIND + ' or ' +\n          CATEGORY_TOOLBOX_KIND);\n    }\n  }\n  if (!toolboxContents) {\n    throw Error('Toolbox must have a contents attribute.');\n  }\n}\n\n/**\n * Converts the flyout definition into a list of flyout items.\n *\n * @param flyoutDef The definition of the flyout in one of its many forms.\n * @returns A list of flyout items.\n * @alias Blockly.utils.toolbox.convertFlyoutDefToJsonArray\n * @internal\n */\nexport function convertFlyoutDefToJsonArray(flyoutDef: FlyoutDefinition|\n                                            null): FlyoutItemInfoArray {\n  if (!flyoutDef) {\n    return [];\n  }\n\n  if ((flyoutDef as AnyDuringMigration)['contents']) {\n    return (flyoutDef as AnyDuringMigration)['contents'];\n  }\n  // If it is already in the correct format return the flyoutDef.\n  // AnyDuringMigration because:  Property 'nodeType' does not exist on type\n  // 'Node | FlyoutItemInfo'.\n  if (Array.isArray(flyoutDef) && flyoutDef.length > 0 &&\n      !((flyoutDef[0]) as AnyDuringMigration).nodeType) {\n    // AnyDuringMigration because:  Type 'FlyoutItemInfoArray | Node[]' is not\n    // assignable to type 'FlyoutItemInfoArray'.\n    return flyoutDef as AnyDuringMigration;\n  }\n\n  // AnyDuringMigration because:  Type 'ToolboxItemInfo[] | FlyoutItemInfoArray'\n  // is not assignable to type 'FlyoutItemInfoArray'.\n  return xmlToJsonArray(flyoutDef as Node[] | NodeList) as AnyDuringMigration;\n}\n\n/**\n * Whether or not the toolbox definition has categories.\n *\n * @param toolboxJson Object holding information for creating a toolbox.\n * @returns True if the toolbox has categories.\n * @alias Blockly.utils.toolbox.hasCategories\n * @internal\n */\nexport function hasCategories(toolboxJson: ToolboxInfo|null): boolean {\n  return TEST_ONLY.hasCategoriesInternal(toolboxJson);\n}\n\n/**\n * Private version of hasCategories for stubbing in tests.\n */\nfunction hasCategoriesInternal(toolboxJson: ToolboxInfo|null): boolean {\n  if (!toolboxJson) {\n    return false;\n  }\n\n  const toolboxKind = toolboxJson['kind'];\n  if (toolboxKind) {\n    return toolboxKind === CATEGORY_TOOLBOX_KIND;\n  }\n\n  const categories = toolboxJson['contents'].filter(function(item) {\n    return item['kind'].toUpperCase() === 'CATEGORY';\n  });\n  return !!categories.length;\n}\n\n/**\n * Whether or not the category is collapsible.\n *\n * @param categoryInfo Object holing information for creating a category.\n * @returns True if the category has subcategories.\n * @alias Blockly.utils.toolbox.isCategoryCollapsible\n * @internal\n */\nexport function isCategoryCollapsible(categoryInfo: CategoryInfo): boolean {\n  if (!categoryInfo || !(categoryInfo as AnyDuringMigration)['contents']) {\n    return false;\n  }\n\n  const categories =\n      (categoryInfo as AnyDuringMigration)['contents'].filter(function(\n          item: AnyDuringMigration) {\n        return item['kind'].toUpperCase() === 'CATEGORY';\n      });\n  return !!categories.length;\n}\n\n/**\n * Parses the provided toolbox definition into a consistent format.\n *\n * @param toolboxDef The definition of the toolbox in one of its many forms.\n * @returns Object holding information for creating a toolbox.\n */\nfunction convertToToolboxJson(toolboxDef: Node): ToolboxInfo {\n  const contents = xmlToJsonArray(toolboxDef as Node | Node[]);\n  const toolboxJson = {'contents': contents};\n  if (toolboxDef instanceof Node) {\n    addAttributes(toolboxDef, toolboxJson);\n  }\n  return toolboxJson;\n}\n\n/**\n * Converts the xml for a toolbox to JSON.\n *\n * @param toolboxDef The definition of the toolbox in one of its many forms.\n * @returns A list of objects in the toolbox.\n */\nfunction xmlToJsonArray(toolboxDef: Node|Node[]|NodeList): FlyoutItemInfoArray|\n    ToolboxItemInfo[] {\n  const arr = [];\n  // If it is a node it will have children.\n  // AnyDuringMigration because:  Property 'childNodes' does not exist on type\n  // 'Node | NodeList | Node[]'.\n  let childNodes = (toolboxDef as AnyDuringMigration).childNodes;\n  if (!childNodes) {\n    // Otherwise the toolboxDef is an array or collection.\n    childNodes = toolboxDef;\n  }\n  for (let i = 0, child; child = childNodes[i]; i++) {\n    if (!child.tagName) {\n      continue;\n    }\n    const obj = {};\n    const tagName = child.tagName.toUpperCase();\n    (obj as AnyDuringMigration)['kind'] = tagName;\n\n    // Store the XML for a block.\n    if (tagName === 'BLOCK') {\n      (obj as AnyDuringMigration)['blockxml'] = child;\n    } else if (child.childNodes && child.childNodes.length > 0) {\n      // Get the contents of a category\n      (obj as AnyDuringMigration)['contents'] = xmlToJsonArray(child);\n    }\n\n    // Add XML attributes to object\n    addAttributes(child, obj);\n    arr.push(obj);\n  }\n  // AnyDuringMigration because:  Type '{}[]' is not assignable to type\n  // 'ToolboxItemInfo[] | FlyoutItemInfoArray'.\n  return arr as AnyDuringMigration;\n}\n\n/**\n * Adds the attributes on the node to the given object.\n *\n * @param node The node to copy the attributes from.\n * @param obj The object to copy the attributes to.\n */\nfunction addAttributes(node: Node, obj: AnyDuringMigration) {\n  // AnyDuringMigration because:  Property 'attributes' does not exist on type\n  // 'Node'.\n  for (let j = 0; j < (node as AnyDuringMigration).attributes.length; j++) {\n    // AnyDuringMigration because:  Property 'attributes' does not exist on type\n    // 'Node'.\n    const attr = (node as AnyDuringMigration).attributes[j];\n    if (attr.nodeName.indexOf('css-') > -1) {\n      obj['cssconfig'] = obj['cssconfig'] || {};\n      obj['cssconfig'][attr.nodeName.replace('css-', '')] = attr.value;\n    } else {\n      obj[attr.nodeName] = attr.value;\n    }\n  }\n}\n\n/**\n * Parse the provided toolbox tree into a consistent DOM format.\n *\n * @param toolboxDef DOM tree of blocks, or text representation of same.\n * @returns DOM tree of blocks, or null.\n * @alias Blockly.utils.toolbox.parseToolboxTree\n */\nexport function parseToolboxTree(toolboxDef: Element|null|string): Element|\n    null {\n  let parsedToolboxDef: Element|null = null;\n  if (toolboxDef) {\n    if (typeof toolboxDef === 'string') {\n      parsedToolboxDef = Xml.textToDom(toolboxDef);\n      if (parsedToolboxDef.nodeName.toLowerCase() !== 'xml') {\n        throw TypeError('Toolbox should be an <xml> document.');\n      }\n    } else if (toolboxDef instanceof Element) {\n      parsedToolboxDef = toolboxDef;\n    }\n  }\n  return parsedToolboxDef;\n}\n\nexport const TEST_ONLY = {\n  hasCategoriesInternal,\n};\n","/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Extensions are functions that help initialize blocks, usually\n *      adding dynamic behavior such as onchange handlers and mutators. These\n *      are applied using Block.applyExtension(), or the JSON \"extensions\"\n *      array attribute.\n *\n * @namespace Blockly.Extensions\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Extensions');\n\nimport type {Block} from './block.js';\nimport type {BlockSvg} from './block_svg.js';\nimport {FieldDropdown} from './field_dropdown.js';\nimport {Mutator} from './mutator.js';\nimport * as parsing from './utils/parsing.js';\n\n\n/** The set of all registered extensions, keyed by extension name/id. */\nconst allExtensions = Object.create(null);\nexport const TEST_ONLY = {allExtensions};\n\n/**\n * Registers a new extension function. Extensions are functions that help\n * initialize blocks, usually adding dynamic behavior such as onchange\n * handlers and mutators. These are applied using Block.applyExtension(), or\n * the JSON \"extensions\" array attribute.\n *\n * @param name The name of this extension.\n * @param initFn The function to initialize an extended block.\n * @throws {Error} if the extension name is empty, the extension is already\n *     registered, or extensionFn is not a function.\n * @alias Blockly.Extensions.register\n */\nexport function register(name: string, initFn: Function) {\n  if (typeof name !== 'string' || name.trim() === '') {\n    throw Error('Error: Invalid extension name \"' + name + '\"');\n  }\n  if (allExtensions[name]) {\n    throw Error('Error: Extension \"' + name + '\" is already registered.');\n  }\n  if (typeof initFn !== 'function') {\n    throw Error('Error: Extension \"' + name + '\" must be a function');\n  }\n  allExtensions[name] = initFn;\n}\n\n/**\n * Registers a new extension function that adds all key/value of mixinObj.\n *\n * @param name The name of this extension.\n * @param mixinObj The values to mix in.\n * @throws {Error} if the extension name is empty or the extension is already\n *     registered.\n * @alias Blockly.Extensions.registerMixin\n */\nexport function registerMixin(name: string, mixinObj: AnyDuringMigration) {\n  if (!mixinObj || typeof mixinObj !== 'object') {\n    throw Error('Error: Mixin \"' + name + '\" must be a object');\n  }\n  register(name, function(this: Block) {\n    this.mixin(mixinObj);\n  });\n}\n\n/**\n * Registers a new extension function that adds a mutator to the block.\n * At register time this performs some basic sanity checks on the mutator.\n * The wrapper may also add a mutator dialog to the block, if both compose and\n * decompose are defined on the mixin.\n *\n * @param name The name of this mutator extension.\n * @param mixinObj The values to mix in.\n * @param opt_helperFn An optional function to apply after mixing in the object.\n * @param opt_blockList A list of blocks to appear in the flyout of the mutator\n *     dialog.\n * @throws {Error} if the mutation is invalid or can't be applied to the block.\n * @alias Blockly.Extensions.registerMutator\n */\nexport function registerMutator(\n    name: string, mixinObj: AnyDuringMigration,\n    opt_helperFn?: () => AnyDuringMigration, opt_blockList?: string[]) {\n  const errorPrefix = 'Error when registering mutator \"' + name + '\": ';\n\n  checkHasMutatorProperties(errorPrefix, mixinObj);\n  const hasMutatorDialog = checkMutatorDialog(mixinObj, errorPrefix);\n\n  if (opt_helperFn && typeof opt_helperFn !== 'function') {\n    throw Error(errorPrefix + 'Extension \"' + name + '\" is not a function');\n  }\n\n  // Sanity checks passed.\n  register(name, function(this: Block) {\n    if (hasMutatorDialog) {\n      this.setMutator(new Mutator(opt_blockList || [], this as BlockSvg));\n    }\n    // Mixin the object.\n    this.mixin(mixinObj);\n\n    if (opt_helperFn) {\n      opt_helperFn.apply(this);\n    }\n  });\n}\n\n/**\n * Unregisters the extension registered with the given name.\n *\n * @param name The name of the extension to unregister.\n * @alias Blockly.Extensions.unregister\n */\nexport function unregister(name: string) {\n  if (isRegistered(name)) {\n    delete allExtensions[name];\n  } else {\n    console.warn(\n        'No extension mapping for name \"' + name + '\" found to unregister');\n  }\n}\n\n/**\n * Returns whether an extension is registered with the given name.\n *\n * @param name The name of the extension to check for.\n * @returns True if the extension is registered.  False if it is not registered.\n * @alias Blockly.Extensions.isRegistered\n */\nexport function isRegistered(name: string): boolean {\n  return !!allExtensions[name];\n}\n\n/**\n * Applies an extension method to a block. This should only be called during\n * block construction.\n *\n * @param name The name of the extension.\n * @param block The block to apply the named extension to.\n * @param isMutator True if this extension defines a mutator.\n * @throws {Error} if the extension is not found.\n * @alias Blockly.Extensions.apply\n */\nexport function apply(name: string, block: Block, isMutator: boolean) {\n  const extensionFn = allExtensions[name];\n  if (typeof extensionFn !== 'function') {\n    throw Error('Error: Extension \"' + name + '\" not found.');\n  }\n  let mutatorProperties;\n  if (isMutator) {\n    // Fail early if the block already has mutation properties.\n    checkNoMutatorProperties(name, block);\n  } else {\n    // Record the old properties so we can make sure they don't change after\n    // applying the extension.\n    mutatorProperties = getMutatorProperties(block);\n  }\n  extensionFn.apply(block);\n\n  if (isMutator) {\n    const errorPrefix = 'Error after applying mutator \"' + name + '\": ';\n    checkHasMutatorProperties(errorPrefix, block);\n  } else {\n    if (!mutatorPropertiesMatch(\n            mutatorProperties as AnyDuringMigration[], block)) {\n      throw Error(\n          'Error when applying extension \"' + name + '\": ' +\n          'mutation properties changed when applying a non-mutator extension.');\n    }\n  }\n}\n\n/**\n * Check that the given block does not have any of the four mutator properties\n * defined on it.  This function should be called before applying a mutator\n * extension to a block, to make sure we are not overwriting properties.\n *\n * @param mutationName The name of the mutation to reference in error messages.\n * @param block The block to check.\n * @throws {Error} if any of the properties already exist on the block.\n */\nfunction checkNoMutatorProperties(mutationName: string, block: Block) {\n  const properties = getMutatorProperties(block);\n  if (properties.length) {\n    throw Error(\n        'Error: tried to apply mutation \"' + mutationName +\n        '\" to a block that already has mutator functions.' +\n        '  Block id: ' + block.id);\n  }\n}\n\n/**\n * Checks if the given object has both the 'mutationToDom' and 'domToMutation'\n * functions.\n *\n * @param object The object to check.\n * @param errorPrefix The string to prepend to any error message.\n * @returns True if the object has both functions.  False if it has neither\n *     function.\n * @throws {Error} if the object has only one of the functions, or either is not\n *     actually a function.\n */\nfunction checkXmlHooks(\n    object: AnyDuringMigration, errorPrefix: string): boolean {\n  return checkHasFunctionPair(\n      object.mutationToDom, object.domToMutation,\n      errorPrefix + ' mutationToDom/domToMutation');\n}\n/**\n * Checks if the given object has both the 'saveExtraState' and 'loadExtraState'\n * functions.\n *\n * @param object The object to check.\n * @param errorPrefix The string to prepend to any error message.\n * @returns True if the object has both functions.  False if it has neither\n *     function.\n * @throws {Error} if the object has only one of the functions, or either is not\n *     actually a function.\n */\nfunction checkJsonHooks(\n    object: AnyDuringMigration, errorPrefix: string): boolean {\n  return checkHasFunctionPair(\n      object.saveExtraState, object.loadExtraState,\n      errorPrefix + ' saveExtraState/loadExtraState');\n}\n\n/**\n * Checks if the given object has both the 'compose' and 'decompose' functions.\n *\n * @param object The object to check.\n * @param errorPrefix The string to prepend to any error message.\n * @returns True if the object has both functions.  False if it has neither\n *     function.\n * @throws {Error} if the object has only one of the functions, or either is not\n *     actually a function.\n */\nfunction checkMutatorDialog(\n    object: AnyDuringMigration, errorPrefix: string): boolean {\n  return checkHasFunctionPair(\n      object.compose, object.decompose, errorPrefix + ' compose/decompose');\n}\n\n/**\n * Checks that both or neither of the given functions exist and that they are\n * indeed functions.\n *\n * @param func1 The first function in the pair.\n * @param func2 The second function in the pair.\n * @param errorPrefix The string to prepend to any error message.\n * @returns True if the object has both functions.  False if it has neither\n *     function.\n * @throws {Error} If the object has only one of the functions, or either is not\n *     actually a function.\n */\nfunction checkHasFunctionPair(\n    func1: AnyDuringMigration, func2: AnyDuringMigration,\n    errorPrefix: string): boolean {\n  if (func1 && func2) {\n    if (typeof func1 !== 'function' || typeof func2 !== 'function') {\n      throw Error(errorPrefix + ' must be a function');\n    }\n    return true;\n  } else if (!func1 && !func2) {\n    return false;\n  }\n  throw Error(errorPrefix + 'Must have both or neither functions');\n}\n\n/**\n * Checks that the given object required mutator properties.\n *\n * @param errorPrefix The string to prepend to any error message.\n * @param object The object to inspect.\n */\nfunction checkHasMutatorProperties(\n    errorPrefix: string, object: AnyDuringMigration) {\n  const hasXmlHooks = checkXmlHooks(object, errorPrefix);\n  const hasJsonHooks = checkJsonHooks(object, errorPrefix);\n  if (!hasXmlHooks && !hasJsonHooks) {\n    throw Error(\n        errorPrefix +\n        'Mutations must contain either XML hooks, or JSON hooks, or both');\n  }\n  // A block with a mutator isn't required to have a mutation dialog, but\n  // it should still have both or neither of compose and decompose.\n  checkMutatorDialog(object, errorPrefix);\n}\n\n/**\n * Get a list of values of mutator properties on the given block.\n *\n * @param block The block to inspect.\n * @returns A list with all of the defined properties, which should be\n *     functions, but may be anything other than undefined.\n */\nfunction getMutatorProperties(block: Block): AnyDuringMigration[] {\n  const result = [];\n  // List each function explicitly by reference to allow for renaming\n  // during compilation.\n  if (block.domToMutation !== undefined) {\n    result.push(block.domToMutation);\n  }\n  if (block.mutationToDom !== undefined) {\n    result.push(block.mutationToDom);\n  }\n  if (block.saveExtraState !== undefined) {\n    result.push(block.saveExtraState);\n  }\n  if (block.loadExtraState !== undefined) {\n    result.push(block.loadExtraState);\n  }\n  if (block.compose !== undefined) {\n    result.push(block.compose);\n  }\n  if (block.decompose !== undefined) {\n    result.push(block.decompose);\n  }\n  return result;\n}\n\n/**\n * Check that the current mutator properties match a list of old mutator\n * properties.  This should be called after applying a non-mutator extension,\n * to verify that the extension didn't change properties it shouldn't.\n *\n * @param oldProperties The old values to compare to.\n * @param block The block to inspect for new values.\n * @returns True if the property lists match.\n */\nfunction mutatorPropertiesMatch(\n    oldProperties: AnyDuringMigration[], block: Block): boolean {\n  const newProperties = getMutatorProperties(block);\n  if (newProperties.length !== oldProperties.length) {\n    return false;\n  }\n  for (let i = 0; i < newProperties.length; i++) {\n    if (oldProperties[i] !== newProperties[i]) {\n      return false;\n    }\n  }\n  return true;\n}\n\n/**\n * Calls a function after the page has loaded, possibly immediately.\n *\n * @param fn Function to run.\n * @throws Error Will throw if no global document can be found (e.g., Node.js).\n * @internal\n */\nexport function runAfterPageLoad(fn: () => void) {\n  if (typeof document !== 'object') {\n    throw Error('runAfterPageLoad() requires browser document.');\n  }\n  if (document.readyState === 'complete') {\n    fn();  // Page has already loaded. Call immediately.\n  } else {\n    // Poll readyState.\n    const readyStateCheckInterval = setInterval(function() {\n      if (document.readyState === 'complete') {\n        clearInterval(readyStateCheckInterval);\n        fn();\n      }\n    }, 10);\n  }\n}\n\n/**\n * Builds an extension function that will map a dropdown value to a tooltip\n * string.\n *\n * This method includes multiple checks to ensure tooltips, dropdown options,\n * and message references are aligned. This aims to catch errors as early as\n * possible, without requiring developers to manually test tooltips under each\n * option. After the page is loaded, each tooltip text string will be checked\n * for matching message keys in the internationalized string table. Deferring\n * this until the page is loaded decouples loading dependencies. Later, upon\n * loading the first block of any given type, the extension will validate every\n * dropdown option has a matching tooltip in the lookupTable.  Errors are\n * reported as warnings in the console, and are never fatal.\n *\n * @param dropdownName The name of the field whose value is the key to the\n *     lookup table.\n * @param lookupTable The table of field values to tooltip text.\n * @returns The extension function.\n * @alias Blockly.Extensions.buildTooltipForDropdown\n */\nexport function buildTooltipForDropdown(\n    dropdownName: string, lookupTable: {[key: string]: string}): Function {\n  // List of block types already validated, to minimize duplicate warnings.\n  const blockTypesChecked: AnyDuringMigration[] = [];\n\n  // Check the tooltip string messages for invalid references.\n  // Wait for load, in case Blockly.Msg is not yet populated.\n  // runAfterPageLoad() does not run in a Node.js environment due to lack\n  // of document object, in which case skip the validation.\n  if (typeof document === 'object') {  // Relies on document.readyState\n    runAfterPageLoad(function() {\n      for (const key in lookupTable) {\n        // Will print warnings if reference is missing.\n        parsing.checkMessageReferences(lookupTable[key]);\n      }\n    });\n  }\n\n  /** The actual extension. */\n  function extensionFn(this: Block) {\n    if (this.type && blockTypesChecked.indexOf(this.type) === -1) {\n      checkDropdownOptionsInTable(this, dropdownName, lookupTable);\n      blockTypesChecked.push(this.type);\n    }\n\n    this.setTooltip(function(this: Block) {\n      const value = String(this.getFieldValue(dropdownName));\n      let tooltip = lookupTable[value];\n      if (tooltip === null) {\n        if (blockTypesChecked.indexOf(this.type) === -1) {\n          // Warn for missing values on generated tooltips.\n          let warning = 'No tooltip mapping for value ' + value + ' of field ' +\n              dropdownName;\n          if (this.type !== null) {\n            warning += ' of block type ' + this.type;\n          }\n          console.warn(warning + '.');\n        }\n      } else {\n        tooltip = parsing.replaceMessageReferences(tooltip);\n      }\n      return tooltip;\n    }.bind(this));\n  }\n  return extensionFn;\n}\n\n/**\n * Checks all options keys are present in the provided string lookup table.\n * Emits console warnings when they are not.\n *\n * @param block The block containing the dropdown\n * @param dropdownName The name of the dropdown\n * @param lookupTable The string lookup table\n */\nfunction checkDropdownOptionsInTable(\n    block: Block, dropdownName: string, lookupTable: {[key: string]: string}) {\n  // Validate all dropdown options have values.\n  const dropdown = block.getField(dropdownName);\n  if (dropdown instanceof FieldDropdown && !dropdown.isOptionListDynamic()) {\n    const options = dropdown.getOptions();\n    for (let i = 0; i < options.length; i++) {\n      const optionKey = options[i][1];  // label, then value\n      if (lookupTable[optionKey] === null) {\n        console.warn(\n            'No tooltip mapping for value ' + optionKey + ' of field ' +\n            dropdownName + ' of block type ' + block.type);\n      }\n    }\n  }\n}\n\n/**\n * Builds an extension function that will install a dynamic tooltip. The\n * tooltip message should include the string '%1' and that string will be\n * replaced with the text of the named field.\n *\n * @param msgTemplate The template form to of the message text, with %1\n *     placeholder.\n * @param fieldName The field with the replacement text.\n * @returns The extension function.\n * @alias Blockly.Extensions.buildTooltipWithFieldText\n */\nexport function buildTooltipWithFieldText(\n    msgTemplate: string, fieldName: string): Function {\n  // Check the tooltip string messages for invalid references.\n  // Wait for load, in case Blockly.Msg is not yet populated.\n  // runAfterPageLoad() does not run in a Node.js environment due to lack\n  // of document object, in which case skip the validation.\n  if (typeof document === 'object') {  // Relies on document.readyState\n    runAfterPageLoad(function() {\n      // Will print warnings if reference is missing.\n      parsing.checkMessageReferences(msgTemplate);\n    });\n  }\n\n  /** The actual extension. */\n  function extensionFn(this: Block) {\n    this.setTooltip(function(this: Block) {\n      const field = this.getField(fieldName);\n      return parsing.replaceMessageReferences(msgTemplate)\n          .replace('%1', field ? field.getText() : '');\n    }.bind(this));\n  }\n  return extensionFn;\n}\n\n/**\n * Configures the tooltip to mimic the parent block when connected. Otherwise,\n * uses the tooltip text at the time this extension is initialized. This takes\n * advantage of the fact that all other values from JSON are initialized before\n * extensions.\n */\nfunction extensionParentTooltip(this: Block) {\n  const tooltipWhenNotConnected = this.tooltip;\n  this.setTooltip(function(this: Block) {\n    const parent = this.getParent();\n    return parent && parent.getInputsInline() && parent.tooltip ||\n        tooltipWhenNotConnected;\n  }.bind(this));\n}\nregister('parent_tooltip_when_inline', extensionParentTooltip);\n","/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/** @namespace Blockly.utils.array */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.utils.array');\n\n\n/**\n * Removes the first occurrence of a particular value from an array.\n *\n * @param arr Array from which to remove value.\n * @param value Value to remove.\n * @returns True if an element was removed.\n * @alias Blockly.array.removeElem\n * @internal\n */\nexport function removeElem<T>(arr: Array<T>, value: T): boolean {\n  const i = arr.indexOf(value);\n  if (i === -1) {\n    return false;\n  }\n  arr.splice(i, 1);\n  return true;\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Methods for creating parts of SVG path strings.  See\n *\n * @namespace Blockly.utils.svgPaths\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.utils.svgPaths');\n\n\n/**\n * Create a string representing the given x, y pair.  It does not matter whether\n * the coordinate is relative or absolute.  The result has leading\n * and trailing spaces, and separates the x and y coordinates with a comma but\n * no space.\n *\n * @param x The x coordinate.\n * @param y The y coordinate.\n * @returns A string of the format ' x,y '\n * @alias Blockly.utils.svgPaths.point\n */\nexport function point(x: number, y: number): string {\n  return ' ' + x + ',' + y + ' ';\n}\n\n/**\n * Draw a cubic or quadratic curve.  See\n * developer.mozilla.org/en-US/docs/Web/SVG/Attribute/d#Cubic_B%C3%A9zier_Curve\n * These coordinates are unitless and hence in the user coordinate system.\n *\n * @param command The command to use.\n *     Should be one of: c, C, s, S, q, Q.\n * @param points  An array containing all of the points to pass to the curve\n *     command, in order.  The points are represented as strings of the format '\n *     x, y '.\n * @returns A string defining one or more Bezier curves.  See the MDN\n *     documentation for exact format.\n * @alias Blockly.utils.svgPaths.curve\n */\nexport function curve(command: string, points: string[]): string {\n  return ' ' + command + points.join('');\n}\n\n/**\n * Move the cursor to the given position without drawing a line.\n * The coordinates are absolute.\n * These coordinates are unitless and hence in the user coordinate system.\n * See developer.mozilla.org/en-US/docs/Web/SVG/Tutorial/Paths#Line_commands\n *\n * @param x The absolute x coordinate.\n * @param y The absolute y coordinate.\n * @returns A string of the format ' M x,y '\n * @alias Blockly.utils.svgPaths.moveTo\n */\nexport function moveTo(x: number, y: number): string {\n  return ' M ' + x + ',' + y + ' ';\n}\n\n/**\n * Move the cursor to the given position without drawing a line.\n * Coordinates are relative.\n * These coordinates are unitless and hence in the user coordinate system.\n * See developer.mozilla.org/en-US/docs/Web/SVG/Tutorial/Paths#Line_commands\n *\n * @param dx The relative x coordinate.\n * @param dy The relative y coordinate.\n * @returns A string of the format ' m dx,dy '\n * @alias Blockly.utils.svgPaths.moveBy\n */\nexport function moveBy(dx: number, dy: number): string {\n  return ' m ' + dx + ',' + dy + ' ';\n}\n\n/**\n * Draw a line from the current point to the end point, which is the current\n * point shifted by dx along the x-axis and dy along the y-axis.\n * These coordinates are unitless and hence in the user coordinate system.\n * See developer.mozilla.org/en-US/docs/Web/SVG/Tutorial/Paths#Line_commands\n *\n * @param dx The relative x coordinate.\n * @param dy The relative y coordinate.\n * @returns A string of the format ' l dx,dy '\n * @alias Blockly.utils.svgPaths.lineTo\n */\nexport function lineTo(dx: number, dy: number): string {\n  return ' l ' + dx + ',' + dy + ' ';\n}\n\n/**\n * Draw multiple lines connecting all of the given points in order.  This is\n * equivalent to a series of 'l' commands.\n * These coordinates are unitless and hence in the user coordinate system.\n * See developer.mozilla.org/en-US/docs/Web/SVG/Tutorial/Paths#Line_commands\n *\n * @param points An array containing all of the points to draw lines to, in\n *     order.  The points are represented as strings of the format ' dx,dy '.\n * @returns A string of the format ' l (dx,dy)+ '\n * @alias Blockly.utils.svgPaths.line\n */\nexport function line(points: string[]): string {\n  return ' l' + points.join('');\n}\n\n/**\n * Draw a horizontal or vertical line.\n * The first argument specifies the direction and whether the given position is\n * relative or absolute.\n * These coordinates are unitless and hence in the user coordinate system.\n * See developer.mozilla.org/en-US/docs/Web/SVG/Attribute/d#LineTo_path_commands\n *\n * @param command The command to prepend to the coordinate.  This should be one\n *     of: V, v, H, h.\n * @param val The coordinate to pass to the command.  It may be absolute or\n *     relative.\n * @returns A string of the format ' command val '\n * @alias Blockly.utils.svgPaths.lineOnAxis\n */\nexport function lineOnAxis(command: string, val: number): string {\n  return ' ' + command + ' ' + val + ' ';\n}\n\n/**\n * Draw an elliptical arc curve.\n * These coordinates are unitless and hence in the user coordinate system.\n * See developer.mozilla.org/en-US/docs/Web/SVG/Attribute/d#Elliptical_Arc_Curve\n *\n * @param command The command string.  Either 'a' or 'A'.\n * @param flags The flag string.  See the MDN documentation for a description\n *     and examples.\n * @param radius The radius of the arc to draw.\n * @param point The point to move the cursor to after drawing the arc, specified\n *     either in absolute or relative coordinates depending on the command.\n * @returns A string of the format 'command radius radius flags point'\n * @alias Blockly.utils.svgPaths.arc\n */\nexport function arc(\n    command: string, flags: string, radius: number, point: string): string {\n  return command + ' ' + radius + ' ' + radius + ' ' + flags + point;\n}\n","/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Utility methods.\n *\n * @namespace Blockly.utils\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.utils');\n\nimport type {Block} from './block.js';\nimport * as browserEvents from './browser_events.js';\nimport * as common from './common.js';\nimport * as extensions from './extensions.js';\nimport * as aria from './utils/aria.js';\nimport * as arrayUtils from './utils/array.js';\nimport * as colour from './utils/colour.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as deprecation from './utils/deprecation.js';\nimport * as dom from './utils/dom.js';\nimport * as idGenerator from './utils/idgenerator.js';\nimport {KeyCodes} from './utils/keycodes.js';\nimport * as math from './utils/math.js';\nimport type {Metrics} from './utils/metrics.js';\nimport * as object from './utils/object.js';\nimport * as parsing from './utils/parsing.js';\nimport {Rect} from './utils/rect.js';\nimport {Size} from './utils/size.js';\nimport * as stringUtils from './utils/string.js';\nimport * as style from './utils/style.js';\nimport {Svg} from './utils/svg.js';\nimport * as svgMath from './utils/svg_math.js';\nimport * as svgPaths from './utils/svg_paths.js';\nimport * as toolbox from './utils/toolbox.js';\nimport * as userAgent from './utils/useragent.js';\nimport * as xml from './utils/xml.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\nexport {\n  aria,\n  arrayUtils as array,\n  browserEvents,\n  colour,\n  Coordinate,\n  deprecation,\n  dom,\n  extensions,\n  idGenerator,\n  KeyCodes,\n  math,\n  Metrics,\n  object,\n  parsing,\n  Rect,\n  Size,\n  stringUtils as string,\n  style,\n  Svg,\n  svgMath,\n  svgPaths,\n  toolbox,\n  userAgent,\n  xml,\n};\n\n/**\n * Return the coordinates of the top-left corner of this element relative to\n * its parent.  Only for SVG elements and children (e.g. rect, g, path).\n *\n * @param element SVG element to find the coordinates of.\n * @returns Object with .x and .y properties.\n * @deprecated Use **Blockly.utils.svgMath.getRelativeXY** instead.\n * @alias Blockly.utils.getRelativeXY\n */\nexport function getRelativeXY(element: Element): Coordinate {\n  deprecation.warn(\n      'Blockly.utils.getRelativeXY', 'December 2021', 'December 2022',\n      'Blockly.utils.svgMath.getRelativeXY');\n  return svgMath.getRelativeXY(element);\n}\n\n/**\n * Return the coordinates of the top-left corner of this element relative to\n * the div Blockly was injected into.\n *\n * @param element SVG element to find the coordinates of. If this is not a child\n *     of the div Blockly was injected into, the behaviour is undefined.\n * @returns Object with .x and .y properties.\n * @deprecated Use **Blockly.utils.svgMath.getInjectionDivXY** instead.\n * @alias Blockly.utils.getInjectionDivXY_\n */\nfunction getInjectionDivXY(element: Element): Coordinate {\n  deprecation.warn(\n      'Blockly.utils.getInjectionDivXY_', 'December 2021', 'December 2022',\n      'Blockly.utils.svgMath.getInjectionDivXY');\n  return svgMath.getInjectionDivXY(element);\n}\nexport const getInjectionDivXY_ = getInjectionDivXY;\n\n/**\n * Parse a string with any number of interpolation tokens (%1, %2, ...).\n * It will also replace string table references (e.g., %{bky_my_msg} and\n * %{BKY_MY_MSG} will both be replaced with the value in\n * Msg['MY_MSG']). Percentage sign characters '%' may be self-escaped\n * (e.g., '%%').\n *\n * @param message Text which might contain string table references and\n *     interpolation tokens.\n * @returns Array of strings and numbers.\n * @deprecated Use **Blockly.utils.parsing.tokenizeInterpolation** instead.\n * @alias Blockly.utils.tokenizeInterpolation\n */\nexport function tokenizeInterpolation(message: string): Array<string|number> {\n  deprecation.warn(\n      'Blockly.utils.tokenizeInterpolation', 'December 2021', 'December 2022',\n      'Blockly.utils.parsing.tokenizeInterpolation');\n  return parsing.tokenizeInterpolation(message);\n}\n\n/**\n * Replaces string table references in a message, if the message is a string.\n * For example, \"%{bky_my_msg}\" and \"%{BKY_MY_MSG}\" will both be replaced with\n * the value in Msg['MY_MSG'].\n *\n * @param message Message, which may be a string that contains string table\n *     references.\n * @returns String with message references replaced.\n * @deprecated Use **Blockly.utils.parsing.replaceMessageReferences** instead.\n * @alias Blockly.utils.replaceMessageReferences\n */\nexport function replaceMessageReferences(message: string|any): string {\n  deprecation.warn(\n      'Blockly.utils.replaceMessageReferences', 'December 2021',\n      'December 2022', 'Blockly.utils.parsing.replaceMessageReferences');\n  return parsing.replaceMessageReferences(message);\n}\n\n/**\n * Validates that any %{MSG_KEY} references in the message refer to keys of\n * the Msg string table.\n *\n * @param message Text which might contain string table references.\n * @returns True if all message references have matching values.\n *     Otherwise, false.\n * @deprecated Use **Blockly.utils.parsing.checkMessageReferences** instead.\n * @alias Blockly.utils.checkMessageReferences\n */\nexport function checkMessageReferences(message: string): boolean {\n  deprecation.warn(\n      'Blockly.utils.checkMessageReferences', 'December 2021', 'December 2022',\n      'Blockly.utils.parsing.checkMessageReferences');\n  return parsing.checkMessageReferences(message);\n}\n\n/**\n * Check if 3D transforms are supported by adding an element\n * and attempting to set the property.\n *\n * @returns True if 3D transforms are supported.\n * @deprecated Use **Blockly.utils.svgMath.is3dSupported** instead.\n * @alias Blockly.utils.is3dSupported\n */\nexport function is3dSupported(): boolean {\n  deprecation.warn(\n      'Blockly.utils.is3dSupported', 'December 2021', 'December 2022',\n      'Blockly.utils.svgMath.is3dSupported');\n  return svgMath.is3dSupported();\n}\n\n/**\n * Get the position of the current viewport in window coordinates.  This takes\n * scroll into account.\n *\n * @returns An object containing window width, height, and scroll position in\n *     window coordinates.\n * @alias Blockly.utils.getViewportBBox\n * @deprecated Use **Blockly.utils.svgMath.getViewportBBox** instead.\n * @internal\n */\nexport function getViewportBBox(): Rect {\n  deprecation.warn(\n      'Blockly.utils.getViewportBBox', 'December 2021', 'December 2022',\n      'Blockly.utils.svgMath.getViewportBBox');\n  return svgMath.getViewportBBox();\n}\n\n/**\n * Removes the first occurrence of a particular value from an array.\n *\n * @param arr Array from which to remove value.\n * @param value Value to remove.\n * @returns True if an element was removed.\n * @alias Blockly.utils.arrayRemove\n * @deprecated Use **Blockly.array.removeElem** instead.\n * @internal\n */\nexport function arrayRemove<T>(arr: Array<T>, value: T): boolean {\n  deprecation.warn(\n      'Blockly.utils.arrayRemove', 'December 2021', 'December 2022',\n      'Blockly.array.removeElem');\n  return arrayUtils.removeElem(arr, value);\n}\n\n/**\n * Gets the document scroll distance as a coordinate object.\n * Copied from Closure's goog.dom.getDocumentScroll.\n *\n * @returns Object with values 'x' and 'y'.\n * @deprecated Use **Blockly.utils.svgMath.getDocumentScroll** instead.\n * @alias Blockly.utils.getDocumentScroll\n */\nexport function getDocumentScroll(): Coordinate {\n  deprecation.warn(\n      'Blockly.utils.getDocumentScroll', 'December 2021', 'December 2022',\n      'Blockly.utils.svgMath.getDocumentScroll');\n  return svgMath.getDocumentScroll();\n}\n\n/**\n * Get a map of all the block's descendants mapping their type to the number of\n *    children with that type.\n *\n * @param block The block to map.\n * @param opt_stripFollowing Optionally ignore all following statements (blocks\n *     that are not inside a value or statement input of the block).\n * @returns Map of types to type counts for descendants of the bock.\n * @deprecated Use **Blockly.common.getBlockTypeCounts** instead.\n * @alias Blockly.utils.getBlockTypeCounts\n */\nexport function getBlockTypeCounts(\n    block: Block, opt_stripFollowing?: boolean): {[key: string]: number} {\n  deprecation.warn(\n      'Blockly.utils.getBlockTypeCounts', 'December 2021', 'December 2022',\n      'Blockly.common.getBlockTypeCounts');\n  return common.getBlockTypeCounts(block, opt_stripFollowing);\n}\n\n/**\n * Converts screen coordinates to workspace coordinates.\n *\n * @param ws The workspace to find the coordinates on.\n * @param screenCoordinates The screen coordinates to be converted to workspace\n *     coordinates\n * @deprecated Use **Blockly.utils.svgMath.screenToWsCoordinates** instead.\n * @returns The workspace coordinates.\n */\nexport function screenToWsCoordinates(\n    ws: WorkspaceSvg, screenCoordinates: Coordinate): Coordinate {\n  deprecation.warn(\n      'Blockly.utils.screenToWsCoordinates', 'December 2021', 'December 2022',\n      'Blockly.utils.svgMath.screenToWsCoordinates');\n  return svgMath.screenToWsCoordinates(ws, screenCoordinates);\n}\n\n/**\n * Parse a block colour from a number or string, as provided in a block\n * definition.\n *\n * @param colour HSV hue value (0 to 360), #RRGGBB string, or a message\n *     reference string pointing to one of those two values.\n * @returns An object containing the colour as a #RRGGBB string, and the hue if\n *     the input was an HSV hue value.\n * @throws {Error} If the colour cannot be parsed.\n * @deprecated Use **Blockly.utils.parsing.parseBlockColour** instead.\n * @alias Blockly.utils.parseBlockColour\n */\nexport function parseBlockColour(colour: number|\n                                 string): {hue: number|null, hex: string} {\n  deprecation.warn(\n      'Blockly.utils.parseBlockColour', 'December 2021', 'December 2022',\n      'Blockly.utils.parsing.parseBlockColour');\n  return parsing.parseBlockColour(colour);\n}\n\n/**\n * Calls a function after the page has loaded, possibly immediately.\n *\n * @param fn Function to run.\n * @throws Error Will throw if no global document can be found (e.g., Node.js).\n * @deprecated No longer provided by Blockly.\n * @alias Blockly.utils.runAfterPageLoad\n */\nexport function runAfterPageLoad(fn: () => void) {\n  deprecation.warn(\n      'Blockly.utils.runAfterPageLoad', 'December 2021', 'December 2022');\n  extensions.runAfterPageLoad(fn);\n}\n","/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Contains functions registering serializers (eg blocks, variables, plugins,\n * etc).\n *\n * @namespace Blockly.serialization.registry\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.serialization.registry');\n\n// eslint-disable-next-line no-unused-vars\nimport type {ISerializer} from '../interfaces/i_serializer.js';\nimport * as registry from '../registry.js';\n\n\n/**\n * Registers the given serializer so that it can be used for serialization and\n * deserialization.\n *\n * @param name The name of the serializer to register.\n * @param serializer The serializer to register.\n * @alias Blockly.serialization.registry.register\n */\nexport function register(name: string, serializer: ISerializer) {\n  registry.register(registry.Type.SERIALIZER, name, serializer);\n}\n\n/**\n * Unregisters the serializer associated with the given name.\n *\n * @param name The name of the serializer to unregister.\n * @alias Blockly.serialization.registry.unregister\n */\nexport function unregister(name: string) {\n  registry.unregister(registry.Type.SERIALIZER, name);\n}\n","/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Handles serializing blocks to plain JavaScript objects only containing state.\n *\n * @namespace Blockly.serialization.blocks\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.serialization.blocks');\n\nimport type {Block} from '../block.js';\nimport type {BlockSvg} from '../block_svg.js';\nimport type {Connection} from '../connection.js';\nimport * as eventUtils from '../events/utils.js';\nimport {inputTypes} from '../input_types.js';\nimport type {ISerializer} from '../interfaces/i_serializer.js';\nimport {Size} from '../utils/size.js';\nimport type {Workspace} from '../workspace.js';\nimport * as Xml from '../xml.js';\n\nimport {BadConnectionCheck, MissingBlockType, MissingConnection, RealChildOfShadow} from './exceptions.js';\nimport * as priorities from './priorities.js';\nimport * as serializationRegistry from './registry.js';\n\n\n// TODO(#5160): Remove this once lint is fixed.\n/* eslint-disable no-use-before-define */\n\n/**\n * Represents the state of a connection.\n *\n * @alias Blockly.serialization.blocks.ConnectionState\n */\nexport interface ConnectionState {\n  shadow: State|undefined;\n  block: State|undefined;\n}\n\n/**\n * Represents the state of a given block.\n *\n * @alias Blockly.serialization.blocks.State\n */\nexport interface State {\n  type: string;\n  id?: string;\n  x?: number;\n  y?: number;\n  collapsed?: boolean;\n  enabled?: boolean;\n  inline?: boolean;\n  data?: string;\n  extraState?: AnyDuringMigration;\n  icons?: {[key: string]: AnyDuringMigration};\n  fields?: {[key: string]: AnyDuringMigration};\n  inputs?: {[key: string]: ConnectionState};\n  next?: ConnectionState;\n}\n\n/**\n * Returns the state of the given block as a plain JavaScript object.\n *\n * @param block The block to serialize.\n * @param param1 addCoordinates: If true, the coordinates of the block are added\n *     to the serialized state. False by default. addinputBlocks: If true,\n *     children of the block which are connected to inputs will be serialized.\n *     True by default. addNextBlocks: If true, children of the block which are\n *     connected to the block's next connection (if it exists) will be\n *     serialized. True by default. doFullSerialization: If true, fields that\n *     normally just save a reference to some external state (eg variables) will\n *     instead serialize all of the info about that state. This supports\n *     deserializing the block into a workspace where that state doesn't yet\n *     exist. True by default.\n * @returns The serialized state of the block, or null if the block could not be\n *     serialied (eg it was an insertion marker).\n * @alias Blockly.serialization.blocks.save\n */\nexport function save(block: Block, {\n  addCoordinates = false,\n  addInputBlocks = true,\n  addNextBlocks = true,\n  doFullSerialization = true,\n}: {\n  addCoordinates?: boolean,\n  addInputBlocks?: boolean,\n  addNextBlocks?: boolean,\n  doFullSerialization?: boolean\n} = {}): State|null {\n  if (block.isInsertionMarker()) {\n    return null;\n  }\n\n  const state = {\n    'type': block.type,\n    'id': block.id,\n  };\n\n  if (addCoordinates) {\n    // AnyDuringMigration because:  Argument of type '{ type: string; id:\n    // string; }' is not assignable to parameter of type 'State'.\n    saveCoords(block, state as AnyDuringMigration);\n  }\n  // AnyDuringMigration because:  Argument of type '{ type: string; id: string;\n  // }' is not assignable to parameter of type 'State'.\n  saveAttributes(block, state as AnyDuringMigration);\n  // AnyDuringMigration because:  Argument of type '{ type: string; id: string;\n  // }' is not assignable to parameter of type 'State'.\n  saveExtraState(block, state as AnyDuringMigration);\n  // AnyDuringMigration because:  Argument of type '{ type: string; id: string;\n  // }' is not assignable to parameter of type 'State'.\n  saveIcons(block, state as AnyDuringMigration);\n  // AnyDuringMigration because:  Argument of type '{ type: string; id: string;\n  // }' is not assignable to parameter of type 'State'.\n  saveFields(block, state as AnyDuringMigration, doFullSerialization);\n  if (addInputBlocks) {\n    // AnyDuringMigration because:  Argument of type '{ type: string; id:\n    // string; }' is not assignable to parameter of type 'State'.\n    saveInputBlocks(block, state as AnyDuringMigration, doFullSerialization);\n  }\n  if (addNextBlocks) {\n    // AnyDuringMigration because:  Argument of type '{ type: string; id:\n    // string; }' is not assignable to parameter of type 'State'.\n    saveNextBlocks(block, state as AnyDuringMigration, doFullSerialization);\n  }\n\n  // AnyDuringMigration because:  Type '{ type: string; id: string; }' is not\n  // assignable to type 'State'.\n  return state as AnyDuringMigration;\n}\n\n/**\n * Adds attributes to the given state object based on the state of the block.\n * Eg collapsed, disabled, inline, etc.\n *\n * @param block The block to base the attributes on.\n * @param state The state object to append to.\n */\nfunction saveAttributes(block: Block, state: State) {\n  if (block.isCollapsed()) {\n    state['collapsed'] = true;\n  }\n  if (!block.isEnabled()) {\n    state['enabled'] = false;\n  }\n  if (block.inputsInline !== undefined &&\n      block.inputsInline !== block.inputsInlineDefault) {\n    state['inline'] = block.inputsInline;\n  }\n  // Data is a nullable string, so we don't need to worry about falsy values.\n  if (block.data) {\n    state['data'] = block.data;\n  }\n}\n\n/**\n * Adds the coordinates of the given block to the given state object.\n *\n * @param block The block to base the coordinates on.\n * @param state The state object to append to.\n */\nfunction saveCoords(block: Block, state: State) {\n  const workspace = block.workspace;\n  const xy = block.getRelativeToSurfaceXY();\n  state['x'] = Math.round(workspace.RTL ? workspace.getWidth() - xy.x : xy.x);\n  state['y'] = Math.round(xy.y);\n}\n/**\n * Adds any extra state the block may provide to the given state object.\n *\n * @param block The block to serialize the extra state of.\n * @param state The state object to append to.\n */\nfunction saveExtraState(block: Block, state: State) {\n  if (block.saveExtraState) {\n    const extraState = block.saveExtraState();\n    if (extraState !== null) {\n      state['extraState'] = extraState;\n    }\n  } else if (block.mutationToDom) {\n    const extraState = block.mutationToDom();\n    if (extraState !== null) {\n      state['extraState'] =\n          Xml.domToText(extraState)\n              .replace(\n                  ' xmlns=\"https://developers.google.com/blockly/xml\"', '');\n    }\n  }\n}\n\n/**\n * Adds the state of all of the icons on the block to the given state object.\n *\n * @param block The block to serialize the icon state of.\n * @param state The state object to append to.\n */\nfunction saveIcons(block: Block, state: State) {\n  // TODO(#2105): Remove this logic and put it in the icon.\n  if (block.getCommentText()) {\n    state['icons'] = {\n      'comment': {\n        'text': block.getCommentText(),\n        'pinned': block.commentModel.pinned,\n        'height': Math.round(block.commentModel.size.height),\n        'width': Math.round(block.commentModel.size.width),\n      },\n    };\n  }\n}\n\n/**\n * Adds the state of all of the fields on the block to the given state object.\n *\n * @param block The block to serialize the field state of.\n * @param state The state object to append to.\n * @param doFullSerialization Whether or not to serialize the full state of the\n *     field (rather than possibly saving a reference to some state).\n */\nfunction saveFields(block: Block, state: State, doFullSerialization: boolean) {\n  const fields = Object.create(null);\n  for (let i = 0; i < block.inputList.length; i++) {\n    const input = block.inputList[i];\n    for (let j = 0; j < input.fieldRow.length; j++) {\n      const field = input.fieldRow[j];\n      if (field.isSerializable()) {\n        fields[field.name!] = field.saveState(doFullSerialization);\n      }\n    }\n  }\n  if (Object.keys(fields).length) {\n    state['fields'] = fields;\n  }\n}\n\n/**\n * Adds the state of all of the child blocks of the given block (which are\n * connected to inputs) to the given state object.\n *\n * @param block The block to serialize the input blocks of.\n * @param state The state object to append to.\n * @param doFullSerialization Whether or not to do full serialization.\n */\nfunction saveInputBlocks(\n    block: Block, state: State, doFullSerialization: boolean) {\n  const inputs = Object.create(null);\n  for (let i = 0; i < block.inputList.length; i++) {\n    const input = block.inputList[i];\n    if (input.type === inputTypes.DUMMY) {\n      continue;\n    }\n    const connectionState =\n        saveConnection(input.connection as Connection, doFullSerialization);\n    if (connectionState) {\n      inputs[input.name] = connectionState;\n    }\n  }\n\n  if (Object.keys(inputs).length) {\n    state['inputs'] = inputs;\n  }\n}\n\n/**\n * Adds the state of all of the next blocks of the given block to the given\n * state object.\n *\n * @param block The block to serialize the next blocks of.\n * @param state The state object to append to.\n * @param doFullSerialization Whether or not to do full serialization.\n */\nfunction saveNextBlocks(\n    block: Block, state: State, doFullSerialization: boolean) {\n  if (!block.nextConnection) {\n    return;\n  }\n  const connectionState =\n      saveConnection(block.nextConnection, doFullSerialization);\n  if (connectionState) {\n    state['next'] = connectionState;\n  }\n}\n\n/**\n * Returns the state of the given connection (ie the state of any connected\n * shadow or real blocks).\n *\n * @param connection The connection to serialize the connected blocks of.\n * @returns An object containing the state of any connected shadow block, or any\n *     connected real block.\n * @param doFullSerialization Whether or not to do full serialization.\n */\nfunction saveConnection(connection: Connection, doFullSerialization: boolean):\n    ConnectionState|null {\n  const shadow = connection.getShadowState(true);\n  const child = connection.targetBlock();\n  if (!shadow && !child) {\n    return null;\n  }\n  const state = Object.create(null);\n  if (shadow) {\n    state['shadow'] = shadow;\n  }\n  if (child && !child.isShadow()) {\n    state['block'] = save(child, {doFullSerialization});\n  }\n  return state;\n}\n\n/**\n * Loads the block represented by the given state into the given workspace.\n *\n * @param state The state of a block to deserialize into the workspace.\n * @param workspace The workspace to add the block to.\n * @param param1 recordUndo: If true, events triggered by this function will be\n *     undo-able by the user. False by default.\n * @returns The block that was just loaded.\n * @alias Blockly.serialization.blocks.append\n */\nexport function append(\n    state: State, workspace: Workspace,\n    {recordUndo = false}: {recordUndo?: boolean} = {}): Block {\n  return appendInternal(state, workspace, {recordUndo});\n}\n\n/**\n * Loads the block represented by the given state into the given workspace.\n * This is defined internally so that the extra parameters don't clutter our\n * external API.\n * But it is exported so that other places within Blockly can call it directly\n * with the extra parameters.\n *\n * @param state The state of a block to deserialize into the workspace.\n * @param workspace The workspace to add the block to.\n * @param param1 parentConnection: If provided, the system will attempt to\n *     connect the block to this connection after it is created. Undefined by\n *     default. isShadow: If true, the block will be set to a shadow block after\n *     it is created. False by default. recordUndo: If true, events triggered by\n *     this function will be undo-able by the user. False by default.\n * @returns The block that was just appended.\n * @alias Blockly.serialization.blocks.appendInternal\n * @internal\n */\nexport function appendInternal(\n    state: State, workspace: Workspace,\n    {parentConnection = undefined, isShadow = false, recordUndo = false}: {\n      parentConnection?: Connection,\n      isShadow?: boolean,\n      recordUndo?: boolean\n    } = {}): Block {\n  const prevRecordUndo = eventUtils.getRecordUndo();\n  eventUtils.setRecordUndo(recordUndo);\n  const existingGroup = eventUtils.getGroup();\n  if (!existingGroup) {\n    eventUtils.setGroup(true);\n  }\n  eventUtils.disable();\n\n  const block = appendPrivate(state, workspace, {parentConnection, isShadow});\n\n  eventUtils.enable();\n  eventUtils.fire(new (eventUtils.get(eventUtils.BLOCK_CREATE))(block));\n  eventUtils.setGroup(existingGroup);\n  eventUtils.setRecordUndo(prevRecordUndo);\n\n  // Adding connections to the connection db is expensive. This defers that\n  // operation to decrease load time.\n  if (workspace.rendered) {\n    const blockSvg = block as BlockSvg;\n    setTimeout(() => {\n      if (!blockSvg.disposed) {\n        blockSvg.setConnectionTracking(true);\n      }\n    }, 1);\n  }\n\n  return block;\n}\n\n/**\n * Loads the block represented by the given state into the given workspace.\n * This is defined privately so that it can be called recursively without firing\n * eroneous events. Events (and other things we only want to occur on the top\n * block) are handled by appendInternal.\n *\n * @param state The state of a block to deserialize into the workspace.\n * @param workspace The workspace to add the block to.\n * @param param1 parentConnection: If provided, the system will attempt to\n *     connect the block to this connection after it is created. Undefined by\n *     default. isShadow: The block will be set to a shadow block after it is\n *     created. False by default.\n * @returns The block that was just appended.\n */\nfunction appendPrivate(\n    state: State, workspace: Workspace,\n    {parentConnection = undefined, isShadow = false}:\n        {parentConnection?: Connection, isShadow?: boolean} = {}): Block {\n  if (!state['type']) {\n    throw new MissingBlockType(state);\n  }\n\n  const block = workspace.newBlock(state['type'], state['id']);\n  block.setShadow(isShadow);\n  loadCoords(block, state);\n  loadAttributes(block, state);\n  loadExtraState(block, state);\n  tryToConnectParent(parentConnection, block, state);\n  loadIcons(block, state);\n  loadFields(block, state);\n  loadInputBlocks(block, state);\n  loadNextBlocks(block, state);\n  initBlock(block, workspace.rendered);\n\n  return block;\n}\n\n/**\n * Applies any coordinate information available on the state object to the\n * block.\n *\n * @param block The block to set the position of.\n * @param state The state object to reference.\n */\nfunction loadCoords(block: Block, state: State) {\n  let x = state['x'] === undefined ? 0 : state['x'];\n  const y = state['y'] === undefined ? 0 : state['y'];\n\n  const workspace = block.workspace;\n  x = workspace.RTL ? workspace.getWidth() - x : x;\n\n  block.moveBy(x, y);\n}\n\n/**\n * Applies any attribute information available on the state object to the block.\n *\n * @param block The block to set the attributes of.\n * @param state The state object to reference.\n */\nfunction loadAttributes(block: Block, state: State) {\n  if (state['collapsed']) {\n    block.setCollapsed(true);\n  }\n  if (state['enabled'] === false) {\n    block.setEnabled(false);\n  }\n  if (state['inline'] !== undefined) {\n    block.setInputsInline(state['inline']);\n  }\n  if (state['data'] !== undefined) {\n    block.data = state['data'];\n  }\n}\n\n/**\n * Applies any extra state information available on the state object to the\n * block.\n *\n * @param block The block to set the extra state of.\n * @param state The state object to reference.\n */\nfunction loadExtraState(block: Block, state: State) {\n  if (!state['extraState']) {\n    return;\n  }\n  if (block.loadExtraState) {\n    block.loadExtraState(state['extraState']);\n  } else if (block.domToMutation) {\n    block.domToMutation(Xml.textToDom(state['extraState']));\n  }\n}\n\n/**\n * Attempts to connect the block to the parent connection, if it exists.\n *\n * @param parentConnection The parent connection to try to connect the block to.\n * @param child The block to try to connect to the parent.\n * @param state The state which defines the given block\n */\nfunction tryToConnectParent(\n    parentConnection: Connection|undefined, child: Block, state: State) {\n  if (!parentConnection) {\n    return;\n  }\n\n  if (parentConnection.getSourceBlock().isShadow() && !child.isShadow()) {\n    throw new RealChildOfShadow(state);\n  }\n\n  let connected = false;\n  let childConnection;\n  if (parentConnection.type === inputTypes.VALUE) {\n    childConnection = child.outputConnection;\n    if (!childConnection) {\n      throw new MissingConnection('output', child, state);\n    }\n    connected = parentConnection.connect(childConnection);\n  } else {  // Statement type.\n    childConnection = child.previousConnection;\n    if (!childConnection) {\n      throw new MissingConnection('previous', child, state);\n    }\n    connected = parentConnection.connect(childConnection);\n  }\n\n  if (!connected) {\n    const checker = child.workspace.connectionChecker;\n    throw new BadConnectionCheck(\n        checker.getErrorMessage(\n            checker.canConnectWithReason(\n                childConnection, parentConnection, false),\n            childConnection, parentConnection),\n        parentConnection.type === inputTypes.VALUE ? 'output connection' :\n                                                     'previous connection',\n        child, state);\n  }\n}\n\n/**\n * Applies icon state to the icons on the block, based on the given state\n * object.\n *\n * @param block The block to set the icon state of.\n * @param state The state object to reference.\n */\nfunction loadIcons(block: Block, state: State) {\n  if (!state['icons']) {\n    return;\n  }\n  // TODO(#2105): Remove this logic and put it in the icon.\n  const comment = state['icons']['comment'];\n  if (comment) {\n    block.setCommentText(comment['text']);\n    // Load if saved. (Cleaned unnecessary attributes when in the trashcan.)\n    if ('pinned' in comment) {\n      block.commentModel.pinned = comment['pinned'];\n    }\n    if ('width' in comment && 'height' in comment) {\n      block.commentModel.size = new Size(comment['width'], comment['height']);\n    }\n    if (comment['pinned'] && block.rendered && !block.isInFlyout) {\n      // Give the block a chance to be positioned and rendered before showing.\n      const blockSvg = block as BlockSvg;\n      setTimeout(() => blockSvg.getCommentIcon()!.setVisible(true), 1);\n    }\n  }\n}\n\n/**\n * Applies any field information available on the state object to the block.\n *\n * @param block The block to set the field state of.\n * @param state The state object to reference.\n */\nfunction loadFields(block: Block, state: State) {\n  if (!state['fields']) {\n    return;\n  }\n  const keys = Object.keys(state['fields']);\n  for (let i = 0; i < keys.length; i++) {\n    const fieldName = keys[i];\n    const fieldState = state['fields'][fieldName];\n    const field = block.getField(fieldName);\n    if (!field) {\n      console.warn(\n          `Ignoring non-existant field ${fieldName} in block ${block.type}`);\n      continue;\n    }\n    field.loadState(fieldState);\n  }\n}\n\n/**\n * Creates any child blocks (attached to inputs) defined by the given state\n * and attaches them to the given block.\n *\n * @param block The block to attach input blocks to.\n * @param state The state object to reference.\n */\nfunction loadInputBlocks(block: Block, state: State) {\n  if (!state['inputs']) {\n    return;\n  }\n  const keys = Object.keys(state['inputs']);\n  for (let i = 0; i < keys.length; i++) {\n    const inputName = keys[i];\n    const input = block.getInput(inputName);\n    if (!input || !input.connection) {\n      throw new MissingConnection(inputName, block, state);\n    }\n    loadConnection(input.connection, state['inputs'][inputName]);\n  }\n}\n\n/**\n * Creates any next blocks defined by the given state and attaches them to the\n * given block.\n *\n * @param block The block to attach next blocks to.\n * @param state The state object to reference.\n */\nfunction loadNextBlocks(block: Block, state: State) {\n  if (!state['next']) {\n    return;\n  }\n  if (!block.nextConnection) {\n    throw new MissingConnection('next', block, state);\n  }\n  loadConnection(block.nextConnection, state['next']);\n}\n/**\n * Applies the state defined by connectionState to the given connection, ie\n * assigns shadows and attaches child blocks.\n *\n * @param connection The connection to deserialize the connected blocks of.\n * @param connectionState The object containing the state of any connected\n *     shadow block, or any connected real block.\n */\nfunction loadConnection(\n    connection: Connection, connectionState: ConnectionState) {\n  if (connectionState['shadow']) {\n    connection.setShadowState(connectionState['shadow']);\n  }\n  if (connectionState['block']) {\n    appendPrivate(\n        connectionState['block'], connection.getSourceBlock().workspace,\n        {parentConnection: connection});\n  }\n}\n\n// TODO(#5146): Remove this from the serialization system.\n/**\n * Initializes the give block, eg init the model, inits the svg, renders, etc.\n *\n * @param block The block to initialize.\n * @param rendered Whether the block is a rendered or headless block.\n */\nfunction initBlock(block: Block, rendered: boolean) {\n  if (rendered) {\n    const blockSvg = block as BlockSvg;\n    // Adding connections to the connection db is expensive. This defers that\n    // operation to decrease load time.\n    blockSvg.setConnectionTracking(false);\n\n    blockSvg.initSvg();\n    blockSvg.render(false);\n    // fixes #6076 JSO deserialization doesn't\n    // set .iconXY_ property so here it will be set\n    const icons = blockSvg.getIcons();\n    for (let i = 0; i < icons.length; i++) {\n      icons[i].computeIconLocation();\n    }\n  } else {\n    block.initModel();\n  }\n}\n\n// Alias to disambiguate saving within the serializer.\nconst saveBlock = save;\n\n/**\n * Serializer for saving and loading block state.\n *\n * @alias Blockly.serialization.blocks.BlockSerializer\n */\nexport class BlockSerializer implements ISerializer {\n  priority: number;\n\n  /* eslint-disable-next-line require-jsdoc */\n  constructor() {\n    /** The priority for deserializing blocks. */\n    this.priority = priorities.BLOCKS;\n  }\n\n  /**\n   * Serializes the blocks of the given workspace.\n   *\n   * @param workspace The workspace to save the blocks of.\n   * @returns The state of the workspace's blocks, or null if there are no\n   *     blocks.\n   */\n  save(workspace: Workspace): {languageVersion: number, blocks: State[]}|null {\n    const blockStates = [];\n    for (const block of workspace.getTopBlocks(false)) {\n      const state =\n          saveBlock(block, {addCoordinates: true, doFullSerialization: false});\n      if (state) {\n        blockStates.push(state);\n      }\n    }\n    if (blockStates.length) {\n      return {\n        'languageVersion': 0,  // Currently unused.\n        'blocks': blockStates,\n      };\n    }\n    return null;\n  }\n\n  /**\n   * Deserializes the blocks defined by the given state into the given\n   * workspace.\n   *\n   * @param state The state of the blocks to deserialize.\n   * @param workspace The workspace to deserialize into.\n   */\n  load(\n      state: {languageVersion: number, blocks: State[]}, workspace: Workspace) {\n    const blockStates = state['blocks'];\n    for (const state of blockStates) {\n      append(state, workspace, {recordUndo: eventUtils.getRecordUndo()});\n    }\n  }\n\n  /**\n   * Disposes of any blocks that exist on the workspace.\n   *\n   * @param workspace The workspace to clear the blocks of.\n   */\n  clear(workspace: Workspace) {\n    // Cannot use workspace.clear() because that also removes variables.\n    for (const block of workspace.getTopBlocks(false)) {\n      block.dispose(false);\n    }\n  }\n}\n\nserializationRegistry.register('blocks', new BlockSerializer());\n","/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Components for creating connections between blocks.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Connection');\n\nimport type {Block} from './block.js';\nimport {ConnectionType} from './connection_type.js';\nimport type {BlockMove} from './events/events_block_move.js';\nimport * as eventUtils from './events/utils.js';\nimport type {Input} from './input.js';\nimport type {IASTNodeLocationWithBlock} from './interfaces/i_ast_node_location_with_block.js';\nimport type {IConnectionChecker} from './interfaces/i_connection_checker.js';\nimport * as blocks from './serialization/blocks.js';\nimport * as Xml from './xml.js';\n\n\n/**\n * Class for a connection between blocks.\n *\n * @alias Blockly.Connection\n */\nexport class Connection implements IASTNodeLocationWithBlock {\n  /** Constants for checking whether two connections are compatible. */\n  static CAN_CONNECT = 0;\n  static REASON_SELF_CONNECTION = 1;\n  static REASON_WRONG_TYPE = 2;\n  static REASON_TARGET_NULL = 3;\n  static REASON_CHECKS_FAILED = 4;\n  static REASON_DIFFERENT_WORKSPACES = 5;\n  static REASON_SHADOW_PARENT = 6;\n  static REASON_DRAG_CHECKS_FAILED = 7;\n  static REASON_PREVIOUS_AND_OUTPUT = 8;\n\n  protected sourceBlock_: Block;\n\n  /** Connection this connection connects to.  Null if not connected. */\n  targetConnection: Connection|null = null;\n\n  /**\n   * Has this connection been disposed of?\n   *\n   * @internal\n   */\n  disposed = false;\n\n  /** List of compatible value types.  Null if all types are compatible. */\n  private check_: string[]|null = null;\n\n  /** DOM representation of a shadow block, or null if none. */\n  private shadowDom_: Element|null = null;\n\n  /**\n   * Horizontal location of this connection.\n   *\n   * @internal\n   */\n  x = 0;\n\n  /**\n   * Vertical location of this connection.\n   *\n   * @internal\n   */\n  y = 0;\n\n  private shadowState_: blocks.State|null = null;\n\n  /**\n   * @param source The block establishing this connection.\n   * @param type The type of the connection.\n   */\n  constructor(source: Block, public type: number) {\n    this.sourceBlock_ = source;\n  }\n\n  /**\n   * Connect two connections together.  This is the connection on the superior\n   * block.\n   *\n   * @param childConnection Connection on inferior block.\n   */\n  protected connect_(childConnection: Connection) {\n    const INPUT = ConnectionType.INPUT_VALUE;\n    const parentBlock = this.getSourceBlock();\n    const childBlock = childConnection.getSourceBlock();\n\n    // Make sure the childConnection is available.\n    if (childConnection.isConnected()) {\n      childConnection.disconnect();\n    }\n\n    // Make sure the parentConnection is available.\n    let orphan;\n    if (this.isConnected()) {\n      const shadowState = this.stashShadowState_();\n      const target = this.targetBlock();\n      if (target!.isShadow()) {\n        target!.dispose(false);\n      } else {\n        this.disconnect();\n        orphan = target;\n      }\n      this.applyShadowState_(shadowState);\n    }\n\n    // Connect the new connection to the parent.\n    let event;\n    if (eventUtils.isEnabled()) {\n      event =\n          new (eventUtils.get(eventUtils.BLOCK_MOVE))(childBlock) as BlockMove;\n    }\n    connectReciprocally(this, childConnection);\n    childBlock.setParent(parentBlock);\n    if (event) {\n      event.recordNew();\n      eventUtils.fire(event);\n    }\n\n    // Deal with the orphan if it exists.\n    if (orphan) {\n      const orphanConnection = this.type === INPUT ? orphan.outputConnection :\n                                                     orphan.previousConnection;\n      const connection = Connection.getConnectionForOrphanedConnection(\n          childBlock, (orphanConnection));\n      if (connection) {\n        orphanConnection.connect(connection);\n      } else {\n        orphanConnection.onFailedConnect(this);\n      }\n    }\n  }\n\n  /**\n   * Dispose of this connection and deal with connected blocks.\n   *\n   * @internal\n   */\n  dispose() {\n    // isConnected returns true for shadows and non-shadows.\n    if (this.isConnected()) {\n      // Destroy the attached shadow block & its children (if it exists).\n      this.setShadowStateInternal_();\n\n      const targetBlock = this.targetBlock();\n      if (targetBlock) {\n        // Disconnect the attached normal block.\n        targetBlock.unplug();\n      }\n    }\n\n    this.disposed = true;\n  }\n\n  /**\n   * Get the source block for this connection.\n   *\n   * @returns The source block.\n   */\n  getSourceBlock(): Block {\n    return this.sourceBlock_;\n  }\n\n  /**\n   * Does the connection belong to a superior block (higher in the source\n   * stack)?\n   *\n   * @returns True if connection faces down or right.\n   */\n  isSuperior(): boolean {\n    return this.type === ConnectionType.INPUT_VALUE ||\n        this.type === ConnectionType.NEXT_STATEMENT;\n  }\n\n  /**\n   * Is the connection connected?\n   *\n   * @returns True if connection is connected to another connection.\n   */\n  isConnected(): boolean {\n    return !!this.targetConnection;\n  }\n\n  /**\n   * Get the workspace's connection type checker object.\n   *\n   * @returns The connection type checker for the source block's workspace.\n   * @internal\n   */\n  getConnectionChecker(): IConnectionChecker {\n    return this.sourceBlock_.workspace.connectionChecker;\n  }\n\n  /**\n   * Called when an attempted connection fails. NOP by default (i.e. for\n   * headless workspaces).\n   *\n   * @param _otherConnection Connection that this connection failed to connect\n   *     to.\n   * @internal\n   */\n  onFailedConnect(_otherConnection: Connection) {}\n  // NOP\n\n  /**\n   * Connect this connection to another connection.\n   *\n   * @param otherConnection Connection to connect to.\n   * @returns Whether the the blocks are now connected or not.\n   */\n  connect(otherConnection: Connection): boolean {\n    if (this.targetConnection === otherConnection) {\n      // Already connected together.  NOP.\n      return true;\n    }\n\n    const checker = this.getConnectionChecker();\n    if (checker.canConnect(this, otherConnection, false)) {\n      const eventGroup = eventUtils.getGroup();\n      if (!eventGroup) {\n        eventUtils.setGroup(true);\n      }\n      // Determine which block is superior (higher in the source stack).\n      if (this.isSuperior()) {\n        // Superior block.\n        this.connect_(otherConnection);\n      } else {\n        // Inferior block.\n        otherConnection.connect_(this);\n      }\n      if (!eventGroup) {\n        eventUtils.setGroup(false);\n      }\n    }\n\n    return this.isConnected();\n  }\n\n  /** Disconnect this connection. */\n  disconnect() {\n    const otherConnection = this.targetConnection;\n    if (!otherConnection) {\n      throw Error('Source connection not connected.');\n    }\n    if (otherConnection.targetConnection !== this) {\n      throw Error('Target connection not connected to source connection.');\n    }\n    let parentBlock;\n    let childBlock;\n    let parentConnection;\n    if (this.isSuperior()) {\n      // Superior block.\n      parentBlock = this.sourceBlock_;\n      childBlock = otherConnection.getSourceBlock();\n      /* eslint-disable-next-line @typescript-eslint/no-this-alias */\n      parentConnection = this;\n    } else {\n      // Inferior block.\n      parentBlock = otherConnection.getSourceBlock();\n      childBlock = this.sourceBlock_;\n      parentConnection = otherConnection;\n    }\n\n    const eventGroup = eventUtils.getGroup();\n    if (!eventGroup) {\n      eventUtils.setGroup(true);\n    }\n    this.disconnectInternal_(parentBlock, childBlock);\n    if (!childBlock.isShadow()) {\n      // If we were disconnecting a shadow, no need to spawn a new one.\n      parentConnection.respawnShadow_();\n    }\n    if (!eventGroup) {\n      eventUtils.setGroup(false);\n    }\n  }\n\n  /**\n   * Disconnect two blocks that are connected by this connection.\n   *\n   * @param parentBlock The superior block.\n   * @param childBlock The inferior block.\n   */\n  protected disconnectInternal_(parentBlock: Block, childBlock: Block) {\n    let event;\n    if (eventUtils.isEnabled()) {\n      event =\n          new (eventUtils.get(eventUtils.BLOCK_MOVE))(childBlock) as BlockMove;\n    }\n    const otherConnection = this.targetConnection;\n    if (otherConnection) {\n      otherConnection.targetConnection = null;\n    }\n    this.targetConnection = null;\n    childBlock.setParent(null);\n    if (event) {\n      event.recordNew();\n      eventUtils.fire(event);\n    }\n  }\n\n  /**\n   * Respawn the shadow block if there was one connected to the this connection.\n   */\n  protected respawnShadow_() {\n    // Have to keep respawnShadow_ for backwards compatibility.\n    this.createShadowBlock_(true);\n  }\n\n  /**\n   * Returns the block that this connection connects to.\n   *\n   * @returns The connected block or null if none is connected.\n   */\n  targetBlock(): Block|null {\n    if (this.isConnected()) {\n      return this.targetConnection?.getSourceBlock() ?? null;\n    }\n    return null;\n  }\n\n  /**\n   * Function to be called when this connection's compatible types have changed.\n   */\n  protected onCheckChanged_() {\n    // The new value type may not be compatible with the existing connection.\n    if (this.isConnected() &&\n        (!this.targetConnection ||\n         !this.getConnectionChecker().canConnect(\n             this, this.targetConnection, false))) {\n      const child = this.isSuperior() ? this.targetBlock() : this.sourceBlock_;\n      child!.unplug();\n    }\n  }\n\n  /**\n   * Change a connection's compatibility.\n   *\n   * @param check Compatible value type or list of value types. Null if all\n   *     types are compatible.\n   * @returns The connection being modified (to allow chaining).\n   */\n  setCheck(check: string|string[]|null): Connection {\n    if (check) {\n      if (!Array.isArray(check)) {\n        check = [check];\n      }\n      this.check_ = check;\n      this.onCheckChanged_();\n    } else {\n      this.check_ = null;\n    }\n    return this;\n  }\n\n  /**\n   * Get a connection's compatibility.\n   *\n   * @returns List of compatible value types.\n   *     Null if all types are compatible.\n   */\n  getCheck(): string[]|null {\n    return this.check_;\n  }\n\n  /**\n   * Changes the connection's shadow block.\n   *\n   * @param shadowDom DOM representation of a block or null.\n   */\n  setShadowDom(shadowDom: Element|null) {\n    this.setShadowStateInternal_({shadowDom});\n  }\n\n  /**\n   * Returns the xml representation of the connection's shadow block.\n   *\n   * @param returnCurrent If true, and the shadow block is currently attached to\n   *     this connection, this serializes the state of that block and returns it\n   *     (so that field values are correct). Otherwise the saved shadowDom is\n   *     just returned.\n   * @returns Shadow DOM representation of a block or null.\n   */\n  getShadowDom(returnCurrent?: boolean): Element|null {\n    return returnCurrent && this.targetBlock()!.isShadow() ?\n        Xml.blockToDom((this.targetBlock() as Block)) as Element :\n        this.shadowDom_;\n  }\n\n  /**\n   * Changes the connection's shadow block.\n   *\n   * @param shadowState An state represetation of the block or null.\n   */\n  setShadowState(shadowState: blocks.State|null) {\n    this.setShadowStateInternal_({shadowState});\n  }\n\n  /**\n   * Returns the serialized object representation of the connection's shadow\n   * block.\n   *\n   * @param returnCurrent If true, and the shadow block is currently attached to\n   *     this connection, this serializes the state of that block and returns it\n   *     (so that field values are correct). Otherwise the saved state is just\n   *     returned.\n   * @returns Serialized object representation of the block, or null.\n   */\n  getShadowState(returnCurrent?: boolean): blocks.State|null {\n    if (returnCurrent && this.targetBlock() && this.targetBlock()!.isShadow()) {\n      return blocks.save(this.targetBlock() as Block);\n    }\n    return this.shadowState_;\n  }\n\n  /**\n   * Find all nearby compatible connections to this connection.\n   * Type checking does not apply, since this function is used for bumping.\n   *\n   * Headless configurations (the default) do not have neighboring connection,\n   * and always return an empty list (the default).\n   * {@link RenderedConnection#neighbours} overrides this behavior with a list\n   * computed from the rendered positioning.\n   *\n   * @param _maxLimit The maximum radius to another connection.\n   * @returns List of connections.\n   * @internal\n   */\n  neighbours(_maxLimit: number): Connection[] {\n    return [];\n  }\n\n  /**\n   * Get the parent input of a connection.\n   *\n   * @returns The input that the connection belongs to or null if no parent\n   *     exists.\n   * @internal\n   */\n  getParentInput(): Input|null {\n    let parentInput = null;\n    const inputs = this.sourceBlock_.inputList;\n    for (let i = 0; i < inputs.length; i++) {\n      if (inputs[i].connection === this) {\n        parentInput = inputs[i];\n        break;\n      }\n    }\n    return parentInput;\n  }\n\n  /**\n   * This method returns a string describing this Connection in developer terms\n   * (English only). Intended to on be used in console logs and errors.\n   *\n   * @returns The description.\n   */\n  toString(): string {\n    const block = this.sourceBlock_;\n    if (!block) {\n      return 'Orphan Connection';\n    }\n    let msg;\n    if (block.outputConnection === this) {\n      msg = 'Output Connection of ';\n    } else if (block.previousConnection === this) {\n      msg = 'Previous Connection of ';\n    } else if (block.nextConnection === this) {\n      msg = 'Next Connection of ';\n    } else {\n      let parentInput = null;\n      for (let i = 0, input; input = block.inputList[i]; i++) {\n        if (input.connection === this) {\n          parentInput = input;\n          break;\n        }\n      }\n      if (parentInput) {\n        msg = 'Input \"' + parentInput.name + '\" connection on ';\n      } else {\n        console.warn('Connection not actually connected to sourceBlock_');\n        return 'Orphan Connection';\n      }\n    }\n    return msg + block.toDevString();\n  }\n\n  /**\n   * Returns the state of the shadowDom_ and shadowState_ properties, then\n   * temporarily sets those properties to null so no shadow respawns.\n   *\n   * @returns The state of both the shadowDom_ and shadowState_ properties.\n   */\n  private stashShadowState_():\n      {shadowDom: Element|null, shadowState: blocks.State|null} {\n    const shadowDom = this.getShadowDom(true);\n    const shadowState = this.getShadowState(true);\n    // Set to null so it doesn't respawn.\n    this.shadowDom_ = null;\n    this.shadowState_ = null;\n    return {shadowDom, shadowState};\n  }\n\n  /**\n   * Reapplies the stashed state of the shadowDom_ and shadowState_ properties.\n   *\n   * @param param0 The state to reapply to the shadowDom_ and shadowState_\n   *     properties.\n   */\n  private applyShadowState_({shadowDom, shadowState}: {\n    shadowDom: Element|null,\n    shadowState: blocks.State|null\n  }) {\n    this.shadowDom_ = shadowDom;\n    this.shadowState_ = shadowState;\n  }\n\n  /**\n   * Sets the state of the shadow of this connection.\n   *\n   * @param param0 The state to set the shadow of this connection to.\n   */\n  private setShadowStateInternal_({shadowDom = null, shadowState = null}: {\n    shadowDom?: Element|null,\n    shadowState?: blocks.State|null\n  } = {}) {\n    // One or both of these should always be null.\n    // If neither is null, the shadowState will get priority.\n    this.shadowDom_ = shadowDom;\n    this.shadowState_ = shadowState;\n\n    const target = this.targetBlock();\n    if (!target) {\n      this.respawnShadow_();\n      if (this.targetBlock() && this.targetBlock()!.isShadow()) {\n        this.serializeShadow_(this.targetBlock());\n      }\n    } else if (target.isShadow()) {\n      target.dispose(false);\n      this.respawnShadow_();\n      if (this.targetBlock() && this.targetBlock()!.isShadow()) {\n        this.serializeShadow_(this.targetBlock());\n      }\n    } else {\n      const shadow = this.createShadowBlock_(false);\n      this.serializeShadow_(shadow);\n      if (shadow) {\n        shadow.dispose(false);\n      }\n    }\n  }\n\n  /**\n   * Creates a shadow block based on the current shadowState_ or shadowDom_.\n   * shadowState_ gets priority.\n   *\n   * @param attemptToConnect Whether to try to connect the shadow block to this\n   *     connection or not.\n   * @returns The shadow block that was created, or null if both the\n   *     shadowState_ and shadowDom_ are null.\n   */\n  private createShadowBlock_(attemptToConnect: boolean): Block|null {\n    const parentBlock = this.getSourceBlock();\n    const shadowState = this.getShadowState();\n    const shadowDom = this.getShadowDom();\n    if (parentBlock.isDeadOrDying() || !shadowState && !shadowDom) {\n      return null;\n    }\n\n    let blockShadow;\n    if (shadowState) {\n      blockShadow = blocks.appendInternal(shadowState, parentBlock.workspace, {\n        parentConnection: attemptToConnect ? this : undefined,\n        isShadow: true,\n        recordUndo: false,\n      });\n      return blockShadow;\n    }\n\n    if (shadowDom) {\n      blockShadow = Xml.domToBlock(shadowDom, parentBlock.workspace);\n      if (attemptToConnect) {\n        if (this.type === ConnectionType.INPUT_VALUE) {\n          if (!blockShadow.outputConnection) {\n            throw new Error('Shadow block is missing an output connection');\n          }\n          if (!this.connect(blockShadow.outputConnection)) {\n            throw new Error('Could not connect shadow block to connection');\n          }\n        } else if (this.type === ConnectionType.NEXT_STATEMENT) {\n          if (!blockShadow.previousConnection) {\n            throw new Error('Shadow block is missing previous connection');\n          }\n          if (!this.connect(blockShadow.previousConnection)) {\n            throw new Error('Could not connect shadow block to connection');\n          }\n        } else {\n          throw new Error(\n              'Cannot connect a shadow block to a previous/output connection');\n        }\n      }\n      return blockShadow;\n    }\n    return null;\n  }\n\n  /**\n   * Saves the given shadow block to both the shadowDom_ and shadowState_\n   * properties, in their respective serialized forms.\n   *\n   * @param shadow The shadow to serialize, or null.\n   */\n  private serializeShadow_(shadow: Block|null) {\n    if (!shadow) {\n      return;\n    }\n    this.shadowDom_ = Xml.blockToDom(shadow) as Element;\n    this.shadowState_ = blocks.save(shadow);\n  }\n\n  /**\n   * Returns the connection (starting at the startBlock) which will accept\n   * the given connection. This includes compatible connection types and\n   * connection checks.\n   *\n   * @param startBlock The block on which to start the search.\n   * @param orphanConnection The connection that is looking for a home.\n   * @returns The suitable connection point on the chain of blocks, or null.\n   */\n  static getConnectionForOrphanedConnection(\n      startBlock: Block, orphanConnection: Connection): Connection|null {\n    if (orphanConnection.type === ConnectionType.OUTPUT_VALUE) {\n      return getConnectionForOrphanedOutput(\n          startBlock, orphanConnection.getSourceBlock());\n    }\n    // Otherwise we're dealing with a stack.\n    const connection = startBlock.lastConnectionInStack(true);\n    const checker = orphanConnection.getConnectionChecker();\n    if (connection && checker.canConnect(orphanConnection, connection, false)) {\n      return connection;\n    }\n    return null;\n  }\n}\n\n/**\n * Update two connections to target each other.\n *\n * @param first The first connection to update.\n * @param second The second connection to update.\n */\nfunction connectReciprocally(first: Connection, second: Connection) {\n  if (!first || !second) {\n    throw Error('Cannot connect null connections.');\n  }\n  first.targetConnection = second;\n  second.targetConnection = first;\n}\n/**\n * Returns the single connection on the block that will accept the orphaned\n * block, if one can be found. If the block has multiple compatible connections\n * (even if they are filled) this returns null. If the block has no compatible\n * connections, this returns null.\n *\n * @param block The superior block.\n * @param orphanBlock The inferior block.\n * @returns The suitable connection point on 'block', or null.\n */\nfunction getSingleConnection(block: Block, orphanBlock: Block): Connection|\n    null {\n  let foundConnection = null;\n  const output = orphanBlock.outputConnection;\n  const typeChecker = output.getConnectionChecker();\n\n  for (let i = 0, input; input = block.inputList[i]; i++) {\n    const connection = input.connection;\n    if (connection && typeChecker.canConnect(output, connection, false)) {\n      if (foundConnection) {\n        return null;  // More than one connection.\n      }\n      foundConnection = connection;\n    }\n  }\n  return foundConnection;\n}\n\n/**\n * Walks down a row a blocks, at each stage checking if there are any\n * connections that will accept the orphaned block.  If at any point there\n * are zero or multiple eligible connections, returns null.  Otherwise\n * returns the only input on the last block in the chain.\n * Terminates early for shadow blocks.\n *\n * @param startBlock The block on which to start the search.\n * @param orphanBlock The block that is looking for a home.\n * @returns The suitable connection point on the chain of blocks, or null.\n */\nfunction getConnectionForOrphanedOutput(\n    startBlock: Block, orphanBlock: Block): Connection|null {\n  let newBlock: Block|null = startBlock;\n  let connection;\n  while (connection = getSingleConnection(newBlock, orphanBlock)) {\n    newBlock = connection.targetBlock();\n    if (!newBlock || newBlock.isShadow()) {\n      return connection;\n    }\n  }\n  return null;\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The class representing an AST node.\n * Used to traverse the Blockly AST.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.ASTNode');\n\nimport type {Block} from '../block.js';\nimport type {Connection} from '../connection.js';\nimport {ConnectionType} from '../connection_type.js';\nimport type {Field} from '../field.js';\nimport type {Input} from '../input.js';\nimport type {IASTNodeLocation} from '../interfaces/i_ast_node_location.js';\nimport type {IASTNodeLocationWithBlock} from '../interfaces/i_ast_node_location_with_block.js';\nimport {Coordinate} from '../utils/coordinate.js';\nimport type {Workspace} from '../workspace.js';\n\n\n/**\n * Class for an AST node.\n * It is recommended that you use one of the createNode methods instead of\n * creating a node directly.\n *\n * @alias Blockly.ASTNode\n */\nexport class ASTNode {\n  /**\n   * True to navigate to all fields. False to only navigate to clickable fields.\n   */\n  static NAVIGATE_ALL_FIELDS = false;\n\n  /**\n   * The default y offset to use when moving the cursor from a stack to the\n   * workspace.\n   */\n  private static readonly DEFAULT_OFFSET_Y: number = -20;\n  private readonly type_: string;\n  private readonly isConnection_: boolean;\n  private readonly location_: IASTNodeLocation;\n\n  /** The coordinate on the workspace. */\n  // AnyDuringMigration because:  Type 'null' is not assignable to type\n  // 'Coordinate'.\n  private wsCoordinate_: Coordinate = null as AnyDuringMigration;\n\n  /**\n   * @param type The type of the location.\n   *     Must be in ASTNode.types.\n   * @param location The position in the AST.\n   * @param opt_params Optional dictionary of options.\n   * @alias Blockly.ASTNode\n   */\n  constructor(type: string, location: IASTNodeLocation, opt_params?: Params) {\n    if (!location) {\n      throw Error('Cannot create a node without a location.');\n    }\n\n    /**\n     * The type of the location.\n     * One of ASTNode.types\n     */\n    this.type_ = type;\n\n    /** Whether the location points to a connection. */\n    this.isConnection_ = ASTNode.isConnectionType_(type);\n\n    /** The location of the AST node. */\n    this.location_ = location;\n\n    this.processParams_(opt_params || null);\n  }\n\n  /**\n   * Parse the optional parameters.\n   *\n   * @param params The user specified parameters.\n   */\n  private processParams_(params: Params|null) {\n    if (!params) {\n      return;\n    }\n    if (params.wsCoordinate) {\n      this.wsCoordinate_ = params.wsCoordinate;\n    }\n  }\n\n  /**\n   * Gets the value pointed to by this node.\n   * It is the callers responsibility to check the node type to figure out what\n   * type of object they get back from this.\n   *\n   * @returns The current field, connection, workspace, or block the cursor is\n   *     on.\n   */\n  getLocation(): IASTNodeLocation {\n    return this.location_;\n  }\n\n  /**\n   * The type of the current location.\n   * One of ASTNode.types\n   *\n   * @returns The type of the location.\n   */\n  getType(): string {\n    return this.type_;\n  }\n\n  /**\n   * The coordinate on the workspace.\n   *\n   * @returns The workspace coordinate or null if the location is not a\n   *     workspace.\n   */\n  getWsCoordinate(): Coordinate {\n    return this.wsCoordinate_;\n  }\n\n  /**\n   * Whether the node points to a connection.\n   *\n   * @returns [description]\n   * @internal\n   */\n  isConnection(): boolean {\n    return this.isConnection_;\n  }\n\n  /**\n   * Given an input find the next editable field or an input with a non null\n   * connection in the same block. The current location must be an input\n   * connection.\n   *\n   * @returns The AST node holding the next field or connection or null if there\n   *     is no editable field or input connection after the given input.\n   */\n  private findNextForInput_(): ASTNode|null {\n    const location = this.location_ as Connection;\n    const parentInput = location.getParentInput();\n    const block = parentInput!.getSourceBlock();\n    // AnyDuringMigration because:  Argument of type 'Input | null' is not\n    // assignable to parameter of type 'Input'.\n    const curIdx = block!.inputList.indexOf(parentInput as AnyDuringMigration);\n    for (let i = curIdx + 1; i < block!.inputList.length; i++) {\n      const input = block!.inputList[i];\n      const fieldRow = input.fieldRow;\n      for (let j = 0; j < fieldRow.length; j++) {\n        const field = fieldRow[j];\n        if (field.isClickable() || ASTNode.NAVIGATE_ALL_FIELDS) {\n          return ASTNode.createFieldNode(field);\n        }\n      }\n      if (input.connection) {\n        return ASTNode.createInputNode(input);\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Given a field find the next editable field or an input with a non null\n   * connection in the same block. The current location must be a field.\n   *\n   * @returns The AST node pointing to the next field or connection or null if\n   *     there is no editable field or input connection after the given input.\n   */\n  private findNextForField_(): ASTNode|null {\n    const location = this.location_ as Field;\n    const input = location.getParentInput();\n    const block = location.getSourceBlock();\n    if (!block) {\n      throw new Error(\n          'The current AST location is not associated with a block');\n    }\n    const curIdx = block.inputList.indexOf((input));\n    let fieldIdx = input.fieldRow.indexOf(location) + 1;\n    for (let i = curIdx; i < block.inputList.length; i++) {\n      const newInput = block.inputList[i];\n      const fieldRow = newInput.fieldRow;\n      while (fieldIdx < fieldRow.length) {\n        if (fieldRow[fieldIdx].isClickable() || ASTNode.NAVIGATE_ALL_FIELDS) {\n          return ASTNode.createFieldNode(fieldRow[fieldIdx]);\n        }\n        fieldIdx++;\n      }\n      fieldIdx = 0;\n      if (newInput.connection) {\n        return ASTNode.createInputNode(newInput);\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Given an input find the previous editable field or an input with a non null\n   * connection in the same block. The current location must be an input\n   * connection.\n   *\n   * @returns The AST node holding the previous field or connection.\n   */\n  private findPrevForInput_(): ASTNode|null {\n    const location = this.location_ as Connection;\n    const parentInput = location.getParentInput();\n    const block = parentInput!.getSourceBlock();\n    // AnyDuringMigration because:  Argument of type 'Input | null' is not\n    // assignable to parameter of type 'Input'.\n    const curIdx = block!.inputList.indexOf(parentInput as AnyDuringMigration);\n    for (let i = curIdx; i >= 0; i--) {\n      const input = block!.inputList[i];\n      if (input.connection && input !== parentInput) {\n        return ASTNode.createInputNode(input);\n      }\n      const fieldRow = input.fieldRow;\n      for (let j = fieldRow.length - 1; j >= 0; j--) {\n        const field = fieldRow[j];\n        if (field.isClickable() || ASTNode.NAVIGATE_ALL_FIELDS) {\n          return ASTNode.createFieldNode(field);\n        }\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Given a field find the previous editable field or an input with a non null\n   * connection in the same block. The current location must be a field.\n   *\n   * @returns The AST node holding the previous input or field.\n   */\n  private findPrevForField_(): ASTNode|null {\n    const location = this.location_ as Field;\n    const parentInput = location.getParentInput();\n    const block = location.getSourceBlock();\n    if (!block) {\n      throw new Error(\n          'The current AST location is not associated with a block');\n    }\n    const curIdx = block.inputList.indexOf((parentInput));\n    let fieldIdx = parentInput.fieldRow.indexOf(location) - 1;\n    for (let i = curIdx; i >= 0; i--) {\n      const input = block.inputList[i];\n      if (input.connection && input !== parentInput) {\n        return ASTNode.createInputNode(input);\n      }\n      const fieldRow = input.fieldRow;\n      while (fieldIdx > -1) {\n        if (fieldRow[fieldIdx].isClickable() || ASTNode.NAVIGATE_ALL_FIELDS) {\n          return ASTNode.createFieldNode(fieldRow[fieldIdx]);\n        }\n        fieldIdx--;\n      }\n      // Reset the fieldIdx to the length of the field row of the previous\n      // input.\n      if (i - 1 >= 0) {\n        fieldIdx = block.inputList[i - 1].fieldRow.length - 1;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Navigate between stacks of blocks on the workspace.\n   *\n   * @param forward True to go forward. False to go backwards.\n   * @returns The first block of the next stack or null if there are no blocks\n   *     on the workspace.\n   */\n  private navigateBetweenStacks_(forward: boolean): ASTNode|null {\n    let curLocation = this.getLocation();\n    // TODO(#6097): Use instanceof checks to exit early for values of\n    // curLocation that don't make sense.\n    if ((curLocation as IASTNodeLocationWithBlock).getSourceBlock) {\n      const block = (curLocation as IASTNodeLocationWithBlock).getSourceBlock();\n      if (block) {\n        curLocation = block;\n      }\n    }\n    // TODO(#6097): Use instanceof checks to exit early for values of\n    // curLocation that don't make sense.\n    const curLocationAsBlock = curLocation as Block;\n    if (!curLocationAsBlock || curLocationAsBlock.isDeadOrDying()) {\n      return null;\n    }\n    const curRoot = curLocationAsBlock.getRootBlock();\n    const topBlocks = curRoot.workspace.getTopBlocks(true);\n    for (let i = 0; i < topBlocks.length; i++) {\n      const topBlock = topBlocks[i];\n      if (curRoot.id === topBlock.id) {\n        const offset = forward ? 1 : -1;\n        const resultIndex = i + offset;\n        if (resultIndex === -1 || resultIndex === topBlocks.length) {\n          return null;\n        }\n        return ASTNode.createStackNode(topBlocks[resultIndex]);\n      }\n    }\n    throw Error(\n        'Couldn\\'t find ' + (forward ? 'next' : 'previous') + ' stack?!');\n  }\n\n  /**\n   * Finds the top most AST node for a given block.\n   * This is either the previous connection, output connection or block\n   * depending on what kind of connections the block has.\n   *\n   * @param block The block that we want to find the top connection on.\n   * @returns The AST node containing the top connection.\n   */\n  private findTopASTNodeForBlock_(block: Block): ASTNode|null {\n    const topConnection = getParentConnection(block);\n    if (topConnection) {\n      return ASTNode.createConnectionNode(topConnection);\n    } else {\n      return ASTNode.createBlockNode(block);\n    }\n  }\n\n  /**\n   * Get the AST node pointing to the input that the block is nested under or if\n   * the block is not nested then get the stack AST node.\n   *\n   * @param block The source block of the current location.\n   * @returns The AST node pointing to the input connection or the top block of\n   *     the stack this block is in.\n   */\n  private getOutAstNodeForBlock_(block: Block): ASTNode|null {\n    if (!block) {\n      return null;\n    }\n    // If the block doesn't have a previous connection then it is the top of the\n    // substack.\n    const topBlock = block.getTopStackBlock();\n    const topConnection = getParentConnection(topBlock);\n    // If the top connection has a parentInput, create an AST node pointing to\n    // that input.\n    if (topConnection && topConnection.targetConnection &&\n        topConnection.targetConnection.getParentInput()) {\n      // AnyDuringMigration because:  Argument of type 'Input | null' is not\n      // assignable to parameter of type 'Input'.\n      return ASTNode.createInputNode(\n          topConnection.targetConnection.getParentInput() as\n          AnyDuringMigration);\n    } else {\n      // Go to stack level if you are not underneath an input.\n      return ASTNode.createStackNode(topBlock);\n    }\n  }\n\n  /**\n   * Find the first editable field or input with a connection on a given block.\n   *\n   * @param block The source block of the current location.\n   * @returns An AST node pointing to the first field or input.\n   * Null if there are no editable fields or inputs with connections on the\n   * block.\n   */\n  private findFirstFieldOrInput_(block: Block): ASTNode|null {\n    const inputs = block.inputList;\n    for (let i = 0; i < inputs.length; i++) {\n      const input = inputs[i];\n      const fieldRow = input.fieldRow;\n      for (let j = 0; j < fieldRow.length; j++) {\n        const field = fieldRow[j];\n        if (field.isClickable() || ASTNode.NAVIGATE_ALL_FIELDS) {\n          return ASTNode.createFieldNode(field);\n        }\n      }\n      if (input.connection) {\n        return ASTNode.createInputNode(input);\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Finds the source block of the location of this node.\n   *\n   * @returns The source block of the location, or null if the node is of type\n   *     workspace.\n   */\n  getSourceBlock(): Block|null {\n    if (this.getType() === ASTNode.types.BLOCK) {\n      return this.getLocation() as Block;\n    } else if (this.getType() === ASTNode.types.STACK) {\n      return this.getLocation() as Block;\n    } else if (this.getType() === ASTNode.types.WORKSPACE) {\n      return null;\n    } else {\n      return (this.getLocation() as IASTNodeLocationWithBlock).getSourceBlock();\n    }\n  }\n\n  /**\n   * Find the element to the right of the current element in the AST.\n   *\n   * @returns An AST node that wraps the next field, connection, block, or\n   *     workspace. Or null if there is no node to the right.\n   */\n  next(): ASTNode|null {\n    switch (this.type_) {\n      case ASTNode.types.STACK:\n        return this.navigateBetweenStacks_(true);\n\n      case ASTNode.types.OUTPUT: {\n        const connection = this.location_ as Connection;\n        return ASTNode.createBlockNode(connection.getSourceBlock());\n      }\n      case ASTNode.types.FIELD:\n        return this.findNextForField_();\n\n      case ASTNode.types.INPUT:\n        return this.findNextForInput_();\n\n      case ASTNode.types.BLOCK: {\n        const block = this.location_ as Block;\n        const nextConnection = block.nextConnection;\n        return ASTNode.createConnectionNode(nextConnection);\n      }\n      case ASTNode.types.PREVIOUS: {\n        const connection = this.location_ as Connection;\n        return ASTNode.createBlockNode(connection.getSourceBlock());\n      }\n      case ASTNode.types.NEXT: {\n        const connection = this.location_ as Connection;\n        const targetConnection = connection.targetConnection;\n        return ASTNode.createConnectionNode(targetConnection!);\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * Find the element one level below and all the way to the left of the current\n   * location.\n   *\n   * @returns An AST node that wraps the next field, connection, workspace, or\n   *     block. Or null if there is nothing below this node.\n   */\n  in(): ASTNode|null {\n    switch (this.type_) {\n      case ASTNode.types.WORKSPACE: {\n        const workspace = this.location_ as Workspace;\n        const topBlocks = workspace.getTopBlocks(true);\n        if (topBlocks.length > 0) {\n          return ASTNode.createStackNode(topBlocks[0]);\n        }\n        break;\n      }\n      case ASTNode.types.STACK: {\n        const block = this.location_ as Block;\n        return this.findTopASTNodeForBlock_(block);\n      }\n      case ASTNode.types.BLOCK: {\n        const block = this.location_ as Block;\n        return this.findFirstFieldOrInput_(block);\n      }\n      case ASTNode.types.INPUT: {\n        const connection = this.location_ as Connection;\n        const targetConnection = connection.targetConnection;\n        return ASTNode.createConnectionNode(targetConnection!);\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * Find the element to the left of the current element in the AST.\n   *\n   * @returns An AST node that wraps the previous field, connection, workspace\n   *     or block. Or null if no node exists to the left. null.\n   */\n  prev(): ASTNode|null {\n    switch (this.type_) {\n      case ASTNode.types.STACK:\n        return this.navigateBetweenStacks_(false);\n\n      case ASTNode.types.OUTPUT:\n        return null;\n\n      case ASTNode.types.FIELD:\n        return this.findPrevForField_();\n\n      case ASTNode.types.INPUT:\n        return this.findPrevForInput_();\n\n      case ASTNode.types.BLOCK: {\n        const block = this.location_ as Block;\n        const topConnection = getParentConnection(block);\n        return ASTNode.createConnectionNode(topConnection);\n      }\n      case ASTNode.types.PREVIOUS: {\n        const connection = this.location_ as Connection;\n        const targetConnection = connection.targetConnection;\n        if (targetConnection && !targetConnection.getParentInput()) {\n          return ASTNode.createConnectionNode(targetConnection);\n        }\n        break;\n      }\n      case ASTNode.types.NEXT: {\n        const connection = this.location_ as Connection;\n        return ASTNode.createBlockNode(connection.getSourceBlock());\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * Find the next element that is one position above and all the way to the\n   * left of the current location.\n   *\n   * @returns An AST node that wraps the next field, connection, workspace or\n   *     block. Or null if we are at the workspace level.\n   */\n  out(): ASTNode|null {\n    switch (this.type_) {\n      case ASTNode.types.STACK: {\n        const block = this.location_ as Block;\n        const blockPos = block.getRelativeToSurfaceXY();\n        // TODO: Make sure this is in the bounds of the workspace.\n        const wsCoordinate =\n            new Coordinate(blockPos.x, blockPos.y + ASTNode.DEFAULT_OFFSET_Y);\n        return ASTNode.createWorkspaceNode(block.workspace, wsCoordinate);\n      }\n      case ASTNode.types.OUTPUT: {\n        const connection = this.location_ as Connection;\n        const target = connection.targetConnection;\n        if (target) {\n          return ASTNode.createConnectionNode(target);\n        }\n        return ASTNode.createStackNode(connection.getSourceBlock());\n      }\n      case ASTNode.types.FIELD: {\n        const field = this.location_ as Field;\n        const block = field.getSourceBlock();\n        if (!block) {\n          throw new Error(\n              'The current AST location is not associated with a block');\n        }\n        return ASTNode.createBlockNode(block);\n      }\n      case ASTNode.types.INPUT: {\n        const connection = this.location_ as Connection;\n        return ASTNode.createBlockNode(connection.getSourceBlock());\n      }\n      case ASTNode.types.BLOCK: {\n        const block = this.location_ as Block;\n        return this.getOutAstNodeForBlock_(block);\n      }\n      case ASTNode.types.PREVIOUS: {\n        const connection = this.location_ as Connection;\n        return this.getOutAstNodeForBlock_(connection.getSourceBlock());\n      }\n      case ASTNode.types.NEXT: {\n        const connection = this.location_ as Connection;\n        return this.getOutAstNodeForBlock_(connection.getSourceBlock());\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * Whether an AST node of the given type points to a connection.\n   *\n   * @param type The type to check.  One of ASTNode.types.\n   * @returns True if a node of the given type points to a connection.\n   */\n  private static isConnectionType_(type: string): boolean {\n    switch (type) {\n      case ASTNode.types.PREVIOUS:\n      case ASTNode.types.NEXT:\n      case ASTNode.types.INPUT:\n      case ASTNode.types.OUTPUT:\n        return true;\n    }\n    return false;\n  }\n\n  /**\n   * Create an AST node pointing to a field.\n   *\n   * @param field The location of the AST node.\n   * @returns An AST node pointing to a field.\n   */\n  static createFieldNode(field: Field): ASTNode|null {\n    if (!field) {\n      return null;\n    }\n    return new ASTNode(ASTNode.types.FIELD, field);\n  }\n\n  /**\n   * Creates an AST node pointing to a connection. If the connection has a\n   * parent input then create an AST node of type input that will hold the\n   * connection.\n   *\n   * @param connection This is the connection the node will point to.\n   * @returns An AST node pointing to a connection.\n   */\n  static createConnectionNode(connection: Connection): ASTNode|null {\n    if (!connection) {\n      return null;\n    }\n    const type = connection.type;\n    if (type === ConnectionType.INPUT_VALUE) {\n      // AnyDuringMigration because:  Argument of type 'Input | null' is not\n      // assignable to parameter of type 'Input'.\n      return ASTNode.createInputNode(\n          connection.getParentInput() as AnyDuringMigration);\n    } else if (\n        type === ConnectionType.NEXT_STATEMENT && connection.getParentInput()) {\n      // AnyDuringMigration because:  Argument of type 'Input | null' is not\n      // assignable to parameter of type 'Input'.\n      return ASTNode.createInputNode(\n          connection.getParentInput() as AnyDuringMigration);\n    } else if (type === ConnectionType.NEXT_STATEMENT) {\n      return new ASTNode(ASTNode.types.NEXT, connection);\n    } else if (type === ConnectionType.OUTPUT_VALUE) {\n      return new ASTNode(ASTNode.types.OUTPUT, connection);\n    } else if (type === ConnectionType.PREVIOUS_STATEMENT) {\n      return new ASTNode(ASTNode.types.PREVIOUS, connection);\n    }\n    return null;\n  }\n\n  /**\n   * Creates an AST node pointing to an input. Stores the input connection as\n   * the location.\n   *\n   * @param input The input used to create an AST node.\n   * @returns An AST node pointing to a input.\n   */\n  static createInputNode(input: Input): ASTNode|null {\n    if (!input || !input.connection) {\n      return null;\n    }\n    return new ASTNode(ASTNode.types.INPUT, input.connection);\n  }\n\n  /**\n   * Creates an AST node pointing to a block.\n   *\n   * @param block The block used to create an AST node.\n   * @returns An AST node pointing to a block.\n   */\n  static createBlockNode(block: Block): ASTNode|null {\n    if (!block) {\n      return null;\n    }\n    return new ASTNode(ASTNode.types.BLOCK, block);\n  }\n\n  /**\n   * Create an AST node of type stack. A stack, represented by its top block, is\n   *     the set of all blocks connected to a top block, including the top\n   * block.\n   *\n   * @param topBlock A top block has no parent and can be found in the list\n   *     returned by workspace.getTopBlocks().\n   * @returns An AST node of type stack that points to the top block on the\n   *     stack.\n   */\n  static createStackNode(topBlock: Block): ASTNode|null {\n    if (!topBlock) {\n      return null;\n    }\n    return new ASTNode(ASTNode.types.STACK, topBlock);\n  }\n\n  /**\n   * Creates an AST node pointing to a workspace.\n   *\n   * @param workspace The workspace that we are on.\n   * @param wsCoordinate The position on the workspace for this node.\n   * @returns An AST node pointing to a workspace and a position on the\n   *     workspace.\n   */\n  static createWorkspaceNode(\n      workspace: Workspace|null, wsCoordinate: Coordinate|null): ASTNode|null {\n    if (!wsCoordinate || !workspace) {\n      return null;\n    }\n    const params = {wsCoordinate};\n    return new ASTNode(ASTNode.types.WORKSPACE, workspace, params);\n  }\n\n  /**\n   * Creates an AST node for the top position on a block.\n   * This is either an output connection, previous connection, or block.\n   *\n   * @param block The block to find the top most AST node on.\n   * @returns The AST node holding the top most position on the block.\n   */\n  static createTopNode(block: Block): ASTNode|null {\n    let astNode;\n    const topConnection = getParentConnection(block);\n    if (topConnection) {\n      astNode = ASTNode.createConnectionNode(topConnection);\n    } else {\n      astNode = ASTNode.createBlockNode(block);\n    }\n    return astNode;\n  }\n}\n\nexport namespace ASTNode {\n  export interface Params {\n    wsCoordinate: Coordinate;\n  }\n\n  export enum types {\n    FIELD = 'field',\n    BLOCK = 'block',\n    INPUT = 'input',\n    OUTPUT = 'output',\n    NEXT = 'next',\n    PREVIOUS = 'previous',\n    STACK = 'stack',\n    WORKSPACE = 'workspace',\n  }\n}\n\nexport type Params = ASTNode.Params;\n// No need to export ASTNode.types from the module at this time because (1) it\n// wasn't automatically converted by the automatic migration script, (2) the\n// name doesn't follow the styleguide.\n\n\n/**\n * Gets the parent connection on a block.\n * This is either an output connection, previous connection or undefined.\n * If both connections exist return the one that is actually connected\n * to another block.\n *\n * @param block The block to find the parent connection on.\n * @returns The connection connecting to the parent of the block.\n */\nfunction getParentConnection(block: Block): Connection {\n  let topConnection = block.outputConnection;\n  if (!topConnection ||\n      block.previousConnection && block.previousConnection.isConnected()) {\n    topConnection = block.previousConnection;\n  }\n  return topConnection;\n}\n","/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Methods animating a block on connection and disconnection.\n *\n * @namespace Blockly.blockAnimations\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockAnimations');\n\nimport type {BlockSvg} from './block_svg.js';\nimport * as dom from './utils/dom.js';\nimport {Svg} from './utils/svg.js';\n\n\n/** A bounding box for a cloned block. */\ninterface CloneRect {\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n}\n\n/** PID of disconnect UI animation.  There can only be one at a time. */\nlet disconnectPid: ReturnType<typeof setTimeout>|null = null;\n\n/** SVG group of wobbling block.  There can only be one at a time. */\nlet disconnectGroup: SVGElement|null = null;\n\n\n/**\n * Play some UI effects (sound, animation) when disposing of a block.\n *\n * @param block The block being disposed of.\n * @alias Blockly.blockAnimations.disposeUiEffect\n * @internal\n */\nexport function disposeUiEffect(block: BlockSvg) {\n  const workspace = block.workspace;\n  const svgGroup = block.getSvgRoot();\n  workspace.getAudioManager().play('delete');\n\n  const xy = workspace.getSvgXY(svgGroup);\n  // Deeply clone the current block.\n  const clone: SVGGElement = svgGroup.cloneNode(true) as SVGGElement;\n  clone.setAttribute('transform', 'translate(' + xy.x + ',' + xy.y + ')');\n  workspace.getParentSvg().appendChild(clone);\n  const cloneRect =\n      {'x': xy.x, 'y': xy.y, 'width': block.width, 'height': block.height};\n  disposeUiStep(clone, cloneRect, workspace.RTL, new Date(), workspace.scale);\n}\n/**\n * Animate a cloned block and eventually dispose of it.\n * This is a class method, not an instance method since the original block has\n * been destroyed and is no longer accessible.\n *\n * @param clone SVG element to animate and dispose of.\n * @param rect Starting rect of the clone.\n * @param rtl True if RTL, false if LTR.\n * @param start Date of animation's start.\n * @param workspaceScale Scale of workspace.\n */\nfunction disposeUiStep(\n    clone: Element, rect: CloneRect, rtl: boolean, start: Date,\n    workspaceScale: number) {\n  const ms = new Date().getTime() - start.getTime();\n  const percent = ms / 150;\n  if (percent > 1) {\n    dom.removeNode(clone);\n  } else {\n    const x =\n        rect.x + (rtl ? -1 : 1) * rect.width * workspaceScale / 2 * percent;\n    const y = rect.y + rect.height * workspaceScale * percent;\n    const scale = (1 - percent) * workspaceScale;\n    clone.setAttribute(\n        'transform',\n        'translate(' + x + ',' + y + ')' +\n            ' scale(' + scale + ')');\n    setTimeout(disposeUiStep, 10, clone, rect, rtl, start, workspaceScale);\n  }\n}\n\n/**\n * Play some UI effects (sound, ripple) after a connection has been established.\n *\n * @param block The block being connected.\n * @alias Blockly.blockAnimations.connectionUiEffect\n * @internal\n */\nexport function connectionUiEffect(block: BlockSvg) {\n  const workspace = block.workspace;\n  const scale = workspace.scale;\n  workspace.getAudioManager().play('click');\n  if (scale < 1) {\n    return;  // Too small to care about visual effects.\n  }\n  // Determine the absolute coordinates of the inferior block.\n  const xy = workspace.getSvgXY(block.getSvgRoot());\n  // Offset the coordinates based on the two connection types, fix scale.\n  if (block.outputConnection) {\n    xy.x += (block.RTL ? 3 : -3) * scale;\n    xy.y += 13 * scale;\n  } else if (block.previousConnection) {\n    xy.x += (block.RTL ? -23 : 23) * scale;\n    xy.y += 3 * scale;\n  }\n  const ripple = dom.createSvgElement(\n      Svg.CIRCLE, {\n        'cx': xy.x,\n        'cy': xy.y,\n        'r': 0,\n        'fill': 'none',\n        'stroke': '#888',\n        'stroke-width': 10,\n      },\n      workspace.getParentSvg());\n  // Start the animation.\n  connectionUiStep(ripple, new Date(), scale);\n}\n\n/**\n * Expand a ripple around a connection.\n *\n * @param ripple Element to animate.\n * @param start Date of animation's start.\n * @param scale Scale of workspace.\n */\nfunction connectionUiStep(ripple: SVGElement, start: Date, scale: number) {\n  const ms = new Date().getTime() - start.getTime();\n  const percent = ms / 150;\n  if (percent > 1) {\n    dom.removeNode(ripple);\n  } else {\n    ripple.setAttribute('r', (percent * 25 * scale).toString());\n    ripple.style.opacity = (1 - percent).toString();\n    disconnectPid = setTimeout(connectionUiStep, 10, ripple, start, scale);\n  }\n}\n\n/**\n * Play some UI effects (sound, animation) when disconnecting a block.\n *\n * @param block The block being disconnected.\n * @alias Blockly.blockAnimations.disconnectUiEffect\n * @internal\n */\nexport function disconnectUiEffect(block: BlockSvg) {\n  disconnectUiStop();\n  block.workspace.getAudioManager().play('disconnect');\n  if (block.workspace.scale < 1) {\n    return;  // Too small to care about visual effects.\n  }\n  // Horizontal distance for bottom of block to wiggle.\n  const DISPLACEMENT = 10;\n  // Scale magnitude of skew to height of block.\n  const height = block.getHeightWidth().height;\n  let magnitude = Math.atan(DISPLACEMENT / height) / Math.PI * 180;\n  if (!block.RTL) {\n    magnitude *= -1;\n  }\n  // Start the animation.\n  disconnectGroup = block.getSvgRoot();\n  disconnectUiStep(disconnectGroup, magnitude, new Date());\n}\n\n/**\n * Animate a brief wiggle of a disconnected block.\n *\n * @param group SVG element to animate.\n * @param magnitude Maximum degrees skew (reversed for RTL).\n * @param start Date of animation's start.\n */\nfunction disconnectUiStep(group: SVGElement, magnitude: number, start: Date) {\n  const DURATION = 200;  // Milliseconds.\n  const WIGGLES = 3;     // Half oscillations.\n\n  const ms = new Date().getTime() - start.getTime();\n  const percent = ms / DURATION;\n\n  let skew = '';\n  if (percent <= 1) {\n    const val = Math.round(\n        Math.sin(percent * Math.PI * WIGGLES) * (1 - percent) * magnitude);\n    skew = `skewX(${val})`;\n    disconnectPid = setTimeout(disconnectUiStep, 10, group, magnitude, start);\n  }\n  (group as AnyDuringMigration).skew_ = skew;\n  group.setAttribute(\n      'transform',\n      (group as AnyDuringMigration).translate_ +\n          (group as AnyDuringMigration).skew_);\n}\n\n/**\n * Stop the disconnect UI animation immediately.\n *\n * @alias Blockly.blockAnimations.disconnectUiStop\n * @internal\n */\nexport function disconnectUiStop() {\n  if (disconnectGroup) {\n    if (disconnectPid) {\n      clearTimeout(disconnectPid);\n    }\n    const group = disconnectGroup;\n    (group as AnyDuringMigration).skew_ = '';\n    group.setAttribute('transform', (group as AnyDuringMigration).translate_);\n    disconnectGroup = null;\n  }\n}\n","/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Blockly's internal clipboard for managing copy-paste.\n *\n * @namespace Blockly.clipboard\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.clipboard');\n\nimport type {CopyData, ICopyable} from './interfaces/i_copyable.js';\n\n\n/** Metadata about the object that is currently on the clipboard. */\nlet copyData: CopyData|null = null;\n\n/**\n * Copy a block or workspace comment onto the local clipboard.\n *\n * @param toCopy Block or Workspace Comment to be copied.\n * @alias Blockly.clipboard.copy\n * @internal\n */\nexport function copy(toCopy: ICopyable) {\n  TEST_ONLY.copyInternal(toCopy);\n}\n\n/**\n * Private version of copy for stubbing in tests.\n */\nfunction copyInternal(toCopy: ICopyable) {\n  copyData = toCopy.toCopyData();\n}\n\n/**\n * Paste a block or workspace comment on to the main workspace.\n *\n * @returns The pasted thing if the paste was successful, null otherwise.\n * @alias Blockly.clipboard.paste\n * @internal\n */\nexport function paste(): ICopyable|null {\n  if (!copyData) {\n    return null;\n  }\n  // Pasting always pastes to the main workspace, even if the copy\n  // started in a flyout workspace.\n  let workspace = copyData.source;\n  if (workspace.isFlyout) {\n    workspace = workspace.targetWorkspace!;\n  }\n  if (copyData.typeCounts &&\n      workspace.isCapacityAvailable(copyData.typeCounts)) {\n    return workspace.paste(copyData.saveInfo);\n  }\n  return null;\n}\n\n/**\n * Duplicate this block and its children, or a workspace comment.\n *\n * @param toDuplicate Block or Workspace Comment to be duplicated.\n * @returns The block or workspace comment that was duplicated, or null if the\n *     duplication failed.\n * @alias Blockly.clipboard.duplicate\n * @internal\n */\nexport function duplicate(toDuplicate: ICopyable): ICopyable|null {\n  return TEST_ONLY.duplicateInternal(toDuplicate);\n}\n\n/**\n * Private version of duplicate for stubbing in tests.\n */\nfunction duplicateInternal(toDuplicate: ICopyable): ICopyable|null {\n  const oldCopyData = copyData;\n  copy(toDuplicate);\n  const pastedThing =\n      toDuplicate.toCopyData()?.source?.paste(copyData!.saveInfo) ?? null;\n  copyData = oldCopyData;\n  return pastedThing;\n}\n\nexport const TEST_ONLY = {\n  duplicateInternal,\n  copyInternal,\n};\n","/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Functionality for the right-click context menus.\n *\n * @namespace Blockly.ContextMenu\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.ContextMenu');\n\nimport type {Block} from './block.js';\nimport type {BlockSvg} from './block_svg.js';\nimport * as browserEvents from './browser_events.js';\nimport * as clipboard from './clipboard.js';\nimport {config} from './config.js';\nimport * as dom from './utils/dom.js';\nimport type {ContextMenuOption, LegacyContextMenuOption} from './contextmenu_registry.js';\nimport * as eventUtils from './events/utils.js';\nimport {Menu} from './menu.js';\nimport {MenuItem} from './menuitem.js';\nimport {Msg} from './msg.js';\nimport * as aria from './utils/aria.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport {Rect} from './utils/rect.js';\nimport * as svgMath from './utils/svg_math.js';\nimport * as WidgetDiv from './widgetdiv.js';\nimport {WorkspaceCommentSvg} from './workspace_comment_svg.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\nimport * as Xml from './xml.js';\n\n\n/**\n * Which block is the context menu attached to?\n */\nlet currentBlock: Block|null = null;\n\nconst dummyOwner = {};\n\n/**\n * Gets the block the context menu is currently attached to.\n *\n * @returns The block the context menu is attached to.\n * @alias Blockly.ContextMenu.getCurrentBlock\n */\nexport function getCurrentBlock(): Block|null {\n  return currentBlock;\n}\n\n/**\n * Sets the block the context menu is currently attached to.\n *\n * @param block The block the context menu is attached to.\n * @alias Blockly.ContextMenu.setCurrentBlock\n */\nexport function setCurrentBlock(block: Block|null) {\n  currentBlock = block;\n}\n\n/**\n * Menu object.\n */\nlet menu_: Menu|null = null;\n\n/**\n * Construct the menu based on the list of options and show the menu.\n *\n * @param e Mouse event.\n * @param options Array of menu options.\n * @param rtl True if RTL, false if LTR.\n * @alias Blockly.ContextMenu.show\n */\nexport function show(\n    e: Event, options: (ContextMenuOption|LegacyContextMenuOption)[],\n    rtl: boolean) {\n  WidgetDiv.show(dummyOwner, rtl, dispose);\n  if (!options.length) {\n    hide();\n    return;\n  }\n  const menu = populate_(options, rtl);\n  menu_ = menu;\n\n  position_(menu, e, rtl);\n  // 1ms delay is required for focusing on context menus because some other\n  // mouse event is still waiting in the queue and clears focus.\n  setTimeout(function() {\n    menu.focus();\n  }, 1);\n  currentBlock = null;  // May be set by Blockly.Block.\n}\n\n/**\n * Create the context menu object and populate it with the given options.\n *\n * @param options Array of menu options.\n * @param rtl True if RTL, false if LTR.\n * @returns The menu that will be shown on right click.\n */\nfunction populate_(\n    options: (ContextMenuOption|LegacyContextMenuOption)[],\n    rtl: boolean): Menu {\n  /* Here's what one option object looks like:\n      {text: 'Make It So',\n       enabled: true,\n       callback: Blockly.MakeItSo}\n    */\n  const menu = new Menu();\n  menu.setRole(aria.Role.MENU);\n  for (let i = 0; i < options.length; i++) {\n    const option = options[i];\n    const menuItem = new MenuItem(option.text);\n    menuItem.setRightToLeft(rtl);\n    menuItem.setRole(aria.Role.MENUITEM);\n    menu.addChild(menuItem);\n    menuItem.setEnabled(option.enabled);\n    if (option.enabled) {\n      const actionHandler = function() {\n        hide();\n        // If .scope does not exist on the option, then the callback will not\n        // be expecting a scope parameter, so there should be no problems. Just\n        // assume it is a ContextMenuOption and we'll pass undefined if it's\n        // not.\n        option.callback((option as ContextMenuOption).scope);\n      };\n      menuItem.onAction(actionHandler, {});\n    }\n  }\n  return menu;\n}\n\n/**\n * Add the menu to the page and position it correctly.\n *\n * @param menu The menu to add and position.\n * @param e Mouse event for the right click that is making the context\n *     menu appear.\n * @param rtl True if RTL, false if LTR.\n */\nfunction position_(menu: Menu, e: Event, rtl: boolean) {\n  // Record windowSize and scrollOffset before adding menu.\n  const viewportBBox = svgMath.getViewportBBox();\n  const mouseEvent = e as MouseEvent;\n  // This one is just a point, but we'll pretend that it's a rect so we can use\n  // some helper functions.\n  const anchorBBox = new Rect(\n      mouseEvent.clientY + viewportBBox.top,\n      mouseEvent.clientY + viewportBBox.top,\n      mouseEvent.clientX + viewportBBox.left,\n      mouseEvent.clientX + viewportBBox.left);\n\n  createWidget_(menu);\n  const menuSize = menu.getSize();\n\n  if (rtl) {\n    anchorBBox.left += menuSize.width;\n    anchorBBox.right += menuSize.width;\n    viewportBBox.left += menuSize.width;\n    viewportBBox.right += menuSize.width;\n  }\n\n  WidgetDiv.positionWithAnchor(viewportBBox, anchorBBox, menuSize, rtl);\n  // Calling menuDom.focus() has to wait until after the menu has been placed\n  // correctly.  Otherwise it will cause a page scroll to get the misplaced menu\n  // in view.  See issue #1329.\n  menu.focus();\n}\n\n/**\n * Create and render the menu widget inside Blockly's widget div.\n *\n * @param menu The menu to add to the widget div.\n */\nfunction createWidget_(menu: Menu) {\n  const div = WidgetDiv.getDiv();\n  if (!div) {\n    throw Error('Attempting to create a context menu when widget div is null');\n  }\n  const menuDom = menu.render(div);\n  dom.addClass(menuDom, 'blocklyContextMenu');\n  // Prevent system context menu when right-clicking a Blockly context menu.\n  browserEvents.conditionalBind(\n      (menuDom as EventTarget), 'contextmenu', null, haltPropagation);\n  // Focus only after the initial render to avoid issue #1329.\n  menu.focus();\n}\n/**\n * Halts the propagation of the event without doing anything else.\n *\n * @param e An event.\n */\nfunction haltPropagation(e: Event) {\n  // This event has been handled.  No need to bubble up to the document.\n  e.preventDefault();\n  e.stopPropagation();\n}\n\n/**\n * Hide the context menu.\n *\n * @alias Blockly.ContextMenu.hide\n */\nexport function hide() {\n  WidgetDiv.hideIfOwner(dummyOwner);\n  currentBlock = null;\n}\n\n/**\n * Dispose of the menu.\n *\n * @alias Blockly.ContextMenu.dispose\n */\nexport function dispose() {\n  if (menu_) {\n    menu_.dispose();\n    menu_ = null;\n  }\n}\n\n/**\n * Create a callback function that creates and configures a block,\n *   then places the new block next to the original.\n *\n * @param block Original block.\n * @param xml XML representation of new block.\n * @returns Function that creates a block.\n * @alias Blockly.ContextMenu.callbackFactory\n */\nexport function callbackFactory(block: Block, xml: Element): Function {\n  return () => {\n    eventUtils.disable();\n    let newBlock;\n    try {\n      newBlock = Xml.domToBlock(xml, block.workspace!) as BlockSvg;\n      // Move the new block next to the old block.\n      const xy = block.getRelativeToSurfaceXY();\n      if (block.RTL) {\n        xy.x -= config.snapRadius;\n      } else {\n        xy.x += config.snapRadius;\n      }\n      xy.y += config.snapRadius * 2;\n      newBlock.moveBy(xy.x, xy.y);\n    } finally {\n      eventUtils.enable();\n    }\n    if (eventUtils.isEnabled() && !newBlock.isShadow()) {\n      eventUtils.fire(new (eventUtils.get(eventUtils.BLOCK_CREATE))(newBlock));\n    }\n    newBlock.select();\n  };\n}\n\n// Helper functions for creating context menu options.\n\n/**\n * Make a context menu option for deleting the current workspace comment.\n *\n * @param comment The workspace comment where the\n *     right-click originated.\n * @returns A menu option,\n *     containing text, enabled, and a callback.\n * @alias Blockly.ContextMenu.commentDeleteOption\n * @internal\n */\nexport function commentDeleteOption(comment: WorkspaceCommentSvg):\n    LegacyContextMenuOption {\n  const deleteOption = {\n    text: Msg['REMOVE_COMMENT'],\n    enabled: true,\n    callback: function() {\n      eventUtils.setGroup(true);\n      comment.dispose();\n      eventUtils.setGroup(false);\n    },\n  };\n  return deleteOption;\n}\n\n/**\n * Make a context menu option for duplicating the current workspace comment.\n *\n * @param comment The workspace comment where the\n *     right-click originated.\n * @returns A menu option,\n *     containing text, enabled, and a callback.\n * @alias Blockly.ContextMenu.commentDuplicateOption\n * @internal\n */\nexport function commentDuplicateOption(comment: WorkspaceCommentSvg):\n    LegacyContextMenuOption {\n  const duplicateOption = {\n    text: Msg['DUPLICATE_COMMENT'],\n    enabled: true,\n    callback: function() {\n      clipboard.duplicate(comment);\n    },\n  };\n  return duplicateOption;\n}\n\n/**\n * Make a context menu option for adding a comment on the workspace.\n *\n * @param ws The workspace where the right-click\n *     originated.\n * @param e The right-click mouse event.\n * @returns A menu option, containing text, enabled, and a callback.\n * @suppress {strictModuleDepCheck,checkTypes} Suppress checks while workspace\n *     comments are not bundled in.\n * @alias Blockly.ContextMenu.workspaceCommentOption\n * @internal\n */\nexport function workspaceCommentOption(\n    ws: WorkspaceSvg, e: Event): ContextMenuOption {\n  /**\n   * Helper function to create and position a comment correctly based on the\n   * location of the mouse event.\n   */\n  function addWsComment() {\n    const comment = new WorkspaceCommentSvg(\n        ws, Msg['WORKSPACE_COMMENT_DEFAULT_TEXT'],\n        WorkspaceCommentSvg.DEFAULT_SIZE, WorkspaceCommentSvg.DEFAULT_SIZE);\n\n    const injectionDiv = ws.getInjectionDiv();\n    // Bounding rect coordinates are in client coordinates, meaning that they\n    // are in pixels relative to the upper left corner of the visible browser\n    // window.  These coordinates change when you scroll the browser window.\n    const boundingRect = injectionDiv.getBoundingClientRect();\n\n    // The client coordinates offset by the injection div's upper left corner.\n    const mouseEvent = e as MouseEvent;\n    const clientOffsetPixels = new Coordinate(\n        mouseEvent.clientX - boundingRect.left,\n        mouseEvent.clientY - boundingRect.top);\n\n    // The offset in pixels between the main workspace's origin and the upper\n    // left corner of the injection div.\n    const mainOffsetPixels = ws.getOriginOffsetInPixels();\n\n    // The position of the new comment in pixels relative to the origin of the\n    // main workspace.\n    const finalOffset =\n        Coordinate.difference(clientOffsetPixels, mainOffsetPixels);\n    // The position of the new comment in main workspace coordinates.\n    finalOffset.scale(1 / ws.scale);\n\n    const commentX = finalOffset.x;\n    const commentY = finalOffset.y;\n    comment.moveBy(commentX, commentY);\n    if (ws.rendered) {\n      comment.initSvg();\n      comment.render();\n      comment.select();\n    }\n  }\n\n  const wsCommentOption = {\n    enabled: true,\n  } as ContextMenuOption;\n  wsCommentOption.text = Msg['ADD_COMMENT'];\n  wsCommentOption.callback = function() {\n    addWsComment();\n  };\n  return wsCommentOption;\n}\n","/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Utility functions for positioning UI elements.\n *\n * @namespace Blockly.uiPosition\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.uiPosition');\n\nimport type {UiMetrics} from './metrics_manager.js';\nimport {Scrollbar} from './scrollbar.js';\nimport {Rect} from './utils/rect.js';\nimport type {Size} from './utils/size.js';\nimport * as toolbox from './utils/toolbox.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/**\n * Enum for vertical positioning.\n *\n * @alias Blockly.uiPosition.verticalPosition\n * @internal\n */\nexport enum verticalPosition {\n  TOP,\n  BOTTOM\n}\n\n/**\n * Enum for horizontal positioning.\n *\n * @alias Blockly.uiPosition.horizontalPosition\n * @internal\n */\nexport enum horizontalPosition {\n  LEFT,\n  RIGHT\n}\n\n/**\n * An object defining a horizontal and vertical positioning.\n *\n * @alias Blockly.uiPosition.Position\n * @internal\n */\nexport interface Position {\n  horizontal: horizontalPosition;\n  vertical: verticalPosition;\n}\n\n/**\n * Enum for bump rules to use for dealing with collisions.\n *\n * @alias Blockly.uiPosition.bumpDirection\n * @internal\n */\nexport enum bumpDirection {\n  UP,\n  DOWN\n}\n\n/**\n * Returns a rectangle representing reasonable position for where to place a UI\n * element of the specified size given the restraints and locations of the\n * scrollbars. This method does not take into account any already placed UI\n * elements.\n *\n * @param position The starting horizontal and vertical position.\n * @param size the size of the UI element to get a start position for.\n * @param horizontalPadding The horizontal padding to use.\n * @param verticalPadding The vertical padding to use.\n * @param metrics The workspace UI metrics.\n * @param workspace The workspace.\n * @returns The suggested start position.\n * @alias Blockly.uiPosition.getStartPositionRect\n * @internal\n */\nexport function getStartPositionRect(\n    position: Position, size: Size, horizontalPadding: number,\n    verticalPadding: number, metrics: UiMetrics,\n    workspace: WorkspaceSvg): Rect {\n  // Horizontal positioning.\n  let left = 0;\n  const hasVerticalScrollbar =\n      workspace.scrollbar && workspace.scrollbar.canScrollVertically();\n  if (position.horizontal === horizontalPosition.LEFT) {\n    left = metrics.absoluteMetrics.left + horizontalPadding;\n    if (hasVerticalScrollbar && workspace.RTL) {\n      left += Scrollbar.scrollbarThickness;\n    }\n  } else {  // position.horizontal === horizontalPosition.RIGHT\n    left = metrics.absoluteMetrics.left + metrics.viewMetrics.width -\n        size.width - horizontalPadding;\n    if (hasVerticalScrollbar && !workspace.RTL) {\n      left -= Scrollbar.scrollbarThickness;\n    }\n  }\n  // Vertical positioning.\n  let top = 0;\n  if (position.vertical === verticalPosition.TOP) {\n    top = metrics.absoluteMetrics.top + verticalPadding;\n  } else {  // position.vertical === verticalPosition.BOTTOM\n    top = metrics.absoluteMetrics.top + metrics.viewMetrics.height -\n        size.height - verticalPadding;\n    if (workspace.scrollbar && workspace.scrollbar.canScrollHorizontally()) {\n      // The scrollbars are always positioned on the bottom if they exist.\n      top -= Scrollbar.scrollbarThickness;\n    }\n  }\n  return new Rect(top, top + size.height, left, left + size.width);\n}\n\n/**\n * Returns a corner position that is on the opposite side of the workspace from\n * the toolbox.\n * If in horizontal orientation, defaults to the bottom corner. If in vertical\n * orientation, defaults to the right corner.\n *\n * @param workspace The workspace.\n * @param metrics The workspace metrics.\n * @returns The suggested corner position.\n * @alias Blockly.uiPosition.getCornerOppositeToolbox\n * @internal\n */\nexport function getCornerOppositeToolbox(\n    workspace: WorkspaceSvg, metrics: UiMetrics): Position {\n  const leftCorner =\n      metrics.toolboxMetrics.position !== toolbox.Position.LEFT &&\n      (!workspace.horizontalLayout || workspace.RTL);\n  const topCorner = metrics.toolboxMetrics.position === toolbox.Position.BOTTOM;\n  const hPosition =\n      leftCorner ? horizontalPosition.LEFT : horizontalPosition.RIGHT;\n  const vPosition = topCorner ? verticalPosition.TOP : verticalPosition.BOTTOM;\n  return {horizontal: hPosition, vertical: vPosition};\n}\n\n/**\n * Returns a position Rect based on a starting position that is bumped\n * so that it doesn't intersect with any of the provided savedPositions. This\n * method does not check that the bumped position is still within bounds.\n *\n * @param startRect The starting position to use.\n * @param margin The margin to use between elements when bumping.\n * @param bumpDir The direction to bump if there is a collision with an existing\n *     UI element.\n * @param savedPositions List of rectangles that represent the positions of UI\n *     elements already placed.\n * @returns The suggested position rectangle.\n * @alias Blockly.uiPosition.bumpPositionRect\n * @internal\n */\nexport function bumpPositionRect(\n    startRect: Rect, margin: number, bumpDir: bumpDirection,\n    savedPositions: Rect[]): Rect {\n  let top = startRect.top;\n  const left = startRect.left;\n  const width = startRect.right - startRect.left;\n  const height = startRect.bottom - startRect.top;\n\n  // Check for collision and bump if needed.\n  let boundingRect = startRect;\n  for (let i = 0; i < savedPositions.length; i++) {\n    const otherEl = savedPositions[i];\n    if (boundingRect.intersects(otherEl)) {\n      if (bumpDir === bumpDirection.UP) {\n        top = otherEl.top - height - margin;\n      } else {  // bumpDir === bumpDirection.DOWN\n        top = otherEl.bottom + margin;\n      }\n      // Recheck other savedPositions\n      boundingRect = new Rect(top, top + height, left, left + width);\n      i = -1;\n    }\n  }\n  return boundingRect;\n}\n","/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Registers default keyboard shortcuts.\n *\n * @namespace Blockly.ShortcutItems\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.ShortcutItems');\n\nimport {BlockSvg} from './block_svg.js';\nimport * as clipboard from './clipboard.js';\nimport * as common from './common.js';\nimport {Gesture} from './gesture.js';\nimport type {ICopyable} from './interfaces/i_copyable.js';\nimport {KeyboardShortcut, ShortcutRegistry} from './shortcut_registry.js';\nimport {KeyCodes} from './utils/keycodes.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/**\n * Object holding the names of the default shortcut items.\n *\n * @alias Blockly.ShortcutItems.names\n */\nexport enum names {\n  ESCAPE = 'escape',\n  DELETE = 'delete',\n  COPY = 'copy',\n  CUT = 'cut',\n  PASTE = 'paste',\n  UNDO = 'undo',\n  REDO = 'redo',\n}\n\n/**\n * Keyboard shortcut to hide chaff on escape.\n *\n * @alias Blockly.ShortcutItems.registerEscape\n */\nexport function registerEscape() {\n  const escapeAction: KeyboardShortcut = {\n    name: names.ESCAPE,\n    preconditionFn(workspace) {\n      return !workspace.options.readOnly;\n    },\n    callback(workspace) {\n      // AnyDuringMigration because:  Property 'hideChaff' does not exist on\n      // type 'Workspace'.\n      (workspace as AnyDuringMigration).hideChaff();\n      return true;\n    },\n    keyCodes: [KeyCodes.ESC],\n  };\n  ShortcutRegistry.registry.register(escapeAction);\n}\n\n/**\n * Keyboard shortcut to delete a block on delete or backspace\n *\n * @alias Blockly.ShortcutItems.registerDelete\n */\nexport function registerDelete() {\n  const deleteShortcut: KeyboardShortcut = {\n    name: names.DELETE,\n    preconditionFn(workspace) {\n      const selected = common.getSelected();\n      return !workspace.options.readOnly && selected != null &&\n          selected.isDeletable();\n    },\n    callback(workspace, e) {\n      // Delete or backspace.\n      // Stop the browser from going back to the previous page.\n      // Do this first to prevent an error in the delete code from resulting in\n      // data loss.\n      e.preventDefault();\n      // Don't delete while dragging.  Jeez.\n      if (Gesture.inProgress()) {\n        return false;\n      }\n      (common.getSelected() as BlockSvg).checkAndDelete();\n      return true;\n    },\n    keyCodes: [KeyCodes.DELETE, KeyCodes.BACKSPACE],\n  };\n  ShortcutRegistry.registry.register(deleteShortcut);\n}\n\n/**\n * Keyboard shortcut to copy a block on ctrl+c, cmd+c, or alt+c.\n *\n * @alias Blockly.ShortcutItems.registerCopy\n */\nexport function registerCopy() {\n  const ctrlC = ShortcutRegistry.registry.createSerializedKey(\n      KeyCodes.C, [KeyCodes.CTRL]);\n  const altC =\n      ShortcutRegistry.registry.createSerializedKey(KeyCodes.C, [KeyCodes.ALT]);\n  const metaC = ShortcutRegistry.registry.createSerializedKey(\n      KeyCodes.C, [KeyCodes.META]);\n\n  const copyShortcut: KeyboardShortcut = {\n    name: names.COPY,\n    preconditionFn(workspace) {\n      const selected = common.getSelected();\n      return !workspace.options.readOnly && !Gesture.inProgress() &&\n          selected != null && selected.isDeletable() && selected.isMovable();\n    },\n    callback(workspace, e) {\n      // Prevent the default copy behavior, which may beep or otherwise indicate\n      // an error due to the lack of a selection.\n      e.preventDefault();\n      // AnyDuringMigration because:  Property 'hideChaff' does not exist on\n      // type 'Workspace'.\n      (workspace as AnyDuringMigration).hideChaff();\n      clipboard.copy(common.getSelected() as ICopyable);\n      return true;\n    },\n    keyCodes: [ctrlC, altC, metaC],\n  };\n  ShortcutRegistry.registry.register(copyShortcut);\n}\n\n/**\n * Keyboard shortcut to copy and delete a block on ctrl+x, cmd+x, or alt+x.\n *\n * @alias Blockly.ShortcutItems.registerCut\n */\nexport function registerCut() {\n  const ctrlX = ShortcutRegistry.registry.createSerializedKey(\n      KeyCodes.X, [KeyCodes.CTRL]);\n  const altX =\n      ShortcutRegistry.registry.createSerializedKey(KeyCodes.X, [KeyCodes.ALT]);\n  const metaX = ShortcutRegistry.registry.createSerializedKey(\n      KeyCodes.X, [KeyCodes.META]);\n\n  const cutShortcut: KeyboardShortcut = {\n    name: names.CUT,\n    preconditionFn(workspace) {\n      const selected = common.getSelected();\n      return !workspace.options.readOnly && !Gesture.inProgress() &&\n          selected != null && selected instanceof BlockSvg &&\n          selected.isDeletable() && selected.isMovable() &&\n          !selected.workspace!.isFlyout;\n    },\n    callback() {\n      const selected = common.getSelected();\n      if (!selected) {\n        // Shouldn't happen but appeases the type system\n        return false;\n      }\n      clipboard.copy(selected);\n      (selected as BlockSvg).checkAndDelete();\n      return true;\n    },\n    keyCodes: [ctrlX, altX, metaX],\n  };\n\n  ShortcutRegistry.registry.register(cutShortcut);\n}\n\n/**\n * Keyboard shortcut to paste a block on ctrl+v, cmd+v, or alt+v.\n *\n * @alias Blockly.ShortcutItems.registerPaste\n */\nexport function registerPaste() {\n  const ctrlV = ShortcutRegistry.registry.createSerializedKey(\n      KeyCodes.V, [KeyCodes.CTRL]);\n  const altV =\n      ShortcutRegistry.registry.createSerializedKey(KeyCodes.V, [KeyCodes.ALT]);\n  const metaV = ShortcutRegistry.registry.createSerializedKey(\n      KeyCodes.V, [KeyCodes.META]);\n\n  const pasteShortcut: KeyboardShortcut = {\n    name: names.PASTE,\n    preconditionFn(workspace) {\n      return !workspace.options.readOnly && !Gesture.inProgress();\n    },\n    callback() {\n      return !!(clipboard.paste());\n    },\n    keyCodes: [ctrlV, altV, metaV],\n  };\n\n  ShortcutRegistry.registry.register(pasteShortcut);\n}\n\n/**\n * Keyboard shortcut to undo the previous action on ctrl+z, cmd+z, or alt+z.\n *\n * @alias Blockly.ShortcutItems.registerUndo\n */\nexport function registerUndo() {\n  const ctrlZ = ShortcutRegistry.registry.createSerializedKey(\n      KeyCodes.Z, [KeyCodes.CTRL]);\n  const altZ =\n      ShortcutRegistry.registry.createSerializedKey(KeyCodes.Z, [KeyCodes.ALT]);\n  const metaZ = ShortcutRegistry.registry.createSerializedKey(\n      KeyCodes.Z, [KeyCodes.META]);\n\n  const undoShortcut: KeyboardShortcut = {\n    name: names.UNDO,\n    preconditionFn(workspace) {\n      return !workspace.options.readOnly && !Gesture.inProgress();\n    },\n    callback(workspace) {\n      // 'z' for undo 'Z' is for redo.\n      (workspace as WorkspaceSvg).hideChaff();\n      workspace.undo(false);\n      return true;\n    },\n    keyCodes: [ctrlZ, altZ, metaZ],\n  };\n  ShortcutRegistry.registry.register(undoShortcut);\n}\n\n/**\n * Keyboard shortcut to redo the previous action on ctrl+shift+z, cmd+shift+z,\n * or alt+shift+z.\n *\n * @alias Blockly.ShortcutItems.registerRedo\n */\nexport function registerRedo() {\n  const ctrlShiftZ = ShortcutRegistry.registry.createSerializedKey(\n      KeyCodes.Z, [KeyCodes.SHIFT, KeyCodes.CTRL]);\n  const altShiftZ = ShortcutRegistry.registry.createSerializedKey(\n      KeyCodes.Z, [KeyCodes.SHIFT, KeyCodes.ALT]);\n  const metaShiftZ = ShortcutRegistry.registry.createSerializedKey(\n      KeyCodes.Z, [KeyCodes.SHIFT, KeyCodes.META]);\n  // Ctrl-y is redo in Windows.  Command-y is never valid on Macs.\n  const ctrlY = ShortcutRegistry.registry.createSerializedKey(\n      KeyCodes.Y, [KeyCodes.CTRL]);\n\n  const redoShortcut: KeyboardShortcut = {\n    name: names.REDO,\n    preconditionFn(workspace) {\n      return !Gesture.inProgress() && !workspace.options.readOnly;\n    },\n    callback(workspace) {\n      // 'z' for undo 'Z' is for redo.\n      (workspace as WorkspaceSvg).hideChaff();\n      workspace.undo(true);\n      return true;\n    },\n    keyCodes: [ctrlShiftZ, altShiftZ, metaShiftZ, ctrlY],\n  };\n  ShortcutRegistry.registry.register(redoShortcut);\n}\n\n/**\n * Registers all default keyboard shortcut item. This should be called once per\n * instance of KeyboardShortcutRegistry.\n *\n * @alias Blockly.ShortcutItems.registerDefaultShortcuts\n * @internal\n */\nexport function registerDefaultShortcuts() {\n  registerEscape();\n  registerDelete();\n  registerCopy();\n  registerCut();\n  registerPaste();\n  registerUndo();\n  registerRedo();\n}\n\nregisterDefaultShortcuts();\n","/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n\n/**\n * An object that fires events optionally.\n *\n * @internal\n */\nexport interface IObservable {\n  startPublishing(): void;\n  stopPublishing(): void;\n}\n\n/**\n * Type guard for checking if an object fulfills IObservable.\n *\n * @internal\n */\nexport function isObservable(obj: any): obj is IObservable {\n  return obj.startPublishing !== undefined && obj.stopPublishing !== undefined;\n}\n","/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {Block} from '../block.js';\n\n\n/** The interface for a block which models a procedure. */\nexport interface IProcedureBlock {\n  doProcedureUpdate(): void;\n}\n\n/** A type guard which checks if the given block is a procedure block. */\nexport function isProcedureBlock(block: Block|\n                                 IProcedureBlock): block is IProcedureBlock {\n  return (block as IProcedureBlock).doProcedureUpdate !== undefined;\n}\n","/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {isProcedureBlock} from '../interfaces/i_procedure_block.js';\nimport {Workspace} from '../workspace.js';\n\n\n/**\n * Calls the `doProcedureUpdate` method on all blocks which implement it.\n *\n * @internal\n */\nexport function triggerProceduresUpdate(workspace: Workspace) {\n  for (const block of workspace.getAllBlocks(false)) {\n    if (isProcedureBlock(block)) {\n      block.doProcedureUpdate();\n    }\n  }\n}\n","/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Utility functions for handling procedures.\n *\n * @namespace Blockly.Procedures\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Procedures');\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_change.js';\n\nimport type {Block} from './block.js';\nimport type {BlockSvg} from './block_svg.js';\nimport {Blocks} from './blocks.js';\nimport * as common from './common.js';\nimport type {Abstract} from './events/events_abstract.js';\nimport type {BubbleOpen} from './events/events_bubble_open.js';\nimport * as eventUtils from './events/utils.js';\nimport {Field, UnattachedFieldError} from './field.js';\nimport {Msg} from './msg.js';\nimport {Names} from './names.js';\nimport {ObservableProcedureMap} from './procedures/observable_procedure_map.js';\nimport {ObservableProcedureModel} from './procedures/observable_procedure_model.js';\nimport {ObservableParameterModel} from './procedures/observable_parameter_model.js';\nimport * as utilsXml from './utils/xml.js';\nimport * as Variables from './variables.js';\nimport type {Workspace} from './workspace.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\nimport * as Xml from './xml.js';\n\n\n/**\n * String for use in the \"custom\" attribute of a category in toolbox XML.\n * This string indicates that the category should be dynamically populated with\n * procedure blocks.\n * See also Blockly.Variables.CATEGORY_NAME and\n * Blockly.VariablesDynamic.CATEGORY_NAME.\n *\n * @alias Blockly.Procedures.CATEGORY_NAME\n */\nexport const CATEGORY_NAME = 'PROCEDURE';\n\n/**\n * The default argument for a procedures_mutatorarg block.\n *\n * @alias Blockly.Procedures.DEFAULT_ARG\n */\nexport const DEFAULT_ARG = 'x';\n\nexport type ProcedureTuple = [string, string[], boolean];\n\n/**\n * Procedure block type.\n *\n * @alias Blockly.Procedures.ProcedureBlock\n */\nexport interface ProcedureBlock {\n  getProcedureCall: () => string;\n  renameProcedure: (p1: string, p2: string) => void;\n  getProcedureDef: () => ProcedureTuple;\n}\n\n/**\n * Find all user-created procedure definitions in a workspace.\n *\n * @param root Root workspace.\n * @returns Pair of arrays, the first contains procedures without return\n *     variables, the second with. Each procedure is defined by a three-element\n *     list of name, parameter list, and return value boolean.\n * @alias Blockly.Procedures.allProcedures\n */\nexport function allProcedures(root: Workspace):\n    [ProcedureTuple[], ProcedureTuple[]] {\n  const proceduresNoReturn =\n      root.getBlocksByType('procedures_defnoreturn', false)\n          .map(function(block) {\n            return (block as unknown as ProcedureBlock).getProcedureDef();\n          });\n  const proceduresReturn =\n      root.getBlocksByType('procedures_defreturn', false).map(function(block) {\n        return (block as unknown as ProcedureBlock).getProcedureDef();\n      });\n  proceduresNoReturn.sort(procTupleComparator);\n  proceduresReturn.sort(procTupleComparator);\n  return [proceduresNoReturn, proceduresReturn];\n}\n\n/**\n * Comparison function for case-insensitive sorting of the first element of\n * a tuple.\n *\n * @param ta First tuple.\n * @param tb Second tuple.\n * @returns -1, 0, or 1 to signify greater than, equality, or less than.\n */\nfunction procTupleComparator(ta: ProcedureTuple, tb: ProcedureTuple): number {\n  return ta[0].localeCompare(tb[0], undefined, {sensitivity: 'base'});\n}\n\n/**\n * Ensure two identically-named procedures don't exist.\n * Take the proposed procedure name, and return a legal name i.e. one that\n * is not empty and doesn't collide with other procedures.\n *\n * @param name Proposed procedure name.\n * @param block Block to disambiguate.\n * @returns Non-colliding name.\n * @alias Blockly.Procedures.findLegalName\n */\nexport function findLegalName(name: string, block: Block): string {\n  if (block.isInFlyout) {\n    // Flyouts can have multiple procedures called 'do something'.\n    return name;\n  }\n  name = name || Msg['UNNAMED_KEY'] || 'unnamed';\n  while (!isLegalName(name, block.workspace, block)) {\n    // Collision with another procedure.\n    const r = name.match(/^(.*?)(\\d+)$/);\n    if (!r) {\n      name += '2';\n    } else {\n      name = r[1] + (parseInt(r[2]) + 1);\n    }\n  }\n  return name;\n}\n/**\n * Does this procedure have a legal name?  Illegal names include names of\n * procedures already defined.\n *\n * @param name The questionable name.\n * @param workspace The workspace to scan for collisions.\n * @param opt_exclude Optional block to exclude from comparisons (one doesn't\n *     want to collide with oneself).\n * @returns True if the name is legal.\n */\nfunction isLegalName(\n    name: string, workspace: Workspace, opt_exclude?: Block): boolean {\n  return !isNameUsed(name, workspace, opt_exclude);\n}\n\n/**\n * Return if the given name is already a procedure name.\n *\n * @param name The questionable name.\n * @param workspace The workspace to scan for collisions.\n * @param opt_exclude Optional block to exclude from comparisons (one doesn't\n *     want to collide with oneself).\n * @returns True if the name is used, otherwise return false.\n * @alias Blockly.Procedures.isNameUsed\n */\nexport function isNameUsed(\n    name: string, workspace: Workspace, opt_exclude?: Block): boolean {\n  const blocks = workspace.getAllBlocks(false);\n  // Iterate through every block and check the name.\n  for (let i = 0; i < blocks.length; i++) {\n    if (blocks[i] === opt_exclude) {\n      continue;\n    }\n    // Assume it is a procedure block so we can check.\n    const procedureBlock = blocks[i] as unknown as ProcedureBlock;\n    if (procedureBlock.getProcedureDef) {\n      const procName = procedureBlock.getProcedureDef();\n      if (Names.equals(procName[0], name)) {\n        return true;\n      }\n    }\n  }\n  return false;\n}\n\n/**\n * Rename a procedure.  Called by the editable field.\n *\n * @param name The proposed new name.\n * @returns The accepted name.\n * @alias Blockly.Procedures.rename\n */\nexport function rename(this: Field, name: string): string {\n  const block = this.getSourceBlock();\n  if (!block) {\n    throw new UnattachedFieldError();\n  }\n\n  // Strip leading and trailing whitespace.  Beyond this, all names are legal.\n  name = name.trim();\n\n  const legalName = findLegalName(name, block);\n  const oldName = this.getValue();\n  if (oldName !== name && oldName !== legalName) {\n    // Rename any callers.\n    const blocks = block.workspace.getAllBlocks(false);\n    for (let i = 0; i < blocks.length; i++) {\n      // Assume it is a procedure so we can check.\n      const procedureBlock = blocks[i] as unknown as ProcedureBlock;\n      if (procedureBlock.renameProcedure) {\n        procedureBlock.renameProcedure(oldName as string, legalName);\n      }\n    }\n  }\n  return legalName;\n}\n\n/**\n * Construct the blocks required by the flyout for the procedure category.\n *\n * @param workspace The workspace containing procedures.\n * @returns Array of XML block elements.\n * @alias Blockly.Procedures.flyoutCategory\n */\nexport function flyoutCategory(workspace: WorkspaceSvg): Element[] {\n  const xmlList = [];\n  if (Blocks['procedures_defnoreturn']) {\n    // <block type=\"procedures_defnoreturn\" gap=\"16\">\n    //     <field name=\"NAME\">do something</field>\n    // </block>\n    const block = utilsXml.createElement('block');\n    block.setAttribute('type', 'procedures_defnoreturn');\n    block.setAttribute('gap', '16');\n    const nameField = utilsXml.createElement('field');\n    nameField.setAttribute('name', 'NAME');\n    nameField.appendChild(\n        utilsXml.createTextNode(Msg['PROCEDURES_DEFNORETURN_PROCEDURE']));\n    block.appendChild(nameField);\n    xmlList.push(block);\n  }\n  if (Blocks['procedures_defreturn']) {\n    // <block type=\"procedures_defreturn\" gap=\"16\">\n    //     <field name=\"NAME\">do something</field>\n    // </block>\n    const block = utilsXml.createElement('block');\n    block.setAttribute('type', 'procedures_defreturn');\n    block.setAttribute('gap', '16');\n    const nameField = utilsXml.createElement('field');\n    nameField.setAttribute('name', 'NAME');\n    nameField.appendChild(\n        utilsXml.createTextNode(Msg['PROCEDURES_DEFRETURN_PROCEDURE']));\n    block.appendChild(nameField);\n    xmlList.push(block);\n  }\n  if (Blocks['procedures_ifreturn']) {\n    // <block type=\"procedures_ifreturn\" gap=\"16\"></block>\n    const block = utilsXml.createElement('block');\n    block.setAttribute('type', 'procedures_ifreturn');\n    block.setAttribute('gap', '16');\n    xmlList.push(block);\n  }\n  if (xmlList.length) {\n    // Add slightly larger gap between system blocks and user calls.\n    xmlList[xmlList.length - 1].setAttribute('gap', '24');\n  }\n\n  /**\n   * Add items to xmlList for each listed procedure.\n   *\n   * @param procedureList A list of procedures, each of which is defined by a\n   *     three-element list of name, parameter list, and return value boolean.\n   * @param templateName The type of the block to generate.\n   */\n  function populateProcedures(\n      procedureList: ProcedureTuple[], templateName: string) {\n    for (let i = 0; i < procedureList.length; i++) {\n      const name = procedureList[i][0];\n      const args = procedureList[i][1];\n      // <block type=\"procedures_callnoreturn\" gap=\"16\">\n      //   <mutation name=\"do something\">\n      //     <arg name=\"x\"></arg>\n      //   </mutation>\n      // </block>\n      const block = utilsXml.createElement('block');\n      block.setAttribute('type', templateName);\n      block.setAttribute('gap', '16');\n      const mutation = utilsXml.createElement('mutation');\n      mutation.setAttribute('name', name);\n      block.appendChild(mutation);\n      for (let j = 0; j < args.length; j++) {\n        const arg = utilsXml.createElement('arg');\n        arg.setAttribute('name', args[j]);\n        mutation.appendChild(arg);\n      }\n      xmlList.push(block);\n    }\n  }\n\n  const tuple = allProcedures(workspace);\n  populateProcedures(tuple[0], 'procedures_callnoreturn');\n  populateProcedures(tuple[1], 'procedures_callreturn');\n  return xmlList;\n}\n\n/**\n * Updates the procedure mutator's flyout so that the arg block is not a\n * duplicate of another arg.\n *\n * @param workspace The procedure mutator's workspace. This workspace's flyout\n *     is what is being updated.\n */\nfunction updateMutatorFlyout(workspace: WorkspaceSvg) {\n  const usedNames = [];\n  const blocks = workspace.getBlocksByType('procedures_mutatorarg', false);\n  for (let i = 0, block; block = blocks[i]; i++) {\n    usedNames.push(block.getFieldValue('NAME'));\n  }\n\n  const xmlElement = utilsXml.createElement('xml');\n  const argBlock = utilsXml.createElement('block');\n  argBlock.setAttribute('type', 'procedures_mutatorarg');\n  const nameField = utilsXml.createElement('field');\n  nameField.setAttribute('name', 'NAME');\n  const argValue =\n      Variables.generateUniqueNameFromOptions(DEFAULT_ARG, usedNames);\n  const fieldContent = utilsXml.createTextNode(argValue);\n\n  nameField.appendChild(fieldContent);\n  argBlock.appendChild(nameField);\n  xmlElement.appendChild(argBlock);\n\n  workspace.updateToolbox(xmlElement);\n}\n\n/**\n * Listens for when a procedure mutator is opened. Then it triggers a flyout\n * update and adds a mutator change listener to the mutator workspace.\n *\n * @param e The event that triggered this listener.\n * @alias Blockly.Procedures.mutatorOpenListener\n * @internal\n */\nexport function mutatorOpenListener(e: Abstract) {\n  if (e.type !== eventUtils.BUBBLE_OPEN) {\n    return;\n  }\n  const bubbleEvent = e as BubbleOpen;\n  if (!(bubbleEvent.bubbleType === 'mutator' && bubbleEvent.isOpen) ||\n      !bubbleEvent.blockId) {\n    return;\n  }\n  const workspaceId = (bubbleEvent.workspaceId);\n  const block = common.getWorkspaceById(workspaceId)!.getBlockById(\n                    bubbleEvent.blockId) as BlockSvg;\n  const type = block.type;\n  if (type !== 'procedures_defnoreturn' && type !== 'procedures_defreturn') {\n    return;\n  }\n  const workspace = block.mutator!.getWorkspace() as WorkspaceSvg;\n  updateMutatorFlyout(workspace);\n  workspace.addChangeListener(mutatorChangeListener);\n}\n/**\n * Listens for changes in a procedure mutator and triggers flyout updates when\n * necessary.\n *\n * @param e The event that triggered this listener.\n */\nfunction mutatorChangeListener(e: Abstract) {\n  if (e.type !== eventUtils.BLOCK_CREATE &&\n      e.type !== eventUtils.BLOCK_DELETE &&\n      e.type !== eventUtils.BLOCK_CHANGE) {\n    return;\n  }\n  const workspaceId = e.workspaceId as string;\n  const workspace = common.getWorkspaceById(workspaceId) as WorkspaceSvg;\n  updateMutatorFlyout(workspace);\n}\n\n/**\n * Find all the callers of a named procedure.\n *\n * @param name Name of procedure.\n * @param workspace The workspace to find callers in.\n * @returns Array of caller blocks.\n * @alias Blockly.Procedures.getCallers\n */\nexport function getCallers(name: string, workspace: Workspace): Block[] {\n  const callers = [];\n  const blocks = workspace.getAllBlocks(false);\n  // Iterate through every block and check the name.\n  for (let i = 0; i < blocks.length; i++) {\n    // Assume it is a procedure block so we can check.\n    const procedureBlock = blocks[i] as unknown as ProcedureBlock;\n    if (procedureBlock.getProcedureCall) {\n      const procName = procedureBlock.getProcedureCall();\n      // Procedure name may be null if the block is only half-built.\n      if (procName && Names.equals(procName, name)) {\n        callers.push(blocks[i]);\n      }\n    }\n  }\n  return callers;\n}\n\n/**\n * When a procedure definition changes its parameters, find and edit all its\n * callers.\n *\n * @param defBlock Procedure definition block.\n * @alias Blockly.Procedures.mutateCallers\n */\nexport function mutateCallers(defBlock: Block) {\n  const oldRecordUndo = eventUtils.getRecordUndo();\n  const procedureBlock = defBlock as unknown as ProcedureBlock;\n  const name = procedureBlock.getProcedureDef()[0];\n  const xmlElement = defBlock.mutationToDom!(true);\n  const callers = getCallers(name, defBlock.workspace);\n  for (let i = 0, caller; caller = callers[i]; i++) {\n    const oldMutationDom = caller.mutationToDom!();\n    const oldMutation = oldMutationDom && Xml.domToText(oldMutationDom);\n    if (caller.domToMutation) {\n      caller.domToMutation(xmlElement);\n    }\n    const newMutationDom = caller.mutationToDom!();\n    const newMutation = newMutationDom && Xml.domToText(newMutationDom);\n    if (oldMutation !== newMutation) {\n      // Fire a mutation on every caller block.  But don't record this as an\n      // undo action since it is deterministically tied to the procedure's\n      // definition mutation.\n      eventUtils.setRecordUndo(false);\n      eventUtils.fire(new (eventUtils.get(eventUtils.BLOCK_CHANGE))(\n          caller, 'mutation', null, oldMutation, newMutation));\n      eventUtils.setRecordUndo(oldRecordUndo);\n    }\n  }\n}\n\n/**\n * Find the definition block for the named procedure.\n *\n * @param name Name of procedure.\n * @param workspace The workspace to search.\n * @returns The procedure definition block, or null not found.\n * @alias Blockly.Procedures.getDefinition\n */\nexport function getDefinition(name: string, workspace: Workspace): Block|null {\n  // Do not assume procedure is a top block. Some languages allow nested\n  // procedures. Also do not assume it is one of the built-in blocks. Only\n  // rely on getProcedureDef.\n  const blocks = workspace.getAllBlocks(false);\n  for (let i = 0; i < blocks.length; i++) {\n    // Assume it is a procedure block so we can check.\n    const procedureBlock = blocks[i] as unknown as ProcedureBlock;\n    if (procedureBlock.getProcedureDef) {\n      const tuple = procedureBlock.getProcedureDef();\n      if (tuple && Names.equals(tuple[0], name)) {\n        return blocks[i];  // Can't use procedureBlock var due to type check.\n      }\n    }\n  }\n  return null;\n}\n\nexport {\n  ObservableProcedureMap,\n  ObservableProcedureModel,\n  ObservableParameterModel,\n};\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * An object that provides constants for rendering blocks.\n *\n * @class\n */\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.ConstantProvider');\n\nimport {ConnectionType} from '../../connection_type.js';\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport type {BlockStyle, Theme} from '../../theme.js';\nimport * as colour from '../../utils/colour.js';\nimport * as dom from '../../utils/dom.js';\nimport * as parsing from '../../utils/parsing.js';\nimport {Svg} from '../../utils/svg.js';\nimport * as svgPaths from '../../utils/svg_paths.js';\n\n\n/** An object containing sizing and path information about outside corners. */\nexport interface OutsideCorners {\n  topLeft: string;\n  topRight: string;\n  bottomRight: string;\n  bottomLeft: string;\n  rightHeight: number;\n}\n\n/** An object containing sizing and path information about inside corners. */\nexport interface InsideCorners {\n  width: number;\n  height: number;\n  pathTop: string;\n  pathBottom: string;\n}\n\n/** An object containing sizing and path information about a start hat. */\nexport interface StartHat {\n  height: number;\n  width: number;\n  path: string;\n}\n\n/** An object containing sizing and path information about a notch. */\nexport interface Notch {\n  type: number;\n  width: number;\n  height: number;\n  pathLeft: string;\n  pathRight: string;\n}\n\n/** An object containing sizing and path information about a puzzle tab. */\nexport interface PuzzleTab {\n  type: number;\n  width: number;\n  height: number;\n  pathDown: string|((p1: number) => string);\n  pathUp: string|((p1: number) => string);\n}\n\n/**\n * An object containing sizing and path information about collapsed block\n * indicators.\n */\nexport interface JaggedTeeth {\n  height: number;\n  width: number;\n  path: string;\n}\n\nexport type BaseShape = {\n  type: number; width: number; height: number;\n};\n\n/** An object containing sizing and type information about a dynamic shape. */\nexport type DynamicShape = {\n  type: number; width: (p1: number) => number; height: (p1: number) => number;\n  isDynamic: true;\n  connectionOffsetY: (p1: number) => number;\n  connectionOffsetX: (p1: number) => number;\n  pathDown: (p1: number) => string;\n  pathUp: (p1: number) => string;\n  pathRightDown: (p1: number) => string;\n  pathRightUp: (p1: number) => string;\n};\n\n/** An object containing sizing and type information about a shape. */\nexport type Shape = BaseShape|DynamicShape;\n\n/**\n * Returns whether the shape is dynamic or not.\n *\n * @param shape The shape to check for dynamic-ness.\n * @returns Whether the shape is a dynamic shape or not.\n */\nexport function isDynamicShape(shape: Shape): shape is DynamicShape {\n  return (shape as DynamicShape).isDynamic;\n}\n\n/**\n * An object that provides constants for rendering blocks.\n *\n * @alias Blockly.blockRendering.ConstantProvider\n */\nexport class ConstantProvider {\n  /** The size of an empty spacer. */\n  NO_PADDING = 0;\n\n  /** The size of small padding. */\n  SMALL_PADDING = 3;\n\n  /** The size of medium padding. */\n  MEDIUM_PADDING = 5;\n\n  /** The size of medium-large padding. */\n  MEDIUM_LARGE_PADDING = 8;\n\n  /** The size of large padding. */\n  LARGE_PADDING = 10;\n  TALL_INPUT_FIELD_OFFSET_Y: number;\n\n  /** The height of the puzzle tab used for input and output connections. */\n  TAB_HEIGHT = 15;\n\n  /**\n   * The offset from the top of the block at which a puzzle tab is positioned.\n   */\n  TAB_OFFSET_FROM_TOP = 5;\n\n  /**\n   * Vertical overlap of the puzzle tab, used to make it look more like a\n   * puzzle piece.\n   */\n  TAB_VERTICAL_OVERLAP = 2.5;\n\n  /** The width of the puzzle tab used for input and output connections. */\n  TAB_WIDTH = 8;\n\n  /** The width of the notch used for previous and next connections. */\n  NOTCH_WIDTH = 15;\n\n  /** The height of the notch used for previous and next connections. */\n  NOTCH_HEIGHT = 4;\n\n  /** The minimum width of the block. */\n  MIN_BLOCK_WIDTH = 12;\n  EMPTY_BLOCK_SPACER_HEIGHT = 16;\n  DUMMY_INPUT_MIN_HEIGHT: number;\n  DUMMY_INPUT_SHADOW_MIN_HEIGHT: number;\n\n  /** Rounded corner radius. */\n  CORNER_RADIUS = 8;\n\n  /**\n   * Offset from the left side of a block or the inside of a statement input\n   * to the left side of the notch.\n   */\n  NOTCH_OFFSET_LEFT = 15;\n  STATEMENT_INPUT_NOTCH_OFFSET: number;\n\n  STATEMENT_BOTTOM_SPACER = 0;\n  STATEMENT_INPUT_PADDING_LEFT = 20;\n\n  /** Vertical padding between consecutive statement inputs. */\n  BETWEEN_STATEMENT_PADDING_Y = 4;\n  TOP_ROW_MIN_HEIGHT: number;\n  TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT: number;\n  BOTTOM_ROW_MIN_HEIGHT: number;\n  BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT: number;\n\n  /**\n   * Whether to add a 'hat' on top of all blocks with no previous or output\n   * connections. Can be overridden by 'hat' property on Theme.BlockStyle.\n   */\n  ADD_START_HATS = false;\n\n  /** Height of the top hat. */\n  START_HAT_HEIGHT = 15;\n\n  /** Width of the top hat. */\n  START_HAT_WIDTH = 100;\n\n  SPACER_DEFAULT_HEIGHT = 15;\n\n  MIN_BLOCK_HEIGHT = 24;\n\n  EMPTY_INLINE_INPUT_PADDING = 14.5;\n  EMPTY_INLINE_INPUT_HEIGHT: number;\n\n  EXTERNAL_VALUE_INPUT_PADDING = 2;\n  EMPTY_STATEMENT_INPUT_HEIGHT: number;\n  START_POINT: string;\n\n  /** Height of SVG path for jagged teeth at the end of collapsed blocks. */\n  JAGGED_TEETH_HEIGHT = 12;\n\n  /** Width of SVG path for jagged teeth at the end of collapsed blocks. */\n  JAGGED_TEETH_WIDTH = 6;\n\n  /** Point size of text. */\n  FIELD_TEXT_FONTSIZE = 11;\n\n  /** Text font weight. */\n  FIELD_TEXT_FONTWEIGHT = 'normal';\n\n  /** Text font family. */\n  FIELD_TEXT_FONTFAMILY = 'sans-serif';\n\n  /**\n   * Height of text.  This constant is dynamically set in\n   * `setFontConstants_` to be the height of the text based on the font\n   * used.\n   */\n  FIELD_TEXT_HEIGHT = -1;  // Dynamically set.\n\n  /**\n   * Text baseline.  This constant is dynamically set in `setFontConstants_`\n   * to be the baseline of the text based on the font used.\n   */\n  FIELD_TEXT_BASELINE = -1;  // Dynamically set.\n\n  /** A field's border rect corner radius. */\n  FIELD_BORDER_RECT_RADIUS = 4;\n\n  /** A field's border rect default height. */\n  FIELD_BORDER_RECT_HEIGHT = 16;\n\n  /** A field's border rect X padding. */\n  FIELD_BORDER_RECT_X_PADDING = 5;\n\n  /** A field's border rect Y padding. */\n  FIELD_BORDER_RECT_Y_PADDING = 3;\n\n  /**\n   * The backing colour of a field's border rect.\n   *\n   * @internal\n   */\n  FIELD_BORDER_RECT_COLOUR = '#fff';\n  FIELD_TEXT_BASELINE_CENTER: boolean;\n  FIELD_DROPDOWN_BORDER_RECT_HEIGHT: number;\n\n  /**\n   * Whether or not a dropdown field should add a border rect when in a shadow\n   * block.\n   */\n  FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW = false;\n\n  /**\n   * Whether or not a dropdown field's div should be coloured to match the\n   * block colours.\n   */\n  FIELD_DROPDOWN_COLOURED_DIV = false;\n\n  /** Whether or not a dropdown field uses a text or SVG arrow. */\n  FIELD_DROPDOWN_SVG_ARROW = false;\n  FIELD_DROPDOWN_SVG_ARROW_PADDING: number;\n\n  /** A dropdown field's SVG arrow size. */\n  FIELD_DROPDOWN_SVG_ARROW_SIZE = 12;\n  FIELD_DROPDOWN_SVG_ARROW_DATAURI: string;\n\n  /**\n   * Whether or not to show a box shadow around the widget div. This is only a\n   * feature of full block fields.\n   */\n  FIELD_TEXTINPUT_BOX_SHADOW = false;\n\n  /**\n   * Whether or not the colour field should display its colour value on the\n   * entire block.\n   */\n  FIELD_COLOUR_FULL_BLOCK = false;\n\n  /** A colour field's default width. */\n  FIELD_COLOUR_DEFAULT_WIDTH = 26;\n  FIELD_COLOUR_DEFAULT_HEIGHT: number;\n  FIELD_CHECKBOX_X_OFFSET: number;\n  /** @internal */\n  randomIdentifier: string;\n\n  /**\n   * The defs tag that contains all filters and patterns for this Blockly\n   * instance.\n   */\n  private defs_: SVGElement|null = null;\n\n  /**\n   * The ID of the emboss filter, or the empty string if no filter is set.\n   *\n   * @internal\n   */\n  embossFilterId = '';\n\n  /** The <filter> element to use for highlighting, or null if not set. */\n  private embossFilter_: SVGElement|null = null;\n\n  /**\n   * The ID of the disabled pattern, or the empty string if no pattern is set.\n   *\n   * @internal\n   */\n  disabledPatternId = '';\n\n  /**\n   * The <pattern> element to use for disabled blocks, or null if not set.\n   */\n  private disabledPattern_: SVGElement|null = null;\n\n  /**\n   * The ID of the debug filter, or the empty string if no pattern is set.\n   */\n  debugFilterId = '';\n\n  /**\n   * The <filter> element to use for a debug highlight, or null if not set.\n   */\n  private debugFilter_: SVGElement|null = null;\n\n  /** The <style> element to use for injecting renderer specific CSS. */\n  private cssNode_: HTMLStyleElement|null = null;\n\n  /**\n   * Cursor colour.\n   *\n   * @internal\n   */\n  CURSOR_COLOUR = '#cc0a0a';\n\n  /**\n   * Immovable marker colour.\n   *\n   * @internal\n   */\n  MARKER_COLOUR = '#4286f4';\n\n  /**\n   * Width of the horizontal cursor.\n   *\n   * @internal\n   */\n  CURSOR_WS_WIDTH = 100;\n\n  /**\n   * Height of the horizontal cursor.\n   *\n   * @internal\n   */\n  WS_CURSOR_HEIGHT = 5;\n\n  /**\n   * Padding around a stack.\n   *\n   * @internal\n   */\n  CURSOR_STACK_PADDING = 10;\n\n  /**\n   * Padding around a block.\n   *\n   * @internal\n   */\n  CURSOR_BLOCK_PADDING = 2;\n\n  /**\n   * Stroke of the cursor.\n   *\n   * @internal\n   */\n  CURSOR_STROKE_WIDTH = 4;\n\n  /**\n   * Whether text input and colour fields fill up the entire source block.\n   *\n   * @internal\n   */\n  FULL_BLOCK_FIELDS = false;\n\n  /**\n   * The main colour of insertion markers, in hex.  The block is rendered a\n   * transparent grey by changing the fill opacity in CSS.\n   *\n   * @internal\n   */\n  INSERTION_MARKER_COLOUR = '#000000';\n\n  /**\n   * The insertion marker opacity.\n   *\n   * @internal\n   */\n  INSERTION_MARKER_OPACITY = 0.2;\n\n  SHAPES: {[key: string]: number} = {PUZZLE: 1, NOTCH: 2};\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  JAGGED_TEETH!: JaggedTeeth;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  NOTCH!: Notch;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  START_HAT!: StartHat;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  PUZZLE_TAB!: PuzzleTab;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  INSIDE_CORNERS!: InsideCorners;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  OUTSIDE_CORNERS!: OutsideCorners;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  /** @internal */\n  blockStyles!: {[key: string]: BlockStyle};\n\n  /** @internal */\n  constructor() {\n    /**\n     * Offset from the top of the row for placing fields on inline input rows\n     * and statement input rows.\n     * Matches existing rendering (in 2019).\n     */\n    this.TALL_INPUT_FIELD_OFFSET_Y = this.MEDIUM_PADDING;\n\n    /** The minimum height of a dummy input row. */\n    this.DUMMY_INPUT_MIN_HEIGHT = this.TAB_HEIGHT;\n\n    /** The minimum height of a dummy input row in a shadow block. */\n    this.DUMMY_INPUT_SHADOW_MIN_HEIGHT = this.TAB_HEIGHT;\n\n    /**\n     * Additional offset added to the statement input's width to account for the\n     * notch.\n     */\n    this.STATEMENT_INPUT_NOTCH_OFFSET = this.NOTCH_OFFSET_LEFT;\n\n    /** The top row's minimum height. */\n    this.TOP_ROW_MIN_HEIGHT = this.MEDIUM_PADDING;\n\n    /** The top row's minimum height if it precedes a statement. */\n    this.TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT = this.LARGE_PADDING;\n\n    /** The bottom row's minimum height. */\n    this.BOTTOM_ROW_MIN_HEIGHT = this.MEDIUM_PADDING;\n\n    /** The bottom row's minimum height if it follows a statement input. */\n    this.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT = this.LARGE_PADDING;\n\n    /** The height of an empty inline input. */\n    this.EMPTY_INLINE_INPUT_HEIGHT = this.TAB_HEIGHT + 11;\n\n    /**\n     * The height of an empty statement input.  Note that in the old rendering\n     * this varies slightly depending on whether the block has external or\n     * inline inputs. In the new rendering this is consistent.  It seems\n     * unlikely that the old behaviour was intentional.\n     */\n    this.EMPTY_STATEMENT_INPUT_HEIGHT = this.MIN_BLOCK_HEIGHT;\n\n    this.START_POINT = svgPaths.moveBy(0, 0);\n\n    /**\n     * A field's text element's dominant baseline. Pre-2022 this could be false\n     * for certain browsers.\n     */\n    this.FIELD_TEXT_BASELINE_CENTER = true;\n\n    /** A dropdown field's border rect height. */\n    this.FIELD_DROPDOWN_BORDER_RECT_HEIGHT = this.FIELD_BORDER_RECT_HEIGHT;\n\n    /** A dropdown field's SVG arrow padding. */\n    this.FIELD_DROPDOWN_SVG_ARROW_PADDING = this.FIELD_BORDER_RECT_X_PADDING;\n\n    /** A dropdown field's SVG arrow datauri. */\n    this.FIELD_DROPDOWN_SVG_ARROW_DATAURI =\n        'data:image/svg+xml;base64,PHN2ZyBpZD0iTGF5ZXJfMSIgZGF0YS1uYW1lPSJMYXllci' +\n        'AxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMi43MSIgaG' +\n        'VpZ2h0PSI4Ljc5IiB2aWV3Qm94PSIwIDAgMTIuNzEgOC43OSI+PHRpdGxlPmRyb3Bkb3duLW' +\n        'Fycm93PC90aXRsZT48ZyBvcGFjaXR5PSIwLjEiPjxwYXRoIGQ9Ik0xMi43MSwyLjQ0QTIuND' +\n        'EsMi40MSwwLDAsMSwxMiw0LjE2TDguMDgsOC4wOGEyLjQ1LDIuNDUsMCwwLDEtMy40NSwwTD' +\n        'AuNzIsNC4xNkEyLjQyLDIuNDIsMCwwLDEsMCwyLjQ0LDIuNDgsMi40OCwwLDAsMSwuNzEuNz' +\n        'FDMSwwLjQ3LDEuNDMsMCw2LjM2LDBTMTEuNzUsMC40NiwxMiwuNzFBMi40NCwyLjQ0LDAsMC' +\n        'wxLDEyLjcxLDIuNDRaIiBmaWxsPSIjMjMxZjIwIi8+PC9nPjxwYXRoIGQ9Ik02LjM2LDcuNz' +\n        'lhMS40MywxLjQzLDAsMCwxLTEtLjQyTDEuNDIsMy40NWExLjQ0LDEuNDQsMCwwLDEsMC0yYz' +\n        'AuNTYtLjU2LDkuMzEtMC41Niw5Ljg3LDBhMS40NCwxLjQ0LDAsMCwxLDAsMkw3LjM3LDcuMz' +\n        'dBMS40MywxLjQzLDAsMCwxLDYuMzYsNy43OVoiIGZpbGw9IiNmZmYiLz48L3N2Zz4=';\n\n    /** A colour field's default height. */\n    this.FIELD_COLOUR_DEFAULT_HEIGHT = this.FIELD_BORDER_RECT_HEIGHT;\n\n    /** A checkbox field's X offset. */\n    this.FIELD_CHECKBOX_X_OFFSET = this.FIELD_BORDER_RECT_X_PADDING - 3;\n\n    /**\n     * A random identifier used to ensure a unique ID is used for each\n     * filter/pattern for the case of multiple Blockly instances on a page.\n     *\n     * @internal\n     */\n    this.randomIdentifier = String(Math.random()).substring(2);\n  }\n\n  /**\n   * Initialize shape objects based on the constants set in the constructor.\n   *\n   * @internal\n   */\n  init() {\n    /**\n     * An object containing sizing and path information about collapsed block\n     * indicators.\n     */\n    this.JAGGED_TEETH = this.makeJaggedTeeth();\n\n    /** An object containing sizing and path information about notches. */\n    this.NOTCH = this.makeNotch();\n\n    /** An object containing sizing and path information about start hats */\n    this.START_HAT = this.makeStartHat();\n\n    /**\n     * An object containing sizing and path information about puzzle tabs.\n     */\n    this.PUZZLE_TAB = this.makePuzzleTab();\n\n    /**\n     * An object containing sizing and path information about inside corners\n     */\n    this.INSIDE_CORNERS = this.makeInsideCorners();\n\n    /**\n     * An object containing sizing and path information about outside corners.\n     */\n    this.OUTSIDE_CORNERS = this.makeOutsideCorners();\n  }\n\n  /**\n   * Refresh constants properties that depend on the theme.\n   *\n   * @param theme The current workspace theme.\n   * @internal\n   */\n  setTheme(theme: Theme) {\n    /** The block styles map. */\n    this.blockStyles = Object.create(null);\n\n    const blockStyles = theme.blockStyles;\n    for (const key in blockStyles) {\n      this.blockStyles[key] = this.validatedBlockStyle_(blockStyles[key]);\n    }\n\n    this.setDynamicProperties_(theme);\n  }\n\n  /**\n   * Sets dynamic properties that depend on other values or theme properties.\n   *\n   * @param theme The current workspace theme.\n   */\n  protected setDynamicProperties_(theme: Theme) {\n    this.setFontConstants_(theme);\n    this.setComponentConstants_(theme);\n\n    this.ADD_START_HATS =\n        theme.startHats !== undefined ? theme.startHats : this.ADD_START_HATS;\n  }\n\n  /**\n   * Set constants related to fonts.\n   *\n   * @param theme The current workspace theme.\n   */\n  protected setFontConstants_(theme: Theme) {\n    if (theme.fontStyle && theme.fontStyle['family']) {\n      this.FIELD_TEXT_FONTFAMILY = theme.fontStyle['family'];\n    }\n\n    if (theme.fontStyle && theme.fontStyle['weight']) {\n      this.FIELD_TEXT_FONTWEIGHT = theme.fontStyle['weight'];\n    }\n\n    if (theme.fontStyle && theme.fontStyle['size']) {\n      this.FIELD_TEXT_FONTSIZE = theme.fontStyle['size'];\n    }\n\n    const fontMetrics = dom.measureFontMetrics(\n        'Hg', this.FIELD_TEXT_FONTSIZE + 'pt', this.FIELD_TEXT_FONTWEIGHT,\n        this.FIELD_TEXT_FONTFAMILY);\n\n    this.FIELD_TEXT_HEIGHT = fontMetrics.height;\n    this.FIELD_TEXT_BASELINE = fontMetrics.baseline;\n  }\n\n  /**\n   * Set constants from a theme's component styles.\n   *\n   * @param theme The current workspace theme.\n   */\n  protected setComponentConstants_(theme: Theme) {\n    this.CURSOR_COLOUR =\n        theme.getComponentStyle('cursorColour') || this.CURSOR_COLOUR;\n    this.MARKER_COLOUR =\n        theme.getComponentStyle('markerColour') || this.MARKER_COLOUR;\n    this.INSERTION_MARKER_COLOUR =\n        theme.getComponentStyle('insertionMarkerColour') ||\n        this.INSERTION_MARKER_COLOUR;\n    this.INSERTION_MARKER_OPACITY =\n        Number(theme.getComponentStyle('insertionMarkerOpacity')) ||\n        this.INSERTION_MARKER_OPACITY;\n  }\n\n  /**\n   * Get or create a block style based on a single colour value.  Generate a\n   * name for the style based on the colour.\n   *\n   * @param colour #RRGGBB colour string.\n   * @returns An object containing the style and an autogenerated name for that\n   *     style.\n   * @internal\n   */\n  getBlockStyleForColour(colour: string): {style: BlockStyle, name: string} {\n    const name = 'auto_' + colour;\n    if (!this.blockStyles[name]) {\n      this.blockStyles[name] = this.createBlockStyle_(colour);\n    }\n    return {style: this.blockStyles[name], name};\n  }\n\n  /**\n   * Gets the BlockStyle for the given block style name.\n   *\n   * @param blockStyleName The name of the block style.\n   * @returns The named block style, or a default style if no style with the\n   *     given name was found.\n   */\n  getBlockStyle(blockStyleName: string|null): BlockStyle {\n    return this.blockStyles[blockStyleName || ''] ||\n        (blockStyleName && blockStyleName.indexOf('auto_') === 0 ?\n             this.getBlockStyleForColour(blockStyleName.substring(5)).style :\n             this.createBlockStyle_('#000000'));\n  }\n\n  /**\n   * Create a block style object based on the given colour.\n   *\n   * @param colour #RRGGBB colour string.\n   * @returns A populated block style based on the given colour.\n   */\n  protected createBlockStyle_(colour: string): BlockStyle {\n    return this.validatedBlockStyle_({'colourPrimary': colour});\n  }\n\n  /**\n   * Get a full block style object based on the input style object.  Populate\n   * any missing values.\n   *\n   * @param blockStyle A full or partial block style object.\n   * @returns A full block style object, with all required properties populated.\n   */\n  protected validatedBlockStyle_(blockStyle: Partial<BlockStyle>): BlockStyle {\n    // Make a new object with all of the same properties.\n    const valid = {} as BlockStyle;\n    if (blockStyle) {\n      Object.assign(valid, blockStyle);\n    }\n    // Validate required properties.\n    const parsedColour =\n        parsing.parseBlockColour(valid['colourPrimary'] || '#000');\n    valid.colourPrimary = parsedColour.hex;\n    valid.colourSecondary = valid['colourSecondary'] ?\n        parsing.parseBlockColour(valid['colourSecondary']).hex :\n        this.generateSecondaryColour_(valid.colourPrimary);\n    valid.colourTertiary = valid['colourTertiary'] ?\n        parsing.parseBlockColour(valid['colourTertiary']).hex :\n        this.generateTertiaryColour_(valid.colourPrimary);\n\n    valid.hat = valid['hat'] || '';\n    return valid;\n  }\n\n  /**\n   * Generate a secondary colour from the passed in primary colour.\n   *\n   * @param inputColour Primary colour.\n   * @returns The generated secondary colour.\n   */\n  protected generateSecondaryColour_(inputColour: string): string {\n    return colour.blend('#fff', inputColour, 0.6) || inputColour;\n  }\n\n  /**\n   * Generate a tertiary colour from the passed in primary colour.\n   *\n   * @param inputColour Primary colour.\n   * @returns The generated tertiary colour.\n   */\n  protected generateTertiaryColour_(inputColour: string): string {\n    return colour.blend('#fff', inputColour, 0.3) || inputColour;\n  }\n\n  /**\n   * Dispose of this constants provider.\n   * Delete all DOM elements that this provider created.\n   *\n   * @internal\n   */\n  dispose() {\n    if (this.embossFilter_) {\n      dom.removeNode(this.embossFilter_);\n    }\n    if (this.disabledPattern_) {\n      dom.removeNode(this.disabledPattern_);\n    }\n    if (this.debugFilter_) {\n      dom.removeNode(this.debugFilter_);\n    }\n    this.cssNode_ = null;\n  }\n\n  /**\n   * @returns An object containing sizing and path information about collapsed\n   *     block indicators.\n   * @internal\n   */\n  makeJaggedTeeth(): JaggedTeeth {\n    const height = this.JAGGED_TEETH_HEIGHT;\n    const width = this.JAGGED_TEETH_WIDTH;\n\n    const mainPath = svgPaths.line([\n      svgPaths.point(width, height / 4),\n      svgPaths.point(-width * 2, height / 2),\n      svgPaths.point(width, height / 4),\n    ]);\n    return {height, width, path: mainPath};\n  }\n\n  /**\n   * @returns An object containing sizing and path information about start hats.\n   * @internal\n   */\n  makeStartHat(): StartHat {\n    const height = this.START_HAT_HEIGHT;\n    const width = this.START_HAT_WIDTH;\n\n    const mainPath = svgPaths.curve('c', [\n      svgPaths.point(30, -height),\n      svgPaths.point(70, -height),\n      svgPaths.point(width, 0),\n    ]);\n    return {height, width, path: mainPath};\n  }\n\n  /**\n   * @returns An object containing sizing and path information about puzzle\n   *     tabs.\n   * @internal\n   */\n  makePuzzleTab(): PuzzleTab {\n    const width = this.TAB_WIDTH;\n    const height = this.TAB_HEIGHT;\n\n    /**\n     * Make the main path for the puzzle tab made out of a few curves (c and s).\n     * Those curves are defined with relative positions.  The 'up' and 'down'\n     * versions of the paths are the same, but the Y sign flips.  Forward and\n     * back are the signs to use to move the cursor in the direction that the\n     * path is being drawn.\n     *\n     * @param up True if the path should be drawn from bottom to top, false\n     *     otherwise.\n     * @returns A path fragment describing a puzzle tab.\n     */\n    function makeMainPath(up: boolean): string {\n      const forward = up ? -1 : 1;\n      const back = -forward;\n\n      const overlap = 2.5;\n      const halfHeight = height / 2;\n      const control1Y = halfHeight + overlap;\n      const control2Y = halfHeight + 0.5;\n      const control3Y = overlap;  // 2.5\n\n      const endPoint1 = svgPaths.point(-width, forward * halfHeight);\n      const endPoint2 = svgPaths.point(width, forward * halfHeight);\n\n      return svgPaths.curve(\n                 'c',\n                 [\n                   svgPaths.point(0, forward * control1Y),\n                   svgPaths.point(-width, back * control2Y),\n                   endPoint1,\n                 ]) +\n          svgPaths.curve(\n              's', [svgPaths.point(width, back * control3Y), endPoint2]);\n    }\n\n    // c 0,-10  -8,8  -8,-7.5  s 8,2.5  8,-7.5\n    const pathUp = makeMainPath(true);\n    // c 0,10  -8,-8  -8,7.5  s 8,-2.5  8,7.5\n    const pathDown = makeMainPath(false);\n\n    return {\n      type: this.SHAPES.PUZZLE,\n      width,\n      height,\n      pathDown,\n      pathUp,\n    };\n  }\n\n  /**\n   * @returns An object containing sizing and path information about notches.\n   * @internal\n   */\n  makeNotch(): Notch {\n    const width = this.NOTCH_WIDTH;\n    const height = this.NOTCH_HEIGHT;\n    const innerWidth = 3;\n    const outerWidth = (width - innerWidth) / 2;\n\n    /**\n     * Make the main path for the notch.\n     *\n     * @param dir Direction multiplier to apply to horizontal offsets along the\n     *     path. Either 1 or -1.\n     * @returns A path fragment describing a notch.\n     */\n    function makeMainPath(dir: number): string {\n      return svgPaths.line([\n        svgPaths.point(dir * outerWidth, height),\n        svgPaths.point(dir * innerWidth, 0),\n        svgPaths.point(dir * outerWidth, -height),\n      ]);\n    }\n    const pathLeft = makeMainPath(1);\n    const pathRight = makeMainPath(-1);\n\n    return {\n      type: this.SHAPES.NOTCH,\n      width,\n      height,\n      pathLeft,\n      pathRight,\n    };\n  }\n\n  /**\n   * @returns An object containing sizing and path information about inside\n   *     corners.\n   * @internal\n   */\n  makeInsideCorners(): InsideCorners {\n    const radius = this.CORNER_RADIUS;\n\n    const innerTopLeftCorner =\n        svgPaths.arc('a', '0 0,0', radius, svgPaths.point(-radius, radius));\n\n    const innerBottomLeftCorner =\n        svgPaths.arc('a', '0 0,0', radius, svgPaths.point(radius, radius));\n\n    return {\n      width: radius,\n      height: radius,\n      pathTop: innerTopLeftCorner,\n      pathBottom: innerBottomLeftCorner,\n    };\n  }\n\n  /**\n   * @returns An object containing sizing and path information about outside\n   *     corners.\n   * @internal\n   */\n  makeOutsideCorners(): OutsideCorners {\n    const radius = this.CORNER_RADIUS;\n    /** SVG path for drawing the rounded top-left corner. */\n    const topLeft = svgPaths.moveBy(0, radius) +\n        svgPaths.arc('a', '0 0,1', radius, svgPaths.point(radius, -radius));\n\n    /** SVG path for drawing the rounded top-right corner. */\n    const topRight =\n        svgPaths.arc('a', '0 0,1', radius, svgPaths.point(radius, radius));\n\n    /** SVG path for drawing the rounded bottom-left corner. */\n    const bottomLeft =\n        svgPaths.arc('a', '0 0,1', radius, svgPaths.point(-radius, -radius));\n\n    /** SVG path for drawing the rounded bottom-right corner. */\n    const bottomRight =\n        svgPaths.arc('a', '0 0,1', radius, svgPaths.point(-radius, radius));\n\n    return {\n      topLeft,\n      topRight,\n      bottomRight,\n      bottomLeft,\n      rightHeight: radius,\n    };\n  }\n\n  /**\n   * Get an object with connection shape and sizing information based on the\n   * type of the connection.\n   *\n   * @param connection The connection to find a shape object for\n   * @returns The shape object for the connection.\n   * @internal\n   */\n  shapeFor(connection: RenderedConnection): Shape {\n    switch (connection.type) {\n      case ConnectionType.INPUT_VALUE:\n      case ConnectionType.OUTPUT_VALUE:\n        return this.PUZZLE_TAB;\n      case ConnectionType.PREVIOUS_STATEMENT:\n      case ConnectionType.NEXT_STATEMENT:\n        return this.NOTCH;\n      default:\n        throw Error('Unknown connection type');\n    }\n  }\n\n  /**\n   * Create any DOM elements that this renderer needs (filters, patterns, etc).\n   *\n   * @param svg The root of the workspace's SVG.\n   * @param tagName The name to use for the CSS style tag.\n   * @param selector The CSS selector to use.\n   * @suppress {strictModuleDepCheck} Debug renderer only included in\n   * playground.\n   * @internal\n   */\n  createDom(svg: SVGElement, tagName: string, selector: string) {\n    this.injectCSS_(tagName, selector);\n\n    /*\n        <defs>\n          ... filters go here ...\n        </defs>\n        */\n    this.defs_ = dom.createSvgElement(Svg.DEFS, {}, svg);\n    /*\n          <filter id=\"blocklyEmbossFilter837493\">\n            <feGaussianBlur in=\"SourceAlpha\" stdDeviation=\"1\" result=\"blur\" />\n            <feSpecularLighting in=\"blur\" surfaceScale=\"1\"\n       specularConstant=\"0.5\" specularExponent=\"10\" lighting-color=\"white\"\n                                result=\"specOut\">\n              <fePointLight x=\"-5000\" y=\"-10000\" z=\"20000\" />\n            </feSpecularLighting>\n            <feComposite in=\"specOut\" in2=\"SourceAlpha\" operator=\"in\"\n                         result=\"specOut\" />\n            <feComposite in=\"SourceGraphic\" in2=\"specOut\" operator=\"arithmetic\"\n                         k1=\"0\" k2=\"1\" k3=\"1\" k4=\"0\" />\n          </filter>\n        */\n    const embossFilter = dom.createSvgElement(\n        Svg.FILTER, {'id': 'blocklyEmbossFilter' + this.randomIdentifier},\n        this.defs_);\n    dom.createSvgElement(\n        Svg.FEGAUSSIANBLUR,\n        {'in': 'SourceAlpha', 'stdDeviation': 1, 'result': 'blur'},\n        embossFilter);\n    const feSpecularLighting = dom.createSvgElement(\n        Svg.FESPECULARLIGHTING, {\n          'in': 'blur',\n          'surfaceScale': 1,\n          'specularConstant': 0.5,\n          'specularExponent': 10,\n          'lighting-color': 'white',\n          'result': 'specOut',\n        },\n        embossFilter);\n    dom.createSvgElement(\n        Svg.FEPOINTLIGHT, {'x': -5000, 'y': -10000, 'z': 20000},\n        feSpecularLighting);\n    dom.createSvgElement(\n        Svg.FECOMPOSITE, {\n          'in': 'specOut',\n          'in2': 'SourceAlpha',\n          'operator': 'in',\n          'result': 'specOut',\n        },\n        embossFilter);\n    dom.createSvgElement(\n        Svg.FECOMPOSITE, {\n          'in': 'SourceGraphic',\n          'in2': 'specOut',\n          'operator': 'arithmetic',\n          'k1': 0,\n          'k2': 1,\n          'k3': 1,\n          'k4': 0,\n        },\n        embossFilter);\n    this.embossFilterId = embossFilter.id;\n    this.embossFilter_ = embossFilter;\n\n    /*\n          <pattern id=\"blocklyDisabledPattern837493\"\n       patternUnits=\"userSpaceOnUse\" width=\"10\" height=\"10\"> <rect width=\"10\"\n       height=\"10\" fill=\"#aaa\" /> <path d=\"M 0 0 L 10 10 M 10 0 L 0 10\"\n       stroke=\"#cc0\" />\n          </pattern>\n        */\n    const disabledPattern = dom.createSvgElement(\n        Svg.PATTERN, {\n          'id': 'blocklyDisabledPattern' + this.randomIdentifier,\n          'patternUnits': 'userSpaceOnUse',\n          'width': 10,\n          'height': 10,\n        },\n        this.defs_);\n    dom.createSvgElement(\n        Svg.RECT, {'width': 10, 'height': 10, 'fill': '#aaa'}, disabledPattern);\n    dom.createSvgElement(\n        Svg.PATH, {'d': 'M 0 0 L 10 10 M 10 0 L 0 10', 'stroke': '#cc0'},\n        disabledPattern);\n    this.disabledPatternId = disabledPattern.id;\n    this.disabledPattern_ = disabledPattern;\n\n    this.createDebugFilter();\n  }\n\n  /**\n   * Create a filter for highlighting the currently rendering block during\n   * render debugging.\n   */\n  private createDebugFilter() {\n    // Only create the debug filter once.\n    if (!this.debugFilter_) {\n      const debugFilter = dom.createSvgElement(\n          Svg.FILTER, {\n            'id': 'blocklyDebugFilter' + this.randomIdentifier,\n            'height': '160%',\n            'width': '180%',\n            'y': '-30%',\n            'x': '-40%',\n          },\n          this.defs_);\n      // Set all gaussian blur pixels to 1 opacity before applying flood\n      const debugComponentTransfer = dom.createSvgElement(\n          Svg.FECOMPONENTTRANSFER, {'result': 'outBlur'}, debugFilter);\n      dom.createSvgElement(\n          Svg.FEFUNCA,\n          {'type': 'table', 'tableValues': '0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1'},\n          debugComponentTransfer);\n      // Color the highlight\n      dom.createSvgElement(\n          Svg.FEFLOOD, {\n            'flood-color': '#ff0000',\n            'flood-opacity': 0.5,\n            'result': 'outColor',\n          },\n          debugFilter);\n      dom.createSvgElement(\n          Svg.FECOMPOSITE, {\n            'in': 'outColor',\n            'in2': 'outBlur',\n            'operator': 'in',\n            'result': 'outGlow',\n          },\n          debugFilter);\n      this.debugFilterId = debugFilter.id;\n      this.debugFilter_ = debugFilter;\n    }\n  }\n\n  /**\n   * Inject renderer specific CSS into the page.\n   *\n   * @param tagName The name of the style tag to use.\n   * @param selector The CSS selector to use.\n   */\n  protected injectCSS_(tagName: string, selector: string) {\n    const cssArray = this.getCSS_(selector);\n    const cssNodeId = 'blockly-renderer-style-' + tagName;\n    this.cssNode_ = document.getElementById(cssNodeId) as HTMLStyleElement;\n    const text = cssArray.join('\\n');\n    if (this.cssNode_) {\n      // Already injected, update if the theme changed.\n      this.cssNode_.firstChild!.textContent = text;\n      return;\n    }\n    // Inject CSS tag at start of head.\n    const cssNode = (document.createElement('style'));\n    cssNode.id = cssNodeId;\n    const cssTextNode = document.createTextNode(text);\n    cssNode.appendChild(cssTextNode);\n    document.head.insertBefore(cssNode, document.head.firstChild);\n    this.cssNode_ = cssNode;\n  }\n\n  /**\n   * Get any renderer specific CSS to inject when the renderer is initialized.\n   *\n   * @param selector CSS selector to use.\n   * @returns Array of CSS strings.\n   */\n  protected getCSS_(selector: string): string[] {\n    return [\n      /* eslint-disable indent */\n      /* clang-format off */\n      // Text.\n      `${selector} .blocklyText, `,\n      `${selector} .blocklyFlyoutLabelText {`,\n        `font: ${this.FIELD_TEXT_FONTWEIGHT} ` +\n            `${this.FIELD_TEXT_FONTSIZE}pt ${this.FIELD_TEXT_FONTFAMILY};`,\n      `}`,\n\n      // Fields.\n      `${selector} .blocklyText {`,\n        `fill: #fff;`,\n      `}`,\n      `${selector} .blocklyNonEditableText>rect,`,\n      `${selector} .blocklyEditableText>rect {`,\n        `fill: ${this.FIELD_BORDER_RECT_COLOUR};`,\n        `fill-opacity: .6;`,\n        `stroke: none;`,\n      `}`,\n      `${selector} .blocklyNonEditableText>text,`,\n      `${selector} .blocklyEditableText>text {`,\n        `fill: #000;`,\n      `}`,\n\n      // Flyout labels.\n      `${selector} .blocklyFlyoutLabelText {`,\n        `fill: #000;`,\n      `}`,\n\n      // Bubbles.\n      `${selector} .blocklyText.blocklyBubbleText {`,\n        `fill: #000;`,\n      `}`,\n\n      // Editable field hover.\n      `${selector} .blocklyEditableText:not(.editing):hover>rect {`,\n        `stroke: #fff;`,\n        `stroke-width: 2;`,\n      `}`,\n\n      // Text field input.\n      `${selector} .blocklyHtmlInput {`,\n        `font-family: ${this.FIELD_TEXT_FONTFAMILY};`,\n        `font-weight: ${this.FIELD_TEXT_FONTWEIGHT};`,\n      `}`,\n\n      // Selection highlight.\n      `${selector} .blocklySelected>.blocklyPath {`,\n        `stroke: #fc3;`,\n        `stroke-width: 3px;`,\n      `}`,\n\n      // Connection highlight.\n      `${selector} .blocklyHighlightedConnectionPath {`,\n        `stroke: #fc3;`,\n      `}`,\n\n      // Replaceable highlight.\n      `${selector} .blocklyReplaceable .blocklyPath {`,\n        `fill-opacity: .5;`,\n      `}`,\n      `${selector} .blocklyReplaceable .blocklyPathLight,`,\n      `${selector} .blocklyReplaceable .blocklyPathDark {`,\n        `display: none;`,\n      `}`,\n\n      // Insertion marker.\n      `${selector} .blocklyInsertionMarker>.blocklyPath {`,\n        `fill-opacity: ${this.INSERTION_MARKER_OPACITY};`,\n        `stroke: none;`,\n      `}`,\n      /* clang-format on */\n      /* eslint-enable indent */\n    ];\n  }\n}\n/* clang-format on */\n/* eslint-enable indent */\n","/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Block rendering debugging functionality.\n *\n * @namespace Blockly.blockRendering.debug\n */\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.debug');\n\nimport * as deprecation from '../../utils/deprecation.js';\n\n\n/** Whether or not the debugger is turned on. */\nlet useDebugger = false;\n/**\n * Returns whether the debugger is turned on.\n *\n * @returns Whether the debugger is turned on.\n * @alias Blockly.blockRendering.debug.isDebuggerEnabled\n * @internal\n */\nexport function isDebuggerEnabled(): boolean {\n  return useDebugger;\n}\n\n/**\n * Turn on the blocks debugger.\n *\n * @alias Blockly.blockRendering.debug.startDebugger\n * @deprecated March 2022. Use the rendering debugger in @blockly/dev-tools.\n * See https://www.npmjs.com/package/@blockly/dev-tools for more information.\n * @internal\n */\nexport function startDebugger() {\n  deprecation.warn(\n      'Blockly.blockRendering.debug.startDebugger()', 'version 8', 'version 10',\n      'the debug renderer in @blockly/dev-tools (See https://www.npmjs.com/package/@blockly/dev-tools.)');\n  useDebugger = true;\n}\n\n/**\n * Turn off the blocks debugger.\n *\n * @alias Blockly.blockRendering.debug.stopDebugger\n * @deprecated March 2022. Use the rendering debugger in @blockly/dev-tools.\n * See https://www.npmjs.com/package/@blockly/dev-tools for more information.\n * @internal\n */\nexport function stopDebugger() {\n  deprecation.warn(\n      'Blockly.blockRendering.debug.stopDebugger()', 'version 8', 'version 10',\n      'the debug renderer in @blockly/dev-tools (See https://www.npmjs.com/package/@blockly/dev-tools.)');\n  useDebugger = false;\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Namespace for block rendering functionality.\n *\n * @namespace Blockly.blockRendering\n */\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering');\n\nimport * as registry from '../../registry.js';\nimport type {Theme} from '../../theme.js';\nimport * as deprecation from '../../utils/deprecation.js';\nimport {Measurable} from '../measurables/base.js';\nimport {BottomRow} from '../measurables/bottom_row.js';\nimport {Connection} from '../measurables/connection.js';\nimport {ExternalValueInput} from '../measurables/external_value_input.js';\nimport {Field} from '../measurables/field.js';\nimport {Hat} from '../measurables/hat.js';\nimport {Icon} from '../measurables/icon.js';\nimport {InRowSpacer} from '../measurables/in_row_spacer.js';\nimport {InlineInput} from '../measurables/inline_input.js';\nimport {InputConnection} from '../measurables/input_connection.js';\nimport {InputRow} from '../measurables/input_row.js';\nimport {JaggedEdge} from '../measurables/jagged_edge.js';\nimport {NextConnection} from '../measurables/next_connection.js';\nimport {OutputConnection} from '../measurables/output_connection.js';\nimport {PreviousConnection} from '../measurables/previous_connection.js';\nimport {RoundCorner} from '../measurables/round_corner.js';\nimport {Row} from '../measurables/row.js';\nimport {SpacerRow} from '../measurables/spacer_row.js';\nimport {SquareCorner} from '../measurables/square_corner.js';\nimport {StatementInput} from '../measurables/statement_input.js';\nimport {TopRow} from '../measurables/top_row.js';\nimport {Types} from '../measurables/types.js';\n\nimport {ConstantProvider} from './constants.js';\nimport * as debug from './debug.js';\nimport {Debug} from './debugger.js';\nimport {Drawer} from './drawer.js';\nimport type {IPathObject} from './i_path_object.js';\nimport {RenderInfo} from './info.js';\nimport {MarkerSvg} from './marker_svg.js';\nimport {PathObject} from './path_object.js';\nimport {Renderer} from './renderer.js';\n\n/**\n * Registers a new renderer.\n *\n * @param name The name of the renderer.\n * @param rendererClass The new renderer class to register.\n * @throws {Error} if a renderer with the same name has already been registered.\n */\nexport function register(name: string, rendererClass: Function) {\n  registry.register(registry.Type.RENDERER, name, rendererClass);\n}\n\n/**\n * Unregisters the renderer registered with the given name.\n *\n * @param name The name of the renderer.\n * @alias Blockly.blockRendering.unregister\n */\nexport function unregister(name: string) {\n  registry.unregister(registry.Type.RENDERER, name);\n}\n\n/**\n * Turn off the blocks debugger.\n *\n * @alias Blockly.blockRendering.stopDebugger\n * @deprecated Use the debug renderer in **\\@blockly/dev-tools** (See {@link\n *     https://www.npmjs.com/package/@blockly/dev-tools}.)\n * @internal\n */\nexport function stopDebugger() {\n  deprecation.warn(\n      'Blockly.blockRendering.stopDebugger()', 'September 2021',\n      'September 2022',\n      'the debug renderer in @blockly/dev-tools (See https://www.npmjs.com/package/@blockly/dev-tools.)');\n  debug.stopDebugger();\n}\n\n/**\n * Initialize anything needed for rendering (constants, etc).\n *\n * @param name Name of the renderer to initialize.\n * @param theme The workspace theme object.\n * @param opt_rendererOverrides Rendering constant overrides.\n * @returns The new instance of a renderer.\n *     Already initialized.\n * @alias Blockly.blockRendering.init\n * @internal\n */\nexport function init(\n    name: string, theme: Theme,\n    opt_rendererOverrides?: {[rendererConstant: string]: any}): Renderer {\n  const rendererClass = registry.getClass(registry.Type.RENDERER, name);\n  const renderer = new rendererClass!(name);\n  renderer.init(theme, opt_rendererOverrides);\n  return renderer;\n}\nexport {BottomRow};\nexport {Connection};\nexport {ConstantProvider};\nexport {Debug};\nexport {Drawer};\nexport {ExternalValueInput};\nexport {Field};\nexport {Hat};\nexport {Icon};\nexport {InRowSpacer};\nexport {InlineInput};\nexport {InputConnection};\nexport {InputRow};\nexport {IPathObject};\nexport {JaggedEdge};\nexport {MarkerSvg};\nexport {Measurable};\nexport {NextConnection};\nexport {OutputConnection};\nexport {PathObject};\nexport {PreviousConnection};\nexport {Renderer};\nexport {RenderInfo};\nexport {RoundCorner};\nexport {Row};\nexport {SpacerRow};\nexport {SquareCorner};\nexport {StatementInput};\nexport {TopRow};\nexport {Types};\n","/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Utility functions for handling typed variables.\n *\n * @namespace Blockly.VariablesDynamic\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.VariablesDynamic');\n\nimport {Blocks} from './blocks.js';\nimport {Msg} from './msg.js';\nimport * as xml from './utils/xml.js';\nimport {VariableModel} from './variable_model.js';\nimport * as Variables from './variables.js';\nimport type {Workspace} from './workspace.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\nimport type {FlyoutButton} from './flyout_button.js';\n\n\n/**\n * String for use in the \"custom\" attribute of a category in toolbox XML.\n * This string indicates that the category should be dynamically populated with\n * variable blocks.\n * See also Blockly.Variables.CATEGORY_NAME and\n * Blockly.Procedures.CATEGORY_NAME.\n *\n * @alias Blockly.VariablesDynamic.CATEGORY_NAME\n */\nexport const CATEGORY_NAME = 'VARIABLE_DYNAMIC';\n\n/**\n * Click handler for a button that creates String variables.\n *\n * @param button\n */\nfunction stringButtonClickHandler(button: FlyoutButton) {\n  Variables.createVariableButtonHandler(\n      button.getTargetWorkspace(), undefined, 'String');\n}\n// eslint-disable-next-line camelcase\nexport const onCreateVariableButtonClick_String = stringButtonClickHandler;\n\n/**\n * Click handler for a button that creates Number variables.\n *\n * @param button\n */\nfunction numberButtonClickHandler(button: FlyoutButton) {\n  Variables.createVariableButtonHandler(\n      button.getTargetWorkspace(), undefined, 'Number');\n}\n// eslint-disable-next-line camelcase\nexport const onCreateVariableButtonClick_Number = numberButtonClickHandler;\n\n/**\n * Click handler for a button that creates Colour variables.\n *\n * @param button\n */\nfunction colourButtonClickHandler(button: FlyoutButton) {\n  Variables.createVariableButtonHandler(\n      button.getTargetWorkspace(), undefined, 'Colour');\n}\n// eslint-disable-next-line camelcase\nexport const onCreateVariableButtonClick_Colour = colourButtonClickHandler;\n\n/**\n * Construct the elements (blocks and button) required by the flyout for the\n * variable category.\n *\n * @param workspace The workspace containing variables.\n * @returns Array of XML elements.\n * @alias Blockly.VariablesDynamic.flyoutCategory\n */\nexport function flyoutCategory(workspace: WorkspaceSvg): Element[] {\n  let xmlList = new Array<Element>();\n  let button = document.createElement('button');\n  button.setAttribute('text', Msg['NEW_STRING_VARIABLE']);\n  button.setAttribute('callbackKey', 'CREATE_VARIABLE_STRING');\n  xmlList.push(button);\n  button = document.createElement('button');\n  button.setAttribute('text', Msg['NEW_NUMBER_VARIABLE']);\n  button.setAttribute('callbackKey', 'CREATE_VARIABLE_NUMBER');\n  xmlList.push(button);\n  button = document.createElement('button');\n  button.setAttribute('text', Msg['NEW_COLOUR_VARIABLE']);\n  button.setAttribute('callbackKey', 'CREATE_VARIABLE_COLOUR');\n  xmlList.push(button);\n\n  workspace.registerButtonCallback(\n      'CREATE_VARIABLE_STRING', stringButtonClickHandler);\n  workspace.registerButtonCallback(\n      'CREATE_VARIABLE_NUMBER', numberButtonClickHandler);\n  workspace.registerButtonCallback(\n      'CREATE_VARIABLE_COLOUR', colourButtonClickHandler);\n\n  const blockList = flyoutCategoryBlocks(workspace);\n  xmlList = xmlList.concat(blockList);\n  return xmlList;\n}\n\n/**\n * Construct the blocks required by the flyout for the variable category.\n *\n * @param workspace The workspace containing variables.\n * @returns Array of XML block elements.\n * @alias Blockly.VariablesDynamic.flyoutCategoryBlocks\n */\nexport function flyoutCategoryBlocks(workspace: Workspace): Element[] {\n  const variableModelList = workspace.getAllVariables();\n\n  const xmlList = [];\n  if (variableModelList.length > 0) {\n    if (Blocks['variables_set_dynamic']) {\n      const firstVariable = variableModelList[variableModelList.length - 1];\n      const block = xml.createElement('block');\n      block.setAttribute('type', 'variables_set_dynamic');\n      block.setAttribute('gap', '24');\n      block.appendChild(Variables.generateVariableFieldDom(firstVariable));\n      xmlList.push(block);\n    }\n    if (Blocks['variables_get_dynamic']) {\n      variableModelList.sort(VariableModel.compareByName);\n      for (let i = 0, variable; variable = variableModelList[i]; i++) {\n        const block = xml.createElement('block');\n        block.setAttribute('type', 'variables_get_dynamic');\n        block.setAttribute('gap', '8');\n        block.appendChild(Variables.generateVariableFieldDom(variable));\n        xmlList.push(block);\n      }\n    }\n  }\n  return xmlList;\n}\n","/**\n * @license\n * Copyright 2014 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing a workspace rendered as SVG.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.WorkspaceSvg');\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_create.js';\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_theme_change.js';\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_viewport.js';\n\nimport type {Block} from './block.js';\nimport type {BlockDragSurfaceSvg} from './block_drag_surface.js';\nimport type {BlockSvg} from './block_svg.js';\nimport type {BlocklyOptions} from './blockly_options.js';\nimport * as browserEvents from './browser_events.js';\nimport * as common from './common.js';\nimport {ComponentManager} from './component_manager.js';\nimport {config} from './config.js';\nimport {ConnectionDB} from './connection_db.js';\nimport * as ContextMenu from './contextmenu.js';\nimport {ContextMenuRegistry} from './contextmenu_registry.js';\nimport * as dropDownDiv from './dropdowndiv.js';\nimport * as eventUtils from './events/utils.js';\nimport type {FlyoutButton} from './flyout_button.js';\nimport {Gesture} from './gesture.js';\nimport {Grid} from './grid.js';\nimport type {IASTNodeLocationSvg} from './interfaces/i_ast_node_location_svg.js';\nimport type {IBoundedElement} from './interfaces/i_bounded_element.js';\nimport type {ICopyable} from './interfaces/i_copyable.js';\nimport type {IDragTarget} from './interfaces/i_drag_target.js';\nimport type {IFlyout} from './interfaces/i_flyout.js';\nimport type {IMetricsManager} from './interfaces/i_metrics_manager.js';\nimport type {IToolbox} from './interfaces/i_toolbox.js';\nimport type {Cursor} from './keyboard_nav/cursor.js';\nimport type {Marker} from './keyboard_nav/marker.js';\nimport {MarkerManager} from './marker_manager.js';\nimport {Options} from './options.js';\nimport * as Procedures from './procedures.js';\nimport * as registry from './registry.js';\nimport * as blockRendering from './renderers/common/block_rendering.js';\nimport type {Renderer} from './renderers/common/renderer.js';\nimport type {ScrollbarPair} from './scrollbar_pair.js';\nimport * as blocks from './serialization/blocks.js';\nimport type {Theme} from './theme.js';\nimport {Classic} from './theme/classic.js';\nimport {ThemeManager} from './theme_manager.js';\nimport * as Tooltip from './tooltip.js';\nimport type {Trashcan} from './trashcan.js';\nimport * as arrayUtils from './utils/array.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport type {Metrics} from './utils/metrics.js';\nimport {Rect} from './utils/rect.js';\nimport {Size} from './utils/size.js';\nimport {Svg} from './utils/svg.js';\nimport * as svgMath from './utils/svg_math.js';\nimport * as toolbox from './utils/toolbox.js';\nimport * as userAgent from './utils/useragent.js';\nimport type {VariableModel} from './variable_model.js';\nimport * as Variables from './variables.js';\nimport * as VariablesDynamic from './variables_dynamic.js';\nimport * as WidgetDiv from './widgetdiv.js';\nimport {Workspace} from './workspace.js';\nimport {WorkspaceAudio} from './workspace_audio.js';\nimport {WorkspaceComment} from './workspace_comment.js';\nimport {WorkspaceCommentSvg} from './workspace_comment_svg.js';\nimport type {WorkspaceDragSurfaceSvg} from './workspace_drag_surface_svg.js';\nimport * as Xml from './xml.js';\nimport {ZoomControls} from './zoom_controls.js';\nimport {ContextMenuOption} from './contextmenu_registry.js';\n\n\n/** Margin around the top/bottom/left/right after a zoomToFit call. */\nconst ZOOM_TO_FIT_MARGIN = 20;\n\n/**\n * Class for a workspace.  This is an onscreen area with optional trashcan,\n * scrollbars, bubbles, and dragging.\n *\n * @alias Blockly.WorkspaceSvg\n */\nexport class WorkspaceSvg extends Workspace implements IASTNodeLocationSvg {\n  /**\n   * A wrapper function called when a resize event occurs.\n   * You can pass the result to `eventHandling.unbind`.\n   */\n  private resizeHandlerWrapper: browserEvents.Data|null = null;\n\n  /**\n   * The render status of an SVG workspace.\n   * Returns `false` for headless workspaces and true for instances of\n   * `WorkspaceSvg`.\n   */\n  override rendered = true;\n\n  /**\n   * Whether the workspace is visible.  False if the workspace has been hidden\n   * by calling `setVisible(false)`.\n   */\n  private isVisible_ = true;\n\n  /**\n   * Whether this workspace has resizes enabled.\n   * Disable during batch operations for a performance improvement.\n   */\n  private resizesEnabled = true;\n\n  /**\n   * Current horizontal scrolling offset in pixel units, relative to the\n   * workspace origin.\n   *\n   * It is useful to think about a view, and a canvas moving beneath that\n   * view. As the canvas moves right, this value becomes more positive, and\n   * the view is now \"seeing\" the left side of the canvas. As the canvas moves\n   * left, this value becomes more negative, and the view is now \"seeing\" the\n   * right side of the canvas.\n   *\n   * The confusing thing about this value is that it does not, and must not\n   * include the absoluteLeft offset. This is because it is used to calculate\n   * the viewLeft value.\n   *\n   * The viewLeft is relative to the workspace origin (although in pixel\n   * units). The workspace origin is the top-left corner of the workspace (at\n   * least when it is enabled). It is shifted from the top-left of the\n   * blocklyDiv so as not to be beneath the toolbox.\n   *\n   * When the workspace is enabled the viewLeft and workspace origin are at\n   * the same X location. As the canvas slides towards the right beneath the\n   * view this value (scrollX) becomes more positive, and the viewLeft becomes\n   * more negative relative to the workspace origin (imagine the workspace\n   * origin as a dot on the canvas sliding to the right as the canvas moves).\n   *\n   * So if the scrollX were to include the absoluteLeft this would in a way\n   * \"unshift\" the workspace origin. This means that the viewLeft would be\n   * representing the left edge of the blocklyDiv, rather than the left edge\n   * of the workspace.\n   */\n  scrollX = 0;\n\n  /**\n   * Current vertical scrolling offset in pixel units, relative to the\n   * workspace origin.\n   *\n   * It is useful to think about a view, and a canvas moving beneath that\n   * view. As the canvas moves down, this value becomes more positive, and the\n   * view is now \"seeing\" the upper part of the canvas. As the canvas moves\n   * up, this value becomes more negative, and the view is \"seeing\" the lower\n   * part of the canvas.\n   *\n   * This confusing thing about this value is that it does not, and must not\n   * include the absoluteTop offset. This is because it is used to calculate\n   * the viewTop value.\n   *\n   * The viewTop is relative to the workspace origin (although in pixel\n   * units). The workspace origin is the top-left corner of the workspace (at\n   * least when it is enabled). It is shifted from the top-left of the\n   * blocklyDiv so as not to be beneath the toolbox.\n   *\n   * When the workspace is enabled the viewTop and workspace origin are at the\n   * same Y location. As the canvas slides towards the bottom this value\n   * (scrollY) becomes more positive, and the viewTop becomes more negative\n   * relative to the workspace origin (image in the workspace origin as a dot\n   * on the canvas sliding downwards as the canvas moves).\n   *\n   * So if the scrollY were to include the absoluteTop this would in a way\n   * \"unshift\" the workspace origin. This means that the viewTop would be\n   * representing the top edge of the blocklyDiv, rather than the top edge of\n   * the workspace.\n   */\n  scrollY = 0;\n\n  /** Horizontal scroll value when scrolling started in pixel units. */\n  startScrollX = 0;\n\n  /** Vertical scroll value when scrolling started in pixel units. */\n  startScrollY = 0;\n\n  /** Distance from mouse to object being dragged. */\n  private dragDeltaXY: Coordinate|null = null;\n\n  /** Current scale. */\n  scale = 1;\n\n  /** Cached scale value. Used to detect changes in viewport. */\n  private oldScale = 1;\n\n  /** Cached viewport top value. Used to detect changes in viewport. */\n  private oldTop = 0;\n\n  /** Cached viewport left value. Used to detect changes in viewport. */\n  private oldLeft = 0;\n\n  /** The workspace's trashcan (if any). */\n  trashcan: Trashcan|null = null;\n\n  /** This workspace's scrollbars, if they exist. */\n  scrollbar: ScrollbarPair|null = null;\n\n  /**\n   * Fixed flyout providing blocks which may be dragged into this workspace.\n   */\n  private flyout: IFlyout|null = null;\n\n  /**\n   * Category-based toolbox providing blocks which may be dragged into this\n   * workspace.\n   */\n  private toolbox_: IToolbox|null = null;\n\n  /**\n   * The current gesture in progress on this workspace, if any.\n   *\n   * @internal\n   */\n  currentGesture_: Gesture|null = null;\n\n  /** This workspace's surface for dragging blocks, if it exists. */\n  private readonly blockDragSurface: BlockDragSurfaceSvg|null = null;\n\n  /** This workspace's drag surface, if it exists. */\n  private readonly workspaceDragSurface: WorkspaceDragSurfaceSvg|null = null;\n\n  /**\n   * Whether to move workspace to the drag surface when it is dragged.\n   * True if it should move, false if it should be translated directly.\n   */\n  private readonly useWorkspaceDragSurface;\n\n  /**\n   * Whether the drag surface is actively in use. When true, calls to\n   * translate will translate the drag surface instead of the translating the\n   * workspace directly.\n   * This is set to true in setupDragSurface and to false in resetDragSurface.\n   */\n  private isDragSurfaceActive = false;\n\n  /**\n   * The first parent div with 'injectionDiv' in the name, or null if not set.\n   * Access this with getInjectionDiv.\n   */\n  private injectionDiv: Element|null = null;\n\n  /**\n   * Last known position of the page scroll.\n   * This is used to determine whether we have recalculated screen coordinate\n   * stuff since the page scrolled.\n   */\n  private lastRecordedPageScroll: Coordinate|null = null;\n\n  /**\n   * Developers may define this function to add custom menu options to the\n   * workspace's context menu or edit the workspace-created set of menu\n   * options.\n   *\n   * @param options List of menu options to add to.\n   * @param e The right-click event that triggered the context menu.\n   */\n  configureContextMenu:\n      ((menuOptions: ContextMenuOption[], e: Event) => void)|null = null;\n\n  /**\n   * In a flyout, the target workspace where blocks should be placed after a\n   * drag. Otherwise null.\n   *\n   * @internal\n   */\n  targetWorkspace: WorkspaceSvg|null = null;\n\n  /** Inverted screen CTM, for use in mouseToSvg. */\n  private inverseScreenCTM: SVGMatrix|null = null;\n\n  /** Inverted screen CTM is dirty, recalculate it. */\n  private inverseScreenCTMDirty = true;\n  private metricsManager: IMetricsManager;\n  /** @internal */\n  getMetrics: () => Metrics;\n  /** @internal */\n  setMetrics: (p1: {x?: number, y?: number}) => void;\n  private readonly componentManager: ComponentManager;\n\n  /**\n   * List of currently highlighted blocks.  Block highlighting is often used\n   * to visually mark blocks currently being executed.\n   */\n  private readonly highlightedBlocks: BlockSvg[] = [];\n  private audioManager: WorkspaceAudio;\n  private grid: Grid|null;\n  private markerManager: MarkerManager;\n\n  /**\n   * Map from function names to callbacks, for deciding what to do when a\n   * custom toolbox category is opened.\n   */\n  private toolboxCategoryCallbacks =\n      new Map<string, (p1: WorkspaceSvg) => toolbox.FlyoutDefinition>();\n\n  /**\n   * Map from function names to callbacks, for deciding what to do when a\n   * button is clicked.\n   */\n  private flyoutButtonCallbacks = new Map<string, (p1: FlyoutButton) => void>();\n  protected themeManager_: ThemeManager;\n  private readonly renderer: Renderer;\n\n  /** Cached parent SVG. */\n  private cachedParentSvg: SVGElement|null = null;\n\n  /** True if keyboard accessibility mode is on, false otherwise. */\n  keyboardAccessibilityMode = false;\n\n  /** The list of top-level bounded elements on the workspace. */\n  private topBoundedElements: IBoundedElement[] = [];\n\n  /** The recorded drag targets. */\n  private dragTargetAreas: Array<{component: IDragTarget, clientRect: Rect}> =\n      [];\n  private readonly cachedParentSvgSize: Size;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  svgGroup_!: SVGElement;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  svgBackground_!: SVGElement;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  svgBlockCanvas_!: SVGElement;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  svgBubbleCanvas_!: SVGElement;\n  zoomControls_: ZoomControls|null = null;\n\n  /**\n   * @param options Dictionary of options.\n   * @param opt_blockDragSurface Drag surface for blocks.\n   * @param opt_wsDragSurface Drag surface for the workspace.\n   */\n  constructor(\n      options: Options, opt_blockDragSurface?: BlockDragSurfaceSvg,\n      opt_wsDragSurface?: WorkspaceDragSurfaceSvg) {\n    super(options);\n\n    const MetricsManagerClass = registry.getClassFromOptions(\n        registry.Type.METRICS_MANAGER, options, true);\n    /** Object in charge of calculating metrics for the workspace. */\n    this.metricsManager = new MetricsManagerClass!(this);\n\n    /** Method to get all the metrics that have to do with a workspace. */\n    this.getMetrics = options.getMetrics ||\n        this.metricsManager.getMetrics.bind(this.metricsManager);\n\n    /** Translates the workspace. */\n    this.setMetrics =\n        options.setMetrics || WorkspaceSvg.setTopLevelWorkspaceMetrics_;\n\n    this.componentManager = new ComponentManager();\n\n    this.connectionDBList = ConnectionDB.init(this.connectionChecker);\n\n    if (opt_blockDragSurface) {\n      this.blockDragSurface = opt_blockDragSurface;\n    }\n\n    if (opt_wsDragSurface) {\n      this.workspaceDragSurface = opt_wsDragSurface;\n    }\n\n    this.useWorkspaceDragSurface = !!this.workspaceDragSurface;\n\n    /**\n     * Object in charge of loading, storing, and playing audio for a workspace.\n     */\n    this.audioManager =\n        new WorkspaceAudio((options.parentWorkspace as WorkspaceSvg));\n\n    /** This workspace's grid object or null. */\n    this.grid = this.options.gridPattern ?\n        new Grid(this.options.gridPattern, options.gridOptions) :\n        null;\n\n    /** Manager in charge of markers and cursors. */\n    this.markerManager = new MarkerManager(this);\n\n    if (Variables && Variables.flyoutCategory) {\n      this.registerToolboxCategoryCallback(\n          Variables.CATEGORY_NAME, Variables.flyoutCategory);\n    }\n\n    if (VariablesDynamic && VariablesDynamic.flyoutCategory) {\n      this.registerToolboxCategoryCallback(\n          VariablesDynamic.CATEGORY_NAME, VariablesDynamic.flyoutCategory);\n    }\n\n    if (Procedures && Procedures.flyoutCategory) {\n      this.registerToolboxCategoryCallback(\n          Procedures.CATEGORY_NAME, Procedures.flyoutCategory);\n      this.addChangeListener(Procedures.mutatorOpenListener);\n    }\n\n    /** Object in charge of storing and updating the workspace theme. */\n    this.themeManager_ = this.options.parentWorkspace ?\n        this.options.parentWorkspace.getThemeManager() :\n        new ThemeManager(this, this.options.theme || Classic);\n    this.themeManager_.subscribeWorkspace(this);\n\n    /** The block renderer used for rendering blocks on this workspace. */\n    this.renderer = blockRendering.init(\n        this.options.renderer || 'geras', this.getTheme(),\n        this.options.rendererOverrides ?? undefined);\n\n    /**\n     * The cached size of the parent svg element.\n     * Used to compute svg metrics.\n     */\n    this.cachedParentSvgSize = new Size(0, 0);\n  }\n\n  /**\n   * Get the marker manager for this workspace.\n   *\n   * @returns The marker manager.\n   */\n  getMarkerManager(): MarkerManager {\n    return this.markerManager;\n  }\n\n  /**\n   * Gets the metrics manager for this workspace.\n   *\n   * @returns The metrics manager.\n   */\n  getMetricsManager(): IMetricsManager {\n    return this.metricsManager;\n  }\n\n  /**\n   * Sets the metrics manager for the workspace.\n   *\n   * @param metricsManager The metrics manager.\n   * @internal\n   */\n  setMetricsManager(metricsManager: IMetricsManager) {\n    this.metricsManager = metricsManager;\n    this.getMetrics = this.metricsManager.getMetrics.bind(this.metricsManager);\n  }\n\n  /**\n   * Gets the component manager for this workspace.\n   *\n   * @returns The component manager.\n   */\n  getComponentManager(): ComponentManager {\n    return this.componentManager;\n  }\n\n  /**\n   * Add the cursor SVG to this workspaces SVG group.\n   *\n   * @param cursorSvg The SVG root of the cursor to be added to the workspace\n   *     SVG group.\n   * @internal\n   */\n  setCursorSvg(cursorSvg: SVGElement) {\n    this.markerManager.setCursorSvg(cursorSvg);\n  }\n\n  /**\n   * Add the marker SVG to this workspaces SVG group.\n   *\n   * @param markerSvg The SVG root of the marker to be added to the workspace\n   *     SVG group.\n   * @internal\n   */\n  setMarkerSvg(markerSvg: SVGElement) {\n    this.markerManager.setMarkerSvg(markerSvg);\n  }\n\n  /**\n   * Get the marker with the given ID.\n   *\n   * @param id The ID of the marker.\n   * @returns The marker with the given ID or null if no marker with the given\n   *     ID exists.\n   * @internal\n   */\n  getMarker(id: string): Marker|null {\n    if (this.markerManager) {\n      return this.markerManager.getMarker(id);\n    }\n    return null;\n  }\n\n  /**\n   * The cursor for this workspace.\n   *\n   * @returns The cursor for the workspace.\n   */\n  getCursor(): Cursor|null {\n    if (this.markerManager) {\n      return this.markerManager.getCursor();\n    }\n    return null;\n  }\n\n  /**\n   * Get the block renderer attached to this workspace.\n   *\n   * @returns The renderer attached to this workspace.\n   */\n  getRenderer(): Renderer {\n    return this.renderer;\n  }\n\n  /**\n   * Get the theme manager for this workspace.\n   *\n   * @returns The theme manager for this workspace.\n   * @internal\n   */\n  getThemeManager(): ThemeManager {\n    return this.themeManager_;\n  }\n\n  /**\n   * Get the workspace theme object.\n   *\n   * @returns The workspace theme object.\n   */\n  getTheme(): Theme {\n    return this.themeManager_.getTheme();\n  }\n\n  /**\n   * Set the workspace theme object.\n   * If no theme is passed, default to the `Classic` theme.\n   *\n   * @param theme The workspace theme object.\n   */\n  setTheme(theme: Theme) {\n    if (!theme) {\n      theme = Classic as Theme;\n    }\n    this.themeManager_.setTheme(theme);\n  }\n\n  /**\n   * Refresh all blocks on the workspace after a theme update.\n   */\n  refreshTheme() {\n    if (this.svgGroup_) {\n      this.renderer.refreshDom(this.svgGroup_, this.getTheme());\n    }\n\n    // Update all blocks in workspace that have a style name.\n    this.updateBlockStyles_(this.getAllBlocks(false).filter(function(block) {\n      return !!block.getStyleName();\n    }));\n\n    // Update current toolbox selection.\n    this.refreshToolboxSelection();\n    if (this.toolbox_) {\n      this.toolbox_.refreshTheme();\n    }\n\n    // Re-render if workspace is visible\n    if (this.isVisible()) {\n      this.setVisible(true);\n    }\n\n    const event = new (eventUtils.get(eventUtils.THEME_CHANGE))(\n        this.getTheme().name, this.id);\n    eventUtils.fire(event);\n  }\n\n  /**\n   * Updates all the blocks with new style.\n   *\n   * @param blocks List of blocks to update the style on.\n   */\n  private updateBlockStyles_(blocks: Block[]) {\n    for (let i = 0, block; block = blocks[i]; i++) {\n      const blockStyleName = block.getStyleName();\n      if (blockStyleName) {\n        const blockSvg = block as BlockSvg;\n        blockSvg.setStyle(blockStyleName);\n        if (blockSvg.mutator) {\n          blockSvg.mutator.updateBlockStyle();\n        }\n      }\n    }\n  }\n\n  /**\n   * Getter for the inverted screen CTM.\n   *\n   * @returns The matrix to use in mouseToSvg\n   */\n  getInverseScreenCTM(): SVGMatrix|null {\n    // Defer getting the screen CTM until we actually need it, this should\n    // avoid forced reflows from any calls to updateInverseScreenCTM.\n    if (this.inverseScreenCTMDirty) {\n      const ctm = this.getParentSvg().getScreenCTM();\n      if (ctm) {\n        this.inverseScreenCTM = (ctm).inverse();\n        this.inverseScreenCTMDirty = false;\n      }\n    }\n\n    return this.inverseScreenCTM;\n  }\n\n  /** Mark the inverse screen CTM as dirty. */\n  updateInverseScreenCTM() {\n    this.inverseScreenCTMDirty = true;\n  }\n\n  /**\n   * Getter for isVisible\n   *\n   * @returns Whether the workspace is visible.\n   *     False if the workspace has been hidden by calling `setVisible(false)`.\n   */\n  isVisible(): boolean {\n    return this.isVisible_;\n  }\n\n  /**\n   * Return the absolute coordinates of the top-left corner of this element,\n   * scales that after canvas SVG element, if it's a descendant.\n   * The origin (0,0) is the top-left corner of the Blockly SVG.\n   *\n   * @param element SVG element to find the coordinates of.\n   * @returns Object with .x and .y properties.\n   * @internal\n   */\n  getSvgXY(element: SVGElement): Coordinate {\n    let x = 0;\n    let y = 0;\n    let scale = 1;\n    if (dom.containsNode(this.getCanvas(), element) ||\n        dom.containsNode(this.getBubbleCanvas(), element)) {\n      // Before the SVG canvas, scale the coordinates.\n      scale = this.scale;\n    }\n    do {\n      // Loop through this block and every parent.\n      const xy = svgMath.getRelativeXY(element);\n      if (element === this.getCanvas() || element === this.getBubbleCanvas()) {\n        // After the SVG canvas, don't scale the coordinates.\n        scale = 1;\n      }\n      x += xy.x * scale;\n      y += xy.y * scale;\n      element = element.parentNode as SVGElement;\n    } while (element && element !== this.getParentSvg());\n    return new Coordinate(x, y);\n  }\n\n  /**\n   * Gets the size of the workspace's parent SVG element.\n   *\n   * @returns The cached width and height of the workspace's parent SVG element.\n   * @internal\n   */\n  getCachedParentSvgSize(): Size {\n    const size = this.cachedParentSvgSize;\n    return new Size(size.width, size.height);\n  }\n\n  /**\n   * Return the position of the workspace origin relative to the injection div\n   * origin in pixels.\n   * The workspace origin is where a block would render at position (0, 0).\n   * It is not the upper left corner of the workspace SVG.\n   *\n   * @returns Offset in pixels.\n   * @internal\n   */\n  getOriginOffsetInPixels(): Coordinate {\n    return svgMath.getInjectionDivXY(this.getCanvas());\n  }\n\n  /**\n   * Return the injection div that is a parent of this workspace.\n   * Walks the DOM the first time it's called, then returns a cached value.\n   * Note: We assume this is only called after the workspace has been injected\n   * into the DOM.\n   *\n   * @returns The first parent div with 'injectionDiv' in the name.\n   * @internal\n   */\n  getInjectionDiv(): Element {\n    // NB: it would be better to pass this in at createDom, but is more likely\n    // to break existing uses of Blockly.\n    if (!this.injectionDiv) {\n      let element: Element = this.svgGroup_;\n      while (element) {\n        const classes = element.getAttribute('class') || '';\n        if ((' ' + classes + ' ').indexOf(' injectionDiv ') !== -1) {\n          this.injectionDiv = element;\n          break;\n        }\n        element = element.parentNode as Element;\n      }\n    }\n    return this.injectionDiv!;\n  }\n\n  /**\n   * Get the SVG block canvas for the workspace.\n   *\n   * @returns The SVG group for the workspace.\n   * @internal\n   */\n  getBlockCanvas(): SVGElement|null {\n    return this.svgBlockCanvas_;\n  }\n\n  /**\n   * Save resize handler data so we can delete it later in dispose.\n   *\n   * @param handler Data that can be passed to eventHandling.unbind.\n   */\n  setResizeHandlerWrapper(handler: browserEvents.Data) {\n    this.resizeHandlerWrapper = handler;\n  }\n\n  /**\n   * Create the workspace DOM elements.\n   *\n   * @param opt_backgroundClass Either 'blocklyMainBackground' or\n   *     'blocklyMutatorBackground'.\n   * @returns The workspace's SVG group.\n   */\n  createDom(opt_backgroundClass?: string): Element {\n    /**\n     * <g class=\"blocklyWorkspace\">\n     *   <rect class=\"blocklyMainBackground\" height=\"100%\" width=\"100%\"></rect>\n     *   [Trashcan and/or flyout may go here]\n     *   <g class=\"blocklyBlockCanvas\"></g>\n     *   <g class=\"blocklyBubbleCanvas\"></g>\n     * </g>\n     */\n    this.svgGroup_ = dom.createSvgElement(Svg.G, {'class': 'blocklyWorkspace'});\n\n    // Note that a <g> alone does not receive mouse events--it must have a\n    // valid target inside it.  If no background class is specified, as in the\n    // flyout, the workspace will not receive mouse events.\n    if (opt_backgroundClass) {\n      this.svgBackground_ = dom.createSvgElement(\n          Svg.RECT,\n          {'height': '100%', 'width': '100%', 'class': opt_backgroundClass},\n          this.svgGroup_);\n\n      if (opt_backgroundClass === 'blocklyMainBackground' && this.grid) {\n        this.svgBackground_.style.fill =\n            'url(#' + this.grid.getPatternId() + ')';\n      } else {\n        this.themeManager_.subscribe(\n            this.svgBackground_, 'workspaceBackgroundColour', 'fill');\n      }\n    }\n    this.svgBlockCanvas_ = dom.createSvgElement(\n        Svg.G, {'class': 'blocklyBlockCanvas'}, this.svgGroup_);\n    this.svgBubbleCanvas_ = dom.createSvgElement(\n        Svg.G, {'class': 'blocklyBubbleCanvas'}, this.svgGroup_);\n\n    if (!this.isFlyout) {\n      browserEvents.conditionalBind(\n          this.svgGroup_, 'pointerdown', this, this.onMouseDown_, false);\n      // This no-op works around https://bugs.webkit.org/show_bug.cgi?id=226683,\n      // which otherwise prevents zoom/scroll events from being observed in\n      // Safari. Once that bug is fixed it should be removed.\n      document.body.addEventListener('wheel', function() {});\n      browserEvents.conditionalBind(\n          this.svgGroup_, 'wheel', this, this.onMouseWheel_);\n    }\n\n    // Determine if there needs to be a category tree, or a simple list of\n    // blocks.  This cannot be changed later, since the UI is very different.\n    if (this.options.hasCategories) {\n      const ToolboxClass = registry.getClassFromOptions(\n          registry.Type.TOOLBOX, this.options, true);\n      this.toolbox_ = new ToolboxClass!(this);\n    }\n    if (this.grid) {\n      this.grid.update(this.scale);\n    }\n    this.recordDragTargets();\n    const CursorClass =\n        registry.getClassFromOptions(registry.Type.CURSOR, this.options);\n\n    CursorClass && this.markerManager.setCursor(new CursorClass());\n\n    this.renderer.createDom(this.svgGroup_, this.getTheme());\n    return this.svgGroup_;\n  }\n\n  /**\n   * Dispose of this workspace.\n   * Unlink from all DOM elements to prevent memory leaks.\n   *\n   * @suppress {checkTypes}\n   */\n  override dispose() {\n    // Stop rerendering.\n    this.rendered = false;\n    if (this.currentGesture_) {\n      this.currentGesture_.cancel();\n    }\n    if (this.svgGroup_) {\n      dom.removeNode(this.svgGroup_);\n    }\n    if (this.toolbox_) {\n      this.toolbox_.dispose();\n      this.toolbox_ = null;\n    }\n    if (this.flyout) {\n      this.flyout.dispose();\n      this.flyout = null;\n    }\n    if (this.trashcan) {\n      this.trashcan.dispose();\n      this.trashcan = null;\n    }\n    if (this.scrollbar) {\n      this.scrollbar.dispose();\n      this.scrollbar = null;\n    }\n    if (this.zoomControls_) {\n      this.zoomControls_.dispose();\n    }\n\n    if (this.audioManager) {\n      this.audioManager.dispose();\n    }\n\n    if (this.grid) {\n      this.grid = null;\n    }\n\n    this.renderer.dispose();\n\n    if (this.markerManager) {\n      this.markerManager.dispose();\n    }\n\n    super.dispose();\n\n    // Dispose of theme manager after all blocks and mutators are disposed of.\n    if (this.themeManager_) {\n      this.themeManager_.unsubscribeWorkspace(this);\n      this.themeManager_.unsubscribe(this.svgBackground_);\n      if (!this.options.parentWorkspace) {\n        this.themeManager_.dispose();\n      }\n    }\n\n    this.connectionDBList.length = 0;\n\n    this.toolboxCategoryCallbacks.clear();\n    this.flyoutButtonCallbacks.clear();\n\n    if (!this.options.parentWorkspace) {\n      // Top-most workspace.  Dispose of the div that the\n      // SVG is injected into (i.e. injectionDiv).\n      const parentSvg = this.getParentSvg();\n      if (parentSvg && parentSvg.parentNode) {\n        dom.removeNode(parentSvg.parentNode);\n      }\n    }\n    if (this.resizeHandlerWrapper) {\n      browserEvents.unbind(this.resizeHandlerWrapper);\n      this.resizeHandlerWrapper = null;\n    }\n  }\n\n  /**\n   * Add a trashcan.\n   *\n   * @internal\n   */\n  addTrashcan() {\n    this.trashcan = WorkspaceSvg.newTrashcan(this);\n    const svgTrashcan = this.trashcan.createDom();\n    this.svgGroup_.insertBefore(svgTrashcan, this.svgBlockCanvas_);\n  }\n\n  /**\n   * @param _workspace\n   * @internal\n   */\n  static newTrashcan(_workspace: WorkspaceSvg): Trashcan {\n    throw new Error(\n        'The implementation of newTrashcan should be ' +\n        'monkey-patched in by blockly.ts');\n  }\n\n  /**\n   * Add zoom controls.\n   *\n   * @internal\n   */\n  addZoomControls() {\n    this.zoomControls_ = new ZoomControls(this);\n    const svgZoomControls = this.zoomControls_.createDom();\n    this.svgGroup_.appendChild(svgZoomControls);\n  }\n\n  /**\n   * Add a flyout element in an element with the given tag name.\n   *\n   * @param tagName What type of tag the flyout belongs in.\n   * @returns The element containing the flyout DOM.\n   * @internal\n   */\n  addFlyout(tagName: string|Svg<SVGSVGElement>|Svg<SVGGElement>): Element {\n    const workspaceOptions = new Options(({\n      'parentWorkspace': this,\n      'rtl': this.RTL,\n      'oneBasedIndex': this.options.oneBasedIndex,\n      'horizontalLayout': this.horizontalLayout,\n      'renderer': this.options.renderer,\n      'rendererOverrides': this.options.rendererOverrides,\n      'move': {\n        'scrollbars': true,\n      },\n    } as BlocklyOptions));\n    workspaceOptions.toolboxPosition = this.options.toolboxPosition;\n    if (this.horizontalLayout) {\n      const HorizontalFlyout = registry.getClassFromOptions(\n          registry.Type.FLYOUTS_HORIZONTAL_TOOLBOX, this.options, true);\n      this.flyout = new HorizontalFlyout!(workspaceOptions);\n    } else {\n      const VerticalFlyout = registry.getClassFromOptions(\n          registry.Type.FLYOUTS_VERTICAL_TOOLBOX, this.options, true);\n      this.flyout = new VerticalFlyout!(workspaceOptions);\n    }\n    this.flyout.autoClose = false;\n    this.flyout.getWorkspace().setVisible(true);\n\n    // Return the element so that callers can place it in their desired\n    // spot in the DOM.  For example, mutator flyouts do not go in the same\n    // place as main workspace flyouts.\n    return this.flyout.createDom(tagName);\n  }\n\n  /**\n   * Getter for the flyout associated with this workspace.  This flyout may be\n   * owned by either the toolbox or the workspace, depending on toolbox\n   * configuration.  It will be null if there is no flyout.\n   *\n   * @param opt_own Whether to only return the workspace's own flyout.\n   * @returns The flyout on this workspace.\n   */\n  getFlyout(opt_own?: boolean): IFlyout|null {\n    if (this.flyout || opt_own) {\n      return this.flyout;\n    }\n    if (this.toolbox_) {\n      return this.toolbox_.getFlyout();\n    }\n    return null;\n  }\n\n  /**\n   * Getter for the toolbox associated with this workspace, if one exists.\n   *\n   * @returns The toolbox on this workspace.\n   */\n  getToolbox(): IToolbox|null {\n    return this.toolbox_;\n  }\n\n  /**\n   * Update items that use screen coordinate calculations\n   * because something has changed (e.g. scroll position, window size).\n   */\n  private updateScreenCalculations_() {\n    this.updateInverseScreenCTM();\n    this.recordDragTargets();\n  }\n\n  /**\n   * If enabled, resize the parts of the workspace that change when the\n   * workspace contents (e.g. block positions) change.  This will also scroll\n   * the workspace contents if needed.\n   *\n   * @internal\n   */\n  resizeContents() {\n    if (!this.resizesEnabled || !this.rendered) {\n      return;\n    }\n    if (this.scrollbar) {\n      this.scrollbar.resize();\n    }\n    this.updateInverseScreenCTM();\n  }\n\n  /**\n   * Resize and reposition all of the workspace chrome (toolbox,\n   * trash, scrollbars etc.)\n   * This should be called when something changes that\n   * requires recalculating dimensions and positions of the\n   * trash, zoom, toolbox, etc. (e.g. window resize).\n   */\n  resize() {\n    if (this.toolbox_) {\n      this.toolbox_.position();\n    }\n    if (this.flyout) {\n      this.flyout.position();\n    }\n\n    const positionables = this.componentManager.getComponents(\n        ComponentManager.Capability.POSITIONABLE, true);\n    const metrics = this.getMetricsManager().getUiMetrics();\n    const savedPositions = [];\n    for (let i = 0, positionable; positionable = positionables[i]; i++) {\n      positionable.position(metrics, savedPositions);\n      const boundingRect = positionable.getBoundingRectangle();\n      if (boundingRect) {\n        savedPositions.push(boundingRect);\n      }\n    }\n\n    if (this.scrollbar) {\n      this.scrollbar.resize();\n    }\n    this.updateScreenCalculations_();\n  }\n\n  /**\n   * Resizes and repositions workspace chrome if the page has a new\n   * scroll position.\n   *\n   * @internal\n   */\n  updateScreenCalculationsIfScrolled() {\n    /* eslint-disable indent */\n    const currScroll = svgMath.getDocumentScroll();\n    if (!Coordinate.equals(this.lastRecordedPageScroll, currScroll)) {\n      this.lastRecordedPageScroll = currScroll;\n      this.updateScreenCalculations_();\n    }\n  }\n  /* eslint-enable indent */\n\n  /**\n   * Get the SVG element that forms the drawing surface.\n   *\n   * @returns SVG group element.\n   */\n  getCanvas(): SVGGElement {\n    return this.svgBlockCanvas_ as SVGGElement;\n  }\n\n  /**\n   * Caches the width and height of the workspace's parent SVG element for use\n   * with getSvgMetrics.\n   *\n   * @param width The width of the parent SVG element.\n   * @param height The height of the parent SVG element\n   * @internal\n   */\n  setCachedParentSvgSize(width: number|null, height: number|null) {\n    const svg = this.getParentSvg();\n    if (width != null) {\n      this.cachedParentSvgSize.width = width;\n      // This is set to support the public (but deprecated) Blockly.svgSize\n      // method.\n      svg.setAttribute('data-cached-width', width.toString());\n    }\n    if (height != null) {\n      this.cachedParentSvgSize.height = height;\n      // This is set to support the public (but deprecated) Blockly.svgSize\n      // method.\n      svg.setAttribute('data-cached-height', height.toString());\n    }\n  }\n\n  /**\n   * Get the SVG element that forms the bubble surface.\n   *\n   * @returns SVG group element.\n   */\n  getBubbleCanvas(): SVGGElement {\n    return this.svgBubbleCanvas_ as SVGGElement;\n  }\n\n  /**\n   * Get the SVG element that contains this workspace.\n   * Note: We assume this is only called after the workspace has been injected\n   * into the DOM.\n   *\n   * @returns SVG element.\n   */\n  getParentSvg(): SVGSVGElement {\n    if (!this.cachedParentSvg) {\n      let element = this.svgGroup_;\n      while (element) {\n        if (element.tagName === 'svg') {\n          this.cachedParentSvg = element;\n          break;\n        }\n        element = element.parentNode as SVGSVGElement;\n      }\n    }\n    return this.cachedParentSvg as SVGSVGElement;\n  }\n\n  /**\n   * Fires a viewport event if events are enabled and there is a change in\n   * viewport values.\n   *\n   * @internal\n   */\n  maybeFireViewportChangeEvent() {\n    if (!eventUtils.isEnabled()) {\n      return;\n    }\n    const scale = this.scale;\n    const top = -this.scrollY;\n    const left = -this.scrollX;\n    if (scale === this.oldScale && Math.abs(top - this.oldTop) < 1 &&\n        Math.abs(left - this.oldLeft) < 1) {\n      // Ignore sub-pixel changes in top and left. Due to #4192 there are a lot\n      // of negligible changes in viewport top/left.\n      return;\n    }\n    const event = new (eventUtils.get(eventUtils.VIEWPORT_CHANGE))(\n        top, left, scale, this.id, this.oldScale);\n    this.oldScale = scale;\n    this.oldTop = top;\n    this.oldLeft = left;\n    eventUtils.fire(event);\n  }\n\n  /**\n   * Translate this workspace to new coordinates.\n   *\n   * @param x Horizontal translation, in pixel units relative to the top left of\n   *     the Blockly div.\n   * @param y Vertical translation, in pixel units relative to the top left of\n   *     the Blockly div.\n   */\n  translate(x: number, y: number) {\n    if (this.useWorkspaceDragSurface && this.isDragSurfaceActive) {\n      this.workspaceDragSurface?.translateSurface(x, y);\n    } else {\n      const translation = 'translate(' + x + ',' + y + ') ' +\n          'scale(' + this.scale + ')';\n      this.svgBlockCanvas_.setAttribute('transform', translation);\n      this.svgBubbleCanvas_.setAttribute('transform', translation);\n    }\n    // Now update the block drag surface if we're using one.\n    if (this.blockDragSurface) {\n      this.blockDragSurface.translateAndScaleGroup(x, y, this.scale);\n    }\n    // And update the grid if we're using one.\n    if (this.grid) {\n      this.grid.moveTo(x, y);\n    }\n\n    this.maybeFireViewportChangeEvent();\n  }\n\n  /**\n   * Called at the end of a workspace drag to take the contents\n   * out of the drag surface and put them back into the workspace SVG.\n   * Does nothing if the workspace drag surface is not enabled.\n   *\n   * @internal\n   */\n  resetDragSurface() {\n    // Don't do anything if we aren't using a drag surface.\n    if (!this.useWorkspaceDragSurface) {\n      return;\n    }\n\n    this.isDragSurfaceActive = false;\n\n    const trans = this.workspaceDragSurface!.getSurfaceTranslation();\n    this.workspaceDragSurface!.clearAndHide(this.svgGroup_);\n    const translation = 'translate(' + trans.x + ',' + trans.y + ') ' +\n        'scale(' + this.scale + ')';\n    this.svgBlockCanvas_.setAttribute('transform', translation);\n    this.svgBubbleCanvas_.setAttribute('transform', translation);\n  }\n\n  /**\n   * Called at the beginning of a workspace drag to move contents of\n   * the workspace to the drag surface.\n   * Does nothing if the drag surface is not enabled.\n   *\n   * @internal\n   */\n  setupDragSurface() {\n    // Don't do anything if we aren't using a drag surface.\n    if (!this.useWorkspaceDragSurface) {\n      return;\n    }\n\n    // This can happen if the user starts a drag, mouses up outside of the\n    // document where the mouseup listener is registered (e.g. outside of an\n    // iframe) and then moves the mouse back in the workspace.  On mobile and\n    // ff, we get the mouseup outside the frame. On chrome and safari desktop we\n    // do not.\n    if (this.isDragSurfaceActive) {\n      return;\n    }\n\n    this.isDragSurfaceActive = true;\n\n    // Figure out where we want to put the canvas back.  The order\n    // in the is important because things are layered.\n    const previousElement = this.svgBlockCanvas_.previousSibling as Element;\n    const width = parseInt(this.getParentSvg().getAttribute('width') ?? '0');\n    const height = parseInt(this.getParentSvg().getAttribute('height') ?? '0');\n    const coord = svgMath.getRelativeXY(this.getCanvas());\n    this.workspaceDragSurface!.setContentsAndShow(\n        this.getCanvas(), this.getBubbleCanvas(), previousElement, width,\n        height, this.scale);\n    this.workspaceDragSurface!.translateSurface(coord.x, coord.y);\n  }\n\n  /**\n   * Gets the drag surface blocks are moved to when a drag is started.\n   *\n   * @returns This workspace's block drag surface, if one is in use.\n   * @internal\n   */\n  getBlockDragSurface(): BlockDragSurfaceSvg|null {\n    return this.blockDragSurface;\n  }\n\n  /**\n   * Returns the horizontal offset of the workspace.\n   * Intended for LTR/RTL compatibility in XML.\n   *\n   * @returns Width.\n   */\n  override getWidth(): number {\n    const metrics = this.getMetrics();\n    return metrics ? metrics.viewWidth / this.scale : 0;\n  }\n\n  /**\n   * Toggles the visibility of the workspace.\n   * Currently only intended for main workspace.\n   *\n   * @param isVisible True if workspace should be visible.\n   */\n  setVisible(isVisible: boolean) {\n    this.isVisible_ = isVisible;\n    if (!this.svgGroup_) {\n      return;\n    }\n\n    // Tell the scrollbar whether its container is visible so it can\n    // tell when to hide itself.\n    if (this.scrollbar) {\n      this.scrollbar.setContainerVisible(isVisible);\n    }\n\n    // Tell the flyout whether its container is visible so it can\n    // tell when to hide itself.\n    if (this.getFlyout()) {\n      this.getFlyout()!.setContainerVisible(isVisible);\n    }\n\n    this.getParentSvg().style.display = isVisible ? 'block' : 'none';\n    if (this.toolbox_) {\n      // Currently does not support toolboxes in mutators.\n      this.toolbox_.setVisible(isVisible);\n    }\n    if (isVisible) {\n      const blocks = this.getAllBlocks(false);\n      // Tell each block on the workspace to mark its fields as dirty.\n      for (let i = blocks.length - 1; i >= 0; i--) {\n        blocks[i].markDirty();\n      }\n\n      this.render();\n      if (this.toolbox_) {\n        this.toolbox_.position();\n      }\n    } else {\n      this.hideChaff(true);\n    }\n  }\n\n  /** Render all blocks in workspace. */\n  render() {\n    // Generate list of all blocks.\n    const blocks = this.getAllBlocks(false);\n    // Render each block.\n    for (let i = blocks.length - 1; i >= 0; i--) {\n      blocks[i].render(false);\n    }\n\n    if (this.currentGesture_) {\n      const imList = this.currentGesture_.getInsertionMarkers();\n      for (let i = 0; i < imList.length; i++) {\n        imList[i].render(false);\n      }\n    }\n\n    this.markerManager.updateMarkers();\n  }\n\n  /**\n   * Highlight or unhighlight a block in the workspace.  Block highlighting is\n   * often used to visually mark blocks currently being executed.\n   *\n   * @param id ID of block to highlight/unhighlight, or null for no block (used\n   *     to unhighlight all blocks).\n   * @param opt_state If undefined, highlight specified block and automatically\n   *     unhighlight all others.  If true or false, manually\n   *     highlight/unhighlight the specified block.\n   */\n  highlightBlock(id: string|null, opt_state?: boolean) {\n    if (opt_state === undefined) {\n      // Unhighlight all blocks.\n      for (let i = 0, block; block = this.highlightedBlocks[i]; i++) {\n        block.setHighlighted(false);\n      }\n      this.highlightedBlocks.length = 0;\n    }\n    // Highlight/unhighlight the specified block.\n    const block = id ? this.getBlockById(id) : null;\n    if (block) {\n      const state = opt_state === undefined || opt_state;\n      // Using Set here would be great, but at the cost of IE10 support.\n      if (!state) {\n        arrayUtils.removeElem(this.highlightedBlocks, block);\n      } else if (this.highlightedBlocks.indexOf(block) === -1) {\n        this.highlightedBlocks.push(block);\n      }\n      block.setHighlighted(state);\n    }\n  }\n\n  /**\n   * Pastes the provided block or workspace comment onto the workspace.\n   * Does not check whether there is remaining capacity for the object, that\n   * should be done before calling this method.\n   *\n   * @param state The representation of the thing to paste.\n   * @returns The pasted thing, or null if the paste was not successful.\n   */\n  paste(state: AnyDuringMigration|Element|DocumentFragment): ICopyable|null {\n    if (!this.rendered || !state['type'] && !state['tagName']) {\n      return null;\n    }\n    if (this.currentGesture_) {  // Dragging while pasting?  No.\n      this.currentGesture_.cancel();\n    }\n\n    const existingGroup = eventUtils.getGroup();\n    if (!existingGroup) {\n      eventUtils.setGroup(true);\n    }\n\n    let pastedThing;\n    // Checks if this is JSON. JSON has a type property, while elements don't.\n    if (state['type']) {\n      pastedThing = this.pasteBlock_(null, state as blocks.State);\n    } else {\n      const xmlBlock = state as Element;\n      if (xmlBlock.tagName.toLowerCase() === 'comment') {\n        pastedThing = this.pasteWorkspaceComment_(xmlBlock);\n      } else {\n        pastedThing = this.pasteBlock_(xmlBlock, null);\n      }\n    }\n\n    eventUtils.setGroup(existingGroup);\n    return pastedThing;\n  }\n\n  /**\n   * Paste the provided block onto the workspace.\n   *\n   * @param xmlBlock XML block element.\n   * @param jsonBlock JSON block representation.\n   * @returns The pasted block.\n   */\n  private pasteBlock_(xmlBlock: Element|null, jsonBlock: blocks.State|null):\n      BlockSvg {\n    eventUtils.disable();\n    let block: BlockSvg;\n    try {\n      let blockX = 0;\n      let blockY = 0;\n      if (xmlBlock) {\n        block = Xml.domToBlock(xmlBlock, this) as BlockSvg;\n        blockX = parseInt(xmlBlock.getAttribute('x') ?? '0');\n        if (this.RTL) {\n          blockX = -blockX;\n        }\n        blockY = parseInt(xmlBlock.getAttribute('y') ?? '0');\n      } else if (jsonBlock) {\n        block = blocks.append(jsonBlock, this) as BlockSvg;\n        blockX = jsonBlock['x'] || 10;\n        if (this.RTL) {\n          blockX = this.getWidth() - blockX;\n        }\n        blockY = jsonBlock['y'] || 10;\n      }\n\n      // Move the duplicate to original position.\n      if (!isNaN(blockX) && !isNaN(blockY)) {\n        // Offset block until not clobbering another block and not in connection\n        // distance with neighbouring blocks.\n        let collide;\n        do {\n          collide = false;\n          const allBlocks = this.getAllBlocks(false);\n          for (let i = 0, otherBlock; otherBlock = allBlocks[i]; i++) {\n            const otherXY = otherBlock.getRelativeToSurfaceXY();\n            if (Math.abs(blockX - otherXY.x) <= 1 &&\n                Math.abs(blockY - otherXY.y) <= 1) {\n              collide = true;\n              break;\n            }\n          }\n          if (!collide) {\n            // Check for blocks in snap range to any of its connections.\n            const connections = block!.getConnections_(false);\n            for (let i = 0, connection; connection = connections[i]; i++) {\n              const neighbour =\n                  (connection)\n                      .closest(\n                          config.snapRadius, new Coordinate(blockX, blockY));\n              if (neighbour.connection) {\n                collide = true;\n                break;\n              }\n            }\n          }\n          if (collide) {\n            if (this.RTL) {\n              blockX -= config.snapRadius;\n            } else {\n              blockX += config.snapRadius;\n            }\n            blockY += config.snapRadius * 2;\n          }\n        } while (collide);\n        block!.moveTo(new Coordinate(blockX, blockY));\n      }\n    } finally {\n      eventUtils.enable();\n    }\n    if (eventUtils.isEnabled() && !block!.isShadow()) {\n      eventUtils.fire(new (eventUtils.get(eventUtils.BLOCK_CREATE))(block!));\n    }\n    block!.select();\n    return block!;\n  }\n\n  /**\n   * Paste the provided comment onto the workspace.\n   *\n   * @param xmlComment XML workspace comment element.\n   * @returns The pasted workspace comment.\n   * @suppress {checkTypes} Suppress checks while workspace comments are not\n   * bundled in.\n   */\n  private pasteWorkspaceComment_(xmlComment: Element): WorkspaceCommentSvg {\n    eventUtils.disable();\n    let comment: WorkspaceCommentSvg;\n    try {\n      comment = WorkspaceCommentSvg.fromXmlRendered(xmlComment, this);\n      // Move the duplicate to original position.\n      let commentX = parseInt(xmlComment.getAttribute('x') ?? '0');\n      let commentY = parseInt(xmlComment.getAttribute('y') ?? '0');\n      if (!isNaN(commentX) && !isNaN(commentY)) {\n        if (this.RTL) {\n          commentX = -commentX;\n        }\n        // Offset workspace comment.\n        // TODO (#1719): Properly offset comment such that it's not interfering\n        // with any blocks.\n        commentX += 50;\n        commentY += 50;\n        comment.moveBy(commentX, commentY);\n      }\n    } finally {\n      eventUtils.enable();\n    }\n    if (eventUtils.isEnabled()) {\n      WorkspaceComment.fireCreateEvent(comment);\n    }\n    comment.select();\n    return comment;\n  }\n\n  /**\n   * Refresh the toolbox unless there's a drag in progress.\n   *\n   * @internal\n   */\n  refreshToolboxSelection() {\n    const ws = this.isFlyout ? this.targetWorkspace : this;\n    if (ws && !ws.currentGesture_ && ws.toolbox_ && ws.toolbox_.getFlyout()) {\n      ws.toolbox_.refreshSelection();\n    }\n  }\n\n  /**\n   * Rename a variable by updating its name in the variable map.  Update the\n   *     flyout to show the renamed variable immediately.\n   *\n   * @param id ID of the variable to rename.\n   * @param newName New variable name.\n   */\n  override renameVariableById(id: string, newName: string) {\n    super.renameVariableById(id, newName);\n    this.refreshToolboxSelection();\n  }\n\n  /**\n   * Delete a variable by the passed in ID.   Update the flyout to show\n   *     immediately that the variable is deleted.\n   *\n   * @param id ID of variable to delete.\n   */\n  override deleteVariableById(id: string) {\n    super.deleteVariableById(id);\n    this.refreshToolboxSelection();\n  }\n\n  /**\n   * Create a new variable with the given name.  Update the flyout to show the\n   *     new variable immediately.\n   *\n   * @param name The new variable's name.\n   * @param opt_type The type of the variable like 'int' or 'string'.\n   *     Does not need to be unique. Field_variable can filter variables based\n   * on their type. This will default to '' which is a specific type.\n   * @param opt_id The unique ID of the variable. This will default to a UUID.\n   * @returns The newly created variable.\n   */\n  override createVariable(\n      name: string, opt_type?: string|null,\n      opt_id?: string|null): VariableModel {\n    const newVar = super.createVariable(name, opt_type, opt_id);\n    this.refreshToolboxSelection();\n    return newVar;\n  }\n\n  /** Make a list of all the delete areas for this workspace. */\n  recordDragTargets() {\n    const dragTargets = this.componentManager.getComponents(\n        ComponentManager.Capability.DRAG_TARGET, true);\n\n    this.dragTargetAreas = [];\n    for (let i = 0, targetArea; targetArea = dragTargets[i]; i++) {\n      const rect = targetArea.getClientRect();\n      if (rect) {\n        this.dragTargetAreas.push({\n          component: targetArea,\n          clientRect: rect,\n        });\n      }\n    }\n  }\n  /* eslint-disable jsdoc/require-returns-check */\n  /* eslint-disable @typescript-eslint/no-unused-vars */\n  /**\n   * Obtain a newly created block.\n   *\n   * @param prototypeName Name of the language object containing type-specific\n   *     functions for this block.\n   * @param opt_id Optional ID.  Use this ID if provided, otherwise create a new\n   *     ID.\n   * @returns The created block.\n   */\n  override newBlock(prototypeName: string, opt_id?: string): BlockSvg {\n    throw new Error(\n        'The implementation of newBlock should be ' +\n        'monkey-patched in by blockly.ts');\n  }\n  /* eslint-enable */\n\n  /**\n   * Returns the drag target the pointer event is over.\n   *\n   * @param e Pointer move event.\n   * @returns Null if not over a drag target, or the drag target the event is\n   *     over.\n   */\n  getDragTarget(e: PointerEvent): IDragTarget|null {\n    for (let i = 0, targetArea; targetArea = this.dragTargetAreas[i]; i++) {\n      if (targetArea.clientRect.contains(e.clientX, e.clientY)) {\n        return targetArea.component;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Handle a pointerdown on SVG drawing surface.\n   *\n   * @param e Pointer down event.\n   */\n  private onMouseDown_(e: PointerEvent) {\n    const gesture = this.getGesture(e);\n    if (gesture) {\n      gesture.handleWsStart(e, this);\n    }\n  }\n\n  /**\n   * Start tracking a drag of an object on this workspace.\n   *\n   * @param e Pointer down event.\n   * @param xy Starting location of object.\n   */\n  startDrag(e: PointerEvent, xy: Coordinate) {\n    // Record the starting offset between the bubble's location and the mouse.\n    const point = browserEvents.mouseToSvg(\n        e, this.getParentSvg(), this.getInverseScreenCTM());\n    // Fix scale of mouse event.\n    point.x /= this.scale;\n    point.y /= this.scale;\n    this.dragDeltaXY = Coordinate.difference(xy, point);\n  }\n\n  /**\n   * Track a drag of an object on this workspace.\n   *\n   * @param e Pointer move event.\n   * @returns New location of object.\n   */\n  moveDrag(e: PointerEvent): Coordinate {\n    const point = browserEvents.mouseToSvg(\n        e, this.getParentSvg(), this.getInverseScreenCTM());\n    // Fix scale of mouse event.\n    point.x /= this.scale;\n    point.y /= this.scale;\n    return Coordinate.sum((this.dragDeltaXY!), point);\n  }\n\n  /**\n   * Is the user currently dragging a block or scrolling the flyout/workspace?\n   *\n   * @returns True if currently dragging or scrolling.\n   */\n  isDragging(): boolean {\n    return this.currentGesture_ !== null && this.currentGesture_.isDragging();\n  }\n\n  /**\n   * Is this workspace draggable?\n   *\n   * @returns True if this workspace may be dragged.\n   */\n  isDraggable(): boolean {\n    return this.options.moveOptions && this.options.moveOptions.drag;\n  }\n\n  /**\n   * Is this workspace movable?\n   *\n   * This means the user can reposition the X Y coordinates of the workspace\n   * through input. This can be through scrollbars, scroll wheel, dragging, or\n   * through zooming with the scroll wheel or pinch (since the zoom is centered\n   * on the mouse position). This does not include zooming with the zoom\n   * controls since the X Y coordinates are decided programmatically.\n   *\n   * @returns True if the workspace is movable, false otherwise.\n   */\n  isMovable(): boolean {\n    return this.options.moveOptions && !!this.options.moveOptions.scrollbars ||\n        this.options.moveOptions && this.options.moveOptions.wheel ||\n        this.options.moveOptions && this.options.moveOptions.drag ||\n        this.options.zoomOptions && this.options.zoomOptions.wheel ||\n        this.options.zoomOptions && this.options.zoomOptions.pinch;\n  }\n\n  /**\n   * Is this workspace movable horizontally?\n   *\n   * @returns True if the workspace is movable horizontally, false otherwise.\n   */\n  isMovableHorizontally(): boolean {\n    const hasScrollbars = !!this.scrollbar;\n    return this.isMovable() &&\n        (!hasScrollbars ||\n         hasScrollbars && this.scrollbar!.canScrollHorizontally());\n  }\n\n  /**\n   * Is this workspace movable vertically?\n   *\n   * @returns True if the workspace is movable vertically, false otherwise.\n   */\n  isMovableVertically(): boolean {\n    const hasScrollbars = !!this.scrollbar;\n    return this.isMovable() &&\n        (!hasScrollbars ||\n         hasScrollbars && this.scrollbar!.canScrollVertically());\n  }\n\n  /**\n   * Handle a mouse-wheel on SVG drawing surface.\n   *\n   * @param e Mouse wheel event.\n   */\n  private onMouseWheel_(e: WheelEvent) {\n    // Don't scroll or zoom anything if drag is in progress.\n    if (Gesture.inProgress()) {\n      e.preventDefault();\n      e.stopPropagation();\n      return;\n    }\n    const canWheelZoom =\n        this.options.zoomOptions && this.options.zoomOptions.wheel;\n    const canWheelMove =\n        this.options.moveOptions && this.options.moveOptions.wheel;\n    if (!canWheelZoom && !canWheelMove) {\n      return;\n    }\n\n    const scrollDelta = browserEvents.getScrollDeltaPixels(e);\n\n    // Zoom should also be enabled by the command key on Mac devices,\n    // but not super on Unix.\n    let commandKey;\n    if (userAgent.MAC) {\n      commandKey = e.metaKey;\n    }\n\n    if (canWheelZoom && (e.ctrlKey || commandKey || !canWheelMove)) {\n      // Zoom.\n      // The vertical scroll distance that corresponds to a click of a zoom\n      // button.\n      const PIXELS_PER_ZOOM_STEP = 50;\n      const delta = -scrollDelta.y / PIXELS_PER_ZOOM_STEP;\n      const position = browserEvents.mouseToSvg(\n          e, this.getParentSvg(), this.getInverseScreenCTM());\n      this.zoom(position.x, position.y, delta);\n    } else {\n      // Scroll.\n      let x = this.scrollX - scrollDelta.x;\n      let y = this.scrollY - scrollDelta.y;\n\n      if (e.shiftKey && !scrollDelta.x) {\n        // Scroll horizontally (based on vertical scroll delta).\n        // This is needed as for some browser/system combinations which do not\n        // set deltaX.\n        x = this.scrollX - scrollDelta.y;\n        y = this.scrollY;  // Don't scroll vertically.\n      }\n      this.scroll(x, y);\n    }\n    e.preventDefault();\n  }\n\n  /**\n   * Calculate the bounding box for the blocks on the workspace.\n   * Coordinate system: workspace coordinates.\n   *\n   * @returns Contains the position and size of the bounding box containing the\n   *     blocks on the workspace.\n   */\n  getBlocksBoundingBox(): Rect {\n    const topElements = this.getTopBoundedElements();\n    // There are no blocks, return empty rectangle.\n    if (!topElements.length) {\n      return new Rect(0, 0, 0, 0);\n    }\n\n    // Initialize boundary using the first block.\n    const boundary = topElements[0].getBoundingRectangle();\n\n    // Start at 1 since the 0th block was used for initialization.\n    for (let i = 1; i < topElements.length; i++) {\n      const topElement = topElements[i];\n      if ((topElement as any).isInsertionMarker &&\n          (topElement as any).isInsertionMarker()) {\n        continue;\n      }\n      const blockBoundary = topElement.getBoundingRectangle();\n      if (blockBoundary.top < boundary.top) {\n        boundary.top = blockBoundary.top;\n      }\n      if (blockBoundary.bottom > boundary.bottom) {\n        boundary.bottom = blockBoundary.bottom;\n      }\n      if (blockBoundary.left < boundary.left) {\n        boundary.left = blockBoundary.left;\n      }\n      if (blockBoundary.right > boundary.right) {\n        boundary.right = blockBoundary.right;\n      }\n    }\n    return boundary;\n  }\n\n  /** Clean up the workspace by ordering all the blocks in a column. */\n  cleanUp() {\n    this.setResizesEnabled(false);\n    eventUtils.setGroup(true);\n    const topBlocks = this.getTopBlocks(true);\n    let cursorY = 0;\n    for (let i = 0, block; block = topBlocks[i]; i++) {\n      if (!block.isMovable()) {\n        continue;\n      }\n      const xy = block.getRelativeToSurfaceXY();\n      block.moveBy(-xy.x, cursorY - xy.y);\n      block.snapToGrid();\n      cursorY = block.getRelativeToSurfaceXY().y +\n          block.getHeightWidth().height +\n          this.renderer.getConstants().MIN_BLOCK_HEIGHT;\n    }\n    eventUtils.setGroup(false);\n    this.setResizesEnabled(true);\n  }\n\n  /**\n   * Show the context menu for the workspace.\n   *\n   * @param e Mouse event.\n   * @internal\n   */\n  showContextMenu(e: Event) {\n    if (this.options.readOnly || this.isFlyout) {\n      return;\n    }\n    const menuOptions = ContextMenuRegistry.registry.getContextMenuOptions(\n        ContextMenuRegistry.ScopeType.WORKSPACE, {workspace: this});\n\n    // Allow the developer to add or modify menuOptions.\n    if (this.configureContextMenu) {\n      this.configureContextMenu(menuOptions, e);\n    }\n\n    ContextMenu.show(e, menuOptions, this.RTL);\n  }\n\n  /**\n   * Modify the block tree on the existing toolbox.\n   *\n   * @param toolboxDef DOM tree of toolbox contents, string of toolbox contents,\n   *     or JSON representing toolbox definition.\n   */\n  updateToolbox(toolboxDef: toolbox.ToolboxDefinition|null) {\n    const parsedToolboxDef = toolbox.convertToolboxDefToJson(toolboxDef);\n\n    if (!parsedToolboxDef) {\n      if (this.options.languageTree) {\n        throw Error('Can\\'t nullify an existing toolbox.');\n      }\n      return;  // No change (null to null).\n    }\n    if (!this.options.languageTree) {\n      throw Error('Existing toolbox is null.  Can\\'t create new toolbox.');\n    }\n\n    if (toolbox.hasCategories(parsedToolboxDef)) {\n      if (!this.toolbox_) {\n        throw Error('Existing toolbox has no categories.  Can\\'t change mode.');\n      }\n      this.options.languageTree = parsedToolboxDef;\n      this.toolbox_.render(parsedToolboxDef);\n    } else {\n      if (!this.flyout) {\n        throw Error('Existing toolbox has categories.  Can\\'t change mode.');\n      }\n      this.options.languageTree = parsedToolboxDef;\n      this.flyout.show(parsedToolboxDef);\n    }\n  }\n\n  /** Mark this workspace as the currently focused main workspace. */\n  markFocused() {\n    if (this.options.parentWorkspace) {\n      this.options.parentWorkspace.markFocused();\n    } else {\n      common.setMainWorkspace(this);\n      // We call e.preventDefault in many event handlers which means we\n      // need to explicitly grab focus (e.g from a textarea) because\n      // the browser will not do it for us.  How to do this is browser\n      // dependent.\n      this.setBrowserFocus();\n    }\n  }\n\n  /** Set the workspace to have focus in the browser. */\n  private setBrowserFocus() {\n    // Blur whatever was focused since explicitly grabbing focus below does not\n    // work in Edge.\n    // In IE, SVGs can't be blurred or focused. Check to make sure the current\n    // focus can be blurred before doing so.\n    // See https://github.com/google/blockly/issues/4440\n    if (document.activeElement &&\n        document.activeElement instanceof HTMLElement) {\n      document.activeElement.blur();\n    }\n    try {\n      // Focus the workspace SVG - this is for Chrome and Firefox.\n      this.getParentSvg().focus({preventScroll: true});\n    } catch (e) {\n      // IE and Edge do not support focus on SVG elements. When that fails\n      // above, get the injectionDiv (the workspace's parent) and focus that\n      // instead.  This doesn't work in Chrome.\n      try {\n        // In IE11, use setActive (which is IE only) so the page doesn't scroll\n        // to the workspace gaining focus.\n        (this.getParentSvg().parentElement as any).setActive();\n      } catch (e) {\n        // setActive support was discontinued in Edge so when that fails, call\n        // focus instead.\n        this.getParentSvg().parentElement!.focus({preventScroll: true});\n      }\n    }\n  }\n\n  /**\n   * Zooms the workspace in or out relative to/centered on the given (x, y)\n   * coordinate.\n   *\n   * @param x X coordinate of center, in pixel units relative to the top-left\n   *     corner of the parentSVG.\n   * @param y Y coordinate of center, in pixel units relative to the top-left\n   *     corner of the parentSVG.\n   * @param amount Amount of zooming. The formula for the new scale is newScale\n   *     = currentScale * (scaleSpeed^amount). scaleSpeed is set in the\n   *     workspace options. Negative amount values zoom out, and positive amount\n   *     values zoom in.\n   */\n  zoom(x: number, y: number, amount: number) {\n    // Scale factor.\n    const speed = this.options.zoomOptions.scaleSpeed;\n    let scaleChange = Math.pow(speed, amount);\n    const newScale = this.scale * scaleChange;\n    if (this.scale === newScale) {\n      return;  // No change in zoom.\n    }\n\n    // Clamp scale within valid range.\n    if (newScale > this.options.zoomOptions.maxScale) {\n      scaleChange = this.options.zoomOptions.maxScale / this.scale;\n    } else if (newScale < this.options.zoomOptions.minScale) {\n      scaleChange = this.options.zoomOptions.minScale / this.scale;\n    }\n\n    // Transform the x/y coordinates from the parentSVG's space into the\n    // canvas' space, so that they are in workspace units relative to the top\n    // left of the visible portion of the workspace.\n    let matrix = this.getCanvas().getCTM();\n    let center = (this.getParentSvg()).createSVGPoint();\n    center.x = x;\n    center.y = y;\n    center = center.matrixTransform(matrix!.inverse());\n    x = center.x;\n    y = center.y;\n\n    // Find the new scrollX/scrollY so that the center remains in the same\n    // position (relative to the center) after we zoom.\n    // newScale and matrix.a should be identical (within a rounding error).\n    matrix = matrix!.translate(x * (1 - scaleChange), y * (1 - scaleChange))\n                 .scale(scaleChange);\n    // scrollX and scrollY are in pixels.\n    // The scrollX and scrollY still need to have absoluteLeft and absoluteTop\n    // subtracted from them, but we'll leave that for setScale so that they're\n    // correctly updated for the new flyout size if we have a simple toolbox.\n    this.scrollX = matrix.e;\n    this.scrollY = matrix.f;\n    this.setScale(newScale);\n  }\n\n  /**\n   * Zooming the blocks centered in the center of view with zooming in or out.\n   *\n   * @param type Type of zooming (-1 zooming out and 1 zooming in).\n   */\n  zoomCenter(type: number) {\n    const metrics = this.getMetrics();\n    let x;\n    let y;\n    if (this.flyout) {\n      // If you want blocks in the center of the view (visible portion of the\n      // workspace) to stay centered when the size of the view decreases (i.e.\n      // when the size of the flyout increases) you need the center of the\n      // *blockly div* to stay in the same pixel-position.\n      // Note: This only works because of how scrollCenter positions blocks.\n      x = metrics.svgWidth ? metrics.svgWidth / 2 : 0;\n      y = metrics.svgHeight ? metrics.svgHeight / 2 : 0;\n    } else {\n      x = metrics.viewWidth / 2 + metrics.absoluteLeft;\n      y = metrics.viewHeight / 2 + metrics.absoluteTop;\n    }\n    this.zoom(x, y, type);\n  }\n\n  /** Zoom the blocks to fit in the workspace if possible. */\n  zoomToFit() {\n    if (!this.isMovable()) {\n      console.warn(\n          'Tried to move a non-movable workspace. This could result' +\n          ' in blocks becoming inaccessible.');\n      return;\n    }\n\n    const metrics = this.getMetrics();\n    let workspaceWidth = metrics.viewWidth;\n    let workspaceHeight = metrics.viewHeight;\n    const blocksBox = this.getBlocksBoundingBox();\n    const doubleMargin = ZOOM_TO_FIT_MARGIN * 2;\n    let blocksWidth = blocksBox.right - blocksBox.left + doubleMargin;\n    let blocksHeight = blocksBox.bottom - blocksBox.top + doubleMargin;\n    if (!blocksWidth) {\n      return;  // Prevents zooming to infinity.\n    }\n    if (this.flyout) {\n      // We have to add the flyout size to both the workspace size and the\n      // block size because the blocks we want to resize include the blocks in\n      // the flyout, and the area we want to fit them includes the portion of\n      // the workspace that is behind the flyout.\n      if (this.horizontalLayout) {\n        workspaceHeight += this.flyout.getHeight();\n        // Convert from pixels to workspace coordinates.\n        blocksHeight += this.flyout.getHeight() / this.scale;\n      } else {\n        workspaceWidth += this.flyout.getWidth();\n        // Convert from pixels to workspace coordinates.\n        blocksWidth += this.flyout.getWidth() / this.scale;\n      }\n    }\n\n    // Scale Units: (pixels / workspaceUnit)\n    const ratioX = workspaceWidth / blocksWidth;\n    const ratioY = workspaceHeight / blocksHeight;\n    eventUtils.disable();\n    try {\n      this.setScale(Math.min(ratioX, ratioY));\n      this.scrollCenter();\n    } finally {\n      eventUtils.enable();\n    }\n    this.maybeFireViewportChangeEvent();\n  }\n\n  /**\n   * Add a transition class to the block and bubble canvas, to animate any\n   * transform changes.\n   *\n   * @internal\n   */\n  beginCanvasTransition() {\n    dom.addClass(this.svgBlockCanvas_, 'blocklyCanvasTransitioning');\n    dom.addClass(this.svgBubbleCanvas_, 'blocklyCanvasTransitioning');\n  }\n\n  /**\n   * Remove transition class from the block and bubble canvas.\n   *\n   * @internal\n   */\n  endCanvasTransition() {\n    dom.removeClass(this.svgBlockCanvas_, 'blocklyCanvasTransitioning');\n    dom.removeClass(this.svgBubbleCanvas_, 'blocklyCanvasTransitioning');\n  }\n\n  /** Center the workspace. */\n  scrollCenter() {\n    if (!this.isMovable()) {\n      console.warn(\n          'Tried to move a non-movable workspace. This could result' +\n          ' in blocks becoming inaccessible.');\n      return;\n    }\n\n    const metrics = this.getMetrics();\n    let x = (metrics.scrollWidth - metrics.viewWidth) / 2;\n    let y = (metrics.scrollHeight - metrics.viewHeight) / 2;\n\n    // Convert from workspace directions to canvas directions.\n    x = -x - metrics.scrollLeft;\n    y = -y - metrics.scrollTop;\n    this.scroll(x, y);\n  }\n\n  /**\n   * Scroll the workspace to center on the given block. If the block has other\n   * blocks stacked below it, the workspace will be centered on the stack.\n   *\n   * @param id ID of block center on.\n   */\n  centerOnBlock(id: string|null) {\n    if (!this.isMovable()) {\n      console.warn(\n          'Tried to move a non-movable workspace. This could result' +\n          ' in blocks becoming inaccessible.');\n      return;\n    }\n\n    const block = id ? this.getBlockById(id) : null;\n    if (!block) {\n      return;\n    }\n\n    // XY is in workspace coordinates.\n    const xy = block.getRelativeToSurfaceXY();\n    // Height/width is in workspace units.\n    const heightWidth = block.getHeightWidth();\n\n    // Find the enter of the block in workspace units.\n    const blockCenterY = xy.y + heightWidth.height / 2;\n\n    // In RTL the block's position is the top right of the block, not top left.\n    const multiplier = this.RTL ? -1 : 1;\n    const blockCenterX = xy.x + multiplier * heightWidth.width / 2;\n\n    // Workspace scale, used to convert from workspace coordinates to pixels.\n    const scale = this.scale;\n\n    // Center of block in pixels, relative to workspace origin (center 0,0).\n    // Scrolling to here would put the block in the top-left corner of the\n    // visible workspace.\n    const pixelX = blockCenterX * scale;\n    const pixelY = blockCenterY * scale;\n\n    const metrics = this.getMetrics();\n\n    // viewHeight and viewWidth are in pixels.\n    const halfViewWidth = metrics.viewWidth / 2;\n    const halfViewHeight = metrics.viewHeight / 2;\n\n    // Put the block in the center of the visible workspace instead.\n    const scrollToCenterX = pixelX - halfViewWidth;\n    const scrollToCenterY = pixelY - halfViewHeight;\n\n    // Convert from workspace directions to canvas directions.\n    const x = -scrollToCenterX;\n    const y = -scrollToCenterY;\n\n    this.scroll(x, y);\n  }\n\n  /**\n   * Set the workspace's zoom factor.\n   *\n   * @param newScale Zoom factor. Units: (pixels / workspaceUnit).\n   */\n  setScale(newScale: number) {\n    if (this.options.zoomOptions.maxScale &&\n        newScale > this.options.zoomOptions.maxScale) {\n      newScale = this.options.zoomOptions.maxScale;\n    } else if (\n        this.options.zoomOptions.minScale &&\n        newScale < this.options.zoomOptions.minScale) {\n      newScale = this.options.zoomOptions.minScale;\n    }\n    this.scale = newScale;\n\n    this.hideChaff(false);\n    // Get the flyout, if any, whether our own or owned by the toolbox.\n    const flyout = this.getFlyout(false);\n    if (flyout && flyout.isVisible()) {\n      flyout.reflow();\n      this.recordDragTargets();\n    }\n    if (this.grid) {\n      this.grid.update(this.scale);\n    }\n\n    // We call scroll instead of scrollbar.resize() so that we can center the\n    // zoom correctly without scrollbars, but scroll does not resize the\n    // scrollbars so we have to call resizeView/resizeContent as well.\n    const metrics = this.getMetrics();\n\n    this.scrollX -= metrics.absoluteLeft;\n    this.scrollY -= metrics.absoluteTop;\n    // The scroll values and the view values are additive inverses of\n    // each other, so when we subtract from one we have to add to the other.\n    metrics.viewLeft += metrics.absoluteLeft;\n    metrics.viewTop += metrics.absoluteTop;\n\n    this.scroll(this.scrollX, this.scrollY);\n    if (this.scrollbar) {\n      if (this.flyout) {\n        this.scrollbar.resizeView(metrics);\n      } else {\n        this.scrollbar.resizeContent(metrics);\n      }\n    }\n  }\n\n  /**\n   * Get the workspace's zoom factor.  If the workspace has a parent, we call\n   * into the parent to get the workspace scale.\n   *\n   * @returns The workspace zoom factor. Units: (pixels / workspaceUnit).\n   */\n  getScale(): number {\n    if (this.options.parentWorkspace) {\n      return this.options.parentWorkspace.getScale();\n    }\n    return this.scale;\n  }\n\n  /**\n   * Scroll the workspace to a specified offset (in pixels), keeping in the\n   * workspace bounds. See comment on workspaceSvg.scrollX for more detail on\n   * the meaning of these values.\n   *\n   * @param x Target X to scroll to.\n   * @param y Target Y to scroll to.\n   * @internal\n   */\n  scroll(x: number, y: number) {\n    this.hideChaff(/* opt_onlyClosePopups= */\n                   true);\n\n    // Keep scrolling within the bounds of the content.\n    const metrics = this.getMetrics();\n    // Canvas coordinates (aka scroll coordinates) have inverse directionality\n    // to workspace coordinates so we have to inverse them.\n    x = Math.min(x, -metrics.scrollLeft);\n    y = Math.min(y, -metrics.scrollTop);\n    const maxXDisplacement =\n        Math.max(0, metrics.scrollWidth - metrics.viewWidth);\n    const maxXScroll = metrics.scrollLeft + maxXDisplacement;\n    const maxYDisplacement =\n        Math.max(0, metrics.scrollHeight - metrics.viewHeight);\n    const maxYScroll = metrics.scrollTop + maxYDisplacement;\n    x = Math.max(x, -maxXScroll);\n    y = Math.max(y, -maxYScroll);\n    this.scrollX = x;\n    this.scrollY = y;\n\n    if (this.scrollbar) {\n      // The content position (displacement from the content's top-left to the\n      // origin) plus the scroll position (displacement from the view's top-left\n      // to the origin) gives us the distance from the view's top-left to the\n      // content's top-left. Then we negate this so we get the displacement from\n      // the content's top-left to the view's top-left, matching the\n      // directionality of the scrollbars.\n      this.scrollbar.set(\n          -(x + metrics.scrollLeft), -(y + metrics.scrollTop), false);\n    }\n    // We have to shift the translation so that when the canvas is at 0, 0 the\n    // workspace origin is not underneath the toolbox.\n    x += metrics.absoluteLeft;\n    y += metrics.absoluteTop;\n    this.translate(x, y);\n  }\n\n  /**\n   * Find the block on this workspace with the specified ID.\n   *\n   * @param id ID of block to find.\n   * @returns The sought after block, or null if not found.\n   */\n  override getBlockById(id: string): BlockSvg|null {\n    return super.getBlockById(id) as BlockSvg;\n  }\n\n  /**\n   * Find all blocks in workspace.  Blocks are optionally sorted\n   * by position; top to bottom (with slight LTR or RTL bias).\n   *\n   * @param ordered Sort the list if true.\n   * @returns Array of blocks.\n   */\n  override getAllBlocks(ordered: boolean): BlockSvg[] {\n    return super.getAllBlocks(ordered) as BlockSvg[];\n  }\n\n  /**\n   * Finds the top-level blocks and returns them.  Blocks are optionally sorted\n   * by position; top to bottom (with slight LTR or RTL bias).\n   *\n   * @param ordered Sort the list if true.\n   * @returns The top-level block objects.\n   */\n  override getTopBlocks(ordered: boolean): BlockSvg[] {\n    return super.getTopBlocks(ordered) as BlockSvg[];\n  }\n\n  /**\n   * Adds a block to the list of top blocks.\n   *\n   * @param block Block to add.\n   */\n  override addTopBlock(block: Block) {\n    this.addTopBoundedElement(block as BlockSvg);\n    super.addTopBlock(block);\n  }\n\n  /**\n   * Removes a block from the list of top blocks.\n   *\n   * @param block Block to remove.\n   */\n  override removeTopBlock(block: Block) {\n    this.removeTopBoundedElement(block as BlockSvg);\n    super.removeTopBlock(block);\n  }\n\n  /**\n   * Adds a comment to the list of top comments.\n   *\n   * @param comment comment to add.\n   */\n  override addTopComment(comment: WorkspaceComment) {\n    this.addTopBoundedElement(comment as WorkspaceCommentSvg);\n    super.addTopComment(comment);\n  }\n\n  /**\n   * Removes a comment from the list of top comments.\n   *\n   * @param comment comment to remove.\n   */\n  override removeTopComment(comment: WorkspaceComment) {\n    this.removeTopBoundedElement(comment as WorkspaceCommentSvg);\n    super.removeTopComment(comment);\n  }\n\n  /**\n   * Adds a bounded element to the list of top bounded elements.\n   *\n   * @param element Bounded element to add.\n   */\n  addTopBoundedElement(element: IBoundedElement) {\n    this.topBoundedElements.push(element);\n  }\n\n  /**\n   * Removes a bounded element from the list of top bounded elements.\n   *\n   * @param element Bounded element to remove.\n   */\n  removeTopBoundedElement(element: IBoundedElement) {\n    arrayUtils.removeElem(this.topBoundedElements, element);\n  }\n\n  /**\n   * Finds the top-level bounded elements and returns them.\n   *\n   * @returns The top-level bounded elements.\n   */\n  getTopBoundedElements(): IBoundedElement[] {\n    return (new Array<IBoundedElement>()).concat(this.topBoundedElements);\n  }\n\n  /**\n   * Update whether this workspace has resizes enabled.\n   * If enabled, workspace will resize when appropriate.\n   * If disabled, workspace will not resize until re-enabled.\n   * Use to avoid resizing during a batch operation, for performance.\n   *\n   * @param enabled Whether resizes should be enabled.\n   */\n  setResizesEnabled(enabled: boolean) {\n    const reenabled = !this.resizesEnabled && enabled;\n    this.resizesEnabled = enabled;\n    if (reenabled) {\n      // Newly enabled.  Trigger a resize.\n      this.resizeContents();\n    }\n  }\n\n  /**\n   * Dispose of all blocks in workspace, with an optimization to prevent\n   * resizes.\n   */\n  override clear() {\n    this.setResizesEnabled(false);\n    super.clear();\n    this.topBoundedElements = [];\n    this.setResizesEnabled(true);\n  }\n\n  /**\n   * Register a callback function associated with a given key, for clicks on\n   * buttons and labels in the flyout.\n   * For instance, a button specified by the XML\n   * <button text=\"create variable\" callbackKey=\"CREATE_VARIABLE\"></button>\n   * should be matched by a call to\n   * registerButtonCallback(\"CREATE_VARIABLE\", yourCallbackFunction).\n   *\n   * @param key The name to use to look up this function.\n   * @param func The function to call when the given button is clicked.\n   */\n  registerButtonCallback(key: string, func: (p1: FlyoutButton) => void) {\n    if (typeof func !== 'function') {\n      throw TypeError('Button callbacks must be functions.');\n    }\n    this.flyoutButtonCallbacks.set(key, func);\n  }\n\n  /**\n   * Get the callback function associated with a given key, for clicks on\n   * buttons and labels in the flyout.\n   *\n   * @param key The name to use to look up the function.\n   * @returns The function corresponding to the given key for this workspace;\n   *     null if no callback is registered.\n   */\n  getButtonCallback(key: string): ((p1: FlyoutButton) => void)|null {\n    return this.flyoutButtonCallbacks.get(key) ?? null;\n  }\n\n  /**\n   * Remove a callback for a click on a button in the flyout.\n   *\n   * @param key The name associated with the callback function.\n   */\n  removeButtonCallback(key: string) {\n    this.flyoutButtonCallbacks.delete(key);\n  }\n\n  /**\n   * Register a callback function associated with a given key, for populating\n   * custom toolbox categories in this workspace.  See the variable and\n   * procedure categories as an example.\n   *\n   * @param key The name to use to look up this function.\n   * @param func The function to call when the given toolbox category is opened.\n   */\n  registerToolboxCategoryCallback(\n      key: string, func: (p1: WorkspaceSvg) => toolbox.FlyoutDefinition) {\n    if (typeof func !== 'function') {\n      throw TypeError('Toolbox category callbacks must be functions.');\n    }\n    this.toolboxCategoryCallbacks.set(key, func);\n  }\n\n  /**\n   * Get the callback function associated with a given key, for populating\n   * custom toolbox categories in this workspace.\n   *\n   * @param key The name to use to look up the function.\n   * @returns The function corresponding to the given key for this workspace, or\n   *     null if no function is registered.\n   */\n  getToolboxCategoryCallback(key: string):\n      ((p1: WorkspaceSvg) => toolbox.FlyoutDefinition)|null {\n    return this.toolboxCategoryCallbacks.get(key) || null;\n  }\n\n  /**\n   * Remove a callback for a click on a custom category's name in the toolbox.\n   *\n   * @param key The name associated with the callback function.\n   */\n  removeToolboxCategoryCallback(key: string) {\n    this.toolboxCategoryCallbacks.delete(key);\n  }\n\n  /**\n   * Look up the gesture that is tracking this touch stream on this workspace.\n   * May create a new gesture.\n   *\n   * @param e Pointer event.\n   * @returns The gesture that is tracking this touch stream, or null if no\n   *     valid gesture exists.\n   * @internal\n   */\n  getGesture(e: PointerEvent): Gesture|null {\n    const isStart = e.type === 'pointerdown';\n\n    const gesture = this.currentGesture_;\n    if (gesture) {\n      if (isStart && gesture.hasStarted()) {\n        console.warn('Tried to start the same gesture twice.');\n        // That's funny.  We must have missed a mouse up.\n        // Cancel it, rather than try to retrieve all of the state we need.\n        gesture.cancel();\n        return null;\n      }\n      return gesture;\n    }\n\n    // No gesture existed on this workspace, but this looks like the start of a\n    // new gesture.\n    if (isStart) {\n      this.currentGesture_ = new Gesture(e, this);\n      return this.currentGesture_;\n    }\n    // No gesture existed and this event couldn't be the start of a new gesture.\n    return null;\n  }\n\n  /**\n   * Clear the reference to the current gesture.\n   *\n   * @internal\n   */\n  clearGesture() {\n    this.currentGesture_ = null;\n  }\n\n  /**\n   * Cancel the current gesture, if one exists.\n   *\n   * @internal\n   */\n  cancelCurrentGesture() {\n    if (this.currentGesture_) {\n      this.currentGesture_.cancel();\n    }\n  }\n\n  /**\n   * Get the audio manager for this workspace.\n   *\n   * @returns The audio manager for this workspace.\n   */\n  getAudioManager(): WorkspaceAudio {\n    return this.audioManager;\n  }\n\n  /**\n   * Get the grid object for this workspace, or null if there is none.\n   *\n   * @returns The grid object for this workspace.\n   * @internal\n   */\n  getGrid(): Grid|null {\n    return this.grid;\n  }\n\n  /**\n   * Close tooltips, context menus, dropdown selections, etc.\n   *\n   * @param opt_onlyClosePopups Whether only popups should be closed.\n   */\n  hideChaff(opt_onlyClosePopups?: boolean) {\n    Tooltip.hide();\n    WidgetDiv.hide();\n    dropDownDiv.hideWithoutAnimation();\n\n    const onlyClosePopups = !!opt_onlyClosePopups;\n    const autoHideables = this.getComponentManager().getComponents(\n        ComponentManager.Capability.AUTOHIDEABLE, true);\n    autoHideables.forEach(\n        (autoHideable) => autoHideable.autoHide(onlyClosePopups));\n  }\n\n  /**\n   * Sets the X/Y translations of a top level workspace.\n   *\n   * @param xyRatio Contains an x and/or y property which is a float between 0\n   *     and 1 specifying the degree of scrolling.\n   */\n  private static setTopLevelWorkspaceMetrics_(\n      this: WorkspaceSvg, xyRatio: {x?: number, y?: number}) {\n    const metrics = this.getMetrics();\n\n    if (typeof xyRatio.x === 'number') {\n      this.scrollX =\n          -(metrics.scrollLeft +\n            (metrics.scrollWidth - metrics.viewWidth) * xyRatio.x);\n    }\n    if (typeof xyRatio.y === 'number') {\n      this.scrollY =\n          -(metrics.scrollTop +\n            (metrics.scrollHeight - metrics.viewHeight) * xyRatio.y);\n    }\n    // We have to shift the translation so that when the canvas is at 0, 0 the\n    // workspace origin is not underneath the toolbox.\n    const x = this.scrollX + metrics.absoluteLeft;\n    const y = this.scrollY + metrics.absoluteTop;\n    // We could call scroll here, but that has extra checks we don't need to do.\n    this.translate(x, y);\n  }\n}\n\n/**\n * Size the workspace when the contents change.  This also updates\n * scrollbars accordingly.\n *\n * @param workspace The workspace to resize.\n * @alias Blockly.WorkspaceSvg.resizeSvgContents\n * @internal\n */\nexport function resizeSvgContents(workspace: WorkspaceSvg) {\n  workspace.resizeContents();\n}\n","/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {IParameterModel} from '../interfaces/i_parameter_model.js';\nimport {IProcedureModel} from '../interfaces/i_procedure_model.js';\nimport type {ISerializer} from '../interfaces/i_serializer.js';\nimport {ObservableProcedureModel} from '../procedures/observable_procedure_model.js';\nimport {ObservableParameterModel} from '../procedures/observable_parameter_model.js';\nimport * as priorities from './priorities.js';\n// import * as serializationRegistry from './registry.js';\nimport type {Workspace} from '../workspace.js';\n\n\n/**\n * Representation of a procedure data model.\n */\nexport interface State {\n  // TODO: This should also handle enabled.\n  id: string, name: string, returnTypes: string[]|null,\n      parameters?: ParameterState[],\n}\n\n/**\n * Representation of a parameter data model.\n */\nexport interface ParameterState {\n  id: string, name: string, types?: string[],\n}\n\n/**\n * A newable signature for an IProcedureModel.\n *\n * Refer to\n * https://www.typescriptlang.org/docs/handbook/2/generics.html#using-class-types-in-generics\n * for what is going on with this.\n */\ntype ProcedureModelConstructor<ProcedureModel extends IProcedureModel> =\n    new (workspace: Workspace, name: string, id: string) => ProcedureModel;\n\n/**\n * A newable signature for an IParameterModel.\n *\n * Refer to\n * https://www.typescriptlang.org/docs/handbook/2/generics.html#using-class-types-in-generics\n * for what is going on with this.\n */\ntype ParameterModelConstructor<ParameterModel extends IParameterModel> =\n    new (workspace: Workspace, name: string, id: string) => ParameterModel;\n\n\n/**\n * Serializes the given IProcedureModel to JSON.\n *\n * @internal\n */\nexport function saveProcedure(proc: IProcedureModel): State {\n  const state: State = {\n    id: proc.getId(),\n    name: proc.getName(),\n    returnTypes: proc.getReturnTypes(),\n  };\n  if (!proc.getParameters().length) return state;\n  state.parameters = proc.getParameters().map((param) => saveParameter(param));\n  return state;\n}\n\n/**\n * Serializes the given IParameterModel to JSON.\n *\n * @internal\n */\nexport function saveParameter(param: IParameterModel): ParameterState {\n  const state: ParameterState = {\n    id: param.getId(),\n    name: param.getName(),\n  };\n  if (!param.getTypes().length) return state;\n  state.types = param.getTypes();\n  return state;\n}\n\n/**\n * Deserializes the given procedure model State from JSON.\n *\n * @internal\n */\nexport function\nloadProcedure<ProcedureModel extends IProcedureModel,\n                                     ParameterModel extends IParameterModel>(\n    procedureModelClass: ProcedureModelConstructor<ProcedureModel>,\n    parameterModelClass: ParameterModelConstructor<ParameterModel>,\n    state: State, workspace: Workspace): ProcedureModel {\n  const proc = new procedureModelClass(workspace, state.name, state.id)\n                   .setReturnTypes(state.returnTypes);\n  if (!state.parameters) return proc;\n  for (const [index, param] of state.parameters.entries()) {\n    proc.insertParameter(\n        loadParameter(parameterModelClass, param, workspace), index);\n  }\n  return proc;\n}\n\n/**\n * Deserializes the given ParameterState from JSON.\n *\n * @internal\n */\nexport function loadParameter<ParameterModel extends IParameterModel>(\n    parameterModelClass: ParameterModelConstructor<ParameterModel>,\n    state: ParameterState, workspace: Workspace): ParameterModel {\n  const model = new parameterModelClass(workspace, state.name, state.id);\n  if (state.types) model.setTypes(state.types);\n  return model;\n}\n\n/** Serializer for saving and loading procedure state. */\nexport class ProcedureSerializer<ProcedureModel extends IProcedureModel,\n                                                        ParameterModel extends\n                                     IParameterModel> implements ISerializer {\n  public priority = priorities.PROCEDURES;\n\n  /**\n   * Constructs the procedure serializer.\n   *\n   * Example usage:\n   *   new ProcedureSerializer(MyProcedureModelClass, MyParameterModelClass)\n   *\n   * @param procedureModelClass The class (implementing IProcedureModel) that\n   *     you want this serializer to deserialize.\n   * @param parameterModelClass The class (implementing IParameterModel) that\n   *     you want this serializer to deserialize.\n   */\n  constructor(\n      private readonly procedureModelClass:\n          ProcedureModelConstructor<ProcedureModel>,\n      private readonly parameterModelClass:\n          ParameterModelConstructor<ParameterModel>) {}\n\n  /** Serializes the procedure models of the given workspace. */\n  save(workspace: Workspace): State[]|null {\n    return workspace.getProcedureMap().getProcedures().map(\n        (proc) => saveProcedure(proc));\n  }\n\n  /**\n   * Deserializes the procedures models defined by the given state into the\n   * workspace.\n   */\n  load(state: State[], workspace: Workspace) {\n    const map = workspace.getProcedureMap();\n    for (const procState of state) {\n      map.add(loadProcedure(\n          this.procedureModelClass, this.parameterModelClass, procState,\n          workspace));\n    }\n  }\n\n  /** Disposes of any procedure models that exist on the workspace. */\n  clear(workspace: Workspace) {\n    workspace.getProcedureMap().clear();\n  }\n}\n\n/**\n * A ProcedureSerializer that deserializes to create the built-in\n * ObservableProcedureModels and ObservableParameterModels.\n */\nexport const observableProcedureSerializer =\n    new ProcedureSerializer(ObservableProcedureModel, ObservableParameterModel);\n\n// serializationRegistry.register('procedures', observableProcedureSerializer);\n","/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Utilities for bumping objects back into worksapce bounds.\n *\n * @namespace Blockly.bumpObjects\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.bumpObjects');\n\nimport type {BlockSvg} from './block_svg.js';\nimport type {Abstract} from './events/events_abstract.js';\nimport type {BlockCreate} from './events/events_block_create.js';\nimport type {BlockMove} from './events/events_block_move.js';\nimport type {CommentCreate} from './events/events_comment_create.js';\nimport type {CommentMove} from './events/events_comment_move.js';\nimport type {ViewportChange} from './events/events_viewport.js';\nimport * as eventUtils from './events/utils.js';\nimport type {IBoundedElement} from './interfaces/i_bounded_element.js';\nimport type {ContainerRegion} from './metrics_manager.js';\nimport * as mathUtils from './utils/math.js';\nimport type {WorkspaceCommentSvg} from './workspace_comment_svg.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/**\n * Bumps the given object that has passed out of bounds.\n *\n * @param workspace The workspace containing the object.\n * @param scrollMetrics Scroll metrics\n *    in workspace coordinates.\n * @param object The object to bump.\n * @returns True if block was bumped.\n * @alias Blockly.bumpObjects.bumpIntoBounds\n */\nfunction bumpObjectIntoBounds(\n    workspace: WorkspaceSvg, scrollMetrics: ContainerRegion,\n    object: IBoundedElement): boolean {\n  // Compute new top/left position for object.\n  const objectMetrics = object.getBoundingRectangle();\n  const height = objectMetrics.bottom - objectMetrics.top;\n  const width = objectMetrics.right - objectMetrics.left;\n\n  const topClamp = scrollMetrics.top;\n  const scrollMetricsBottom = scrollMetrics.top + scrollMetrics.height;\n  const bottomClamp = scrollMetricsBottom - height;\n  // If the object is taller than the workspace we want to\n  // top-align the block\n  const newYPosition =\n      mathUtils.clamp(topClamp, objectMetrics.top, bottomClamp);\n  const deltaY = newYPosition - objectMetrics.top;\n\n  // Note: Even in RTL mode the \"anchor\" of the object is the\n  // top-left corner of the object.\n  let leftClamp = scrollMetrics.left;\n  const scrollMetricsRight = scrollMetrics.left + scrollMetrics.width;\n  let rightClamp = scrollMetricsRight - width;\n  if (workspace.RTL) {\n    // If the object is wider than the workspace and we're in RTL\n    // mode we want to right-align the block, which means setting\n    // the left clamp to match.\n    leftClamp = Math.min(rightClamp, leftClamp);\n  } else {\n    // If the object is wider than the workspace and we're in LTR\n    // mode we want to left-align the block, which means setting\n    // the right clamp to match.\n    rightClamp = Math.max(leftClamp, rightClamp);\n  }\n  const newXPosition =\n      mathUtils.clamp(leftClamp, objectMetrics.left, rightClamp);\n  const deltaX = newXPosition - objectMetrics.left;\n\n  if (deltaX || deltaY) {\n    object.moveBy(deltaX, deltaY);\n    return true;\n  }\n  return false;\n}\nexport const bumpIntoBounds = bumpObjectIntoBounds;\n\n/**\n * Creates a handler for bumping objects when they cross fixed bounds.\n *\n * @param workspace The workspace to handle.\n * @returns The event handler.\n * @alias Blockly.bumpObjects.bumpIntoBoundsHandler\n */\nexport function bumpIntoBoundsHandler(workspace: WorkspaceSvg):\n    (p1: Abstract) => void {\n  return (e) => {\n    const metricsManager = workspace.getMetricsManager();\n    if (!metricsManager.hasFixedEdges() || workspace.isDragging()) {\n      return;\n    }\n\n    if (eventUtils.BUMP_EVENTS.indexOf(e.type ?? '') !== -1) {\n      const scrollMetricsInWsCoords = metricsManager.getScrollMetrics(true);\n\n      // Triggered by move/create event\n      const object =\n          extractObjectFromEvent(workspace, e as eventUtils.BumpEvent);\n      if (!object) {\n        return;\n      }\n      // Handle undo.\n      const oldGroup = eventUtils.getGroup();\n      eventUtils.setGroup(e.group);\n\n      const wasBumped = bumpObjectIntoBounds(\n          workspace, scrollMetricsInWsCoords, (object as IBoundedElement));\n\n      if (wasBumped && !e.group) {\n        console.warn(\n            'Moved object in bounds but there was no' +\n            ' event group. This may break undo.');\n      }\n      if (oldGroup !== null) {\n        eventUtils.setGroup(oldGroup);\n      }\n    } else if (e.type === eventUtils.VIEWPORT_CHANGE) {\n      const viewportEvent = (e as ViewportChange);\n      if (viewportEvent.scale && viewportEvent.oldScale &&\n          viewportEvent.scale > viewportEvent.oldScale) {\n        bumpTopObjectsIntoBounds(workspace);\n      }\n    }\n  };\n}\n\n/**\n * Extracts the object from the given event.\n *\n * @param workspace The workspace the event originated\n *    from.\n * @param e An event containing an object.\n * @returns The extracted\n *    object.\n */\nfunction extractObjectFromEvent(\n    workspace: WorkspaceSvg, e: eventUtils.BumpEvent): BlockSvg|null|\n    WorkspaceCommentSvg {\n  let object = null;\n  switch (e.type) {\n    case eventUtils.BLOCK_CREATE:\n    case eventUtils.BLOCK_MOVE:\n      object = workspace.getBlockById((e as BlockCreate | BlockMove).blockId!);\n      if (object) {\n        object = object.getRootBlock();\n      }\n      break;\n    case eventUtils.COMMENT_CREATE:\n    case eventUtils.COMMENT_MOVE:\n      object =\n          workspace.getCommentById((e as CommentCreate | CommentMove).commentId!\n                                   ) as WorkspaceCommentSvg |\n          null;\n      break;\n  }\n  return object;\n}\n\n/**\n * Bumps the top objects in the given workspace into bounds.\n *\n * @param workspace The workspace.\n * @alias Blockly.bumpObjects.bumpTopObjectsIntoBounds\n */\nexport function bumpTopObjectsIntoBounds(workspace: WorkspaceSvg) {\n  const metricsManager = workspace.getMetricsManager();\n  if (!metricsManager.hasFixedEdges() || workspace.isDragging()) {\n    return;\n  }\n\n  const scrollMetricsInWsCoords = metricsManager.getScrollMetrics(true);\n  const topBlocks = workspace.getTopBoundedElements();\n  for (let i = 0, block; block = topBlocks[i]; i++) {\n    bumpObjectIntoBounds(workspace, scrollMetricsInWsCoords, block);\n  }\n}\n","/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Functions for injecting Blockly into a web page.\n *\n * @namespace Blockly.inject\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.inject');\n\nimport {BlockDragSurfaceSvg} from './block_drag_surface.js';\nimport type {BlocklyOptions} from './blockly_options.js';\nimport * as browserEvents from './browser_events.js';\nimport * as bumpObjects from './bump_objects.js';\nimport * as common from './common.js';\nimport * as Css from './css.js';\nimport * as dropDownDiv from './dropdowndiv.js';\nimport {Grid} from './grid.js';\nimport {Msg} from './msg.js';\nimport {Options} from './options.js';\nimport {ScrollbarPair} from './scrollbar_pair.js';\nimport {ShortcutRegistry} from './shortcut_registry.js';\nimport * as Tooltip from './tooltip.js';\nimport * as Touch from './touch.js';\nimport * as aria from './utils/aria.js';\nimport * as dom from './utils/dom.js';\nimport {Svg} from './utils/svg.js';\nimport * as userAgent from './utils/useragent.js';\nimport * as WidgetDiv from './widgetdiv.js';\nimport {WorkspaceDragSurfaceSvg} from './workspace_drag_surface_svg.js';\nimport {WorkspaceSvg} from './workspace_svg.js';\n\n\n/**\n * Inject a Blockly editor into the specified container element (usually a div).\n *\n * @param container Containing element, or its ID, or a CSS selector.\n * @param opt_options Optional dictionary of options.\n * @returns Newly created main workspace.\n * @alias Blockly.inject\n */\nexport function inject(\n    container: Element|string, opt_options?: BlocklyOptions): WorkspaceSvg {\n  if (typeof container === 'string') {\n    // AnyDuringMigration because:  Type 'Element | null' is not assignable to\n    // type 'string | Element'.\n    container = (document.getElementById(container) ||\n                 document.querySelector(container)) as AnyDuringMigration;\n  }\n  // Verify that the container is in document.\n  // AnyDuringMigration because:  Argument of type 'string | Element' is not\n  // assignable to parameter of type 'Node'.\n  if (!container ||\n      !dom.containsNode(document, container as AnyDuringMigration)) {\n    throw Error('Error: container is not in current document.');\n  }\n  const options = new Options(opt_options || {} as BlocklyOptions);\n  const subContainer = (document.createElement('div'));\n  subContainer.className = 'injectionDiv';\n  subContainer.tabIndex = 0;\n  aria.setState(subContainer, aria.State.LABEL, Msg['WORKSPACE_ARIA_LABEL']);\n\n  // AnyDuringMigration because:  Property 'appendChild' does not exist on type\n  // 'string | Element'.\n  (container as AnyDuringMigration).appendChild(subContainer);\n  const svg = createDom(subContainer, options);\n\n  // Create surfaces for dragging things. These are optimizations\n  // so that the browser does not repaint during the drag.\n  const blockDragSurface = new BlockDragSurfaceSvg(subContainer);\n\n  const workspaceDragSurface = new WorkspaceDragSurfaceSvg(subContainer);\n\n  const workspace =\n      createMainWorkspace(svg, options, blockDragSurface, workspaceDragSurface);\n\n  init(workspace);\n\n  // Keep focus on the first workspace so entering keyboard navigation looks\n  // correct.\n  // AnyDuringMigration because:  Argument of type 'WorkspaceSvg' is not\n  // assignable to parameter of type 'Workspace'.\n  common.setMainWorkspace(workspace as AnyDuringMigration);\n\n  common.svgResize(workspace);\n\n  subContainer.addEventListener('focusin', function() {\n    // AnyDuringMigration because:  Argument of type 'WorkspaceSvg' is not\n    // assignable to parameter of type 'Workspace'.\n    common.setMainWorkspace(workspace as AnyDuringMigration);\n  });\n\n  return workspace;\n}\n\n/**\n * Create the SVG image.\n *\n * @param container Containing element.\n * @param options Dictionary of options.\n * @returns Newly created SVG image.\n */\nfunction createDom(container: Element, options: Options): Element {\n  // Sadly browsers (Chrome vs Firefox) are currently inconsistent in laying\n  // out content in RTL mode.  Therefore Blockly forces the use of LTR,\n  // then manually positions content in RTL as needed.\n  container.setAttribute('dir', 'LTR');\n\n  // Load CSS.\n  Css.inject(options.hasCss, options.pathToMedia);\n\n  // Build the SVG DOM.\n  /*\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      xmlns:html=\"http://www.w3.org/1999/xhtml\"\n      xmlns:xlink=\"http://www.w3.org/1999/xlink\"\n      version=\"1.1\"\n      class=\"blocklySvg\">\n      ...\n    </svg>\n    */\n  const svg = dom.createSvgElement(\n      Svg.SVG, {\n        'xmlns': dom.SVG_NS,\n        'xmlns:html': dom.HTML_NS,\n        'xmlns:xlink': dom.XLINK_NS,\n        'version': '1.1',\n        'class': 'blocklySvg',\n        'tabindex': '0',\n      },\n      container);\n  /*\n    <defs>\n      ... filters go here ...\n    </defs>\n    */\n  const defs = dom.createSvgElement(Svg.DEFS, {}, svg);\n  // Each filter/pattern needs a unique ID for the case of multiple Blockly\n  // instances on a page.  Browser behaviour becomes undefined otherwise.\n  // https://neil.fraser.name/news/2015/11/01/\n  const rnd = String(Math.random()).substring(2);\n\n  options.gridPattern = Grid.createDom(rnd, options.gridOptions, defs);\n  return svg;\n}\n\n/**\n * Create a main workspace and add it to the SVG.\n *\n * @param svg SVG element with pattern defined.\n * @param options Dictionary of options.\n * @param blockDragSurface Drag surface SVG for the blocks.\n * @param workspaceDragSurface Drag surface SVG for the workspace.\n * @returns Newly created main workspace.\n */\nfunction createMainWorkspace(\n    svg: Element, options: Options, blockDragSurface: BlockDragSurfaceSvg,\n    workspaceDragSurface: WorkspaceDragSurfaceSvg): WorkspaceSvg {\n  options.parentWorkspace = null;\n  const mainWorkspace =\n      new WorkspaceSvg(options, blockDragSurface, workspaceDragSurface);\n  const wsOptions = mainWorkspace.options;\n  mainWorkspace.scale = wsOptions.zoomOptions.startScale;\n  svg.appendChild(mainWorkspace.createDom('blocklyMainBackground'));\n\n  // Set the theme name and renderer name onto the injection div.\n  const injectionDiv = mainWorkspace.getInjectionDiv();\n  const rendererClassName = mainWorkspace.getRenderer().getClassName();\n  if (rendererClassName) {\n    dom.addClass(injectionDiv, rendererClassName);\n  }\n  const themeClassName = mainWorkspace.getTheme().getClassName();\n  if (themeClassName) {\n    dom.addClass(injectionDiv, themeClassName);\n  }\n\n  if (!wsOptions.hasCategories && wsOptions.languageTree) {\n    // Add flyout as an <svg> that is a sibling of the workspace SVG.\n    const flyout = mainWorkspace.addFlyout(Svg.SVG);\n    dom.insertAfter(flyout, svg);\n  }\n  if (wsOptions.hasTrashcan) {\n    mainWorkspace.addTrashcan();\n  }\n  if (wsOptions.zoomOptions && wsOptions.zoomOptions.controls) {\n    mainWorkspace.addZoomControls();\n  }\n  // Register the workspace svg as a UI component.\n  mainWorkspace.getThemeManager().subscribe(\n      svg, 'workspaceBackgroundColour', 'background-color');\n\n  // A null translation will also apply the correct initial scale.\n  mainWorkspace.translate(0, 0);\n\n  mainWorkspace.addChangeListener(\n      bumpObjects.bumpIntoBoundsHandler(mainWorkspace));\n\n  // The SVG is now fully assembled.\n  common.svgResize(mainWorkspace);\n  WidgetDiv.createDom();\n  dropDownDiv.createDom();\n  Tooltip.createDom();\n  return mainWorkspace;\n}\n\n/**\n * Initialize Blockly with various handlers.\n *\n * @param mainWorkspace Newly created main workspace.\n */\nfunction init(mainWorkspace: WorkspaceSvg) {\n  const options = mainWorkspace.options;\n  const svg = mainWorkspace.getParentSvg();\n\n  // Suppress the browser's context menu.\n  browserEvents.conditionalBind(\n      svg.parentNode as Element, 'contextmenu', null,\n      function(e: AnyDuringMigration) {\n        if (!browserEvents.isTargetInput(e)) {\n          e.preventDefault();\n        }\n      });\n\n  const workspaceResizeHandler =\n      browserEvents.conditionalBind(window, 'resize', null, function() {\n        mainWorkspace.hideChaff(true);\n        common.svgResize(mainWorkspace);\n        bumpObjects.bumpTopObjectsIntoBounds(mainWorkspace);\n      });\n  mainWorkspace.setResizeHandlerWrapper(workspaceResizeHandler);\n\n  bindDocumentEvents();\n\n  if (options.languageTree) {\n    const toolbox = mainWorkspace.getToolbox();\n    const flyout = mainWorkspace.getFlyout(true);\n    if (toolbox) {\n      toolbox.init();\n    } else if (flyout) {\n      // Build a fixed flyout with the root blocks.\n      flyout.init(mainWorkspace);\n      flyout.show(options.languageTree);\n      if (typeof flyout.scrollToStart === 'function') {\n        flyout.scrollToStart();\n      }\n    }\n  }\n\n  if (options.hasTrashcan) {\n    mainWorkspace.trashcan!.init();\n  }\n  if (options.zoomOptions && options.zoomOptions.controls) {\n    mainWorkspace.zoomControls_!.init();\n  }\n\n  if (options.moveOptions && options.moveOptions.scrollbars) {\n    const horizontalScroll = options.moveOptions.scrollbars === true ||\n        !!options.moveOptions.scrollbars.horizontal;\n    const verticalScroll = options.moveOptions.scrollbars === true ||\n        !!options.moveOptions.scrollbars.vertical;\n    mainWorkspace.scrollbar = new ScrollbarPair(\n        mainWorkspace, horizontalScroll, verticalScroll,\n        'blocklyMainWorkspaceScrollbar');\n    mainWorkspace.scrollbar.resize();\n  } else {\n    mainWorkspace.setMetrics({x: 0.5, y: 0.5});\n  }\n\n  // Load the sounds.\n  if (options.hasSounds) {\n    loadSounds(options.pathToMedia, mainWorkspace);\n  }\n}\n\n/**\n * Handle a key-down on SVG drawing surface. Does nothing if the main workspace\n * is not visible.\n *\n * @param e Key down event.\n */\n// TODO (https://github.com/google/blockly/issues/1998) handle cases where there\n// are multiple workspaces and non-main workspaces are able to accept input.\nfunction onKeyDown(e: KeyboardEvent) {\n  const mainWorkspace = common.getMainWorkspace() as WorkspaceSvg;\n  if (!mainWorkspace) {\n    return;\n  }\n\n  if (browserEvents.isTargetInput(e) ||\n      mainWorkspace.rendered && !mainWorkspace.isVisible()) {\n    // When focused on an HTML text input widget, don't trap any keys.\n    // Ignore keypresses on rendered workspaces that have been explicitly\n    // hidden.\n    return;\n  }\n  ShortcutRegistry.registry.onKeyDown(mainWorkspace, e);\n}\n\n/**\n * Whether event handlers have been bound. Document event handlers will only\n * be bound once, even if Blockly is destroyed and reinjected.\n */\nlet documentEventsBound = false;\n\n/**\n * Bind document events, but only once.  Destroying and reinjecting Blockly\n * should not bind again.\n * Bind events for scrolling the workspace.\n * Most of these events should be bound to the SVG's surface.\n * However, 'mouseup' has to be on the whole document so that a block dragged\n * out of bounds and released will know that it has been released.\n * Also, 'keydown' has to be on the whole document since the browser doesn't\n * understand a concept of focus on the SVG image.\n */\nfunction bindDocumentEvents() {\n  if (!documentEventsBound) {\n    browserEvents.conditionalBind(document, 'scroll', null, function() {\n      const workspaces = common.getAllWorkspaces();\n      for (let i = 0, workspace; workspace = workspaces[i]; i++) {\n        if (workspace instanceof WorkspaceSvg) {\n          workspace.updateInverseScreenCTM();\n        }\n      }\n    });\n    browserEvents.conditionalBind(document, 'keydown', null, onKeyDown);\n    // longStop needs to run to stop the context menu from showing up.  It\n    // should run regardless of what other touch event handlers have run.\n    browserEvents.bind(document, 'touchend', null, Touch.longStop);\n    browserEvents.bind(document, 'touchcancel', null, Touch.longStop);\n    // Some iPad versions don't fire resize after portrait to landscape change.\n    if (userAgent.IPAD) {\n      browserEvents.conditionalBind(\n          window, 'orientationchange', document, function() {\n            // TODO (#397): Fix for multiple Blockly workspaces.\n            common.svgResize(common.getMainWorkspace() as WorkspaceSvg);\n          });\n    }\n  }\n  documentEventsBound = true;\n}\n\n/**\n * Load sounds for the given workspace.\n *\n * @param pathToMedia The path to the media directory.\n * @param workspace The workspace to load sounds for.\n */\nfunction loadSounds(pathToMedia: string, workspace: WorkspaceSvg) {\n  const audioMgr = workspace.getAudioManager();\n  audioMgr.load(\n      [\n        pathToMedia + 'click.mp3',\n        pathToMedia + 'click.wav',\n        pathToMedia + 'click.ogg',\n      ],\n      'click');\n  audioMgr.load(\n      [\n        pathToMedia + 'disconnect.wav',\n        pathToMedia + 'disconnect.mp3',\n        pathToMedia + 'disconnect.ogg',\n      ],\n      'disconnect');\n  audioMgr.load(\n      [\n        pathToMedia + 'delete.mp3',\n        pathToMedia + 'delete.ogg',\n        pathToMedia + 'delete.wav',\n      ],\n      'delete');\n\n  // Bind temporary hooks that preload the sounds.\n  const soundBinds: AnyDuringMigration[] = [];\n  /**\n   *\n   */\n  function unbindSounds() {\n    while (soundBinds.length) {\n      browserEvents.unbind(soundBinds.pop());\n    }\n    audioMgr.preload();\n  }\n\n  // These are bound on mouse/touch events with\n  // Blockly.browserEvents.conditionalBind, so they restrict the touch\n  // identifier that will be recognized.  But this is really something that\n  // happens on a click, not a drag, so that's not necessary.\n\n  // Android ignores any sound not loaded as a result of a user action.\n  soundBinds.push(browserEvents.conditionalBind(\n      document, 'pointermove', null, unbindSounds, true));\n  soundBinds.push(browserEvents.conditionalBind(\n      document, 'touchstart', null, unbindSounds, true));\n}\n","/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {IParameterModel} from '../interfaces/i_parameter_model.js';\nimport type {IProcedureModel} from '../interfaces/i_procedure_model.js';\nimport * as registry from '../registry.js';\nimport type {Workspace} from '../workspace.js';\n\nimport {ProcedureParameterBase, ProcedureParameterBaseJson} from './events_procedure_parameter_base.js';\nimport * as eventUtils from './utils.js';\n\n/**\n * Represents a parameter of a procedure being renamed.\n */\nexport class ProcedureParameterRename extends ProcedureParameterBase {\n  /** A string used to check the type of the event. */\n  type = eventUtils.PROCEDURE_PARAMETER_RENAME;\n  private readonly newName: string;\n\n  constructor(\n      workspace: Workspace, procedure: IProcedureModel,\n      parameter: IParameterModel, public readonly oldName: string) {\n    super(workspace, procedure, parameter);\n\n    this.newName = parameter.getName();\n  }\n\n  run(forward: boolean) {\n    const parameterModel = findMatchingParameter(\n        this.getEventWorkspace_(), this.model.getId(), this.parameter.getId());\n    if (!parameterModel) {\n      throw new Error(\n          'Cannot rename a parameter that does not exist ' +\n          'in the procedure map');\n    }\n    if (forward) {\n      parameterModel.setName(this.newName);\n    } else {\n      parameterModel.setName(this.oldName);\n    }\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  toJson(): ProcedureParameterRenameJson {\n    const json = super.toJson() as ProcedureParameterRenameJson;\n    json['oldName'] = this.oldName;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @internal\n   */\n  static fromJson(json: ProcedureParameterRenameJson, workspace: Workspace):\n      ProcedureParameterRename {\n    const model = workspace.getProcedureMap().get(json['procedureId']);\n    if (!model) {\n      throw new Error(\n          'Cannot deserialize procedure delete event because the ' +\n          'target procedure does not exist');\n    }\n    const param = findMatchingParameter(\n        workspace, json['procedureId'], json['parameterId']);\n    if (!param) {\n      throw new Error(\n          'Cannot deserialize parameter rename event because the ' +\n          'target parameter does not exist');\n    }\n    return new ProcedureParameterRename(\n        workspace, model, param, json['oldName']);\n  }\n}\n\nfunction findMatchingParameter(\n    workspace: Workspace, modelId: string, paramId: string): IParameterModel|\n    undefined {\n  const procedureModel = workspace.getProcedureMap().get(modelId);\n  if (!procedureModel) {\n    throw new Error(\n        'Cannot rename the parameter of a procedure that does not exist ' +\n        'in the procedure map');\n  }\n  return procedureModel.getParameters().find((p) => p.getId() === paramId);\n}\n\n\nexport interface ProcedureParameterRenameJson extends\n    ProcedureParameterBaseJson {\n  oldName: string;\n}\n\nregistry.register(\n    registry.Type.EVENT, eventUtils.PROCEDURE_PARAMETER_RENAME,\n    ProcedureParameterRename);\n","/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Registers default context menu items.\n *\n * @namespace Blockly.ContextMenuItems\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.ContextMenuItems');\n\nimport type {BlockSvg} from './block_svg.js';\nimport * as clipboard from './clipboard.js';\nimport {ContextMenuRegistry, RegistryItem, Scope} from './contextmenu_registry.js';\nimport * as dialog from './dialog.js';\nimport * as Events from './events/events.js';\nimport * as eventUtils from './events/utils.js';\nimport {inputTypes} from './input_types.js';\nimport {Msg} from './msg.js';\nimport * as idGenerator from './utils/idgenerator.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/**\n * Option to undo previous action.\n *\n * @alias Blockly.ContextMenuItems.registerUndo\n */\nexport function registerUndo() {\n  const undoOption: RegistryItem = {\n    displayText() {\n      return Msg['UNDO'];\n    },\n    preconditionFn(scope: Scope) {\n      if (scope.workspace!.getUndoStack().length > 0) {\n        return 'enabled';\n      }\n      return 'disabled';\n    },\n    callback(scope: Scope) {\n      scope.workspace!.undo(false);\n    },\n    scopeType: ContextMenuRegistry.ScopeType.WORKSPACE,\n    id: 'undoWorkspace',\n    weight: 1,\n  };\n  ContextMenuRegistry.registry.register(undoOption);\n}\n\n/**\n * Option to redo previous action.\n *\n * @alias Blockly.ContextMenuItems.registerRedo\n */\nexport function registerRedo() {\n  const redoOption: RegistryItem = {\n    displayText() {\n      return Msg['REDO'];\n    },\n    preconditionFn(scope: Scope) {\n      if (scope.workspace!.getRedoStack().length > 0) {\n        return 'enabled';\n      }\n      return 'disabled';\n    },\n    callback(scope: Scope) {\n      scope.workspace!.undo(true);\n    },\n    scopeType: ContextMenuRegistry.ScopeType.WORKSPACE,\n    id: 'redoWorkspace',\n    weight: 2,\n  };\n  ContextMenuRegistry.registry.register(redoOption);\n}\n\n/**\n * Option to clean up blocks.\n *\n * @alias Blockly.ContextMenuItems.registerCleanup\n */\nexport function registerCleanup() {\n  const cleanOption: RegistryItem = {\n    displayText() {\n      return Msg['CLEAN_UP'];\n    },\n    preconditionFn(scope: Scope) {\n      if (scope.workspace!.isMovable()) {\n        if (scope.workspace!.getTopBlocks(false).length > 1) {\n          return 'enabled';\n        }\n        return 'disabled';\n      }\n      return 'hidden';\n    },\n    callback(scope: Scope) {\n      scope.workspace!.cleanUp();\n    },\n    scopeType: ContextMenuRegistry.ScopeType.WORKSPACE,\n    id: 'cleanWorkspace',\n    weight: 3,\n  };\n  ContextMenuRegistry.registry.register(cleanOption);\n}\n/**\n * Creates a callback to collapse or expand top blocks.\n *\n * @param shouldCollapse Whether a block should collapse.\n * @param topBlocks Top blocks in the workspace.\n */\nfunction toggleOption_(shouldCollapse: boolean, topBlocks: BlockSvg[]) {\n  const DELAY = 10;\n  let ms = 0;\n  let timeoutCounter = 0;\n  function timeoutFn(block: BlockSvg) {\n    timeoutCounter--;\n    block.setCollapsed(shouldCollapse);\n    if (timeoutCounter === 0) {\n      Events.setGroup(false);\n    }\n  }\n  Events.setGroup(true);\n  for (let i = 0; i < topBlocks.length; i++) {\n    let block: BlockSvg|null = topBlocks[i];\n    while (block) {\n      timeoutCounter++;\n      setTimeout(timeoutFn.bind(null, block), ms);\n      block = block.getNextBlock();\n      ms += DELAY;\n    }\n  }\n}\n\n/**\n * Option to collapse all blocks.\n *\n * @alias Blockly.ContextMenuItems.registerCollapse\n */\nexport function registerCollapse() {\n  const collapseOption: RegistryItem = {\n    displayText() {\n      return Msg['COLLAPSE_ALL'];\n    },\n    preconditionFn(scope: Scope) {\n      if (scope.workspace!.options.collapse) {\n        const topBlocks = scope.workspace!.getTopBlocks(false);\n        for (let i = 0; i < topBlocks.length; i++) {\n          let block: BlockSvg|null = topBlocks[i];\n          while (block) {\n            if (!block.isCollapsed()) {\n              return 'enabled';\n            }\n            block = block.getNextBlock();\n          }\n        }\n        return 'disabled';\n      }\n      return 'hidden';\n    },\n    callback(scope: Scope) {\n      toggleOption_(true, scope.workspace!.getTopBlocks(true));\n    },\n    scopeType: ContextMenuRegistry.ScopeType.WORKSPACE,\n    id: 'collapseWorkspace',\n    weight: 4,\n  };\n  ContextMenuRegistry.registry.register(collapseOption);\n}\n\n/**\n * Option to expand all blocks.\n *\n * @alias Blockly.ContextMenuItems.registerExpand\n */\nexport function registerExpand() {\n  const expandOption: RegistryItem = {\n    displayText() {\n      return Msg['EXPAND_ALL'];\n    },\n    preconditionFn(scope: Scope) {\n      if (scope.workspace!.options.collapse) {\n        const topBlocks = scope.workspace!.getTopBlocks(false);\n        for (let i = 0; i < topBlocks.length; i++) {\n          let block: BlockSvg|null = topBlocks[i];\n          while (block) {\n            if (block.isCollapsed()) {\n              return 'enabled';\n            }\n            block = block.getNextBlock();\n          }\n        }\n        return 'disabled';\n      }\n      return 'hidden';\n    },\n    callback(scope: Scope) {\n      toggleOption_(false, scope.workspace!.getTopBlocks(true));\n    },\n    scopeType: ContextMenuRegistry.ScopeType.WORKSPACE,\n    id: 'expandWorkspace',\n    weight: 5,\n  };\n  ContextMenuRegistry.registry.register(expandOption);\n}\n/**\n * Adds a block and its children to a list of deletable blocks.\n *\n * @param block to delete.\n * @param deleteList list of blocks that can be deleted.\n *     This will be modified in place with the given block and its descendants.\n */\nfunction addDeletableBlocks_(block: BlockSvg, deleteList: BlockSvg[]) {\n  if (block.isDeletable()) {\n    Array.prototype.push.apply(deleteList, block.getDescendants(false));\n  } else {\n    const children = block.getChildren(false);\n    for (let i = 0; i < children.length; i++) {\n      addDeletableBlocks_(children[i], deleteList);\n    }\n  }\n}\n\n/**\n * Constructs a list of blocks that can be deleted in the given workspace.\n *\n * @param workspace to delete all blocks from.\n * @returns list of blocks to delete.\n */\nfunction getDeletableBlocks_(workspace: WorkspaceSvg): BlockSvg[] {\n  const deleteList: BlockSvg[] = [];\n  const topBlocks = workspace.getTopBlocks(true);\n  for (let i = 0; i < topBlocks.length; i++) {\n    addDeletableBlocks_(topBlocks[i], deleteList);\n  }\n  return deleteList;\n}\n\n/**\n * Deletes the given blocks. Used to delete all blocks in the workspace.\n *\n * @param deleteList list of blocks to delete.\n * @param eventGroup event group ID with which all delete events should be\n *     associated.\n */\nfunction deleteNext_(deleteList: BlockSvg[], eventGroup: string) {\n  const DELAY = 10;\n  eventUtils.setGroup(eventGroup);\n  const block = deleteList.shift();\n  if (block) {\n    if (!block.isDeadOrDying()) {\n      block.dispose(false, true);\n      setTimeout(deleteNext_, DELAY, deleteList, eventGroup);\n    } else {\n      deleteNext_(deleteList, eventGroup);\n    }\n  }\n  eventUtils.setGroup(false);\n}\n\n/**\n * Option to delete all blocks.\n *\n * @alias Blockly.ContextMenuItems.registerDeleteAll\n */\nexport function registerDeleteAll() {\n  const deleteOption: RegistryItem = {\n    displayText(scope: Scope) {\n      if (!scope.workspace) {\n        return '';\n      }\n      const deletableBlocksLength = getDeletableBlocks_(scope.workspace).length;\n      if (deletableBlocksLength === 1) {\n        return Msg['DELETE_BLOCK'];\n      } else {\n        return Msg['DELETE_X_BLOCKS'].replace(\n            '%1', String(deletableBlocksLength));\n      }\n    },\n    preconditionFn(scope: Scope) {\n      if (!scope.workspace) {\n        return 'disabled';\n      }\n      const deletableBlocksLength = getDeletableBlocks_(scope.workspace).length;\n      return deletableBlocksLength > 0 ? 'enabled' : 'disabled';\n    },\n    callback(scope: Scope) {\n      if (!scope.workspace) {\n        return;\n      }\n      scope.workspace.cancelCurrentGesture();\n      const deletableBlocks = getDeletableBlocks_(scope.workspace);\n      const eventGroup = idGenerator.genUid();\n      if (deletableBlocks.length < 2) {\n        deleteNext_(deletableBlocks, eventGroup);\n      } else {\n        dialog.confirm(\n            Msg['DELETE_ALL_BLOCKS'].replace(\n                '%1', String(deletableBlocks.length)),\n            function(ok) {\n              if (ok) {\n                deleteNext_(deletableBlocks, eventGroup);\n              }\n            });\n      }\n    },\n    scopeType: ContextMenuRegistry.ScopeType.WORKSPACE,\n    id: 'workspaceDelete',\n    weight: 6,\n  };\n  ContextMenuRegistry.registry.register(deleteOption);\n}\n/** Registers all workspace-scoped context menu items. */\nfunction registerWorkspaceOptions_() {\n  registerUndo();\n  registerRedo();\n  registerCleanup();\n  registerCollapse();\n  registerExpand();\n  registerDeleteAll();\n}\n\n/**\n * Option to duplicate a block.\n *\n * @alias Blockly.ContextMenuItems.registerDuplicate\n */\nexport function registerDuplicate() {\n  const duplicateOption: RegistryItem = {\n    displayText() {\n      return Msg['DUPLICATE_BLOCK'];\n    },\n    preconditionFn(scope: Scope) {\n      const block = scope.block;\n      if (!block!.isInFlyout && block!.isDeletable() && block!.isMovable()) {\n        if (block!.isDuplicatable()) {\n          return 'enabled';\n        }\n        return 'disabled';\n      }\n      return 'hidden';\n    },\n    callback(scope: Scope) {\n      if (scope.block) {\n        clipboard.duplicate(scope.block);\n      }\n    },\n    scopeType: ContextMenuRegistry.ScopeType.BLOCK,\n    id: 'blockDuplicate',\n    weight: 1,\n  };\n  ContextMenuRegistry.registry.register(duplicateOption);\n}\n\n/**\n * Option to add or remove block-level comment.\n *\n * @alias Blockly.ContextMenuItems.registerComment\n */\nexport function registerComment() {\n  const commentOption: RegistryItem = {\n    displayText(scope: Scope) {\n      if (scope.block!.getCommentIcon()) {\n        // If there's already a comment,  option is to remove.\n        return Msg['REMOVE_COMMENT'];\n      }\n      // If there's no comment yet, option is to add.\n      return Msg['ADD_COMMENT'];\n    },\n    preconditionFn(scope: Scope) {\n      const block = scope.block;\n      if (!block!.isInFlyout && block!.workspace.options.comments &&\n          !block!.isCollapsed() && block!.isEditable()) {\n        return 'enabled';\n      }\n      return 'hidden';\n    },\n    callback(scope: Scope) {\n      const block = scope.block;\n      if (block!.getCommentIcon()) {\n        block!.setCommentText(null);\n      } else {\n        block!.setCommentText('');\n      }\n    },\n    scopeType: ContextMenuRegistry.ScopeType.BLOCK,\n    id: 'blockComment',\n    weight: 2,\n  };\n  ContextMenuRegistry.registry.register(commentOption);\n}\n\n/**\n * Option to inline variables.\n *\n * @alias Blockly.ContextMenuItems.registerInline\n */\nexport function registerInline() {\n  const inlineOption: RegistryItem = {\n    displayText(scope: Scope) {\n      return scope.block!.getInputsInline() ? Msg['EXTERNAL_INPUTS'] :\n                                              Msg['INLINE_INPUTS'];\n    },\n    preconditionFn(scope: Scope) {\n      const block = scope.block;\n      if (!block!.isInFlyout && block!.isMovable() && !block!.isCollapsed()) {\n        for (let i = 1; i < block!.inputList.length; i++) {\n          // Only display this option if there are two value or dummy inputs\n          // next to each other.\n          if (block!.inputList[i - 1].type !== inputTypes.STATEMENT &&\n              block!.inputList[i].type !== inputTypes.STATEMENT) {\n            return 'enabled';\n          }\n        }\n      }\n      return 'hidden';\n    },\n    callback(scope: Scope) {\n      scope.block!.setInputsInline(!scope.block!.getInputsInline());\n    },\n    scopeType: ContextMenuRegistry.ScopeType.BLOCK,\n    id: 'blockInline',\n    weight: 3,\n  };\n  ContextMenuRegistry.registry.register(inlineOption);\n}\n\n/**\n * Option to collapse or expand a block.\n *\n * @alias Blockly.ContextMenuItems.registerCollapseExpandBlock\n */\nexport function registerCollapseExpandBlock() {\n  const collapseExpandOption: RegistryItem = {\n    displayText(scope: Scope) {\n      return scope.block!.isCollapsed() ? Msg['EXPAND_BLOCK'] :\n                                          Msg['COLLAPSE_BLOCK'];\n    },\n    preconditionFn(scope: Scope) {\n      const block = scope.block;\n      if (!block!.isInFlyout && block!.isMovable() &&\n          block!.workspace.options.collapse) {\n        return 'enabled';\n      }\n      return 'hidden';\n    },\n    callback(scope: Scope) {\n      scope.block!.setCollapsed(!scope.block!.isCollapsed());\n    },\n    scopeType: ContextMenuRegistry.ScopeType.BLOCK,\n    id: 'blockCollapseExpand',\n    weight: 4,\n  };\n  ContextMenuRegistry.registry.register(collapseExpandOption);\n}\n\n/**\n * Option to disable or enable a block.\n *\n * @alias Blockly.ContextMenuItems.registerDisable\n */\nexport function registerDisable() {\n  const disableOption: RegistryItem = {\n    displayText(scope: Scope) {\n      return scope.block!.isEnabled() ? Msg['DISABLE_BLOCK'] :\n                                        Msg['ENABLE_BLOCK'];\n    },\n    preconditionFn(scope: Scope) {\n      const block = scope.block;\n      if (!block!.isInFlyout && block!.workspace.options.disable &&\n          block!.isEditable()) {\n        if (block!.getInheritedDisabled()) {\n          return 'disabled';\n        }\n        return 'enabled';\n      }\n      return 'hidden';\n    },\n    callback(scope: Scope) {\n      const block = scope.block;\n      const group = eventUtils.getGroup();\n      if (!group) {\n        eventUtils.setGroup(true);\n      }\n      block!.setEnabled(!block!.isEnabled());\n      if (!group) {\n        eventUtils.setGroup(false);\n      }\n    },\n    scopeType: ContextMenuRegistry.ScopeType.BLOCK,\n    id: 'blockDisable',\n    weight: 5,\n  };\n  ContextMenuRegistry.registry.register(disableOption);\n}\n\n/**\n * Option to delete a block.\n *\n * @alias Blockly.ContextMenuItems.registerDelete\n */\nexport function registerDelete() {\n  const deleteOption: RegistryItem = {\n    displayText(scope: Scope) {\n      const block = scope.block;\n      // Count the number of blocks that are nested in this block.\n      let descendantCount = block!.getDescendants(false).length;\n      const nextBlock = block!.getNextBlock();\n      if (nextBlock) {\n        // Blocks in the current stack would survive this block's deletion.\n        descendantCount -= nextBlock.getDescendants(false).length;\n      }\n      return descendantCount === 1 ?\n          Msg['DELETE_BLOCK'] :\n          Msg['DELETE_X_BLOCKS'].replace('%1', String(descendantCount));\n    },\n    preconditionFn(scope: Scope) {\n      if (!scope.block!.isInFlyout && scope.block!.isDeletable()) {\n        return 'enabled';\n      }\n      return 'hidden';\n    },\n    callback(scope: Scope) {\n      if (scope.block) {\n        scope.block.checkAndDelete();\n      }\n    },\n    scopeType: ContextMenuRegistry.ScopeType.BLOCK,\n    id: 'blockDelete',\n    weight: 6,\n  };\n  ContextMenuRegistry.registry.register(deleteOption);\n}\n\n/**\n * Option to open help for a block.\n *\n * @alias Blockly.ContextMenuItems.registerHelp\n */\nexport function registerHelp() {\n  const helpOption: RegistryItem = {\n    displayText() {\n      return Msg['HELP'];\n    },\n    preconditionFn(scope: Scope) {\n      const block = scope.block;\n      const url = typeof block!.helpUrl === 'function' ? block!.helpUrl() :\n                                                         block!.helpUrl;\n      if (url) {\n        return 'enabled';\n      }\n      return 'hidden';\n    },\n    callback(scope: Scope) {\n      scope.block!.showHelp();\n    },\n    scopeType: ContextMenuRegistry.ScopeType.BLOCK,\n    id: 'blockHelp',\n    weight: 7,\n  };\n  ContextMenuRegistry.registry.register(helpOption);\n}\n\n/** Registers all block-scoped context menu items. */\nfunction registerBlockOptions_() {\n  registerDuplicate();\n  registerComment();\n  registerInline();\n  registerCollapseExpandBlock();\n  registerDisable();\n  registerDelete();\n  registerHelp();\n}\n\n/**\n * Registers all default context menu items. This should be called once per\n * instance of ContextMenuRegistry.\n *\n * @alias Blockly.ContextMenuItems.registerDefaultOptions\n * @internal\n */\nexport function registerDefaultOptions() {\n  registerWorkspaceOptions_();\n  registerBlockOptions_();\n}\n\nregisterDefaultOptions();\n","/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The top level namespace used to access the Blockly library.\n *\n * @namespace Blockly\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly');\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_create.js';\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/workspace_events.js';\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_ui.js';\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_ui_base.js';\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_var_create.js';\n\nimport {Block} from './block.js';\nimport * as blockAnimations from './block_animations.js';\nimport {BlockDragSurfaceSvg} from './block_drag_surface.js';\nimport {BlockDragger} from './block_dragger.js';\nimport {BlockSvg} from './block_svg.js';\nimport {BlocklyOptions} from './blockly_options.js';\nimport {Blocks} from './blocks.js';\nimport * as browserEvents from './browser_events.js';\nimport {Bubble} from './bubble.js';\nimport {BubbleDragger} from './bubble_dragger.js';\nimport * as bumpObjects from './bump_objects.js';\nimport * as clipboard from './clipboard.js';\nimport {Comment} from './comment.js';\nimport * as common from './common.js';\nimport {ComponentManager} from './component_manager.js';\nimport {config} from './config.js';\nimport {Connection} from './connection.js';\nimport {ConnectionChecker} from './connection_checker.js';\nimport {ConnectionDB} from './connection_db.js';\nimport {ConnectionType} from './connection_type.js';\nimport * as ContextMenu from './contextmenu.js';\nimport * as ContextMenuItems from './contextmenu_items.js';\nimport {ContextMenuRegistry} from './contextmenu_registry.js';\nimport * as Css from './css.js';\nimport {DeleteArea} from './delete_area.js';\nimport * as dialog from './dialog.js';\nimport {DragTarget} from './drag_target.js';\nimport * as dropDownDiv from './dropdowndiv.js';\nimport * as Events from './events/events.js';\nimport * as Extensions from './extensions.js';\nimport {Field, FieldValidator} from './field.js';\nimport {FieldAngle, FieldAngleValidator} from './field_angle.js';\nimport {FieldCheckbox, FieldCheckboxValidator} from './field_checkbox.js';\nimport {FieldColour, FieldColourValidator} from './field_colour.js';\nimport {FieldDropdown, FieldDropdownValidator, MenuGenerator, MenuGeneratorFunction, MenuOption} from './field_dropdown.js';\nimport {FieldImage} from './field_image.js';\nimport {FieldLabel} from './field_label.js';\nimport {FieldLabelSerializable} from './field_label_serializable.js';\nimport {FieldMultilineInput, FieldMultilineInputValidator} from './field_multilineinput.js';\nimport {FieldNumber, FieldNumberValidator} from './field_number.js';\nimport * as fieldRegistry from './field_registry.js';\nimport {FieldTextInput, FieldTextInputValidator} from './field_textinput.js';\nimport {FieldVariable, FieldVariableValidator} from './field_variable.js';\nimport {Flyout} from './flyout_base.js';\nimport {FlyoutButton} from './flyout_button.js';\nimport {HorizontalFlyout} from './flyout_horizontal.js';\nimport {FlyoutMetricsManager} from './flyout_metrics_manager.js';\nimport {VerticalFlyout} from './flyout_vertical.js';\nimport {CodeGenerator} from './generator.js';\nimport {Gesture} from './gesture.js';\nimport {Grid} from './grid.js';\nimport {Icon} from './icon.js';\nimport {inject} from './inject.js';\nimport {Align, Input} from './input.js';\nimport {inputTypes} from './input_types.js';\nimport {InsertionMarkerManager} from './insertion_marker_manager.js';\nimport {IASTNodeLocation} from './interfaces/i_ast_node_location.js';\nimport {IASTNodeLocationSvg} from './interfaces/i_ast_node_location_svg.js';\nimport {IASTNodeLocationWithBlock} from './interfaces/i_ast_node_location_with_block.js';\nimport {IAutoHideable} from './interfaces/i_autohideable.js';\nimport {IBlockDragger} from './interfaces/i_block_dragger.js';\nimport {IBoundedElement} from './interfaces/i_bounded_element.js';\nimport {IBubble} from './interfaces/i_bubble.js';\nimport {ICollapsibleToolboxItem} from './interfaces/i_collapsible_toolbox_item.js';\nimport {IComponent} from './interfaces/i_component.js';\nimport {IConnectionChecker} from './interfaces/i_connection_checker.js';\nimport {IContextMenu} from './interfaces/i_contextmenu.js';\nimport {ICopyable} from './interfaces/i_copyable.js';\nimport {IDeletable} from './interfaces/i_deletable.js';\nimport {IDeleteArea} from './interfaces/i_delete_area.js';\nimport {IDragTarget} from './interfaces/i_drag_target.js';\nimport {IDraggable} from './interfaces/i_draggable.js';\nimport {IFlyout} from './interfaces/i_flyout.js';\nimport {IKeyboardAccessible} from './interfaces/i_keyboard_accessible.js';\nimport {IMetricsManager} from './interfaces/i_metrics_manager.js';\nimport {IMovable} from './interfaces/i_movable.js';\nimport {IPositionable} from './interfaces/i_positionable.js';\nimport {IRegistrable} from './interfaces/i_registrable.js';\nimport {ISelectable} from './interfaces/i_selectable.js';\nimport {ISelectableToolboxItem} from './interfaces/i_selectable_toolbox_item.js';\nimport {IStyleable} from './interfaces/i_styleable.js';\nimport {IToolbox} from './interfaces/i_toolbox.js';\nimport {IToolboxItem} from './interfaces/i_toolbox_item.js';\nimport * as internalConstants from './internal_constants.js';\nimport {ASTNode} from './keyboard_nav/ast_node.js';\nimport {BasicCursor} from './keyboard_nav/basic_cursor.js';\nimport {Cursor} from './keyboard_nav/cursor.js';\nimport {Marker} from './keyboard_nav/marker.js';\nimport {TabNavigateCursor} from './keyboard_nav/tab_navigate_cursor.js';\nimport {MarkerManager} from './marker_manager.js';\nimport {Menu} from './menu.js';\nimport {MenuItem} from './menuitem.js';\nimport {MetricsManager} from './metrics_manager.js';\nimport {Msg, setLocale} from './msg.js';\nimport {Mutator} from './mutator.js';\nimport {Names} from './names.js';\nimport {Options} from './options.js';\nimport * as uiPosition from './positionable_helpers.js';\nimport * as Procedures from './procedures.js';\nimport * as registry from './registry.js';\nimport {RenderedConnection} from './rendered_connection.js';\nimport * as blockRendering from './renderers/common/block_rendering.js';\nimport * as constants from './constants.js';\nimport * as geras from './renderers/geras/geras.js';\nimport * as minimalist from './renderers/minimalist/minimalist.js';\nimport * as thrasos from './renderers/thrasos/thrasos.js';\nimport * as zelos from './renderers/zelos/zelos.js';\nimport {Scrollbar} from './scrollbar.js';\nimport {ScrollbarPair} from './scrollbar_pair.js';\nimport * as serialization from './serialization.js';\nimport * as ShortcutItems from './shortcut_items.js';\nimport {ShortcutRegistry} from './shortcut_registry.js';\nimport {Theme} from './theme.js';\nimport * as Themes from './theme/themes.js';\nimport {ThemeManager} from './theme_manager.js';\nimport {ToolboxCategory} from './toolbox/category.js';\nimport {CollapsibleToolboxCategory} from './toolbox/collapsible_category.js';\nimport {ToolboxSeparator} from './toolbox/separator.js';\nimport {Toolbox} from './toolbox/toolbox.js';\nimport {ToolboxItem} from './toolbox/toolbox_item.js';\nimport * as Tooltip from './tooltip.js';\nimport * as Touch from './touch.js';\nimport {Trashcan} from './trashcan.js';\nimport * as utils from './utils.js';\nimport * as colour from './utils/colour.js';\nimport * as deprecation from './utils/deprecation.js';\nimport * as toolbox from './utils/toolbox.js';\nimport {VariableMap} from './variable_map.js';\nimport {VariableModel} from './variable_model.js';\nimport * as Variables from './variables.js';\nimport * as VariablesDynamic from './variables_dynamic.js';\nimport {Warning} from './warning.js';\nimport * as WidgetDiv from './widgetdiv.js';\nimport {Workspace} from './workspace.js';\nimport {WorkspaceAudio} from './workspace_audio.js';\nimport {WorkspaceComment} from './workspace_comment.js';\nimport {WorkspaceCommentSvg} from './workspace_comment_svg.js';\nimport {WorkspaceDragSurfaceSvg} from './workspace_drag_surface_svg.js';\nimport {WorkspaceDragger} from './workspace_dragger.js';\nimport {resizeSvgContents as realResizeSvgContents, WorkspaceSvg} from './workspace_svg.js';\nimport * as Xml from './xml.js';\nimport {ZoomControls} from './zoom_controls.js';\n\n\n/**\n * Blockly core version.\n * This constant is overridden by the build script (npm run build) to the value\n * of the version in package.json. This is done by the Closure Compiler in the\n * buildCompressed gulp task.\n * For local builds, you can pass --define='Blockly.VERSION=X.Y.Z' to the\n * compiler to override this constant.\n *\n * @define {string}\n * @alias Blockly.VERSION\n */\nexport const VERSION = 'uncompiled';\n\n/*\n * Top-level functions and properties on the Blockly namespace.\n * These are used only in external code. Do not reference these\n * from internal code as importing from this file can cause circular\n * dependencies. Do not add new functions here. There is probably a better\n * namespace to put new functions on.\n */\n\n/*\n * Aliases for input alignments used in block defintions.\n */\n\n/**\n * @see Blockly.Input.Align.LEFT\n * @alias Blockly.ALIGN_LEFT\n */\nexport const ALIGN_LEFT = Align.LEFT;\n\n/**\n * @see Blockly.Input.Align.CENTRE\n * @alias Blockly.ALIGN_CENTRE\n */\nexport const ALIGN_CENTRE = Align.CENTRE;\n\n/**\n * @see Blockly.Input.Align.RIGHT\n * @alias Blockly.ALIGN_RIGHT\n */\nexport const ALIGN_RIGHT = Align.RIGHT;\n/*\n * Aliases for constants used for connection and input types.\n */\n\n/**\n * @see ConnectionType.INPUT_VALUE\n * @alias Blockly.INPUT_VALUE\n */\nexport const INPUT_VALUE = ConnectionType.INPUT_VALUE;\n\n/**\n * @see ConnectionType.OUTPUT_VALUE\n * @alias Blockly.OUTPUT_VALUE\n */\nexport const OUTPUT_VALUE = ConnectionType.OUTPUT_VALUE;\n\n/**\n * @see ConnectionType.NEXT_STATEMENT\n * @alias Blockly.NEXT_STATEMENT\n */\nexport const NEXT_STATEMENT = ConnectionType.NEXT_STATEMENT;\n\n/**\n * @see ConnectionType.PREVIOUS_STATEMENT\n * @alias Blockly.PREVIOUS_STATEMENT\n */\nexport const PREVIOUS_STATEMENT = ConnectionType.PREVIOUS_STATEMENT;\n\n/**\n * @see inputTypes.DUMMY_INPUT\n * @alias Blockly.DUMMY_INPUT\n */\nexport const DUMMY_INPUT = inputTypes.DUMMY;\n\n/** Aliases for toolbox positions. */\n\n/**\n * @see toolbox.Position.TOP\n * @alias Blockly.TOOLBOX_AT_TOP\n */\nexport const TOOLBOX_AT_TOP = toolbox.Position.TOP;\n\n/**\n * @see toolbox.Position.BOTTOM\n * @alias Blockly.TOOLBOX_AT_BOTTOM\n */\nexport const TOOLBOX_AT_BOTTOM = toolbox.Position.BOTTOM;\n\n/**\n * @see toolbox.Position.LEFT\n * @alias Blockly.TOOLBOX_AT_LEFT\n */\nexport const TOOLBOX_AT_LEFT = toolbox.Position.LEFT;\n\n/**\n * @see toolbox.Position.RIGHT\n * @alias Blockly.TOOLBOX_AT_RIGHT\n */\nexport const TOOLBOX_AT_RIGHT = toolbox.Position.RIGHT;\n\n/*\n * Other aliased functions.\n */\n\n/**\n * Size the SVG image to completely fill its container. Call this when the view\n * actually changes sizes (e.g. on a window resize/device orientation change).\n * See workspace.resizeContents to resize the workspace when the contents\n * change (e.g. when a block is added or removed).\n * Record the height/width of the SVG image.\n *\n * @param workspace Any workspace in the SVG.\n * @see Blockly.common.svgResize\n * @alias Blockly.svgResize\n */\nexport const svgResize = common.svgResize;\n\n/**\n * Close tooltips, context menus, dropdown selections, etc.\n *\n * @param opt_onlyClosePopups Whether only popups should be closed.\n * @see Blockly.WorkspaceSvg.hideChaff\n * @alias Blockly.hideChaff\n */\nexport function hideChaff(opt_onlyClosePopups?: boolean) {\n  (common.getMainWorkspace() as WorkspaceSvg).hideChaff(opt_onlyClosePopups);\n}\n\n/**\n * Returns the main workspace.  Returns the last used main workspace (based on\n * focus).  Try not to use this function, particularly if there are multiple\n * Blockly instances on a page.\n *\n * @see Blockly.common.getMainWorkspace\n * @alias Blockly.getMainWorkspace\n */\nexport const getMainWorkspace = common.getMainWorkspace;\n\n/**\n * Returns the currently selected copyable object.\n *\n * @alias Blockly.common.getSelected\n */\nexport const getSelected = common.getSelected;\n\n/**\n * Define blocks from an array of JSON block definitions, as might be generated\n * by the Blockly Developer Tools.\n *\n * @param jsonArray An array of JSON block definitions.\n * @see Blockly.common.defineBlocksWithJsonArray\n * @alias Blockly.defineBlocksWithJsonArray\n */\nexport const defineBlocksWithJsonArray = common.defineBlocksWithJsonArray;\n\n/**\n * Set the parent container.  This is the container element that the WidgetDiv,\n * dropDownDiv, and Tooltip are rendered into the first time `Blockly.inject`\n * is called.\n * This method is a NOP if called after the first `Blockly.inject`.\n *\n * @param container The container element.\n * @see Blockly.common.setParentContainer\n * @alias Blockly.setParentContainer\n */\nexport const setParentContainer = common.setParentContainer;\n\n/**\n * Size the workspace when the contents change.  This also updates\n * scrollbars accordingly.\n *\n * @param workspace The workspace to resize.\n * @deprecated Use **workspace.resizeContents** instead.\n * @see Blockly.WorkspaceSvg.resizeContents\n * @alias Blockly.resizeSvgContents\n */\nfunction resizeSvgContentsLocal(workspace: WorkspaceSvg) {\n  deprecation.warn(\n      'Blockly.resizeSvgContents', 'December 2021', 'December 2022',\n      'Blockly.WorkspaceSvg.resizeSvgContents');\n  realResizeSvgContents(workspace);\n}\nexport const resizeSvgContents = resizeSvgContentsLocal;\n\n/**\n * Copy a block or workspace comment onto the local clipboard.\n *\n * @param toCopy Block or Workspace Comment to be copied.\n * @deprecated Use **Blockly.clipboard.copy** instead.\n * @see Blockly.clipboard.copy\n * @alias Blockly.copy\n */\nexport function copy(toCopy: ICopyable) {\n  deprecation.warn(\n      'Blockly.copy', 'December 2021', 'December 2022',\n      'Blockly.clipboard.copy');\n  clipboard.copy(toCopy);\n}\n\n/**\n * Paste a block or workspace comment on to the main workspace.\n *\n * @returns True if the paste was successful, false otherwise.\n * @deprecated Use **Blockly.clipboard.paste** instead.\n * @see Blockly.clipboard.paste\n * @alias Blockly.paste\n */\nexport function paste(): boolean {\n  deprecation.warn(\n      'Blockly.paste', 'December 2021', 'December 2022',\n      'Blockly.clipboard.paste');\n  return !!clipboard.paste();\n}\n\n/**\n * Duplicate this block and its children, or a workspace comment.\n *\n * @param toDuplicate Block or Workspace Comment to be copied.\n * @deprecated Use **Blockly.clipboard.duplicate** instead.\n * @see Blockly.clipboard.duplicate\n * @alias Blockly.duplicate\n */\nexport function duplicate(toDuplicate: ICopyable) {\n  deprecation.warn(\n      'Blockly.duplicate', 'December 2021', 'December 2022',\n      'Blockly.clipboard.duplicate');\n  clipboard.duplicate(toDuplicate);\n}\n\n/**\n * Is the given string a number (includes negative and decimals).\n *\n * @param str Input string.\n * @returns True if number, false otherwise.\n * @deprecated Use **Blockly.utils.string.isNumber** instead.\n * @see Blockly.utils.string.isNumber\n * @alias Blockly.isNumber\n */\nexport function isNumber(str: string): boolean {\n  deprecation.warn(\n      'Blockly.isNumber', 'December 2021', 'December 2022',\n      'Blockly.utils.string.isNumber');\n  return utils.string.isNumber(str);\n}\n\n/**\n * Convert a hue (HSV model) into an RGB hex triplet.\n *\n * @param hue Hue on a colour wheel (0-360).\n * @returns RGB code, e.g. '#5ba65b'.\n * @deprecated Use **Blockly.utils.colour.hueToHex** instead.\n * @see Blockly.utils.colour.hueToHex\n * @alias Blockly.hueToHex\n */\nexport function hueToHex(hue: number): string {\n  deprecation.warn(\n      'Blockly.hueToHex', 'December 2021', 'December 2022',\n      'Blockly.utils.colour.hueToHex');\n  return colour.hueToHex(hue);\n}\n\n/**\n * Bind an event handler that should be called regardless of whether it is part\n * of the active touch stream.\n * Use this for events that are not part of a multi-part gesture (e.g.\n * mouseover for tooltips).\n *\n * @param node Node upon which to listen.\n * @param name Event name to listen to (e.g. 'mousedown').\n * @param thisObject The value of 'this' in the function.\n * @param func Function to call when event is triggered.\n * @returns Opaque data that can be passed to unbindEvent_.\n * @deprecated Use **Blockly.browserEvents.bind** instead.\n * @see Blockly.browserEvents.bind\n * @alias Blockly.bindEvent_\n */\nexport function bindEvent_(\n    node: EventTarget, name: string, thisObject: Object|null,\n    func: Function): browserEvents.Data {\n  deprecation.warn(\n      'Blockly.bindEvent_', 'December 2021', 'December 2022',\n      'Blockly.browserEvents.bind');\n  return browserEvents.bind(node, name, thisObject, func);\n}\n\n/**\n * Unbind one or more events event from a function call.\n *\n * @param bindData Opaque data from bindEvent_.\n *     This list is emptied during the course of calling this function.\n * @returns The function call.\n * @deprecated Use **Blockly.browserEvents.unbind** instead.\n * @see browserEvents.unbind\n * @alias Blockly.unbindEvent_\n */\nexport function unbindEvent_(bindData: browserEvents.Data): Function {\n  deprecation.warn(\n      'Blockly.unbindEvent_', 'December 2021', 'December 2022',\n      'Blockly.browserEvents.unbind');\n  return browserEvents.unbind(bindData);\n}\n\n/**\n * Bind an event handler that can be ignored if it is not part of the active\n * touch stream.\n * Use this for events that either start or continue a multi-part gesture (e.g.\n * mousedown or mousemove, which may be part of a drag or click).\n *\n * @param node Node upon which to listen.\n * @param name Event name to listen to (e.g. 'mousedown').\n * @param thisObject The value of 'this' in the function.\n * @param func Function to call when event is triggered.\n * @param opt_noCaptureIdentifier True if triggering on this event should not\n *     block execution of other event handlers on this touch or other\n *     simultaneous touches.  False by default.\n * @param _opt_noPreventDefault No-op, deprecated and will be removed in v10.\n * @returns Opaque data that can be passed to unbindEvent_.\n * @deprecated Use **Blockly.browserEvents.conditionalBind** instead.\n * @see browserEvents.conditionalBind\n * @alias Blockly.bindEventWithChecks_\n */\nexport function bindEventWithChecks_(\n    node: EventTarget, name: string, thisObject: Object|null, func: Function,\n    opt_noCaptureIdentifier?: boolean,\n    _opt_noPreventDefault?: boolean): browserEvents.Data {\n  deprecation.warn(\n      'Blockly.bindEventWithChecks_', 'December 2021', 'December 2022',\n      'Blockly.browserEvents.conditionalBind');\n  return browserEvents.conditionalBind(\n      node, name, thisObject, func, opt_noCaptureIdentifier);\n}\n\n// Aliases to allow external code to access these values for legacy reasons.\nexport const COLLAPSE_CHARS = internalConstants.COLLAPSE_CHARS;\nexport const DRAG_STACK = internalConstants.DRAG_STACK;\nexport const OPPOSITE_TYPE = internalConstants.OPPOSITE_TYPE;\nexport const RENAME_VARIABLE_ID = internalConstants.RENAME_VARIABLE_ID;\nexport const DELETE_VARIABLE_ID = internalConstants.DELETE_VARIABLE_ID;\nexport const COLLAPSED_INPUT_NAME = constants.COLLAPSED_INPUT_NAME;\nexport const COLLAPSED_FIELD_NAME = constants.COLLAPSED_FIELD_NAME;\n\n/**\n * String for use in the \"custom\" attribute of a category in toolbox XML.\n * This string indicates that the category should be dynamically populated with\n * variable blocks.\n *\n * @alias Blockly.VARIABLE_CATEGORY_NAME\n */\nexport const VARIABLE_CATEGORY_NAME: string = Variables.CATEGORY_NAME;\n\n/**\n * String for use in the \"custom\" attribute of a category in toolbox XML.\n * This string indicates that the category should be dynamically populated with\n * variable blocks.\n *\n * @alias Blockly.VARIABLE_DYNAMIC_CATEGORY_NAME\n */\nexport const VARIABLE_DYNAMIC_CATEGORY_NAME: string =\n    VariablesDynamic.CATEGORY_NAME;\n/**\n * String for use in the \"custom\" attribute of a category in toolbox XML.\n * This string indicates that the category should be dynamically populated with\n * procedure blocks.\n *\n * @alias Blockly.PROCEDURE_CATEGORY_NAME\n */\nexport const PROCEDURE_CATEGORY_NAME: string = Procedures.CATEGORY_NAME;\n\n\n// Context for why we need to monkey-patch in these functions (internal):\n//   https://docs.google.com/document/d/1MbO0LEA-pAyx1ErGLJnyUqTLrcYTo-5zga9qplnxeXo/edit?usp=sharing&resourcekey=0-5h_32-i-dHwHjf_9KYEVKg\n\n// clang-format off\nWorkspace.prototype.newBlock =\n    function(prototypeName: string, opt_id?: string): Block {\n      return new Block(this, prototypeName, opt_id);\n    };\n\nWorkspaceSvg.prototype.newBlock =\n    function(prototypeName: string, opt_id?: string): BlockSvg {\n      return new BlockSvg(this, prototypeName, opt_id);\n    };\n\nWorkspaceSvg.newTrashcan = function(workspace: WorkspaceSvg): Trashcan {\n  return new Trashcan(workspace);\n};\n\nWorkspaceCommentSvg.prototype.showContextMenu =\n    function(this: WorkspaceCommentSvg, e: Event) {\n      if (this.workspace.options.readOnly) {\n        return;\n      }\n      const menuOptions = [];\n\n      if (this.isDeletable() && this.isMovable()) {\n        menuOptions.push(ContextMenu.commentDuplicateOption(this));\n        menuOptions.push(ContextMenu.commentDeleteOption(this));\n      }\n\n      ContextMenu.show(e, menuOptions, this.RTL);\n    };\n\nMutator.prototype.newWorkspaceSvg =\n    function(options: Options): WorkspaceSvg {\n      return new WorkspaceSvg(options);\n    };\n\nNames.prototype.populateProcedures =\n    function(this: Names, workspace: Workspace) {\n      const procedures = Procedures.allProcedures(workspace);\n      // Flatten the return vs no-return procedure lists.\n      const flattenedProcedures: AnyDuringMigration[][] =\n          procedures[0].concat(procedures[1]);\n      for (let i = 0; i < flattenedProcedures.length; i++) {\n        this.getName(flattenedProcedures[i][0], Names.NameType.PROCEDURE);\n      }\n    };\n// clang-format on\n\n\n// Re-export submodules that no longer declareLegacyNamespace.\nexport {browserEvents};\nexport {ContextMenu};\nexport {ContextMenuItems};\nexport {Css};\nexport {Events};\nexport {Extensions};\nexport {Procedures};\nexport {Procedures as procedures};\nexport {ShortcutItems};\nexport {Themes};\nexport {Tooltip};\nexport {Touch};\nexport {Variables};\nexport {VariablesDynamic};\nexport {WidgetDiv};\nexport {Xml};\nexport {blockAnimations};\nexport {blockRendering};\nexport {bumpObjects};\nexport {clipboard};\nexport {common};\nexport {constants};\nexport {dialog};\nexport {fieldRegistry};\nexport {geras};\nexport {minimalist};\nexport {registry};\nexport {thrasos};\nexport {uiPosition};\nexport {utils};\nexport {zelos};\nexport {ASTNode};\nexport {BasicCursor};\nexport {Block};\nexport {BlocklyOptions};\nexport {BlockDragger};\nexport {BlockDragSurfaceSvg};\nexport {BlockSvg};\nexport {Blocks};\nexport {Bubble};\nexport {BubbleDragger};\nexport {CollapsibleToolboxCategory};\nexport {Comment};\nexport {ComponentManager};\nexport {Connection};\nexport {ConnectionType};\nexport {ConnectionChecker};\nexport {ConnectionDB};\nexport {ContextMenuRegistry};\nexport {Cursor};\nexport {DeleteArea};\nexport {DragTarget};\nexport const DropDownDiv = dropDownDiv;\nexport {Field, FieldValidator};\nexport {FieldAngle, FieldAngleValidator};\nexport {FieldCheckbox, FieldCheckboxValidator};\nexport {FieldColour, FieldColourValidator};\nexport {\n  FieldDropdown,\n  FieldDropdownValidator,\n  MenuGenerator,\n  MenuGeneratorFunction,\n  MenuOption,\n};\nexport {FieldImage};\nexport {FieldLabel};\nexport {FieldLabelSerializable};\nexport {FieldMultilineInput, FieldMultilineInputValidator};\nexport {FieldNumber, FieldNumberValidator};\nexport {FieldTextInput, FieldTextInputValidator};\nexport {FieldVariable, FieldVariableValidator};\nexport {Flyout};\nexport {FlyoutButton};\nexport {FlyoutMetricsManager};\nexport {CodeGenerator};\nexport {CodeGenerator as Generator};  // Deprecated name, October 2022.\nexport {Gesture};\nexport {Gesture as TouchGesture};  // Remove in v10.\nexport {Grid};\nexport {HorizontalFlyout};\nexport {IASTNodeLocation};\nexport {IASTNodeLocationSvg};\nexport {IASTNodeLocationWithBlock};\nexport {IAutoHideable};\nexport {IBlockDragger};\nexport {IBoundedElement};\nexport {IBubble};\nexport {ICollapsibleToolboxItem};\nexport {IComponent};\nexport {IConnectionChecker};\nexport {IContextMenu};\nexport {Icon};\nexport {ICopyable};\nexport {IDeletable};\nexport {IDeleteArea};\nexport {IDragTarget};\nexport {IDraggable};\nexport {IFlyout};\nexport {IKeyboardAccessible};\nexport {IMetricsManager};\nexport {IMovable};\nexport {Input};\nexport {InsertionMarkerManager};\nexport {IPositionable};\nexport {IRegistrable};\nexport {ISelectable};\nexport {ISelectableToolboxItem};\nexport {IStyleable};\nexport {IToolbox};\nexport {IToolboxItem};\nexport {Marker};\nexport {MarkerManager};\nexport {Menu};\nexport {MenuItem};\nexport {MetricsManager};\nexport {Mutator};\nexport {Msg, setLocale};\nexport {Names};\nexport {Options};\nexport {RenderedConnection};\nexport {Scrollbar};\nexport {ScrollbarPair};\nexport {ShortcutRegistry};\nexport {TabNavigateCursor};\nexport {Theme};\nexport {ThemeManager};\nexport {Toolbox};\nexport {ToolboxCategory};\nexport {ToolboxItem};\nexport {ToolboxSeparator};\nexport {Trashcan};\nexport {VariableMap};\nexport {VariableModel};\nexport {VerticalFlyout};\nexport {Warning};\nexport {Workspace};\nexport {WorkspaceAudio};\nexport {WorkspaceComment};\nexport {WorkspaceCommentSvg};\nexport {WorkspaceDragSurfaceSvg};\nexport {WorkspaceDragger};\nexport {WorkspaceSvg};\nexport {ZoomControls};\nexport {config};\n/** @deprecated Use Blockly.ConnectionType instead. */\nexport const connectionTypes = ConnectionType;\nexport {inject};\nexport {inputTypes};\nexport {serialization};\n",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"// Copyright 2018 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview ES6 module that exports symbols from base.js so that ES6\n * modules do not need to use globals and so that is clear if a project is using\n * Closure's base.js file. It is also a subset of properties in base.js, meaning\n * it should be clearer what should not be used in ES6 modules\n * (goog.module/provide are not exported here, for example). Though that is not\n * to say that everything in this file should be used in an ES6 module; some\n * depreciated functions are exported to make migration easier (e.g.\n * goog.scope).\n *\n * Note that this does not load Closure's base.js file, it is still up to the\n * programmer to include it. Nor does the fact that this is an ES6 module mean\n * that projects no longer require deps.js files for debug loading - they do.\n * Closure will need to load your ES6 modules for you if you have any Closure\n * file (goog.provide/goog.module) dependencies, as they need to be available\n * before the ES6 module evaluates.\n *\n * Also note that this file has special compiler handling! It is okay to export\n * anything from this file, but the name also needs to exist on the global goog.\n * This special compiler pass enforces that you always import this file as\n * `import * as goog`, as many tools use regex based parsing to find\n * goog.require calls.\n */\n\nexport const global = globalThis;\n// export const require = goog.require;\n// export const define = goog.define;\n// export const DEBUG = goog.DEBUG;\n// export const LOCALE = goog.LOCALE;\n// export const TRUSTED_SITE = goog.TRUSTED_SITE;\n// export const DISALLOW_TEST_ONLY_CODE = goog.DISALLOW_TEST_ONLY_CODE;\n// export const getGoogModule = goog.module.get;\n// export const setTestOnly = goog.setTestOnly;\n// export const forwardDeclare = goog.forwardDeclare;\n// export const getObjectByName = goog.getObjectByName;\n// export const basePath = goog.basePath;\n// export const addSingletonGetter = goog.addSingletonGetter;\n// export const typeOf = goog.typeOf;\n// export const isArrayLike = goog.isArrayLike;\n// export const isDateLike = goog.isDateLike;\n// export const isObject = goog.isObject;\n// export const getUid = goog.getUid;\n// export const hasUid = goog.hasUid;\n// export const removeUid = goog.removeUid;\n// export const now = Date.now;\n// export const globalEval = goog.globalEval;\n// export const getCssName = goog.getCssName;\n// export const setCssNameMapping = goog.setCssNameMapping;\n// export const getMsg = goog.getMsg;\n// export const getMsgWithFallback = goog.getMsgWithFallback;\n// export const exportSymbol = goog.exportSymbol;\n// export const exportProperty = goog.exportProperty;\n// export const abstractMethod = goog.abstractMethod;\n// export const cloneObject = goog.cloneObject;\n// export const bind = goog.bind;\n// export const partial = goog.partial;\n// export const inherits = goog.inherits;\n// export const scope = goog.scope;\n// export const defineClass = goog.defineClass;\nexport const declareModuleId = function(namespace) {\n  if (window.goog && window.goog.declareModuleId) {\n    window.goog.declareModuleId.call(this, namespace);\n  }\n};\n\n\n// Export select properties of module. Do not export the function itself or\n// goog.module.declareLegacyNamespace.\n// export const module = {\n//   get: goog.module.get,\n// };\n\n// Omissions include:\n// goog.ENABLE_DEBUG_LOADER - define only used in base.\n// goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING - define only used in base.\n// goog.provide - ES6 modules do not provide anything.\n// goog.module - ES6 modules cannot be goog.modules.\n// goog.module.declareLegacyNamespace - ES6 modules cannot declare namespaces.\n// goog.addDependency - meant to only be used by dependency files.\n// goog.DEPENDENCIES_ENABLED - constant only used in base.\n// goog.TRANSPILE - define only used in base.\n// goog.TRANSPILER - define only used in base.\n// goog.loadModule - should not be called by any ES6 module; exists for\n//   generated bundles.\n// goog.LOAD_MODULE_USING_EVAL - define only used in base.\n// goog.SEAL_MODULE_EXPORTS - define only used in base.\n// goog.DebugLoader - used rarely, only outside of compiled code.\n// goog.Transpiler - used rarely, only outside of compiled code.\n","/**\n * @license\n * Copyright The Closure Library Authors.\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview A minimal implementation of base.js.\n *\n * This file is used in place of base.js (Closure library bootstrap\n * code) when building Blockly using the Closure Compiler.  Refer to\n * base.js for more information about items defined here.\n *\n * @provideGoog\n */\n\n/** @define {boolean} Overridden to true by the compiler. */\nvar COMPILED = false;\n\n/** @const */\nvar goog = goog || {};\n\n/**\n * Reference to the global object.  This is provided as 'root' by the\n * UMD wrapper, but prefer globalThis if it is defined.\n *\n * https://www.ecma-international.org/ecma-262/9.0/index.html#sec-global-object\n *\n * @const\n * @type {!Global}\n * @suppress {undefinedVars}\n */\ngoog.global = globalThis || root;\n\n/** @type {Object<string, (string|number|boolean)>|undefined} */\ngoog.global.CLOSURE_DEFINES;\n\n/**\n * Defines a named value.\n * When compiled the default can be overridden using the compiler options or the\n * value set in the CLOSURE_DEFINES object. Returns the defined value so that it\n * can be used safely in modules. Note that the value type MUST be either\n * boolean, number, or string.\n *\n * @param {string} name\n * @param {T} defaultValue\n * @return {T}\n * @template T\n */\ngoog.define = function(name, defaultValue) {\n  return defaultValue;\n};\n\n/** @define {boolean} */\ngoog.DEBUG = goog.define('goog.DEBUG', false);\n\n/** @define {boolean} */\ngoog.DISALLOW_TEST_ONLY_CODE =\n    goog.define('goog.DISALLOW_TEST_ONLY_CODE', COMPILED && !goog.DEBUG);\n\n/**\n * @param {string} name\n */\ngoog.provide = function(name) {};\n\n/**\n * @param {string} name\n * @return {void}\n */\ngoog.module = function(name) {};\n\n/**\n * @param {string} name\n * @return {?}\n * @suppress {missingProvide}\n */\ngoog.module.get = function(name) {};\n\n/** @suppress {missingProvide} */\ngoog.module.declareLegacyNamespace = function() {};\n\n/**\n * Marks that the current file should only be used for testing, and never for\n * live code in production.\n *\n * In the case of unit tests, the message may optionally be an exact namespace\n * for the test (e.g. 'goog.stringTest'). The linter will then ignore the extra\n * provide (if not explicitly defined in the code).\n *\n * @param {string=} opt_message Optional message to add to the error that's\n *     raised when used in production code.\n */\ngoog.setTestOnly = function(opt_message) {\n  if (goog.DISALLOW_TEST_ONLY_CODE) {\n    opt_message = opt_message || '';\n    throw new Error(\n        'Importing test-only code into non-debug environment' +\n        (opt_message ? ': ' + opt_message : '.'));\n  }\n};\n\n/**\n * @param {string} namespace\n * @return {?}\n */\ngoog.require = function(namespace) {};\n\n/**\n * @param {string} namespace\n * @return {?}\n */\ngoog.requireType = function(namespace) {};\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Useragent detection.\n * These methods are not specific to Blockly, and could be factored out into\n * a JavaScript framework such as Closure.\n *\n * @namespace Blockly.utils.userAgent\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.utils.userAgent');\n\n\n/** The raw useragent string. */\nlet rawUserAgent: string;\n\nlet isJavaFx: boolean;\n\nlet isWebKit: boolean;\n\nlet isGecko: boolean;\n\nlet isAndroid: boolean;\n\nlet isIPad: boolean;\n\nlet isIPhone: boolean;\n\nlet isMac: boolean;\n\nlet isTablet: boolean;\n\nlet isMobile: boolean;\n\n(function(raw) {\nrawUserAgent = raw;\nconst rawUpper = rawUserAgent.toUpperCase();\n/**\n * Case-insensitive test of whether name is in the useragent string.\n *\n * @param name Name to test.\n * @returns True if name is present.\n */\nfunction has(name: string): boolean {\n  return rawUpper.indexOf(name.toUpperCase()) !== -1;\n}\n\n// Browsers.  Logic from:\n// https://github.com/google/closure-library/blob/master/closure/goog/labs/useragent/browser.js\n// Useragent for JavaFX:\n// Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.44\n//     (KHTML, like Gecko) JavaFX/8.0 Safari/537.44\nisJavaFx = has('JavaFX');\n\n// Engines.  Logic from:\n// https://github.com/google/closure-library/blob/master/closure/goog/labs/useragent/engine.js\nisWebKit = has('WebKit');\nisGecko = has('Gecko') && !isWebKit;\n\n// Platforms.  Logic from:\n// https://github.com/google/closure-library/blob/master/closure/goog/labs/useragent/platform.js\n// and\n// https://github.com/google/closure-library/blob/master/closure/goog/labs/useragent/extra.js\nisAndroid = has('Android');\nconst maxTouchPoints =\n    globalThis['navigator'] && globalThis['navigator']['maxTouchPoints'];\nisIPad = has('iPad') || has('Macintosh') && maxTouchPoints > 0;\nisIPhone = has('iPhone') && !isIPad;\nisMac = has('Macintosh');\n\n// Devices.  Logic from:\n// https://github.com/google/closure-library/blob/master/closure/goog/labs/useragent/device.js\nisTablet = isIPad || isAndroid && !has('Mobile') || has('Silk');\nisMobile = !isTablet && (isIPhone || isAndroid);\n})(globalThis['navigator'] && globalThis['navigator']['userAgent'] || '');\n\n/** @alias Blockly.utils.userAgent.raw */\nexport const raw: string = rawUserAgent;\n\n/** @alias Blockly.utils.userAgent.JavaFx */\nexport const JavaFx: boolean = isJavaFx;\n\n/** @alias Blockly.utils.userAgent.GECKO */\nexport const GECKO: boolean = isGecko;\n\n/** @alias Blockly.utils.userAgent.ANDROID */\nexport const ANDROID: boolean = isAndroid;\n\n/** @alias Blockly.utils.userAgent.IPAD */\nexport const IPAD: boolean = isIPad;\n\n/** @alias Blockly.utils.userAgent.IPHONE */\nexport const IPHONE: boolean = isIPhone;\n\n/** @alias Blockly.utils.userAgent.MAC */\nexport const MAC: boolean = isMac;\n\n/** @alias Blockly.utils.userAgent.MOBILE */\nexport const MOBILE: boolean = isMobile;\n","/**\n * @license\n * Copyright 2013 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * A mapping of block type names to block prototype objects.\n *\n * @namespace Blockly.blocks\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blocks');\n\n\n/**\n * A block definition.  For now this very loose, but it can potentially\n * be refined e.g. by replacing this typedef with a class definition.\n */\nexport type BlockDefinition = AnyDuringMigration;\n\n/**\n * A mapping of block type names to block prototype objects.\n *\n * @alias Blockly.blocks.Blocks\n */\nexport const Blocks: {[key: string]: BlockDefinition} = Object.create(null);\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Utility methods for rectangle manipulation.\n * These methods are not specific to Blockly, and could be factored out into\n * a JavaScript framework such as Closure.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.utils.Rect');\n\n\n/**\n * Class for representing rectangular regions.\n *\n * @alias Blockly.utils.Rect\n */\nexport class Rect {\n  /**\n   * @param top Top.\n   * @param bottom Bottom.\n   * @param left Left.\n   * @param right Right.\n   */\n  constructor(\n      public top: number, public bottom: number, public left: number,\n      public right: number) {}\n\n  /**\n   * Tests whether this rectangle contains a x/y coordinate.\n   *\n   * @param x The x coordinate to test for containment.\n   * @param y The y coordinate to test for containment.\n   * @returns Whether this rectangle contains given coordinate.\n   */\n  contains(x: number, y: number): boolean {\n    return x >= this.left && x <= this.right && y >= this.top &&\n        y <= this.bottom;\n  }\n\n  /**\n   * Tests whether this rectangle intersects the provided rectangle.\n   * Assumes that the coordinate system increases going down and left.\n   *\n   * @param other The other rectangle to check for intersection with.\n   * @returns Whether this rectangle intersects the provided rectangle.\n   */\n  intersects(other: Rect): boolean {\n    return !(\n        this.left > other.right || this.right < other.left ||\n        this.top > other.bottom || this.bottom < other.top);\n  }\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Utility methods for coordinate manipulation.\n * These methods are not specific to Blockly, and could be factored out into\n * a JavaScript framework such as Closure.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.utils.Coordinate');\n\n\n/**\n * Class for representing coordinates and positions.\n *\n * @alias Blockly.utils.Coordinate\n */\nexport class Coordinate {\n  /**\n   * @param x Left.\n   * @param y Top.\n   */\n  constructor(public x: number, public y: number) {}\n\n  /**\n   * Creates a new copy of this coordinate.\n   *\n   * @returns A copy of this coordinate.\n   */\n  clone(): Coordinate {\n    return new Coordinate(this.x, this.y);\n  }\n\n  /**\n   * Scales this coordinate by the given scale factor.\n   *\n   * @param s The scale factor to use for both x and y dimensions.\n   * @returns This coordinate after scaling.\n   */\n  scale(s: number): Coordinate {\n    this.x *= s;\n    this.y *= s;\n    return this;\n  }\n\n  /**\n   * Translates this coordinate by the given offsets.\n   * respectively.\n   *\n   * @param tx The value to translate x by.\n   * @param ty The value to translate y by.\n   * @returns This coordinate after translating.\n   */\n  translate(tx: number, ty: number): Coordinate {\n    this.x += tx;\n    this.y += ty;\n    return this;\n  }\n\n  /**\n   * Compares coordinates for equality.\n   *\n   * @param a A Coordinate.\n   * @param b A Coordinate.\n   * @returns True iff the coordinates are equal, or if both are null.\n   */\n  static equals(a?: Coordinate|null, b?: Coordinate|null): boolean {\n    if (a === b) {\n      return true;\n    }\n    if (!a || !b) {\n      return false;\n    }\n    return a.x === b.x && a.y === b.y;\n  }\n\n  /**\n   * Returns the distance between two coordinates.\n   *\n   * @param a A Coordinate.\n   * @param b A Coordinate.\n   * @returns The distance between `a` and `b`.\n   */\n  static distance(a: Coordinate, b: Coordinate): number {\n    const dx = a.x - b.x;\n    const dy = a.y - b.y;\n    return Math.sqrt(dx * dx + dy * dy);\n  }\n\n  /**\n   * Returns the magnitude of a coordinate.\n   *\n   * @param a A Coordinate.\n   * @returns The distance between the origin and `a`.\n   */\n  static magnitude(a: Coordinate): number {\n    return Math.sqrt(a.x * a.x + a.y * a.y);\n  }\n\n  /**\n   * Returns the difference between two coordinates as a new\n   * Coordinate.\n   *\n   * @param a An x/y coordinate.\n   * @param b An x/y coordinate.\n   * @returns A Coordinate representing the difference between `a` and `b`.\n   */\n  static difference(a: Coordinate|SVGPoint, b: Coordinate|SVGPoint):\n      Coordinate {\n    return new Coordinate(a.x - b.x, a.y - b.y);\n  }\n\n  /**\n   * Returns the sum of two coordinates as a new Coordinate.\n   *\n   * @param a An x/y coordinate.\n   * @param b An x/y coordinate.\n   * @returns A Coordinate representing the sum of the two coordinates.\n   */\n  static sum(a: Coordinate|SVGPoint, b: Coordinate|SVGPoint): Coordinate {\n    return new Coordinate(a.x + b.x, a.y + b.y);\n  }\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Utility methods for size calculation.\n * These methods are not specific to Blockly, and could be factored out into\n * a JavaScript framework such as Closure.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.utils.Size');\n\n\n/**\n * Class for representing sizes consisting of a width and height.\n *\n * @alias Blockly.utils.Size\n */\nexport class Size {\n  /**\n   * @param width Width.\n   * @param height Height.\n   */\n  constructor(public width: number, public height: number) {}\n\n  /**\n   * Compares sizes for equality.\n   *\n   * @param a A Size.\n   * @param b A Size.\n   * @returns True iff the sizes have equal widths and equal heights, or if both\n   *     are null.\n   */\n  static equals(a: Size|null, b: Size|null): boolean {\n    if (a === b) {\n      return true;\n    }\n    if (!a || !b) {\n      return false;\n    }\n    return a.width === b.width && a.height === b.height;\n  }\n}\n","/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * An enum for the possible types of inputs.\n *\n * @namespace Blockly.inputTypes\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.inputTypes');\n\nimport {ConnectionType} from './connection_type.js';\n\n\n/**\n * Enum for the type of a connection or input.\n *\n * @alias Blockly.inputTypes\n */\nexport enum inputTypes {\n  // A right-facing value input.  E.g. 'set item to' or 'return'.\n  VALUE = ConnectionType.INPUT_VALUE,\n  // A down-facing block stack.  E.g. 'if-do' or 'else'.\n  STATEMENT = ConnectionType.NEXT_STATEMENT,\n  // A dummy input.  Used to add field(s) with no input.\n  DUMMY = 5\n}\n","/**\n * @license\n * Copyright 2013 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Empty name space for the Message singleton.\n *\n * @namespace Blockly.Msg\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Msg');\n\n\n/** A dictionary of localised messages. */\nexport const Msg: {[key: string]: string} = Object.create(null);\n\n/**\n * Sets the locale (i.e. the localized messages/block-text/etc) to the given\n * locale.\n *\n * This is not useful/necessary when loading from a script tag, because the\n * messages are automatically cluged into the Blockly.Msg object. But we provide\n * it in both the script-tag and non-script-tag contexts so that the tscompiler\n * can properly create our type definition files.\n *\n * @param locale An object defining the messages for a given language.\n */\nexport const setLocale = function(locale: {[key: string]: string}) {\n  Object.keys(locale).forEach(function(k) {\n    Msg[k] = locale[k];\n  });\n};\n","/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Abstract class for events fired as a result of actions in\n * Blockly's editor.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events.Abstract');\n\nimport * as deprecation from '../utils/deprecation.js';\nimport * as common from '../common.js';\nimport type {Workspace} from '../workspace.js';\n\nimport * as eventUtils from './utils.js';\n\n\n/**\n * Abstract class for an event.\n *\n * @alias Blockly.Events.Abstract\n */\nexport abstract class Abstract {\n  /**\n   * Whether or not the event was constructed without necessary parameters\n   * (to be populated by fromJson).\n   */\n  abstract isBlank: boolean;\n\n  /** The workspace identifier for this event. */\n  workspaceId?: string = undefined;\n  group: string;\n  recordUndo: boolean;\n\n  /** Whether or not the event is a UI event. */\n  isUiEvent = false;\n\n  /** Type of this event. */\n  type = '';\n\n  /** @alias Blockly.Events.Abstract */\n  constructor() {\n    /**\n     * The event group ID for the group this event belongs to. Groups define\n     * events that should be treated as an single action from the user's\n     * perspective, and should be undone together.\n     */\n    this.group = eventUtils.getGroup();\n\n    /** Sets whether the event should be added to the undo stack. */\n    this.recordUndo = eventUtils.getRecordUndo();\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  toJson(): AbstractEventJson {\n    return {\n      'type': this.type,\n      'group': this.group,\n    };\n  }\n\n  /**\n   * Decode the JSON event.\n   *\n   * @param json JSON representation.\n   */\n  fromJson(json: AbstractEventJson) {\n    this.isBlank = false;\n    this.group = json['group'] || '';\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of Abstract (like all events), but we can't specify that due to the\n   *     fact that parameters to static methods in subclasses must be\n   *     supertypes of parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(json: AbstractEventJson, workspace: Workspace, event: any):\n      Abstract {\n    deprecation.warn(\n        'Blockly.Events.Abstract.prototype.fromJson', 'version 9', 'version 10',\n        'Blockly.Events.fromJson');\n    event.isBlank = false;\n    event.group = json['group'] || '';\n    event.workspaceId = workspace.id;\n    return event;\n  }\n\n  /**\n   * Does this event record any change of state?\n   *\n   * @returns True if null, false if something changed.\n   */\n  isNull(): boolean {\n    return false;\n  }\n\n  /**\n   * Run an event.\n   *\n   * @param _forward True if run forward, false if run backward (undo).\n   */\n  run(_forward: boolean) {\n    // Defined by subclasses. Cannot be abstract b/c UI events do /not/ define\n    // this.\n  }\n\n  /**\n   * Get workspace the event belongs to.\n   *\n   * @returns The workspace the event belongs to.\n   * @throws {Error} if workspace is null.\n   * @internal\n   */\n  getEventWorkspace_(): Workspace {\n    let workspace;\n    if (this.workspaceId) {\n      workspace = common.getWorkspaceById(this.workspaceId);\n    }\n    if (!workspace) {\n      throw Error(\n          'Workspace is null. Event must have been generated from real' +\n          ' Blockly events.');\n    }\n    return workspace;\n  }\n}\n\nexport interface AbstractEventJson {\n  type: string;\n  group: string;\n}\n","/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Abstract class for a variable event.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events.VarBase');\n\nimport * as deprecation from '../utils/deprecation.js';\nimport type {VariableModel} from '../variable_model.js';\n\nimport {Abstract as AbstractEvent, AbstractEventJson} from './events_abstract.js';\nimport type {Workspace} from '../workspace.js';\n\n\n/**\n * Abstract class for a variable event.\n *\n * @alias Blockly.Events.VarBase\n */\nexport class VarBase extends AbstractEvent {\n  override isBlank = true;\n  varId?: string;\n\n  /**\n   * @param opt_variable The variable this event corresponds to.  Undefined for\n   *     a blank event.\n   */\n  constructor(opt_variable?: VariableModel) {\n    super();\n    this.isBlank = typeof opt_variable === 'undefined';\n    if (!opt_variable) return;\n\n    /** The variable id for the variable this event pertains to. */\n    this.varId = opt_variable.getId();\n\n    /** The workspace identifier for this event. */\n    this.workspaceId = opt_variable.workspace.id;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): VarBaseJson {\n    const json = super.toJson() as VarBaseJson;\n    if (!this.varId) {\n      throw new Error(\n          'The var ID is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson');\n    }\n    json['varId'] = this.varId;\n    return json;\n  }\n\n  /**\n   * Decode the JSON event.\n   *\n   * @param json JSON representation.\n   */\n  override fromJson(json: VarBaseJson) {\n    deprecation.warn(\n        'Blockly.Events.VarBase.prototype.fromJson', 'version 9', 'version 10',\n        'Blockly.Events.fromJson');\n    super.fromJson(json);\n    this.varId = json['varId'];\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of VarBase, but we can't specify that due to the fact that parameters\n   *     to static methods in subclasses must be supertypes of parameters to\n   *     static methods in superclasses.\n   * @internal\n   */\n  static fromJson(json: VarBaseJson, workspace: Workspace, event?: any):\n      VarBase {\n    const newEvent =\n        super.fromJson(json, workspace, event ?? new VarBase()) as VarBase;\n    newEvent.varId = json['varId'];\n    return newEvent;\n  }\n}\n\nexport interface VarBaseJson extends AbstractEventJson {\n  varId: string;\n}\n","/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for a variable creation event.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events.VarCreate');\n\nimport * as deprecation from '../utils/deprecation.js';\nimport * as registry from '../registry.js';\nimport type {VariableModel} from '../variable_model.js';\n\nimport {VarBase, VarBaseJson} from './events_var_base.js';\nimport * as eventUtils from './utils.js';\nimport type {Workspace} from '../workspace.js';\n\n\n/**\n * Class for a variable creation event.\n *\n * @alias Blockly.Events.VarCreate\n */\nexport class VarCreate extends VarBase {\n  override type = eventUtils.VAR_CREATE;\n  varType?: string;\n  varName?: string;\n\n  /**\n   * @param opt_variable The created variable. Undefined for a blank event.\n   */\n  constructor(opt_variable?: VariableModel) {\n    super(opt_variable);\n\n    if (!opt_variable) {\n      return;  // Blank event to be populated by fromJson.\n    }\n    this.varType = opt_variable.type;\n    this.varName = opt_variable.name;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): VarCreateJson {\n    const json = super.toJson() as VarCreateJson;\n    if (!this.varType) {\n      throw new Error(\n          'The var type is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson');\n    }\n    if (!this.varName) {\n      throw new Error(\n          'The var name is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson');\n    }\n    json['varType'] = this.varType;\n    json['varName'] = this.varName;\n    return json;\n  }\n\n  /**\n   * Decode the JSON event.\n   *\n   * @param json JSON representation.\n   */\n  override fromJson(json: VarCreateJson) {\n    deprecation.warn(\n        'Blockly.Events.VarCreate.prototype.fromJson', 'version 9',\n        'version 10', 'Blockly.Events.fromJson');\n    super.fromJson(json);\n    this.varType = json['varType'];\n    this.varName = json['varName'];\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of VarCreate, but we can't specify that due to the fact that parameters\n   *     to static methods in subclasses must be supertypes of parameters to\n   *     static methods in superclasses.\n   * @internal\n   */\n  static fromJson(json: VarCreateJson, workspace: Workspace, event?: any):\n      VarCreate {\n    const newEvent =\n        super.fromJson(json, workspace, event ?? new VarCreate()) as VarCreate;\n    newEvent.varType = json['varType'];\n    newEvent.varName = json['varName'];\n    return newEvent;\n  }\n\n  /**\n   * Run a variable creation event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    const workspace = this.getEventWorkspace_();\n    if (!this.varId) {\n      throw new Error(\n          'The var ID is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson');\n    }\n    if (!this.varName) {\n      throw new Error(\n          'The var name is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson');\n    }\n    if (forward) {\n      workspace.createVariable(this.varName, this.varType, this.varId);\n    } else {\n      workspace.deleteVariableById(this.varId);\n    }\n  }\n}\n\nexport interface VarCreateJson extends VarBaseJson {\n  varType: string;\n  varName: string;\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.VAR_CREATE, VarCreate);\n","/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Components for the variable model.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.VariableModel');\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_var_create.js';\n\nimport * as idGenerator from './utils/idgenerator.js';\nimport type {Workspace} from './workspace.js';\n\n\n/**\n * Class for a variable model.\n * Holds information for the variable including name, ID, and type.\n *\n * @see {Blockly.FieldVariable}\n * @alias Blockly.VariableModel\n */\nexport class VariableModel {\n  type: string;\n  private readonly id_: string;\n\n  /**\n   * @param workspace The variable's workspace.\n   * @param name The name of the variable.  This is the user-visible name (e.g.\n   *     'my var' or ''), not the generated name.\n   * @param opt_type The type of the variable like 'int' or 'string'.\n   *     Does not need to be unique. Field_variable can filter variables based\n   * on their type. This will default to '' which is a specific type.\n   * @param opt_id The unique ID of the variable. This will default to a UUID.\n   */\n  constructor(\n      public workspace: Workspace, public name: string, opt_type?: string,\n      opt_id?: string) {\n    /**\n     * The type of the variable, such as 'int' or 'sound_effect'. This may be\n     * used to build a list of variables of a specific type. By default this is\n     * the empty string '', which is a specific type.\n     *\n     * @see {Blockly.FieldVariable}\n     */\n    this.type = opt_type || '';\n\n    /**\n     * A unique ID for the variable. This should be defined at creation and\n     * not change, even if the name changes. In most cases this should be a\n     * UUID.\n     */\n    this.id_ = opt_id || idGenerator.genUid();\n  }\n\n  /** @returns The ID for the variable. */\n  getId(): string {\n    return this.id_;\n  }\n\n  /**\n   * A custom compare function for the VariableModel objects.\n   *\n   * @param var1 First variable to compare.\n   * @param var2 Second variable to compare.\n   * @returns -1 if name of var1 is less than name of var2, 0 if equal, and 1 if\n   *     greater.\n   * @internal\n   */\n  static compareByName(var1: VariableModel, var2: VariableModel): number {\n    return var1.name.localeCompare(var2.name, undefined, {sensitivity: 'base'});\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing a code comment on the workspace.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.WorkspaceComment');\n\nimport type {CommentMove} from './events/events_comment_move.js';\nimport * as eventUtils from './events/utils.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as idGenerator from './utils/idgenerator.js';\nimport * as xml from './utils/xml.js';\nimport type {Workspace} from './workspace.js';\n\n\n/**\n * Class for a workspace comment.\n *\n * @alias Blockly.WorkspaceComment\n */\nexport class WorkspaceComment {\n  id: string;\n  protected xy_: Coordinate;\n  protected height_: number;\n  protected width_: number;\n  protected RTL: boolean;\n\n  private deletable_ = true;\n\n  private movable_ = true;\n\n  private editable_ = true;\n  protected content_: string;\n\n  /** Whether this comment has been disposed. */\n  protected disposed_ = false;\n  /** @internal */\n  isComment = true;\n\n  /**\n   * @param workspace The block's workspace.\n   * @param content The content of this workspace comment.\n   * @param height Height of the comment.\n   * @param width Width of the comment.\n   * @param opt_id Optional ID.  Use this ID if provided, otherwise create a new\n   *     ID.\n   */\n  constructor(\n      public workspace: Workspace, content: string, height: number,\n      width: number, opt_id?: string) {\n    this.id = opt_id && !workspace.getCommentById(opt_id) ?\n        opt_id :\n        idGenerator.genUid();\n\n    workspace.addTopComment(this);\n\n    /**\n     * The comment's position in workspace units.  (0, 0) is at the workspace's\n     * origin; scale does not change this value.\n     */\n    this.xy_ = new Coordinate(0, 0);\n\n    /**\n     * The comment's height in workspace units.  Scale does not change this\n     * value.\n     */\n    this.height_ = height;\n\n    /**\n     * The comment's width in workspace units.  Scale does not change this\n     * value.\n     */\n    this.width_ = width;\n\n    this.RTL = workspace.RTL;\n\n    this.content_ = content;\n\n    WorkspaceComment.fireCreateEvent(this);\n  }\n\n  /**\n   * Dispose of this comment.\n   *\n   * @internal\n   */\n  dispose() {\n    if (this.disposed_) {\n      return;\n    }\n\n    if (eventUtils.isEnabled()) {\n      eventUtils.fire(new (eventUtils.get(eventUtils.COMMENT_DELETE))(this));\n    }\n    // Remove from the list of top comments and the comment database.\n    this.workspace.removeTopComment(this);\n    this.disposed_ = true;\n  }\n\n  // Height, width, x, and y are all stored on even non-rendered comments, to\n  // preserve state if you pass the contents through a headless workspace.\n\n  /**\n   * Get comment height.\n   *\n   * @returns Comment height.\n   * @internal\n   */\n  getHeight(): number {\n    return this.height_;\n  }\n\n  /**\n   * Set comment height.\n   *\n   * @param height Comment height.\n   * @internal\n   */\n  setHeight(height: number) {\n    this.height_ = height;\n  }\n\n  /**\n   * Get comment width.\n   *\n   * @returns Comment width.\n   * @internal\n   */\n  getWidth(): number {\n    return this.width_;\n  }\n\n  /**\n   * Set comment width.\n   *\n   * @param width comment width.\n   * @internal\n   */\n  setWidth(width: number) {\n    this.width_ = width;\n  }\n\n  /**\n   * Get stored location.\n   *\n   * @returns The comment's stored location.\n   *   This is not valid if the comment is currently being dragged.\n   * @internal\n   */\n  getXY(): Coordinate {\n    return new Coordinate(this.xy_.x, this.xy_.y);\n  }\n\n  /**\n   * Move a comment by a relative offset.\n   *\n   * @param dx Horizontal offset, in workspace units.\n   * @param dy Vertical offset, in workspace units.\n   * @internal\n   */\n  moveBy(dx: number, dy: number) {\n    const event =\n        new (eventUtils.get(eventUtils.COMMENT_MOVE))(this) as CommentMove;\n    this.xy_.translate(dx, dy);\n    event.recordNew();\n    eventUtils.fire(event);\n  }\n\n  /**\n   * Get whether this comment is deletable or not.\n   *\n   * @returns True if deletable.\n   * @internal\n   */\n  isDeletable(): boolean {\n    return this.deletable_ &&\n        !(this.workspace && this.workspace.options.readOnly);\n  }\n\n  /**\n   * Set whether this comment is deletable or not.\n   *\n   * @param deletable True if deletable.\n   * @internal\n   */\n  setDeletable(deletable: boolean) {\n    this.deletable_ = deletable;\n  }\n\n  /**\n   * Get whether this comment is movable or not.\n   *\n   * @returns True if movable.\n   * @internal\n   */\n  isMovable(): boolean {\n    return this.movable_ &&\n        !(this.workspace && this.workspace.options.readOnly);\n  }\n\n  /**\n   * Set whether this comment is movable or not.\n   *\n   * @param movable True if movable.\n   * @internal\n   */\n  setMovable(movable: boolean) {\n    this.movable_ = movable;\n  }\n\n  /**\n   * Get whether this comment is editable or not.\n   *\n   * @returns True if editable.\n   */\n  isEditable(): boolean {\n    return this.editable_ &&\n        !(this.workspace && this.workspace.options.readOnly);\n  }\n\n  /**\n   * Set whether this comment is editable or not.\n   *\n   * @param editable True if editable.\n   */\n  setEditable(editable: boolean) {\n    this.editable_ = editable;\n  }\n\n  /**\n   * Returns this comment's text.\n   *\n   * @returns Comment text.\n   * @internal\n   */\n  getContent(): string {\n    return this.content_;\n  }\n\n  /**\n   * Set this comment's content.\n   *\n   * @param content Comment content.\n   * @internal\n   */\n  setContent(content: string) {\n    if (this.content_ !== content) {\n      eventUtils.fire(new (eventUtils.get(eventUtils.COMMENT_CHANGE))(\n          this, this.content_, content));\n      this.content_ = content;\n    }\n  }\n\n  /**\n   * Encode a comment subtree as XML with XY coordinates.\n   *\n   * @param opt_noId True if the encoder should skip the comment ID.\n   * @returns Tree of XML elements.\n   * @internal\n   */\n  toXmlWithXY(opt_noId?: boolean): Element {\n    const element = this.toXml(opt_noId);\n    element.setAttribute('x', `${Math.round(this.xy_.x)}`);\n    element.setAttribute('y', `${Math.round(this.xy_.y)}`);\n    element.setAttribute('h', `${this.height_}`);\n    element.setAttribute('w', `${this.width_}`);\n    return element;\n  }\n\n  /**\n   * Encode a comment subtree as XML, but don't serialize the XY coordinates.\n   * This method avoids some expensive metrics-related calls that are made in\n   * toXmlWithXY().\n   *\n   * @param opt_noId True if the encoder should skip the comment ID.\n   * @returns Tree of XML elements.\n   * @internal\n   */\n  toXml(opt_noId?: boolean): Element {\n    const commentElement = xml.createElement('comment');\n    if (!opt_noId) {\n      commentElement.id = this.id;\n    }\n    commentElement.textContent = this.getContent();\n    return commentElement;\n  }\n\n  /**\n   * Fire a create event for the given workspace comment, if comments are\n   * enabled.\n   *\n   * @param comment The comment that was just created.\n   * @internal\n   */\n  static fireCreateEvent(comment: WorkspaceComment) {\n    if (eventUtils.isEnabled()) {\n      const existingGroup = eventUtils.getGroup();\n      if (!existingGroup) {\n        eventUtils.setGroup(true);\n      }\n      try {\n        eventUtils.fire(\n            new (eventUtils.get(eventUtils.COMMENT_CREATE))(comment));\n      } finally {\n        if (!existingGroup) {\n          eventUtils.setGroup(false);\n        }\n      }\n    }\n  }\n\n  /**\n   * Decode an XML comment tag and create a comment on the workspace.\n   *\n   * @param xmlComment XML comment element.\n   * @param workspace The workspace.\n   * @returns The created workspace comment.\n   * @internal\n   */\n  static fromXml(xmlComment: Element, workspace: Workspace): WorkspaceComment {\n    const info = WorkspaceComment.parseAttributes(xmlComment);\n\n    const comment =\n        new WorkspaceComment(workspace, info.content, info.h, info.w, info.id);\n\n    const xmlX = xmlComment.getAttribute('x');\n    const xmlY = xmlComment.getAttribute('y');\n    const commentX = xmlX ? parseInt(xmlX, 10) : NaN;\n    const commentY = xmlY ? parseInt(xmlY, 10) : NaN;\n    if (!isNaN(commentX) && !isNaN(commentY)) {\n      comment.moveBy(commentX, commentY);\n    }\n\n    WorkspaceComment.fireCreateEvent(comment);\n    return comment;\n  }\n\n  /**\n   * Decode an XML comment tag and return the results in an object.\n   *\n   * @param xml XML comment element.\n   * @returns An object containing the id, size, position, and comment string.\n   * @internal\n   */\n  static parseAttributes(xml: Element): {\n    id: string,\n    w: number,\n    h: number,\n    x: number,\n    y: number,\n    content: string\n  } {\n    const xmlH = xml.getAttribute('h');\n    const xmlW = xml.getAttribute('w');\n    const xmlX = xml.getAttribute('x');\n    const xmlY = xml.getAttribute('y');\n    const xmlId = xml.getAttribute('id');\n\n    if (!xmlId) {\n      throw new Error('No ID present in XML comment definition.');\n    }\n\n    return {\n      id: xmlId,\n      // The height of the comment in workspace units, or 100 if not specified.\n      h: xmlH ? parseInt(xmlH) : 100,\n      // The width of the comment in workspace units, or 100 if not specified.\n      w: xmlW ? parseInt(xmlW) : 100,\n      // The x position of the comment in workspace coordinates, or NaN if not\n      // specified in the XML.\n      x: xmlX ? parseInt(xmlX) : NaN,\n      // The y position of the comment in workspace coordinates, or NaN if not\n      // specified in the XML.\n      y: xmlY ? parseInt(xmlY) : NaN,\n      content: xml.textContent ?? '',\n    };\n  }\n}\n","/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Base class for events fired as a result of UI actions in\n * Blockly's editor.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events.UiBase');\n\nimport {Abstract as AbstractEvent} from './events_abstract.js';\n\n\n/**\n * Base class for a UI event.\n * UI events are events that don't need to be sent over the wire for multi-user\n * editing to work (e.g. scrolling the workspace, zooming, opening toolbox\n * categories).\n * UI events do not undo or redo.\n *\n * @alias Blockly.Events.UiBase\n */\nexport class UiBase extends AbstractEvent {\n  override isBlank = true;\n  override workspaceId: string;\n\n  // UI events do not undo or redo.\n  override recordUndo = false;\n\n  /** Whether or not the event is a UI event. */\n  override isUiEvent = true;\n\n  /**\n   * @param opt_workspaceId The workspace identifier for this event.\n   *    Undefined for a blank event.\n   */\n  constructor(opt_workspaceId?: string) {\n    super();\n\n    /** Whether or not the event is blank (to be populated by fromJson). */\n    this.isBlank = typeof opt_workspaceId === 'undefined';\n\n    /** The workspace identifier for this event. */\n    this.workspaceId = opt_workspaceId ? opt_workspaceId : '';\n  }\n}\n","/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Events fired as a result of element select action.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events.Selected');\n\nimport * as deprecation from '../utils/deprecation.js';\nimport * as registry from '../registry.js';\nimport {AbstractEventJson} from './events_abstract.js';\n\nimport {UiBase} from './events_ui_base.js';\nimport * as eventUtils from './utils.js';\nimport type {Workspace} from '../workspace.js';\n\n\n/**\n * Class for a selected event.\n *\n * @alias Blockly.Events.Selected\n */\nexport class Selected extends UiBase {\n  oldElementId?: string;\n  newElementId?: string;\n  override type = eventUtils.SELECTED;\n\n  /**\n   * @param opt_oldElementId The ID of the previously selected element. Null if\n   *     no element last selected. Undefined for a blank event.\n   * @param opt_newElementId The ID of the selected element. Null if no element\n   *     currently selected (deselect). Undefined for a blank event.\n   * @param opt_workspaceId The workspace identifier for this event.\n   *    Null if no element previously selected. Undefined for a blank event.\n   */\n  constructor(\n      opt_oldElementId?: string|null, opt_newElementId?: string|null,\n      opt_workspaceId?: string) {\n    super(opt_workspaceId);\n\n    /** The id of the last selected element. */\n    this.oldElementId = opt_oldElementId ?? undefined;\n\n    /** The id of the selected element. */\n    this.newElementId = opt_newElementId ?? undefined;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): SelectedJson {\n    const json = super.toJson() as SelectedJson;\n    json['oldElementId'] = this.oldElementId;\n    json['newElementId'] = this.newElementId;\n    return json;\n  }\n\n  /**\n   * Decode the JSON event.\n   *\n   * @param json JSON representation.\n   */\n  override fromJson(json: SelectedJson) {\n    deprecation.warn(\n        'Blockly.Events.Selected.prototype.fromJson', 'version 9', 'version 10',\n        'Blockly.Events.fromJson');\n    super.fromJson(json);\n    this.oldElementId = json['oldElementId'];\n    this.newElementId = json['newElementId'];\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of Selected, but we can't specify that due to the fact that parameters\n   *     to static methods in subclasses must be supertypes of parameters to\n   *     static methods in superclasses.\n   * @internal\n   */\n  static fromJson(json: SelectedJson, workspace: Workspace, event?: any):\n      Selected {\n    const newEvent =\n        super.fromJson(json, workspace, event ?? new Selected()) as Selected;\n    newEvent.oldElementId = json['oldElementId'];\n    newEvent.newElementId = json['newElementId'];\n    return newEvent;\n  }\n}\n\nexport interface SelectedJson extends AbstractEventJson {\n  oldElementId?: string;\n  newElementId?: string;\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.SELECTED, Selected);\n","/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Defines the Svg class. Its constants enumerate\n * all SVG tag names used by Blockly.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.utils.Svg');\n\n\n/**\n * A name with the type of the SVG element stored in the generic.\n *\n * @alias Blockly.utils.Svg\n */\nexport class Svg<_T> {\n  /** @internal */\n  static ANIMATE = new Svg<SVGAnimateElement>('animate');\n  /** @internal */\n  static CIRCLE = new Svg<SVGCircleElement>('circle');\n  /** @internal */\n  static CLIPPATH = new Svg<SVGClipPathElement>('clipPath');\n  /** @internal */\n  static DEFS = new Svg<SVGDefsElement>('defs');\n  /** @internal */\n  static FECOMPOSITE = new Svg<SVGFECompositeElement>('feComposite');\n  /** @internal */\n  static FECOMPONENTTRANSFER =\n      new Svg<SVGFEComponentTransferElement>('feComponentTransfer');\n  /** @internal */\n  static FEFLOOD = new Svg<SVGFEFloodElement>('feFlood');\n  /** @internal */\n  static FEFUNCA = new Svg<SVGFEFuncAElement>('feFuncA');\n  /** @internal */\n  static FEGAUSSIANBLUR = new Svg<SVGFEGaussianBlurElement>('feGaussianBlur');\n  /** @internal */\n  static FEPOINTLIGHT = new Svg<SVGFEPointLightElement>('fePointLight');\n  /** @internal */\n  static FESPECULARLIGHTING =\n      new Svg<SVGFESpecularLightingElement>('feSpecularLighting');\n  /** @internal */\n  static FILTER = new Svg<SVGFilterElement>('filter');\n  /** @internal */\n  static FOREIGNOBJECT = new Svg<SVGForeignObjectElement>('foreignObject');\n  /** @internal */\n  static G = new Svg<SVGGElement>('g');\n  /** @internal */\n  static IMAGE = new Svg<SVGImageElement>('image');\n  /** @internal */\n  static LINE = new Svg<SVGLineElement>('line');\n  /** @internal */\n  static PATH = new Svg<SVGPathElement>('path');\n  /** @internal */\n  static PATTERN = new Svg<SVGPatternElement>('pattern');\n  /** @internal */\n  static POLYGON = new Svg<SVGPolygonElement>('polygon');\n  /** @internal */\n  static RECT = new Svg<SVGRectElement>('rect');\n  /** @internal */\n  static SVG = new Svg<SVGSVGElement>('svg');\n  /** @internal */\n  static TEXT = new Svg<SVGTextElement>('text');\n  /** @internal */\n  static TSPAN = new Svg<SVGTSpanElement>('tspan');\n\n  /**\n   * @param tagName The SVG element tag name.\n   * @internal\n   */\n  constructor(private readonly tagName: string) {}\n\n  /**\n   * Returns the SVG element tag name.\n   *\n   * @returns The name.\n   */\n  toString(): string {\n    return this.tagName;\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing a code comment on a rendered workspace.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.WorkspaceCommentSvg');\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_selected.js';\n\nimport type {BlockDragSurfaceSvg} from './block_drag_surface.js';\nimport * as browserEvents from './browser_events.js';\nimport * as common from './common.js';\n// import * as ContextMenu from './contextmenu.js';\nimport * as Css from './css.js';\nimport type {CommentMove} from './events/events_comment_move.js';\nimport * as eventUtils from './events/utils.js';\nimport type {IBoundedElement} from './interfaces/i_bounded_element.js';\nimport type {IBubble} from './interfaces/i_bubble.js';\nimport type {CopyData, ICopyable} from './interfaces/i_copyable.js';\nimport * as Touch from './touch.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport {Rect} from './utils/rect.js';\nimport {Svg} from './utils/svg.js';\nimport * as svgMath from './utils/svg_math.js';\nimport {WorkspaceComment} from './workspace_comment.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/** Size of the resize icon. */\nconst RESIZE_SIZE = 8;\n\n/** Radius of the border around the comment. */\nconst BORDER_RADIUS = 3;\n\n/** Offset from the foreignobject edge to the textarea edge. */\nconst TEXTAREA_OFFSET = 2;\n\n/**\n * Class for a workspace comment's SVG representation.\n *\n * @alias Blockly.WorkspaceCommentSvg\n */\nexport class WorkspaceCommentSvg extends WorkspaceComment implements\n    IBoundedElement, IBubble, ICopyable {\n  /**\n   * The width and height to use to size a workspace comment when it is first\n   * added, before it has been edited by the user.\n   *\n   * @internal\n   */\n  static DEFAULT_SIZE = 100;\n\n  /** Offset from the top to make room for a top bar. */\n  private static readonly TOP_OFFSET = 10;\n  override workspace: WorkspaceSvg;\n\n  /** Mouse up event data. */\n  private onMouseUpWrapper_: browserEvents.Data|null = null;\n\n  /** Mouse move event data. */\n  private onMouseMoveWrapper_: browserEvents.Data|null = null;\n\n  /** Whether event handlers have been initialized. */\n  private eventsInit_ = false;\n  private textarea_: HTMLTextAreaElement|null = null;\n\n  private svgRectTarget_: SVGRectElement|null = null;\n\n  private svgHandleTarget_: SVGRectElement|null = null;\n\n  private foreignObject_: SVGForeignObjectElement|null = null;\n\n  private resizeGroup_: SVGGElement|null = null;\n\n  private deleteGroup_: SVGGElement|null = null;\n\n  private deleteIconBorder_: SVGCircleElement|null = null;\n\n  private focused_ = false;\n  private autoLayout_ = false;\n  // Create core elements for the block.\n  private readonly svgGroup_: SVGElement;\n  svgRect_: AnyDuringMigration;\n\n  /** Whether the comment is rendered onscreen and is a part of the DOM. */\n  private rendered_ = false;\n  private readonly useDragSurface_: boolean;\n\n  /**\n   * @param workspace The block's workspace.\n   * @param content The content of this workspace comment.\n   * @param height Height of the comment.\n   * @param width Width of the comment.\n   * @param opt_id Optional ID.  Use this ID if provided, otherwise create a new\n   *     ID.\n   */\n  constructor(\n      workspace: WorkspaceSvg, content: string, height: number, width: number,\n      opt_id?: string) {\n    super(workspace, content, height, width, opt_id);\n    this.svgGroup_ = dom.createSvgElement(Svg.G, {'class': 'blocklyComment'});\n    (this.svgGroup_ as AnyDuringMigration).translate_ = '';\n    this.workspace = workspace;\n\n    this.svgRect_ = dom.createSvgElement(Svg.RECT, {\n      'class': 'blocklyCommentRect',\n      'x': 0,\n      'y': 0,\n      'rx': BORDER_RADIUS,\n      'ry': BORDER_RADIUS,\n    });\n    this.svgGroup_.appendChild(this.svgRect_);\n\n    /**\n     * Whether to move the comment to the drag surface when it is dragged.\n     * True if it should move, false if it should be translated directly.\n     */\n    this.useDragSurface_ = !!workspace.getBlockDragSurface();\n\n    this.render();\n  }\n\n  /**\n   * Dispose of this comment.\n   *\n   * @internal\n   */\n  override dispose() {\n    if (this.disposed_) {\n      return;\n    }\n    // If this comment is being dragged, unlink the mouse events.\n    if (common.getSelected() === this) {\n      this.unselect();\n      this.workspace.cancelCurrentGesture();\n    }\n\n    if (eventUtils.isEnabled()) {\n      eventUtils.fire(new (eventUtils.get(eventUtils.COMMENT_DELETE))(this));\n    }\n\n    dom.removeNode(this.svgGroup_);\n    // Dispose of any rendered components\n    this.disposeInternal_();\n\n    eventUtils.disable();\n    super.dispose();\n    eventUtils.enable();\n  }\n\n  /**\n   * Create and initialize the SVG representation of a workspace comment.\n   * May be called more than once.\n   *\n   * @param opt_noSelect Text inside text area will be selected if false\n   * @internal\n   */\n  initSvg(opt_noSelect?: boolean) {\n    if (!this.workspace.rendered) {\n      throw TypeError('Workspace is headless.');\n    }\n    if (!this.workspace.options.readOnly && !this.eventsInit_) {\n      browserEvents.conditionalBind(\n          this.svgRectTarget_ as SVGRectElement, 'pointerdown', this,\n          this.pathMouseDown_);\n      browserEvents.conditionalBind(\n          this.svgHandleTarget_ as SVGRectElement, 'pointerdown', this,\n          this.pathMouseDown_);\n    }\n    this.eventsInit_ = true;\n\n    this.updateMovable();\n    if (!this.getSvgRoot().parentNode) {\n      this.workspace.getBubbleCanvas().appendChild(this.getSvgRoot());\n    }\n\n    if (!opt_noSelect && this.textarea_) {\n      this.textarea_.select();\n    }\n  }\n\n  /**\n   * Handle a pointerdown on an SVG comment.\n   *\n   * @param e Pointer down event.\n   */\n  private pathMouseDown_(e: PointerEvent) {\n    const gesture = this.workspace.getGesture(e);\n    if (gesture) {\n      gesture.handleBubbleStart(e, this);\n    }\n  }\n\n  /**\n   * Show the context menu for this workspace comment.\n   *\n   * @param e Pointer event.\n   * @internal\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  showContextMenu(e: PointerEvent) {\n    throw new Error(\n        'The implementation of showContextMenu should be ' +\n        'monkey-patched in by blockly.ts');\n  }\n\n  /**\n   * Select this comment.  Highlight it visually.\n   *\n   * @internal\n   */\n  select() {\n    if (common.getSelected() === this) {\n      return;\n    }\n    let oldId = null;\n    if (common.getSelected()) {\n      oldId = common.getSelected()!.id;\n      // Unselect any previously selected block.\n      eventUtils.disable();\n      try {\n        common.getSelected()!.unselect();\n      } finally {\n        eventUtils.enable();\n      }\n    }\n    const event = new (eventUtils.get(eventUtils.SELECTED))(\n        oldId, this.id, this.workspace.id);\n    eventUtils.fire(event);\n    common.setSelected(this);\n    this.addSelect();\n  }\n\n  /**\n   * Unselect this comment.  Remove its highlighting.\n   *\n   * @internal\n   */\n  unselect() {\n    if (common.getSelected() !== this) {\n      return;\n    }\n    const event = new (eventUtils.get(eventUtils.SELECTED))(\n        this.id, null, this.workspace.id);\n    eventUtils.fire(event);\n    common.setSelected(null);\n    this.removeSelect();\n    this.blurFocus();\n  }\n\n  /**\n   * Select this comment.  Highlight it visually.\n   *\n   * @internal\n   */\n  addSelect() {\n    dom.addClass(this.svgGroup_, 'blocklySelected');\n    this.setFocus();\n  }\n\n  /**\n   * Unselect this comment.  Remove its highlighting.\n   *\n   * @internal\n   */\n  removeSelect() {\n    dom.addClass(this.svgGroup_, 'blocklySelected');\n    this.blurFocus();\n  }\n\n  /**\n   * Focus this comment.  Highlight it visually.\n   *\n   * @internal\n   */\n  addFocus() {\n    dom.addClass(this.svgGroup_, 'blocklyFocused');\n  }\n\n  /**\n   * Unfocus this comment.  Remove its highlighting.\n   *\n   * @internal\n   */\n  removeFocus() {\n    dom.removeClass(this.svgGroup_, 'blocklyFocused');\n  }\n\n  /**\n   * Return the coordinates of the top-left corner of this comment relative to\n   * the drawing surface's origin (0,0), in workspace units.\n   * If the comment is on the workspace, (0, 0) is the origin of the workspace\n   * coordinate system.\n   * This does not change with workspace scale.\n   *\n   * @returns Object with .x and .y properties in workspace coordinates.\n   * @internal\n   */\n  getRelativeToSurfaceXY(): Coordinate {\n    let x = 0;\n    let y = 0;\n\n    const dragSurfaceGroup = this.useDragSurface_ ?\n        this.workspace.getBlockDragSurface()!.getGroup() :\n        null;\n\n    let element = this.getSvgRoot();\n    if (element) {\n      do {\n        // Loop through this comment and every parent.\n        const xy = svgMath.getRelativeXY(element as Element);\n        x += xy.x;\n        y += xy.y;\n        // If this element is the current element on the drag surface, include\n        // the translation of the drag surface itself.\n        if (this.useDragSurface_ &&\n            this.workspace.getBlockDragSurface()!.getCurrentBlock() ===\n                element) {\n          const surfaceTranslation =\n              this.workspace.getBlockDragSurface()!.getSurfaceTranslation();\n          x += surfaceTranslation.x;\n          y += surfaceTranslation.y;\n        }\n        // AnyDuringMigration because:  Type 'ParentNode | null' is not\n        // assignable to type 'SVGElement'.\n        element = element.parentNode as AnyDuringMigration;\n      } while (element && element !== this.workspace.getBubbleCanvas() &&\n               element !== dragSurfaceGroup);\n    }\n    this.xy_ = new Coordinate(x, y);\n    return this.xy_;\n  }\n\n  /**\n   * Move a comment by a relative offset.\n   *\n   * @param dx Horizontal offset, in workspace units.\n   * @param dy Vertical offset, in workspace units.\n   * @internal\n   */\n  override moveBy(dx: number, dy: number) {\n    const event =\n        new (eventUtils.get(eventUtils.COMMENT_MOVE))(this) as CommentMove;\n    // TODO: Do I need to look up the relative to surface XY position here?\n    const xy = this.getRelativeToSurfaceXY();\n    this.translate(xy.x + dx, xy.y + dy);\n    this.xy_ = new Coordinate(xy.x + dx, xy.y + dy);\n    event.recordNew();\n    eventUtils.fire(event);\n    this.workspace.resizeContents();\n  }\n\n  /**\n   * Transforms a comment by setting the translation on the transform attribute\n   * of the block's SVG.\n   *\n   * @param x The x coordinate of the translation in workspace units.\n   * @param y The y coordinate of the translation in workspace units.\n   * @internal\n   */\n  translate(x: number, y: number) {\n    this.xy_ = new Coordinate(x, y);\n    this.getSvgRoot().setAttribute(\n        'transform', 'translate(' + x + ',' + y + ')');\n  }\n\n  /**\n   * Move this comment to its workspace's drag surface, accounting for\n   * positioning.  Generally should be called at the same time as\n   * setDragging(true).  Does nothing if useDragSurface_ is false.\n   *\n   * @internal\n   */\n  moveToDragSurface() {\n    if (!this.useDragSurface_) {\n      return;\n    }\n    // The translation for drag surface blocks,\n    // is equal to the current relative-to-surface position,\n    // to keep the position in sync as it move on/off the surface.\n    // This is in workspace coordinates.\n    const xy = this.getRelativeToSurfaceXY();\n    this.clearTransformAttributes_();\n    this.workspace.getBlockDragSurface()!.translateSurface(xy.x, xy.y);\n    // Execute the move on the top-level SVG component\n    this.workspace.getBlockDragSurface()!.setBlocksAndShow(this.getSvgRoot());\n  }\n\n  /**\n   * Move this comment during a drag, taking into account whether we are using a\n   * drag surface to translate blocks.\n   *\n   * @param dragSurface The surface that carries rendered items during a drag,\n   *     or null if no drag surface is in use.\n   * @param newLoc The location to translate to, in workspace coordinates.\n   * @internal\n   */\n  moveDuringDrag(dragSurface: BlockDragSurfaceSvg, newLoc: Coordinate) {\n    if (dragSurface) {\n      dragSurface.translateSurface(newLoc.x, newLoc.y);\n    } else {\n      (this.svgGroup_ as AnyDuringMigration).translate_ =\n          'translate(' + newLoc.x + ',' + newLoc.y + ')';\n      (this.svgGroup_ as AnyDuringMigration)\n          .setAttribute(\n              'transform',\n              (this.svgGroup_ as AnyDuringMigration).translate_ +\n                  (this.svgGroup_ as AnyDuringMigration).skew_);\n    }\n  }\n\n  /**\n   * Move the bubble group to the specified location in workspace coordinates.\n   *\n   * @param x The x position to move to.\n   * @param y The y position to move to.\n   * @internal\n   */\n  moveTo(x: number, y: number) {\n    this.translate(x, y);\n  }\n\n  /**\n   * Clear the comment of transform=\"...\" attributes.\n   * Used when the comment is switching from 3d to 2d transform or vice versa.\n   */\n  private clearTransformAttributes_() {\n    this.getSvgRoot().removeAttribute('transform');\n  }\n\n  /**\n   * Returns the coordinates of a bounding box describing the dimensions of this\n   * comment.\n   * Coordinate system: workspace coordinates.\n   *\n   * @returns Object with coordinates of the bounding box.\n   * @internal\n   */\n  getBoundingRectangle(): Rect {\n    const blockXY = this.getRelativeToSurfaceXY();\n    const commentBounds = this.getHeightWidth();\n    const top = blockXY.y;\n    const bottom = blockXY.y + commentBounds.height;\n    let left;\n    let right;\n    if (this.RTL) {\n      left = blockXY.x - commentBounds.width;\n      // Add the width of the tab/puzzle piece knob to the x coordinate\n      // since X is the corner of the rectangle, not the whole puzzle piece.\n      right = blockXY.x;\n    } else {\n      // Subtract the width of the tab/puzzle piece knob to the x coordinate\n      // since X is the corner of the rectangle, not the whole puzzle piece.\n      left = blockXY.x;\n      right = blockXY.x + commentBounds.width;\n    }\n    return new Rect(top, bottom, left, right);\n  }\n\n  /**\n   * Add or remove the UI indicating if this comment is movable or not.\n   *\n   * @internal\n   */\n  updateMovable() {\n    if (this.isMovable()) {\n      dom.addClass(this.svgGroup_, 'blocklyDraggable');\n    } else {\n      dom.removeClass(this.svgGroup_, 'blocklyDraggable');\n    }\n  }\n\n  /**\n   * Set whether this comment is movable or not.\n   *\n   * @param movable True if movable.\n   * @internal\n   */\n  override setMovable(movable: boolean) {\n    super.setMovable(movable);\n    this.updateMovable();\n  }\n\n  /**\n   * Set whether this comment is editable or not.\n   *\n   * @param editable True if editable.\n   */\n  override setEditable(editable: boolean) {\n    super.setEditable(editable);\n    if (this.textarea_) {\n      this.textarea_.readOnly = !editable;\n    }\n  }\n\n  /**\n   * Recursively adds or removes the dragging class to this node and its\n   * children.\n   *\n   * @param adding True if adding, false if removing.\n   * @internal\n   */\n  setDragging(adding: boolean) {\n    if (adding) {\n      const group = this.getSvgRoot();\n      (group as AnyDuringMigration).translate_ = '';\n      (group as AnyDuringMigration).skew_ = '';\n      dom.addClass(this.svgGroup_, 'blocklyDragging');\n    } else {\n      dom.removeClass(this.svgGroup_, 'blocklyDragging');\n    }\n  }\n\n  /**\n   * Return the root node of the SVG or null if none exists.\n   *\n   * @returns The root SVG node (probably a group).\n   * @internal\n   */\n  getSvgRoot(): SVGElement {\n    return this.svgGroup_;\n  }\n\n  /**\n   * Returns this comment's text.\n   *\n   * @returns Comment text.\n   * @internal\n   */\n  override getContent(): string {\n    return this.textarea_ ? this.textarea_.value : this.content_;\n  }\n\n  /**\n   * Set this comment's content.\n   *\n   * @param content Comment content.\n   * @internal\n   */\n  override setContent(content: string) {\n    super.setContent(content);\n    if (this.textarea_) {\n      this.textarea_.value = content;\n    }\n  }\n\n  /**\n   * Update the cursor over this comment by adding or removing a class.\n   *\n   * @param enable True if the delete cursor should be shown, false otherwise.\n   * @internal\n   */\n  setDeleteStyle(enable: boolean) {\n    if (enable) {\n      dom.addClass(this.svgGroup_, 'blocklyDraggingDelete');\n    } else {\n      dom.removeClass(this.svgGroup_, 'blocklyDraggingDelete');\n    }\n  }\n\n  /**\n   * Set whether auto-layout of this bubble is enabled.  The first time a bubble\n   * is shown it positions itself to not cover any blocks.  Once a user has\n   * dragged it to reposition, it renders where the user put it.\n   *\n   * @param _enable True if auto-layout should be enabled, false otherwise.\n   * @internal\n   */\n  setAutoLayout(_enable: boolean) {}\n  // NOP for compatibility with the bubble dragger.\n\n  /**\n   * Encode a comment subtree as XML with XY coordinates.\n   *\n   * @param opt_noId True if the encoder should skip the comment ID.\n   * @returns Tree of XML elements.\n   * @internal\n   */\n  override toXmlWithXY(opt_noId?: boolean): Element {\n    let width = 0;  // Not used in LTR.\n    if (this.workspace.RTL) {\n      // Here be performance dragons: This calls getMetrics().\n      width = this.workspace.getWidth();\n    }\n    const element = this.toXml(opt_noId);\n    const xy = this.getRelativeToSurfaceXY();\n    // AnyDuringMigration because:  Argument of type 'number' is not assignable\n    // to parameter of type 'string'.\n    element.setAttribute(\n        'x',\n        Math.round(this.workspace.RTL ? width - xy.x : xy.x) as\n            AnyDuringMigration);\n    // AnyDuringMigration because:  Argument of type 'number' is not assignable\n    // to parameter of type 'string'.\n    element.setAttribute('y', Math.round(xy.y) as AnyDuringMigration);\n    // AnyDuringMigration because:  Argument of type 'number' is not assignable\n    // to parameter of type 'string'.\n    element.setAttribute('h', this.getHeight() as AnyDuringMigration);\n    // AnyDuringMigration because:  Argument of type 'number' is not assignable\n    // to parameter of type 'string'.\n    element.setAttribute('w', this.getWidth() as AnyDuringMigration);\n    return element;\n  }\n\n  /**\n   * Encode a comment for copying.\n   *\n   * @returns Copy metadata.\n   * @internal\n   */\n  toCopyData(): CopyData {\n    return {\n      saveInfo: this.toXmlWithXY(),\n      source: this.workspace,\n      typeCounts: null,\n    };\n  }\n\n  /**\n   * Returns a bounding box describing the dimensions of this comment.\n   *\n   * @returns Object with height and width properties in workspace units.\n   * @internal\n   */\n  getHeightWidth(): {height: number, width: number} {\n    return {width: this.getWidth(), height: this.getHeight()};\n  }\n\n  /**\n   * Renders the workspace comment.\n   *\n   * @internal\n   */\n  render() {\n    if (this.rendered_) {\n      return;\n    }\n\n    const size = this.getHeightWidth();\n\n    // Add text area\n    this.createEditor_();\n    // AnyDuringMigration because:  Argument of type 'SVGForeignObjectElement |\n    // null' is not assignable to parameter of type 'Node'.\n    this.svgGroup_.appendChild(this.foreignObject_ as AnyDuringMigration);\n\n    this.svgHandleTarget_ = dom.createSvgElement(\n        Svg.RECT, {'class': 'blocklyCommentHandleTarget', 'x': 0, 'y': 0});\n    // AnyDuringMigration because:  Argument of type 'SVGRectElement | null' is\n    // not assignable to parameter of type 'Node'.\n    this.svgGroup_.appendChild(this.svgHandleTarget_ as AnyDuringMigration);\n    this.svgRectTarget_ = dom.createSvgElement(Svg.RECT, {\n      'class': 'blocklyCommentTarget',\n      'x': 0,\n      'y': 0,\n      'rx': BORDER_RADIUS,\n      'ry': BORDER_RADIUS,\n    });\n    // AnyDuringMigration because:  Argument of type 'SVGRectElement | null' is\n    // not assignable to parameter of type 'Node'.\n    this.svgGroup_.appendChild(this.svgRectTarget_ as AnyDuringMigration);\n\n    // Add the resize icon\n    this.addResizeDom_();\n    if (this.isDeletable()) {\n      // Add the delete icon\n      this.addDeleteDom_();\n    }\n\n    this.setSize_(size.width, size.height);\n\n    // Set the content\n    this.textarea_!.value = this.content_;\n\n    this.rendered_ = true;\n\n    if (this.resizeGroup_) {\n      browserEvents.conditionalBind(\n          (this.resizeGroup_), 'pointerdown', this, this.resizeMouseDown_);\n    }\n\n    if (this.isDeletable()) {\n      browserEvents.conditionalBind(\n          this.deleteGroup_ as SVGGElement, 'pointerdown', this,\n          this.deleteMouseDown_);\n      browserEvents.conditionalBind(\n          this.deleteGroup_ as SVGGElement, 'pointerout', this,\n          this.deleteMouseOut_);\n      browserEvents.conditionalBind(\n          this.deleteGroup_ as SVGGElement, 'pointerup', this,\n          this.deleteMouseUp_);\n    }\n  }\n\n  /**\n   * Create the text area for the comment.\n   *\n   * @returns The top-level node of the editor.\n   */\n  private createEditor_(): Element {\n    /* Create the editor.  Here's the markup that will be generated:\n          <foreignObject class=\"blocklyCommentForeignObject\" x=\"0\" y=\"10\"\n          width=\"164\" height=\"164\"> <body xmlns=\"http://www.w3.org/1999/xhtml\"\n          class=\"blocklyMinimalBody\"> <textarea\n       xmlns=\"http://www.w3.org/1999/xhtml\" class=\"blocklyCommentTextarea\"\n                  style=\"height: 164px; width: 164px;\"></textarea>\n            </body>\n          </foreignObject>\n        */\n    this.foreignObject_ = dom.createSvgElement(Svg.FOREIGNOBJECT, {\n      'x': 0,\n      'y': WorkspaceCommentSvg.TOP_OFFSET,\n      'class': 'blocklyCommentForeignObject',\n    });\n    const body = document.createElementNS(dom.HTML_NS, 'body');\n    body.setAttribute('xmlns', dom.HTML_NS);\n    body.className = 'blocklyMinimalBody';\n    const textarea = document.createElementNS(dom.HTML_NS, 'textarea') as\n        HTMLTextAreaElement;\n    textarea.className = 'blocklyCommentTextarea';\n    textarea.setAttribute('dir', this.RTL ? 'RTL' : 'LTR');\n    textarea.readOnly = !this.isEditable();\n    body.appendChild(textarea);\n    this.textarea_ = textarea;\n    this.foreignObject_!.appendChild(body);\n    // Don't zoom with mousewheel.\n    browserEvents.conditionalBind(\n        textarea, 'wheel', this, function(e: AnyDuringMigration) {\n          e.stopPropagation();\n        });\n    browserEvents.conditionalBind(\n        textarea, 'change', this,\n        function(this: WorkspaceCommentSvg, _e: Event) {\n          this.setContent(textarea.value);\n        });\n    // AnyDuringMigration because:  Type 'SVGForeignObjectElement | null' is not\n    // assignable to type 'Element'.\n    return this.foreignObject_ as AnyDuringMigration;\n  }\n\n  /** Add the resize icon to the DOM */\n  private addResizeDom_() {\n    this.resizeGroup_ = dom.createSvgElement(\n        Svg.G, {'class': this.RTL ? 'blocklyResizeSW' : 'blocklyResizeSE'},\n        this.svgGroup_);\n    // AnyDuringMigration because:  Argument of type 'SVGGElement | null' is not\n    // assignable to parameter of type 'Element | undefined'.\n    dom.createSvgElement(\n        Svg.POLYGON,\n        {'points': '0,x x,x x,0'.replace(/x/g, RESIZE_SIZE.toString())},\n        this.resizeGroup_ as AnyDuringMigration);\n    // AnyDuringMigration because:  Argument of type 'SVGGElement | null' is not\n    // assignable to parameter of type 'Element | undefined'.\n    dom.createSvgElement(\n        Svg.LINE, {\n          'class': 'blocklyResizeLine',\n          'x1': RESIZE_SIZE / 3,\n          'y1': RESIZE_SIZE - 1,\n          'x2': RESIZE_SIZE - 1,\n          'y2': RESIZE_SIZE / 3,\n        },\n        this.resizeGroup_ as AnyDuringMigration);\n    // AnyDuringMigration because:  Argument of type 'SVGGElement | null' is not\n    // assignable to parameter of type 'Element | undefined'.\n    dom.createSvgElement(\n        Svg.LINE, {\n          'class': 'blocklyResizeLine',\n          'x1': RESIZE_SIZE * 2 / 3,\n          'y1': RESIZE_SIZE - 1,\n          'x2': RESIZE_SIZE - 1,\n          'y2': RESIZE_SIZE * 2 / 3,\n        },\n        this.resizeGroup_ as AnyDuringMigration);\n  }\n\n  /** Add the delete icon to the DOM */\n  private addDeleteDom_() {\n    this.deleteGroup_ = dom.createSvgElement(\n        Svg.G, {'class': 'blocklyCommentDeleteIcon'}, this.svgGroup_);\n    // AnyDuringMigration because:  Argument of type 'SVGGElement | null' is not\n    // assignable to parameter of type 'Element | undefined'.\n    this.deleteIconBorder_ = dom.createSvgElement(\n        Svg.CIRCLE,\n        {'class': 'blocklyDeleteIconShape', 'r': '7', 'cx': '7.5', 'cy': '7.5'},\n        this.deleteGroup_ as AnyDuringMigration);\n    // x icon.\n    // AnyDuringMigration because:  Argument of type 'SVGGElement | null' is not\n    // assignable to parameter of type 'Element | undefined'.\n    dom.createSvgElement(\n        Svg.LINE, {\n          'x1': '5',\n          'y1': '10',\n          'x2': '10',\n          'y2': '5',\n          'stroke': '#fff',\n          'stroke-width': '2',\n        },\n        this.deleteGroup_ as AnyDuringMigration);\n    // AnyDuringMigration because:  Argument of type 'SVGGElement | null' is not\n    // assignable to parameter of type 'Element | undefined'.\n    dom.createSvgElement(\n        Svg.LINE, {\n          'x1': '5',\n          'y1': '5',\n          'x2': '10',\n          'y2': '10',\n          'stroke': '#fff',\n          'stroke-width': '2',\n        },\n        this.deleteGroup_ as AnyDuringMigration);\n  }\n\n  /**\n   * Handle a pointerdown on comment's resize corner.\n   *\n   * @param e Pointer down event.\n   */\n  private resizeMouseDown_(e: PointerEvent) {\n    this.unbindDragEvents_();\n    if (browserEvents.isRightButton(e)) {\n      // No right-click.\n      e.stopPropagation();\n      return;\n    }\n    // Left-click (or middle click)\n    this.workspace.startDrag(\n        e,\n        new Coordinate(\n            this.workspace.RTL ? -this.width_ : this.width_, this.height_));\n\n    this.onMouseUpWrapper_ = browserEvents.conditionalBind(\n        document, 'pointerup', this, this.resizeMouseUp_);\n    this.onMouseMoveWrapper_ = browserEvents.conditionalBind(\n        document, 'pointermove', this, this.resizeMouseMove_);\n    this.workspace.hideChaff();\n    // This event has been handled.  No need to bubble up to the document.\n    e.stopPropagation();\n  }\n\n  /**\n   * Handle a pointerdown on comment's delete icon.\n   *\n   * @param e Pointer down event.\n   */\n  private deleteMouseDown_(e: PointerEvent) {\n    // Highlight the delete icon.\n    if (this.deleteIconBorder_) {\n      dom.addClass(this.deleteIconBorder_, 'blocklyDeleteIconHighlighted');\n    }\n    // This event has been handled.  No need to bubble up to the document.\n    e.stopPropagation();\n  }\n\n  /**\n   * Handle a pointerout on comment's delete icon.\n   *\n   * @param _e Pointer out event.\n   */\n  private deleteMouseOut_(_e: PointerEvent) {\n    // Restore highlight on the delete icon.\n    if (this.deleteIconBorder_) {\n      dom.removeClass(this.deleteIconBorder_, 'blocklyDeleteIconHighlighted');\n    }\n  }\n\n  /**\n   * Handle a pointerup on comment's delete icon.\n   *\n   * @param e Pointer up event.\n   */\n  private deleteMouseUp_(e: PointerEvent) {\n    // Delete this comment.\n    this.dispose();\n    // This event has been handled.  No need to bubble up to the document.\n    e.stopPropagation();\n  }\n\n  /** Stop binding to the global pointerup and pointermove events. */\n  private unbindDragEvents_() {\n    if (this.onMouseUpWrapper_) {\n      browserEvents.unbind(this.onMouseUpWrapper_);\n      this.onMouseUpWrapper_ = null;\n    }\n    if (this.onMouseMoveWrapper_) {\n      browserEvents.unbind(this.onMouseMoveWrapper_);\n      this.onMouseMoveWrapper_ = null;\n    }\n  }\n\n  /**\n   * Handle a pointerup event while dragging a comment's border or resize\n   * handle.\n   *\n   * @param _e Pointer up event.\n   */\n  private resizeMouseUp_(_e: PointerEvent) {\n    Touch.clearTouchIdentifier();\n    this.unbindDragEvents_();\n  }\n\n  /**\n   * Resize this comment to follow the pointer.\n   *\n   * @param e Pointer move event.\n   */\n  private resizeMouseMove_(e: PointerEvent) {\n    this.autoLayout_ = false;\n    const newXY = this.workspace.moveDrag(e);\n    this.setSize_(this.RTL ? -newXY.x : newXY.x, newXY.y);\n  }\n\n  /**\n   * Callback function triggered when the comment has resized.\n   * Resize the text area accordingly.\n   */\n  private resizeComment_() {\n    const size = this.getHeightWidth();\n    const topOffset = WorkspaceCommentSvg.TOP_OFFSET;\n    const textOffset = TEXTAREA_OFFSET * 2;\n\n    // AnyDuringMigration because:  Argument of type 'number' is not assignable\n    // to parameter of type 'string'.\n    this.foreignObject_!.setAttribute(\n        'width', size.width as AnyDuringMigration);\n    this.foreignObject_!.setAttribute(\n        'height', (size.height - topOffset).toString());\n    if (this.RTL) {\n      this.foreignObject_!.setAttribute('x', (-size.width).toString());\n    }\n    this.textarea_!.style.width = size.width - textOffset + 'px';\n    this.textarea_!.style.height = size.height - textOffset - topOffset + 'px';\n  }\n\n  /**\n   * Set size\n   *\n   * @param width width of the container\n   * @param height height of the container\n   */\n  private setSize_(width: number, height: number) {\n    // Minimum size of a comment.\n    width = Math.max(width, 45);\n    height = Math.max(height, 20 + WorkspaceCommentSvg.TOP_OFFSET);\n    this.width_ = width;\n    this.height_ = height;\n    this.svgRect_.setAttribute('width', width);\n    this.svgRect_.setAttribute('height', height);\n    // AnyDuringMigration because:  Argument of type 'number' is not assignable\n    // to parameter of type 'string'.\n    this.svgRectTarget_!.setAttribute('width', width as AnyDuringMigration);\n    // AnyDuringMigration because:  Argument of type 'number' is not assignable\n    // to parameter of type 'string'.\n    this.svgRectTarget_!.setAttribute('height', height as AnyDuringMigration);\n    // AnyDuringMigration because:  Argument of type 'number' is not assignable\n    // to parameter of type 'string'.\n    this.svgHandleTarget_!.setAttribute('width', width as AnyDuringMigration);\n    // AnyDuringMigration because:  Argument of type 'number' is not assignable\n    // to parameter of type 'string'.\n    this.svgHandleTarget_!.setAttribute(\n        'height', WorkspaceCommentSvg.TOP_OFFSET as AnyDuringMigration);\n    if (this.RTL) {\n      this.svgRect_.setAttribute('transform', 'scale(-1 1)');\n      this.svgRectTarget_!.setAttribute('transform', 'scale(-1 1)');\n    }\n\n    if (this.resizeGroup_) {\n      if (this.RTL) {\n        // Mirror the resize group.\n        this.resizeGroup_.setAttribute(\n            'transform',\n            'translate(' + (-width + RESIZE_SIZE) + ',' +\n                (height - RESIZE_SIZE) + ') scale(-1 1)');\n        this.deleteGroup_!.setAttribute(\n            'transform',\n            'translate(' + (-width + RESIZE_SIZE) + ',' + -RESIZE_SIZE +\n                ') scale(-1 1)');\n      } else {\n        this.resizeGroup_.setAttribute(\n            'transform',\n            'translate(' + (width - RESIZE_SIZE) + ',' +\n                (height - RESIZE_SIZE) + ')');\n        this.deleteGroup_!.setAttribute(\n            'transform',\n            'translate(' + (width - RESIZE_SIZE) + ',' + -RESIZE_SIZE + ')');\n      }\n    }\n\n    // Allow the contents to resize.\n    this.resizeComment_();\n  }\n\n  /** Dispose of any rendered comment components. */\n  private disposeInternal_() {\n    this.textarea_ = null;\n    this.foreignObject_ = null;\n    this.svgRectTarget_ = null;\n    this.svgHandleTarget_ = null;\n    this.disposed_ = true;\n  }\n\n  /**\n   * Set the focus on the text area.\n   *\n   * @internal\n   */\n  setFocus() {\n    this.focused_ = true;\n    // Defer CSS changes.\n    setTimeout(() => {\n      if (this.disposed_) {\n        return;\n      }\n      this.textarea_!.focus();\n      this.addFocus();\n      if (this.svgRectTarget_) {\n        dom.addClass(this.svgRectTarget_, 'blocklyCommentTargetFocused');\n      }\n      if (this.svgHandleTarget_) {\n        dom.addClass(\n            this.svgHandleTarget_, 'blocklyCommentHandleTargetFocused');\n      }\n    }, 0);\n  }\n\n  /**\n   * Remove focus from the text area.\n   *\n   * @internal\n   */\n  blurFocus() {\n    this.focused_ = false;\n    // Defer CSS changes.\n    setTimeout(() => {\n      if (this.disposed_) {\n        return;\n      }\n\n      this.textarea_!.blur();\n      this.removeFocus();\n      if (this.svgRectTarget_) {\n        dom.removeClass(this.svgRectTarget_, 'blocklyCommentTargetFocused');\n      }\n      if (this.svgHandleTarget_) {\n        dom.removeClass(\n            this.svgHandleTarget_, 'blocklyCommentHandleTargetFocused');\n      }\n    }, 0);\n  }\n\n  /**\n   * Decode an XML comment tag and create a rendered comment on the workspace.\n   *\n   * @param xmlComment XML comment element.\n   * @param workspace The workspace.\n   * @param opt_wsWidth The width of the workspace, which is used to position\n   *     comments correctly in RTL.\n   * @returns The created workspace comment.\n   * @internal\n   */\n  static fromXmlRendered(\n      xmlComment: Element, workspace: WorkspaceSvg,\n      opt_wsWidth?: number): WorkspaceCommentSvg {\n    eventUtils.disable();\n    let comment;\n    try {\n      const info = WorkspaceComment.parseAttributes(xmlComment);\n\n      comment = new WorkspaceCommentSvg(\n          workspace, info.content, info.h, info.w, info.id);\n      if (workspace.rendered) {\n        comment.initSvg(true);\n        comment.render();\n      }\n      // Position the comment correctly, taking into account the width of a\n      // rendered RTL workspace.\n      if (!isNaN(info.x) && !isNaN(info.y)) {\n        if (workspace.RTL) {\n          const wsWidth = opt_wsWidth || workspace.getWidth();\n          comment.moveBy(wsWidth - info.x, info.y);\n        } else {\n          comment.moveBy(info.x, info.y);\n        }\n      }\n    } finally {\n      eventUtils.enable();\n    }\n\n    WorkspaceComment.fireCreateEvent((comment));\n    return comment;\n  }\n}\n\n/** CSS for workspace comment.  See css.js for use. */\nCss.register(`\n.blocklyCommentForeignObject {\n  position: relative;\n  z-index: 0;\n}\n\n.blocklyCommentRect {\n  fill: #E7DE8E;\n  stroke: #bcA903;\n  stroke-width: 1px;\n}\n\n.blocklyCommentTarget {\n  fill: transparent;\n  stroke: #bcA903;\n}\n\n.blocklyCommentTargetFocused {\n  fill: none;\n}\n\n.blocklyCommentHandleTarget {\n  fill: none;\n}\n\n.blocklyCommentHandleTargetFocused {\n  fill: transparent;\n}\n\n.blocklyFocused>.blocklyCommentRect {\n  fill: #B9B272;\n  stroke: #B9B272;\n}\n\n.blocklySelected>.blocklyCommentTarget {\n  stroke: #fc3;\n  stroke-width: 3px;\n}\n\n.blocklyCommentDeleteIcon {\n  cursor: pointer;\n  fill: #000;\n  display: none;\n}\n\n.blocklySelected > .blocklyCommentDeleteIcon {\n  display: block;\n}\n\n.blocklyDeleteIconShape {\n  fill: #000;\n  stroke: #000;\n  stroke-width: 1px;\n}\n\n.blocklyDeleteIconShape.blocklyDeleteIconHighlighted {\n  stroke: #fc3;\n}\n`);\n","/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Base class for all types of block events.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events.BlockBase');\n\nimport type {Block} from '../block.js';\nimport * as deprecation from '../utils/deprecation.js';\nimport type {Workspace} from '../workspace.js';\n\nimport {Abstract as AbstractEvent, AbstractEventJson} from './events_abstract.js';\n\n\n/**\n * Abstract class for a block event.\n *\n * @alias Blockly.Events.BlockBase\n */\nexport class BlockBase extends AbstractEvent {\n  override isBlank = true;\n  blockId?: string;\n\n  /**\n   * @param opt_block The block this event corresponds to.\n   *     Undefined for a blank event.\n   */\n  constructor(opt_block?: Block) {\n    super();\n    this.isBlank = !opt_block;\n\n    if (!opt_block) return;\n\n    /** The block ID for the block this event pertains to */\n    this.blockId = opt_block.id;\n\n    /** The workspace identifier for this event. */\n    this.workspaceId = opt_block.workspace.id;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): BlockBaseJson {\n    const json = super.toJson() as BlockBaseJson;\n    if (!this.blockId) {\n      throw new Error(\n          'The block ID is undefined. Either pass a block to ' +\n          'the constructor, or call fromJson');\n    }\n    json['blockId'] = this.blockId;\n    return json;\n  }\n\n  /**\n   * Decode the JSON event.\n   *\n   * @param json JSON representation.\n   */\n  override fromJson(json: BlockBaseJson) {\n    deprecation.warn(\n        'Blockly.Events.BlockBase.prototype.fromJson', 'version 9',\n        'version 10', 'Blockly.Events.fromJson');\n    super.fromJson(json);\n    this.blockId = json['blockId'];\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of BlockBase, but we can't specify that due to the fact that parameters\n   *     to static methods in subclasses must be supertypes of parameters to\n   *     static methods in superclasses.\n   * @internal\n   */\n  static fromJson(json: BlockBaseJson, workspace: Workspace, event?: any):\n      BlockBase {\n    const newEvent =\n        super.fromJson(json, workspace, event ?? new BlockBase()) as BlockBase;\n    newEvent.blockId = json['blockId'];\n    return newEvent;\n  }\n}\n\nexport interface BlockBaseJson extends AbstractEventJson {\n  blockId: string;\n}\n","/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for a block change event.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events.BlockChange');\n\nimport type {Block} from '../block.js';\nimport type {BlockSvg} from '../block_svg.js';\nimport * as deprecation from '../utils/deprecation.js';\nimport * as registry from '../registry.js';\nimport {Workspace} from '../workspace.js';\nimport * as Xml from '../xml.js';\n\nimport {BlockBase, BlockBaseJson} from './events_block_base.js';\nimport * as eventUtils from './utils.js';\n\n\n/**\n * Class for a block change event.\n *\n * @alias Blockly.Events.BlockChange\n */\nexport class BlockChange extends BlockBase {\n  override type = eventUtils.BLOCK_CHANGE;\n  element?: string;\n  name?: string;\n  oldValue: unknown;\n  newValue: unknown;\n\n  /**\n   * @param opt_block The changed block.  Undefined for a blank event.\n   * @param opt_element One of 'field', 'comment', 'disabled', etc.\n   * @param opt_name Name of input or field affected, or null.\n   * @param opt_oldValue Previous value of element.\n   * @param opt_newValue New value of element.\n   */\n  constructor(\n      opt_block?: Block, opt_element?: string, opt_name?: string|null,\n      opt_oldValue?: unknown, opt_newValue?: unknown) {\n    super(opt_block);\n\n    if (!opt_block) {\n      return;  // Blank event to be populated by fromJson.\n    }\n    this.element = opt_element;\n    this.name = opt_name || undefined;\n    this.oldValue = opt_oldValue;\n    this.newValue = opt_newValue;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): BlockChangeJson {\n    const json = super.toJson() as BlockChangeJson;\n    if (!this.element) {\n      throw new Error(\n          'The changed element is undefined. Either pass an ' +\n          'element to the constructor, or call fromJson');\n    }\n    json['element'] = this.element;\n    json['name'] = this.name;\n    json['oldValue'] = this.oldValue;\n    json['newValue'] = this.newValue;\n    return json;\n  }\n\n  /**\n   * Decode the JSON event.\n   *\n   * @param json JSON representation.\n   */\n  override fromJson(json: BlockChangeJson) {\n    deprecation.warn(\n        'Blockly.Events.BlockChange.prototype.fromJson', 'version 9',\n        'version 10', 'Blockly.Events.fromJson');\n    super.fromJson(json);\n    this.element = json['element'];\n    this.name = json['name'];\n    this.oldValue = json['oldValue'];\n    this.newValue = json['newValue'];\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of BlockChange, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(json: BlockChangeJson, workspace: Workspace, event?: any):\n      BlockChange {\n    const newEvent =\n        super.fromJson(json, workspace, event ?? new BlockChange()) as\n        BlockChange;\n    newEvent.element = json['element'];\n    newEvent.name = json['name'];\n    newEvent.oldValue = json['oldValue'];\n    newEvent.newValue = json['newValue'];\n    return newEvent;\n  }\n\n  /**\n   * Does this event record any change of state?\n   *\n   * @returns False if something changed.\n   */\n  override isNull(): boolean {\n    return this.oldValue === this.newValue;\n  }\n\n  /**\n   * Run a change event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    const workspace = this.getEventWorkspace_();\n    if (!this.blockId) {\n      throw new Error(\n          'The block ID is undefined. Either pass a block to ' +\n          'the constructor, or call fromJson');\n    }\n    const block = workspace.getBlockById(this.blockId);\n    if (!block) {\n      throw new Error(\n          'The associated block is undefined. Either pass a ' +\n          'block to the constructor, or call fromJson');\n    }\n    // Assume the block is rendered so that then we can check.\n    const blockSvg = block as BlockSvg;\n    if (blockSvg.mutator) {\n      // Close the mutator (if open) since we don't want to update it.\n      blockSvg.mutator.setVisible(false);\n    }\n    const value = forward ? this.newValue : this.oldValue;\n    switch (this.element) {\n      case 'field': {\n        const field = block.getField(this.name!);\n        if (field) {\n          field.setValue(value);\n        } else {\n          console.warn('Can\\'t set non-existent field: ' + this.name);\n        }\n        break;\n      }\n      case 'comment':\n        block.setCommentText(value as string || null);\n        break;\n      case 'collapsed':\n        block.setCollapsed(!!value);\n        break;\n      case 'disabled':\n        block.setEnabled(!value);\n        break;\n      case 'inline':\n        block.setInputsInline(!!value);\n        break;\n      case 'mutation': {\n        const oldState = BlockChange.getExtraBlockState_(block as BlockSvg);\n        if (block.loadExtraState) {\n          block.loadExtraState(JSON.parse(value as string || '{}'));\n        } else if (block.domToMutation) {\n          block.domToMutation(Xml.textToDom(value as string || '<mutation/>'));\n        }\n        eventUtils.fire(\n            new BlockChange(block, 'mutation', null, oldState, value));\n        break;\n      }\n      default:\n        console.warn('Unknown change type: ' + this.element);\n    }\n  }\n\n  // TODO (#5397): Encapsulate this in the BlocklyMutationChange event when\n  //    refactoring change events.\n  /**\n   * Returns the extra state of the given block (either as XML or a JSO,\n   * depending on the block's definition).\n   *\n   * @param block The block to get the extra state of.\n   * @returns A stringified version of the extra state of the given block.\n   * @internal\n   */\n  static getExtraBlockState_(block: BlockSvg): string {\n    if (block.saveExtraState) {\n      const state = block.saveExtraState();\n      return state ? JSON.stringify(state) : '';\n    } else if (block.mutationToDom) {\n      const state = block.mutationToDom();\n      return state ? Xml.domToText(state) : '';\n    }\n    return '';\n  }\n}\n\nexport interface BlockChangeJson extends BlockBaseJson {\n  element: string;\n  name?: string;\n  newValue: unknown;\n  oldValue: unknown;\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.CHANGE, BlockChange);\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object in charge of managing markers and the cursor.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.MarkerManager');\n\nimport type {Cursor} from './keyboard_nav/cursor.js';\nimport type {Marker} from './keyboard_nav/marker.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/**\n * Class to manage the multiple markers and the cursor on a workspace.\n *\n * @alias Blockly.MarkerManager\n */\nexport class MarkerManager {\n  /** The name of the local marker. */\n  static readonly LOCAL_MARKER = 'local_marker_1';\n\n  /** The cursor. */\n  private cursor_: Cursor|null = null;\n\n  /** The cursor's SVG element. */\n  private cursorSvg_: SVGElement|null = null;\n\n  /** The map of markers for the workspace. */\n  private markers = new Map<string, Marker>();\n\n  /** The marker's SVG element. */\n  private markerSvg_: SVGElement|null = null;\n\n  /**\n   * @param workspace The workspace for the marker manager.\n   * @internal\n   */\n  constructor(private readonly workspace: WorkspaceSvg) {}\n\n  /**\n   * Register the marker by adding it to the map of markers.\n   *\n   * @param id A unique identifier for the marker.\n   * @param marker The marker to register.\n   */\n  registerMarker(id: string, marker: Marker) {\n    if (this.markers.has(id)) {\n      this.unregisterMarker(id);\n    }\n    marker.setDrawer(\n        this.workspace.getRenderer().makeMarkerDrawer(this.workspace, marker));\n    this.setMarkerSvg(marker.getDrawer().createDom());\n    this.markers.set(id, marker);\n  }\n\n  /**\n   * Unregister the marker by removing it from the map of markers.\n   *\n   * @param id The ID of the marker to unregister.\n   */\n  unregisterMarker(id: string) {\n    const marker = this.markers.get(id);\n    if (marker) {\n      marker.dispose();\n      this.markers.delete(id);\n    } else {\n      throw Error(\n          'Marker with ID ' + id + ' does not exist. ' +\n          'Can only unregister markers that exist.');\n    }\n  }\n\n  /**\n   * Get the cursor for the workspace.\n   *\n   * @returns The cursor for this workspace.\n   */\n  getCursor(): Cursor|null {\n    return this.cursor_;\n  }\n\n  /**\n   * Get a single marker that corresponds to the given ID.\n   *\n   * @param id A unique identifier for the marker.\n   * @returns The marker that corresponds to the given ID, or null if none\n   *     exists.\n   */\n  getMarker(id: string): Marker|null {\n    return this.markers.get(id) || null;\n  }\n\n  /**\n   * Sets the cursor and initializes the drawer for use with keyboard\n   * navigation.\n   *\n   * @param cursor The cursor used to move around this workspace.\n   */\n  setCursor(cursor: Cursor) {\n    if (this.cursor_ && this.cursor_.getDrawer()) {\n      this.cursor_.getDrawer().dispose();\n    }\n    this.cursor_ = cursor;\n    if (this.cursor_) {\n      const drawer = this.workspace.getRenderer().makeMarkerDrawer(\n          this.workspace, this.cursor_);\n      this.cursor_.setDrawer(drawer);\n      this.setCursorSvg(this.cursor_.getDrawer().createDom());\n    }\n  }\n\n  /**\n   * Add the cursor SVG to this workspace SVG group.\n   *\n   * @param cursorSvg The SVG root of the cursor to be added to the workspace\n   *     SVG group.\n   * @internal\n   */\n  setCursorSvg(cursorSvg: SVGElement|null) {\n    if (!cursorSvg) {\n      this.cursorSvg_ = null;\n      return;\n    }\n\n    this.workspace.getBlockCanvas()!.appendChild(cursorSvg);\n    this.cursorSvg_ = cursorSvg;\n  }\n\n  /**\n   * Add the marker SVG to this workspaces SVG group.\n   *\n   * @param markerSvg The SVG root of the marker to be added to the workspace\n   *     SVG group.\n   * @internal\n   */\n  setMarkerSvg(markerSvg: SVGElement|null) {\n    if (!markerSvg) {\n      this.markerSvg_ = null;\n      return;\n    }\n\n    if (this.workspace.getBlockCanvas()) {\n      if (this.cursorSvg_) {\n        this.workspace.getBlockCanvas()!.insertBefore(\n            markerSvg, this.cursorSvg_);\n      } else {\n        this.workspace.getBlockCanvas()!.appendChild(markerSvg);\n      }\n    }\n  }\n\n  /**\n   * Redraw the attached cursor SVG if needed.\n   *\n   * @internal\n   */\n  updateMarkers() {\n    if (this.workspace.keyboardAccessibilityMode && this.cursorSvg_) {\n      this.workspace.getCursor()!.draw();\n    }\n  }\n\n  /**\n   * Dispose of the marker manager.\n   * Go through and delete all markers associated with this marker manager.\n   *\n   * @suppress {checkTypes}\n   * @internal\n   */\n  dispose() {\n    const markerIds = Object.keys(this.markers);\n    for (let i = 0, markerId; markerId = markerIds[i]; i++) {\n      this.unregisterMarker(markerId);\n    }\n    this.markers.clear();\n    if (this.cursor_) {\n      this.cursor_.dispose();\n      this.cursor_ = null;\n    }\n  }\n}\n","/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * A type used to create flag values.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.utils.Sentinel');\n\n\n/**\n * A type used to create flag values.\n *\n * @alias Blockly.utils.Sentinel\n */\nexport class Sentinel {}\n","/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Field.  Used for editable titles, variables, etc.\n * This is an abstract class that defines the UI on the block.  Actual\n * instances would be FieldTextInput, FieldDropdown, etc.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Field');\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_change.js';\n\nimport type {Block} from './block.js';\nimport type {BlockSvg} from './block_svg.js';\nimport * as browserEvents from './browser_events.js';\nimport * as dropDownDiv from './dropdowndiv.js';\nimport * as eventUtils from './events/utils.js';\nimport type {Input} from './input.js';\nimport type {IASTNodeLocationSvg} from './interfaces/i_ast_node_location_svg.js';\nimport type {IASTNodeLocationWithBlock} from './interfaces/i_ast_node_location_with_block.js';\nimport type {IKeyboardAccessible} from './interfaces/i_keyboard_accessible.js';\nimport type {IRegistrable} from './interfaces/i_registrable.js';\nimport {MarkerManager} from './marker_manager.js';\nimport type {ConstantProvider} from './renderers/common/constants.js';\nimport type {KeyboardShortcut} from './shortcut_registry.js';\nimport * as Tooltip from './tooltip.js';\nimport type {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport * as parsing from './utils/parsing.js';\nimport {Rect} from './utils/rect.js';\nimport {Sentinel} from './utils/sentinel.js';\nimport {Size} from './utils/size.js';\nimport * as style from './utils/style.js';\nimport {Svg} from './utils/svg.js';\nimport * as userAgent from './utils/useragent.js';\nimport * as utilsXml from './utils/xml.js';\nimport * as WidgetDiv from './widgetdiv.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\nimport * as Xml from './xml.js';\n\nexport type FieldValidator<T = any> = (value?: T) => T|null|undefined;\n\n/**\n * Abstract class for an editable field.\n *\n * @alias Blockly.Field\n */\nexport abstract class Field<T = any> implements IASTNodeLocationSvg,\n                                                IASTNodeLocationWithBlock,\n                                                IKeyboardAccessible,\n                                                IRegistrable {\n  /**\n   * To overwrite the default value which is set in **Field**, directly update\n   * the prototype.\n   *\n   * Example:\n   * ```typescript\n   * FieldImage.prototype.DEFAULT_VALUE = null;\n   * ```\n   */\n  DEFAULT_VALUE: T|null = null;\n\n  /** Non-breaking space. */\n  static readonly NBSP = '\\u00A0';\n\n  /**\n   * A value used to signal when a field's constructor should *not* set the\n   * field's value or run configure_, and should allow a subclass to do that\n   * instead.\n   */\n  static readonly SKIP_SETUP = new Sentinel();\n\n  /**\n   * Name of field.  Unique within each block.\n   * Static labels are usually unnamed.\n   */\n  name?: string = undefined;\n  protected value_: T|null;\n\n  /** Validation function called when user edits an editable field. */\n  protected validator_: FieldValidator<T>|null = null;\n\n  /**\n   * Used to cache the field's tooltip value if setTooltip is called when the\n   * field is not yet initialized. Is *not* guaranteed to be accurate.\n   */\n  private tooltip_: Tooltip.TipInfo|null = null;\n  protected size_: Size;\n\n  /**\n   * Holds the cursors svg element when the cursor is attached to the field.\n   * This is null if there is no cursor on the field.\n   */\n  private cursorSvg_: SVGElement|null = null;\n\n  /**\n   * Holds the markers svg element when the marker is attached to the field.\n   * This is null if there is no marker on the field.\n   */\n  private markerSvg_: SVGElement|null = null;\n\n  /** The rendered field's SVG group element. */\n  protected fieldGroup_: SVGGElement|null = null;\n\n  /** The rendered field's SVG border element. */\n  protected borderRect_: SVGRectElement|null = null;\n\n  /** The rendered field's SVG text element. */\n  protected textElement_: SVGTextElement|null = null;\n\n  /** The rendered field's text content element. */\n  protected textContent_: Text|null = null;\n\n  /** Mouse down event listener data. */\n  private mouseDownWrapper_: browserEvents.Data|null = null;\n\n  /** Constants associated with the source block's renderer. */\n  protected constants_: ConstantProvider|null = null;\n\n  /**\n   * Has this field been disposed of?\n   *\n   * @internal\n   */\n  disposed = false;\n\n  /** Maximum characters of text to display before adding an ellipsis. */\n  maxDisplayLength = 50;\n\n  /** Block this field is attached to.  Starts as null, then set in init. */\n  protected sourceBlock_: Block|null = null;\n\n  /** Does this block need to be re-rendered? */\n  protected isDirty_ = true;\n\n  /** Is the field visible, or hidden due to the block being collapsed? */\n  protected visible_ = true;\n\n  /**\n   * Can the field value be changed using the editor on an editable block?\n   */\n  protected enabled_ = true;\n\n  /** The element the click handler is bound to. */\n  protected clickTarget_: Element|null = null;\n\n  /**\n   * The prefix field.\n   *\n   * @internal\n   */\n  prefixField: string|null = null;\n\n  /**\n   * The suffix field.\n   *\n   * @internal\n   */\n  suffixField: string|null = null;\n\n  /**\n   * Editable fields usually show some sort of UI indicating they are\n   * editable. They will also be saved by the serializer.\n   */\n  EDITABLE = true;\n\n  /**\n   * Serializable fields are saved by the serializer, non-serializable fields\n   * are not. Editable fields should also be serializable. This is not the\n   * case by default so that SERIALIZABLE is backwards compatible.\n   */\n  SERIALIZABLE = false;\n\n  /** Mouse cursor style when over the hotspot that initiates the editor. */\n  CURSOR = '';\n\n  /**\n   * @param value The initial value of the field.\n   *     Also accepts Field.SKIP_SETUP if you wish to skip setup (only used by\n   * subclasses that want to handle configuration and setting the field value\n   * after their own constructors have run).\n   * @param opt_validator  A function that is called to validate changes to the\n   *     field's value. Takes in a value & returns a validated value, or null to\n   *     abort the change.\n   * @param opt_config A map of options used to configure the field.\n   *    Refer to the individual field's documentation for a list of properties\n   * this parameter supports.\n   */\n  constructor(\n      value: T|Sentinel, opt_validator?: FieldValidator<T>|null,\n      opt_config?: FieldConfig) {\n    /**\n     * A generic value possessed by the field.\n     * Should generally be non-null, only null when the field is created.\n     */\n    this.value_ = 'DEFAULT_VALUE' in new.target.prototype ?\n        new.target.prototype.DEFAULT_VALUE :\n        this.DEFAULT_VALUE;\n\n    /** The size of the area rendered by the field. */\n    this.size_ = new Size(0, 0);\n\n    if (value === Field.SKIP_SETUP) {\n      return;\n    }\n    if (opt_config) {\n      this.configure_(opt_config);\n    }\n    this.setValue(value);\n    if (opt_validator) {\n      this.setValidator(opt_validator);\n    }\n  }\n\n  /**\n   * Process the configuration map passed to the field.\n   *\n   * @param config A map of options used to configure the field. See the\n   *     individual field's documentation for a list of properties this\n   *     parameter supports.\n   */\n  protected configure_(config: FieldConfig) {\n    // TODO (#2884): Possibly add CSS class config option.\n    // TODO (#2885): Possibly add cursor config option.\n    if (config.tooltip) {\n      this.setTooltip(parsing.replaceMessageReferences(config.tooltip));\n    }\n  }\n\n  /**\n   * Attach this field to a block.\n   *\n   * @param block The block containing this field.\n   */\n  setSourceBlock(block: Block) {\n    if (this.sourceBlock_) {\n      throw Error('Field already bound to a block');\n    }\n    this.sourceBlock_ = block;\n  }\n\n  /**\n   * Get the renderer constant provider.\n   *\n   * @returns The renderer constant provider.\n   */\n  getConstants(): ConstantProvider|null {\n    if (!this.constants_ && this.sourceBlock_ &&\n        !this.sourceBlock_.isDeadOrDying() &&\n        this.sourceBlock_.workspace.rendered) {\n      this.constants_ = (this.sourceBlock_.workspace as WorkspaceSvg)\n                            .getRenderer()\n                            .getConstants();\n    }\n    return this.constants_;\n  }\n\n  /**\n   * Get the block this field is attached to.\n   *\n   * @returns The block containing this field.\n   * @throws An error if the source block is not defined.\n   */\n  getSourceBlock(): Block|null {\n    return this.sourceBlock_;\n  }\n\n  /**\n   * Initialize everything to render this field. Override\n   * methods initModel and initView rather than this method.\n   *\n   * @sealed\n   * @internal\n   */\n  init() {\n    if (this.fieldGroup_) {\n      // Field has already been initialized once.\n      return;\n    }\n    this.fieldGroup_ = dom.createSvgElement(Svg.G, {});\n    if (!this.isVisible()) {\n      this.fieldGroup_.style.display = 'none';\n    }\n    const sourceBlockSvg = this.sourceBlock_ as BlockSvg;\n    sourceBlockSvg.getSvgRoot().appendChild(this.fieldGroup_);\n    this.initView();\n    this.updateEditable();\n    this.setTooltip(this.tooltip_);\n    this.bindEvents_();\n    this.initModel();\n  }\n\n  /**\n   * Create the block UI for this field.\n   *\n   * @internal\n   */\n  initView() {\n    this.createBorderRect_();\n    this.createTextElement_();\n  }\n\n  /**\n   * Initializes the model of the field after it has been installed on a block.\n   * No-op by default.\n   *\n   * @internal\n   */\n  initModel() {}\n\n  /**\n   * Create a field border rect element. Not to be overridden by subclasses.\n   * Instead modify the result of the function inside initView, or create a\n   * separate function to call.\n   */\n  protected createBorderRect_() {\n    this.borderRect_ = dom.createSvgElement(\n        Svg.RECT, {\n          'rx': this.getConstants()!.FIELD_BORDER_RECT_RADIUS,\n          'ry': this.getConstants()!.FIELD_BORDER_RECT_RADIUS,\n          'x': 0,\n          'y': 0,\n          'height': this.size_.height,\n          'width': this.size_.width,\n          'class': 'blocklyFieldRect',\n        },\n        this.fieldGroup_);\n  }\n\n  /**\n   * Create a field text element. Not to be overridden by subclasses. Instead\n   * modify the result of the function inside initView, or create a separate\n   * function to call.\n   */\n  protected createTextElement_() {\n    this.textElement_ = dom.createSvgElement(\n        Svg.TEXT, {\n          'class': 'blocklyText',\n        },\n        this.fieldGroup_);\n    if (this.getConstants()!.FIELD_TEXT_BASELINE_CENTER) {\n      this.textElement_.setAttribute('dominant-baseline', 'central');\n    }\n    this.textContent_ = document.createTextNode('');\n    this.textElement_.appendChild(this.textContent_);\n  }\n\n  /**\n   * Bind events to the field. Can be overridden by subclasses if they need to\n   * do custom input handling.\n   */\n  protected bindEvents_() {\n    const clickTarget = this.getClickTarget_();\n    if (!clickTarget) throw new Error('A click target has not been set.');\n    Tooltip.bindMouseEvents(clickTarget);\n    this.mouseDownWrapper_ = browserEvents.conditionalBind(\n        clickTarget, 'pointerdown', this, this.onMouseDown_);\n  }\n\n  /**\n   * Sets the field's value based on the given XML element. Should only be\n   * called by Blockly.Xml.\n   *\n   * @param fieldElement The element containing info about the field's state.\n   * @internal\n   */\n  fromXml(fieldElement: Element) {\n    this.setValue(fieldElement.textContent);\n  }\n\n  /**\n   * Serializes this field's value to XML. Should only be called by Blockly.Xml.\n   *\n   * @param fieldElement The element to populate with info about the field's\n   *     state.\n   * @returns The element containing info about the field's state.\n   * @internal\n   */\n  toXml(fieldElement: Element): Element {\n    fieldElement.textContent = this.getValue();\n    return fieldElement;\n  }\n\n  /**\n   * Saves this fields value as something which can be serialized to JSON.\n   * Should only be called by the serialization system.\n   *\n   * @param _doFullSerialization If true, this signals to the field that if it\n   *     normally just saves a reference to some state (eg variable fields) it\n   *     should instead serialize the full state of the thing being referenced.\n   * @returns JSON serializable state.\n   * @internal\n   */\n  saveState(_doFullSerialization?: boolean): AnyDuringMigration {\n    const legacyState = this.saveLegacyState(Field);\n    if (legacyState !== null) {\n      return legacyState;\n    }\n    return this.getValue();\n  }\n\n  /**\n   * Sets the field's state based on the given state value. Should only be\n   * called by the serialization system.\n   *\n   * @param state The state we want to apply to the field.\n   * @internal\n   */\n  loadState(state: AnyDuringMigration) {\n    if (this.loadLegacyState(Field, state)) {\n      return;\n    }\n    this.setValue(state);\n  }\n\n  /**\n   * Returns a stringified version of the XML state, if it should be used.\n   * Otherwise this returns null, to signal the field should use its own\n   * serialization.\n   *\n   * @param callingClass The class calling this method.\n   *     Used to see if `this` has overridden any relevant hooks.\n   * @returns The stringified version of the XML state, or null.\n   */\n  protected saveLegacyState(callingClass: FieldProto): string|null {\n    if (callingClass.prototype.saveState === this.saveState &&\n        callingClass.prototype.toXml !== this.toXml) {\n      const elem = utilsXml.createElement('field');\n      elem.setAttribute('name', this.name || '');\n      const text = Xml.domToText(this.toXml(elem));\n      return text.replace(\n          ' xmlns=\"https://developers.google.com/blockly/xml\"', '');\n    }\n    // Either they called this on purpose from their saveState, or they have\n    // no implementations of either hook. Just do our thing.\n    return null;\n  }\n\n  /**\n   * Loads the given state using either the old XML hooks, if they should be\n   * used. Returns true to indicate loading has been handled, false otherwise.\n   *\n   * @param callingClass The class calling this method.\n   *     Used to see if `this` has overridden any relevant hooks.\n   * @param state The state to apply to the field.\n   * @returns Whether the state was applied or not.\n   */\n  loadLegacyState(callingClass: FieldProto, state: AnyDuringMigration):\n      boolean {\n    if (callingClass.prototype.loadState === this.loadState &&\n        callingClass.prototype.fromXml !== this.fromXml) {\n      this.fromXml(Xml.textToDom(state as string));\n      return true;\n    }\n    // Either they called this on purpose from their loadState, or they have\n    // no implementations of either hook. Just do our thing.\n    return false;\n  }\n\n  /**\n   * Dispose of all DOM objects and events belonging to this editable field.\n   *\n   * @internal\n   */\n  dispose() {\n    dropDownDiv.hideIfOwner(this);\n    WidgetDiv.hideIfOwner(this);\n    Tooltip.unbindMouseEvents(this.getClickTarget_());\n\n    if (this.mouseDownWrapper_) {\n      browserEvents.unbind(this.mouseDownWrapper_);\n    }\n\n    dom.removeNode(this.fieldGroup_);\n\n    this.disposed = true;\n  }\n\n  /** Add or remove the UI indicating if this field is editable or not. */\n  updateEditable() {\n    const group = this.fieldGroup_;\n    const block = this.getSourceBlock();\n    if (!this.EDITABLE || !group || !block) {\n      return;\n    }\n    if (this.enabled_ && block.isEditable()) {\n      dom.addClass(group, 'blocklyEditableText');\n      dom.removeClass(group, 'blocklyNonEditableText');\n      group.style.cursor = this.CURSOR;\n    } else {\n      dom.addClass(group, 'blocklyNonEditableText');\n      dom.removeClass(group, 'blocklyEditableText');\n      group.style.cursor = '';\n    }\n  }\n\n  /**\n   * Set whether this field's value can be changed using the editor when the\n   *     source block is editable.\n   *\n   * @param enabled True if enabled.\n   */\n  setEnabled(enabled: boolean) {\n    this.enabled_ = enabled;\n    this.updateEditable();\n  }\n\n  /**\n   * Check whether this field's value can be changed using the editor when the\n   *     source block is editable.\n   *\n   * @returns Whether this field is enabled.\n   */\n  isEnabled(): boolean {\n    return this.enabled_;\n  }\n\n  /**\n   * Check whether this field defines the showEditor_ function.\n   *\n   * @returns Whether this field is clickable.\n   */\n  isClickable(): boolean {\n    return this.enabled_ && !!this.sourceBlock_ &&\n        this.sourceBlock_.isEditable() &&\n        this.showEditor_ !== Field.prototype.showEditor_;\n  }\n\n  /**\n   * Check whether this field is currently editable.  Some fields are never\n   * EDITABLE (e.g. text labels). Other fields may be EDITABLE but may exist on\n   * non-editable blocks or be currently disabled.\n   *\n   * @returns Whether this field is currently enabled, editable and on an\n   *     editable block.\n   */\n  isCurrentlyEditable(): boolean {\n    return this.enabled_ && this.EDITABLE && !!this.sourceBlock_ &&\n        this.sourceBlock_.isEditable();\n  }\n\n  /**\n   * Check whether this field should be serialized by the XML renderer.\n   * Handles the logic for backwards compatibility and incongruous states.\n   *\n   * @returns Whether this field should be serialized or not.\n   */\n  isSerializable(): boolean {\n    let isSerializable = false;\n    if (this.name) {\n      if (this.SERIALIZABLE) {\n        isSerializable = true;\n      } else if (this.EDITABLE) {\n        console.warn(\n            'Detected an editable field that was not serializable.' +\n            ' Please define SERIALIZABLE property as true on all editable custom' +\n            ' fields. Proceeding with serialization.');\n        isSerializable = true;\n      }\n    }\n    return isSerializable;\n  }\n\n  /**\n   * Gets whether this editable field is visible or not.\n   *\n   * @returns True if visible.\n   */\n  isVisible(): boolean {\n    return this.visible_;\n  }\n\n  /**\n   * Sets whether this editable field is visible or not. Should only be called\n   * by input.setVisible.\n   *\n   * @param visible True if visible.\n   * @internal\n   */\n  setVisible(visible: boolean) {\n    if (this.visible_ === visible) {\n      return;\n    }\n    this.visible_ = visible;\n    const root = this.fieldGroup_;\n    if (root) {\n      root.style.display = visible ? 'block' : 'none';\n    }\n  }\n\n  /**\n   * Sets a new validation function for editable fields, or clears a previously\n   * set validator.\n   *\n   * The validator function takes in the new field value, and returns\n   * validated value. The validated value could be the input value, a modified\n   * version of the input value, or null to abort the change.\n   *\n   * If the function does not return anything (or returns undefined) the new\n   * value is accepted as valid. This is to allow for fields using the\n   * validated function as a field-level change event notification.\n   *\n   * @param handler The validator function or null to clear a previous\n   *     validator.\n   */\n  setValidator(handler: FieldValidator<T>) {\n    this.validator_ = handler;\n  }\n\n  /**\n   * Gets the validation function for editable fields, or null if not set.\n   *\n   * @returns Validation function, or null.\n   */\n  getValidator(): Function|null {\n    return this.validator_;\n  }\n\n  /**\n   * Gets the group element for this editable field.\n   * Used for measuring the size and for positioning.\n   *\n   * @returns The group element.\n   */\n  getSvgRoot(): SVGGElement|null {\n    return this.fieldGroup_;\n  }\n\n  /**\n   * Gets the border rectangle element.\n   *\n   * @returns The border rectangle element.\n   * @throws An error if the border rectangle element is not defined.\n   */\n  protected getBorderRect(): SVGRectElement {\n    if (!this.borderRect_) {\n      throw new Error(`The border rectangle is ${this.borderRect_}.`);\n    }\n    return this.borderRect_;\n  }\n\n  /**\n   * Gets the text element.\n   *\n   * @returns The text element.\n   * @throws An error if the text element is not defined.\n   */\n  protected getTextElement(): SVGTextElement {\n    if (!this.textElement_) {\n      throw new Error(`The text element is ${this.textElement_}.`);\n    }\n    return this.textElement_;\n  }\n\n  /**\n   * Gets the text content.\n   *\n   * @returns The text content.\n   * @throws An error if the text content is not defined.\n   */\n  protected getTextContent(): Text {\n    if (!this.textContent_) {\n      throw new Error(`The text content is ${this.textContent_}.`);\n    }\n    return this.textContent_;\n  }\n\n  /**\n   * Updates the field to match the colour/style of the block. Should only be\n   * called by BlockSvg.applyColour().\n   *\n   * @internal\n   */\n  applyColour() {}\n  // Non-abstract sub-classes may wish to implement this. See FieldDropdown.\n\n  /**\n   * Used by getSize() to move/resize any DOM elements, and get the new size.\n   *\n   * All rendering that has an effect on the size/shape of the block should be\n   * done here, and should be triggered by getSize().\n   */\n  protected render_() {\n    if (this.textContent_) {\n      this.textContent_.nodeValue = this.getDisplayText_();\n    }\n    this.updateSize_();\n  }\n\n  /**\n   * Calls showEditor_ when the field is clicked if the field is clickable.\n   * Do not override.\n   *\n   * @param opt_e Optional mouse event that triggered the field to open, or\n   *     undefined if triggered programmatically.\n   * @sealed\n   * @internal\n   */\n  showEditor(opt_e?: Event) {\n    if (this.isClickable()) {\n      this.showEditor_(opt_e);\n    }\n  }\n\n  /**\n   * A developer hook to create an editor for the field. This is no-op by\n   * default, and must be overriden to create an editor.\n   *\n   * @param _e Optional mouse event that triggered the field to open, or\n   *     undefined if triggered programmatically.\n   */\n  protected showEditor_(_e?: Event): void {}\n  // NOP\n\n  /**\n   * Updates the size of the field based on the text.\n   *\n   * @param opt_margin margin to use when positioning the text element.\n   */\n  protected updateSize_(opt_margin?: number) {\n    const constants = this.getConstants();\n    const xOffset = opt_margin !== undefined ? opt_margin :\n        this.borderRect_ ? this.getConstants()!.FIELD_BORDER_RECT_X_PADDING :\n                           0;\n    let totalWidth = xOffset * 2;\n    let totalHeight = constants!.FIELD_TEXT_HEIGHT;\n\n    let contentWidth = 0;\n    if (this.textElement_) {\n      contentWidth = dom.getFastTextWidth(\n          this.textElement_, constants!.FIELD_TEXT_FONTSIZE,\n          constants!.FIELD_TEXT_FONTWEIGHT, constants!.FIELD_TEXT_FONTFAMILY);\n      totalWidth += contentWidth;\n    }\n    if (this.borderRect_) {\n      totalHeight = Math.max(totalHeight, constants!.FIELD_BORDER_RECT_HEIGHT);\n    }\n\n    this.size_.height = totalHeight;\n    this.size_.width = totalWidth;\n\n    this.positionTextElement_(xOffset, contentWidth);\n    this.positionBorderRect_();\n  }\n\n  /**\n   * Position a field's text element after a size change.  This handles both LTR\n   * and RTL positioning.\n   *\n   * @param xOffset x offset to use when positioning the text element.\n   * @param contentWidth The content width.\n   */\n  protected positionTextElement_(xOffset: number, contentWidth: number) {\n    if (!this.textElement_) {\n      return;\n    }\n    const constants = this.getConstants();\n    const halfHeight = this.size_.height / 2;\n\n    this.textElement_.setAttribute(\n        'x',\n        `${\n            this.getSourceBlock()?.RTL ?\n                this.size_.width - contentWidth - xOffset :\n                xOffset}`);\n    this.textElement_.setAttribute(\n        'y',\n        `${\n            constants!.FIELD_TEXT_BASELINE_CENTER ?\n                halfHeight :\n                halfHeight - constants!.FIELD_TEXT_HEIGHT / 2 +\n                    constants!.FIELD_TEXT_BASELINE}`);\n  }\n\n  /** Position a field's border rect after a size change. */\n  protected positionBorderRect_() {\n    if (!this.borderRect_) {\n      return;\n    }\n    this.borderRect_.setAttribute('width', `${this.size_.width}`);\n    this.borderRect_.setAttribute('height', `${this.size_.height}`);\n    this.borderRect_.setAttribute(\n        'rx', `${this.getConstants()!.FIELD_BORDER_RECT_RADIUS}`);\n    this.borderRect_.setAttribute(\n        'ry', `${this.getConstants()!.FIELD_BORDER_RECT_RADIUS}`);\n  }\n\n  /**\n   * Returns the height and width of the field.\n   *\n   * This should *in general* be the only place render_ gets called from.\n   *\n   * @returns Height and width.\n   */\n  getSize(): Size {\n    if (!this.isVisible()) {\n      return new Size(0, 0);\n    }\n\n    if (this.isDirty_) {\n      this.render_();\n      this.isDirty_ = false;\n    } else if (this.visible_ && this.size_.width === 0) {\n      // If the field is not visible the width will be 0 as well, one of the\n      // problems with the old system.\n      this.render_();\n      // Don't issue a warning if the field is actually zero width.\n      if (this.size_.width !== 0) {\n        console.warn(\n            'Deprecated use of setting size_.width to 0 to rerender a' +\n            ' field. Set field.isDirty_ to true instead.');\n      }\n    }\n    return this.size_;\n  }\n\n  /**\n   * Returns the bounding box of the rendered field, accounting for workspace\n   * scaling.\n   *\n   * @returns An object with top, bottom, left, and right in pixels relative to\n   *     the top left corner of the page (window coordinates).\n   * @internal\n   */\n  getScaledBBox(): Rect {\n    let scaledWidth;\n    let scaledHeight;\n    let xy;\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n\n    if (!this.borderRect_) {\n      // Browsers are inconsistent in what they return for a bounding box.\n      // - Webkit / Blink: fill-box / object bounding box\n      // - Gecko: stroke-box\n      const bBox = (this.sourceBlock_ as BlockSvg).getHeightWidth();\n      const scale = (block.workspace as WorkspaceSvg).scale;\n      xy = this.getAbsoluteXY_();\n      scaledWidth = (bBox.width + 1) * scale;\n      scaledHeight = (bBox.height + 1) * scale;\n\n      if (userAgent.GECKO) {\n        xy.x += 1.5 * scale;\n        xy.y += 1.5 * scale;\n      } else {\n        xy.x -= 0.5 * scale;\n        xy.y -= 0.5 * scale;\n      }\n    } else {\n      const bBox = this.borderRect_.getBoundingClientRect();\n      xy = style.getPageOffset(this.borderRect_);\n      scaledWidth = bBox.width;\n      scaledHeight = bBox.height;\n    }\n    return new Rect(xy.y, xy.y + scaledHeight, xy.x, xy.x + scaledWidth);\n  }\n\n  /**\n   * Get the text from this field to display on the block. May differ from\n   * `getText` due to ellipsis, and other formatting.\n   *\n   * @returns Text to display.\n   */\n  protected getDisplayText_(): string {\n    let text = this.getText();\n    if (!text) {\n      // Prevent the field from disappearing if empty.\n      return Field.NBSP;\n    }\n    if (text.length > this.maxDisplayLength) {\n      // Truncate displayed string and add an ellipsis ('...').\n      text = text.substring(0, this.maxDisplayLength - 2) + '';\n    }\n    // Replace whitespace with non-breaking spaces so the text doesn't collapse.\n    text = text.replace(/\\s/g, Field.NBSP);\n    if (this.sourceBlock_ && this.sourceBlock_.RTL) {\n      // The SVG is LTR, force text to be RTL by adding an RLM.\n      text += '\\u200F';\n    }\n    return text;\n  }\n\n  /**\n   * Get the text from this field.\n   * Override getText_ to provide a different behavior than simply casting the\n   * value to a string.\n   *\n   * @returns Current text.\n   * @sealed\n   */\n  getText(): string {\n    // this.getText_ was intended so that devs don't have to remember to call\n    // super when overriding how the text of the field is generated. (#2910)\n    const text = this.getText_();\n    if (text !== null) {\n      return String(text);\n    }\n    return String(this.getValue());\n  }\n\n  /**\n   * A developer hook to override the returned text of this field.\n   * Override if the text representation of the value of this field\n   * is not just a string cast of its value.\n   * Return null to resort to a string cast.\n   *\n   * @returns Current text or null.\n   */\n  protected getText_(): string|null {\n    return null;\n  }\n\n  /**\n   * Force a rerender of the block that this field is installed on, which will\n   * rerender this field and adjust for any sizing changes.\n   * Other fields on the same block will not rerender, because their sizes have\n   * already been recorded.\n   *\n   * @internal\n   */\n  markDirty() {\n    this.isDirty_ = true;\n    this.constants_ = null;\n  }\n\n  /**\n   * Force a rerender of the block that this field is installed on, which will\n   * rerender this field and adjust for any sizing changes.\n   * Other fields on the same block will not rerender, because their sizes have\n   * already been recorded.\n   *\n   * @internal\n   */\n  forceRerender() {\n    this.isDirty_ = true;\n    if (this.sourceBlock_ && this.sourceBlock_.rendered) {\n      (this.sourceBlock_ as BlockSvg).render();\n      (this.sourceBlock_ as BlockSvg).bumpNeighbours();\n      this.updateMarkers_();\n    }\n  }\n\n  /**\n   * Used to change the value of the field. Handles validation and events.\n   * Subclasses should override doClassValidation_ and doValueUpdate_ rather\n   * than this method.\n   *\n   * @param newValue New value.\n   * @sealed\n   */\n  setValue(newValue: AnyDuringMigration) {\n    const doLogging = false;\n    if (newValue === null) {\n      doLogging && console.log('null, return');\n      // Not a valid value to check.\n      return;\n    }\n\n    let validatedValue = this.doClassValidation_(newValue);\n    // Class validators might accidentally forget to return, we'll ignore that.\n    newValue = this.processValidation_(newValue, validatedValue);\n    if (newValue instanceof Error) {\n      doLogging && console.log('invalid class validation, return');\n      return;\n    }\n\n    const localValidator = this.getValidator();\n    if (localValidator) {\n      validatedValue = localValidator.call(this, newValue);\n      // Local validators might accidentally forget to return, we'll ignore\n      // that.\n      newValue = this.processValidation_(newValue, validatedValue);\n      if (newValue instanceof Error) {\n        doLogging && console.log('invalid local validation, return');\n        return;\n      }\n    }\n    const source = this.sourceBlock_;\n    if (source && source.disposed) {\n      doLogging && console.log('source disposed, return');\n      return;\n    }\n    const oldValue = this.getValue();\n    if (oldValue === newValue) {\n      doLogging && console.log('same, doValueUpdate_, return');\n      this.doValueUpdate_(newValue);\n      return;\n    }\n\n    this.doValueUpdate_(newValue);\n    if (source && eventUtils.isEnabled()) {\n      eventUtils.fire(new (eventUtils.get(eventUtils.BLOCK_CHANGE))(\n          source, 'field', this.name || null, oldValue, newValue));\n    }\n    if (this.isDirty_) {\n      this.forceRerender();\n    }\n    doLogging && console.log(this.value_);\n  }\n\n  /**\n   * Process the result of validation.\n   *\n   * @param newValue New value.\n   * @param validatedValue Validated value.\n   * @returns New value, or an Error object.\n   */\n  private processValidation_(\n      newValue: AnyDuringMigration,\n      validatedValue: AnyDuringMigration): AnyDuringMigration {\n    if (validatedValue === null) {\n      this.doValueInvalid_(newValue);\n      if (this.isDirty_) {\n        this.forceRerender();\n      }\n      return Error();\n    }\n    if (validatedValue !== undefined) {\n      newValue = validatedValue;\n    }\n    return newValue;\n  }\n\n  /**\n   * Get the current value of the field.\n   *\n   * @returns Current value.\n   */\n  getValue(): AnyDuringMigration {\n    return this.value_;\n  }\n\n  /**\n   * Used to validate a value. Returns input by default. Can be overridden by\n   * subclasses, see FieldDropdown.\n   *\n   * @param opt_newValue The value to be validated.\n   * @returns The validated value, same as input by default.\n   */\n  protected doClassValidation_(opt_newValue?: AnyDuringMigration):\n      AnyDuringMigration {\n    if (opt_newValue === null || opt_newValue === undefined) {\n      return null;\n    }\n    return opt_newValue;\n  }\n\n  /**\n   * Used to update the value of a field. Can be overridden by subclasses to do\n   * custom storage of values/updating of external things.\n   *\n   * @param newValue The value to be saved.\n   */\n  protected doValueUpdate_(newValue: AnyDuringMigration) {\n    this.value_ = newValue;\n    this.isDirty_ = true;\n  }\n\n  /**\n   * Used to notify the field an invalid value was input. Can be overridden by\n   * subclasses, see FieldTextInput.\n   * No-op by default.\n   *\n   * @param _invalidValue The input value that was determined to be invalid.\n   */\n  protected doValueInvalid_(_invalidValue: AnyDuringMigration) {}\n  // NOP\n\n  /**\n   * Handle a pointerdown event on a field.\n   *\n   * @param e Pointer down event.\n   */\n  protected onMouseDown_(e: PointerEvent) {\n    if (!this.sourceBlock_ || this.sourceBlock_.isDeadOrDying()) {\n      return;\n    }\n    const gesture = (this.sourceBlock_.workspace as WorkspaceSvg).getGesture(e);\n    if (gesture) {\n      gesture.setStartField(this as Field);\n    }\n  }\n\n  /**\n   * Sets the tooltip for this field.\n   *\n   * @param newTip The text for the tooltip, a function that returns the text\n   *     for the tooltip, a parent object whose tooltip will be used, or null to\n   *     display the tooltip of the parent block. To not display a tooltip pass\n   *     the empty string.\n   */\n  setTooltip(newTip: Tooltip.TipInfo|null) {\n    if (!newTip && newTip !== '') {  // If null or undefined.\n      newTip = this.sourceBlock_;\n    }\n    const clickTarget = this.getClickTarget_();\n    if (clickTarget) {\n      (clickTarget as AnyDuringMigration).tooltip = newTip;\n    } else {\n      // Field has not been initialized yet.\n      this.tooltip_ = newTip;\n    }\n  }\n\n  /**\n   * Returns the tooltip text for this field.\n   *\n   * @returns The tooltip text for this field.\n   */\n  getTooltip(): string {\n    const clickTarget = this.getClickTarget_();\n    if (clickTarget) {\n      return Tooltip.getTooltipOfObject(clickTarget);\n    }\n    // Field has not been initialized yet. Return stashed this.tooltip_ value.\n    return Tooltip.getTooltipOfObject({tooltip: this.tooltip_});\n  }\n\n  /**\n   * The element to bind the click handler to. If not set explicitly, defaults\n   * to the SVG root of the field. When this element is\n   * clicked on an editable field, the editor will open.\n   *\n   * @returns Element to bind click handler to.\n   */\n  protected getClickTarget_(): Element|null {\n    return this.clickTarget_ || this.getSvgRoot();\n  }\n\n  /**\n   * Return the absolute coordinates of the top-left corner of this field.\n   * The origin (0,0) is the top-left corner of the page body.\n   *\n   * @returns Object with .x and .y properties.\n   */\n  protected getAbsoluteXY_(): Coordinate {\n    return style.getPageOffset(this.getClickTarget_() as SVGRectElement);\n  }\n\n  /**\n   * Whether this field references any Blockly variables.  If true it may need\n   * to be handled differently during serialization and deserialization.\n   * Subclasses may override this.\n   *\n   * @returns True if this field has any variable references.\n   * @internal\n   */\n  referencesVariables(): boolean {\n    return false;\n  }\n\n  /**\n   * Refresh the variable name referenced by this field if this field references\n   * variables.\n   *\n   * @internal\n   */\n  refreshVariableName() {}\n  // NOP\n\n  /**\n   * Search through the list of inputs and their fields in order to find the\n   * parent input of a field.\n   *\n   * @returns The input that the field belongs to.\n   * @internal\n   */\n  getParentInput(): Input {\n    let parentInput = null;\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    const inputs = block.inputList;\n\n    for (let idx = 0; idx < block.inputList.length; idx++) {\n      const input = inputs[idx];\n      const fieldRows = input.fieldRow;\n      for (let j = 0; j < fieldRows.length; j++) {\n        if (fieldRows[j] === this) {\n          parentInput = input;\n          break;\n        }\n      }\n    }\n    return parentInput!;\n  }\n\n  /**\n   * Returns whether or not we should flip the field in RTL.\n   *\n   * @returns True if we should flip in RTL.\n   */\n  getFlipRtl(): boolean {\n    return false;\n  }\n\n  /**\n   * Returns whether or not the field is tab navigable.\n   *\n   * @returns True if the field is tab navigable.\n   */\n  isTabNavigable(): boolean {\n    return false;\n  }\n\n  /**\n   * Handles the given keyboard shortcut.\n   *\n   * @param _shortcut The shortcut to be handled.\n   * @returns True if the shortcut has been handled, false otherwise.\n   */\n  onShortcut(_shortcut: KeyboardShortcut): boolean {\n    return false;\n  }\n\n  /**\n   * Add the cursor SVG to this fields SVG group.\n   *\n   * @param cursorSvg The SVG root of the cursor to be added to the field group.\n   * @internal\n   */\n  setCursorSvg(cursorSvg: SVGElement) {\n    if (!cursorSvg) {\n      this.cursorSvg_ = null;\n      return;\n    }\n\n    if (!this.fieldGroup_) {\n      throw new Error(`The field group is ${this.fieldGroup_}.`);\n    }\n    this.fieldGroup_.appendChild(cursorSvg);\n    this.cursorSvg_ = cursorSvg;\n  }\n\n  /**\n   * Add the marker SVG to this fields SVG group.\n   *\n   * @param markerSvg The SVG root of the marker to be added to the field group.\n   * @internal\n   */\n  setMarkerSvg(markerSvg: SVGElement) {\n    if (!markerSvg) {\n      this.markerSvg_ = null;\n      return;\n    }\n\n    if (!this.fieldGroup_) {\n      throw new Error(`The field group is ${this.fieldGroup_}.`);\n    }\n    this.fieldGroup_.appendChild(markerSvg);\n    this.markerSvg_ = markerSvg;\n  }\n\n  /** Redraw any attached marker or cursor svgs if needed. */\n  protected updateMarkers_() {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    const workspace = block.workspace as WorkspaceSvg;\n    if (workspace.keyboardAccessibilityMode && this.cursorSvg_) {\n      workspace.getCursor()!.draw();\n    }\n    if (workspace.keyboardAccessibilityMode && this.markerSvg_) {\n      // TODO(#4592): Update all markers on the field.\n      workspace.getMarker(MarkerManager.LOCAL_MARKER)!.draw();\n    }\n  }\n}\n\n/**\n * Extra configuration options for the base field.\n */\nexport interface FieldConfig {\n  tooltip?: string;\n}\n\n/**\n * For use by Field and descendants of Field. Constructors can change\n * in descendants, though they should contain all of Field's prototype methods.\n */\nexport type FieldProto = Pick<typeof Field, 'prototype'>;\n\n/**\n * Represents an error where the field is trying to access its block or\n * information about its block before it has actually been attached to said\n * block.\n */\nexport class UnattachedFieldError extends Error {\n  /** @internal */\n  constructor() {\n    super(\n        'The field has not yet been attached to its input. ' +\n        'Call appendField to attach it.');\n  }\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Constant declarations for common key codes.\n * These methods are not specific to Blockly, and could be factored out into\n * a JavaScript framework such as Closure.\n *\n * @namespace Blockly.utils.KeyCodes\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.utils.KeyCodes');\n\n\n/**\n * Key codes for common characters.\n *\n * Copied from Closure's goog.events.KeyCodes\n *\n * This list is not localized and therefore some of the key codes are not\n * correct for non US keyboard layouts. See comments below.\n *\n * @alias Blockly.utils.KeyCodes\n */\nexport enum KeyCodes {\n  WIN_KEY_FF_LINUX = 0,\n  MAC_ENTER = 3,\n  BACKSPACE = 8,\n  TAB = 9,\n  NUM_CENTER = 12,  // NUMLOCK on FF/Safari Mac\n  ENTER = 13,\n  SHIFT = 16,\n  CTRL = 17,\n  ALT = 18,\n  PAUSE = 19,\n  CAPS_LOCK = 20,\n  ESC = 27,\n  SPACE = 32,\n  PAGE_UP = 33,    // also NUM_NORTH_EAST\n  PAGE_DOWN = 34,  // also NUM_SOUTH_EAST\n  END = 35,        // also NUM_SOUTH_WEST\n  HOME = 36,       // also NUM_NORTH_WEST\n  LEFT = 37,       // also NUM_WEST\n  UP = 38,         // also NUM_NORTH\n  RIGHT = 39,      // also NUM_EAST\n  DOWN = 40,       // also NUM_SOUTH\n  PLUS_SIGN = 43,  // NOT numpad plus\n  PRINT_SCREEN = 44,\n  INSERT = 45,  // also NUM_INSERT\n  DELETE = 46,  // also NUM_DELETE\n  ZERO = 48,\n  ONE = 49,\n  TWO = 50,\n  THREE = 51,\n  FOUR = 52,\n  FIVE = 53,\n  SIX = 54,\n  SEVEN = 55,\n  EIGHT = 56,\n  NINE = 57,\n  FF_SEMICOLON = 59,  // Firefox (Gecko) fires this for semicolon instead of 186\n  FF_EQUALS = 61,     // Firefox (Gecko) fires this for equals instead of 187\n  FF_DASH = 173,      // Firefox (Gecko) fires this for dash instead of 189\n  // Firefox (Gecko) fires this for # on UK keyboards, rather than\n  // Shift+SINGLE_QUOTE.\n  FF_HASH = 163,\n  QUESTION_MARK = 63,  // needs localization\n  AT_SIGN = 64,\n  A = 65,\n  B = 66,\n  C = 67,\n  D = 68,\n  E = 69,\n  F = 70,\n  G = 71,\n  H = 72,\n  I = 73,\n  J = 74,\n  K = 75,\n  L = 76,\n  M = 77,\n  N = 78,\n  O = 79,\n  P = 80,\n  Q = 81,\n  R = 82,\n  S = 83,\n  T = 84,\n  U = 85,\n  V = 86,\n  W = 87,\n  X = 88,\n  Y = 89,\n  Z = 90,\n  META = 91,  // WIN_KEY_LEFT\n  WIN_KEY_RIGHT = 92,\n  CONTEXT_MENU = 93,\n  NUM_ZERO = 96,\n  NUM_ONE = 97,\n  NUM_TWO = 98,\n  NUM_THREE = 99,\n  NUM_FOUR = 100,\n  NUM_FIVE = 101,\n  NUM_SIX = 102,\n  NUM_SEVEN = 103,\n  NUM_EIGHT = 104,\n  NUM_NINE = 105,\n  NUM_MULTIPLY = 106,\n  NUM_PLUS = 107,\n  NUM_MINUS = 109,\n  NUM_PERIOD = 110,\n  NUM_DIVISION = 111,\n  F1 = 112,\n  F2 = 113,\n  F3 = 114,\n  F4 = 115,\n  F5 = 116,\n  F6 = 117,\n  F7 = 118,\n  F8 = 119,\n  F9 = 120,\n  F10 = 121,\n  F11 = 122,\n  F12 = 123,\n  NUMLOCK = 144,\n  SCROLL_LOCK = 145,\n\n  // OS-specific media keys like volume controls and browser controls.\n  FIRST_MEDIA_KEY = 166,\n  LAST_MEDIA_KEY = 183,\n\n  SEMICOLON = 186,             // needs localization\n  DASH = 189,                  // needs localization\n  EQUALS = 187,                // needs localization\n  COMMA = 188,                 // needs localization\n  PERIOD = 190,                // needs localization\n  SLASH = 191,                 // needs localization\n  APOSTROPHE = 192,            // needs localization\n  TILDE = 192,                 // needs localization\n  SINGLE_QUOTE = 222,          // needs localization\n  OPEN_SQUARE_BRACKET = 219,   // needs localization\n  BACKSLASH = 220,             // needs localization\n  CLOSE_SQUARE_BRACKET = 221,  // needs localization\n  WIN_KEY = 224,\n  MAC_FF_META =\n      224,  // Firefox (Gecko) fires this for the meta key instead of 91\n  MAC_WK_CMD_LEFT = 91,   // WebKit Left Command key fired, same as META\n  MAC_WK_CMD_RIGHT = 93,  // WebKit Right Command key fired, different from META\n  WIN_IME = 229,\n\n  // \"Reserved for future use\". Some programs (e.g. the SlingPlayer 2.4 ActiveX\n  // control) fire this as a hacky way to disable screensavers.\n  VK_NONAME = 252,\n\n  // We've seen users whose machines fire this keycode at regular one\n  // second intervals. The common thread among these users is that\n  // they're all using Dell Inspiron laptops, so we suspect that this\n  // indicates a hardware/bios problem.\n  // http://en.community.dell.com/support-forums/laptop/f/3518/p/19285957/19523128.aspx\n  PHANTOM = 255,\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Blockly menu similar to Closure's goog.ui.Menu\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Menu');\n\nimport * as browserEvents from './browser_events.js';\nimport type {MenuItem} from './menuitem.js';\nimport * as aria from './utils/aria.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport {KeyCodes} from './utils/keycodes.js';\nimport type {Size} from './utils/size.js';\nimport * as style from './utils/style.js';\n\n\n/**\n * A basic menu class.\n *\n * @alias Blockly.Menu\n */\nexport class Menu {\n  /**\n   * Array of menu items.\n   * (Nulls are never in the array, but typing the array as nullable prevents\n   * the compiler from objecting to .indexOf(null))\n   */\n  private readonly menuItems: MenuItem[] = [];\n\n  /**\n   * Coordinates of the mousedown event that caused this menu to open. Used to\n   * prevent the consequent mouseup event due to a simple click from\n   * activating a menu item immediately.\n   */\n  openingCoords: Coordinate|null = null;\n\n  /**\n   * This is the element that we will listen to the real focus events on.\n   * A value of null means no menu item is highlighted.\n   */\n  private highlightedItem: MenuItem|null = null;\n\n  /** Mouse over event data. */\n  private mouseOverHandler: browserEvents.Data|null = null;\n\n  /** Click event data. */\n  private clickHandler: browserEvents.Data|null = null;\n\n  /** Mouse enter event data. */\n  private mouseEnterHandler: browserEvents.Data|null = null;\n\n  /** Mouse leave event data. */\n  private mouseLeaveHandler: browserEvents.Data|null = null;\n\n  /** Key down event data. */\n  private onKeyDownHandler: browserEvents.Data|null = null;\n\n  /** The menu's root DOM element. */\n  private element: HTMLDivElement|null = null;\n\n  /** ARIA name for this menu. */\n  private roleName: aria.Role|null = null;\n\n  /** Constructs a new Menu instance. */\n  constructor() {}\n\n  /**\n   * Add a new menu item to the bottom of this menu.\n   *\n   * @param menuItem Menu item to append.\n   * @internal\n   */\n  addChild(menuItem: MenuItem) {\n    this.menuItems.push(menuItem);\n  }\n\n  /**\n   * Creates the menu DOM.\n   *\n   * @param container Element upon which to append this menu.\n   * @returns The menu's root DOM element.\n   */\n  render(container: Element): HTMLDivElement {\n    const element = (document.createElement('div'));\n    // goog-menu is deprecated, use blocklyMenu.  May 2020.\n    element.className = 'blocklyMenu goog-menu blocklyNonSelectable';\n    element.tabIndex = 0;\n    if (this.roleName) {\n      aria.setRole(element, this.roleName);\n    }\n    this.element = element;\n\n    // Add menu items.\n    for (let i = 0, menuItem; menuItem = this.menuItems[i]; i++) {\n      element.appendChild(menuItem.createDom());\n    }\n\n    // Add event handlers.\n    this.mouseOverHandler = browserEvents.conditionalBind(\n        element, 'pointerover', this, this.handleMouseOver, true);\n    this.clickHandler = browserEvents.conditionalBind(\n        element, 'pointerdown', this, this.handleClick, true);\n    this.mouseEnterHandler = browserEvents.conditionalBind(\n        element, 'pointerenter', this, this.handleMouseEnter, true);\n    this.mouseLeaveHandler = browserEvents.conditionalBind(\n        element, 'pointerleave', this, this.handleMouseLeave, true);\n    this.onKeyDownHandler = browserEvents.conditionalBind(\n        element, 'keydown', this, this.handleKeyEvent);\n\n    container.appendChild(element);\n    return element;\n  }\n\n  /**\n   * Gets the menu's element.\n   *\n   * @returns The DOM element.\n   * @internal\n   */\n  getElement(): HTMLDivElement|null {\n    return this.element;\n  }\n\n  /**\n   * Focus the menu element.\n   *\n   * @internal\n   */\n  focus() {\n    const el = this.getElement();\n    if (el) {\n      el.focus({preventScroll: true});\n      dom.addClass(el, 'blocklyFocused');\n    }\n  }\n\n  /** Blur the menu element. */\n  private blur() {\n    const el = this.getElement();\n    if (el) {\n      el.blur();\n      dom.removeClass(el, 'blocklyFocused');\n    }\n  }\n\n  /**\n   * Set the menu accessibility role.\n   *\n   * @param roleName role name.\n   * @internal\n   */\n  setRole(roleName: aria.Role) {\n    this.roleName = roleName;\n  }\n\n  /** Dispose of this menu. */\n  dispose() {\n    // Remove event handlers.\n    if (this.mouseOverHandler) {\n      browserEvents.unbind(this.mouseOverHandler);\n      this.mouseOverHandler = null;\n    }\n    if (this.clickHandler) {\n      browserEvents.unbind(this.clickHandler);\n      this.clickHandler = null;\n    }\n    if (this.mouseEnterHandler) {\n      browserEvents.unbind(this.mouseEnterHandler);\n      this.mouseEnterHandler = null;\n    }\n    if (this.mouseLeaveHandler) {\n      browserEvents.unbind(this.mouseLeaveHandler);\n      this.mouseLeaveHandler = null;\n    }\n    if (this.onKeyDownHandler) {\n      browserEvents.unbind(this.onKeyDownHandler);\n      this.onKeyDownHandler = null;\n    }\n\n    // Remove menu items.\n    for (let i = 0, menuItem; menuItem = this.menuItems[i]; i++) {\n      menuItem.dispose();\n    }\n    this.element = null;\n  }\n\n  // Child component management.\n\n  /**\n   * Returns the child menu item that owns the given DOM element,\n   * or null if no such menu item is found.\n   *\n   * @param elem DOM element whose owner is to be returned.\n   * @returns Menu item for which the DOM element belongs to.\n   */\n  private getMenuItem(elem: Element): MenuItem|null {\n    const menuElem = this.getElement();\n    // Node might be the menu border (resulting in no associated menu item), or\n    // a menu item's div, or some element within the menu item.\n    // Walk up parents until one meets either the menu's root element, or\n    // a menu item's div.\n    let currentElement: Element|null = elem;\n    while (currentElement && currentElement !== menuElem) {\n      if (currentElement.classList.contains('blocklyMenuItem')) {\n        // Having found a menu item's div, locate that menu item in this menu.\n        for (let i = 0, menuItem; menuItem = this.menuItems[i]; i++) {\n          if (menuItem.getElement() === currentElement) {\n            return menuItem;\n          }\n        }\n      }\n      currentElement = currentElement.parentElement;\n    }\n    return null;\n  }\n\n  // Highlight management.\n\n  /**\n   * Highlights the given menu item, or clears highlighting if null.\n   *\n   * @param item Item to highlight, or null.\n   * @internal\n   */\n  setHighlighted(item: MenuItem|null) {\n    const currentHighlighted = this.highlightedItem;\n    if (currentHighlighted) {\n      currentHighlighted.setHighlighted(false);\n      this.highlightedItem = null;\n    }\n    if (item) {\n      item.setHighlighted(true);\n      this.highlightedItem = item;\n      // Bring the highlighted item into view. This has no effect if the menu is\n      // not scrollable.\n      const el = this.getElement() as Element;\n      style.scrollIntoContainerView(item.getElement() as Element, el);\n\n      aria.setState(el, aria.State.ACTIVEDESCENDANT, item.getId());\n    }\n  }\n\n  /**\n   * Highlights the next highlightable item (or the first if nothing is\n   * currently highlighted).\n   *\n   * @internal\n   */\n  highlightNext() {\n    const index = this.highlightedItem ?\n        this.menuItems.indexOf(this.highlightedItem) :\n        -1;\n    this.highlightHelper(index, 1);\n  }\n\n  /**\n   * Highlights the previous highlightable item (or the last if nothing is\n   * currently highlighted).\n   *\n   * @internal\n   */\n  highlightPrevious() {\n    const index = this.highlightedItem ?\n        this.menuItems.indexOf(this.highlightedItem) :\n        -1;\n    this.highlightHelper(index < 0 ? this.menuItems.length : index, -1);\n  }\n\n  /** Highlights the first highlightable item. */\n  private highlightFirst() {\n    this.highlightHelper(-1, 1);\n  }\n\n  /** Highlights the last highlightable item. */\n  private highlightLast() {\n    this.highlightHelper(this.menuItems.length, -1);\n  }\n\n  /**\n   * Helper function that manages the details of moving the highlight among\n   * child menuitems in response to keyboard events.\n   *\n   * @param startIndex Start index.\n   * @param delta Step direction: 1 to go down, -1 to go up.\n   */\n  private highlightHelper(startIndex: number, delta: number) {\n    let index = startIndex + delta;\n    let menuItem;\n    while (menuItem = this.menuItems[index]) {\n      if (menuItem.isEnabled()) {\n        this.setHighlighted(menuItem);\n        break;\n      }\n      index += delta;\n    }\n  }\n\n  // Mouse events.\n\n  /**\n   * Handles mouseover events. Highlight menuitems as the user hovers over them.\n   *\n   * @param e Mouse event to handle.\n   */\n  private handleMouseOver(e: PointerEvent) {\n    const menuItem = this.getMenuItem(e.target as Element);\n\n    if (menuItem) {\n      if (menuItem.isEnabled()) {\n        if (this.highlightedItem !== menuItem) {\n          this.setHighlighted(menuItem);\n        }\n      } else {\n        this.setHighlighted(null);\n      }\n    }\n  }\n\n  /**\n   * Handles click events. Pass the event onto the child menuitem to handle.\n   *\n   * @param e Click event to handle.\n   */\n  private handleClick(e: PointerEvent) {\n    const oldCoords = this.openingCoords;\n    // Clear out the saved opening coords immediately so they're not used twice.\n    this.openingCoords = null;\n    if (oldCoords && typeof e.clientX === 'number') {\n      const newCoords = new Coordinate(e.clientX, e.clientY);\n      if (Coordinate.distance(oldCoords, newCoords) < 1) {\n        // This menu was opened by a mousedown and we're handling the consequent\n        // click event. The coords haven't changed, meaning this was the same\n        // opening event. Don't do the usual behavior because the menu just\n        // popped up under the mouse and the user didn't mean to activate this\n        // item.\n        return;\n      }\n    }\n\n    const menuItem = this.getMenuItem(e.target as Element);\n    if (menuItem) {\n      menuItem.performAction();\n    }\n  }\n\n  /**\n   * Handles mouse enter events. Focus the element.\n   *\n   * @param _e Mouse event to handle.\n   */\n  private handleMouseEnter(_e: PointerEvent) {\n    this.focus();\n  }\n\n  /**\n   * Handles mouse leave events. Blur and clear highlight.\n   *\n   * @param _e Mouse event to handle.\n   */\n  private handleMouseLeave(_e: PointerEvent) {\n    if (this.getElement()) {\n      this.blur();\n      this.setHighlighted(null);\n    }\n  }\n\n  // Keyboard events.\n\n  /**\n   * Attempts to handle a keyboard event, if the menu item is enabled, by\n   * calling\n   * {@link Menu#handleKeyEventInternal_}.\n   *\n   * @param e Key event to handle.\n   */\n  private handleKeyEvent(e: Event) {\n    if (!this.menuItems.length) {\n      // Empty menu.\n      return;\n    }\n    const keyboardEvent = e as KeyboardEvent;\n    if (keyboardEvent.shiftKey || keyboardEvent.ctrlKey ||\n        keyboardEvent.metaKey || keyboardEvent.altKey) {\n      // Do not handle the key event if any modifier key is pressed.\n      return;\n    }\n\n    const highlighted = this.highlightedItem;\n    switch (keyboardEvent.keyCode) {\n      case KeyCodes.ENTER:\n      case KeyCodes.SPACE:\n        if (highlighted) {\n          highlighted.performAction();\n        }\n        break;\n\n      case KeyCodes.UP:\n        this.highlightPrevious();\n        break;\n\n      case KeyCodes.DOWN:\n        this.highlightNext();\n        break;\n\n      case KeyCodes.PAGE_UP:\n      case KeyCodes.HOME:\n        this.highlightFirst();\n        break;\n\n      case KeyCodes.PAGE_DOWN:\n      case KeyCodes.END:\n        this.highlightLast();\n        break;\n\n      default:\n        // Not a key the menu is interested in.\n        return;\n    }\n    // The menu used this key, don't let it have secondary effects.\n    e.preventDefault();\n    e.stopPropagation();\n  }\n\n  /**\n   * Get the size of a rendered menu.\n   *\n   * @returns Object with width and height properties.\n   * @internal\n   */\n  getSize(): Size {\n    const menuDom = this.getElement() as HTMLDivElement;\n    const menuSize = style.getSize(menuDom);\n    // Recalculate height for the total content, not only box height.\n    menuSize.height = menuDom.scrollHeight;\n    return menuSize;\n  }\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Blockly menu item similar to Closure's goog.ui.MenuItem\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.MenuItem');\n\nimport * as aria from './utils/aria.js';\nimport * as dom from './utils/dom.js';\nimport * as idGenerator from './utils/idgenerator.js';\n\n\n/**\n * Class representing an item in a menu.\n *\n * @alias Blockly.MenuItem\n */\nexport class MenuItem {\n  /** Is the menu item clickable, as opposed to greyed-out. */\n  private enabled = true;\n\n  /** The DOM element for the menu item. */\n  private element: HTMLDivElement|null = null;\n\n  /** Whether the menu item is rendered right-to-left. */\n  private rightToLeft = false;\n\n  /** ARIA name for this menu. */\n  private roleName: aria.Role|null = null;\n\n  /** Is this menu item checkable. */\n  private checkable = false;\n\n  /** Is this menu item currently checked. */\n  private checked = false;\n\n  /** Is this menu item currently highlighted. */\n  private highlight = false;\n\n  /** Bound function to call when this menu item is clicked. */\n  private actionHandler: Function|null = null;\n\n  /**\n   * @param content Text caption to display as the content of the item, or a\n   *     HTML element to display.\n   * @param opt_value Data/model associated with the menu item.\n   */\n  constructor(\n      private readonly content: string|HTMLElement,\n      private readonly opt_value?: string) {}\n\n  /**\n   * Creates the menuitem's DOM.\n   *\n   * @returns Completed DOM.\n   */\n  createDom(): Element {\n    const element = (document.createElement('div'));\n    element.id = idGenerator.getNextUniqueId();\n    this.element = element;\n\n    // Set class and style\n    // goog-menuitem* is deprecated, use blocklyMenuItem*.  May 2020.\n    element.className = 'blocklyMenuItem goog-menuitem ' +\n        (this.enabled ? '' :\n                        'blocklyMenuItemDisabled goog-menuitem-disabled ') +\n        (this.checked ? 'blocklyMenuItemSelected goog-option-selected ' : '') +\n        (this.highlight ? 'blocklyMenuItemHighlight goog-menuitem-highlight ' :\n                          '') +\n        (this.rightToLeft ? 'blocklyMenuItemRtl goog-menuitem-rtl ' : '');\n\n    const content = (document.createElement('div'));\n    content.className = 'blocklyMenuItemContent goog-menuitem-content';\n    // Add a checkbox for checkable menu items.\n    if (this.checkable) {\n      const checkbox = (document.createElement('div'));\n      checkbox.className = 'blocklyMenuItemCheckbox goog-menuitem-checkbox';\n      content.appendChild(checkbox);\n    }\n\n    let contentDom: Node = this.content as HTMLElement;\n    if (typeof this.content === 'string') {\n      contentDom = document.createTextNode(this.content);\n    }\n    content.appendChild(contentDom);\n    element.appendChild(content);\n\n    // Initialize ARIA role and state.\n    if (this.roleName) {\n      aria.setRole(element, this.roleName);\n    }\n    aria.setState(\n        element, aria.State.SELECTED, this.checkable && this.checked || false);\n    aria.setState(element, aria.State.DISABLED, !this.enabled);\n\n    return element;\n  }\n\n  /** Dispose of this menu item. */\n  dispose() {\n    this.element = null;\n  }\n\n  /**\n   * Gets the menu item's element.\n   *\n   * @returns The DOM element.\n   * @internal\n   */\n  getElement(): Element|null {\n    return this.element;\n  }\n\n  /**\n   * Gets the unique ID for this menu item.\n   *\n   * @returns Unique component ID.\n   * @internal\n   */\n  getId(): string {\n    return this.element!.id;\n  }\n\n  /**\n   * Gets the value associated with the menu item.\n   *\n   * @returns value Value associated with the menu item.\n   * @internal\n   */\n  getValue(): string|null {\n    return this.opt_value ?? null;\n  }\n\n  /**\n   * Set menu item's rendering direction.\n   *\n   * @param rtl True if RTL, false if LTR.\n   * @internal\n   */\n  setRightToLeft(rtl: boolean) {\n    this.rightToLeft = rtl;\n  }\n\n  /**\n   * Set the menu item's accessibility role.\n   *\n   * @param roleName Role name.\n   * @internal\n   */\n  setRole(roleName: aria.Role) {\n    this.roleName = roleName;\n  }\n\n  /**\n   * Sets the menu item to be checkable or not. Set to true for menu items\n   * that represent checkable options.\n   *\n   * @param checkable Whether the menu item is checkable.\n   * @internal\n   */\n  setCheckable(checkable: boolean) {\n    this.checkable = checkable;\n  }\n\n  /**\n   * Checks or unchecks the component.\n   *\n   * @param checked Whether to check or uncheck the component.\n   * @internal\n   */\n  setChecked(checked: boolean) {\n    this.checked = checked;\n  }\n\n  /**\n   * Highlights or unhighlights the component.\n   *\n   * @param highlight Whether to highlight or unhighlight the component.\n   * @internal\n   */\n  setHighlighted(highlight: boolean) {\n    this.highlight = highlight;\n\n    const el = this.getElement();\n    if (el && this.isEnabled()) {\n      // goog-menuitem-highlight is deprecated, use blocklyMenuItemHighlight.\n      // May 2020.\n      const name = 'blocklyMenuItemHighlight';\n      const nameDep = 'goog-menuitem-highlight';\n      if (highlight) {\n        dom.addClass(el, name);\n        dom.addClass(el, nameDep);\n      } else {\n        dom.removeClass(el, name);\n        dom.removeClass(el, nameDep);\n      }\n    }\n  }\n\n  /**\n   * Returns true if the menu item is enabled, false otherwise.\n   *\n   * @returns Whether the menu item is enabled.\n   * @internal\n   */\n  isEnabled(): boolean {\n    return this.enabled;\n  }\n\n  /**\n   * Enables or disables the menu item.\n   *\n   * @param enabled Whether to enable or disable the menu item.\n   * @internal\n   */\n  setEnabled(enabled: boolean) {\n    this.enabled = enabled;\n  }\n\n  /**\n   * Performs the appropriate action when the menu item is activated\n   * by the user.\n   *\n   * @internal\n   */\n  performAction() {\n    if (this.isEnabled() && this.actionHandler) {\n      this.actionHandler(this);\n    }\n  }\n\n  /**\n   * Set the handler that's called when the menu item is activated by the user.\n   * `obj` will be used as the 'this' object in the function when called.\n   *\n   * @param fn The handler.\n   * @param obj Used as the 'this' object in fn when called.\n   * @internal\n   */\n  onAction(fn: (p1: MenuItem) => void, obj: object) {\n    this.actionHandler = fn.bind(obj);\n  }\n}\n","/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Events fired as a result of bubble open.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events.BubbleOpen');\n\nimport type {AbstractEventJson} from './events_abstract.js';\nimport type {BlockSvg} from '../block_svg.js';\nimport * as deprecation from '../utils/deprecation.js';\nimport * as registry from '../registry.js';\nimport {UiBase} from './events_ui_base.js';\nimport * as eventUtils from './utils.js';\nimport type {Workspace} from '../workspace.js';\n\n\n/**\n * Class for a bubble open event.\n *\n * @alias Blockly.Events.BubbleOpen\n */\nexport class BubbleOpen extends UiBase {\n  blockId?: string;\n  isOpen?: boolean;\n  bubbleType?: BubbleType;\n  override type = eventUtils.BUBBLE_OPEN;\n\n  /**\n   * @param opt_block The associated block. Undefined for a blank event.\n   * @param opt_isOpen Whether the bubble is opening (false if closing).\n   *     Undefined for a blank event.\n   * @param opt_bubbleType The type of bubble. One of 'mutator', 'comment' or\n   *     'warning'. Undefined for a blank event.\n   */\n  constructor(\n      opt_block?: BlockSvg, opt_isOpen?: boolean, opt_bubbleType?: BubbleType) {\n    const workspaceId = opt_block ? opt_block.workspace.id : undefined;\n    super(workspaceId);\n    if (!opt_block) return;\n\n    this.blockId = opt_block.id;\n\n    /** Whether the bubble is opening (false if closing). */\n    this.isOpen = opt_isOpen;\n\n    /** The type of bubble. One of 'mutator', 'comment', or 'warning'. */\n    this.bubbleType = opt_bubbleType;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): BubbleOpenJson {\n    const json = super.toJson() as BubbleOpenJson;\n    if (this.isOpen === undefined) {\n      throw new Error(\n          'Whether this event is for opening the bubble is undefined. ' +\n          'Either pass the value to the constructor, or call fromJson');\n    }\n    if (!this.bubbleType) {\n      throw new Error(\n          'The type of bubble is undefined. Either pass the ' +\n          'value to the constructor, or call fromJson');\n    }\n    json['isOpen'] = this.isOpen;\n    json['bubbleType'] = this.bubbleType;\n    json['blockId'] = this.blockId || '';\n    return json;\n  }\n\n  /**\n   * Decode the JSON event.\n   *\n   * @param json JSON representation.\n   */\n  override fromJson(json: BubbleOpenJson) {\n    deprecation.warn(\n        'Blockly.Events.BubbleOpen.prototype.fromJson', 'version 9',\n        'version 10', 'Blockly.Events.fromJson');\n    super.fromJson(json);\n    this.isOpen = json['isOpen'];\n    this.bubbleType = json['bubbleType'];\n    this.blockId = json['blockId'];\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of BubbleOpen, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(json: BubbleOpenJson, workspace: Workspace, event?: any):\n      BubbleOpen {\n    const newEvent =\n        super.fromJson(json, workspace, event ?? new BubbleOpen()) as\n        BubbleOpen;\n    newEvent.isOpen = json['isOpen'];\n    newEvent.bubbleType = json['bubbleType'];\n    newEvent.blockId = json['blockId'];\n    return newEvent;\n  }\n}\n\nexport enum BubbleType {\n  MUTATOR = 'mutator',\n  COMMENT = 'comment',\n  WARNING = 'warning',\n}\n\nexport interface BubbleOpenJson extends AbstractEventJson {\n  isOpen: boolean;\n  bubbleType: BubbleType;\n  blockId: string;\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.BUBBLE_OPEN, BubbleOpen);\n","/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing a scrollbar.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Scrollbar');\n\nimport * as browserEvents from './browser_events.js';\nimport * as Touch from './touch.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport type {Metrics} from './utils/metrics.js';\nimport {Svg} from './utils/svg.js';\nimport * as svgMath from './utils/svg_math.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/**\n * A note on units: most of the numbers that are in CSS pixels are scaled if the\n * scrollbar is in a mutator.\n */\n\n/**\n * Class for a pure SVG scrollbar.\n * This technique offers a scrollbar that is guaranteed to work, but may not\n * look or behave like the system's scrollbars.\n *\n * @alias Blockly.Scrollbar\n */\nexport class Scrollbar {\n  /**\n   * Width of vertical scrollbar or height of horizontal scrollbar in CSS\n   * pixels. Scrollbars should be larger on touch devices.\n   */\n  static scrollbarThickness = Touch.TOUCH_ENABLED ? 25 : 15;\n\n  /**\n   * Default margin around the scrollbar (between the scrollbar and the edge of\n   * the viewport in pixels).\n   *\n   * @internal\n   */\n  static readonly DEFAULT_SCROLLBAR_MARGIN = 0.5;\n\n  /** Whether this scrollbar is part of a pair. */\n  private readonly pair: boolean;\n\n  /**\n   * Margin around the scrollbar (between the scrollbar and the edge of the\n   * viewport in pixels).\n   */\n  private readonly margin: number;\n\n  /** Previously recorded metrics from the workspace. */\n  private oldHostMetrics: Metrics|null = null;\n\n  /**\n   * The ratio of handle position offset to workspace content displacement.\n   *\n   * @internal\n   */\n  ratio = 1;\n\n  /**\n   * The location of the origin of the workspace that the scrollbar is in,\n   * measured in CSS pixels relative to the injection div origin.  This is\n   * usually (0, 0).  When the scrollbar is in a flyout it may have a\n   * different origin.\n   */\n  private origin = new Coordinate(0, 0);\n\n  /**\n   * The position of the mouse along this scrollbar's major axis at the start\n   * of the most recent drag. Units are CSS pixels, with (0, 0) at the top\n   * left of the browser window. For a horizontal scrollbar this is the x\n   * coordinate of the mouse down event; for a vertical scrollbar it's the y\n   * coordinate of the mouse down event.\n   */\n  private startDragMouse = 0;\n\n  /**\n   * The length of the scrollbars (including the handle and the background),\n   * in CSS pixels. This is equivalent to scrollbar background length and the\n   * area within which the scrollbar handle can move.\n   */\n  private scrollbarLength = 0;\n\n  /** The length of the scrollbar handle in CSS pixels. */\n  private handleLength = 0;\n\n  /**\n   * The offset of the start of the handle from the scrollbar position, in CSS\n   * pixels.\n   */\n  private handlePosition = 0;\n\n  private startDragHandle = 0;\n\n  /** Whether the scrollbar handle is visible. */\n  private isHandleVisible = true;\n\n  /** Whether the workspace containing this scrollbar is visible. */\n  private containerVisible = true;\n\n  /** The transparent background behind the handle. */\n  private svgBackground: SVGRectElement;\n\n  /** The visible handle that can be dragged around. */\n  private svgHandle: SVGRectElement;\n\n  /** The outermost SVG element, which contains all parts of the scrollbar. */\n  private outerSvg: SVGSVGElement;\n\n  /**\n   * The upper left corner of the scrollbar's SVG group in CSS pixels relative\n   * to the scrollbar's origin.  This is usually relative to the injection div\n   * origin.\n   *\n   * @internal\n   */\n  position = new Coordinate(0, 0);\n\n  /**\n   * The DOM attribute that controls the length of the scrollbar. Different\n   * for horizontal and vertical scrollbars.\n   */\n  lengthAttribute_: string;\n\n  /**\n   * The DOM attribute that controls the position of the scrollbar.\n   * Different for horizontal and vertical scrollbars.\n   */\n  positionAttribute_: string;\n\n  /** Handler for mouse down events on the background of the scrollbar. */\n  onMouseDownBarWrapper_: browserEvents.Data;\n\n  /** Handler for mouse down events on the handle of the scrollbar. */\n  onMouseDownHandleWrapper_: browserEvents.Data;\n\n  /** Handler for mouse move events during scrollbar drags. */\n  onMouseUpWrapper_: browserEvents.Data|null = null;\n\n  /** Handler for mouse up events to end scrollbar drags. */\n  onMouseMoveWrapper_: browserEvents.Data|null = null;\n\n  /**\n   * @param workspace Workspace to bind the scrollbar to.\n   * @param horizontal True if horizontal, false if vertical.\n   * @param opt_pair True if scrollbar is part of a horiz/vert pair.\n   * @param opt_class A class to be applied to this scrollbar.\n   * @param opt_margin The margin to apply to this scrollbar.\n   */\n  constructor(\n      private workspace: WorkspaceSvg, private readonly horizontal: boolean,\n      opt_pair?: boolean, opt_class?: string, opt_margin?: number) {\n    this.pair = opt_pair || false;\n\n    this.margin = opt_margin !== undefined ? opt_margin :\n                                             Scrollbar.DEFAULT_SCROLLBAR_MARGIN;\n\n    let className =\n        'blocklyScrollbar' + (this.horizontal ? 'Horizontal' : 'Vertical');\n    if (opt_class) {\n      className += ' ' + opt_class;\n    }\n\n    /* Create the following DOM:\n      <svg class=\"blocklyScrollbarHorizontal optionalClass\">\n        <g>\n          <rect class=\"blocklyScrollbarBackground\" />\n          <rect class=\"blocklyScrollbarHandle\" rx=\"8\" ry=\"8\" />\n        </g>\n      </svg>\n    */\n    this.outerSvg = dom.createSvgElement(Svg.SVG, {'class': className});\n    // Child group to hold the handle and background together.\n    const group = dom.createSvgElement(Svg.G, {}, this.outerSvg);\n\n    this.svgBackground = dom.createSvgElement(\n        Svg.RECT, {'class': 'blocklyScrollbarBackground'}, group);\n\n    const radius = Math.floor((Scrollbar.scrollbarThickness - 5) / 2);\n    this.svgHandle = dom.createSvgElement(\n        Svg.RECT,\n        {'class': 'blocklyScrollbarHandle', 'rx': radius, 'ry': radius}, group);\n\n    this.workspace.getThemeManager().subscribe(\n        this.svgHandle, 'scrollbarColour', 'fill');\n    this.workspace.getThemeManager().subscribe(\n        this.svgHandle, 'scrollbarOpacity', 'fill-opacity');\n\n    // Add everything to the DOM.\n    dom.insertAfter(this.outerSvg, this.workspace.getParentSvg());\n\n    this.setInitialThickness();\n\n    if (horizontal) {\n      this.lengthAttribute_ = 'width';\n      this.positionAttribute_ = 'x';\n    } else {\n      this.lengthAttribute_ = 'height';\n      this.positionAttribute_ = 'y';\n    }\n\n    this.onMouseDownBarWrapper_ = browserEvents.conditionalBind(\n        this.svgBackground, 'pointerdown', this, this.onMouseDownBar);\n    this.onMouseDownHandleWrapper_ = browserEvents.conditionalBind(\n        this.svgHandle, 'pointerdown', this, this.onMouseDownHandle);\n  }\n\n  /**\n   * Set the size of the scrollbar DOM elements along the minor axis.\n   */\n  private setInitialThickness() {\n    const scrollbarThickness = Scrollbar.scrollbarThickness;\n    if (this.horizontal) {\n      this.svgBackground.setAttribute('height', String(scrollbarThickness));\n      this.outerSvg.setAttribute('height', String(scrollbarThickness));\n      this.svgHandle.setAttribute('height', String(scrollbarThickness - 5));\n      this.svgHandle.setAttribute('y', String(2.5));\n    } else {\n      this.svgBackground.setAttribute('width', String(scrollbarThickness));\n      this.outerSvg.setAttribute('width', String(scrollbarThickness));\n      this.svgHandle.setAttribute('width', String(scrollbarThickness - 5));\n      this.svgHandle.setAttribute('x', String(2.5));\n    }\n  }\n\n  /**\n   * Dispose of this scrollbar. Remove DOM elements, event listeners,\n   * and theme subscriptions.\n   *\n   * @suppress {checkTypes}\n   */\n  dispose() {\n    this.cleanUp();\n    browserEvents.unbind(this.onMouseDownBarWrapper_);\n    browserEvents.unbind(this.onMouseDownHandleWrapper_);\n\n    dom.removeNode(this.outerSvg);\n    this.workspace.getThemeManager().unsubscribe(this.svgHandle);\n  }\n\n  /**\n   * Constrain the handle's length within the minimum (0) and maximum\n   * (scrollbar background) values allowed for the scrollbar.\n   *\n   * @param value Value that is potentially out of bounds, in CSS pixels.\n   * @returns Constrained value, in CSS pixels.\n   */\n  private constrainHandleLength(value: number): number {\n    if (value <= 0 || isNaN(value)) {\n      value = 0;\n    } else {\n      value = Math.min(value, this.scrollbarLength);\n    }\n    return value;\n  }\n\n  /**\n   * Set the length of the scrollbar's handle and change the SVG attribute\n   * accordingly.\n   *\n   * @param newLength The new scrollbar handle length in CSS pixels.\n   */\n  private setHandleLength(newLength: number) {\n    this.handleLength = newLength;\n    this.svgHandle.setAttribute(\n        this.lengthAttribute_, String(this.handleLength));\n  }\n\n  /**\n   * Constrain the handle's position within the minimum (0) and maximum values\n   * allowed for the scrollbar.\n   *\n   * @param value Value that is potentially out of bounds, in CSS pixels.\n   * @returns Constrained value, in CSS pixels.\n   */\n  private constrainHandlePosition(value: number): number {\n    if (value <= 0 || isNaN(value)) {\n      value = 0;\n    } else {\n      // Handle length should never be greater than this.scrollbarLength_.\n      // If the viewSize is greater than or equal to the scrollSize, the\n      // handleLength will end up equal to this.scrollbarLength_.\n      value = Math.min(value, this.scrollbarLength - this.handleLength);\n    }\n    return value;\n  }\n\n  /**\n   * Set the offset of the scrollbar's handle from the scrollbar's position, and\n   * change the SVG attribute accordingly.\n   *\n   * @param newPosition The new scrollbar handle offset in CSS pixels.\n   */\n  setHandlePosition(newPosition: number) {\n    this.handlePosition = newPosition;\n    this.svgHandle.setAttribute(\n        this.positionAttribute_, String(this.handlePosition));\n  }\n\n  /**\n   * Set the size of the scrollbar's background and change the SVG attribute\n   * accordingly.\n   *\n   * @param newSize The new scrollbar background length in CSS pixels.\n   */\n  private setScrollbarLength(newSize: number) {\n    this.scrollbarLength = newSize;\n    this.outerSvg.setAttribute(\n        this.lengthAttribute_, String(this.scrollbarLength));\n    this.svgBackground.setAttribute(\n        this.lengthAttribute_, String(this.scrollbarLength));\n  }\n\n  /**\n   * Set the position of the scrollbar's SVG group in CSS pixels relative to the\n   * scrollbar's origin.  This sets the scrollbar's location within the\n   * workspace.\n   *\n   * @param x The new x coordinate.\n   * @param y The new y coordinate.\n   * @internal\n   */\n  setPosition(x: number, y: number) {\n    this.position.x = x;\n    this.position.y = y;\n\n    const tempX = this.position.x + this.origin.x;\n    const tempY = this.position.y + this.origin.y;\n    const transform = 'translate(' + tempX + 'px,' + tempY + 'px)';\n    dom.setCssTransform(this.outerSvg, transform);\n  }\n\n  /**\n   * Recalculate the scrollbar's location and its length.\n   *\n   * @param opt_metrics A data structure of from the describing all the required\n   *     dimensions.  If not provided, it will be fetched from the host object.\n   */\n  resize(opt_metrics?: Metrics) {\n    // Determine the location, height and width of the host element.\n    let hostMetrics = opt_metrics;\n    if (!hostMetrics) {\n      hostMetrics = this.workspace.getMetrics();\n      if (!hostMetrics) {\n        // Host element is likely not visible.\n        return;\n      }\n    }\n\n    if (this.oldHostMetrics &&\n        Scrollbar.metricsAreEquivalent(hostMetrics, this.oldHostMetrics)) {\n      return;\n    }\n\n    if (this.horizontal) {\n      this.resizeHorizontal(hostMetrics);\n    } else {\n      this.resizeVertical(hostMetrics);\n    }\n\n    this.oldHostMetrics = hostMetrics;\n\n    // Resizing may have caused some scrolling.\n    this.updateMetrics();\n  }\n\n  /**\n   * Returns whether the a resizeView is necessary by comparing the passed\n   * hostMetrics with cached old host metrics.\n   *\n   * @param hostMetrics A data structure describing all the required dimensions,\n   *     possibly fetched from the host object.\n   * @returns Whether a resizeView is necessary.\n   */\n  private requiresViewResize(hostMetrics: Metrics): boolean {\n    if (!this.oldHostMetrics) {\n      return true;\n    }\n    return this.oldHostMetrics.viewWidth !== hostMetrics.viewWidth ||\n        this.oldHostMetrics.viewHeight !== hostMetrics.viewHeight ||\n        this.oldHostMetrics.absoluteLeft !== hostMetrics.absoluteLeft ||\n        this.oldHostMetrics.absoluteTop !== hostMetrics.absoluteTop;\n  }\n\n  /**\n   * Recalculate a horizontal scrollbar's location and length.\n   *\n   * @param hostMetrics A data structure describing all the required dimensions,\n   *     possibly fetched from the host object.\n   */\n  private resizeHorizontal(hostMetrics: Metrics) {\n    if (this.requiresViewResize(hostMetrics)) {\n      this.resizeViewHorizontal(hostMetrics);\n    } else {\n      this.resizeContentHorizontal(hostMetrics);\n    }\n  }\n\n  /**\n   * Recalculate a horizontal scrollbar's location on the screen and path\n   * length. This should be called when the layout or size of the window has\n   * changed.\n   *\n   * @param hostMetrics A data structure describing all the required dimensions,\n   *     possibly fetched from the host object.\n   */\n  resizeViewHorizontal(hostMetrics: Metrics) {\n    let viewSize = hostMetrics.viewWidth - this.margin * 2;\n    if (this.pair) {\n      // Shorten the scrollbar to make room for the corner square.\n      viewSize -= Scrollbar.scrollbarThickness;\n    }\n    this.setScrollbarLength(Math.max(0, viewSize));\n\n    let xCoordinate = hostMetrics.absoluteLeft + this.margin;\n    if (this.pair && this.workspace.RTL) {\n      xCoordinate += Scrollbar.scrollbarThickness;\n    }\n\n    // Horizontal toolbar should always be just above the bottom of the\n    // workspace.\n    const yCoordinate = hostMetrics.absoluteTop + hostMetrics.viewHeight -\n        Scrollbar.scrollbarThickness - this.margin;\n    this.setPosition(xCoordinate, yCoordinate);\n\n    // If the view has been resized, a content resize will also be necessary.\n    // The reverse is not true.\n    this.resizeContentHorizontal(hostMetrics);\n  }\n\n  /**\n   * Recalculate a horizontal scrollbar's location within its path and length.\n   * This should be called when the contents of the workspace have changed.\n   *\n   * @param hostMetrics A data structure describing all the required dimensions,\n   *     possibly fetched from the host object.\n   */\n  resizeContentHorizontal(hostMetrics: Metrics) {\n    if (hostMetrics.viewWidth >= hostMetrics.scrollWidth) {\n      // viewWidth is often greater than scrollWidth in flyouts and\n      // non-scrollable workspaces.\n      this.setHandleLength(this.scrollbarLength);\n      this.setHandlePosition(0);\n      if (!this.pair) {\n        // The scrollbar isn't needed.\n        // This doesn't apply to scrollbar pairs because interactions with the\n        // corner square aren't handled.\n        this.setVisible(false);\n      }\n      return;\n    } else if (!this.pair) {\n      // The scrollbar is needed. Only non-paired scrollbars are hidden/shown.\n      this.setVisible(true);\n    }\n\n    // Resize the handle.\n    let handleLength =\n        this.scrollbarLength * hostMetrics.viewWidth / hostMetrics.scrollWidth;\n    handleLength = this.constrainHandleLength(handleLength);\n    this.setHandleLength(handleLength);\n\n    // Compute the handle offset.\n    // The position of the handle can be between:\n    //     0 and this.scrollbarLength_ - handleLength\n    // If viewLeft === scrollLeft\n    //     then the offset should be 0\n    // If viewRight === scrollRight\n    //     then viewLeft = scrollLeft + scrollWidth - viewWidth\n    //     then the offset should be max offset\n\n    const maxScrollDistance = hostMetrics.scrollWidth - hostMetrics.viewWidth;\n    const contentDisplacement = hostMetrics.viewLeft - hostMetrics.scrollLeft;\n    // Percent of content to the left of our current position.\n    const offsetRatio = contentDisplacement / maxScrollDistance;\n    // Area available to scroll * percent to the left\n    const maxHandleOffset = this.scrollbarLength - this.handleLength;\n    let handleOffset = maxHandleOffset * offsetRatio;\n    handleOffset = this.constrainHandlePosition(handleOffset);\n    this.setHandlePosition(handleOffset);\n\n    // Compute ratio (for use with set calls, which pass in content\n    // displacement).\n    this.ratio = maxHandleOffset / maxScrollDistance;\n  }\n\n  /**\n   * Recalculate a vertical scrollbar's location and length.\n   *\n   * @param hostMetrics A data structure describing all the required dimensions,\n   *     possibly fetched from the host object.\n   */\n  private resizeVertical(hostMetrics: Metrics) {\n    if (this.requiresViewResize(hostMetrics)) {\n      this.resizeViewVertical(hostMetrics);\n    } else {\n      this.resizeContentVertical(hostMetrics);\n    }\n  }\n\n  /**\n   * Recalculate a vertical scrollbar's location on the screen and path length.\n   * This should be called when the layout or size of the window has changed.\n   *\n   * @param hostMetrics A data structure describing all the required dimensions,\n   *     possibly fetched from the host object.\n   */\n  resizeViewVertical(hostMetrics: Metrics) {\n    let viewSize = hostMetrics.viewHeight - this.margin * 2;\n    if (this.pair) {\n      // Shorten the scrollbar to make room for the corner square.\n      viewSize -= Scrollbar.scrollbarThickness;\n    }\n    this.setScrollbarLength(Math.max(0, viewSize));\n\n    const xCoordinate = this.workspace.RTL ?\n        hostMetrics.absoluteLeft + this.margin :\n        hostMetrics.absoluteLeft + hostMetrics.viewWidth -\n            Scrollbar.scrollbarThickness - this.margin;\n\n    const yCoordinate = hostMetrics.absoluteTop + this.margin;\n    this.setPosition(xCoordinate, yCoordinate);\n\n    // If the view has been resized, a content resize will also be necessary.\n    // The reverse is not true.\n    this.resizeContentVertical(hostMetrics);\n  }\n\n  /**\n   * Recalculate a vertical scrollbar's location within its path and length.\n   * This should be called when the contents of the workspace have changed.\n   *\n   * @param hostMetrics A data structure describing all the required dimensions,\n   *     possibly fetched from the host object.\n   */\n  resizeContentVertical(hostMetrics: Metrics) {\n    if (hostMetrics.viewHeight >= hostMetrics.scrollHeight) {\n      // viewHeight is often greater than scrollHeight in flyouts and\n      // non-scrollable workspaces.\n      this.setHandleLength(this.scrollbarLength);\n      this.setHandlePosition(0);\n      if (!this.pair) {\n        // The scrollbar isn't needed.\n        // This doesn't apply to scrollbar pairs because interactions with the\n        // corner square aren't handled.\n        this.setVisible(false);\n      }\n      return;\n    } else if (!this.pair) {\n      // The scrollbar is needed. Only non-paired scrollbars are hidden/shown.\n      this.setVisible(true);\n    }\n\n    // Resize the handle.\n    let handleLength = this.scrollbarLength * hostMetrics.viewHeight /\n        hostMetrics.scrollHeight;\n    handleLength = this.constrainHandleLength(handleLength);\n    this.setHandleLength(handleLength);\n\n    // Compute the handle offset.\n    // The position of the handle can be between:\n    //     0 and this.scrollbarLength_ - handleLength\n    // If viewTop === scrollTop\n    //     then the offset should be 0\n    // If viewBottom === scrollBottom\n    //     then viewTop = scrollTop + scrollHeight - viewHeight\n    //     then the offset should be max offset\n\n    const maxScrollDistance = hostMetrics.scrollHeight - hostMetrics.viewHeight;\n    const contentDisplacement = hostMetrics.viewTop - hostMetrics.scrollTop;\n    // Percent of content to the left of our current position.\n    const offsetRatio = contentDisplacement / maxScrollDistance;\n    // Area available to scroll * percent to the left\n    const maxHandleOffset = this.scrollbarLength - this.handleLength;\n    let handleOffset = maxHandleOffset * offsetRatio;\n    handleOffset = this.constrainHandlePosition(handleOffset);\n    this.setHandlePosition(handleOffset);\n\n    // Compute ratio (for use with set calls, which pass in content\n    // displacement).\n    this.ratio = maxHandleOffset / maxScrollDistance;\n  }\n\n  /**\n   * Is the scrollbar visible.  Non-paired scrollbars disappear when they aren't\n   * needed.\n   *\n   * @returns True if visible.\n   */\n  isVisible(): boolean {\n    return this.isHandleVisible;\n  }\n\n  /**\n   * Set whether the scrollbar's container is visible and update\n   * display accordingly if visibility has changed.\n   *\n   * @param visible Whether the container is visible\n   */\n  setContainerVisible(visible: boolean) {\n    const visibilityChanged = visible !== this.containerVisible;\n\n    this.containerVisible = visible;\n    if (visibilityChanged) {\n      this.updateDisplay_();\n    }\n  }\n\n  /**\n   * Set whether the scrollbar is visible.\n   * Only applies to non-paired scrollbars.\n   *\n   * @param visible True if visible.\n   */\n  setVisible(visible: boolean) {\n    const visibilityChanged = visible !== this.isVisible();\n\n    // Ideally this would also apply to scrollbar pairs, but that's a bigger\n    // headache (due to interactions with the corner square).\n    if (this.pair) {\n      throw Error('Unable to toggle visibility of paired scrollbars.');\n    }\n    this.isHandleVisible = visible;\n    if (visibilityChanged) {\n      this.updateDisplay_();\n    }\n  }\n\n  /**\n   * Update visibility of scrollbar based on whether it thinks it should\n   * be visible and whether its containing workspace is visible.\n   * We cannot rely on the containing workspace being hidden to hide us\n   * because it is not necessarily our parent in the DOM.\n   */\n  updateDisplay_() {\n    let show = true;\n    // Check whether our parent/container is visible.\n    if (!this.containerVisible) {\n      show = false;\n    } else {\n      show = this.isVisible();\n    }\n    if (show) {\n      this.outerSvg.setAttribute('display', 'block');\n    } else {\n      this.outerSvg.setAttribute('display', 'none');\n    }\n  }\n\n  /**\n   * Scroll by one pageful.\n   * Called when scrollbar background is clicked.\n   *\n   * @param e Mouse down event.\n   */\n  private onMouseDownBar(e: MouseEvent) {\n    this.workspace.markFocused();\n    Touch.clearTouchIdentifier();  // This is really a click.\n    this.cleanUp();\n    if (browserEvents.isRightButton(e)) {\n      // Right-click.\n      // Scrollbars have no context menu.\n      e.stopPropagation();\n      return;\n    }\n    const mouseXY = browserEvents.mouseToSvg(\n        e, this.workspace.getParentSvg(), this.workspace.getInverseScreenCTM());\n    const mouseLocation = this.horizontal ? mouseXY.x : mouseXY.y;\n\n    const handleXY = svgMath.getInjectionDivXY(this.svgHandle);\n    const handleStart = this.horizontal ? handleXY.x : handleXY.y;\n    let handlePosition = this.handlePosition;\n\n    const pageLength = this.handleLength * 0.95;\n    if (mouseLocation <= handleStart) {\n      // Decrease the scrollbar's value by a page.\n      handlePosition -= pageLength;\n    } else if (mouseLocation >= handleStart + this.handleLength) {\n      // Increase the scrollbar's value by a page.\n      handlePosition += pageLength;\n    }\n\n    this.setHandlePosition(this.constrainHandlePosition(handlePosition));\n\n    this.updateMetrics();\n    e.stopPropagation();\n    e.preventDefault();\n  }\n\n  /**\n   * Start a dragging operation.\n   * Called when scrollbar handle is clicked.\n   *\n   * @param e Mouse down event.\n   */\n  private onMouseDownHandle(e: PointerEvent) {\n    this.workspace.markFocused();\n    this.cleanUp();\n    if (browserEvents.isRightButton(e)) {\n      // Right-click.\n      // Scrollbars have no context menu.\n      e.stopPropagation();\n      return;\n    }\n    // Look up the current translation and record it.\n    this.startDragHandle = this.handlePosition;\n\n    // Tell the workspace to setup its drag surface since it is about to move.\n    // onMouseMoveHandle will call onScroll which actually tells the workspace\n    // to move.\n    this.workspace.setupDragSurface();\n\n    // Record the current mouse position.\n    this.startDragMouse = this.horizontal ? e.clientX : e.clientY;\n    this.onMouseUpWrapper_ = browserEvents.conditionalBind(\n        document, 'pointerup', this, this.onMouseUpHandle);\n    this.onMouseMoveWrapper_ = browserEvents.conditionalBind(\n        document, 'pointermove', this, this.onMouseMoveHandle);\n    e.stopPropagation();\n    e.preventDefault();\n  }\n\n  /**\n   * Drag the scrollbar's handle.\n   *\n   * @param e Mouse move event.\n   */\n  private onMouseMoveHandle(e: PointerEvent) {\n    const currentMouse = this.horizontal ? e.clientX : e.clientY;\n    const mouseDelta = currentMouse - this.startDragMouse;\n    const handlePosition = this.startDragHandle + mouseDelta;\n    // Position the bar.\n    this.setHandlePosition(this.constrainHandlePosition(handlePosition));\n    this.updateMetrics();\n  }\n\n  /** Release the scrollbar handle and reset state accordingly. */\n  private onMouseUpHandle() {\n    // Tell the workspace to clean up now that the workspace is done moving.\n    this.workspace.resetDragSurface();\n    Touch.clearTouchIdentifier();\n    this.cleanUp();\n  }\n\n  /**\n   * Hide chaff and stop binding to mouseup and mousemove events.  Call this to\n   * wrap up loose ends associated with the scrollbar.\n   */\n  private cleanUp() {\n    this.workspace.hideChaff(true);\n    if (this.onMouseUpWrapper_) {\n      browserEvents.unbind(this.onMouseUpWrapper_);\n      this.onMouseUpWrapper_ = null;\n    }\n    if (this.onMouseMoveWrapper_) {\n      browserEvents.unbind(this.onMouseMoveWrapper_);\n      this.onMouseMoveWrapper_ = null;\n    }\n  }\n\n  /**\n   * Helper to calculate the ratio of handle position to scrollbar view size.\n   *\n   * @returns Ratio.\n   * @internal\n   */\n  getRatio_(): number {\n    const scrollHandleRange = this.scrollbarLength - this.handleLength;\n    let ratio = this.handlePosition / scrollHandleRange;\n    if (isNaN(ratio)) {\n      ratio = 0;\n    }\n    return ratio;\n  }\n\n  /**\n   * Updates workspace metrics based on new scroll ratio. Called when scrollbar\n   * is moved.\n   */\n  private updateMetrics() {\n    const ratio = this.getRatio_();\n    if (this.horizontal) {\n      this.workspace.setMetrics({x: ratio});\n    } else {\n      this.workspace.setMetrics({y: ratio});\n    }\n  }\n\n  /**\n   * Set the scrollbar handle's position.\n   *\n   * @param value The content displacement, relative to the view in pixels.\n   * @param updateMetrics Whether to update metrics on this set call.\n   *    Defaults to true.\n   */\n  set(value: number, updateMetrics?: boolean) {\n    this.setHandlePosition(this.constrainHandlePosition(value * this.ratio));\n    if (updateMetrics || updateMetrics === undefined) {\n      this.updateMetrics();\n    }\n  }\n\n  /**\n   * Record the origin of the workspace that the scrollbar is in, in pixels\n   * relative to the injection div origin. This is for times when the scrollbar\n   * is used in an object whose origin isn't the same as the main workspace\n   * (e.g. in a flyout.)\n   *\n   * @param x The x coordinate of the scrollbar's origin, in CSS pixels.\n   * @param y The y coordinate of the scrollbar's origin, in CSS pixels.\n   */\n  setOrigin(x: number, y: number) {\n    this.origin = new Coordinate(x, y);\n  }\n\n  /**\n   * @param first An object containing computed measurements of a workspace.\n   * @param second Another object containing computed measurements of a\n   *     workspace.\n   * @returns Whether the two sets of metrics are equivalent.\n   */\n  private static metricsAreEquivalent(first: Metrics, second: Metrics):\n      boolean {\n    return first.viewWidth === second.viewWidth &&\n        first.viewHeight === second.viewHeight &&\n        first.viewLeft === second.viewLeft &&\n        first.viewTop === second.viewTop &&\n        first.absoluteTop === second.absoluteTop &&\n        first.absoluteLeft === second.absoluteLeft &&\n        first.scrollWidth === second.scrollWidth &&\n        first.scrollHeight === second.scrollHeight &&\n        first.scrollLeft === second.scrollLeft &&\n        first.scrollTop === second.scrollTop;\n  }\n}\n","/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing a UI bubble.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Bubble');\n\nimport type {BlockDragSurfaceSvg} from './block_drag_surface.js';\nimport type {BlockSvg} from './block_svg.js';\nimport * as browserEvents from './browser_events.js';\nimport type {IBubble} from './interfaces/i_bubble.js';\nimport type {ContainerRegion} from './metrics_manager.js';\nimport {Scrollbar} from './scrollbar.js';\nimport * as Touch from './touch.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport * as math from './utils/math.js';\nimport {Size} from './utils/size.js';\nimport {Svg} from './utils/svg.js';\nimport * as userAgent from './utils/useragent.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/**\n * Class for UI bubble.\n *\n * @alias Blockly.Bubble\n */\nexport class Bubble implements IBubble {\n  /** Width of the border around the bubble. */\n  static BORDER_WIDTH = 6;\n\n  /**\n   * Determines the thickness of the base of the arrow in relation to the size\n   * of the bubble.  Higher numbers result in thinner arrows.\n   */\n  static ARROW_THICKNESS = 5;\n\n  /** The number of degrees that the arrow bends counter-clockwise. */\n  static ARROW_ANGLE = 20;\n\n  /**\n   * The sharpness of the arrow's bend.  Higher numbers result in smoother\n   * arrows.\n   */\n  static ARROW_BEND = 4;\n\n  /** Distance between arrow point and anchor point. */\n  static ANCHOR_RADIUS = 8;\n\n  /** Mouse up event data. */\n  private static onMouseUpWrapper: browserEvents.Data|null = null;\n\n  /** Mouse move event data. */\n  private static onMouseMoveWrapper: browserEvents.Data|null = null;\n\n  workspace_: WorkspaceSvg;\n  content_: SVGElement;\n  shape_: SVGElement;\n\n  /** Flag to stop incremental rendering during construction. */\n  private readonly rendered: boolean;\n\n  /** The SVG group containing all parts of the bubble. */\n  private bubbleGroup: SVGGElement|null = null;\n\n  /**\n   * The SVG path for the arrow from the bubble to the icon on the block.\n   */\n  private bubbleArrow: SVGPathElement|null = null;\n\n  /** The SVG rect for the main body of the bubble. */\n  private bubbleBack: SVGRectElement|null = null;\n\n  /** The SVG group for the resize hash marks on some bubbles. */\n  private resizeGroup: SVGGElement|null = null;\n\n  /** Absolute coordinate of anchor point, in workspace coordinates. */\n  private anchorXY!: Coordinate;\n\n  /**\n   * Relative X coordinate of bubble with respect to the anchor's centre,\n   * in workspace units.\n   * In RTL mode the initial value is negated.\n   */\n  private relativeLeft = 0;\n\n  /**\n   * Relative Y coordinate of bubble with respect to the anchor's centre, in\n   * workspace units.\n   */\n  private relativeTop = 0;\n\n  /** Width of bubble, in workspace units. */\n  private width = 0;\n\n  /** Height of bubble, in workspace units. */\n  private height = 0;\n\n  /** Automatically position and reposition the bubble. */\n  private autoLayout = true;\n\n  /** Method to call on resize of bubble. */\n  private resizeCallback: (() => void)|null = null;\n\n  /** Method to call on move of bubble. */\n  private moveCallback: (() => void)|null = null;\n\n  /** Mouse down on bubbleBack event data. */\n  private onMouseDownBubbleWrapper: browserEvents.Data|null = null;\n\n  /** Mouse down on resizeGroup event data. */\n  private onMouseDownResizeWrapper: browserEvents.Data|null = null;\n\n  /**\n   * Describes whether this bubble has been disposed of (nodes and event\n   * listeners removed from the page) or not.\n   *\n   * @internal\n   */\n  disposed = false;\n  private arrowRadians: number;\n\n  /**\n   * @param workspace The workspace on which to draw the bubble.\n   * @param content SVG content for the bubble.\n   * @param shape SVG element to avoid eclipsing.\n   * @param anchorXY Absolute position of bubble's anchor point.\n   * @param bubbleWidth Width of bubble, or null if not resizable.\n   * @param bubbleHeight Height of bubble, or null if not resizable.\n   */\n  constructor(\n      workspace: WorkspaceSvg, content: SVGElement, shape: SVGElement,\n      anchorXY: Coordinate, bubbleWidth: number|null,\n      bubbleHeight: number|null) {\n    this.rendered = false;\n    this.workspace_ = workspace;\n    this.content_ = content;\n    this.shape_ = shape;\n\n    let angle = Bubble.ARROW_ANGLE;\n    if (this.workspace_.RTL) {\n      angle = -angle;\n    }\n    this.arrowRadians = math.toRadians(angle);\n\n    const canvas = workspace.getBubbleCanvas();\n    canvas.appendChild(\n        this.createDom(content, !!(bubbleWidth && bubbleHeight)));\n\n    this.setAnchorLocation(anchorXY);\n    if (!bubbleWidth || !bubbleHeight) {\n      const bBox = (this.content_ as SVGGraphicsElement).getBBox();\n      bubbleWidth = bBox.width + 2 * Bubble.BORDER_WIDTH;\n      bubbleHeight = bBox.height + 2 * Bubble.BORDER_WIDTH;\n    }\n    this.setBubbleSize(bubbleWidth, bubbleHeight);\n\n    // Render the bubble.\n    this.positionBubble();\n    this.renderArrow();\n    this.rendered = true;\n  }\n\n  /**\n   * Create the bubble's DOM.\n   *\n   * @param content SVG content for the bubble.\n   * @param hasResize Add diagonal resize gripper if true.\n   * @returns The bubble's SVG group.\n   */\n  private createDom(content: Element, hasResize: boolean): SVGElement {\n    /* Create the bubble.  Here's the markup that will be generated:\n        <g>\n          <g filter=\"url(#blocklyEmbossFilter837493)\">\n            <path d=\"... Z\" />\n            <rect class=\"blocklyDraggable\" rx=\"8\" ry=\"8\" width=\"180\"\n       height=\"180\"/>\n          </g>\n          <g transform=\"translate(165, 165)\" class=\"blocklyResizeSE\">\n            <polygon points=\"0,15 15,15 15,0\"/>\n            <line class=\"blocklyResizeLine\" x1=\"5\" y1=\"14\" x2=\"14\" y2=\"5\"/>\n            <line class=\"blocklyResizeLine\" x1=\"10\" y1=\"14\" x2=\"14\" y2=\"10\"/>\n          </g>\n          [...content goes here...]\n        </g>\n        */\n    this.bubbleGroup = dom.createSvgElement(Svg.G, {});\n    let filter: {filter?: string} = {\n      'filter': 'url(#' +\n          this.workspace_.getRenderer().getConstants().embossFilterId + ')',\n    };\n    if (userAgent.JavaFx) {\n      // Multiple reports that JavaFX can't handle filters.\n      // https://github.com/google/blockly/issues/99\n      filter = {};\n    }\n    const bubbleEmboss = dom.createSvgElement(Svg.G, filter, this.bubbleGroup);\n    this.bubbleArrow = dom.createSvgElement(Svg.PATH, {}, bubbleEmboss);\n    this.bubbleBack = dom.createSvgElement(\n        Svg.RECT, {\n          'class': 'blocklyDraggable',\n          'x': 0,\n          'y': 0,\n          'rx': Bubble.BORDER_WIDTH,\n          'ry': Bubble.BORDER_WIDTH,\n        },\n        bubbleEmboss);\n    if (hasResize) {\n      this.resizeGroup = dom.createSvgElement(\n          Svg.G, {\n            'class': this.workspace_.RTL ? 'blocklyResizeSW' :\n                                           'blocklyResizeSE',\n          },\n          this.bubbleGroup);\n      const resizeSize = 2 * Bubble.BORDER_WIDTH;\n      dom.createSvgElement(\n          Svg.POLYGON,\n          {'points': '0,x x,x x,0'.replace(/x/g, resizeSize.toString())},\n          this.resizeGroup);\n      dom.createSvgElement(\n          Svg.LINE, {\n            'class': 'blocklyResizeLine',\n            'x1': resizeSize / 3,\n            'y1': resizeSize - 1,\n            'x2': resizeSize - 1,\n            'y2': resizeSize / 3,\n          },\n          this.resizeGroup);\n      dom.createSvgElement(\n          Svg.LINE, {\n            'class': 'blocklyResizeLine',\n            'x1': resizeSize * 2 / 3,\n            'y1': resizeSize - 1,\n            'x2': resizeSize - 1,\n            'y2': resizeSize * 2 / 3,\n          },\n          this.resizeGroup);\n    } else {\n      this.resizeGroup = null;\n    }\n\n    if (!this.workspace_.options.readOnly) {\n      this.onMouseDownBubbleWrapper = browserEvents.conditionalBind(\n          this.bubbleBack, 'pointerdown', this, this.bubbleMouseDown);\n      if (this.resizeGroup) {\n        this.onMouseDownResizeWrapper = browserEvents.conditionalBind(\n            this.resizeGroup, 'pointerdown', this, this.resizeMouseDown);\n      }\n    }\n    this.bubbleGroup.appendChild(content);\n    return this.bubbleGroup;\n  }\n\n  /**\n   * Return the root node of the bubble's SVG group.\n   *\n   * @returns The root SVG node of the bubble's group.\n   */\n  getSvgRoot(): SVGElement {\n    return this.bubbleGroup as SVGElement;\n  }\n\n  /**\n   * Expose the block's ID on the bubble's top-level SVG group.\n   *\n   * @param id ID of block.\n   */\n  setSvgId(id: string) {\n    this.bubbleGroup?.setAttribute('data-block-id', id);\n  }\n\n  /**\n   * Handle a pointerdown on bubble's border.\n   *\n   * @param e Pointer down event.\n   */\n  private bubbleMouseDown(e: PointerEvent) {\n    const gesture = this.workspace_.getGesture(e);\n    if (gesture) {\n      gesture.handleBubbleStart(e, this);\n    }\n  }\n\n  /**\n   * Show the context menu for this bubble.\n   *\n   * @param _e Mouse event.\n   * @internal\n   */\n  showContextMenu(_e: Event) {}\n  // NOP on bubbles, but used by the bubble dragger to pass events to\n  // workspace comments.\n\n  /**\n   * Get whether this bubble is deletable or not.\n   *\n   * @returns True if deletable.\n   * @internal\n   */\n  isDeletable(): boolean {\n    return false;\n  }\n\n  /**\n   * Update the style of this bubble when it is dragged over a delete area.\n   *\n   * @param _enable True if the bubble is about to be deleted, false otherwise.\n   */\n  setDeleteStyle(_enable: boolean) {}\n  // NOP if bubble is not deletable.\n\n  /**\n   * Handle a pointerdown on bubble's resize corner.\n   *\n   * @param e Pointer down event.\n   */\n  private resizeMouseDown(e: PointerEvent) {\n    this.promote();\n    Bubble.unbindDragEvents();\n    if (browserEvents.isRightButton(e)) {\n      // No right-click.\n      e.stopPropagation();\n      return;\n    }\n    // Left-click (or middle click)\n    this.workspace_.startDrag(\n        e,\n        new Coordinate(\n            this.workspace_.RTL ? -this.width : this.width, this.height));\n\n    Bubble.onMouseUpWrapper = browserEvents.conditionalBind(\n        document, 'pointerup', this, Bubble.bubbleMouseUp);\n    Bubble.onMouseMoveWrapper = browserEvents.conditionalBind(\n        document, 'pointermove', this, this.resizeMouseMove);\n    this.workspace_.hideChaff();\n    // This event has been handled.  No need to bubble up to the document.\n    e.stopPropagation();\n  }\n\n  /**\n   * Resize this bubble to follow the pointer.\n   *\n   * @param e Pointer move event.\n   */\n  private resizeMouseMove(e: PointerEvent) {\n    this.autoLayout = false;\n    const newXY = this.workspace_.moveDrag(e);\n    this.setBubbleSize(this.workspace_.RTL ? -newXY.x : newXY.x, newXY.y);\n    if (this.workspace_.RTL) {\n      // RTL requires the bubble to move its left edge.\n      this.positionBubble();\n    }\n  }\n\n  /**\n   * Register a function as a callback event for when the bubble is resized.\n   *\n   * @param callback The function to call on resize.\n   */\n  registerResizeEvent(callback: () => void) {\n    this.resizeCallback = callback;\n  }\n\n  /**\n   * Register a function as a callback event for when the bubble is moved.\n   *\n   * @param callback The function to call on move.\n   */\n  registerMoveEvent(callback: () => void) {\n    this.moveCallback = callback;\n  }\n\n  /**\n   * Move this bubble to the top of the stack.\n   *\n   * @returns Whether or not the bubble has been moved.\n   * @internal\n   */\n  promote(): boolean {\n    const svgGroup = this.bubbleGroup?.parentNode;\n    if (svgGroup?.lastChild !== this.bubbleGroup && this.bubbleGroup) {\n      svgGroup?.appendChild(this.bubbleGroup);\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Notification that the anchor has moved.\n   * Update the arrow and bubble accordingly.\n   *\n   * @param xy Absolute location.\n   */\n  setAnchorLocation(xy: Coordinate) {\n    this.anchorXY = xy;\n    if (this.rendered) {\n      this.positionBubble();\n    }\n  }\n\n  /** Position the bubble so that it does not fall off-screen. */\n  private layoutBubble() {\n    // Get the metrics in workspace units.\n    const viewMetrics =\n        this.workspace_.getMetricsManager().getViewMetrics(true);\n\n    const optimalLeft = this.getOptimalRelativeLeft(viewMetrics);\n    const optimalTop = this.getOptimalRelativeTop(viewMetrics);\n    const bbox = (this.shape_ as SVGGraphicsElement).getBBox();\n\n    const topPosition = {\n      x: optimalLeft,\n      y: -this.height -\n              this.workspace_.getRenderer().getConstants().MIN_BLOCK_HEIGHT as\n          number,\n    };\n    const startPosition = {x: -this.width - 30, y: optimalTop};\n    const endPosition = {x: bbox.width, y: optimalTop};\n    const bottomPosition = {x: optimalLeft, y: bbox.height};\n\n    const closerPosition =\n        bbox.width < bbox.height ? endPosition : bottomPosition;\n    const fartherPosition =\n        bbox.width < bbox.height ? bottomPosition : endPosition;\n\n    const topPositionOverlap = this.getOverlap(topPosition, viewMetrics);\n    const startPositionOverlap = this.getOverlap(startPosition, viewMetrics);\n    const closerPositionOverlap = this.getOverlap(closerPosition, viewMetrics);\n    const fartherPositionOverlap =\n        this.getOverlap(fartherPosition, viewMetrics);\n\n    // Set the position to whichever position shows the most of the bubble,\n    // with tiebreaks going in the order: top > start > close > far.\n    const mostOverlap = Math.max(\n        topPositionOverlap, startPositionOverlap, closerPositionOverlap,\n        fartherPositionOverlap);\n    if (topPositionOverlap === mostOverlap) {\n      this.relativeLeft = topPosition.x;\n      this.relativeTop = topPosition.y;\n      return;\n    }\n    if (startPositionOverlap === mostOverlap) {\n      this.relativeLeft = startPosition.x;\n      this.relativeTop = startPosition.y;\n      return;\n    }\n    if (closerPositionOverlap === mostOverlap) {\n      this.relativeLeft = closerPosition.x;\n      this.relativeTop = closerPosition.y;\n      return;\n    }\n    // TODO: I believe relativeLeft_ should actually be called relativeStart_\n    //  and then the math should be fixed to reflect this. (hopefully it'll\n    //  make it look simpler)\n    this.relativeLeft = fartherPosition.x;\n    this.relativeTop = fartherPosition.y;\n  }\n\n  /**\n   * Calculate the what percentage of the bubble overlaps with the visible\n   * workspace (what percentage of the bubble is visible).\n   *\n   * @param relativeMin The position of the top-left corner of the bubble\n   *     relative to the anchor point.\n   * @param viewMetrics The view metrics of the workspace the bubble will appear\n   *     in.\n   * @returns The percentage of the bubble that is visible.\n   */\n  private getOverlap(\n      relativeMin: {x: number, y: number},\n      viewMetrics: ContainerRegion): number {\n    // The position of the top-left corner of the bubble in workspace units.\n    const bubbleMin = {\n      x: this.workspace_.RTL ? this.anchorXY.x - relativeMin.x - this.width :\n                               relativeMin.x + this.anchorXY.x,\n      y: relativeMin.y + this.anchorXY.y,\n    };\n    // The position of the bottom-right corner of the bubble in workspace units.\n    const bubbleMax = {\n      x: bubbleMin.x + this.width,\n      y: bubbleMin.y + this.height,\n    };\n\n    // We could adjust these values to account for the scrollbars, but the\n    // bubbles should have been adjusted to not collide with them anyway, so\n    // giving the workspace a slightly larger \"bounding box\" shouldn't affect\n    // the calculation.\n\n    // The position of the top-left corner of the workspace.\n    const workspaceMin = {x: viewMetrics.left, y: viewMetrics.top};\n    // The position of the bottom-right corner of the workspace.\n    const workspaceMax = {\n      x: viewMetrics.left + viewMetrics.width,\n      y: viewMetrics.top + viewMetrics.height,\n    };\n\n    const overlapWidth = Math.min(bubbleMax.x, workspaceMax.x) -\n        Math.max(bubbleMin.x, workspaceMin.x);\n    const overlapHeight = Math.min(bubbleMax.y, workspaceMax.y) -\n        Math.max(bubbleMin.y, workspaceMin.y);\n    return Math.max(\n        0,\n        Math.min(1, overlapWidth * overlapHeight / (this.width * this.height)));\n  }\n\n  /**\n   * Calculate what the optimal horizontal position of the top-left corner of\n   * the bubble is (relative to the anchor point) so that the most area of the\n   * bubble is shown.\n   *\n   * @param viewMetrics The view metrics of the workspace the bubble will appear\n   *     in.\n   * @returns The optimal horizontal position of the top-left corner of the\n   *     bubble.\n   */\n  private getOptimalRelativeLeft(viewMetrics: ContainerRegion): number {\n    let relativeLeft = -this.width / 4;\n\n    // No amount of sliding left or right will give us a better overlap.\n    if (this.width > viewMetrics.width) {\n      return relativeLeft;\n    }\n\n    if (this.workspace_.RTL) {\n      // Bubble coordinates are flipped in RTL.\n      const bubbleRight = this.anchorXY.x - relativeLeft;\n      const bubbleLeft = bubbleRight - this.width;\n\n      const workspaceRight = viewMetrics.left + viewMetrics.width;\n      const workspaceLeft = viewMetrics.left +\n          // Thickness in workspace units.\n          Scrollbar.scrollbarThickness / this.workspace_.scale;\n\n      if (bubbleLeft < workspaceLeft) {\n        // Slide the bubble right until it is onscreen.\n        relativeLeft = -(workspaceLeft - this.anchorXY.x + this.width);\n      } else if (bubbleRight > workspaceRight) {\n        // Slide the bubble left until it is onscreen.\n        relativeLeft = -(workspaceRight - this.anchorXY.x);\n      }\n    } else {\n      const bubbleLeft = relativeLeft + this.anchorXY.x;\n      const bubbleRight = bubbleLeft + this.width;\n\n      const workspaceLeft = viewMetrics.left;\n      const workspaceRight = viewMetrics.left + viewMetrics.width -\n          // Thickness in workspace units.\n          Scrollbar.scrollbarThickness / this.workspace_.scale;\n\n      if (bubbleLeft < workspaceLeft) {\n        // Slide the bubble right until it is onscreen.\n        relativeLeft = workspaceLeft - this.anchorXY.x;\n      } else if (bubbleRight > workspaceRight) {\n        // Slide the bubble left until it is onscreen.\n        relativeLeft = workspaceRight - this.anchorXY.x - this.width;\n      }\n    }\n\n    return relativeLeft;\n  }\n\n  /**\n   * Calculate what the optimal vertical position of the top-left corner of\n   * the bubble is (relative to the anchor point) so that the most area of the\n   * bubble is shown.\n   *\n   * @param viewMetrics The view metrics of the workspace the bubble will appear\n   *     in.\n   * @returns The optimal vertical position of the top-left corner of the\n   *     bubble.\n   */\n  private getOptimalRelativeTop(viewMetrics: ContainerRegion): number {\n    let relativeTop = -this.height / 4;\n\n    // No amount of sliding up or down will give us a better overlap.\n    if (this.height > viewMetrics.height) {\n      return relativeTop;\n    }\n\n    const bubbleTop = this.anchorXY.y + relativeTop;\n    const bubbleBottom = bubbleTop + this.height;\n    const workspaceTop = viewMetrics.top;\n    const workspaceBottom = viewMetrics.top +\n        viewMetrics.height -  // Thickness in workspace units.\n        Scrollbar.scrollbarThickness / this.workspace_.scale;\n\n    const anchorY = this.anchorXY.y;\n    if (bubbleTop < workspaceTop) {\n      // Slide the bubble down until it is onscreen.\n      relativeTop = workspaceTop - anchorY;\n    } else if (bubbleBottom > workspaceBottom) {\n      // Slide the bubble up until it is onscreen.\n      relativeTop = workspaceBottom - anchorY - this.height;\n    }\n\n    return relativeTop;\n  }\n\n  /** Move the bubble to a location relative to the anchor's centre. */\n  private positionBubble() {\n    let left = this.anchorXY.x;\n    if (this.workspace_.RTL) {\n      left -= this.relativeLeft + this.width;\n    } else {\n      left += this.relativeLeft;\n    }\n    const top = this.relativeTop + this.anchorXY.y;\n    this.moveTo(left, top);\n  }\n\n  /**\n   * Move the bubble group to the specified location in workspace coordinates.\n   *\n   * @param x The x position to move to.\n   * @param y The y position to move to.\n   * @internal\n   */\n  moveTo(x: number, y: number) {\n    this.bubbleGroup?.setAttribute(\n        'transform', 'translate(' + x + ',' + y + ')');\n  }\n\n  /**\n   * Triggers a move callback if one exists at the end of a drag.\n   *\n   * @param adding True if adding, false if removing.\n   * @internal\n   */\n  setDragging(adding: boolean) {\n    if (!adding && this.moveCallback) {\n      this.moveCallback();\n    }\n  }\n\n  /**\n   * Get the dimensions of this bubble.\n   *\n   * @returns The height and width of the bubble.\n   */\n  getBubbleSize(): Size {\n    return new Size(this.width, this.height);\n  }\n\n  /**\n   * Size this bubble.\n   *\n   * @param width Width of the bubble.\n   * @param height Height of the bubble.\n   */\n  setBubbleSize(width: number, height: number) {\n    const doubleBorderWidth = 2 * Bubble.BORDER_WIDTH;\n    // Minimum size of a bubble.\n    width = Math.max(width, doubleBorderWidth + 45);\n    height = Math.max(height, doubleBorderWidth + 20);\n    this.width = width;\n    this.height = height;\n    this.bubbleBack?.setAttribute('width', width.toString());\n    this.bubbleBack?.setAttribute('height', height.toString());\n    if (this.resizeGroup) {\n      if (this.workspace_.RTL) {\n        // Mirror the resize group.\n        const resizeSize = 2 * Bubble.BORDER_WIDTH;\n        this.resizeGroup.setAttribute(\n            'transform',\n            'translate(' + resizeSize + ',' + (height - doubleBorderWidth) +\n                ') scale(-1 1)');\n      } else {\n        this.resizeGroup.setAttribute(\n            'transform',\n            'translate(' + (width - doubleBorderWidth) + ',' +\n                (height - doubleBorderWidth) + ')');\n      }\n    }\n    if (this.autoLayout) {\n      this.layoutBubble();\n    }\n    this.positionBubble();\n    this.renderArrow();\n\n    // Allow the contents to resize.\n    if (this.resizeCallback) {\n      this.resizeCallback();\n    }\n  }\n\n  /** Draw the arrow between the bubble and the origin. */\n  private renderArrow() {\n    const steps = [];\n    // Find the relative coordinates of the center of the bubble.\n    const relBubbleX = this.width / 2;\n    const relBubbleY = this.height / 2;\n    // Find the relative coordinates of the center of the anchor.\n    let relAnchorX = -this.relativeLeft;\n    let relAnchorY = -this.relativeTop;\n    if (relBubbleX === relAnchorX && relBubbleY === relAnchorY) {\n      // Null case.  Bubble is directly on top of the anchor.\n      // Short circuit this rather than wade through divide by zeros.\n      steps.push('M ' + relBubbleX + ',' + relBubbleY);\n    } else {\n      // Compute the angle of the arrow's line.\n      const rise = relAnchorY - relBubbleY;\n      let run = relAnchorX - relBubbleX;\n      if (this.workspace_.RTL) {\n        run *= -1;\n      }\n      const hypotenuse = Math.sqrt(rise * rise + run * run);\n      let angle = Math.acos(run / hypotenuse);\n      if (rise < 0) {\n        angle = 2 * Math.PI - angle;\n      }\n      // Compute a line perpendicular to the arrow.\n      let rightAngle = angle + Math.PI / 2;\n      if (rightAngle > Math.PI * 2) {\n        rightAngle -= Math.PI * 2;\n      }\n      const rightRise = Math.sin(rightAngle);\n      const rightRun = Math.cos(rightAngle);\n\n      // Calculate the thickness of the base of the arrow.\n      const bubbleSize = this.getBubbleSize();\n      let thickness =\n          (bubbleSize.width + bubbleSize.height) / Bubble.ARROW_THICKNESS;\n      thickness = Math.min(thickness, bubbleSize.width, bubbleSize.height) / 4;\n\n      // Back the tip of the arrow off of the anchor.\n      const backoffRatio = 1 - Bubble.ANCHOR_RADIUS / hypotenuse;\n      relAnchorX = relBubbleX + backoffRatio * run;\n      relAnchorY = relBubbleY + backoffRatio * rise;\n\n      // Coordinates for the base of the arrow.\n      const baseX1 = relBubbleX + thickness * rightRun;\n      const baseY1 = relBubbleY + thickness * rightRise;\n      const baseX2 = relBubbleX - thickness * rightRun;\n      const baseY2 = relBubbleY - thickness * rightRise;\n\n      // Distortion to curve the arrow.\n      let swirlAngle = angle + this.arrowRadians;\n      if (swirlAngle > Math.PI * 2) {\n        swirlAngle -= Math.PI * 2;\n      }\n      const swirlRise = Math.sin(swirlAngle) * hypotenuse / Bubble.ARROW_BEND;\n      const swirlRun = Math.cos(swirlAngle) * hypotenuse / Bubble.ARROW_BEND;\n\n      steps.push('M' + baseX1 + ',' + baseY1);\n      steps.push(\n          'C' + (baseX1 + swirlRun) + ',' + (baseY1 + swirlRise) + ' ' +\n          relAnchorX + ',' + relAnchorY + ' ' + relAnchorX + ',' + relAnchorY);\n      steps.push(\n          'C' + relAnchorX + ',' + relAnchorY + ' ' + (baseX2 + swirlRun) +\n          ',' + (baseY2 + swirlRise) + ' ' + baseX2 + ',' + baseY2);\n    }\n    steps.push('z');\n    this.bubbleArrow?.setAttribute('d', steps.join(' '));\n  }\n\n  /**\n   * Change the colour of a bubble.\n   *\n   * @param hexColour Hex code of colour.\n   */\n  setColour(hexColour: string) {\n    this.bubbleBack?.setAttribute('fill', hexColour);\n    this.bubbleArrow?.setAttribute('fill', hexColour);\n  }\n\n  /** Dispose of this bubble. */\n  dispose() {\n    if (this.onMouseDownBubbleWrapper) {\n      browserEvents.unbind(this.onMouseDownBubbleWrapper);\n    }\n    if (this.onMouseDownResizeWrapper) {\n      browserEvents.unbind(this.onMouseDownResizeWrapper);\n    }\n    Bubble.unbindDragEvents();\n    dom.removeNode(this.bubbleGroup);\n    this.disposed = true;\n  }\n\n  /**\n   * Move this bubble during a drag, taking into account whether or not there is\n   * a drag surface.\n   *\n   * @param dragSurface The surface that carries rendered items during a drag,\n   *     or null if no drag surface is in use.\n   * @param newLoc The location to translate to, in workspace coordinates.\n   * @internal\n   */\n  moveDuringDrag(dragSurface: BlockDragSurfaceSvg, newLoc: Coordinate) {\n    if (dragSurface) {\n      dragSurface.translateSurface(newLoc.x, newLoc.y);\n    } else {\n      this.moveTo(newLoc.x, newLoc.y);\n    }\n    if (this.workspace_.RTL) {\n      this.relativeLeft = this.anchorXY.x - newLoc.x - this.width;\n    } else {\n      this.relativeLeft = newLoc.x - this.anchorXY.x;\n    }\n    this.relativeTop = newLoc.y - this.anchorXY.y;\n    this.renderArrow();\n  }\n\n  /**\n   * Return the coordinates of the top-left corner of this bubble's body\n   * relative to the drawing surface's origin (0,0), in workspace units.\n   *\n   * @returns Object with .x and .y properties.\n   */\n  getRelativeToSurfaceXY(): Coordinate {\n    return new Coordinate(\n        this.workspace_.RTL ?\n            -this.relativeLeft + this.anchorXY.x - this.width :\n            this.anchorXY.x + this.relativeLeft,\n        this.anchorXY.y + this.relativeTop);\n  }\n\n  /**\n   * Set whether auto-layout of this bubble is enabled.  The first time a bubble\n   * is shown it positions itself to not cover any blocks.  Once a user has\n   * dragged it to reposition, it renders where the user put it.\n   *\n   * @param enable True if auto-layout should be enabled, false otherwise.\n   * @internal\n   */\n  setAutoLayout(enable: boolean) {\n    this.autoLayout = enable;\n  }\n\n  /** Stop binding to the global mouseup and mousemove events. */\n  private static unbindDragEvents() {\n    if (Bubble.onMouseUpWrapper) {\n      browserEvents.unbind(Bubble.onMouseUpWrapper);\n      Bubble.onMouseUpWrapper = null;\n    }\n    if (Bubble.onMouseMoveWrapper) {\n      browserEvents.unbind(Bubble.onMouseMoveWrapper);\n      Bubble.onMouseMoveWrapper = null;\n    }\n  }\n\n  /**\n   * Handle a pointerup event while dragging a bubble's border or resize handle.\n   *\n   * @param _e Pointer up event.\n   */\n  private static bubbleMouseUp(_e: PointerEvent) {\n    Touch.clearTouchIdentifier();\n    Bubble.unbindDragEvents();\n  }\n\n  /**\n   * Create the text for a non editable bubble.\n   *\n   * @param text The text to display.\n   * @returns The top-level node of the text.\n   * @internal\n   */\n  static textToDom(text: string): SVGTextElement {\n    const paragraph = dom.createSvgElement(Svg.TEXT, {\n      'class': 'blocklyText blocklyBubbleText blocklyNoPointerEvents',\n      'y': Bubble.BORDER_WIDTH,\n    });\n    const lines = text.split('\\n');\n    for (let i = 0; i < lines.length; i++) {\n      const tspanElement = dom.createSvgElement(\n          Svg.TSPAN, {'dy': '1em', 'x': Bubble.BORDER_WIDTH}, paragraph);\n      const textNode = document.createTextNode(lines[i]);\n      tspanElement.appendChild(textNode);\n    }\n    return paragraph;\n  }\n\n  /**\n   * Creates a bubble that can not be edited.\n   *\n   * @param paragraphElement The text element for the non editable bubble.\n   * @param block The block that the bubble is attached to.\n   * @param iconXY The coordinate of the icon.\n   * @returns The non editable bubble.\n   * @internal\n   */\n  static createNonEditableBubble(\n      paragraphElement: SVGTextElement, block: BlockSvg,\n      iconXY: Coordinate): Bubble {\n    const bubble = new Bubble(\n        block.workspace!, paragraphElement, block.pathObject.svgPath, (iconXY),\n        null, null);\n    // Expose this bubble's block's ID on its top-level SVG group.\n    bubble.setSvgId(block.id);\n    if (block.RTL) {\n      // Right-align the paragraph.\n      // This cannot be done until the bubble is rendered on screen.\n      const maxWidth = paragraphElement.getBBox().width;\n      for (let i = 0, textElement;\n           textElement = paragraphElement.childNodes[i] as SVGTSpanElement;\n           i++) {\n        textElement.setAttribute('text-anchor', 'end');\n        textElement.setAttribute(\n            'x', (maxWidth + Bubble.BORDER_WIDTH).toString());\n      }\n    }\n    return bubble;\n  }\n}\n","/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * All the values that we expect developers to be able to change\n * before injecting Blockly. Changing these values during run time is not\n * generally recommended.\n *\n * @namespace Blockly.config\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.config');\n\n\n/**\n * All the values that we expect developers to be able to change\n * before injecting Blockly.\n */\ninterface Config {\n  dragRadius: number;\n  flyoutDragRadius: number;\n  snapRadius: number;\n  currentConnectionPreference: number;\n  bumpDelay: number;\n  connectingSnapRadius: number;\n}\n\n/** Default snap radius. */\nconst DEFAULT_SNAP_RADIUS = 28;\n\n/**\n * Object holding all the values on Blockly that we expect developers to be\n * able to change.\n */\nexport const config: Config = {\n  /**\n   * Number of pixels the mouse must move before a drag starts.\n   *\n   * @alias Blockly.config.dragRadius\n   */\n  dragRadius: 5,\n  /**\n   * Number of pixels the mouse must move before a drag/scroll starts from the\n   * flyout.  Because the drag-intention is determined when this is reached, it\n   * is larger than dragRadius so that the drag-direction is clearer.\n   *\n   * @alias Blockly.config.flyoutDragRadius\n   */\n  flyoutDragRadius: 10,\n  /**\n   * Maximum misalignment between connections for them to snap together.\n   *\n   * @alias Blockly.config.snapRadius\n   */\n  snapRadius: DEFAULT_SNAP_RADIUS,\n  /**\n   * Maximum misalignment between connections for them to snap together.\n   * This should be the same as the snap radius.\n   *\n   * @alias Blockly.config.connectingSnapRadius\n   */\n  connectingSnapRadius: DEFAULT_SNAP_RADIUS,\n  /**\n   * How much to prefer staying connected to the current connection over moving\n   * to a new connection.  The current previewed connection is considered to be\n   * this much closer to the matching connection on the block than it actually\n   * is.\n   *\n   * @alias Blockly.config.currentConnectionPreference\n   */\n  currentConnectionPreference: 8,\n  /**\n   * Delay in ms between trigger and bumping unconnected block out of alignment.\n   *\n   * @alias Blockly.config.bumpDelay\n   */\n  bumpDelay: 250,\n};\n","/**\n * @license\n * Copyright 2013 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing an icon on a block.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Icon');\n\nimport type {BlockSvg} from './block_svg.js';\nimport * as browserEvents from './browser_events.js';\nimport type {Bubble} from './bubble.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport {Size} from './utils/size.js';\nimport {Svg} from './utils/svg.js';\nimport * as svgMath from './utils/svg_math.js';\nimport * as deprecation from './utils/deprecation.js';\n\n\n/**\n * Class for an icon.\n *\n * @alias Blockly.Icon\n */\nexport abstract class Icon {\n  protected block_: BlockSvg|null;\n  /** The icon SVG group. */\n  iconGroup_: SVGGElement|null = null;\n\n  /** Whether this icon gets hidden when the block is collapsed. */\n  collapseHidden = true;\n\n  /** Height and width of icons. */\n  readonly SIZE = 17;\n\n  /** Bubble UI (if visible). */\n  protected bubble_: Bubble|null = null;\n\n  /** Absolute coordinate of icon's center. */\n  protected iconXY_: Coordinate|null = null;\n\n  /** @param block The block associated with this icon. */\n  constructor(block: BlockSvg|null) {\n    if (!block) {\n      deprecation.warn(\n          'Calling the Icon constructor with a null block', 'version 9',\n          'version 10', 'a non-null block');\n    }\n    this.block_ = block;\n  }\n\n  /** Create the icon on the block. */\n  createIcon() {\n    if (this.iconGroup_) {\n      // Icon already exists.\n      return;\n    }\n    /* Here's the markup that will be generated:\n        <g class=\"blocklyIconGroup\">\n          ...\n        </g>\n        */\n    this.iconGroup_ =\n        dom.createSvgElement(Svg.G, {'class': 'blocklyIconGroup'});\n    if (this.getBlock().isInFlyout) {\n      dom.addClass(this.iconGroup_, 'blocklyIconGroupReadonly');\n    }\n    this.drawIcon_(this.iconGroup_);\n\n    this.getBlock().getSvgRoot().appendChild(this.iconGroup_);\n    browserEvents.conditionalBind(\n        this.iconGroup_, 'pointerup', this, this.iconClick_);\n    this.updateEditable();\n  }\n\n  /** Dispose of this icon. */\n  dispose() {\n    dom.removeNode(this.iconGroup_);  // Dispose of and unlink the icon.\n    this.setVisible(false);           // Dispose of and unlink the bubble.\n  }\n\n  /** Add or remove the UI indicating if this icon may be clicked or not. */\n  updateEditable() {\n    // No-op on the base class.\n  }\n\n  /**\n   * Is the associated bubble visible?\n   *\n   * @returns True if the bubble is visible.\n   */\n  isVisible(): boolean {\n    return !!this.bubble_;\n  }\n\n  /**\n   * Clicking on the icon toggles if the bubble is visible.\n   *\n   * @param e Mouse click event.\n   */\n  protected iconClick_(e: PointerEvent) {\n    if (this.getBlock().workspace.isDragging()) {\n      // Drag operation is concluding.  Don't open the editor.\n      return;\n    }\n    if (!this.getBlock().isInFlyout && !browserEvents.isRightButton(e)) {\n      this.setVisible(!this.isVisible());\n    }\n  }\n\n  /** Change the colour of the associated bubble to match its block. */\n  applyColour() {\n    if (this.bubble_ && this.isVisible()) {\n      this.bubble_.setColour(this.getBlock().style.colourPrimary);\n    }\n  }\n\n  /**\n   * Notification that the icon has moved.  Update the arrow accordingly.\n   *\n   * @param xy Absolute location in workspace coordinates.\n   */\n  setIconLocation(xy: Coordinate) {\n    this.iconXY_ = xy;\n    if (this.bubble_ && this.isVisible()) {\n      this.bubble_.setAnchorLocation(xy);\n    }\n  }\n\n  /**\n   * Notification that the icon has moved, but we don't really know where.\n   * Recompute the icon's location from scratch.\n   */\n  computeIconLocation() {\n    // Find coordinates for the centre of the icon and update the arrow.\n    const blockXY = this.getBlock().getRelativeToSurfaceXY();\n    const iconXY = svgMath.getRelativeXY(this.iconGroup_ as SVGElement);\n    const newXY = new Coordinate(\n        blockXY.x + iconXY.x + this.SIZE / 2,\n        blockXY.y + iconXY.y + this.SIZE / 2);\n    if (!Coordinate.equals(this.getIconLocation(), newXY)) {\n      this.setIconLocation(newXY);\n    }\n  }\n\n  /**\n   * Returns the center of the block's icon relative to the surface.\n   *\n   * @returns Object with x and y properties in workspace coordinates.\n   */\n  getIconLocation(): Coordinate|null {\n    return this.iconXY_;\n  }\n\n  /**\n   * Get the size of the icon as used for rendering.\n   * This differs from the actual size of the icon, because it bulges slightly\n   * out of its row rather than increasing the height of its row.\n   *\n   * @returns Height and width.\n   */\n  getCorrectedSize(): Size {\n    // TODO (#2562): Remove getCorrectedSize.\n    return new Size(this.SIZE, this.SIZE - 2);\n  }\n\n  /**\n   * Draw the icon.\n   *\n   * @param _group The icon group.\n   */\n  protected drawIcon_(_group: Element) {}\n  // No-op on base class.\n\n  /**\n   * Show or hide the bubble.\n   *\n   * @param _visible True if the bubble should be visible.\n   */\n  setVisible(_visible: boolean) {}\n\n  /**\n   * @returns The block this icon is attached to.\n   */\n  protected getBlock(): BlockSvg {\n    if (!this.block_) {\n      throw new Error('Block is not set for this icon.');\n    }\n\n    return this.block_;\n  }\n}\n// No-op on base class\n","/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The class representing a theme.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Theme');\n\nimport * as registry from './registry.js';\nimport * as object from './utils/object.js';\n\n\nexport interface ITheme {\n  blockStyles?: {[key: string]: Partial<BlockStyle>};\n  categoryStyles?: {[key: string]: CategoryStyle};\n  componentStyles?: ComponentStyle;\n  fontStyle?: FontStyle;\n  startHats?: boolean;\n  base?: string|Theme;\n  name: string;\n}\n\n/**\n * Class for a theme.\n *\n * @alias Blockly.Theme\n */\nexport class Theme implements ITheme {\n  /** @internal */\n  blockStyles: {[key: string]: BlockStyle};\n  /** @internal */\n  categoryStyles: {[key: string]: CategoryStyle};\n  /** @internal */\n  componentStyles: ComponentStyle;\n  /** @internal */\n  fontStyle: FontStyle;\n\n  /**\n   * Whether or not to add a 'hat' on top of all blocks with no previous or\n   * output connections.\n   *\n   * @internal\n   */\n  startHats?: boolean = false;\n\n  /**\n   * @param name Theme name.\n   * @param opt_blockStyles A map from style names (strings) to objects with\n   *     style attributes for blocks.\n   * @param opt_categoryStyles A map from style names (strings) to objects with\n   *     style attributes for categories.\n   * @param opt_componentStyles A map of Blockly component names to style value.\n   */\n  constructor(\n      public name: string,\n      opt_blockStyles?: {[key: string]: Partial<BlockStyle>},\n      opt_categoryStyles?: {[key: string]: CategoryStyle},\n      opt_componentStyles?: ComponentStyle) {\n    /** The block styles map. */\n    this.blockStyles = opt_blockStyles || Object.create(null);\n\n    /** The category styles map. */\n    this.categoryStyles = opt_categoryStyles || Object.create(null);\n\n    /** The UI components styles map. */\n    this.componentStyles =\n        opt_componentStyles || Object.create(null) as ComponentStyle;\n\n    /** The font style. */\n    this.fontStyle = Object.create(null) as FontStyle;\n\n    // Register the theme by name.\n    registry.register(registry.Type.THEME, name, this);\n  }\n\n  /**\n   * Gets the class name that identifies this theme.\n   *\n   * @returns The CSS class name.\n   * @internal\n   */\n  getClassName(): string {\n    return this.name + '-theme';\n  }\n\n  /**\n   * Overrides or adds a style to the blockStyles map.\n   *\n   * @param blockStyleName The name of the block style.\n   * @param blockStyle The block style.\n   */\n  setBlockStyle(blockStyleName: string, blockStyle: BlockStyle) {\n    this.blockStyles[blockStyleName] = blockStyle;\n  }\n\n  /**\n   * Overrides or adds a style to the categoryStyles map.\n   *\n   * @param categoryStyleName The name of the category style.\n   * @param categoryStyle The category style.\n   */\n  setCategoryStyle(categoryStyleName: string, categoryStyle: CategoryStyle) {\n    this.categoryStyles[categoryStyleName] = categoryStyle;\n  }\n\n  /**\n   * Gets the style for a given Blockly UI component.  If the style value is a\n   * string, we attempt to find the value of any named references.\n   *\n   * @param componentName The name of the component.\n   * @returns The style value.\n   */\n  getComponentStyle(componentName: string): string|null {\n    const style = (this.componentStyles as AnyDuringMigration)[componentName];\n    if (style && typeof style === 'string' && this.getComponentStyle((style))) {\n      return this.getComponentStyle((style));\n    }\n    return style ? String(style) : null;\n  }\n\n  /**\n   * Configure a specific Blockly UI component with a style value.\n   *\n   * @param componentName The name of the component.\n   * @param styleValue The style value.\n   */\n  setComponentStyle(componentName: string, styleValue: AnyDuringMigration) {\n    (this.componentStyles as AnyDuringMigration)[componentName] = styleValue;\n  }\n\n  /**\n   * Configure a theme's font style.\n   *\n   * @param fontStyle The font style.\n   */\n  setFontStyle(fontStyle: FontStyle) {\n    this.fontStyle = fontStyle;\n  }\n\n  /**\n   * Configure a theme's start hats.\n   *\n   * @param startHats True if the theme enables start hats, false otherwise.\n   */\n  setStartHats(startHats: boolean) {\n    this.startHats = startHats;\n  }\n\n  /**\n   * Define a new Blockly theme.\n   *\n   * @param name The name of the theme.\n   * @param themeObj An object containing theme properties.\n   * @returns A new Blockly theme.\n   */\n  static defineTheme(name: string, themeObj: ITheme): Theme {\n    name = name.toLowerCase();\n    const theme = new Theme(name);\n    let base = themeObj['base'];\n    if (base) {\n      if (typeof base === 'string') {\n        base = registry.getObject(registry.Type.THEME, base) ?? undefined;\n      }\n      if (base instanceof Theme) {\n        object.deepMerge(theme, base);\n        theme.name = name;\n      }\n    }\n\n    object.deepMerge(theme.blockStyles, themeObj['blockStyles']);\n    object.deepMerge(theme.categoryStyles, themeObj['categoryStyles']);\n    object.deepMerge(theme.componentStyles, themeObj['componentStyles']);\n    object.deepMerge(theme.fontStyle, themeObj['fontStyle']);\n    if (themeObj['startHats'] !== null) {\n      theme.startHats = themeObj['startHats'];\n    }\n\n    return theme;\n  }\n}\n\nexport namespace Theme {\n  export interface BlockStyle {\n    colourPrimary: string;\n    colourSecondary: string;\n    colourTertiary: string;\n    hat: string;\n  }\n\n  export interface CategoryStyle {\n    colour: string;\n  }\n\n  export interface ComponentStyle {\n    workspaceBackgroundColour?: string;\n    toolboxBackgroundColour?: string;\n    toolboxForegroundColour?: string;\n    flyoutBackgroundColour?: string;\n    flyoutForegroundColour?: string;\n    flyoutOpacity?: number;\n    scrollbarColour?: string;\n    scrollbarOpacity?: number;\n    insertionMarkerColour?: string;\n    insertionMarkerOpacity?: number;\n    markerColour?: string;\n    cursorColour?: string;\n    selectedGlowColour?: string;\n    selectedGlowOpacity?: number;\n    replacementGlowColour?: string;\n    replacementGlowOpacity?: number;\n  }\n\n  export interface FontStyle {\n    family?: string;\n    weight?: string;\n    size?: number;\n  }\n}\n\nexport type BlockStyle = Theme.BlockStyle;\nexport type CategoryStyle = Theme.CategoryStyle;\nexport type ComponentStyle = Theme.ComponentStyle;\nexport type FontStyle = Theme.FontStyle;\n","/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Classic theme.\n * Contains multi-coloured border to create shadow effect.\n *\n * @namespace Blockly.Themes.Classic\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Themes.Classic');\n\nimport {Theme} from '../theme.js';\n\n\nconst defaultBlockStyles = {\n  'colour_blocks': {'colourPrimary': '20'},\n  'list_blocks': {'colourPrimary': '260'},\n  'logic_blocks': {'colourPrimary': '210'},\n  'loop_blocks': {'colourPrimary': '120'},\n  'math_blocks': {'colourPrimary': '230'},\n  'procedure_blocks': {'colourPrimary': '290'},\n  'text_blocks': {'colourPrimary': '160'},\n  'variable_blocks': {'colourPrimary': '330'},\n  'variable_dynamic_blocks': {'colourPrimary': '310'},\n  'hat_blocks': {'colourPrimary': '330', 'hat': 'cap'},\n};\n\nconst categoryStyles = {\n  'colour_category': {'colour': '20'},\n  'list_category': {'colour': '260'},\n  'logic_category': {'colour': '210'},\n  'loop_category': {'colour': '120'},\n  'math_category': {'colour': '230'},\n  'procedure_category': {'colour': '290'},\n  'text_category': {'colour': '160'},\n  'variable_category': {'colour': '330'},\n  'variable_dynamic_category': {'colour': '310'},\n};\n\n/**\n * Classic theme.\n * Contains multi-coloured border to create shadow effect.\n *\n * @alias Blockly.Themes.Classic\n */\nexport const Classic = new Theme(\n    'classic', defaultBlockStyles as AnyDuringMigration, categoryStyles);\n","/**\n * @license\n * Copyright 2016 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object that controls settings for the workspace.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Options');\n\nimport type {BlocklyOptions} from './blockly_options.js';\nimport * as deprecation from './utils/deprecation.js';\nimport * as registry from './registry.js';\nimport {Theme} from './theme.js';\nimport {Classic} from './theme/classic.js';\nimport * as idGenerator from './utils/idgenerator.js';\nimport type {Metrics} from './utils/metrics.js';\nimport * as toolbox from './utils/toolbox.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/**\n * Parse the user-specified options, using reasonable defaults where behaviour\n * is unspecified.\n *\n * @alias Blockly.Options\n */\nexport class Options {\n  RTL: boolean;\n  oneBasedIndex: boolean;\n  collapse: boolean;\n  comments: boolean;\n  disable: boolean;\n  readOnly: boolean;\n  maxBlocks: number;\n  maxInstances: {[key: string]: number}|null;\n  modalInputs: boolean;\n  pathToMedia: string;\n  hasCategories: boolean;\n  moveOptions: MoveOptions;\n  hasScrollbars: boolean;\n  hasTrashcan: boolean;\n  maxTrashcanContents: number;\n  hasSounds: boolean;\n  hasCss: boolean;\n  horizontalLayout: boolean;\n  languageTree: toolbox.ToolboxInfo|null;\n  gridOptions: GridOptions;\n  zoomOptions: ZoomOptions;\n  toolboxPosition: toolbox.Position;\n  theme: Theme;\n  renderer: string;\n  rendererOverrides: {[rendererConstant: string]: any}|null;\n\n  /**\n   * The SVG element for the grid pattern.\n   * Created during injection.\n   */\n  gridPattern: SVGElement|null = null;\n  parentWorkspace: WorkspaceSvg|null;\n  plugins: {[key: string]: (new(...p1: any[]) => any)|string};\n\n  /**\n   * If set, sets the translation of the workspace to match the scrollbars.\n   * A function that\n   *     sets the translation of the workspace to match the scrollbars. The\n   *     argument Contains an x and/or y property which is a float between 0\n   *     and 1 specifying the degree of scrolling.\n   */\n  setMetrics?: ((p1: {x?: number, y?: number}) => void) = undefined;\n\n  /**\n   * A function that returns a metrics\n   *     object that describes the current workspace.\n   */\n  getMetrics?: (() => Metrics) = undefined;\n\n  /**\n   * @param options Dictionary of options.\n   *     Specification:\n   * https://developers.google.com/blockly/guides/get-started/web#configuration\n   */\n  constructor(options: BlocklyOptions) {\n    let toolboxJsonDef = null;\n    let hasCategories = false;\n    let hasTrashcan = false;\n    let hasCollapse = false;\n    let hasComments = false;\n    let hasDisable = false;\n    let hasSounds = false;\n    const readOnly = !!options['readOnly'];\n    if (!readOnly) {\n      toolboxJsonDef =\n          toolbox.convertToolboxDefToJson(options['toolbox'] ?? null);\n      hasCategories = toolbox.hasCategories(toolboxJsonDef);\n      const rawHasTrashcan = options['trashcan'];\n      hasTrashcan =\n          rawHasTrashcan === undefined ? hasCategories : rawHasTrashcan;\n      const rawHasCollapse = options['collapse'];\n      hasCollapse =\n          rawHasCollapse === undefined ? hasCategories : rawHasCollapse;\n      const rawHasComments = options['comments'];\n      hasComments =\n          rawHasComments === undefined ? hasCategories : rawHasComments;\n      const rawHasDisable = options['disable'];\n      hasDisable = rawHasDisable === undefined ? hasCategories : rawHasDisable;\n      const rawHasSounds = options['sounds'];\n      hasSounds = rawHasSounds === undefined ? true : rawHasSounds;\n    }\n\n    let maxTrashcanContents = options['maxTrashcanContents'];\n    if (hasTrashcan) {\n      if (maxTrashcanContents === undefined) {\n        maxTrashcanContents = 32;\n      }\n    } else {\n      maxTrashcanContents = 0;\n    }\n    const rtl = !!options['rtl'];\n    let horizontalLayout = options['horizontalLayout'];\n    if (horizontalLayout === undefined) {\n      horizontalLayout = false;\n    }\n    const toolboxAtStart = options['toolboxPosition'] !== 'end';\n\n    let toolboxPosition: toolbox.Position;\n    if (horizontalLayout) {\n      toolboxPosition =\n          toolboxAtStart ? toolbox.Position.TOP : toolbox.Position.BOTTOM;\n    } else {\n      toolboxPosition = toolboxAtStart === rtl ? toolbox.Position.RIGHT :\n                                                 toolbox.Position.LEFT;\n    }\n\n    let hasCss = options['css'];\n    if (hasCss === undefined) {\n      hasCss = true;\n    }\n    let pathToMedia = 'https://blockly-demo.appspot.com/static/media/';\n    if (options['media']) {\n      pathToMedia = options['media'].endsWith('/') ? options['media'] :\n                                                     options['media'] + '/';\n    } else if ('path' in options) {\n      // 'path' is a deprecated option which has been replaced by 'media'.\n      deprecation.warn('path', 'Nov 2014', 'Jul 2023', 'media');\n      pathToMedia = (options as any)['path'] + 'media/';\n    }\n    const rawOneBasedIndex = options['oneBasedIndex'];\n    const oneBasedIndex =\n        rawOneBasedIndex === undefined ? true : rawOneBasedIndex;\n    const renderer = options['renderer'] || 'geras';\n\n    const plugins = options['plugins'] || {};\n\n    let modalInputs = options['modalInputs'];\n    if (modalInputs === undefined) {\n      modalInputs = true;\n    }\n\n    this.RTL = rtl;\n    this.oneBasedIndex = oneBasedIndex;\n    this.collapse = hasCollapse;\n    this.comments = hasComments;\n    this.disable = hasDisable;\n    this.readOnly = readOnly;\n    this.maxBlocks = options['maxBlocks'] || Infinity;\n    this.maxInstances = options['maxInstances'] ?? null;\n    this.modalInputs = modalInputs;\n    this.pathToMedia = pathToMedia;\n    this.hasCategories = hasCategories;\n    this.moveOptions = Options.parseMoveOptions_(options, hasCategories);\n    /** @deprecated  January 2019 */\n    this.hasScrollbars = !!this.moveOptions.scrollbars;\n    this.hasTrashcan = hasTrashcan;\n    this.maxTrashcanContents = maxTrashcanContents;\n    this.hasSounds = hasSounds;\n    this.hasCss = hasCss;\n    this.horizontalLayout = horizontalLayout;\n    this.languageTree = toolboxJsonDef;\n    this.gridOptions = Options.parseGridOptions_(options);\n    this.zoomOptions = Options.parseZoomOptions_(options);\n    this.toolboxPosition = toolboxPosition;\n    this.theme = Options.parseThemeOptions_(options);\n    this.renderer = renderer;\n    this.rendererOverrides = options['rendererOverrides'] ?? null;\n\n    /**\n     * The parent of the current workspace, or null if there is no parent\n     * workspace.  We can assert that this is of type WorkspaceSvg as opposed to\n     * Workspace as this is only used in a rendered workspace.\n     */\n    this.parentWorkspace = options['parentWorkspace'] ?? null;\n\n    /** Map of plugin type to name of registered plugin or plugin class. */\n    this.plugins = plugins;\n  }\n\n  /**\n   * Parse the user-specified move options, using reasonable defaults where\n   *    behaviour is unspecified.\n   *\n   * @param options Dictionary of options.\n   * @param hasCategories Whether the workspace has categories or not.\n   * @returns Normalized move options.\n   */\n  private static parseMoveOptions_(\n      options: BlocklyOptions, hasCategories: boolean): MoveOptions {\n    const move = options['move'] || {};\n    const moveOptions = {} as MoveOptions;\n    if (move['scrollbars'] === undefined &&\n        options['scrollbars'] === undefined) {\n      moveOptions.scrollbars = hasCategories;\n    } else if (typeof move['scrollbars'] === 'object') {\n      moveOptions.scrollbars = {\n        'horizontal': !!move['scrollbars']['horizontal'],\n        'vertical': !!move['scrollbars']['vertical'],\n      };\n      // Convert scrollbars object to boolean if they have the same value.\n      // This allows us to easily check for whether any scrollbars exist using\n      // !!moveOptions.scrollbars.\n      if (moveOptions.scrollbars.horizontal &&\n          moveOptions.scrollbars.vertical) {\n        moveOptions.scrollbars = true;\n      } else if (\n          !moveOptions.scrollbars.horizontal &&\n          !moveOptions.scrollbars.vertical) {\n        moveOptions.scrollbars = false;\n      }\n    } else {\n      moveOptions.scrollbars = !!move['scrollbars'] || !!options['scrollbars'];\n    }\n\n    if (!moveOptions.scrollbars || move['wheel'] === undefined) {\n      // Defaults to true if single-direction scroll is enabled.\n      moveOptions.wheel = typeof moveOptions.scrollbars === 'object';\n    } else {\n      moveOptions.wheel = !!move['wheel'];\n    }\n    if (!moveOptions.scrollbars) {\n      moveOptions.drag = false;\n    } else if (move['drag'] === undefined) {\n      // Defaults to true if scrollbars is true.\n      moveOptions.drag = true;\n    } else {\n      moveOptions.drag = !!move['drag'];\n    }\n    return moveOptions;\n  }\n\n  /**\n   * Parse the user-specified zoom options, using reasonable defaults where\n   * behaviour is unspecified.  See zoom documentation:\n   *   https://developers.google.com/blockly/guides/configure/web/zoom\n   *\n   * @param options Dictionary of options.\n   * @returns Normalized zoom options.\n   */\n  private static parseZoomOptions_(options: BlocklyOptions): ZoomOptions {\n    const zoom = options['zoom'] || {};\n    const zoomOptions = {} as ZoomOptions;\n    if (zoom['controls'] === undefined) {\n      zoomOptions.controls = false;\n    } else {\n      zoomOptions.controls = !!zoom['controls'];\n    }\n    if (zoom['wheel'] === undefined) {\n      zoomOptions.wheel = false;\n    } else {\n      zoomOptions.wheel = !!zoom['wheel'];\n    }\n    if (zoom['startScale'] === undefined) {\n      zoomOptions.startScale = 1;\n    } else {\n      zoomOptions.startScale = Number(zoom['startScale']);\n    }\n    if (zoom['maxScale'] === undefined) {\n      zoomOptions.maxScale = 3;\n    } else {\n      zoomOptions.maxScale = Number(zoom['maxScale']);\n    }\n    if (zoom['minScale'] === undefined) {\n      zoomOptions.minScale = 0.3;\n    } else {\n      zoomOptions.minScale = Number(zoom['minScale']);\n    }\n    if (zoom['scaleSpeed'] === undefined) {\n      zoomOptions.scaleSpeed = 1.2;\n    } else {\n      zoomOptions.scaleSpeed = Number(zoom['scaleSpeed']);\n    }\n    if (zoom['pinch'] === undefined) {\n      zoomOptions.pinch = zoomOptions.wheel || zoomOptions.controls;\n    } else {\n      zoomOptions.pinch = !!zoom['pinch'];\n    }\n    return zoomOptions;\n  }\n\n  /**\n   * Parse the user-specified grid options, using reasonable defaults where\n   * behaviour is unspecified. See grid documentation:\n   *   https://developers.google.com/blockly/guides/configure/web/grid\n   *\n   * @param options Dictionary of options.\n   * @returns Normalized grid options.\n   */\n  private static parseGridOptions_(options: BlocklyOptions): GridOptions {\n    const grid = options['grid'] || {};\n    const gridOptions = {} as GridOptions;\n    gridOptions.spacing = Number(grid['spacing']) || 0;\n    gridOptions.colour = grid['colour'] || '#888';\n    gridOptions.length =\n        grid['length'] === undefined ? 1 : Number(grid['length']);\n    gridOptions.snap = gridOptions.spacing > 0 && !!grid['snap'];\n    return gridOptions;\n  }\n\n  /**\n   * Parse the user-specified theme options, using the classic theme as a\n   * default. https://developers.google.com/blockly/guides/configure/web/themes\n   *\n   * @param options Dictionary of options.\n   * @returns A Blockly Theme.\n   */\n  private static parseThemeOptions_(options: BlocklyOptions): Theme {\n    const theme = options['theme'] || Classic;\n    if (typeof theme === 'string') {\n      return registry.getObject(registry.Type.THEME, theme) as Theme;\n    } else if (theme instanceof Theme) {\n      return theme;\n    }\n    return Theme.defineTheme(\n        theme.name || 'builtin' + idGenerator.getNextUniqueId(), theme);\n  }\n}\n\nexport namespace Options {\n  export interface GridOptions {\n    colour: string;\n    length: number;\n    snap: boolean;\n    spacing: number;\n  }\n\n  export interface MoveOptions {\n    drag: boolean;\n    scrollbars: boolean|ScrollbarOptions;\n    wheel: boolean;\n  }\n\n  export interface ScrollbarOptions {\n    horizontal: boolean;\n    vertical: boolean;\n  }\n\n  export interface ZoomOptions {\n    controls: boolean;\n    maxScale: number;\n    minScale: number;\n    pinch: boolean;\n    scaleSpeed: number;\n    startScale: number;\n    wheel: boolean;\n  }\n}\n\nexport type GridOptions = Options.GridOptions;\nexport type MoveOptions = Options.MoveOptions;\nexport type ScrollbarOptions = Options.ScrollbarOptions;\nexport type ZoomOptions = Options.ZoomOptions;\n","/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing a mutator dialog.  A mutator allows the\n * user to change the shape of a block using a nested blocks editor.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Mutator');\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_bubble_open.js';\n\nimport type {Block} from './block.js';\nimport type {BlockSvg} from './block_svg.js';\nimport type {BlocklyOptions} from './blockly_options.js';\nimport {Bubble} from './bubble.js';\nimport {config} from './config.js';\nimport type {Connection} from './connection.js';\nimport type {Abstract} from './events/events_abstract.js';\nimport {BlockChange} from './events/events_block_change.js';\nimport * as eventUtils from './events/utils.js';\nimport {Icon} from './icon.js';\nimport {Options} from './options.js';\nimport type {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport {Svg} from './utils/svg.js';\nimport * as toolbox from './utils/toolbox.js';\nimport * as xml from './utils/xml.js';\nimport * as deprecation from './utils/deprecation.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/**\n * Class for a mutator dialog.\n *\n * @alias Blockly.Mutator\n */\nexport class Mutator extends Icon {\n  private quarkNames: string[];\n\n  /**\n   * Workspace in the mutator's bubble.\n   * Due to legacy code in procedure block definitions, this name\n   * cannot change.\n   */\n  private workspace_: WorkspaceSvg|null = null;\n\n  /** Width of workspace. */\n  private workspaceWidth = 0;\n\n  /** Height of workspace. */\n  private workspaceHeight = 0;\n\n  /**\n   * The SVG element that is the parent of the mutator workspace, or null if\n   * not created.\n   */\n  private svgDialog: SVGSVGElement|null = null;\n\n  /**\n   * The root block of the mutator workspace, created by decomposing the\n   * source block.\n   */\n  private rootBlock: BlockSvg|null = null;\n\n  /**\n   * Function registered on the main workspace to update the mutator contents\n   * when the main workspace changes.\n   */\n  private sourceListener: Function|null = null;\n\n  /**\n   * The PID associated with the updateWorkpace_ timeout, or null if no timeout\n   * is currently running.\n   */\n  private updateWorkspacePid: ReturnType<typeof setTimeout>|null = null;\n\n  /** @param quarkNames List of names of sub-blocks for flyout. */\n  constructor(quarkNames: string[], block?: BlockSvg) {\n    if (!block) {\n      deprecation.warn(\n          'Calling the Mutator constructor without passing the block it is attached to',\n          'version 9', 'version 10',\n          'the constructor by passing the list of subblocks and the block instance to attach the mutator to');\n    }\n    super(block ?? null);\n    this.quarkNames = quarkNames;\n  }\n\n  /**\n   * Set the block this mutator is associated with.\n   *\n   * @param block The block associated with this mutator.\n   * @internal\n   */\n  setBlock(block: BlockSvg) {\n    this.block_ = block;\n  }\n\n  /**\n   * Returns the workspace inside this mutator icon's bubble.\n   *\n   * @returns The workspace inside this mutator icon's bubble or null if the\n   *     mutator isn't open.\n   * @internal\n   */\n  getWorkspace(): WorkspaceSvg|null {\n    return this.workspace_;\n  }\n\n  /**\n   * Draw the mutator icon.\n   *\n   * @param group The icon group.\n   */\n  protected override drawIcon_(group: Element) {\n    // Square with rounded corners.\n    dom.createSvgElement(\n        Svg.RECT, {\n          'class': 'blocklyIconShape',\n          'rx': '4',\n          'ry': '4',\n          'height': '16',\n          'width': '16',\n        },\n        group);\n    // Gear teeth.\n    dom.createSvgElement(\n        Svg.PATH, {\n          'class': 'blocklyIconSymbol',\n          'd': 'm4.203,7.296 0,1.368 -0.92,0.677 -0.11,0.41 0.9,1.559 0.41,' +\n              '0.11 1.043,-0.457 1.187,0.683 0.127,1.134 0.3,0.3 1.8,0 0.3,' +\n              '-0.299 0.127,-1.138 1.185,-0.682 1.046,0.458 0.409,-0.11 0.9,' +\n              '-1.559 -0.11,-0.41 -0.92,-0.677 0,-1.366 0.92,-0.677 0.11,' +\n              '-0.41 -0.9,-1.559 -0.409,-0.109 -1.046,0.458 -1.185,-0.682 ' +\n              '-0.127,-1.138 -0.3,-0.299 -1.8,0 -0.3,0.3 -0.126,1.135 -1.187,' +\n              '0.682 -1.043,-0.457 -0.41,0.11 -0.899,1.559 0.108,0.409z',\n        },\n        group);\n    // Axle hole.\n    dom.createSvgElement(\n        Svg.CIRCLE,\n        {'class': 'blocklyIconShape', 'r': '2.7', 'cx': '8', 'cy': '8'}, group);\n  }\n\n  /**\n   * Clicking on the icon toggles if the mutator bubble is visible.\n   * Disable if block is uneditable.\n   *\n   * @param e Mouse click event.\n   */\n  protected override iconClick_(e: PointerEvent) {\n    if (this.getBlock().isEditable()) {\n      super.iconClick_(e);\n    }\n  }\n\n  /**\n   * Create the editor for the mutator's bubble.\n   *\n   * @returns The top-level node of the editor.\n   */\n  private createEditor(): SVGSVGElement {\n    /* Create the editor.  Here's the markup that will be generated:\n        <svg>\n          [Workspace]\n        </svg>\n        */\n    this.svgDialog = dom.createSvgElement(\n        Svg.SVG, {'x': Bubble.BORDER_WIDTH, 'y': Bubble.BORDER_WIDTH});\n    // Convert the list of names into a list of XML objects for the flyout.\n    let quarkXml;\n    if (this.quarkNames.length) {\n      quarkXml = xml.createElement('xml');\n      for (let i = 0, quarkName; quarkName = this.quarkNames[i]; i++) {\n        const element = xml.createElement('block');\n        element.setAttribute('type', quarkName);\n        quarkXml.appendChild(element);\n      }\n    } else {\n      quarkXml = null;\n    }\n    const block = this.getBlock();\n    const workspaceOptions = new Options(({\n      // If you want to enable disabling, also remove the\n      // event filter from workspaceChanged_ .\n      'disable': false,\n      'parentWorkspace': block.workspace,\n      'media': block.workspace.options.pathToMedia,\n      'rtl': block.RTL,\n      'horizontalLayout': false,\n      'renderer': block.workspace.options.renderer,\n      'rendererOverrides': block.workspace.options.rendererOverrides,\n    } as BlocklyOptions));\n    workspaceOptions.toolboxPosition =\n        block.RTL ? toolbox.Position.RIGHT : toolbox.Position.LEFT;\n    const hasFlyout = !!quarkXml;\n    if (hasFlyout) {\n      workspaceOptions.languageTree = toolbox.convertToolboxDefToJson(quarkXml);\n    }\n    this.workspace_ = this.newWorkspaceSvg(workspaceOptions);\n    this.workspace_.internalIsMutator = true;\n    this.workspace_.addChangeListener(eventUtils.disableOrphans);\n\n    // Mutator flyouts go inside the mutator workspace's <g> rather than in\n    // a top level SVG. Instead of handling scale themselves, mutators\n    // inherit scale from the parent workspace.\n    // To fix this, scale needs to be applied at a different level in the DOM.\n    const flyoutSvg = hasFlyout ? this.workspace_.addFlyout(Svg.G) : null;\n    const background = this.workspace_.createDom('blocklyMutatorBackground');\n\n    if (flyoutSvg) {\n      // Insert the flyout after the <rect> but before the block canvas so that\n      // the flyout is underneath in z-order.  This makes blocks layering during\n      // dragging work properly.\n      background.insertBefore(flyoutSvg, this.workspace_.svgBlockCanvas_);\n    }\n    this.svgDialog.appendChild(background);\n\n    return this.svgDialog;\n  }\n\n  /**\n   * @internal\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  newWorkspaceSvg(options: Options): WorkspaceSvg {\n    throw new Error(\n        'The implementation of newWorkspaceSvg should be ' +\n        'monkey-patched in by blockly.ts');\n  }\n\n  /** Add or remove the UI indicating if this icon may be clicked or not. */\n  override updateEditable() {\n    super.updateEditable();\n    if (!this.getBlock().isInFlyout) {\n      if (this.getBlock().isEditable()) {\n        if (this.iconGroup_) {\n          dom.removeClass(this.iconGroup_, 'blocklyIconGroupReadonly');\n        }\n      } else {\n        // Close any mutator bubble.  Icon is not clickable.\n        this.setVisible(false);\n        if (this.iconGroup_) {\n          dom.addClass(this.iconGroup_, 'blocklyIconGroupReadonly');\n        }\n      }\n    }\n  }\n\n  /** Resize the bubble to match the size of the workspace. */\n  private resizeBubble() {\n    // If the bubble exists, the workspace also exists.\n    if (!this.workspace_) {\n      return;\n    }\n    const doubleBorderWidth = 2 * Bubble.BORDER_WIDTH;\n    const canvas = this.workspace_.getCanvas();\n    const workspaceSize = canvas.getBBox();\n    let width = workspaceSize.width + workspaceSize.x;\n    let height = workspaceSize.height + doubleBorderWidth * 3;\n    const flyout = this.workspace_.getFlyout();\n    if (flyout) {\n      const flyoutScrollMetrics =\n          flyout.getWorkspace().getMetricsManager().getScrollMetrics();\n      height = Math.max(height, flyoutScrollMetrics.height + 20);\n      width += flyout.getWidth();\n    }\n    const isRtl = this.getBlock().RTL;\n    if (isRtl) {\n      width = -workspaceSize.x;\n    }\n    width += doubleBorderWidth * 3;\n    // Only resize if the size difference is significant.  Eliminates\n    // shuddering.\n    if (Math.abs(this.workspaceWidth - width) > doubleBorderWidth ||\n        Math.abs(this.workspaceHeight - height) > doubleBorderWidth) {\n      // Record some layout information for workspace metrics.\n      this.workspaceWidth = width;\n      this.workspaceHeight = height;\n      // Resize the bubble.\n      this.bubble_!.setBubbleSize(\n          width + doubleBorderWidth, height + doubleBorderWidth);\n      this.svgDialog!.setAttribute('width', `${width}`);\n      this.svgDialog!.setAttribute('height', `${height}`);\n      this.workspace_.setCachedParentSvgSize(width, height);\n    }\n\n    if (isRtl) {\n      // Scroll the workspace to always left-align.\n      canvas.setAttribute('transform', `translate(${this.workspaceWidth}, 0)`);\n    }\n    this.workspace_.resize();\n  }\n\n  /** A method handler for when the bubble is moved. */\n  private onBubbleMove() {\n    if (this.workspace_) {\n      this.workspace_.recordDragTargets();\n    }\n  }\n\n  /**\n   * Show or hide the mutator bubble.\n   *\n   * @param visible True if the bubble should be visible.\n   */\n  override setVisible(visible: boolean) {\n    if (visible === this.isVisible()) {\n      // No change.\n      return;\n    }\n    const block = this.getBlock();\n    eventUtils.fire(new (eventUtils.get(eventUtils.BUBBLE_OPEN))(\n        block, visible, 'mutator'));\n    if (visible) {\n      // Create the bubble.\n      this.bubble_ = new Bubble(\n          block.workspace, this.createEditor(), block.pathObject.svgPath,\n          (this.iconXY_ as Coordinate), null, null);\n      // The workspace was created in createEditor.\n      const ws = this.workspace_!;\n      // Expose this mutator's block's ID on its top-level SVG group.\n      this.bubble_.setSvgId(block.id);\n      this.bubble_.registerMoveEvent(this.onBubbleMove.bind(this));\n      const tree = ws.options.languageTree;\n      const flyout = ws.getFlyout();\n      if (tree) {\n        flyout!.init(ws);\n        flyout!.show(tree);\n      }\n\n      this.rootBlock = block.decompose!(ws)!;\n      const blocks = this.rootBlock.getDescendants(false);\n      for (let i = 0, child; child = blocks[i]; i++) {\n        child.render();\n      }\n      // The root block should not be draggable or deletable.\n      this.rootBlock.setMovable(false);\n      this.rootBlock.setDeletable(false);\n      let margin;\n      let x;\n      if (flyout) {\n        margin = flyout.CORNER_RADIUS * 2;\n        x = this.rootBlock.RTL ? flyout.getWidth() + margin : margin;\n      } else {\n        margin = 16;\n        x = margin;\n      }\n      if (block.RTL) {\n        x = -x;\n      }\n      this.rootBlock.moveBy(x, margin);\n      // Save the initial connections, then listen for further changes.\n      if (block.saveConnections) {\n        const thisRootBlock = this.rootBlock;\n        block.saveConnections(thisRootBlock);\n        this.sourceListener = () => {\n          const currentBlock = this.getBlock();\n          if (currentBlock.saveConnections) {\n            currentBlock.saveConnections(thisRootBlock);\n          }\n        };\n        block.workspace.addChangeListener(this.sourceListener);\n      }\n      this.resizeBubble();\n      // When the mutator's workspace changes, update the source block.\n      ws.addChangeListener(this.workspaceChanged.bind(this));\n      // Update the source block immediately after the bubble becomes visible.\n      this.updateWorkspace();\n      this.applyColour();\n    } else {\n      // Dispose of the bubble.\n      this.svgDialog = null;\n      this.workspace_!.dispose();\n      this.workspace_ = null;\n      this.rootBlock = null;\n      this.bubble_?.dispose();\n      this.bubble_ = null;\n      this.workspaceWidth = 0;\n      this.workspaceHeight = 0;\n      if (this.sourceListener) {\n        block.workspace.removeChangeListener(this.sourceListener);\n        this.sourceListener = null;\n      }\n    }\n  }\n\n  /**\n   * Fired whenever a change is made to the mutator's workspace.\n   *\n   * @param e Custom data for event.\n   */\n  private workspaceChanged(e: Abstract) {\n    if (!this.shouldIgnoreMutatorEvent_(e) && !this.updateWorkspacePid) {\n      this.updateWorkspacePid = setTimeout(() => {\n        this.updateWorkspacePid = null;\n        this.updateWorkspace();\n      }, 0);\n    }\n  }\n\n  /**\n   * Returns whether the given event in the mutator workspace should be ignored\n   * when deciding whether to update the workspace and compose the block or not.\n   *\n   * @param e The event.\n   * @returns Whether to ignore the event or not.\n   */\n  shouldIgnoreMutatorEvent_(e: Abstract) {\n    return e.isUiEvent || e.type === eventUtils.CREATE ||\n        e.type === eventUtils.CHANGE &&\n        (e as BlockChange).element === 'disabled';\n  }\n\n  /**\n   * Updates the source block when the mutator's blocks are changed.\n   * Bump down any block that's too high.\n   */\n  private updateWorkspace() {\n    if (!this.workspace_!.isDragging()) {\n      const blocks = this.workspace_!.getTopBlocks(false);\n      const MARGIN = 20;\n\n      for (let b = 0, block; block = blocks[b]; b++) {\n        const blockXY = block.getRelativeToSurfaceXY();\n\n        // Bump any block that's above the top back inside.\n        if (blockXY.y < MARGIN) {\n          block.moveBy(0, MARGIN - blockXY.y);\n        }\n        // Bump any block overlapping the flyout back inside.\n        if (block.RTL) {\n          let right = -MARGIN;\n          const flyout = this.workspace_!.getFlyout();\n          if (flyout) {\n            right -= flyout.getWidth();\n          }\n          if (blockXY.x > right) {\n            block.moveBy(right - blockXY.x, 0);\n          }\n        } else if (blockXY.x < MARGIN) {\n          block.moveBy(MARGIN - blockXY.x, 0);\n        }\n      }\n    }\n\n    // When the mutator's workspace changes, update the source block.\n    if (this.rootBlock && this.rootBlock.workspace === this.workspace_) {\n      const existingGroup = eventUtils.getGroup();\n      if (!existingGroup) {\n        eventUtils.setGroup(true);\n      }\n      const block = this.getBlock();\n      const oldExtraState = BlockChange.getExtraBlockState_(block);\n\n      // Switch off rendering while the source block is rebuilt.\n      const savedRendered = block.rendered;\n      // TODO(#4288): We should not be setting the rendered property to false.\n      block.rendered = false;\n\n      // Allow the source block to rebuild itself.\n      block.compose!(this.rootBlock);\n      // Restore rendering and show the changes.\n      block.rendered = savedRendered;\n      // Mutation may have added some elements that need initializing.\n      block.initSvg();\n\n      if (block.rendered) {\n        block.render();\n      }\n\n      const newExtraState = BlockChange.getExtraBlockState_(block);\n      if (oldExtraState !== newExtraState) {\n        eventUtils.fire(new (eventUtils.get(eventUtils.BLOCK_CHANGE))(\n            block, 'mutation', null, oldExtraState, newExtraState));\n        // Ensure that any bump is part of this mutation's event group.\n        const mutationGroup = eventUtils.getGroup();\n        setTimeout(function() {\n          const oldGroup = eventUtils.getGroup();\n          eventUtils.setGroup(mutationGroup);\n          block.bumpNeighbours();\n          eventUtils.setGroup(oldGroup);\n        }, config.bumpDelay);\n      }\n\n      // Don't update the bubble until the drag has ended, to avoid moving\n      // blocks under the cursor.\n      if (!this.workspace_!.isDragging()) {\n        setTimeout(() => this.resizeBubble(), 0);\n      }\n      eventUtils.setGroup(existingGroup);\n    }\n  }\n\n  /** Dispose of this mutator. */\n  override dispose() {\n    this.getBlock().mutator = null;\n    super.dispose();\n  }\n\n  /** Update the styles on all blocks in the mutator. */\n  updateBlockStyle() {\n    const ws = this.workspace_;\n\n    if (ws && ws.getAllBlocks(false)) {\n      const workspaceBlocks = ws.getAllBlocks(false);\n      for (let i = 0, block; block = workspaceBlocks[i]; i++) {\n        block.setStyle(block.getStyleName());\n      }\n\n      const flyout = ws.getFlyout();\n      if (flyout) {\n        const flyoutBlocks = flyout.getWorkspace().getAllBlocks(false);\n        for (let i = 0, block; block = flyoutBlocks[i]; i++) {\n          block.setStyle(block.getStyleName());\n        }\n      }\n    }\n  }\n\n  /**\n   * Reconnect an block to a mutated input.\n   *\n   * @param connectionChild Connection on child block.\n   * @param block Parent block.\n   * @param inputName Name of input on parent block.\n   * @returns True iff a reconnection was made, false otherwise.\n   */\n  static reconnect(\n      connectionChild: Connection, block: Block, inputName: string): boolean {\n    if (!connectionChild || !connectionChild.getSourceBlock().workspace) {\n      return false;  // No connection or block has been deleted.\n    }\n    const connectionParent = block.getInput(inputName)!.connection;\n    const currentParent = connectionChild.targetBlock();\n    if ((!currentParent || currentParent === block) && connectionParent &&\n        connectionParent.targetConnection !== connectionChild) {\n      if (connectionParent.isConnected()) {\n        // There's already something connected here.  Get rid of it.\n        connectionParent.disconnect();\n      }\n      connectionParent.connect(connectionChild);\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Get the parent workspace of a workspace that is inside a mutator, taking\n   * into account whether it is a flyout.\n   *\n   * @param workspace The workspace that is inside a mutator.\n   * @returns The mutator's parent workspace or null.\n   */\n  static findParentWs(workspace: WorkspaceSvg): WorkspaceSvg|null {\n    let outerWs = null;\n    if (workspace && workspace.options) {\n      const parent = workspace.options.parentWorkspace;\n      // If we were in a flyout in a mutator, need to go up two levels to find\n      // the actual parent.\n      if (workspace.isFlyout) {\n        if (parent && parent.options) {\n          outerWs = parent.options.parentWorkspace;\n        }\n      } else if (parent) {\n        outerWs = parent;\n      }\n    }\n    return outerWs;\n  }\n}\n","/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Events fired as a result of trashcan flyout open and close.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events.TrashcanOpen');\n\nimport * as deprecation from '../utils/deprecation.js';\nimport * as registry from '../registry.js';\nimport {AbstractEventJson} from './events_abstract.js';\n\nimport {UiBase} from './events_ui_base.js';\nimport * as eventUtils from './utils.js';\nimport type {Workspace} from '../workspace.js';\n\n\n/**\n * Class for a trashcan open event.\n *\n * @alias Blockly.Events.TrashcanOpen\n */\nexport class TrashcanOpen extends UiBase {\n  isOpen?: boolean;\n  override type = eventUtils.TRASHCAN_OPEN;\n\n  /**\n   * @param opt_isOpen Whether the trashcan flyout is opening (false if\n   *     opening). Undefined for a blank event.\n   * @param opt_workspaceId The workspace identifier for this event.\n   *    Undefined for a blank event.\n   */\n  constructor(opt_isOpen?: boolean, opt_workspaceId?: string) {\n    super(opt_workspaceId);\n\n    /** Whether the trashcan flyout is opening (false if closing). */\n    this.isOpen = opt_isOpen;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): TrashcanOpenJson {\n    const json = super.toJson() as TrashcanOpenJson;\n    if (this.isOpen === undefined) {\n      throw new Error(\n          'Whether this is already open or not is undefined. Either pass ' +\n          'a value to the constructor, or call fromJson');\n    }\n    json['isOpen'] = this.isOpen;\n    return json;\n  }\n\n  /**\n   * Decode the JSON event.\n   *\n   * @param json JSON representation.\n   */\n  override fromJson(json: TrashcanOpenJson) {\n    deprecation.warn(\n        'Blockly.Events.TrashcanOpen.prototype.fromJson', 'version 9',\n        'version 10', 'Blockly.Events.fromJson');\n    super.fromJson(json);\n    this.isOpen = json['isOpen'];\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of TrashcanOpen, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(json: TrashcanOpenJson, workspace: Workspace, event?: any):\n      TrashcanOpen {\n    const newEvent =\n        super.fromJson(json, workspace, event ?? new TrashcanOpen()) as\n        TrashcanOpen;\n    newEvent.isOpen = json['isOpen'];\n    return newEvent;\n  }\n}\n\nexport interface TrashcanOpenJson extends AbstractEventJson {\n  isOpen: boolean;\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.TRASHCAN_OPEN, TrashcanOpen);\n","/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Manager for all items registered with the workspace.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.ComponentManager');\n\nimport type {IAutoHideable} from './interfaces/i_autohideable.js';\nimport type {IComponent} from './interfaces/i_component.js';\nimport type {IDeleteArea} from './interfaces/i_delete_area.js';\nimport type {IDragTarget} from './interfaces/i_drag_target.js';\nimport type {IPositionable} from './interfaces/i_positionable.js';\nimport * as arrayUtils from './utils/array.js';\n\n\nclass Capability<_T> {\n  static POSITIONABLE = new Capability<IPositionable>('positionable');\n  static DRAG_TARGET = new Capability<IDragTarget>('drag_target');\n  static DELETE_AREA = new Capability<IDeleteArea>('delete_area');\n  static AUTOHIDEABLE = new Capability<IAutoHideable>('autohideable');\n  private readonly name_: string;\n  /** @param name The name of the component capability. */\n  constructor(name: string) {\n    this.name_ = name;\n  }\n\n  /**\n   * Returns the name of the capability.\n   *\n   * @returns The name.\n   */\n  toString(): string {\n    return this.name_;\n  }\n}\n\n/**\n * Manager for all items registered with the workspace.\n *\n * @alias Blockly.ComponentManager\n */\nexport class ComponentManager {\n  static Capability = Capability;\n\n  /**\n   * A map of the components registered with the workspace, mapped to id.\n   */\n  private readonly componentData = new Map<string, ComponentDatum>();\n\n  /** A map of capabilities to component IDs. */\n  private readonly capabilityToComponentIds = new Map<string, string[]>();\n\n  /**\n   * Adds a component.\n   *\n   * @param componentInfo The data for the component to register.\n   * @param opt_allowOverrides True to prevent an error when overriding an\n   *     already registered item.\n   */\n  addComponent(componentInfo: ComponentDatum, opt_allowOverrides?: boolean) {\n    // Don't throw an error if opt_allowOverrides is true.\n    const id = componentInfo.component.id;\n    if (!opt_allowOverrides && this.componentData.has(id)) {\n      throw Error(\n          'Plugin \"' + id + '\" with capabilities \"' +\n          this.componentData.get(id)?.capabilities + '\" already added.');\n    }\n    this.componentData.set(id, componentInfo);\n    const stringCapabilities = [];\n    for (let i = 0; i < componentInfo.capabilities.length; i++) {\n      const capability = String(componentInfo.capabilities[i]).toLowerCase();\n      stringCapabilities.push(capability);\n      if (!this.capabilityToComponentIds.has(capability)) {\n        this.capabilityToComponentIds.set(capability, [id]);\n      } else {\n        this.capabilityToComponentIds.get(capability)?.push(id);\n      }\n    }\n    this.componentData.get(id)!.capabilities = stringCapabilities;\n  }\n\n  /**\n   * Removes a component.\n   *\n   * @param id The ID of the component to remove.\n   */\n  removeComponent(id: string) {\n    const componentInfo = this.componentData.get(id);\n    if (!componentInfo) {\n      return;\n    }\n    for (let i = 0; i < componentInfo.capabilities.length; i++) {\n      const capability = String(componentInfo.capabilities[i]).toLowerCase();\n      arrayUtils.removeElem(this.capabilityToComponentIds.get(capability)!, id);\n    }\n    this.componentData.delete(id);\n  }\n\n  /**\n   * Adds a capability to a existing registered component.\n   *\n   * @param id The ID of the component to add the capability to.\n   * @param capability The capability to add.\n   */\n  addCapability<T>(id: string, capability: string|Capability<T>) {\n    if (!this.getComponent(id)) {\n      throw Error(\n          'Cannot add capability, \"' + capability + '\". Plugin \"' + id +\n          '\" has not been added to the ComponentManager');\n    }\n    if (this.hasCapability(id, capability)) {\n      console.warn(\n          'Plugin \"' + id + 'already has capability \"' + capability + '\"');\n      return;\n    }\n    capability = String(capability).toLowerCase();\n    this.componentData.get(id)?.capabilities.push(capability);\n    this.capabilityToComponentIds.get(capability)?.push(id);\n  }\n\n  /**\n   * Removes a capability from an existing registered component.\n   *\n   * @param id The ID of the component to remove the capability from.\n   * @param capability The capability to remove.\n   */\n  removeCapability<T>(id: string, capability: string|Capability<T>) {\n    if (!this.getComponent(id)) {\n      throw Error(\n          'Cannot remove capability, \"' + capability + '\". Plugin \"' + id +\n          '\" has not been added to the ComponentManager');\n    }\n    if (!this.hasCapability(id, capability)) {\n      console.warn(\n          'Plugin \"' + id + 'doesn\\'t have capability \"' + capability +\n          '\" to remove');\n      return;\n    }\n    capability = String(capability).toLowerCase();\n    arrayUtils.removeElem(this.componentData.get(id)!.capabilities, capability);\n    arrayUtils.removeElem(this.capabilityToComponentIds.get(capability)!, id);\n  }\n\n  /**\n   * Returns whether the component with this id has the specified capability.\n   *\n   * @param id The ID of the component to check.\n   * @param capability The capability to check for.\n   * @returns Whether the component has the capability.\n   */\n  hasCapability<T>(id: string, capability: string|Capability<T>): boolean {\n    capability = String(capability).toLowerCase();\n    return this.componentData.has(id) &&\n        this.componentData.get(id)!.capabilities.indexOf(capability) !== -1;\n  }\n\n  /**\n   * Gets the component with the given ID.\n   *\n   * @param id The ID of the component to get.\n   * @returns The component with the given name or undefined if not found.\n   */\n  getComponent(id: string): IComponent|undefined {\n    return this.componentData.get(id)?.component;\n  }\n\n  /**\n   * Gets all the components with the specified capability.\n   *\n   * @param capability The capability of the component.\n   * @param sorted Whether to return list ordered by weights.\n   * @returns The components that match the specified capability.\n   */\n  getComponents<T extends IComponent>(\n      capability: string|Capability<T>, sorted: boolean): T[] {\n    capability = String(capability).toLowerCase();\n    const componentIds = this.capabilityToComponentIds.get(capability);\n    if (!componentIds) {\n      return [];\n    }\n    const components: T[] = [];\n    if (sorted) {\n      const componentDataList: ComponentDatum[] = [];\n      componentIds.forEach((id) => {\n        componentDataList.push(this.componentData.get(id)!);\n      });\n      componentDataList.sort(function(a, b) {\n        return a.weight - b.weight;\n      });\n      componentDataList.forEach(function(componentDatum) {\n        components.push(componentDatum.component as T);\n      });\n    } else {\n      componentIds.forEach((id) => {\n        components.push(this.componentData.get(id)!.component as T);\n      });\n    }\n    return components;\n  }\n}\n\nexport namespace ComponentManager {\n  /** An object storing component information. */\n  export interface ComponentDatum {\n    component: IComponent;\n    capabilities: Array<string|Capability<IComponent>>;\n    weight: number;\n  }\n}\n\nexport type ComponentDatum = ComponentManager.ComponentDatum;\n","/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Contains custom errors thrown by the serialization system.\n *\n * @namespace Blockly.serialization.exceptions\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.serialization.exceptions');\n\nimport type {Block} from '../block.js';\nimport type {State} from './blocks.js';\n\n\n/** @alias Blockly.serialization.exceptions.DeserializationError */\nexport class DeserializationError extends Error {}\n\n/**\n * Represents an error where the serialized state is expected to provide a\n * block type, but it is not provided.\n *\n * @alias Blockly.serialization.exceptions.MissingBlockType\n */\nexport class MissingBlockType extends DeserializationError {\n  /**\n   * @param state The state object which is missing the block type.\n   * @internal\n   */\n  constructor(public state: State) {\n    super(`Expected to find a 'type' property, defining the block type`);\n  }\n}\n\n/**\n * Represents an error where deserialization encountered a block that did\n * not have a connection that was defined in the serialized state.\n *\n * @alias Blockly.serialization.exceptions.MissingConnection\n */\nexport class MissingConnection extends DeserializationError {\n  /**\n   * @param connection The name of the connection that is missing. E.g.\n   *     'IF0', or 'next'.\n   * @param block The block missing the connection.\n   * @param state The state object containing the bad connection.\n   * @internal\n   */\n  constructor(connection: string, public block: Block, public state: State) {\n    super(`The block ${block.toDevString()} is missing a(n) ${connection}\nconnection`);\n  }\n}\n\n/**\n * Represents an error where deserialization tried to connect two connections\n * that were not compatible.\n *\n * @alias Blockly.serialization.exceptions.BadConnectionCheck\n */\nexport class BadConnectionCheck extends DeserializationError {\n  /**\n   * @param reason The reason the connections were not compatible.\n   * @param childConnection The name of the incompatible child connection. E.g.\n   *     'output' or 'previous'.\n   * @param childBlock The child block that could not connect to its parent.\n   * @param childState The state object representing the child block.\n   * @internal\n   */\n  constructor(\n      reason: string, childConnection: string, public childBlock: Block,\n      public childState: State) {\n    super(`The block ${childBlock.toDevString()} could not connect its\n${childConnection} to its parent, because: ${reason}`);\n  }\n}\n\n/**\n * Represents an error where deserialization encountered a real block as it\n * was deserializing children of a shadow.\n * This is an error because it is an invariant of Blockly that shadow blocks\n * do not have real children.\n *\n * @alias Blockly.serialization.exceptions.RealChildOfShadow\n */\nexport class RealChildOfShadow extends DeserializationError {\n  /**\n   * @param state The state object representing the real block.\n   * @internal\n   */\n  constructor(public state: State) {\n    super(`Encountered a real block which is defined as a child of a shadow\nblock. It is an invariant of Blockly that shadow blocks only have shadow\nchildren`);\n  }\n}\n","/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The top level namespace for priorities of plugin serializers.\n * Includes constants for the priorities of different plugin serializers. Higher\n * priorities are deserialized first.\n *\n * @namespace Blockly.serialization.priorities\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.serialization.priorities');\n\n\n/**\n * The priority for deserializing variables.\n *\n * @alias Blockly.serialization.priorities.VARIABLES\n */\nexport const VARIABLES = 100;\n\n/**\n * The priority for deserializing variable data.\n */\nexport const PROCEDURES = 75;\n\n/**\n * The priority for deserializing blocks.\n *\n * @alias Blockly.serialization.priorities.BLOCKS\n */\nexport const BLOCKS = 50;\n","/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for a block creation event.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events.BlockCreate');\n\nimport type {Block} from '../block.js';\nimport * as deprecation from '../utils/deprecation.js';\nimport * as registry from '../registry.js';\nimport * as blocks from '../serialization/blocks.js';\nimport * as Xml from '../xml.js';\n\nimport {BlockBase, BlockBaseJson} from './events_block_base.js';\nimport * as eventUtils from './utils.js';\nimport {Workspace} from '../workspace.js';\n\n\n/**\n * Class for a block creation event.\n *\n * @alias Blockly.Events.BlockCreate\n */\nexport class BlockCreate extends BlockBase {\n  override type = eventUtils.BLOCK_CREATE;\n  xml?: Element|DocumentFragment;\n  ids?: string[];\n  json?: blocks.State;\n\n  /** @param opt_block The created block.  Undefined for a blank event. */\n  constructor(opt_block?: Block) {\n    super(opt_block);\n\n    if (!opt_block) {\n      return;  // Blank event to be populated by fromJson.\n    }\n\n    if (opt_block.isShadow()) {\n      // Moving shadow blocks is handled via disconnection.\n      this.recordUndo = false;\n    }\n\n    this.xml = Xml.blockToDomWithXY(opt_block);\n    this.ids = eventUtils.getDescendantIds(opt_block);\n\n    /** JSON representation of the block that was just created. */\n    this.json = blocks.save(opt_block, {addCoordinates: true}) as blocks.State;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): BlockCreateJson {\n    const json = super.toJson() as BlockCreateJson;\n    if (!this.xml) {\n      throw new Error(\n          'The block XML is undefined. Either pass a block to ' +\n          'the constructor, or call fromJson');\n    }\n    if (!this.ids) {\n      throw new Error(\n          'The block IDs are undefined. Either pass a block to ' +\n          'the constructor, or call fromJson');\n    }\n    if (!this.json) {\n      throw new Error(\n          'The block JSON is undefined. Either pass a block to ' +\n          'the constructor, or call fromJson');\n    }\n    json['xml'] = Xml.domToText(this.xml);\n    json['ids'] = this.ids;\n    json['json'] = this.json;\n    if (!this.recordUndo) {\n      json['recordUndo'] = this.recordUndo;\n    }\n    return json;\n  }\n\n  /**\n   * Decode the JSON event.\n   *\n   * @param json JSON representation.\n   */\n  override fromJson(json: BlockCreateJson) {\n    deprecation.warn(\n        'Blockly.Events.BlockCreate.prototype.fromJson', 'version 9',\n        'version 10', 'Blockly.Events.fromJson');\n    super.fromJson(json);\n    this.xml = Xml.textToDom(json['xml']);\n    this.ids = json['ids'];\n    this.json = json['json'] as blocks.State;\n    if (json['recordUndo'] !== undefined) {\n      this.recordUndo = json['recordUndo'];\n    }\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of BlockCreate, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(json: BlockCreateJson, workspace: Workspace, event?: any):\n      BlockCreate {\n    const newEvent =\n        super.fromJson(json, workspace, event ?? new BlockCreate()) as\n        BlockCreate;\n    newEvent.xml = Xml.textToDom(json['xml']);\n    newEvent.ids = json['ids'];\n    newEvent.json = json['json'] as blocks.State;\n    if (json['recordUndo'] !== undefined) {\n      newEvent.recordUndo = json['recordUndo'];\n    }\n    return newEvent;\n  }\n\n  /**\n   * Run a creation event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    const workspace = this.getEventWorkspace_();\n    if (!this.json) {\n      throw new Error(\n          'The block JSON is undefined. Either pass a block to ' +\n          'the constructor, or call fromJson');\n    }\n    if (!this.ids) {\n      throw new Error(\n          'The block IDs are undefined. Either pass a block to ' +\n          'the constructor, or call fromJson');\n    }\n    if (forward) {\n      blocks.append(this.json, workspace);\n    } else {\n      for (let i = 0; i < this.ids.length; i++) {\n        const id = this.ids[i];\n        const block = workspace.getBlockById(id);\n        if (block) {\n          block.dispose(false);\n        } else if (id === this.blockId) {\n          // Only complain about root-level block.\n          console.warn('Can\\'t uncreate non-existent block: ' + id);\n        }\n      }\n    }\n  }\n}\n\nexport interface BlockCreateJson extends BlockBaseJson {\n  xml: string;\n  ids: string[];\n  json: object;\n  recordUndo?: boolean;\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.CREATE, BlockCreate);\n","/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for a block delete event.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events.BlockDelete');\n\nimport type {Block} from '../block.js';\nimport * as deprecation from '../utils/deprecation.js';\nimport * as registry from '../registry.js';\nimport * as blocks from '../serialization/blocks.js';\nimport * as Xml from '../xml.js';\n\nimport {BlockBase, BlockBaseJson} from './events_block_base.js';\nimport * as eventUtils from './utils.js';\nimport {Workspace} from '../workspace.js';\n\n\n/**\n * Class for a block deletion event.\n *\n * @alias Blockly.Events.BlockDelete\n */\nexport class BlockDelete extends BlockBase {\n  oldXml?: Element|DocumentFragment;\n  ids?: string[];\n  wasShadow?: boolean;\n  oldJson?: blocks.State;\n  override type = eventUtils.BLOCK_DELETE;\n\n  /** @param opt_block The deleted block.  Undefined for a blank event. */\n  constructor(opt_block?: Block) {\n    super(opt_block);\n\n    if (!opt_block) {\n      return;  // Blank event to be populated by fromJson.\n    }\n\n    if (opt_block.getParent()) {\n      throw Error('Connected blocks cannot be deleted.');\n    }\n    if (opt_block.isShadow()) {\n      // Respawning shadow blocks is handled via disconnection.\n      this.recordUndo = false;\n    }\n\n    this.oldXml = Xml.blockToDomWithXY(opt_block);\n    this.ids = eventUtils.getDescendantIds(opt_block);\n\n    /** Was the block that was just deleted a shadow? */\n    this.wasShadow = opt_block.isShadow();\n\n    /** JSON representation of the block that was just deleted. */\n    this.oldJson =\n        blocks.save(opt_block, {addCoordinates: true}) as blocks.State;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): BlockDeleteJson {\n    const json = super.toJson() as BlockDeleteJson;\n    if (!this.oldXml) {\n      throw new Error(\n          'The old block XML is undefined. Either pass a block ' +\n          'to the constructor, or call fromJson');\n    }\n    if (!this.ids) {\n      throw new Error(\n          'The block IDs are undefined. Either pass a block to ' +\n          'the constructor, or call fromJson');\n    }\n    if (this.wasShadow === undefined) {\n      throw new Error(\n          'Whether the block was a shadow is undefined. Either ' +\n          'pass a block to the constructor, or call fromJson');\n    }\n    if (!this.oldJson) {\n      throw new Error(\n          'The old block JSON is undefined. Either pass a block ' +\n          'to the constructor, or call fromJson');\n    }\n    json['oldXml'] = Xml.domToText(this.oldXml);\n    json['ids'] = this.ids;\n    json['wasShadow'] = this.wasShadow;\n    json['oldJson'] = this.oldJson;\n    if (!this.recordUndo) {\n      json['recordUndo'] = this.recordUndo;\n    }\n    return json;\n  }\n\n  /**\n   * Decode the JSON event.\n   *\n   * @param json JSON representation.\n   */\n  override fromJson(json: BlockDeleteJson) {\n    deprecation.warn(\n        'Blockly.Events.BlockDelete.prototype.fromJson', 'version 9',\n        'version 10', 'Blockly.Events.fromJson');\n    super.fromJson(json);\n    this.oldXml = Xml.textToDom(json['oldXml']);\n    this.ids = json['ids'];\n    this.wasShadow =\n        json['wasShadow'] || this.oldXml.tagName.toLowerCase() === 'shadow';\n    this.oldJson = json['oldJson'];\n    if (json['recordUndo'] !== undefined) {\n      this.recordUndo = json['recordUndo'];\n    }\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of BlockDelete, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(json: BlockDeleteJson, workspace: Workspace, event?: any):\n      BlockDelete {\n    const newEvent =\n        super.fromJson(json, workspace, event ?? new BlockDelete()) as\n        BlockDelete;\n    newEvent.oldXml = Xml.textToDom(json['oldXml']);\n    newEvent.ids = json['ids'];\n    newEvent.wasShadow =\n        json['wasShadow'] || newEvent.oldXml.tagName.toLowerCase() === 'shadow';\n    newEvent.oldJson = json['oldJson'];\n    if (json['recordUndo'] !== undefined) {\n      newEvent.recordUndo = json['recordUndo'];\n    }\n    return newEvent;\n  }\n\n  /**\n   * Run a deletion event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    const workspace = this.getEventWorkspace_();\n    if (!this.ids) {\n      throw new Error(\n          'The block IDs are undefined. Either pass a block to ' +\n          'the constructor, or call fromJson');\n    }\n    if (!this.oldJson) {\n      throw new Error(\n          'The old block JSON is undefined. Either pass a block ' +\n          'to the constructor, or call fromJson');\n    }\n    if (forward) {\n      for (let i = 0; i < this.ids.length; i++) {\n        const id = this.ids[i];\n        const block = workspace.getBlockById(id);\n        if (block) {\n          block.dispose(false);\n        } else if (id === this.blockId) {\n          // Only complain about root-level block.\n          console.warn('Can\\'t delete non-existent block: ' + id);\n        }\n      }\n    } else {\n      blocks.append(this.oldJson, workspace);\n    }\n  }\n}\n\nexport interface BlockDeleteJson extends BlockBaseJson {\n  oldXml: string;\n  ids: string[];\n  wasShadow: boolean;\n  oldJson: blocks.State;\n  recordUndo?: boolean;\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.DELETE, BlockDelete);\n","/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * An enum for the possible types of connections.\n *\n * @namespace Blockly.ConnectionType\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.ConnectionType');\n\n\n/**\n * Enum for the type of a connection or input.\n *\n * @alias Blockly.ConnectionType\n */\nexport enum ConnectionType {\n  // A right-facing value input.  E.g. 'set item to' or 'return'.\n  INPUT_VALUE = 1,\n  // A left-facing value output.  E.g. 'random fraction'.\n  OUTPUT_VALUE,\n  // A down-facing block stack.  E.g. 'if-do' or 'else'.\n  NEXT_STATEMENT,\n  // An up-facing block stack.  E.g. 'break out of loop'.\n  PREVIOUS_STATEMENT\n}\n","/**\n * @license\n * Copyright 2016 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Blockly constants.\n *\n * @namespace Blockly.constants\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.constants');\n\n\n/**\n * The language-neutral ID given to the collapsed input.\n *\n * @alias Blockly.constants.COLLAPSED_INPUT_NAME\n */\nexport const COLLAPSED_INPUT_NAME = '_TEMP_COLLAPSED_INPUT';\n\n/**\n * The language-neutral ID given to the collapsed field.\n *\n * @alias Blockly.constants.COLLAPSED_FIELD_NAME\n */\nexport const COLLAPSED_FIELD_NAME = '_TEMP_COLLAPSED_FIELD';\n","/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Non-editable, non-serializable text field.  Used for titles,\n *    labels, etc.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.FieldLabel');\n\nimport * as dom from './utils/dom.js';\nimport {Field, FieldConfig} from './field.js';\nimport * as fieldRegistry from './field_registry.js';\nimport * as parsing from './utils/parsing.js';\nimport type {Sentinel} from './utils/sentinel.js';\n\n/**\n * Class for a non-editable, non-serializable text field.\n *\n * @alias Blockly.FieldLabel\n */\nexport class FieldLabel extends Field<string> {\n  /** The html class name to use for this field. */\n  private class_: string|null = null;\n\n  /**\n   * Editable fields usually show some sort of UI indicating they are\n   * editable. This field should not.\n   */\n  override EDITABLE = false;\n\n  /**\n   * @param opt_value The initial value of the field. Should cast to a string.\n   *     Defaults to an empty string if null or undefined. Also accepts\n   *     Field.SKIP_SETUP if you wish to skip setup (only used by subclasses\n   *     that want to handle configuration and setting the field value after\n   *     their own constructors have run).\n   * @param opt_class Optional CSS class for the field's text.\n   * @param opt_config A map of options used to configure the field.\n   *    See the [field creation documentation]{@link\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/label#creation}\n   * for a list of properties this parameter supports.\n   */\n  constructor(\n      opt_value?: string|Sentinel, opt_class?: string,\n      opt_config?: FieldLabelConfig) {\n    super(Field.SKIP_SETUP);\n\n    if (opt_value === Field.SKIP_SETUP) {\n      return;\n    }\n    if (opt_config) {\n      this.configure_(opt_config);\n    } else {\n      this.class_ = opt_class || null;\n    }\n    this.setValue(opt_value);\n  }\n\n  protected override configure_(config: FieldLabelConfig) {\n    super.configure_(config);\n    if (config.class) this.class_ = config.class;\n  }\n\n  /**\n   * Create block UI for this label.\n   *\n   * @internal\n   */\n  override initView() {\n    this.createTextElement_();\n    if (this.class_) {\n      dom.addClass(this.getTextElement(), this.class_);\n    }\n  }\n\n  /**\n   * Ensure that the input value casts to a valid string.\n   *\n   * @param opt_newValue The input value.\n   * @returns A valid string, or null if invalid.\n   */\n  protected override doClassValidation_(opt_newValue?: AnyDuringMigration):\n      string|null {\n    if (opt_newValue === null || opt_newValue === undefined) {\n      return null;\n    }\n    return String(opt_newValue);\n  }\n\n  /**\n   * Set the CSS class applied to the field's textElement_.\n   *\n   * @param cssClass The new CSS class name, or null to remove.\n   */\n  setClass(cssClass: string|null) {\n    if (this.textElement_) {\n      if (this.class_) {\n        dom.removeClass(this.textElement_, this.class_);\n      }\n      if (cssClass) {\n        dom.addClass(this.textElement_, cssClass);\n      }\n    }\n    this.class_ = cssClass;\n  }\n\n  /**\n   * Construct a FieldLabel from a JSON arg object,\n   * dereferencing any string table references.\n   *\n   * @param options A JSON object with options (text, and class).\n   * @returns The new field instance.\n   * @nocollapse\n   * @internal\n   */\n  static fromJson(options: FieldLabelFromJsonConfig): FieldLabel {\n    const text = parsing.replaceMessageReferences(options.text);\n    // `this` might be a subclass of FieldLabel if that class doesn't override\n    // the static fromJson method.\n    return new this(text, undefined, options);\n  }\n}\n\nfieldRegistry.register('field_label', FieldLabel);\n\nFieldLabel.prototype.DEFAULT_VALUE = '';\n\n// clang-format off\n// Clang does not like the 'class' keyword being used as a property.\n/**\n * Config options for the label field.\n */\nexport interface FieldLabelConfig extends FieldConfig {\n  class?: string;\n}\n// clang-format on\n\n\n/**\n * fromJson config options for the label field.\n */\nexport interface FieldLabelFromJsonConfig extends FieldLabelConfig {\n  text?: string;\n}\n","/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing an input (value, statement, or dummy).\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Input');\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './field_label.js';\n\nimport type {Block} from './block.js';\nimport type {BlockSvg} from './block_svg.js';\nimport type {Connection} from './connection.js';\nimport type {Field} from './field.js';\nimport * as fieldRegistry from './field_registry.js';\nimport {inputTypes} from './input_types.js';\nimport type {RenderedConnection} from './rendered_connection.js';\n\n\n/**\n * Class for an input with an optional field.\n *\n * @alias Blockly.Input\n */\nexport class Input {\n  private sourceBlock: Block;\n  fieldRow: Field[] = [];\n  /** Alignment of input's fields (left, right or centre). */\n  align = Align.LEFT;\n\n  /** Is the input visible? */\n  private visible = true;\n\n  /**\n   * @param type The type of the input.\n   * @param name Language-neutral identifier which may used to find this input\n   *     again.\n   * @param block The block containing this input.\n   * @param connection Optional connection for this input.\n   */\n  constructor(\n      public type: number, public name: string, block: Block,\n      public connection: Connection|null) {\n    if (type !== inputTypes.DUMMY && !name) {\n      throw Error(\n          'Value inputs and statement inputs must have non-empty name.');\n    }\n    this.sourceBlock = block;\n  }\n\n  /**\n   * Get the source block for this input.\n   *\n   * @returns The block this input is part of.\n   */\n  getSourceBlock(): Block {\n    return this.sourceBlock;\n  }\n\n  /**\n   * Add a field (or label from string), and all prefix and suffix fields, to\n   * the end of the input's field row.\n   *\n   * @param field Something to add as a field.\n   * @param opt_name Language-neutral identifier which may used to find this\n   *     field again.  Should be unique to the host block.\n   * @returns The input being append to (to allow chaining).\n   */\n  appendField<T>(field: string|Field<T>, opt_name?: string): Input {\n    this.insertFieldAt(this.fieldRow.length, field, opt_name);\n    return this;\n  }\n\n  /**\n   * Inserts a field (or label from string), and all prefix and suffix fields,\n   * at the location of the input's field row.\n   *\n   * @param index The index at which to insert field.\n   * @param field Something to add as a field.\n   * @param opt_name Language-neutral identifier which may used to find this\n   *     field again.  Should be unique to the host block.\n   * @returns The index following the last inserted field.\n   */\n  insertFieldAt<T>(index: number, field: string|Field<T>, opt_name?: string):\n      number {\n    if (index < 0 || index > this.fieldRow.length) {\n      throw Error('index ' + index + ' out of bounds.');\n    }\n    // Falsy field values don't generate a field, unless the field is an empty\n    // string and named.\n    if (!field && !(field === '' && opt_name)) {\n      return index;\n    }\n\n    // Generate a FieldLabel when given a plain text field.\n    if (typeof field === 'string') {\n      field = fieldRegistry.fromJson({\n        type: 'field_label',\n        text: field,\n      })!;\n    }\n\n    field.setSourceBlock(this.sourceBlock);\n    if (this.sourceBlock.rendered) {\n      field.init();\n      field.applyColour();\n    }\n    field.name = opt_name;\n    field.setVisible(this.isVisible());\n\n    if (field.prefixField) {\n      // Add any prefix.\n      index = this.insertFieldAt(index, field.prefixField);\n    }\n    // Add the field to the field row.\n    this.fieldRow.splice(index, 0, field as Field);\n    index++;\n    if (field.suffixField) {\n      // Add any suffix.\n      index = this.insertFieldAt(index, field.suffixField);\n    }\n\n    if (this.sourceBlock.rendered) {\n      (this.sourceBlock as BlockSvg).render();\n      // Adding a field will cause the block to change shape.\n      this.sourceBlock.bumpNeighbours();\n    }\n    return index;\n  }\n\n  /**\n   * Remove a field from this input.\n   *\n   * @param name The name of the field.\n   * @param opt_quiet True to prevent an error if field is not present.\n   * @returns True if operation succeeds, false if field is not present and\n   *     opt_quiet is true.\n   * @throws {Error} if the field is not present and opt_quiet is false.\n   */\n  removeField(name: string, opt_quiet?: boolean): boolean {\n    for (let i = 0, field; field = this.fieldRow[i]; i++) {\n      if (field.name === name) {\n        field.dispose();\n        this.fieldRow.splice(i, 1);\n        if (this.sourceBlock.rendered) {\n          (this.sourceBlock as BlockSvg).render();\n          // Removing a field will cause the block to change shape.\n          this.sourceBlock.bumpNeighbours();\n        }\n        return true;\n      }\n    }\n    if (opt_quiet) {\n      return false;\n    }\n    throw Error('Field \"' + name + '\" not found.');\n  }\n\n  /**\n   * Gets whether this input is visible or not.\n   *\n   * @returns True if visible.\n   */\n  isVisible(): boolean {\n    return this.visible;\n  }\n\n  /**\n   * Sets whether this input is visible or not.\n   * Should only be used to collapse/uncollapse a block.\n   *\n   * @param visible True if visible.\n   * @returns List of blocks to render.\n   * @internal\n   */\n  setVisible(visible: boolean): BlockSvg[] {\n    // Note: Currently there are only unit tests for block.setCollapsed()\n    // because this function is package. If this function goes back to being a\n    // public API tests (lots of tests) should be added.\n    let renderList: AnyDuringMigration[] = [];\n    if (this.visible === visible) {\n      return renderList;\n    }\n    this.visible = visible;\n\n    for (let y = 0, field; field = this.fieldRow[y]; y++) {\n      field.setVisible(visible);\n    }\n    if (this.connection) {\n      const renderedConnection = this.connection as RenderedConnection;\n      // Has a connection.\n      if (visible) {\n        renderList = renderedConnection.startTrackingAll();\n      } else {\n        renderedConnection.stopTrackingAll();\n      }\n      const child = renderedConnection.targetBlock();\n      if (child) {\n        child.getSvgRoot().style.display = visible ? 'block' : 'none';\n      }\n    }\n    return renderList;\n  }\n\n  /**\n   * Mark all fields on this input as dirty.\n   *\n   * @internal\n   */\n  markDirty() {\n    for (let y = 0, field; field = this.fieldRow[y]; y++) {\n      field.markDirty();\n    }\n  }\n\n  /**\n   * Change a connection's compatibility.\n   *\n   * @param check Compatible value type or list of value types.  Null if all\n   *     types are compatible.\n   * @returns The input being modified (to allow chaining).\n   */\n  setCheck(check: string|string[]|null): Input {\n    if (!this.connection) {\n      throw Error('This input does not have a connection.');\n    }\n    this.connection.setCheck(check);\n    return this;\n  }\n\n  /**\n   * Change the alignment of the connection's field(s).\n   *\n   * @param align One of the values of Align.  In RTL mode directions\n   *     are reversed, and Align.RIGHT aligns to the left.\n   * @returns The input being modified (to allow chaining).\n   */\n  setAlign(align: Align): Input {\n    this.align = align;\n    if (this.sourceBlock.rendered) {\n      const sourceBlock = this.sourceBlock as BlockSvg;\n      sourceBlock.render();\n    }\n    return this;\n  }\n\n  /**\n   * Changes the connection's shadow block.\n   *\n   * @param shadow DOM representation of a block or null.\n   * @returns The input being modified (to allow chaining).\n   */\n  setShadowDom(shadow: Element|null): Input {\n    if (!this.connection) {\n      throw Error('This input does not have a connection.');\n    }\n    this.connection.setShadowDom(shadow);\n    return this;\n  }\n\n  /**\n   * Returns the XML representation of the connection's shadow block.\n   *\n   * @returns Shadow DOM representation of a block or null.\n   */\n  getShadowDom(): Element|null {\n    if (!this.connection) {\n      throw Error('This input does not have a connection.');\n    }\n    return this.connection.getShadowDom();\n  }\n\n  /** Initialize the fields on this input. */\n  init() {\n    if (!this.sourceBlock.workspace.rendered) {\n      return;  // Headless blocks don't need fields initialized.\n    }\n    for (let i = 0; i < this.fieldRow.length; i++) {\n      this.fieldRow[i].init();\n    }\n  }\n\n  /**\n   * Sever all links to this input.\n   *\n   * @suppress {checkTypes}\n   */\n  dispose() {\n    for (let i = 0, field; field = this.fieldRow[i]; i++) {\n      field.dispose();\n    }\n    if (this.connection) {\n      this.connection.dispose();\n    }\n  }\n}\n\nexport namespace Input {\n  /**\n   * Enum for alignment of inputs.\n   *\n   * @alias Blockly.Input.Align\n   */\n  export enum Align {\n    LEFT = -1,\n    CENTRE = 0,\n    RIGHT = 1,\n  }\n}\n\nexport type Align = Input.Align;\nexport const Align = Input.Align;\n","/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The class representing one block.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Block');\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_change.js';\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_create.js';\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_delete.js';\n\nimport {Blocks} from './blocks.js';\nimport type {Comment} from './comment.js';\nimport * as common from './common.js';\nimport {Connection} from './connection.js';\nimport {ConnectionType} from './connection_type.js';\nimport * as constants from './constants.js';\nimport type {Abstract} from './events/events_abstract.js';\nimport type {BlockMove} from './events/events_block_move.js';\nimport * as eventUtils from './events/utils.js';\nimport * as Extensions from './extensions.js';\nimport type {Field} from './field.js';\nimport * as fieldRegistry from './field_registry.js';\nimport {Align, Input} from './input.js';\nimport {inputTypes} from './input_types.js';\nimport type {IASTNodeLocation} from './interfaces/i_ast_node_location.js';\nimport type {IDeletable} from './interfaces/i_deletable.js';\nimport {ASTNode} from './keyboard_nav/ast_node.js';\nimport type {Mutator} from './mutator.js';\nimport * as Tooltip from './tooltip.js';\nimport * as arrayUtils from './utils/array.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as idGenerator from './utils/idgenerator.js';\nimport * as parsing from './utils/parsing.js';\nimport {Size} from './utils/size.js';\nimport type {VariableModel} from './variable_model.js';\nimport type {Workspace} from './workspace.js';\n\n\n/**\n * Class for one block.\n * Not normally called directly, workspace.newBlock() is preferred.\n *\n * @alias Blockly.Block\n */\nexport class Block implements IASTNodeLocation, IDeletable {\n  /**\n   * An optional callback method to use whenever the block's parent workspace\n   * changes. This is usually only called from the constructor, the block type\n   * initializer function, or an extension initializer function.\n   */\n  onchange?: ((p1: Abstract) => AnyDuringMigration)|null;\n\n  /** The language-neutral ID given to the collapsed input. */\n  static readonly COLLAPSED_INPUT_NAME: string = constants.COLLAPSED_INPUT_NAME;\n\n  /** The language-neutral ID given to the collapsed field. */\n  static readonly COLLAPSED_FIELD_NAME: string = constants.COLLAPSED_FIELD_NAME;\n\n  /**\n   * Optional text data that round-trips between blocks and XML.\n   * Has no effect. May be used by 3rd parties for meta information.\n   */\n  data: string|null = null;\n\n  /**\n   * Has this block been disposed of?\n   *\n   * @internal\n   */\n  disposed = false;\n\n  /**\n   * Colour of the block as HSV hue value (0-360)\n   * This may be null if the block colour was not set via a hue number.\n   */\n  private hue_: number|null = null;\n\n  /** Colour of the block in '#RRGGBB' format. */\n  protected colour_ = '#000000';\n\n  /** Name of the block style. */\n  protected styleName_ = '';\n\n  /** An optional method called during initialization. */\n  init?: (() => AnyDuringMigration)|null = undefined;\n\n  /** An optional method called during disposal. */\n  destroy?: (() => void) = undefined;\n\n  /**\n   * An optional serialization method for defining how to serialize the\n   * mutation state to XML. This must be coupled with defining\n   * `domToMutation`.\n   */\n  mutationToDom?: ((...p1: AnyDuringMigration[]) => Element)|null = undefined;\n\n  /**\n   * An optional deserialization method for defining how to deserialize the\n   * mutation state from XML. This must be coupled with defining\n   * `mutationToDom`.\n   */\n  domToMutation?: ((p1: Element) => AnyDuringMigration)|null = undefined;\n\n  /**\n   * An optional serialization method for defining how to serialize the\n   * block's extra state (eg mutation state) to something JSON compatible.\n   * This must be coupled with defining `loadExtraState`.\n   */\n  saveExtraState?: (() => AnyDuringMigration)|null = undefined;\n\n  /**\n   * An optional serialization method for defining how to deserialize the\n   * block's extra state (eg mutation state) from something JSON compatible.\n   * This must be coupled with defining `saveExtraState`.\n   */\n  loadExtraState?:\n      ((p1: AnyDuringMigration) => AnyDuringMigration)|null = undefined;\n\n  /**\n   * An optional property for suppressing adding STATEMENT_PREFIX and\n   * STATEMENT_SUFFIX to generated code.\n   */\n  suppressPrefixSuffix: boolean|null = false;\n\n  /**\n   * An optional property for declaring developer variables.  Return a list of\n   * variable names for use by generators.  Developer variables are never\n   * shown to the user, but are declared as global variables in the generated\n   * code.\n   */\n  getDeveloperVariables?: (() => string[]) = undefined;\n\n  /**\n   * An optional function that reconfigures the block based on the contents of\n   * the mutator dialog.\n   */\n  compose?: ((p1: Block) => void) = undefined;\n\n  /**\n   * An optional function that populates the mutator's dialog with\n   * this block's components.\n   */\n  decompose?: ((p1: Workspace) => Block) = undefined;\n  id: string;\n  // AnyDuringMigration because:  Type 'null' is not assignable to type\n  // 'Connection'.\n  outputConnection: Connection = null as AnyDuringMigration;\n  // AnyDuringMigration because:  Type 'null' is not assignable to type\n  // 'Connection'.\n  nextConnection: Connection = null as AnyDuringMigration;\n  // AnyDuringMigration because:  Type 'null' is not assignable to type\n  // 'Connection'.\n  previousConnection: Connection = null as AnyDuringMigration;\n  inputList: Input[] = [];\n  inputsInline?: boolean = undefined;\n  private disabled = false;\n  tooltip: Tooltip.TipInfo = '';\n  contextMenu = true;\n\n  protected parentBlock_: this|null = null;\n\n  protected childBlocks_: this[] = [];\n\n  private deletable_ = true;\n\n  private movable_ = true;\n\n  private editable_ = true;\n\n  private isShadow_ = false;\n\n  protected collapsed_ = false;\n  protected outputShape_: number|null = null;\n\n  /**\n   * Is the current block currently in the process of being disposed?\n   */\n  private disposing = false;\n\n  /**\n   * A string representing the comment attached to this block.\n   *\n   * @deprecated August 2019. Use getCommentText instead.\n   */\n  comment: string|Comment|null = null;\n  /** @internal */\n  commentModel: CommentModel;\n  private readonly xy_: Coordinate;\n  isInFlyout: boolean;\n  isInMutator: boolean;\n  RTL: boolean;\n\n  /** True if this block is an insertion marker. */\n  protected isInsertionMarker_ = false;\n\n  /** Name of the type of hat. */\n  hat?: string = undefined;\n\n  rendered: boolean|null = null;\n\n  /**\n   * String for block help, or function that returns a URL. Null for no help.\n   */\n  // AnyDuringMigration because:  Type 'null' is not assignable to type 'string\n  // | Function'.\n  helpUrl: string|Function = null as AnyDuringMigration;\n\n  /** A bound callback function to use when the parent workspace changes. */\n  private onchangeWrapper_: ((p1: Abstract) => AnyDuringMigration)|null = null;\n\n  /**\n   * A count of statement inputs on the block.\n   *\n   * @internal\n   */\n  statementInputCount = 0;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  type!: string;\n  // Record initial inline state.\n  inputsInlineDefault?: boolean;\n  workspace: Workspace;\n\n  /**\n   * @param workspace The block's workspace.\n   * @param prototypeName Name of the language object containing type-specific\n   *     functions for this block.\n   * @param opt_id Optional ID.  Use this ID if provided, otherwise create a new\n   *     ID.\n   * @throws When the prototypeName is not valid or not allowed.\n   */\n  constructor(workspace: Workspace, prototypeName: string, opt_id?: string) {\n    this.workspace = workspace;\n\n    this.id = opt_id && !workspace.getBlockById(opt_id) ? opt_id :\n                                                          idGenerator.genUid();\n    workspace.setBlockById(this.id, this);\n\n    /** A model of the comment attached to this block. */\n    this.commentModel = {text: null, pinned: false, size: new Size(160, 80)};\n\n    /**\n     * The block's position in workspace units.  (0, 0) is at the workspace's\n     * origin; scale does not change this value.\n     */\n    this.xy_ = new Coordinate(0, 0);\n    this.isInFlyout = workspace.isFlyout;\n    this.isInMutator = workspace.isMutator;\n\n    this.RTL = workspace.RTL;\n\n    // Copy the type-specific functions and data from the prototype.\n    if (prototypeName) {\n      this.type = prototypeName;\n      const prototype = Blocks[prototypeName];\n      if (!prototype || typeof prototype !== 'object') {\n        throw TypeError('Invalid block definition for type: ' + prototypeName);\n      }\n      Object.assign(this, prototype);\n    }\n\n    workspace.addTopBlock(this);\n    workspace.addTypedBlock(this);\n\n    if (new.target === Block) {\n      this.doInit_();\n    }\n  }\n\n  /** Calls the init() function and handles associated event firing, etc. */\n  protected doInit_() {\n    // All events fired should be part of the same group.\n    // Any events fired during init should not be undoable,\n    // so that block creation is atomic.\n    const existingGroup = eventUtils.getGroup();\n    if (!existingGroup) {\n      eventUtils.setGroup(true);\n    }\n    const initialUndoFlag = eventUtils.getRecordUndo();\n\n    try {\n      // Call an initialization function, if it exists.\n      if (typeof this.init === 'function') {\n        eventUtils.setRecordUndo(false);\n        this.init();\n        eventUtils.setRecordUndo(initialUndoFlag);\n      }\n\n      // Fire a create event.\n      if (eventUtils.isEnabled()) {\n        eventUtils.fire(new (eventUtils.get(eventUtils.BLOCK_CREATE))(this));\n      }\n    } finally {\n      if (!existingGroup) {\n        eventUtils.setGroup(false);\n      }\n      // In case init threw, recordUndo flag should still be reset.\n      eventUtils.setRecordUndo(initialUndoFlag);\n    }\n    this.inputsInlineDefault = this.inputsInline;\n\n    // Bind an onchange function, if it exists.\n    if (typeof this.onchange === 'function') {\n      this.setOnChange(this.onchange);\n    }\n  }\n\n  /**\n   * Dispose of this block.\n   *\n   * @param healStack If true, then try to heal any gap by connecting the next\n   *     statement with the previous statement.  Otherwise, dispose of all\n   *     children of this block.\n   * @suppress {checkTypes}\n   */\n  dispose(healStack: boolean) {\n    if (this.isDeadOrDying()) {\n      return;\n    }\n    // Terminate onchange event calls.\n    if (this.onchangeWrapper_) {\n      this.workspace.removeChangeListener(this.onchangeWrapper_);\n    }\n\n    this.unplug(healStack);\n    if (eventUtils.isEnabled()) {\n      eventUtils.fire(new (eventUtils.get(eventUtils.BLOCK_DELETE))(this));\n    }\n    eventUtils.disable();\n\n    try {\n      // This block is now at the top of the workspace.\n      // Remove this block from the workspace's list of top-most blocks.\n      this.workspace.removeTopBlock(this);\n      this.workspace.removeTypedBlock(this);\n      // Remove from block database.\n      this.workspace.removeBlockById(this.id);\n      this.disposing = true;\n\n      // First, dispose of all my children.\n      for (let i = this.childBlocks_.length - 1; i >= 0; i--) {\n        this.childBlocks_[i].dispose(false);\n      }\n      // Then dispose of myself.\n      // Dispose of all inputs and their fields.\n      for (let i = 0, input; input = this.inputList[i]; i++) {\n        input.dispose();\n      }\n      this.inputList.length = 0;\n      // Dispose of any remaining connections (next/previous/output).\n      const connections = this.getConnections_(true);\n      for (let i = 0, connection; connection = connections[i]; i++) {\n        connection.dispose();\n      }\n    } finally {\n      eventUtils.enable();\n      if (typeof this.destroy === 'function') {\n        this.destroy();\n      }\n      this.disposed = true;\n    }\n  }\n\n  /**\n   * Returns true if the block is either in the process of being disposed, or\n   * is disposed.\n   *\n   * @internal\n   */\n  isDeadOrDying(): boolean {\n    return this.disposing || this.disposed;\n  }\n\n  /**\n   * Call initModel on all fields on the block.\n   * May be called more than once.\n   * Either initModel or initSvg must be called after creating a block and\n   * before the first interaction with it.  Interactions include UI actions\n   * (e.g. clicking and dragging) and firing events (e.g. create, delete, and\n   * change).\n   */\n  initModel() {\n    for (let i = 0, input; input = this.inputList[i]; i++) {\n      for (let j = 0, field; field = input.fieldRow[j]; j++) {\n        if (field.initModel) {\n          field.initModel();\n        }\n      }\n    }\n  }\n\n  /**\n   * Unplug this block from its superior block.  If this block is a statement,\n   * optionally reconnect the block underneath with the block on top.\n   *\n   * @param opt_healStack Disconnect child statement and reconnect stack.\n   *     Defaults to false.\n   */\n  unplug(opt_healStack?: boolean) {\n    if (this.outputConnection) {\n      this.unplugFromRow_(opt_healStack);\n    }\n    if (this.previousConnection) {\n      this.unplugFromStack_(opt_healStack);\n    }\n  }\n\n  /**\n   * Unplug this block's output from an input on another block.  Optionally\n   * reconnect the block's parent to the only child block, if possible.\n   *\n   * @param opt_healStack Disconnect right-side block and connect to left-side\n   *     block.  Defaults to false.\n   */\n  private unplugFromRow_(opt_healStack?: boolean) {\n    let parentConnection = null;\n    if (this.outputConnection.isConnected()) {\n      parentConnection = this.outputConnection.targetConnection;\n      // Disconnect from any superior block.\n      this.outputConnection.disconnect();\n    }\n\n    // Return early in obvious cases.\n    if (!parentConnection || !opt_healStack) {\n      return;\n    }\n\n    const thisConnection = this.getOnlyValueConnection_();\n    if (!thisConnection || !thisConnection.isConnected() ||\n        thisConnection.targetBlock()!.isShadow()) {\n      // Too many or too few possible connections on this block, or there's\n      // nothing on the other side of this connection.\n      return;\n    }\n\n    const childConnection = thisConnection.targetConnection;\n    // Disconnect the child block.\n    childConnection?.disconnect();\n    // Connect child to the parent if possible, otherwise bump away.\n    if (this.workspace.connectionChecker.canConnect(\n            childConnection, parentConnection, false)) {\n      parentConnection.connect(childConnection!);\n    } else {\n      childConnection?.onFailedConnect(parentConnection);\n    }\n  }\n\n  /**\n   * Returns the connection on the value input that is connected to another\n   * block. When an insertion marker is connected to a connection with a block\n   * already attached, the connected block is attached to the insertion marker.\n   * Since only one block can be displaced and attached to the insertion marker\n   * this should only ever return one connection.\n   *\n   * @returns The connection on the value input, or null.\n   */\n  private getOnlyValueConnection_(): Connection|null {\n    let connection = null;\n    for (let i = 0; i < this.inputList.length; i++) {\n      const thisConnection = this.inputList[i].connection;\n      if (thisConnection &&\n          thisConnection.type === ConnectionType.INPUT_VALUE &&\n          thisConnection.targetConnection) {\n        if (connection) {\n          return null;  // More than one value input found.\n        }\n        connection = thisConnection;\n      }\n    }\n    return connection;\n  }\n\n  /**\n   * Unplug this statement block from its superior block.  Optionally reconnect\n   * the block underneath with the block on top.\n   *\n   * @param opt_healStack Disconnect child statement and reconnect stack.\n   *     Defaults to false.\n   */\n  private unplugFromStack_(opt_healStack?: boolean) {\n    let previousTarget = null;\n    if (this.previousConnection.isConnected()) {\n      // Remember the connection that any next statements need to connect to.\n      previousTarget = this.previousConnection.targetConnection;\n      // Detach this block from the parent's tree.\n      this.previousConnection.disconnect();\n    }\n    const nextBlock = this.getNextBlock();\n    if (opt_healStack && nextBlock && !nextBlock.isShadow()) {\n      // Disconnect the next statement.\n      const nextTarget = this.nextConnection.targetConnection;\n      nextTarget?.disconnect();\n      if (previousTarget &&\n          this.workspace.connectionChecker.canConnect(\n              previousTarget, nextTarget, false)) {\n        // Attach the next statement to the previous statement.\n        previousTarget.connect(nextTarget!);\n      }\n    }\n  }\n\n  /**\n   * Returns all connections originating from this block.\n   *\n   * @param _all If true, return all connections even hidden ones.\n   * @returns Array of connections.\n   * @internal\n   */\n  getConnections_(_all: boolean): Connection[] {\n    const myConnections = [];\n    if (this.outputConnection) {\n      myConnections.push(this.outputConnection);\n    }\n    if (this.previousConnection) {\n      myConnections.push(this.previousConnection);\n    }\n    if (this.nextConnection) {\n      myConnections.push(this.nextConnection);\n    }\n    for (let i = 0, input; input = this.inputList[i]; i++) {\n      if (input.connection) {\n        myConnections.push(input.connection);\n      }\n    }\n    return myConnections;\n  }\n\n  /**\n   * Walks down a stack of blocks and finds the last next connection on the\n   * stack.\n   *\n   * @param ignoreShadows If true,the last connection on a non-shadow block will\n   *     be returned. If false, this will follow shadows to find the last\n   *     connection.\n   * @returns The last next connection on the stack, or null.\n   * @internal\n   */\n  lastConnectionInStack(ignoreShadows: boolean): Connection|null {\n    let nextConnection = this.nextConnection;\n    while (nextConnection) {\n      const nextBlock = nextConnection.targetBlock();\n      if (!nextBlock || ignoreShadows && nextBlock.isShadow()) {\n        return nextConnection;\n      }\n      nextConnection = nextBlock.nextConnection;\n    }\n    return null;\n  }\n\n  /**\n   * Bump unconnected blocks out of alignment.  Two blocks which aren't actually\n   * connected should not coincidentally line up on screen.\n   */\n  bumpNeighbours() {}\n  // noop.\n\n  /**\n   * Return the parent block or null if this block is at the top level. The\n   * parent block is either the block connected to the previous connection (for\n   * a statement block) or the block connected to the output connection (for a\n   * value block).\n   *\n   * @returns The block (if any) that holds the current block.\n   */\n  getParent(): this|null {\n    return this.parentBlock_;\n  }\n\n  /**\n   * Return the input that connects to the specified block.\n   *\n   * @param block A block connected to an input on this block.\n   * @returns The input (if any) that connects to the specified block.\n   */\n  getInputWithBlock(block: Block): Input|null {\n    for (let i = 0, input; input = this.inputList[i]; i++) {\n      if (input.connection && input.connection.targetBlock() === block) {\n        return input;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Return the parent block that surrounds the current block, or null if this\n   * block has no surrounding block.  A parent block might just be the previous\n   * statement, whereas the surrounding block is an if statement, while loop,\n   * etc.\n   *\n   * @returns The block (if any) that surrounds the current block.\n   */\n  getSurroundParent(): this|null {\n    /* eslint-disable-next-line @typescript-eslint/no-this-alias */\n    let block: this|null = this;\n    let prevBlock;\n    do {\n      prevBlock = block;\n      block = block.getParent();\n      if (!block) {\n        // Ran off the top.\n        return null;\n      }\n    } while (block.getNextBlock() === prevBlock);\n    // This block is an enclosing parent, not just a statement in a stack.\n    return block;\n  }\n\n  /**\n   * Return the next statement block directly connected to this block.\n   *\n   * @returns The next statement block or null.\n   */\n  getNextBlock(): Block|null {\n    return this.nextConnection && this.nextConnection.targetBlock();\n  }\n\n  /**\n   * Returns the block connected to the previous connection.\n   *\n   * @returns The previous statement block or null.\n   */\n  getPreviousBlock(): Block|null {\n    return this.previousConnection && this.previousConnection.targetBlock();\n  }\n\n  /**\n   * Return the connection on the first statement input on this block, or null\n   * if there are none.\n   *\n   * @returns The first statement connection or null.\n   * @internal\n   */\n  getFirstStatementConnection(): Connection|null {\n    for (let i = 0, input; input = this.inputList[i]; i++) {\n      if (input.connection &&\n          input.connection.type === ConnectionType.NEXT_STATEMENT) {\n        return input.connection;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Return the top-most block in this block's tree.\n   * This will return itself if this block is at the top level.\n   *\n   * @returns The root block.\n   */\n  getRootBlock(): this {\n    let rootBlock: this;\n    /* eslint-disable-next-line @typescript-eslint/no-this-alias */\n    let block: this|null = this;\n    do {\n      rootBlock = block;\n      block = rootBlock.parentBlock_;\n    } while (block);\n    return rootBlock;\n  }\n\n  /**\n   * Walk up from the given block up through the stack of blocks to find\n   * the top block of the sub stack. If we are nested in a statement input only\n   * find the top-most nested block. Do not go all the way to the root block.\n   *\n   * @returns The top block in a stack.\n   * @internal\n   */\n  getTopStackBlock(): this {\n    /* eslint-disable-next-line @typescript-eslint/no-this-alias */\n    let block = this;\n    let previous;\n    do {\n      previous = block.getPreviousBlock();\n      // AnyDuringMigration because:  Type 'Block' is not assignable to type\n      // 'this'.\n    } while (previous && previous.getNextBlock() === block &&\n             (block = previous as AnyDuringMigration));\n    return block;\n  }\n\n  /**\n   * Find all the blocks that are directly nested inside this one.\n   * Includes value and statement inputs, as well as any following statement.\n   * Excludes any connection on an output tab or any preceding statement.\n   * Blocks are optionally sorted by position; top to bottom.\n   *\n   * @param ordered Sort the list if true.\n   * @returns Array of blocks.\n   */\n  getChildren(ordered: boolean): Block[] {\n    if (!ordered) {\n      return this.childBlocks_;\n    }\n    const blocks = [];\n    for (let i = 0, input; input = this.inputList[i]; i++) {\n      if (input.connection) {\n        const child = input.connection.targetBlock();\n        if (child) {\n          blocks.push(child);\n        }\n      }\n    }\n    const next = this.getNextBlock();\n    if (next) {\n      blocks.push(next);\n    }\n    return blocks;\n  }\n\n  /**\n   * Set parent of this block to be a new block or null.\n   *\n   * @param newParent New parent block.\n   * @internal\n   */\n  setParent(newParent: this|null) {\n    if (newParent === this.parentBlock_) {\n      return;\n    }\n\n    // Check that block is connected to new parent if new parent is not null and\n    //    that block is not connected to superior one if new parent is null.\n    const targetBlock =\n        this.previousConnection && this.previousConnection.targetBlock() ||\n        this.outputConnection && this.outputConnection.targetBlock();\n    const isConnected = !!targetBlock;\n\n    if (isConnected && newParent && targetBlock !== newParent) {\n      throw Error('Block connected to superior one that is not new parent.');\n    } else if (!isConnected && newParent) {\n      throw Error('Block not connected to new parent.');\n    } else if (isConnected && !newParent) {\n      throw Error(\n          'Cannot set parent to null while block is still connected to' +\n          ' superior block.');\n    }\n\n    // This block hasn't actually moved on-screen, so there's no need to\n    // update\n    //     its connection locations.\n    if (this.parentBlock_) {\n      // Remove this block from the old parent's child list.\n      arrayUtils.removeElem(this.parentBlock_.childBlocks_, this);\n    } else {\n      // New parent must be non-null so remove this block from the workspace's\n      //     list of top-most blocks.\n      this.workspace.removeTopBlock(this);\n    }\n\n    this.parentBlock_ = newParent;\n    if (newParent) {\n      // Add this block to the new parent's child list.\n      newParent.childBlocks_.push(this);\n    } else {\n      this.workspace.addTopBlock(this);\n    }\n  }\n\n  /**\n   * Find all the blocks that are directly or indirectly nested inside this one.\n   * Includes this block in the list.\n   * Includes value and statement inputs, as well as any following statements.\n   * Excludes any connection on an output tab or any preceding statements.\n   * Blocks are optionally sorted by position; top to bottom.\n   *\n   * @param ordered Sort the list if true.\n   * @returns Flattened array of blocks.\n   */\n  getDescendants(ordered: boolean): this[] {\n    const blocks = [this];\n    const childBlocks = this.getChildren(ordered);\n    for (let child, i = 0; child = childBlocks[i]; i++) {\n      // AnyDuringMigration because:  Argument of type 'Block[]' is not\n      // assignable to parameter of type 'this[]'.\n      blocks.push(...child.getDescendants(ordered) as AnyDuringMigration);\n    }\n    return blocks;\n  }\n\n  /**\n   * Get whether this block is deletable or not.\n   *\n   * @returns True if deletable.\n   */\n  isDeletable(): boolean {\n    return this.deletable_ && !this.isShadow_ && !this.isDeadOrDying() &&\n        !this.workspace.options.readOnly;\n  }\n\n  /**\n   * Set whether this block is deletable or not.\n   *\n   * @param deletable True if deletable.\n   */\n  setDeletable(deletable: boolean) {\n    this.deletable_ = deletable;\n  }\n\n  /**\n   * Get whether this block is movable or not.\n   *\n   * @returns True if movable.\n   */\n  isMovable(): boolean {\n    return this.movable_ && !this.isShadow_ && !this.isDeadOrDying() &&\n        !this.workspace.options.readOnly;\n  }\n\n  /**\n   * Set whether this block is movable or not.\n   *\n   * @param movable True if movable.\n   */\n  setMovable(movable: boolean) {\n    this.movable_ = movable;\n  }\n\n  /**\n   * Get whether is block is duplicatable or not. If duplicating this block and\n   * descendants will put this block over the workspace's capacity this block is\n   * not duplicatable. If duplicating this block and descendants will put any\n   * type over their maxInstances this block is not duplicatable.\n   *\n   * @returns True if duplicatable.\n   */\n  isDuplicatable(): boolean {\n    if (!this.workspace.hasBlockLimits()) {\n      return true;\n    }\n    return this.workspace.isCapacityAvailable(\n        common.getBlockTypeCounts(this, true));\n  }\n\n  /**\n   * Get whether this block is a shadow block or not.\n   *\n   * @returns True if a shadow.\n   */\n  isShadow(): boolean {\n    return this.isShadow_;\n  }\n\n  /**\n   * Set whether this block is a shadow block or not.\n   *\n   * @param shadow True if a shadow.\n   * @internal\n   */\n  setShadow(shadow: boolean) {\n    this.isShadow_ = shadow;\n  }\n\n  /**\n   * Get whether this block is an insertion marker block or not.\n   *\n   * @returns True if an insertion marker.\n   */\n  isInsertionMarker(): boolean {\n    return this.isInsertionMarker_;\n  }\n\n  /**\n   * Set whether this block is an insertion marker block or not.\n   * Once set this cannot be unset.\n   *\n   * @param insertionMarker True if an insertion marker.\n   * @internal\n   */\n  setInsertionMarker(insertionMarker: boolean) {\n    this.isInsertionMarker_ = insertionMarker;\n  }\n\n  /**\n   * Get whether this block is editable or not.\n   *\n   * @returns True if editable.\n   */\n  isEditable(): boolean {\n    return this.editable_ && !this.isDeadOrDying() &&\n        !this.workspace.options.readOnly;\n  }\n\n  /**\n   * Set whether this block is editable or not.\n   *\n   * @param editable True if editable.\n   */\n  setEditable(editable: boolean) {\n    this.editable_ = editable;\n    for (let i = 0, input; input = this.inputList[i]; i++) {\n      for (let j = 0, field; field = input.fieldRow[j]; j++) {\n        field.updateEditable();\n      }\n    }\n  }\n\n  /**\n   * Returns if this block has been disposed of / deleted.\n   *\n   * @returns True if this block has been disposed of / deleted.\n   */\n  isDisposed(): boolean {\n    return this.disposed;\n  }\n\n  /**\n   * Find the connection on this block that corresponds to the given connection\n   * on the other block.\n   * Used to match connections between a block and its insertion marker.\n   *\n   * @param otherBlock The other block to match against.\n   * @param conn The other connection to match.\n   * @returns The matching connection on this block, or null.\n   * @internal\n   */\n  getMatchingConnection(otherBlock: Block, conn: Connection): Connection|null {\n    const connections = this.getConnections_(true);\n    const otherConnections = otherBlock.getConnections_(true);\n    if (connections.length !== otherConnections.length) {\n      throw Error('Connection lists did not match in length.');\n    }\n    for (let i = 0; i < otherConnections.length; i++) {\n      if (otherConnections[i] === conn) {\n        return connections[i];\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Set the URL of this block's help page.\n   *\n   * @param url URL string for block help, or function that returns a URL.  Null\n   *     for no help.\n   */\n  setHelpUrl(url: string|Function) {\n    this.helpUrl = url;\n  }\n\n  /**\n   * Sets the tooltip for this block.\n   *\n   * @param newTip The text for the tooltip, a function that returns the text\n   *     for the tooltip, or a parent object whose tooltip will be used. To not\n   *     display a tooltip pass the empty string.\n   */\n  setTooltip(newTip: Tooltip.TipInfo) {\n    this.tooltip = newTip;\n  }\n\n  /**\n   * Returns the tooltip text for this block.\n   *\n   * @returns The tooltip text for this block.\n   */\n  getTooltip(): string {\n    return Tooltip.getTooltipOfObject(this);\n  }\n\n  /**\n   * Get the colour of a block.\n   *\n   * @returns #RRGGBB string.\n   */\n  getColour(): string {\n    return this.colour_;\n  }\n\n  /**\n   * Get the name of the block style.\n   *\n   * @returns Name of the block style.\n   */\n  getStyleName(): string {\n    return this.styleName_;\n  }\n\n  /**\n   * Get the HSV hue value of a block.  Null if hue not set.\n   *\n   * @returns Hue value (0-360).\n   */\n  getHue(): number|null {\n    return this.hue_;\n  }\n\n  /**\n   * Change the colour of a block.\n   *\n   * @param colour HSV hue value (0 to 360), #RRGGBB string, or a message\n   *     reference string pointing to one of those two values.\n   */\n  setColour(colour: number|string) {\n    const parsed = parsing.parseBlockColour(colour);\n    this.hue_ = parsed.hue;\n    this.colour_ = parsed.hex;\n  }\n\n  /**\n   * Set the style and colour values of a block.\n   *\n   * @param blockStyleName Name of the block style.\n   */\n  setStyle(blockStyleName: string) {\n    this.styleName_ = blockStyleName;\n  }\n\n  /**\n   * Sets a callback function to use whenever the block's parent workspace\n   * changes, replacing any prior onchange handler. This is usually only called\n   * from the constructor, the block type initializer function, or an extension\n   * initializer function.\n   *\n   * @param onchangeFn The callback to call when the block's workspace changes.\n   * @throws {Error} if onchangeFn is not falsey and not a function.\n   */\n  setOnChange(onchangeFn: (p1: Abstract) => AnyDuringMigration) {\n    if (onchangeFn && typeof onchangeFn !== 'function') {\n      throw Error('onchange must be a function.');\n    }\n    if (this.onchangeWrapper_) {\n      this.workspace.removeChangeListener(this.onchangeWrapper_);\n    }\n    this.onchange = onchangeFn;\n    this.onchangeWrapper_ = onchangeFn.bind(this);\n    this.workspace.addChangeListener(this.onchangeWrapper_);\n  }\n\n  /**\n   * Returns the named field from a block.\n   *\n   * @param name The name of the field.\n   * @returns Named field, or null if field does not exist.\n   */\n  getField(name: string): Field|null {\n    if (typeof name !== 'string') {\n      throw TypeError(\n          'Block.prototype.getField expects a string ' +\n          'with the field name but received ' +\n          (name === undefined ? 'nothing' : name + ' of type ' + typeof name) +\n          ' instead');\n    }\n    for (let i = 0, input; input = this.inputList[i]; i++) {\n      for (let j = 0, field; field = input.fieldRow[j]; j++) {\n        if (field.name === name) {\n          return field;\n        }\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Return all variables referenced by this block.\n   *\n   * @returns List of variable ids.\n   */\n  getVars(): string[] {\n    const vars = [];\n    for (let i = 0, input; input = this.inputList[i]; i++) {\n      for (let j = 0, field; field = input.fieldRow[j]; j++) {\n        if (field.referencesVariables()) {\n          vars.push(field.getValue());\n        }\n      }\n    }\n    return vars;\n  }\n\n  /**\n   * Return all variables referenced by this block.\n   *\n   * @returns List of variable models.\n   * @internal\n   */\n  getVarModels(): VariableModel[] {\n    const vars = [];\n    for (let i = 0, input; input = this.inputList[i]; i++) {\n      for (let j = 0, field; field = input.fieldRow[j]; j++) {\n        if (field.referencesVariables()) {\n          const model =\n              this.workspace.getVariableById(field.getValue() as string);\n          // Check if the variable actually exists (and isn't just a potential\n          // variable).\n          if (model) {\n            vars.push(model);\n          }\n        }\n      }\n    }\n    return vars;\n  }\n\n  /**\n   * Notification that a variable is renaming but keeping the same ID.  If the\n   * variable is in use on this block, rerender to show the new name.\n   *\n   * @param variable The variable being renamed.\n   * @internal\n   */\n  updateVarName(variable: VariableModel) {\n    for (let i = 0, input; input = this.inputList[i]; i++) {\n      for (let j = 0, field; field = input.fieldRow[j]; j++) {\n        if (field.referencesVariables() &&\n            variable.getId() === field.getValue()) {\n          field.refreshVariableName();\n        }\n      }\n    }\n  }\n\n  /**\n   * Notification that a variable is renaming.\n   * If the ID matches one of this block's variables, rename it.\n   *\n   * @param oldId ID of variable to rename.\n   * @param newId ID of new variable.  May be the same as oldId, but with an\n   *     updated name.\n   */\n  renameVarById(oldId: string, newId: string) {\n    for (let i = 0, input; input = this.inputList[i]; i++) {\n      for (let j = 0, field; field = input.fieldRow[j]; j++) {\n        if (field.referencesVariables() && oldId === field.getValue()) {\n          field.setValue(newId);\n        }\n      }\n    }\n  }\n\n  /**\n   * Returns the language-neutral value of the given field.\n   *\n   * @param name The name of the field.\n   * @returns Value of the field or null if field does not exist.\n   */\n  getFieldValue(name: string): AnyDuringMigration {\n    const field = this.getField(name);\n    if (field) {\n      return field.getValue();\n    }\n    return null;\n  }\n\n  /**\n   * Sets the value of the given field for this block.\n   *\n   * @param newValue The value to set.\n   * @param name The name of the field to set the value of.\n   */\n  setFieldValue(newValue: AnyDuringMigration, name: string) {\n    const field = this.getField(name);\n    if (!field) {\n      throw Error('Field \"' + name + '\" not found.');\n    }\n    field.setValue(newValue);\n  }\n\n  /**\n   * Set whether this block can chain onto the bottom of another block.\n   *\n   * @param newBoolean True if there can be a previous statement.\n   * @param opt_check Statement type or list of statement types.  Null/undefined\n   *     if any type could be connected.\n   */\n  setPreviousStatement(newBoolean: boolean, opt_check?: string|string[]|null) {\n    if (newBoolean) {\n      if (opt_check === undefined) {\n        opt_check = null;\n      }\n      if (!this.previousConnection) {\n        this.previousConnection =\n            this.makeConnection_(ConnectionType.PREVIOUS_STATEMENT);\n      }\n      this.previousConnection.setCheck(opt_check);\n    } else {\n      if (this.previousConnection) {\n        if (this.previousConnection.isConnected()) {\n          throw Error(\n              'Must disconnect previous statement before removing ' +\n              'connection.');\n        }\n        this.previousConnection.dispose();\n        // AnyDuringMigration because:  Type 'null' is not assignable to type\n        // 'Connection'.\n        this.previousConnection = null as AnyDuringMigration;\n      }\n    }\n  }\n\n  /**\n   * Set whether another block can chain onto the bottom of this block.\n   *\n   * @param newBoolean True if there can be a next statement.\n   * @param opt_check Statement type or list of statement types.  Null/undefined\n   *     if any type could be connected.\n   */\n  setNextStatement(newBoolean: boolean, opt_check?: string|string[]|null) {\n    if (newBoolean) {\n      if (opt_check === undefined) {\n        opt_check = null;\n      }\n      if (!this.nextConnection) {\n        this.nextConnection =\n            this.makeConnection_(ConnectionType.NEXT_STATEMENT);\n      }\n      this.nextConnection.setCheck(opt_check);\n    } else {\n      if (this.nextConnection) {\n        if (this.nextConnection.isConnected()) {\n          throw Error(\n              'Must disconnect next statement before removing ' +\n              'connection.');\n        }\n        this.nextConnection.dispose();\n        // AnyDuringMigration because:  Type 'null' is not assignable to type\n        // 'Connection'.\n        this.nextConnection = null as AnyDuringMigration;\n      }\n    }\n  }\n\n  /**\n   * Set whether this block returns a value.\n   *\n   * @param newBoolean True if there is an output.\n   * @param opt_check Returned type or list of returned types.  Null or\n   *     undefined if any type could be returned (e.g. variable get).\n   */\n  setOutput(newBoolean: boolean, opt_check?: string|string[]|null) {\n    if (newBoolean) {\n      if (opt_check === undefined) {\n        opt_check = null;\n      }\n      if (!this.outputConnection) {\n        this.outputConnection =\n            this.makeConnection_(ConnectionType.OUTPUT_VALUE);\n      }\n      this.outputConnection.setCheck(opt_check);\n    } else {\n      if (this.outputConnection) {\n        if (this.outputConnection.isConnected()) {\n          throw Error(\n              'Must disconnect output value before removing connection.');\n        }\n        this.outputConnection.dispose();\n        // AnyDuringMigration because:  Type 'null' is not assignable to type\n        // 'Connection'.\n        this.outputConnection = null as AnyDuringMigration;\n      }\n    }\n  }\n\n  /**\n   * Set whether value inputs are arranged horizontally or vertically.\n   *\n   * @param newBoolean True if inputs are horizontal.\n   */\n  setInputsInline(newBoolean: boolean) {\n    if (this.inputsInline !== newBoolean) {\n      eventUtils.fire(new (eventUtils.get(eventUtils.BLOCK_CHANGE))(\n          this, 'inline', null, this.inputsInline, newBoolean));\n      this.inputsInline = newBoolean;\n    }\n  }\n\n  /**\n   * Get whether value inputs are arranged horizontally or vertically.\n   *\n   * @returns True if inputs are horizontal.\n   */\n  getInputsInline(): boolean {\n    if (this.inputsInline !== undefined) {\n      // Set explicitly.\n      return this.inputsInline;\n    }\n    // Not defined explicitly.  Figure out what would look best.\n    for (let i = 1; i < this.inputList.length; i++) {\n      if (this.inputList[i - 1].type === inputTypes.DUMMY &&\n          this.inputList[i].type === inputTypes.DUMMY) {\n        // Two dummy inputs in a row.  Don't inline them.\n        return false;\n      }\n    }\n    for (let i = 1; i < this.inputList.length; i++) {\n      if (this.inputList[i - 1].type === inputTypes.VALUE &&\n          this.inputList[i].type === inputTypes.DUMMY) {\n        // Dummy input after a value input.  Inline them.\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Set the block's output shape.\n   *\n   * @param outputShape Value representing an output shape.\n   */\n  setOutputShape(outputShape: number|null) {\n    this.outputShape_ = outputShape;\n  }\n\n  /**\n   * Get the block's output shape.\n   *\n   * @returns Value representing output shape if one exists.\n   */\n  getOutputShape(): number|null {\n    return this.outputShape_;\n  }\n\n  /**\n   * Get whether this block is enabled or not.\n   *\n   * @returns True if enabled.\n   */\n  isEnabled(): boolean {\n    return !this.disabled;\n  }\n\n  /**\n   * Set whether the block is enabled or not.\n   *\n   * @param enabled True if enabled.\n   */\n  setEnabled(enabled: boolean) {\n    if (this.isEnabled() !== enabled) {\n      const oldValue = this.disabled;\n      this.disabled = !enabled;\n      eventUtils.fire(new (eventUtils.get(eventUtils.BLOCK_CHANGE))(\n          this, 'disabled', null, oldValue, !enabled));\n    }\n  }\n\n  /**\n   * Get whether the block is disabled or not due to parents.\n   * The block's own disabled property is not considered.\n   *\n   * @returns True if disabled.\n   */\n  getInheritedDisabled(): boolean {\n    let ancestor = this.getSurroundParent();\n    while (ancestor) {\n      if (ancestor.disabled) {\n        return true;\n      }\n      ancestor = ancestor.getSurroundParent();\n    }\n    // Ran off the top.\n    return false;\n  }\n\n  /**\n   * Get whether the block is collapsed or not.\n   *\n   * @returns True if collapsed.\n   */\n  isCollapsed(): boolean {\n    return this.collapsed_;\n  }\n\n  /**\n   * Set whether the block is collapsed or not.\n   *\n   * @param collapsed True if collapsed.\n   */\n  setCollapsed(collapsed: boolean) {\n    if (this.collapsed_ !== collapsed) {\n      eventUtils.fire(new (eventUtils.get(eventUtils.BLOCK_CHANGE))(\n          this, 'collapsed', null, this.collapsed_, collapsed));\n      this.collapsed_ = collapsed;\n    }\n  }\n\n  /**\n   * Create a human-readable text representation of this block and any children.\n   *\n   * @param opt_maxLength Truncate the string to this length.\n   * @param opt_emptyToken The placeholder string used to denote an empty field.\n   *     If not specified, '?' is used.\n   * @returns Text of block.\n   */\n  toString(opt_maxLength?: number, opt_emptyToken?: string): string {\n    const tokens = [];\n    const emptyFieldPlaceholder = opt_emptyToken || '?';\n\n    // Temporarily set flag to navigate to all fields.\n    const prevNavigateFields = ASTNode.NAVIGATE_ALL_FIELDS;\n    ASTNode.NAVIGATE_ALL_FIELDS = true;\n\n    let node = ASTNode.createBlockNode(this);\n    const rootNode = node;\n\n    /**\n     * Whether or not to add parentheses around an input.\n     *\n     * @param connection The connection.\n     * @returns True if we should add parentheses around the input.\n     */\n    function shouldAddParentheses(connection: Connection): boolean {\n      let checks = connection.getCheck();\n      if (!checks && connection.targetConnection) {\n        checks = connection.targetConnection.getCheck();\n      }\n      return !!checks &&\n          (checks.indexOf('Boolean') !== -1 || checks.indexOf('Number') !== -1);\n    }\n\n    /** Check that we haven't circled back to the original root node. */\n    function checkRoot() {\n      if (node && node.getType() === rootNode?.getType() &&\n          node.getLocation() === rootNode?.getLocation()) {\n        node = null;\n      }\n    }\n\n    // Traverse the AST building up our text string.\n    while (node) {\n      switch (node.getType()) {\n        case ASTNode.types.INPUT: {\n          const connection = node.getLocation() as Connection;\n          if (!node.in()) {\n            tokens.push(emptyFieldPlaceholder);\n          } else if (shouldAddParentheses(connection)) {\n            tokens.push('(');\n          }\n          break;\n        }\n        case ASTNode.types.FIELD: {\n          const field = node.getLocation() as Field;\n          if (field.name !== constants.COLLAPSED_FIELD_NAME) {\n            tokens.push(field.getText());\n          }\n          break;\n        }\n      }\n\n      const current = node;\n      node = current.in() || current.next();\n      if (!node) {\n        // Can't go in or next, keep going out until we can go next.\n        node = current.out();\n        checkRoot();\n        while (node && !node.next()) {\n          node = node.out();\n          checkRoot();\n          // If we hit an input on the way up, possibly close out parentheses.\n          if (node && node.getType() === ASTNode.types.INPUT &&\n              shouldAddParentheses(node.getLocation() as Connection)) {\n            tokens.push(')');\n          }\n        }\n        if (node) {\n          node = node.next();\n        }\n      }\n    }\n\n    // Restore state of NAVIGATE_ALL_FIELDS.\n    ASTNode.NAVIGATE_ALL_FIELDS = prevNavigateFields;\n\n    // Run through our text array and simplify expression to remove parentheses\n    // around single field blocks.\n    // E.g. ['repeat', '(', '10', ')', 'times', 'do', '?']\n    for (let i = 2; i < tokens.length; i++) {\n      if (tokens[i - 2] === '(' && tokens[i] === ')') {\n        tokens[i - 2] = tokens[i - 1];\n        tokens.splice(i - 1, 2);\n      }\n    }\n\n    // Join the text array, removing spaces around added parentheses.\n    let text: string = tokens.reduce(function(acc, value) {\n      return acc + (acc.substr(-1) === '(' || value === ')' ? '' : ' ') + value;\n    }, '');\n\n    text = text.trim() || '???';\n    if (opt_maxLength) {\n      // TODO: Improve truncation so that text from this block is given\n      // priority. E.g. \"1+2+3+4+5+6+7+8+9=0\" should be \"...6+7+8+9=0\", not\n      // \"1+2+3+4+5...\". E.g. \"1+2+3+4+5=6+7+8+9+0\" should be \"...4+5=6+7...\".\n      if (text.length > opt_maxLength) {\n        text = text.substring(0, opt_maxLength - 3) + '...';\n      }\n    }\n    return text;\n  }\n\n  /**\n   * Shortcut for appending a value input row.\n   *\n   * @param name Language-neutral identifier which may used to find this input\n   *     again.  Should be unique to this block.\n   * @returns The input object created.\n   */\n  appendValueInput(name: string): Input {\n    return this.appendInput_(inputTypes.VALUE, name);\n  }\n\n  /**\n   * Shortcut for appending a statement input row.\n   *\n   * @param name Language-neutral identifier which may used to find this input\n   *     again.  Should be unique to this block.\n   * @returns The input object created.\n   */\n  appendStatementInput(name: string): Input {\n    return this.appendInput_(inputTypes.STATEMENT, name);\n  }\n\n  /**\n   * Shortcut for appending a dummy input row.\n   *\n   * @param opt_name Language-neutral identifier which may used to find this\n   *     input again.  Should be unique to this block.\n   * @returns The input object created.\n   */\n  appendDummyInput(opt_name?: string): Input {\n    return this.appendInput_(inputTypes.DUMMY, opt_name || '');\n  }\n\n  /**\n   * Initialize this block using a cross-platform, internationalization-friendly\n   * JSON description.\n   *\n   * @param json Structured data describing the block.\n   */\n  jsonInit(json: AnyDuringMigration) {\n    const warningPrefix = json['type'] ? 'Block \"' + json['type'] + '\": ' : '';\n\n    // Validate inputs.\n    if (json['output'] && json['previousStatement']) {\n      throw Error(\n          warningPrefix +\n          'Must not have both an output and a previousStatement.');\n    }\n\n    // Set basic properties of block.\n    // Makes styles backward compatible with old way of defining hat style.\n    if (json['style'] && json['style'].hat) {\n      this.hat = json['style'].hat;\n      // Must set to null so it doesn't error when checking for style and\n      // colour.\n      json['style'] = null;\n    }\n\n    if (json['style'] && json['colour']) {\n      throw Error(warningPrefix + 'Must not have both a colour and a style.');\n    } else if (json['style']) {\n      this.jsonInitStyle_(json, warningPrefix);\n    } else {\n      this.jsonInitColour_(json, warningPrefix);\n    }\n\n    // Interpolate the message blocks.\n    let i = 0;\n    while (json['message' + i] !== undefined) {\n      this.interpolate_(\n          json['message' + i], json['args' + i] || [],\n          json['lastDummyAlign' + i], warningPrefix);\n      i++;\n    }\n\n    if (json['inputsInline'] !== undefined) {\n      this.setInputsInline(json['inputsInline']);\n    }\n    // Set output and previous/next connections.\n    if (json['output'] !== undefined) {\n      this.setOutput(true, json['output']);\n    }\n    if (json['outputShape'] !== undefined) {\n      this.setOutputShape(json['outputShape']);\n    }\n    if (json['previousStatement'] !== undefined) {\n      this.setPreviousStatement(true, json['previousStatement']);\n    }\n    if (json['nextStatement'] !== undefined) {\n      this.setNextStatement(true, json['nextStatement']);\n    }\n    if (json['tooltip'] !== undefined) {\n      const rawValue = json['tooltip'];\n      const localizedText = parsing.replaceMessageReferences(rawValue);\n      this.setTooltip(localizedText);\n    }\n    if (json['enableContextMenu'] !== undefined) {\n      this.contextMenu = !!json['enableContextMenu'];\n    }\n    if (json['suppressPrefixSuffix'] !== undefined) {\n      this.suppressPrefixSuffix = !!json['suppressPrefixSuffix'];\n    }\n    if (json['helpUrl'] !== undefined) {\n      const rawValue = json['helpUrl'];\n      const localizedValue = parsing.replaceMessageReferences(rawValue);\n      this.setHelpUrl(localizedValue);\n    }\n    if (typeof json['extensions'] === 'string') {\n      console.warn(\n          warningPrefix +\n          'JSON attribute \\'extensions\\' should be an array of' +\n          ' strings. Found raw string in JSON for \\'' + json['type'] +\n          '\\' block.');\n      json['extensions'] = [json['extensions']];  // Correct and continue.\n    }\n\n    // Add the mutator to the block.\n    if (json['mutator'] !== undefined) {\n      Extensions.apply(json['mutator'], this, true);\n    }\n\n    const extensionNames = json['extensions'];\n    if (Array.isArray(extensionNames)) {\n      for (let j = 0; j < extensionNames.length; j++) {\n        Extensions.apply(extensionNames[j], this, false);\n      }\n    }\n  }\n\n  /**\n   * Initialize the colour of this block from the JSON description.\n   *\n   * @param json Structured data describing the block.\n   * @param warningPrefix Warning prefix string identifying block.\n   */\n  private jsonInitColour_(json: AnyDuringMigration, warningPrefix: string) {\n    if ('colour' in json) {\n      if (json['colour'] === undefined) {\n        console.warn(warningPrefix + 'Undefined colour value.');\n      } else {\n        const rawValue = json['colour'];\n        try {\n          this.setColour(rawValue);\n        } catch (e) {\n          console.warn(warningPrefix + 'Illegal colour value: ', rawValue);\n        }\n      }\n    }\n  }\n\n  /**\n   * Initialize the style of this block from the JSON description.\n   *\n   * @param json Structured data describing the block.\n   * @param warningPrefix Warning prefix string identifying block.\n   */\n  private jsonInitStyle_(json: AnyDuringMigration, warningPrefix: string) {\n    const blockStyleName = json['style'];\n    try {\n      this.setStyle(blockStyleName);\n    } catch (styleError) {\n      console.warn(warningPrefix + 'Style does not exist: ', blockStyleName);\n    }\n  }\n\n  /**\n   * Add key/values from mixinObj to this block object. By default, this method\n   * will check that the keys in mixinObj will not overwrite existing values in\n   * the block, including prototype values. This provides some insurance against\n   * mixin / extension incompatibilities with future block features. This check\n   * can be disabled by passing true as the second argument.\n   *\n   * @param mixinObj The key/values pairs to add to this block object.\n   * @param opt_disableCheck Option flag to disable overwrite checks.\n   */\n  mixin(mixinObj: AnyDuringMigration, opt_disableCheck?: boolean) {\n    if (opt_disableCheck !== undefined &&\n        typeof opt_disableCheck !== 'boolean') {\n      throw Error('opt_disableCheck must be a boolean if provided');\n    }\n    if (!opt_disableCheck) {\n      const overwrites = [];\n      for (const key in mixinObj) {\n        if ((this as AnyDuringMigration)[key] !== undefined) {\n          overwrites.push(key);\n        }\n      }\n      if (overwrites.length) {\n        throw Error(\n            'Mixin will overwrite block members: ' +\n            JSON.stringify(overwrites));\n      }\n    }\n    Object.assign(this, mixinObj);\n  }\n\n  /**\n   * Interpolate a message description onto the block.\n   *\n   * @param message Text contains interpolation tokens (%1, %2, ...) that match\n   *     with fields or inputs defined in the args array.\n   * @param args Array of arguments to be interpolated.\n   * @param lastDummyAlign If a dummy input is added at the end, how should it\n   *     be aligned?\n   * @param warningPrefix Warning prefix string identifying block.\n   */\n  private interpolate_(\n      message: string, args: AnyDuringMigration[],\n      lastDummyAlign: string|undefined, warningPrefix: string) {\n    const tokens = parsing.tokenizeInterpolation(message);\n    this.validateTokens_(tokens, args.length);\n    const elements = this.interpolateArguments_(tokens, args, lastDummyAlign);\n\n    // An array of [field, fieldName] tuples.\n    const fieldStack = [];\n    for (let i = 0, element; element = elements[i]; i++) {\n      if (this.isInputKeyword_(element['type'])) {\n        const input = this.inputFromJson_(element, warningPrefix);\n        // Should never be null, but just in case.\n        if (input) {\n          for (let j = 0, tuple; tuple = fieldStack[j]; j++) {\n            input.appendField(tuple[0], tuple[1]);\n          }\n          fieldStack.length = 0;\n        }\n      } else {\n        // All other types, including ones starting with 'input_' get routed\n        // here.\n        const field = this.fieldFromJson_(element);\n        if (field) {\n          fieldStack.push([field, element['name']]);\n        }\n      }\n    }\n  }\n\n  /**\n   * Validates that the tokens are within the correct bounds, with no\n   * duplicates, and that all of the arguments are referred to. Throws errors if\n   * any of these things are not true.\n   *\n   * @param tokens An array of tokens to validate\n   * @param argsCount The number of args that need to be referred to.\n   */\n  private validateTokens_(tokens: Array<string|number>, argsCount: number) {\n    const visitedArgsHash = [];\n    let visitedArgsCount = 0;\n    for (let i = 0; i < tokens.length; i++) {\n      const token = tokens[i];\n      if (typeof token !== 'number') {\n        continue;\n      }\n      if (token < 1 || token > argsCount) {\n        throw Error(\n            'Block \"' + this.type + '\": ' +\n            'Message index %' + token + ' out of range.');\n      }\n      if (visitedArgsHash[token]) {\n        throw Error(\n            'Block \"' + this.type + '\": ' +\n            'Message index %' + token + ' duplicated.');\n      }\n      visitedArgsHash[token] = true;\n      visitedArgsCount++;\n    }\n    if (visitedArgsCount !== argsCount) {\n      throw Error(\n          'Block \"' + this.type + '\": ' +\n          'Message does not reference all ' + argsCount + ' arg(s).');\n    }\n  }\n\n  /**\n   * Inserts args in place of numerical tokens. String args are converted to\n   * JSON that defines a label field. If necessary an extra dummy input is added\n   * to the end of the elements.\n   *\n   * @param tokens The tokens to interpolate\n   * @param args The arguments to insert.\n   * @param lastDummyAlign The alignment the added dummy input should have, if\n   *     we are required to add one.\n   * @returns The JSON definitions of field and inputs to add to the block.\n   */\n  private interpolateArguments_(\n      tokens: Array<string|number>, args: Array<AnyDuringMigration|string>,\n      lastDummyAlign: string|undefined): AnyDuringMigration[] {\n    const elements = [];\n    for (let i = 0; i < tokens.length; i++) {\n      let element = tokens[i];\n      if (typeof element === 'number') {\n        element = args[element - 1];\n      }\n      // Args can be strings, which is why this isn't elseif.\n      if (typeof element === 'string') {\n        // AnyDuringMigration because:  Type '{ text: string; type: string; } |\n        // null' is not assignable to type 'string | number'.\n        element = this.stringToFieldJson_(element) as AnyDuringMigration;\n        if (!element) {\n          continue;\n        }\n      }\n      elements.push(element);\n    }\n\n    const length = elements.length;\n    if (length &&\n        !this.isInputKeyword_(\n            (elements as AnyDuringMigration)[length - 1]['type'])) {\n      const dummyInput = {'type': 'input_dummy'};\n      if (lastDummyAlign) {\n        (dummyInput as AnyDuringMigration)['align'] = lastDummyAlign;\n      }\n      elements.push(dummyInput);\n    }\n\n    return elements;\n  }\n\n  /**\n   * Creates a field from the JSON definition of a field. If a field with the\n   * given type cannot be found, this attempts to create a different field using\n   * the 'alt' property of the JSON definition (if it exists).\n   *\n   * @param element The element to try to turn into a field.\n   * @returns The field defined by the JSON, or null if one couldn't be created.\n   */\n  private fieldFromJson_(element: {alt?: string, type: string, text?: string}):\n      Field|null {\n    const field = fieldRegistry.fromJson(element);\n    if (!field && element['alt']) {\n      if (typeof element['alt'] === 'string') {\n        const json = this.stringToFieldJson_(element['alt']);\n        return json ? this.fieldFromJson_(json) : null;\n      }\n      return this.fieldFromJson_(element['alt']);\n    }\n    return field;\n  }\n\n  /**\n   * Creates an input from the JSON definition of an input. Sets the input's\n   * check and alignment if they are provided.\n   *\n   * @param element The JSON to turn into an input.\n   * @param warningPrefix The prefix to add to warnings to help the developer\n   *     debug.\n   * @returns The input that has been created, or null if one could not be\n   *     created for some reason (should never happen).\n   */\n  private inputFromJson_(element: AnyDuringMigration, warningPrefix: string):\n      Input|null {\n    const alignmentLookup = {\n      'LEFT': Align.LEFT,\n      'RIGHT': Align.RIGHT,\n      'CENTRE': Align.CENTRE,\n      'CENTER': Align.CENTRE,\n    };\n\n    let input = null;\n    switch (element['type']) {\n      case 'input_value':\n        input = this.appendValueInput(element['name']);\n        break;\n      case 'input_statement':\n        input = this.appendStatementInput(element['name']);\n        break;\n      case 'input_dummy':\n        input = this.appendDummyInput(element['name']);\n        break;\n    }\n    // Should never be hit because of interpolate_'s checks, but just in case.\n    if (!input) {\n      return null;\n    }\n\n    if (element['check']) {\n      input.setCheck(element['check']);\n    }\n    if (element['align']) {\n      const alignment =\n          (alignmentLookup as\n           AnyDuringMigration)[element['align'].toUpperCase()];\n      if (alignment === undefined) {\n        console.warn(warningPrefix + 'Illegal align value: ', element['align']);\n      } else {\n        input.setAlign(alignment);\n      }\n    }\n    return input;\n  }\n\n  /**\n   * Returns true if the given string matches one of the input keywords.\n   *\n   * @param str The string to check.\n   * @returns True if the given string matches one of the input keywords, false\n   *     otherwise.\n   */\n  private isInputKeyword_(str: string): boolean {\n    return str === 'input_value' || str === 'input_statement' ||\n        str === 'input_dummy';\n  }\n\n  /**\n   * Turns a string into the JSON definition of a label field. If the string\n   * becomes an empty string when trimmed, this returns null.\n   *\n   * @param str String to turn into the JSON definition of a label field.\n   * @returns The JSON definition or null.\n   */\n  private stringToFieldJson_(str: string): {text: string, type: string}|null {\n    str = str.trim();\n    if (str) {\n      return {\n        'type': 'field_label',\n        'text': str,\n      };\n    }\n    return null;\n  }\n\n  /**\n   * Add a value input, statement input or local variable to this block.\n   *\n   * @param type One of Blockly.inputTypes.\n   * @param name Language-neutral identifier which may used to find this input\n   *     again.  Should be unique to this block.\n   * @returns The input object created.\n   */\n  protected appendInput_(type: number, name: string): Input {\n    let connection = null;\n    if (type === inputTypes.VALUE || type === inputTypes.STATEMENT) {\n      connection = this.makeConnection_(type);\n    }\n    if (type === inputTypes.STATEMENT) {\n      this.statementInputCount++;\n    }\n    // AnyDuringMigration because:  Argument of type 'Connection | null' is not\n    // assignable to parameter of type 'Connection'.\n    const input =\n        new Input(type, name, this, (connection as AnyDuringMigration));\n    // Append input to list.\n    this.inputList.push(input);\n    return input;\n  }\n\n  /**\n   * Move a named input to a different location on this block.\n   *\n   * @param name The name of the input to move.\n   * @param refName Name of input that should be after the moved input, or null\n   *     to be the input at the end.\n   */\n  moveInputBefore(name: string, refName: string|null) {\n    if (name === refName) {\n      return;\n    }\n    // Find both inputs.\n    let inputIndex = -1;\n    let refIndex = refName ? -1 : this.inputList.length;\n    for (let i = 0, input; input = this.inputList[i]; i++) {\n      if (input.name === name) {\n        inputIndex = i;\n        if (refIndex !== -1) {\n          break;\n        }\n      } else if (refName && input.name === refName) {\n        refIndex = i;\n        if (inputIndex !== -1) {\n          break;\n        }\n      }\n    }\n    if (inputIndex === -1) {\n      throw Error('Named input \"' + name + '\" not found.');\n    }\n    if (refIndex === -1) {\n      throw Error('Reference input \"' + refName + '\" not found.');\n    }\n    this.moveNumberedInputBefore(inputIndex, refIndex);\n  }\n\n  /**\n   * Move a numbered input to a different location on this block.\n   *\n   * @param inputIndex Index of the input to move.\n   * @param refIndex Index of input that should be after the moved input.\n   */\n  moveNumberedInputBefore(inputIndex: number, refIndex: number) {\n    // Validate arguments.\n    if (inputIndex === refIndex) {\n      throw Error('Can\\'t move input to itself.');\n    }\n    if (inputIndex >= this.inputList.length) {\n      throw RangeError('Input index ' + inputIndex + ' out of bounds.');\n    }\n    if (refIndex > this.inputList.length) {\n      throw RangeError('Reference input ' + refIndex + ' out of bounds.');\n    }\n    // Remove input.\n    const input = this.inputList[inputIndex];\n    this.inputList.splice(inputIndex, 1);\n    if (inputIndex < refIndex) {\n      refIndex--;\n    }\n    // Reinsert input.\n    this.inputList.splice(refIndex, 0, input);\n  }\n\n  /**\n   * Remove an input from this block.\n   *\n   * @param name The name of the input.\n   * @param opt_quiet True to prevent an error if input is not present.\n   * @returns True if operation succeeds, false if input is not present and\n   *     opt_quiet is true.\n   * @throws {Error} if the input is not present and opt_quiet is not true.\n   */\n  removeInput(name: string, opt_quiet?: boolean): boolean {\n    for (let i = 0, input; input = this.inputList[i]; i++) {\n      if (input.name === name) {\n        if (input.type === inputTypes.STATEMENT) {\n          this.statementInputCount--;\n        }\n        input.dispose();\n        this.inputList.splice(i, 1);\n        return true;\n      }\n    }\n    if (opt_quiet) {\n      return false;\n    }\n    throw Error('Input not found: ' + name);\n  }\n\n  /**\n   * Fetches the named input object.\n   *\n   * @param name The name of the input.\n   * @returns The input object, or null if input does not exist.\n   */\n  getInput(name: string): Input|null {\n    for (let i = 0, input; input = this.inputList[i]; i++) {\n      if (input.name === name) {\n        return input;\n      }\n    }\n    // This input does not exist.\n    return null;\n  }\n\n  /**\n   * Fetches the block attached to the named input.\n   *\n   * @param name The name of the input.\n   * @returns The attached value block, or null if the input is either\n   *     disconnected or if the input does not exist.\n   */\n  getInputTargetBlock(name: string): Block|null {\n    const input = this.getInput(name);\n    return input && input.connection && input.connection.targetBlock();\n  }\n\n  /**\n   * Returns the comment on this block (or null if there is no comment).\n   *\n   * @returns Block's comment.\n   */\n  getCommentText(): string|null {\n    return this.commentModel.text;\n  }\n\n  /**\n   * Set this block's comment text.\n   *\n   * @param text The text, or null to delete.\n   */\n  setCommentText(text: string|null) {\n    if (this.commentModel.text === text) {\n      return;\n    }\n    eventUtils.fire(new (eventUtils.get(eventUtils.BLOCK_CHANGE))(\n        this, 'comment', null, this.commentModel.text, text));\n    this.commentModel.text = text;\n    // AnyDuringMigration because:  Type 'string | null' is not assignable to\n    // type 'string | Comment'.\n    this.comment = text as AnyDuringMigration;  // For backwards compatibility.\n  }\n\n  /**\n   * Set this block's warning text.\n   *\n   * @param _text The text, or null to delete.\n   * @param _opt_id An optional ID for the warning text to be able to maintain\n   *     multiple warnings.\n   */\n  setWarningText(_text: string|null, _opt_id?: string) {}\n  // NOP.\n\n  /**\n   * Give this block a mutator dialog.\n   *\n   * @param _mutator A mutator dialog instance or null to remove.\n   */\n  setMutator(_mutator: Mutator) {}\n  // NOP.\n\n  /**\n   * Return the coordinates of the top-left corner of this block relative to the\n   * drawing surface's origin (0,0), in workspace units.\n   *\n   * @returns Object with .x and .y properties.\n   */\n  getRelativeToSurfaceXY(): Coordinate {\n    return this.xy_;\n  }\n\n  /**\n   * Move a block by a relative offset.\n   *\n   * @param dx Horizontal offset, in workspace units.\n   * @param dy Vertical offset, in workspace units.\n   */\n  moveBy(dx: number, dy: number) {\n    if (this.parentBlock_) {\n      throw Error('Block has parent.');\n    }\n    const event =\n        new (eventUtils.get(eventUtils.BLOCK_MOVE))(this) as BlockMove;\n    this.xy_.translate(dx, dy);\n    event.recordNew();\n    eventUtils.fire(event);\n  }\n\n  /**\n   * Create a connection of the specified type.\n   *\n   * @param type The type of the connection to create.\n   * @returns A new connection of the specified type.\n   */\n  protected makeConnection_(type: number): Connection {\n    return new Connection(this, type);\n  }\n\n  /**\n   * Recursively checks whether all statement and value inputs are filled with\n   * blocks. Also checks all following statement blocks in this stack.\n   *\n   * @param opt_shadowBlocksAreFilled An optional argument controlling whether\n   *     shadow blocks are counted as filled. Defaults to true.\n   * @returns True if all inputs are filled, false otherwise.\n   */\n  allInputsFilled(opt_shadowBlocksAreFilled?: boolean): boolean {\n    // Account for the shadow block filledness toggle.\n    if (opt_shadowBlocksAreFilled === undefined) {\n      opt_shadowBlocksAreFilled = true;\n    }\n    if (!opt_shadowBlocksAreFilled && this.isShadow()) {\n      return false;\n    }\n\n    // Recursively check each input block of the current block.\n    for (let i = 0, input; input = this.inputList[i]; i++) {\n      if (!input.connection) {\n        continue;\n      }\n      const target = input.connection.targetBlock();\n      if (!target || !target.allInputsFilled(opt_shadowBlocksAreFilled)) {\n        return false;\n      }\n    }\n\n    // Recursively check the next block after the current block.\n    const next = this.getNextBlock();\n    if (next) {\n      return next.allInputsFilled(opt_shadowBlocksAreFilled);\n    }\n\n    return true;\n  }\n\n  /**\n   * This method returns a string describing this Block in developer terms (type\n   * name and ID; English only).\n   *\n   * Intended to on be used in console logs and errors. If you need a string\n   * that uses the user's native language (including block text, field values,\n   * and child blocks), use [toString()]{@link Block#toString}.\n   *\n   * @returns The description.\n   */\n  toDevString(): string {\n    let msg = this.type ? '\"' + this.type + '\" block' : 'Block';\n    if (this.id) {\n      msg += ' (id=\"' + this.id + '\")';\n    }\n    return msg;\n  }\n}\n\nexport namespace Block {\n  export interface CommentModel {\n    text: string|null;\n    pinned: boolean;\n    size: Size;\n  }\n}\n\nexport type CommentModel = Block.CommentModel;\n","/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing a code comment.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Comment');\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_change.js';\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_bubble_open.js';\n\nimport type {CommentModel} from './block.js';\nimport type {BlockSvg} from './block_svg.js';\nimport * as browserEvents from './browser_events.js';\nimport {Bubble} from './bubble.js';\nimport * as Css from './css.js';\nimport * as eventUtils from './events/utils.js';\nimport {Icon} from './icon.js';\nimport type {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport type {Size} from './utils/size.js';\nimport {Svg} from './utils/svg.js';\n\n\n/**\n * Class for a comment.\n *\n * @alias Blockly.Comment\n */\nexport class Comment extends Icon {\n  private readonly model: CommentModel;\n\n  /**\n   * The model's text value at the start of an edit.\n   * Used to tell if an event should be fired at the end of an edit.\n   */\n  private cachedText: string|null = '';\n\n  /** Mouse up event data. */\n  private onMouseUpWrapper: browserEvents.Data|null = null;\n\n  /** Wheel event data. */\n  private onWheelWrapper: browserEvents.Data|null = null;\n\n  /** Change event data. */\n  private onChangeWrapper: browserEvents.Data|null = null;\n\n  /** Input event data. */\n  private onInputWrapper: browserEvents.Data|null = null;\n\n  /**\n   * The SVG element that contains the text edit area, or null if not created.\n   */\n  private foreignObject: SVGForeignObjectElement|null = null;\n\n  /** The editable text area, or null if not created. */\n  private textarea_: HTMLTextAreaElement|null = null;\n\n  /** The top-level node of the comment text, or null if not created. */\n  private paragraphElement_: SVGTextElement|null = null;\n\n  /** @param block The block associated with this comment. */\n  constructor(block: BlockSvg) {\n    super(block);\n\n    /** The model for this comment. */\n    this.model = block.commentModel;\n    // If someone creates the comment directly instead of calling\n    // block.setCommentText we want to make sure the text is non-null;\n    this.model.text = this.model.text ?? '';\n\n    this.createIcon();\n  }\n\n  /**\n   * Draw the comment icon.\n   *\n   * @param group The icon group.\n   */\n  protected override drawIcon_(group: Element) {\n    // Circle.\n    dom.createSvgElement(\n        Svg.CIRCLE,\n        {'class': 'blocklyIconShape', 'r': '8', 'cx': '8', 'cy': '8'}, group);\n    // Can't use a real '?' text character since different browsers and\n    // operating systems render it differently. Body of question mark.\n    dom.createSvgElement(\n        Svg.PATH, {\n          'class': 'blocklyIconSymbol',\n          'd': 'm6.8,10h2c0.003,-0.617 0.271,-0.962 0.633,-1.266 2.875,-2.405' +\n              '0.607,-5.534 -3.765,-3.874v1.7c3.12,-1.657 3.698,0.118 2.336,1.25' +\n              '-1.201,0.998 -1.201,1.528 -1.204,2.19z',\n        },\n        group);\n    // Dot of question mark.\n    dom.createSvgElement(\n        Svg.RECT, {\n          'class': 'blocklyIconSymbol',\n          'x': '6.8',\n          'y': '10.78',\n          'height': '2',\n          'width': '2',\n        },\n        group);\n  }\n\n  /**\n   * Create the editor for the comment's bubble.\n   *\n   * @returns The top-level node of the editor.\n   */\n  private createEditor(): SVGElement {\n    /* Create the editor.  Here's the markup that will be generated in\n         * editable mode:\n          <foreignObject x=\"8\" y=\"8\" width=\"164\" height=\"164\">\n            <body xmlns=\"http://www.w3.org/1999/xhtml\"\n       class=\"blocklyMinimalBody\"> <textarea\n       xmlns=\"http://www.w3.org/1999/xhtml\" class=\"blocklyCommentTextarea\"\n                  style=\"height: 164px; width: 164px;\"></textarea>\n            </body>\n          </foreignObject>\n         * For non-editable mode see Warning.textToDom_.\n         */\n\n    this.foreignObject = dom.createSvgElement(\n        Svg.FOREIGNOBJECT,\n        {'x': Bubble.BORDER_WIDTH, 'y': Bubble.BORDER_WIDTH});\n\n    const body = document.createElementNS(dom.HTML_NS, 'body');\n    body.setAttribute('xmlns', dom.HTML_NS);\n    body.className = 'blocklyMinimalBody';\n\n    this.textarea_ = document.createElementNS(dom.HTML_NS, 'textarea') as\n        HTMLTextAreaElement;\n    const textarea = this.textarea_;\n    textarea.className = 'blocklyCommentTextarea';\n    textarea.setAttribute('dir', this.getBlock().RTL ? 'RTL' : 'LTR');\n    textarea.value = this.model.text ?? '';\n    this.resizeTextarea();\n\n    body.appendChild(textarea);\n    this.foreignObject!.appendChild(body);\n\n    this.onMouseUpWrapper = browserEvents.conditionalBind(\n        textarea, 'focus', this, this.startEdit, true);\n    // Don't zoom with mousewheel.\n    this.onWheelWrapper = browserEvents.conditionalBind(\n        textarea, 'wheel', this, function(e: Event) {\n          e.stopPropagation();\n        });\n    this.onChangeWrapper = browserEvents.conditionalBind(\n        textarea, 'change', this,\n        /**\n         * @param _e Unused event parameter.\n         */\n        function(this: Comment, _e: Event) {\n          if (this.cachedText !== this.model.text) {\n            eventUtils.fire(new (eventUtils.get(eventUtils.BLOCK_CHANGE))(\n                this.getBlock(), 'comment', null, this.cachedText,\n                this.model.text));\n          }\n        });\n    this.onInputWrapper = browserEvents.conditionalBind(\n        textarea, 'input', this,\n        /**\n         * @param _e Unused event parameter.\n         */\n        function(this: Comment, _e: Event) {\n          this.model.text = textarea.value;\n        });\n\n    setTimeout(textarea.focus.bind(textarea), 0);\n\n    return this.foreignObject;\n  }\n\n  /** Add or remove editability of the comment. */\n  override updateEditable() {\n    super.updateEditable();\n    if (this.isVisible()) {\n      // Recreate the bubble with the correct UI.\n      this.disposeBubble();\n      this.createBubble();\n    }\n  }\n\n  /**\n   * Callback function triggered when the bubble has resized.\n   * Resize the text area accordingly.\n   */\n  private onBubbleResize() {\n    if (!this.isVisible() || !this.bubble_) {\n      return;\n    }\n\n    this.model.size = this.bubble_.getBubbleSize();\n    this.resizeTextarea();\n  }\n\n  /**\n   * Resizes the text area to match the size defined on the model (which is\n   * the size of the bubble).\n   */\n  private resizeTextarea() {\n    if (!this.textarea_ || !this.foreignObject) {\n      return;\n    }\n    const size = this.model.size;\n    const doubleBorderWidth = 2 * Bubble.BORDER_WIDTH;\n    const widthMinusBorder = size.width - doubleBorderWidth;\n    const heightMinusBorder = size.height - doubleBorderWidth;\n    this.foreignObject.setAttribute('width', `${widthMinusBorder}`);\n    this.foreignObject.setAttribute('height', `${heightMinusBorder}`);\n    this.textarea_.style.width = widthMinusBorder - 4 + 'px';\n    this.textarea_.style.height = heightMinusBorder - 4 + 'px';\n  }\n\n  /**\n   * Show or hide the comment bubble.\n   *\n   * @param visible True if the bubble should be visible.\n   */\n  override setVisible(visible: boolean) {\n    if (visible === this.isVisible()) {\n      return;\n    }\n    eventUtils.fire(new (eventUtils.get(eventUtils.BUBBLE_OPEN))(\n        this.getBlock(), visible, 'comment'));\n    this.model.pinned = visible;\n    if (visible) {\n      this.createBubble();\n    } else {\n      this.disposeBubble();\n    }\n  }\n\n  /** Show the bubble. Handles deciding if it should be editable or not. */\n  private createBubble() {\n    if (!this.getBlock().isEditable()) {\n      this.createNonEditableBubble();\n    } else {\n      this.createEditableBubble();\n    }\n  }\n\n  /** Show an editable bubble. */\n  private createEditableBubble() {\n    const block = this.getBlock();\n    this.bubble_ = new Bubble(\n        block.workspace, this.createEditor(), block.pathObject.svgPath,\n        (this.iconXY_ as Coordinate), this.model.size.width,\n        this.model.size.height);\n    // Expose this comment's block's ID on its top-level SVG group.\n    this.bubble_.setSvgId(block.id);\n    this.bubble_.registerResizeEvent(this.onBubbleResize.bind(this));\n    this.applyColour();\n  }\n\n  /**\n   * Show a non-editable bubble.\n   */\n  private createNonEditableBubble() {\n    // TODO (#2917): It would be great if the comment could support line breaks.\n    this.paragraphElement_ = Bubble.textToDom(this.model.text ?? '');\n    this.bubble_ = Bubble.createNonEditableBubble(\n        this.paragraphElement_, this.getBlock(), this.iconXY_ as Coordinate);\n    this.applyColour();\n  }\n\n  /**\n   * Dispose of the bubble.\n   */\n  private disposeBubble() {\n    if (this.onMouseUpWrapper) {\n      browserEvents.unbind(this.onMouseUpWrapper);\n      this.onMouseUpWrapper = null;\n    }\n    if (this.onWheelWrapper) {\n      browserEvents.unbind(this.onWheelWrapper);\n      this.onWheelWrapper = null;\n    }\n    if (this.onChangeWrapper) {\n      browserEvents.unbind(this.onChangeWrapper);\n      this.onChangeWrapper = null;\n    }\n    if (this.onInputWrapper) {\n      browserEvents.unbind(this.onInputWrapper);\n      this.onInputWrapper = null;\n    }\n    if (this.bubble_) {\n      this.bubble_.dispose();\n      this.bubble_ = null;\n    }\n    this.textarea_ = null;\n    this.foreignObject = null;\n    this.paragraphElement_ = null;\n  }\n\n  /**\n   * Callback fired when an edit starts.\n   *\n   * Bring the comment to the top of the stack when clicked on. Also cache the\n   * current text so it can be used to fire a change event.\n   *\n   * @param _e Mouse up event.\n   */\n  private startEdit(_e: PointerEvent) {\n    if (this.bubble_?.promote()) {\n      // Since the act of moving this node within the DOM causes a loss of\n      // focus, we need to reapply the focus.\n      this.textarea_!.focus();\n    }\n\n    this.cachedText = this.model.text;\n  }\n\n  /**\n   * Get the dimensions of this comment's bubble.\n   *\n   * @returns Object with width and height properties.\n   */\n  getBubbleSize(): Size {\n    return this.model.size;\n  }\n\n  /**\n   * Size this comment's bubble.\n   *\n   * @param width Width of the bubble.\n   * @param height Height of the bubble.\n   */\n  setBubbleSize(width: number, height: number) {\n    if (this.bubble_) {\n      this.bubble_.setBubbleSize(width, height);\n    } else {\n      this.model.size.width = width;\n      this.model.size.height = height;\n    }\n  }\n\n  /**\n   * Update the comment's view to match the model.\n   *\n   * @internal\n   */\n  updateText() {\n    if (this.textarea_) {\n      this.textarea_.value = this.model.text ?? '';\n    } else if (this.paragraphElement_) {\n      // Non-Editable mode.\n      // TODO (#2917): If 2917 gets added this will probably need to be updated.\n      this.paragraphElement_.firstChild!.textContent = this.model.text;\n    }\n  }\n\n  /**\n   * Dispose of this comment.\n   *\n   * If you want to receive a comment \"delete\" event (newValue: null), then this\n   * should not be called directly. Instead call block.setCommentText(null);\n   */\n  override dispose() {\n    this.getBlock().comment = null;\n    super.dispose();\n  }\n}\n\n/** CSS for block comment.  See css.js for use. */\nCss.register(`\n.blocklyCommentTextarea {\n  background-color: #fef49c;\n  border: 0;\n  display: block;\n  margin: 0;\n  outline: 0;\n  padding: 3px;\n  resize: none;\n  text-overflow: hidden;\n}\n`);\n","/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Registry for context menu option items.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.ContextMenuRegistry');\n\nimport type {BlockSvg} from './block_svg.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/**\n * Class for the registry of context menu items. This is intended to be a\n * singleton. You should not create a new instance, and only access this class\n * from ContextMenuRegistry.registry.\n *\n * @alias Blockly.ContextMenuRegistry\n */\nexport class ContextMenuRegistry {\n  static registry: ContextMenuRegistry;\n  /** Registry of all registered RegistryItems, keyed by ID. */\n  private registry_ = new Map<string, RegistryItem>();\n\n  /** Resets the existing singleton instance of ContextMenuRegistry. */\n  constructor() {\n    this.reset();\n  }\n\n  /** Clear and recreate the registry. */\n  reset() {\n    this.registry_.clear();\n  }\n\n  /**\n   * Registers a RegistryItem.\n   *\n   * @param item Context menu item to register.\n   * @throws {Error} if an item with the given ID already exists.\n   */\n  register(item: RegistryItem) {\n    if (this.registry_.has(item.id)) {\n      throw Error('Menu item with ID \"' + item.id + '\" is already registered.');\n    }\n    this.registry_.set(item.id, item);\n  }\n\n  /**\n   * Unregisters a RegistryItem with the given ID.\n   *\n   * @param id The ID of the RegistryItem to remove.\n   * @throws {Error} if an item with the given ID does not exist.\n   */\n  unregister(id: string) {\n    if (!this.registry_.has(id)) {\n      throw new Error('Menu item with ID \"' + id + '\" not found.');\n    }\n    this.registry_.delete(id);\n  }\n\n  /**\n   * @param id The ID of the RegistryItem to get.\n   * @returns RegistryItem or null if not found\n   */\n  getItem(id: string): RegistryItem|null {\n    return this.registry_.get(id) ?? null;\n  }\n\n  /**\n   * Gets the valid context menu options for the given scope type (e.g. block or\n   * workspace) and scope. Blocks are only shown if the preconditionFn shows\n   * they should not be hidden.\n   *\n   * @param scopeType Type of scope where menu should be shown (e.g. on a block\n   *     or on a workspace)\n   * @param scope Current scope of context menu (i.e., the exact workspace or\n   *     block being clicked on)\n   * @returns the list of ContextMenuOptions\n   */\n  getContextMenuOptions(scopeType: ScopeType, scope: Scope):\n      ContextMenuOption[] {\n    const menuOptions: ContextMenuOption[] = [];\n    for (const item of this.registry_.values()) {\n      if (scopeType === item.scopeType) {\n        const precondition = item.preconditionFn(scope);\n        if (precondition !== 'hidden') {\n          const displayText = typeof item.displayText === 'function' ?\n              item.displayText(scope) :\n              item.displayText;\n          const menuOption: ContextMenuOption = {\n            text: displayText,\n            enabled: precondition === 'enabled',\n            callback: item.callback,\n            scope,\n            weight: item.weight,\n          };\n          menuOptions.push(menuOption);\n        }\n      }\n    }\n    menuOptions.sort(function(a, b) {\n      return a.weight - b.weight;\n    });\n    return menuOptions;\n  }\n}\n\nexport namespace ContextMenuRegistry {\n  /**\n   * Where this menu item should be rendered. If the menu item should be\n   * rendered in multiple scopes, e.g. on both a block and a workspace, it\n   * should be registered for each scope.\n   */\n  export enum ScopeType {\n    BLOCK = 'block',\n    WORKSPACE = 'workspace',\n  }\n\n  /**\n   * The actual workspace/block where the menu is being rendered. This is passed\n   * to callback and displayText functions that depend on this information.\n   */\n  export interface Scope {\n    block?: BlockSvg;\n    workspace?: WorkspaceSvg;\n  }\n\n  /**\n   * A menu item as entered in the registry.\n   */\n  export interface RegistryItem {\n    callback: (p1: Scope) => void;\n    scopeType: ScopeType;\n    displayText: ((p1: Scope) => string)|string;\n    preconditionFn: (p1: Scope) => string;\n    weight: number;\n    id: string;\n  }\n\n  /**\n   * A menu item as presented to contextmenu.js.\n   */\n  export interface ContextMenuOption {\n    text: string;\n    enabled: boolean;\n    callback: (p1: Scope) => void;\n    scope: Scope;\n    weight: number;\n  }\n\n  /**\n   * A subset of ContextMenuOption corresponding to what was publicly\n   * documented.  ContextMenuOption should be preferred for new code.\n   */\n  export interface LegacyContextMenuOption {\n    text: string;\n    enabled: boolean;\n    callback: (p1: Scope) => void;\n  }\n\n  /**\n   * Singleton instance of this class. All interactions with this class should\n   * be done on this object.\n   */\n  ContextMenuRegistry.registry = new ContextMenuRegistry();\n}\n\nexport type ScopeType = ContextMenuRegistry.ScopeType;\nexport const ScopeType = ContextMenuRegistry.ScopeType;\nexport type Scope = ContextMenuRegistry.Scope;\nexport type RegistryItem = ContextMenuRegistry.RegistryItem;\nexport type ContextMenuOption = ContextMenuRegistry.ContextMenuOption;\nexport type LegacyContextMenuOption =\n    ContextMenuRegistry.LegacyContextMenuOption;\n","/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Module that provides constants for use inside Blockly. Do not\n * use these constants outside of the core library.\n *\n * @namespace Blockly.internalConstants\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.internalConstants');\n\nimport {ConnectionType} from './connection_type.js';\n\n\n/**\n * Number of characters to truncate a collapsed block to.\n *\n * @alias Blockly.internalConstants.COLLAPSE_CHARS\n * @internal\n */\nexport const COLLAPSE_CHARS = 30;\n\n/**\n * When dragging a block out of a stack, split the stack in two (true), or drag\n * out the block healing the stack (false).\n *\n * @alias Blockly.internalConstants.DRAG_STACK\n * @internal\n */\nexport const DRAG_STACK = true;\n\n/**\n * Lookup table for determining the opposite type of a connection.\n *\n * @alias Blockly.internalConstants.OPPOSITE_TYPE\n * @internal\n */\nexport const OPPOSITE_TYPE: number[] = [];\nOPPOSITE_TYPE[ConnectionType.INPUT_VALUE] = ConnectionType.OUTPUT_VALUE;\nOPPOSITE_TYPE[ConnectionType.OUTPUT_VALUE] = ConnectionType.INPUT_VALUE;\nOPPOSITE_TYPE[ConnectionType.NEXT_STATEMENT] =\n    ConnectionType.PREVIOUS_STATEMENT;\nOPPOSITE_TYPE[ConnectionType.PREVIOUS_STATEMENT] =\n    ConnectionType.NEXT_STATEMENT;\n\n/**\n * String for use in the dropdown created in field_variable.\n * This string indicates that this option in the dropdown is 'Rename\n * variable...' and if selected, should trigger the prompt to rename a variable.\n *\n * @alias Blockly.internalConstants.RENAME_VARIABLE_ID\n * @internal\n */\nexport const RENAME_VARIABLE_ID = 'RENAME_VARIABLE_ID';\n\n/**\n * String for use in the dropdown created in field_variable.\n * This string indicates that this option in the dropdown is 'Delete the \"%1\"\n * variable' and if selected, should trigger the prompt to delete a variable.\n *\n * @alias Blockly.internalConstants.DELETE_VARIABLE_ID\n * @internal\n */\nexport const DELETE_VARIABLE_ID = 'DELETE_VARIABLE_ID';\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The class representing a marker.\n * Used primarily for keyboard navigation to show a marked location.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Marker');\n\n/* eslint-disable-next-line no-unused-vars */\nimport type {MarkerSvg} from '../renderers/common/marker_svg.js';\n\nimport type {ASTNode} from './ast_node.js';\n\n\n/**\n * Class for a marker.\n * This is used in keyboard navigation to save a location in the Blockly AST.\n *\n * @alias Blockly.Marker\n */\nexport class Marker {\n  /** The colour of the marker. */\n  colour: string|null = null;\n\n  /** The current location of the marker. */\n  // AnyDuringMigration because:  Type 'null' is not assignable to type\n  // 'ASTNode'.\n  private curNode_: ASTNode = null as AnyDuringMigration;\n\n  /**\n   * The object in charge of drawing the visual representation of the current\n   * node.\n   */\n  // AnyDuringMigration because:  Type 'null' is not assignable to type\n  // 'MarkerSvg'.\n  private drawer_: MarkerSvg = null as AnyDuringMigration;\n\n  /** The type of the marker. */\n  type = 'marker';\n\n  /** Constructs a new Marker instance. */\n  constructor() {}\n\n  /**\n   * Sets the object in charge of drawing the marker.\n   *\n   * @param drawer The object in charge of drawing the marker.\n   */\n  setDrawer(drawer: MarkerSvg) {\n    this.drawer_ = drawer;\n  }\n\n  /**\n   * Get the current drawer for the marker.\n   *\n   * @returns The object in charge of drawing the marker.\n   */\n  getDrawer(): MarkerSvg {\n    return this.drawer_;\n  }\n\n  /**\n   * Gets the current location of the marker.\n   *\n   * @returns The current field, connection, or block the marker is on.\n   */\n  getCurNode(): ASTNode {\n    return this.curNode_;\n  }\n\n  /**\n   * Set the location of the marker and call the update method.\n   * Setting isStack to true will only work if the newLocation is the top most\n   * output or previous connection on a stack.\n   *\n   * @param newNode The new location of the marker.\n   */\n  setCurNode(newNode: ASTNode) {\n    const oldNode = this.curNode_;\n    this.curNode_ = newNode;\n    if (this.drawer_) {\n      this.drawer_.draw(oldNode, this.curNode_);\n    }\n  }\n\n  /**\n   * Redraw the current marker.\n   *\n   * @internal\n   */\n  draw() {\n    if (this.drawer_) {\n      this.drawer_.draw(this.curNode_, this.curNode_);\n    }\n  }\n\n  /** Hide the marker SVG. */\n  hide() {\n    if (this.drawer_) {\n      this.drawer_.hide();\n    }\n  }\n\n  /** Dispose of this marker. */\n  dispose() {\n    if (this.getDrawer()) {\n      this.getDrawer().dispose();\n    }\n  }\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The class representing a cursor.\n * Used primarily for keyboard navigation.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Cursor');\n\nimport * as registry from '../registry.js';\n\nimport {ASTNode} from './ast_node.js';\nimport {Marker} from './marker.js';\n\n\n/**\n * Class for a cursor.\n * A cursor controls how a user navigates the Blockly AST.\n *\n * @alias Blockly.Cursor\n */\nexport class Cursor extends Marker {\n  override type = 'cursor';\n\n  /** @alias Blockly.Cursor */\n  constructor() {\n    super();\n  }\n\n  /**\n   * Find the next connection, field, or block.\n   *\n   * @returns The next element, or null if the current node is not set or there\n   *     is no next value.\n   */\n  next(): ASTNode|null {\n    const curNode = this.getCurNode();\n    if (!curNode) {\n      return null;\n    }\n\n    let newNode = curNode.next();\n    while (newNode && newNode.next() &&\n           (newNode.getType() === ASTNode.types.NEXT ||\n            newNode.getType() === ASTNode.types.BLOCK)) {\n      newNode = newNode.next();\n    }\n\n    if (newNode) {\n      this.setCurNode(newNode);\n    }\n    return newNode;\n  }\n\n  /**\n   * Find the in connection or field.\n   *\n   * @returns The in element, or null if the current node is not set or there is\n   *     no in value.\n   */\n  in(): ASTNode|null {\n    let curNode: ASTNode|null = this.getCurNode();\n    if (!curNode) {\n      return null;\n    }\n    // If we are on a previous or output connection, go to the block level\n    // before performing next operation.\n    if (curNode.getType() === ASTNode.types.PREVIOUS ||\n        curNode.getType() === ASTNode.types.OUTPUT) {\n      curNode = curNode.next();\n    }\n    const newNode = curNode?.in() ?? null;\n\n    if (newNode) {\n      this.setCurNode(newNode);\n    }\n    return newNode;\n  }\n\n  /**\n   * Find the previous connection, field, or block.\n   *\n   * @returns The previous element, or null if the current node is not set or\n   *     there is no previous value.\n   */\n  prev(): ASTNode|null {\n    const curNode = this.getCurNode();\n    if (!curNode) {\n      return null;\n    }\n    let newNode = curNode.prev();\n\n    while (newNode && newNode.prev() &&\n           (newNode.getType() === ASTNode.types.NEXT ||\n            newNode.getType() === ASTNode.types.BLOCK)) {\n      newNode = newNode.prev();\n    }\n\n    if (newNode) {\n      this.setCurNode(newNode);\n    }\n    return newNode;\n  }\n\n  /**\n   * Find the out connection, field, or block.\n   *\n   * @returns The out element, or null if the current node is not set or there\n   *     is no out value.\n   */\n  out(): ASTNode|null {\n    const curNode = this.getCurNode();\n    if (!curNode) {\n      return null;\n    }\n    let newNode = curNode.out();\n\n    if (newNode && newNode.getType() === ASTNode.types.BLOCK) {\n      newNode = newNode.prev() || newNode;\n    }\n\n    if (newNode) {\n      this.setCurNode(newNode);\n    }\n    return newNode;\n  }\n}\n\nregistry.register(registry.Type.CURSOR, registry.DEFAULT, Cursor);\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The class representing a basic cursor.\n * Used to demo switching between different cursors.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.BasicCursor');\n\nimport * as registry from '../registry.js';\n\nimport {ASTNode} from './ast_node.js';\nimport {Cursor} from './cursor.js';\n\n\n/**\n * Class for a basic cursor.\n * This will allow the user to get to all nodes in the AST by hitting next or\n * previous.\n *\n * @alias Blockly.BasicCursor\n */\nexport class BasicCursor extends Cursor {\n  /** Name used for registering a basic cursor. */\n  static readonly registrationName = 'basicCursor';\n\n  /** @alias Blockly.BasicCursor */\n  constructor() {\n    super();\n  }\n\n  /**\n   * Find the next node in the pre order traversal.\n   *\n   * @returns The next node, or null if the current node is not set or there is\n   *     no next value.\n   */\n  override next(): ASTNode|null {\n    const curNode = this.getCurNode();\n    if (!curNode) {\n      return null;\n    }\n    const newNode = this.getNextNode_(curNode, this.validNode_);\n\n    if (newNode) {\n      this.setCurNode(newNode);\n    }\n    return newNode;\n  }\n\n  /**\n   * For a basic cursor we only have the ability to go next and previous, so\n   * in will also allow the user to get to the next node in the pre order\n   * traversal.\n   *\n   * @returns The next node, or null if the current node is not set or there is\n   *     no next value.\n   */\n  override in(): ASTNode|null {\n    return this.next();\n  }\n\n  /**\n   * Find the previous node in the pre order traversal.\n   *\n   * @returns The previous node, or null if the current node is not set or there\n   *     is no previous value.\n   */\n  override prev(): ASTNode|null {\n    const curNode = this.getCurNode();\n    if (!curNode) {\n      return null;\n    }\n    const newNode = this.getPreviousNode_(curNode, this.validNode_);\n\n    if (newNode) {\n      this.setCurNode(newNode);\n    }\n    return newNode;\n  }\n\n  /**\n   * For a basic cursor we only have the ability to go next and previous, so\n   * out will allow the user to get to the previous node in the pre order\n   * traversal.\n   *\n   * @returns The previous node, or null if the current node is not set or there\n   *     is no previous value.\n   */\n  override out(): ASTNode|null {\n    return this.prev();\n  }\n\n  /**\n   * Uses pre order traversal to navigate the Blockly AST. This will allow\n   * a user to easily navigate the entire Blockly AST without having to go in\n   * and out levels on the tree.\n   *\n   * @param node The current position in the AST.\n   * @param isValid A function true/false depending on whether the given node\n   *     should be traversed.\n   * @returns The next node in the traversal.\n   */\n  protected getNextNode_(\n      node: ASTNode|null, isValid: (p1: ASTNode|null) => boolean): ASTNode\n      |null {\n    if (!node) {\n      return null;\n    }\n    const newNode = node.in() || node.next();\n    if (isValid(newNode)) {\n      return newNode;\n    } else if (newNode) {\n      return this.getNextNode_(newNode, isValid);\n    }\n    const siblingOrParent = this.findSiblingOrParent_(node.out());\n    if (isValid(siblingOrParent)) {\n      return siblingOrParent;\n    } else if (siblingOrParent) {\n      return this.getNextNode_(siblingOrParent, isValid);\n    }\n    return null;\n  }\n\n  /**\n   * Reverses the pre order traversal in order to find the previous node. This\n   * will allow a user to easily navigate the entire Blockly AST without having\n   * to go in and out levels on the tree.\n   *\n   * @param node The current position in the AST.\n   * @param isValid A function true/false depending on whether the given node\n   *     should be traversed.\n   * @returns The previous node in the traversal or null if no previous node\n   *     exists.\n   */\n  protected getPreviousNode_(\n      node: ASTNode|null, isValid: (p1: ASTNode|null) => boolean): ASTNode\n      |null {\n    if (!node) {\n      return null;\n    }\n    let newNode: ASTNode|null = node.prev();\n\n    if (newNode) {\n      newNode = this.getRightMostChild_(newNode);\n    } else {\n      newNode = node.out();\n    }\n    if (isValid(newNode)) {\n      return newNode;\n    } else if (newNode) {\n      return this.getPreviousNode_(newNode, isValid);\n    }\n    return null;\n  }\n\n  /**\n   * Decides what nodes to traverse and which ones to skip. Currently, it\n   * skips output, stack and workspace nodes.\n   *\n   * @param node The AST node to check whether it is valid.\n   * @returns True if the node should be visited, false otherwise.\n   */\n  protected validNode_(node: ASTNode|null): boolean {\n    let isValid = false;\n    const type = node && node.getType();\n    if (type === ASTNode.types.OUTPUT || type === ASTNode.types.INPUT ||\n        type === ASTNode.types.FIELD || type === ASTNode.types.NEXT ||\n        type === ASTNode.types.PREVIOUS || type === ASTNode.types.WORKSPACE) {\n      isValid = true;\n    }\n    return isValid;\n  }\n\n  /**\n   * From the given node find either the next valid sibling or parent.\n   *\n   * @param node The current position in the AST.\n   * @returns The parent AST node or null if there are no valid parents.\n   */\n  private findSiblingOrParent_(node: ASTNode|null): ASTNode|null {\n    if (!node) {\n      return null;\n    }\n    const nextNode = node.next();\n    if (nextNode) {\n      return nextNode;\n    }\n    return this.findSiblingOrParent_(node.out());\n  }\n\n  /**\n   * Get the right most child of a node.\n   *\n   * @param node The node to find the right most child of.\n   * @returns The right most child of the given node, or the node if no child\n   *     exists.\n   */\n  private getRightMostChild_(node: ASTNode|null): ASTNode|null {\n    if (!node!.in()) {\n      return node;\n    }\n    let newNode = node!.in();\n    while (newNode && newNode.next()) {\n      newNode = newNode.next();\n    }\n    return this.getRightMostChild_(newNode);\n  }\n}\n\nregistry.register(\n    registry.Type.CURSOR, BasicCursor.registrationName, BasicCursor);\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The class representing a cursor that is used to navigate\n * between tab navigable fields.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.TabNavigateCursor');\n\nimport type {Field} from '../field.js';\n\nimport {ASTNode} from './ast_node.js';\nimport {BasicCursor} from './basic_cursor.js';\n\n\n/**\n * A cursor for navigating between tab navigable fields.\n *\n * @alias Blockly.TabNavigateCursor\n */\nexport class TabNavigateCursor extends BasicCursor {\n  /**\n   * Skip all nodes except for tab navigable fields.\n   *\n   * @param node The AST node to check whether it is valid.\n   * @returns True if the node should be visited, false otherwise.\n   */\n  override validNode_(node: ASTNode|null): boolean {\n    let isValid = false;\n    const type = node && node.getType();\n    if (node) {\n      const location = node.getLocation() as Field;\n      if (type === ASTNode.types.FIELD && location &&\n          location.isTabNavigable() && location.isClickable()) {\n        isValid = true;\n      }\n    }\n    return isValid;\n  }\n}\n","/**\n * @license\n * Copyright 2016 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Components for creating connections between blocks.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.RenderedConnection');\n\nimport type {Block} from './block.js';\nimport type {BlockSvg} from './block_svg.js';\nimport * as common from './common.js';\nimport {config} from './config.js';\nimport {Connection} from './connection.js';\nimport type {ConnectionDB} from './connection_db.js';\nimport {ConnectionType} from './connection_type.js';\nimport * as eventUtils from './events/utils.js';\nimport * as internalConstants from './internal_constants.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport {Svg} from './utils/svg.js';\nimport * as svgMath from './utils/svg_math.js';\nimport * as svgPaths from './utils/svg_paths.js';\n\n\n/** A shape that has a pathDown property. */\ninterface PathDownShape {\n  pathDown: string;\n}\n\n/** A shape that has a pathLeft property. */\ninterface PathLeftShape {\n  pathLeft: string;\n}\n\n/** Maximum randomness in workspace units for bumping a block. */\nconst BUMP_RANDOMNESS = 10;\n\n/**\n * Class for a connection between blocks that may be rendered on screen.\n *\n * @alias Blockly.RenderedConnection\n */\nexport class RenderedConnection extends Connection {\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  sourceBlock_!: BlockSvg;\n  private readonly db_: ConnectionDB;\n  private readonly dbOpposite_: ConnectionDB;\n  private readonly offsetInBlock_: Coordinate;\n  private trackedState_: TrackedState;\n  private highlightPath: SVGPathElement|null = null;\n\n  /** Connection this connection connects to.  Null if not connected. */\n  override targetConnection: RenderedConnection|null = null;\n\n  /**\n   * @param source The block establishing this connection.\n   * @param type The type of the connection.\n   */\n  constructor(source: BlockSvg, type: number) {\n    super(source, type);\n\n    /**\n     * Connection database for connections of this type on the current\n     * workspace.\n     */\n    this.db_ = source.workspace.connectionDBList[type];\n\n    /**\n     * Connection database for connections compatible with this type on the\n     * current workspace.\n     */\n    this.dbOpposite_ =\n        source.workspace\n            .connectionDBList[internalConstants.OPPOSITE_TYPE[type]];\n\n    /** Workspace units, (0, 0) is top left of block. */\n    this.offsetInBlock_ = new Coordinate(0, 0);\n\n    /** Describes the state of this connection's tracked-ness. */\n    this.trackedState_ = RenderedConnection.TrackedState.WILL_TRACK;\n  }\n\n  /**\n   * Dispose of this connection. Remove it from the database (if it is\n   * tracked) and call the super-function to deal with connected blocks.\n   *\n   * @internal\n   */\n  override dispose() {\n    super.dispose();\n    if (this.trackedState_ === RenderedConnection.TrackedState.TRACKED) {\n      this.db_.removeConnection(this, this.y);\n    }\n  }\n\n  /**\n   * Get the source block for this connection.\n   *\n   * @returns The source block.\n   */\n  override getSourceBlock(): BlockSvg {\n    return super.getSourceBlock() as BlockSvg;\n  }\n\n  /**\n   * Returns the block that this connection connects to.\n   *\n   * @returns The connected block or null if none is connected.\n   */\n  override targetBlock(): BlockSvg|null {\n    return super.targetBlock() as BlockSvg;\n  }\n\n  /**\n   * Returns the distance between this connection and another connection in\n   * workspace units.\n   *\n   * @param otherConnection The other connection to measure the distance to.\n   * @returns The distance between connections, in workspace units.\n   */\n  distanceFrom(otherConnection: Connection): number {\n    const xDiff = this.x - otherConnection.x;\n    const yDiff = this.y - otherConnection.y;\n    return Math.sqrt(xDiff * xDiff + yDiff * yDiff);\n  }\n\n  /**\n   * Move the block(s) belonging to the connection to a point where they don't\n   * visually interfere with the specified connection.\n   *\n   * @param staticConnection The connection to move away from.\n   * @internal\n   */\n  bumpAwayFrom(staticConnection: RenderedConnection) {\n    if (this.sourceBlock_.workspace.isDragging()) {\n      // Don't move blocks around while the user is doing the same.\n      return;\n    }\n    // Move the root block.\n    let rootBlock = this.sourceBlock_.getRootBlock();\n    if (rootBlock.isInFlyout) {\n      // Don't move blocks around in a flyout.\n      return;\n    }\n    let reverse = false;\n    if (!rootBlock.isMovable()) {\n      // Can't bump an uneditable block away.\n      // Check to see if the other block is movable.\n      rootBlock = staticConnection.getSourceBlock().getRootBlock();\n      if (!rootBlock.isMovable()) {\n        return;\n      }\n      // Swap the connections and move the 'static' connection instead.\n      /* eslint-disable-next-line @typescript-eslint/no-this-alias */\n      staticConnection = this;\n      reverse = true;\n    }\n    // Raise it to the top for extra visibility.\n    const selected = common.getSelected() == rootBlock;\n    selected || rootBlock.addSelect();\n    let dx = staticConnection.x + config.snapRadius +\n        Math.floor(Math.random() * BUMP_RANDOMNESS) - this.x;\n    let dy = staticConnection.y + config.snapRadius +\n        Math.floor(Math.random() * BUMP_RANDOMNESS) - this.y;\n    if (reverse) {\n      // When reversing a bump due to an uneditable block, bump up.\n      dy = -dy;\n    }\n    if (rootBlock.RTL) {\n      dx = staticConnection.x - config.snapRadius -\n          Math.floor(Math.random() * BUMP_RANDOMNESS) - this.x;\n    }\n    rootBlock.moveBy(dx, dy);\n    selected || rootBlock.removeSelect();\n  }\n\n  /**\n   * Change the connection's coordinates.\n   *\n   * @param x New absolute x coordinate, in workspace coordinates.\n   * @param y New absolute y coordinate, in workspace coordinates.\n   */\n  moveTo(x: number, y: number) {\n    if (this.trackedState_ === RenderedConnection.TrackedState.WILL_TRACK) {\n      this.db_.addConnection(this, y);\n      this.trackedState_ = RenderedConnection.TrackedState.TRACKED;\n    } else if (this.trackedState_ === RenderedConnection.TrackedState.TRACKED) {\n      this.db_.removeConnection(this, this.y);\n      this.db_.addConnection(this, y);\n    }\n    this.x = x;\n    this.y = y;\n  }\n\n  /**\n   * Change the connection's coordinates.\n   *\n   * @param dx Change to x coordinate, in workspace units.\n   * @param dy Change to y coordinate, in workspace units.\n   */\n  moveBy(dx: number, dy: number) {\n    this.moveTo(this.x + dx, this.y + dy);\n  }\n\n  /**\n   * Move this connection to the location given by its offset within the block\n   * and the location of the block's top left corner.\n   *\n   * @param blockTL The location of the top left corner of the block, in\n   *     workspace coordinates.\n   */\n  moveToOffset(blockTL: Coordinate) {\n    this.moveTo(\n        blockTL.x + this.offsetInBlock_.x, blockTL.y + this.offsetInBlock_.y);\n  }\n\n  /**\n   * Set the offset of this connection relative to the top left of its block.\n   *\n   * @param x The new relative x, in workspace units.\n   * @param y The new relative y, in workspace units.\n   */\n  setOffsetInBlock(x: number, y: number) {\n    this.offsetInBlock_.x = x;\n    this.offsetInBlock_.y = y;\n  }\n\n  /**\n   * Get the offset of this connection relative to the top left of its block.\n   *\n   * @returns The offset of the connection.\n   * @internal\n   */\n  getOffsetInBlock(): Coordinate {\n    return this.offsetInBlock_;\n  }\n\n  /**\n   * Move the blocks on either side of this connection right next to each other.\n   *\n   * @internal\n   */\n  tighten() {\n    const dx = this.targetConnection!.x - this.x;\n    const dy = this.targetConnection!.y - this.y;\n    if (dx !== 0 || dy !== 0) {\n      const block = this.targetBlock();\n      const svgRoot = block!.getSvgRoot();\n      if (!svgRoot) {\n        throw Error('block is not rendered.');\n      }\n      // Workspace coordinates.\n      const xy = svgMath.getRelativeXY(svgRoot);\n      block!.getSvgRoot().setAttribute(\n          'transform', 'translate(' + (xy.x - dx) + ',' + (xy.y - dy) + ')');\n      block!.moveConnections(-dx, -dy);\n    }\n  }\n\n  /**\n   * Find the closest compatible connection to this connection.\n   * All parameters are in workspace units.\n   *\n   * @param maxLimit The maximum radius to another connection.\n   * @param dxy Offset between this connection's location in the database and\n   *     the current location (as a result of dragging).\n   * @returns Contains two properties: 'connection' which is either another\n   *     connection or null, and 'radius' which is the distance.\n   */\n  closest(maxLimit: number, dxy: Coordinate):\n      {connection: RenderedConnection|null, radius: number} {\n    return this.dbOpposite_.searchForClosest(this, maxLimit, dxy);\n  }\n\n  /** Add highlighting around this connection. */\n  highlight() {\n    if (this.highlightPath) {\n      // This connection is already highlighted\n      return;\n    }\n    let steps;\n    const sourceBlockSvg = (this.sourceBlock_);\n    const renderConstants =\n        sourceBlockSvg.workspace.getRenderer().getConstants();\n    const shape = renderConstants.shapeFor(this);\n    if (this.type === ConnectionType.INPUT_VALUE ||\n        this.type === ConnectionType.OUTPUT_VALUE) {\n      // Vertical line, puzzle tab, vertical line.\n      const yLen = renderConstants.TAB_OFFSET_FROM_TOP;\n      steps = svgPaths.moveBy(0, -yLen) + svgPaths.lineOnAxis('v', yLen) +\n          (shape as unknown as PathDownShape).pathDown +\n          svgPaths.lineOnAxis('v', yLen);\n    } else {\n      const xLen =\n          renderConstants.NOTCH_OFFSET_LEFT - renderConstants.CORNER_RADIUS;\n      // Horizontal line, notch, horizontal line.\n      steps = svgPaths.moveBy(-xLen, 0) + svgPaths.lineOnAxis('h', xLen) +\n          (shape as unknown as PathLeftShape).pathLeft +\n          svgPaths.lineOnAxis('h', xLen);\n    }\n    const xy = this.sourceBlock_.getRelativeToSurfaceXY();\n    const x = this.x - xy.x;\n    const y = this.y - xy.y;\n    this.highlightPath = dom.createSvgElement(\n        Svg.PATH, {\n          'class': 'blocklyHighlightedConnectionPath',\n          'd': steps,\n          'transform': 'translate(' + x + ',' + y + ')' +\n              (this.sourceBlock_.RTL ? ' scale(-1 1)' : ''),\n        },\n        this.sourceBlock_.getSvgRoot());\n  }\n\n  /** Remove the highlighting around this connection. */\n  unhighlight() {\n    if (this.highlightPath) {\n      dom.removeNode(this.highlightPath);\n      this.highlightPath = null;\n    }\n  }\n\n  /**\n   * Set whether this connections is tracked in the database or not.\n   *\n   * @param doTracking If true, start tracking. If false, stop tracking.\n   * @internal\n   */\n  setTracking(doTracking: boolean) {\n    if (doTracking &&\n            this.trackedState_ === RenderedConnection.TrackedState.TRACKED ||\n        !doTracking &&\n            this.trackedState_ === RenderedConnection.TrackedState.UNTRACKED) {\n      return;\n    }\n    if (this.sourceBlock_.isInFlyout) {\n      // Don't bother maintaining a database of connections in a flyout.\n      return;\n    }\n    if (doTracking) {\n      this.db_.addConnection(this, this.y);\n      this.trackedState_ = RenderedConnection.TrackedState.TRACKED;\n      return;\n    }\n    if (this.trackedState_ === RenderedConnection.TrackedState.TRACKED) {\n      this.db_.removeConnection(this, this.y);\n    }\n    this.trackedState_ = RenderedConnection.TrackedState.UNTRACKED;\n  }\n\n  /**\n   * Stop tracking this connection, as well as all down-stream connections on\n   * any block attached to this connection. This happens when a block is\n   * collapsed.\n   *\n   * Also closes down-stream icons/bubbles.\n   *\n   * @internal\n   */\n  stopTrackingAll() {\n    this.setTracking(false);\n    if (this.targetConnection) {\n      const blocks = this.targetBlock()!.getDescendants(false);\n      for (let i = 0; i < blocks.length; i++) {\n        const block = blocks[i];\n        // Stop tracking connections of all children.\n        const connections = block.getConnections_(true);\n        for (let j = 0; j < connections.length; j++) {\n          (connections[j]).setTracking(false);\n        }\n        // Close all bubbles of all children.\n        const icons = block.getIcons();\n        for (let j = 0; j < icons.length; j++) {\n          icons[j].setVisible(false);\n        }\n      }\n    }\n  }\n\n  /**\n   * Start tracking this connection, as well as all down-stream connections on\n   * any block attached to this connection. This happens when a block is\n   * expanded.\n   *\n   * @returns List of blocks to render.\n   */\n  startTrackingAll(): Block[] {\n    this.setTracking(true);\n    // All blocks that are not tracked must start tracking before any\n    // rendering takes place, since rendering requires knowing the dimensions\n    // of lower blocks. Also, since rendering a block renders all its parents,\n    // we only need to render the leaf nodes.\n    let renderList: Block[] = [];\n    if (this.type !== ConnectionType.INPUT_VALUE &&\n        this.type !== ConnectionType.NEXT_STATEMENT) {\n      // Only spider down.\n      return renderList;\n    }\n    const block = this.targetBlock();\n    if (block) {\n      let connections;\n      if (block.isCollapsed()) {\n        // This block should only be partially revealed since it is collapsed.\n        connections = [];\n        block.outputConnection && connections.push(block.outputConnection);\n        block.nextConnection && connections.push(block.nextConnection);\n        block.previousConnection && connections.push(block.previousConnection);\n      } else {\n        // Show all connections of this block.\n        connections = block.getConnections_(true);\n      }\n      for (let i = 0; i < connections.length; i++) {\n        renderList.push(...connections[i].startTrackingAll());\n      }\n      if (!renderList.length) {\n        // Leaf block.\n        renderList = [block];\n      }\n    }\n    return renderList;\n  }\n\n  /**\n   * Behavior after a connection attempt fails.\n   * Bumps this connection away from the other connection. Called when an\n   * attempted connection fails.\n   *\n   * @param otherConnection Connection that this connection failed to connect\n   *     to.\n   * @internal\n   */\n  override onFailedConnect(otherConnection: Connection) {\n    const block = this.getSourceBlock();\n    if (eventUtils.getRecordUndo()) {\n      const group = eventUtils.getGroup();\n      setTimeout(function(this: RenderedConnection) {\n        if (!block.isDisposed() && !block.getParent()) {\n          eventUtils.setGroup(group);\n          this.bumpAwayFrom(otherConnection as RenderedConnection);\n          eventUtils.setGroup(false);\n        }\n      }.bind(this), config.bumpDelay);\n    }\n  }\n\n  /**\n   * Disconnect two blocks that are connected by this connection.\n   *\n   * @param parentBlock The superior block.\n   * @param childBlock The inferior block.\n   */\n  protected override disconnectInternal_(\n      parentBlock: Block, childBlock: Block) {\n    super.disconnectInternal_(parentBlock, childBlock);\n    const renderedParent = parentBlock as BlockSvg;\n    const renderedChild = childBlock as BlockSvg;\n    // Rerender the parent so that it may reflow.\n    if (renderedParent.rendered) {\n      renderedParent.render();\n    }\n    if (renderedChild.rendered) {\n      renderedChild.updateDisabled();\n      renderedChild.render();\n      // Reset visibility, since the child is now a top block.\n      renderedChild.getSvgRoot().style.display = 'block';\n    }\n  }\n\n  /**\n   * Respawn the shadow block if there was one connected to the this connection.\n   * Render/rerender blocks as needed.\n   */\n  protected override respawnShadow_() {\n    super.respawnShadow_();\n    const blockShadow = this.targetBlock();\n    if (!blockShadow) {\n      return;\n    }\n    blockShadow.initSvg();\n    blockShadow.render(false);\n\n    const parentBlock = this.getSourceBlock();\n    if (parentBlock.rendered) {\n      parentBlock.render();\n    }\n  }\n\n  /**\n   * Find all nearby compatible connections to this connection.\n   * Type checking does not apply, since this function is used for bumping.\n   *\n   * @param maxLimit The maximum radius to another connection, in workspace\n   *     units.\n   * @returns List of connections.\n   * @internal\n   */\n  override neighbours(maxLimit: number): RenderedConnection[] {\n    return this.dbOpposite_.getNeighbours(this, maxLimit);\n  }\n\n  /**\n   * Connect two connections together.  This is the connection on the superior\n   * block.  Rerender blocks as needed.\n   *\n   * @param childConnection Connection on inferior block.\n   */\n  protected override connect_(childConnection: Connection) {\n    super.connect_(childConnection);\n\n    const renderedChildConnection = childConnection as RenderedConnection;\n\n    const parentBlock = this.getSourceBlock();\n    const childBlock = renderedChildConnection.getSourceBlock();\n    const parentRendered = parentBlock.rendered;\n    const childRendered = childBlock.rendered;\n\n    if (parentRendered) {\n      parentBlock.updateDisabled();\n    }\n    if (childRendered) {\n      childBlock.updateDisabled();\n    }\n    if (parentRendered && childRendered) {\n      if (this.type === ConnectionType.NEXT_STATEMENT ||\n          this.type === ConnectionType.PREVIOUS_STATEMENT) {\n        // Child block may need to square off its corners if it is in a stack.\n        // Rendering a child will render its parent.\n        childBlock.render();\n      } else {\n        // Child block does not change shape.  Rendering the parent node will\n        // move its connected children into position.\n        parentBlock.render();\n      }\n    }\n\n    // The input the child block is connected to (if any).\n    const parentInput = parentBlock.getInputWithBlock(childBlock);\n    if (parentInput) {\n      const visible = parentInput.isVisible();\n      childBlock.getSvgRoot().style.display = visible ? 'block' : 'none';\n    }\n  }\n\n  /**\n   * Function to be called when this connection's compatible types have changed.\n   */\n  protected override onCheckChanged_() {\n    // The new value type may not be compatible with the existing connection.\n    if (this.isConnected() &&\n        (!this.targetConnection ||\n         !this.getConnectionChecker().canConnect(\n             this, this.targetConnection, false))) {\n      const child = this.isSuperior() ? this.targetBlock() : this.sourceBlock_;\n      child!.unplug();\n      // Bump away.\n      this.sourceBlock_.bumpNeighbours();\n    }\n  }\n}\n\nexport namespace RenderedConnection {\n  /**\n   * Enum for different kinds of tracked states.\n   *\n   * WILL_TRACK means that this connection will add itself to\n   * the db on the next moveTo call it receives.\n   *\n   * UNTRACKED means that this connection will not add\n   * itself to the database until setTracking(true) is explicitly called.\n   *\n   * TRACKED means that this connection is currently being tracked.\n   */\n  export enum TrackedState {\n    WILL_TRACK = -1,\n    UNTRACKED = 0,\n    TRACKED = 1,\n  }\n}\n\nexport type TrackedState = RenderedConnection.TrackedState;\nexport const TrackedState = RenderedConnection.TrackedState;\n","/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing a warning.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Warning');\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_bubble_open.js';\n\nimport type {BlockSvg} from './block_svg.js';\nimport {Bubble} from './bubble.js';\nimport * as eventUtils from './events/utils.js';\nimport {Icon} from './icon.js';\nimport type {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport {Svg} from './utils/svg.js';\n\n\n/**\n * Class for a warning.\n *\n * @alias Blockly.Warning\n */\nexport class Warning extends Icon {\n  private text: {[key: string]: string};\n\n  /** The top-level node of the warning text, or null if not created. */\n  private paragraphElement: SVGTextElement|null = null;\n\n  /** Does this icon get hidden when the block is collapsed? */\n  override collapseHidden = false;\n\n  /** @param block The block associated with this warning. */\n  constructor(block: BlockSvg) {\n    super(block);\n    this.createIcon();\n    // The text object can contain multiple warnings.\n    this.text = Object.create(null);\n  }\n\n  /**\n   * Draw the warning icon.\n   *\n   * @param group The icon group.\n   */\n  protected override drawIcon_(group: Element) {\n    // Triangle with rounded corners.\n    dom.createSvgElement(\n        Svg.PATH, {\n          'class': 'blocklyIconShape',\n          'd': 'M2,15Q-1,15 0.5,12L6.5,1.7Q8,-1 9.5,1.7L15.5,12Q17,15 14,15z',\n        },\n        group);\n    // Can't use a real '!' text character since different browsers and\n    // operating systems render it differently. Body of exclamation point.\n    dom.createSvgElement(\n        Svg.PATH, {\n          'class': 'blocklyIconSymbol',\n          'd': 'm7,4.8v3.16l0.27,2.27h1.46l0.27,-2.27v-3.16z',\n        },\n        group);\n    // Dot of exclamation point.\n    dom.createSvgElement(\n        Svg.RECT, {\n          'class': 'blocklyIconSymbol',\n          'x': '7',\n          'y': '11',\n          'height': '2',\n          'width': '2',\n        },\n        group);\n  }\n\n  /**\n   * Show or hide the warning bubble.\n   *\n   * @param visible True if the bubble should be visible.\n   */\n  override setVisible(visible: boolean) {\n    if (visible === this.isVisible()) {\n      return;\n    }\n    eventUtils.fire(new (eventUtils.get(eventUtils.BUBBLE_OPEN))(\n        this.getBlock(), visible, 'warning'));\n    if (visible) {\n      this.createBubble();\n    } else {\n      this.disposeBubble();\n    }\n  }\n\n  /** Show the bubble. */\n  private createBubble() {\n    this.paragraphElement = Bubble.textToDom(this.getText());\n    this.bubble_ = Bubble.createNonEditableBubble(\n        this.paragraphElement, this.getBlock(), this.iconXY_ as Coordinate);\n    this.applyColour();\n  }\n\n  /** Dispose of the bubble and references to it. */\n  private disposeBubble() {\n    if (this.bubble_) {\n      this.bubble_.dispose();\n      this.bubble_ = null;\n    }\n    this.paragraphElement = null;\n  }\n\n  /**\n   * Set this warning's text.\n   *\n   * @param text Warning text (or '' to delete). This supports linebreaks.\n   * @param id An ID for this text entry to be able to maintain multiple\n   *     warnings.\n   */\n  setText(text: string, id: string) {\n    if (this.text[id] === text) {\n      return;\n    }\n    if (text) {\n      this.text[id] = text;\n    } else {\n      delete this.text[id];\n    }\n    if (this.isVisible()) {\n      this.setVisible(false);\n      this.setVisible(true);\n    }\n  }\n\n  /**\n   * Get this warning's texts.\n   *\n   * @returns All texts concatenated into one string.\n   */\n  getText(): string {\n    const allWarnings = [];\n    for (const id in this.text) {\n      allWarnings.push(this.text[id]);\n    }\n    return allWarnings.join('\\n');\n  }\n\n  /** Dispose of this warning. */\n  override dispose() {\n    this.getBlock().warning = null;\n    super.dispose();\n  }\n}\n","/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Methods for graphically rendering a block as SVG.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.BlockSvg');\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_selected.js';\n\nimport {Block} from './block.js';\nimport * as blockAnimations from './block_animations.js';\nimport * as browserEvents from './browser_events.js';\nimport {Comment} from './comment.js';\nimport * as common from './common.js';\nimport {config} from './config.js';\nimport type {Connection} from './connection.js';\nimport {ConnectionType} from './connection_type.js';\nimport * as constants from './constants.js';\nimport * as ContextMenu from './contextmenu.js';\nimport {ContextMenuOption, ContextMenuRegistry, LegacyContextMenuOption} from './contextmenu_registry.js';\nimport type {BlockMove} from './events/events_block_move.js';\nimport * as eventUtils from './events/utils.js';\nimport type {Field} from './field.js';\nimport {FieldLabel} from './field_label.js';\nimport type {Icon} from './icon.js';\nimport type {Input} from './input.js';\nimport type {IASTNodeLocationSvg} from './interfaces/i_ast_node_location_svg.js';\nimport type {IBoundedElement} from './interfaces/i_bounded_element.js';\nimport type {CopyData, ICopyable} from './interfaces/i_copyable.js';\nimport type {IDraggable} from './interfaces/i_draggable.js';\nimport * as internalConstants from './internal_constants.js';\nimport {ASTNode} from './keyboard_nav/ast_node.js';\nimport {TabNavigateCursor} from './keyboard_nav/tab_navigate_cursor.js';\nimport {MarkerManager} from './marker_manager.js';\nimport {Msg} from './msg.js';\nimport type {Mutator} from './mutator.js';\nimport {RenderedConnection} from './rendered_connection.js';\nimport type {Debug as BlockRenderingDebug} from './renderers/common/debugger.js';\nimport type {IPathObject} from './renderers/common/i_path_object.js';\nimport * as blocks from './serialization/blocks.js';\nimport type {BlockStyle} from './theme.js';\nimport * as Tooltip from './tooltip.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport {Rect} from './utils/rect.js';\nimport {Svg} from './utils/svg.js';\nimport * as svgMath from './utils/svg_math.js';\nimport {Warning} from './warning.js';\nimport type {Workspace} from './workspace.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/**\n * Class for a block's SVG representation.\n * Not normally called directly, workspace.newBlock() is preferred.\n *\n * @alias Blockly.BlockSvg\n */\nexport class BlockSvg extends Block implements IASTNodeLocationSvg,\n                                               IBoundedElement, ICopyable,\n                                               IDraggable {\n  /**\n   * Constant for identifying rows that are to be rendered inline.\n   * Don't collide with Blockly.inputTypes.\n   */\n  static readonly INLINE = -1;\n\n  /**\n   * ID to give the \"collapsed warnings\" warning. Allows us to remove the\n   * \"collapsed warnings\" warning without removing any warnings that belong to\n   * the block.\n   */\n  static readonly COLLAPSED_WARNING_ID = 'TEMP_COLLAPSED_WARNING_';\n  override decompose?: ((p1: Workspace) => BlockSvg);\n  // override compose?: ((p1: BlockSvg) => void)|null;\n  saveConnections?: ((p1: BlockSvg) => AnyDuringMigration);\n  customContextMenu?:\n      ((p1: Array<ContextMenuOption|LegacyContextMenuOption>) =>\n           AnyDuringMigration)|null;\n\n  /**\n   * An property used internally to reference the block's rendering debugger.\n   *\n   * @internal\n   */\n  renderingDebugger: BlockRenderingDebug|null = null;\n\n  /**\n   * Height of this block, not including any statement blocks above or below.\n   * Height is in workspace units.\n   */\n  height = 0;\n\n  /**\n   * Width of this block, including any connected value blocks.\n   * Width is in workspace units.\n   */\n  width = 0;\n\n  /**\n   * Map from IDs for warnings text to PIDs of functions to apply them.\n   * Used to be able to maintain multiple warnings.\n   */\n  private warningTextDb = new Map<string, ReturnType<typeof setTimeout>>();\n\n  /** Block's mutator icon (if any). */\n  mutator: Mutator|null = null;\n\n  /** Block's comment icon (if any). */\n  private commentIcon_: Comment|null = null;\n\n  /** Block's warning icon (if any). */\n  warning: Warning|null = null;\n\n  private svgGroup_: SVGGElement;\n  style: BlockStyle;\n  /** @internal */\n  pathObject: IPathObject;\n  override rendered = false;\n\n  /**\n   * Is this block currently rendering? Used to stop recursive render calls\n   * from actually triggering a re-render.\n   */\n  private renderIsInProgress_ = false;\n\n  /** Whether mousedown events have been bound yet. */\n  private eventsInit_ = false;\n\n  override workspace: WorkspaceSvg;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  override outputConnection!: RenderedConnection;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  override nextConnection!: RenderedConnection;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  override previousConnection!: RenderedConnection;\n  private readonly useDragSurface_: boolean;\n\n  /**\n   * @param workspace The block's workspace.\n   * @param prototypeName Name of the language object containing type-specific\n   *     functions for this block.\n   * @param opt_id Optional ID.  Use this ID if provided, otherwise create a new\n   *     ID.\n   */\n  constructor(workspace: WorkspaceSvg, prototypeName: string, opt_id?: string) {\n    super(workspace, prototypeName, opt_id);\n    this.workspace = workspace;\n\n    /**\n     * An optional method called when a mutator dialog is first opened.\n     * This function must create and initialize a top-level block for the\n     * mutator dialog, and return it. This function should also populate this\n     * top-level block with any sub-blocks which are appropriate. This method\n     * must also be coupled with defining a `compose` method for the default\n     * mutation dialog button and UI to appear.\n     */\n    this.decompose = this.decompose;\n\n    /**\n     * An optional method called when a mutator dialog saves its content.\n     * This function is called to modify the original block according to new\n     * settings. This method must also be coupled with defining a `decompose`\n     * method for the default mutation dialog button and UI to appear.\n     */\n    this.compose = this.compose;\n\n    /**\n     * An optional method called by the default mutator UI which gives the block\n     * a chance to save information about what child blocks are connected to\n     * what mutated connections.\n     */\n    this.saveConnections = this.saveConnections;\n\n    /** An optional method for defining custom block context menu items. */\n    this.customContextMenu = this.customContextMenu;\n    this.svgGroup_ = dom.createSvgElement(Svg.G, {});\n    (this.svgGroup_ as AnyDuringMigration).translate_ = '';\n\n    /** A block style object. */\n    this.style = workspace.getRenderer().getConstants().getBlockStyle(null);\n\n    /** The renderer's path object. */\n    this.pathObject =\n        workspace.getRenderer().makePathObject(this.svgGroup_, this.style);\n\n    /**\n     * Whether to move the block to the drag surface when it is dragged.\n     * True if it should move, false if it should be translated directly.\n     */\n    this.useDragSurface_ = !!workspace.getBlockDragSurface();\n\n    const svgPath = this.pathObject.svgPath;\n    (svgPath as AnyDuringMigration).tooltip = this;\n    Tooltip.bindMouseEvents(svgPath);\n\n    // Expose this block's ID on its top-level SVG group.\n    this.svgGroup_.setAttribute('data-id', this.id);\n\n    this.doInit_();\n  }\n\n  /**\n   * Create and initialize the SVG representation of the block.\n   * May be called more than once.\n   */\n  initSvg() {\n    if (!this.workspace.rendered) {\n      throw TypeError('Workspace is headless.');\n    }\n    for (let i = 0, input; input = this.inputList[i]; i++) {\n      input.init();\n    }\n    const icons = this.getIcons();\n    for (let i = 0; i < icons.length; i++) {\n      icons[i].createIcon();\n    }\n    this.applyColour();\n    this.pathObject.updateMovable(this.isMovable());\n    const svg = this.getSvgRoot();\n    if (!this.workspace.options.readOnly && !this.eventsInit_ && svg) {\n      browserEvents.conditionalBind(\n          svg, 'pointerdown', this, this.onMouseDown_);\n    }\n    this.eventsInit_ = true;\n\n    if (!svg.parentNode) {\n      this.workspace.getCanvas().appendChild(svg);\n    }\n  }\n\n  /**\n   * Get the secondary colour of a block.\n   *\n   * @returns #RRGGBB string.\n   */\n  getColourSecondary(): string|undefined {\n    return this.style.colourSecondary;\n  }\n\n  /**\n   * Get the tertiary colour of a block.\n   *\n   * @returns #RRGGBB string.\n   */\n  getColourTertiary(): string|undefined {\n    return this.style.colourTertiary;\n  }\n\n  /**\n   * Selects this block. Highlights the block visually and fires a select event\n   * if the block is not already selected.\n   */\n  select() {\n    if (this.isShadow() && this.getParent()) {\n      // Shadow blocks should not be selected.\n      this.getParent()!.select();\n      return;\n    }\n    if (common.getSelected() === this) {\n      return;\n    }\n    let oldId = null;\n    if (common.getSelected()) {\n      oldId = common.getSelected()!.id;\n      // Unselect any previously selected block.\n      eventUtils.disable();\n      try {\n        common.getSelected()!.unselect();\n      } finally {\n        eventUtils.enable();\n      }\n    }\n    const event = new (eventUtils.get(eventUtils.SELECTED))(\n        oldId, this.id, this.workspace.id);\n    eventUtils.fire(event);\n    common.setSelected(this);\n    this.addSelect();\n  }\n\n  /**\n   * Unselects this block. Unhighlights the block and fires a select (false)\n   * event if the block is currently selected.\n   */\n  unselect() {\n    if (common.getSelected() !== this) {\n      return;\n    }\n    const event = new (eventUtils.get(eventUtils.SELECTED))(\n        this.id, null, this.workspace.id);\n    event.workspaceId = this.workspace.id;\n    eventUtils.fire(event);\n    common.setSelected(null);\n    this.removeSelect();\n  }\n\n  /**\n   * Returns a list of mutator, comment, and warning icons.\n   *\n   * @returns List of icons.\n   */\n  getIcons(): Icon[] {\n    const icons = [];\n    if (this.mutator) {\n      icons.push(this.mutator);\n    }\n    if (this.commentIcon_) {\n      icons.push(this.commentIcon_);\n    }\n    if (this.warning) {\n      icons.push(this.warning);\n    }\n    return icons;\n  }\n\n  /**\n   * Sets the parent of this block to be a new block or null.\n   *\n   * @param newParent New parent block.\n   * @internal\n   */\n  override setParent(newParent: this|null) {\n    const oldParent = this.parentBlock_;\n    if (newParent === oldParent) {\n      return;\n    }\n\n    dom.startTextWidthCache();\n    super.setParent(newParent);\n    dom.stopTextWidthCache();\n\n    const svgRoot = this.getSvgRoot();\n\n    // Bail early if workspace is clearing, or we aren't rendered.\n    // We won't need to reattach ourselves anywhere.\n    if (this.workspace.isClearing || !svgRoot) {\n      return;\n    }\n\n    const oldXY = this.getRelativeToSurfaceXY();\n    if (newParent) {\n      (newParent as BlockSvg).getSvgRoot().appendChild(svgRoot);\n      const newXY = this.getRelativeToSurfaceXY();\n      // Move the connections to match the child's new position.\n      this.moveConnections(newXY.x - oldXY.x, newXY.y - oldXY.y);\n    } else if (oldParent) {\n      // If we are losing a parent, we want to move our DOM element to the\n      // root of the workspace.\n      this.workspace.getCanvas().appendChild(svgRoot);\n      this.translate(oldXY.x, oldXY.y);\n    }\n\n    this.applyColour();\n  }\n\n  /**\n   * Return the coordinates of the top-left corner of this block relative to the\n   * drawing surface's origin (0,0), in workspace units.\n   * If the block is on the workspace, (0, 0) is the origin of the workspace\n   * coordinate system.\n   * This does not change with workspace scale.\n   *\n   * @returns Object with .x and .y properties in workspace coordinates.\n   */\n  override getRelativeToSurfaceXY(): Coordinate {\n    let x = 0;\n    let y = 0;\n\n    const dragSurfaceGroup = this.useDragSurface_ ?\n        this.workspace.getBlockDragSurface()!.getGroup() :\n        null;\n\n    let element: SVGElement = this.getSvgRoot();\n    if (element) {\n      do {\n        // Loop through this block and every parent.\n        const xy = svgMath.getRelativeXY(element);\n        x += xy.x;\n        y += xy.y;\n        // If this element is the current element on the drag surface, include\n        // the translation of the drag surface itself.\n        if (this.useDragSurface_ &&\n            this.workspace.getBlockDragSurface()!.getCurrentBlock() ===\n                element) {\n          const surfaceTranslation =\n              this.workspace.getBlockDragSurface()!.getSurfaceTranslation();\n          x += surfaceTranslation.x;\n          y += surfaceTranslation.y;\n        }\n        element = element.parentNode as SVGElement;\n      } while (element && element !== this.workspace.getCanvas() &&\n               element !== dragSurfaceGroup);\n    }\n    return new Coordinate(x, y);\n  }\n\n  /**\n   * Move a block by a relative offset.\n   *\n   * @param dx Horizontal offset in workspace units.\n   * @param dy Vertical offset in workspace units.\n   */\n  override moveBy(dx: number, dy: number) {\n    if (this.parentBlock_) {\n      throw Error('Block has parent.');\n    }\n    const eventsEnabled = eventUtils.isEnabled();\n    let event: BlockMove|null = null;\n    if (eventsEnabled) {\n      event = new (eventUtils.get(eventUtils.BLOCK_MOVE))!(this) as BlockMove;\n    }\n    const xy = this.getRelativeToSurfaceXY();\n    this.translate(xy.x + dx, xy.y + dy);\n    this.moveConnections(dx, dy);\n    if (eventsEnabled && event) {\n      event!.recordNew();\n      eventUtils.fire(event);\n    }\n    this.workspace.resizeContents();\n  }\n\n  /**\n   * Transforms a block by setting the translation on the transform attribute\n   * of the block's SVG.\n   *\n   * @param x The x coordinate of the translation in workspace units.\n   * @param y The y coordinate of the translation in workspace units.\n   */\n  translate(x: number, y: number) {\n    this.getSvgRoot().setAttribute(\n        'transform', 'translate(' + x + ',' + y + ')');\n  }\n\n  /**\n   * Move this block to its workspace's drag surface, accounting for\n   * positioning. Generally should be called at the same time as\n   * setDragging_(true). Does nothing if useDragSurface_ is false.\n   *\n   * @internal\n   */\n  moveToDragSurface() {\n    if (!this.useDragSurface_) {\n      return;\n    }\n    // The translation for drag surface blocks,\n    // is equal to the current relative-to-surface position,\n    // to keep the position in sync as it move on/off the surface.\n    // This is in workspace coordinates.\n    const xy = this.getRelativeToSurfaceXY();\n    this.clearTransformAttributes_();\n    this.workspace.getBlockDragSurface()!.translateSurface(xy.x, xy.y);\n    // Execute the move on the top-level SVG component\n    const svg = this.getSvgRoot();\n    if (svg) {\n      this.workspace.getBlockDragSurface()!.setBlocksAndShow(svg);\n    }\n  }\n\n  /**\n   * Move a block to a position.\n   *\n   * @param xy The position to move to in workspace units.\n   */\n  moveTo(xy: Coordinate) {\n    const curXY = this.getRelativeToSurfaceXY();\n    this.moveBy(xy.x - curXY.x, xy.y - curXY.y);\n  }\n\n  /**\n   * Move this block back to the workspace block canvas.\n   * Generally should be called at the same time as setDragging_(false).\n   * Does nothing if useDragSurface_ is false.\n   *\n   * @param newXY The position the block should take on on the workspace canvas,\n   *     in workspace coordinates.\n   * @internal\n   */\n  moveOffDragSurface(newXY: Coordinate) {\n    if (!this.useDragSurface_) {\n      return;\n    }\n    // Translate to current position, turning off 3d.\n    this.translate(newXY.x, newXY.y);\n    this.workspace.getBlockDragSurface()!.clearAndHide(\n        this.workspace.getCanvas());\n  }\n\n  /**\n   * Move this block during a drag, taking into account whether we are using a\n   * drag surface to translate blocks.\n   * This block must be a top-level block.\n   *\n   * @param newLoc The location to translate to, in workspace coordinates.\n   * @internal\n   */\n  moveDuringDrag(newLoc: Coordinate) {\n    if (this.useDragSurface_) {\n      this.workspace.getBlockDragSurface()!.translateSurface(\n          newLoc.x, newLoc.y);\n    } else {\n      (this.svgGroup_ as AnyDuringMigration).translate_ =\n          'translate(' + newLoc.x + ',' + newLoc.y + ')';\n      (this.svgGroup_ as AnyDuringMigration)\n          .setAttribute(\n              'transform',\n              (this.svgGroup_ as AnyDuringMigration).translate_ +\n                  (this.svgGroup_ as AnyDuringMigration).skew_);\n    }\n  }\n\n  /**\n   * Clear the block of transform=\"...\" attributes.\n   * Used when the block is switching from 3d to 2d transform or vice versa.\n   */\n  private clearTransformAttributes_() {\n    this.getSvgRoot().removeAttribute('transform');\n  }\n\n  /** Snap this block to the nearest grid point. */\n  snapToGrid() {\n    if (this.isDeadOrDying()) {\n      return;  // Deleted block.\n    }\n    if (this.workspace.isDragging()) {\n      return;  // Don't bump blocks during a drag.;\n    }\n\n    if (this.getParent()) {\n      return;  // Only snap top-level blocks.\n    }\n    if (this.isInFlyout) {\n      return;  // Don't move blocks around in a flyout.\n    }\n    const grid = this.workspace.getGrid();\n    if (!grid || !grid.shouldSnap()) {\n      return;  // Config says no snapping.\n    }\n    const spacing = grid.getSpacing();\n    const half = spacing / 2;\n    const xy = this.getRelativeToSurfaceXY();\n    const dx =\n        Math.round(Math.round((xy.x - half) / spacing) * spacing + half - xy.x);\n    const dy =\n        Math.round(Math.round((xy.y - half) / spacing) * spacing + half - xy.y);\n    if (dx || dy) {\n      this.moveBy(dx, dy);\n    }\n  }\n\n  /**\n   * Returns the coordinates of a bounding box describing the dimensions of this\n   * block and any blocks stacked below it.\n   * Coordinate system: workspace coordinates.\n   *\n   * @returns Object with coordinates of the bounding box.\n   */\n  getBoundingRectangle(): Rect {\n    const blockXY = this.getRelativeToSurfaceXY();\n    const blockBounds = this.getHeightWidth();\n    let left;\n    let right;\n    if (this.RTL) {\n      left = blockXY.x - blockBounds.width;\n      right = blockXY.x;\n    } else {\n      left = blockXY.x;\n      right = blockXY.x + blockBounds.width;\n    }\n    return new Rect(blockXY.y, blockXY.y + blockBounds.height, left, right);\n  }\n\n  /**\n   * Notify every input on this block to mark its fields as dirty.\n   * A dirty field is a field that needs to be re-rendered.\n   */\n  markDirty() {\n    this.pathObject.constants = this.workspace.getRenderer().getConstants();\n    for (let i = 0, input; input = this.inputList[i]; i++) {\n      input.markDirty();\n    }\n  }\n\n  /**\n   * Set whether the block is collapsed or not.\n   *\n   * @param collapsed True if collapsed.\n   */\n  override setCollapsed(collapsed: boolean) {\n    if (this.collapsed_ === collapsed) {\n      return;\n    }\n    super.setCollapsed(collapsed);\n    if (!collapsed) {\n      this.updateCollapsed_();\n    } else if (this.rendered) {\n      this.render();\n      // Don't bump neighbours. Users like to store collapsed functions together\n      // and bumping makes them go out of alignment.\n    }\n  }\n\n  /**\n   * Makes sure that when the block is collapsed, it is rendered correctly\n   * for that state.\n   */\n  private updateCollapsed_() {\n    const collapsed = this.isCollapsed();\n    const collapsedInputName = constants.COLLAPSED_INPUT_NAME;\n    const collapsedFieldName = constants.COLLAPSED_FIELD_NAME;\n\n    for (let i = 0, input; input = this.inputList[i]; i++) {\n      if (input.name !== collapsedInputName) {\n        input.setVisible(!collapsed);\n      }\n    }\n\n    if (!collapsed) {\n      this.updateDisabled();\n      this.removeInput(collapsedInputName);\n      return;\n    }\n\n    const icons = this.getIcons();\n    for (let i = 0, icon; icon = icons[i]; i++) {\n      icon.setVisible(false);\n    }\n\n    const text = this.toString(internalConstants.COLLAPSE_CHARS);\n    const field = this.getField(collapsedFieldName);\n    if (field) {\n      field.setValue(text);\n      return;\n    }\n    const input = this.getInput(collapsedInputName) ||\n        this.appendDummyInput(collapsedInputName);\n    input.appendField(new FieldLabel(text), collapsedFieldName);\n  }\n\n  /**\n   * Open the next (or previous) FieldTextInput.\n   *\n   * @param start Current field.\n   * @param forward If true go forward, otherwise backward.\n   */\n  tab(start: Field, forward: boolean) {\n    const tabCursor = new TabNavigateCursor();\n    tabCursor.setCurNode(ASTNode.createFieldNode(start)!);\n    const currentNode = tabCursor.getCurNode();\n\n    if (forward) {\n      tabCursor.next();\n    } else {\n      tabCursor.prev();\n    }\n\n    const nextNode = tabCursor.getCurNode();\n    if (nextNode && nextNode !== currentNode) {\n      const nextField = nextNode.getLocation() as Field;\n      nextField.showEditor();\n\n      // Also move the cursor if we're in keyboard nav mode.\n      if (this.workspace.keyboardAccessibilityMode) {\n        this.workspace.getCursor()!.setCurNode(nextNode);\n      }\n    }\n  }\n\n  /**\n   * Handle a pointerdown on an SVG block.\n   *\n   * @param e Pointer down event.\n   */\n  private onMouseDown_(e: PointerEvent) {\n    const gesture = this.workspace.getGesture(e);\n    if (gesture) {\n      gesture.handleBlockStart(e, this);\n    }\n  }\n\n  /**\n   * Load the block's help page in a new window.\n   *\n   * @internal\n   */\n  showHelp() {\n    const url =\n        typeof this.helpUrl === 'function' ? this.helpUrl() : this.helpUrl;\n    if (url) {\n      window.open(url);\n    }\n  }\n\n  /**\n   * Generate the context menu for this block.\n   *\n   * @returns Context menu options or null if no menu.\n   */\n  protected generateContextMenu():\n      Array<ContextMenuOption|LegacyContextMenuOption>|null {\n    if (this.workspace.options.readOnly || !this.contextMenu) {\n      return null;\n    }\n    // AnyDuringMigration because:  Argument of type '{ block: this; }' is not\n    // assignable to parameter of type 'Scope'.\n    const menuOptions = ContextMenuRegistry.registry.getContextMenuOptions(\n        ContextMenuRegistry.ScopeType.BLOCK,\n        {block: this} as AnyDuringMigration);\n\n    // Allow the block to add or modify menuOptions.\n    if (this.customContextMenu) {\n      this.customContextMenu(menuOptions);\n    }\n\n    return menuOptions;\n  }\n\n  /**\n   * Show the context menu for this block.\n   *\n   * @param e Mouse event.\n   * @internal\n   */\n  showContextMenu(e: Event) {\n    const menuOptions = this.generateContextMenu();\n\n    if (menuOptions && menuOptions.length) {\n      ContextMenu.show(e, menuOptions, this.RTL);\n      ContextMenu.setCurrentBlock(this);\n    }\n  }\n\n  /**\n   * Move the connections for this block and all blocks attached under it.\n   * Also update any attached bubbles.\n   *\n   * @param dx Horizontal offset from current location, in workspace units.\n   * @param dy Vertical offset from current location, in workspace units.\n   * @internal\n   */\n  moveConnections(dx: number, dy: number) {\n    if (!this.rendered) {\n      // Rendering is required to lay out the blocks.\n      // This is probably an invisible block attached to a collapsed block.\n      return;\n    }\n    const myConnections = this.getConnections_(false);\n    for (let i = 0; i < myConnections.length; i++) {\n      myConnections[i].moveBy(dx, dy);\n    }\n    const icons = this.getIcons();\n    for (let i = 0; i < icons.length; i++) {\n      icons[i].computeIconLocation();\n    }\n\n    // Recurse through all blocks attached under this one.\n    for (let i = 0; i < this.childBlocks_.length; i++) {\n      (this.childBlocks_[i] as BlockSvg).moveConnections(dx, dy);\n    }\n  }\n\n  /**\n   * Recursively adds or removes the dragging class to this node and its\n   * children.\n   *\n   * @param adding True if adding, false if removing.\n   * @internal\n   */\n  setDragging(adding: boolean) {\n    if (adding) {\n      const group = this.getSvgRoot();\n      (group as AnyDuringMigration).translate_ = '';\n      (group as AnyDuringMigration).skew_ = '';\n      common.draggingConnections.push(...this.getConnections_(true));\n      dom.addClass(this.svgGroup_, 'blocklyDragging');\n    } else {\n      common.draggingConnections.length = 0;\n      dom.removeClass(this.svgGroup_, 'blocklyDragging');\n    }\n    // Recurse through all blocks attached under this one.\n    for (let i = 0; i < this.childBlocks_.length; i++) {\n      (this.childBlocks_[i] as BlockSvg).setDragging(adding);\n    }\n  }\n\n  /**\n   * Set whether this block is movable or not.\n   *\n   * @param movable True if movable.\n   */\n  override setMovable(movable: boolean) {\n    super.setMovable(movable);\n    this.pathObject.updateMovable(movable);\n  }\n\n  /**\n   * Set whether this block is editable or not.\n   *\n   * @param editable True if editable.\n   */\n  override setEditable(editable: boolean) {\n    super.setEditable(editable);\n    const icons = this.getIcons();\n    for (let i = 0; i < icons.length; i++) {\n      icons[i].updateEditable();\n    }\n  }\n\n  /**\n   * Sets whether this block is a shadow block or not.\n   *\n   * @param shadow True if a shadow.\n   * @internal\n   */\n  override setShadow(shadow: boolean) {\n    super.setShadow(shadow);\n    this.applyColour();\n  }\n\n  /**\n   * Set whether this block is an insertion marker block or not.\n   * Once set this cannot be unset.\n   *\n   * @param insertionMarker True if an insertion marker.\n   * @internal\n   */\n  override setInsertionMarker(insertionMarker: boolean) {\n    if (this.isInsertionMarker_ === insertionMarker) {\n      return;  // No change.\n    }\n    this.isInsertionMarker_ = insertionMarker;\n    if (this.isInsertionMarker_) {\n      this.setColour(\n          this.workspace.getRenderer().getConstants().INSERTION_MARKER_COLOUR);\n      this.pathObject.updateInsertionMarker(true);\n    }\n  }\n\n  /**\n   * Return the root node of the SVG or null if none exists.\n   *\n   * @returns The root SVG node (probably a group).\n   */\n  getSvgRoot(): SVGGElement {\n    return this.svgGroup_;\n  }\n\n  /**\n   * Dispose of this block.\n   *\n   * @param healStack If true, then try to heal any gap by connecting the next\n   *     statement with the previous statement.  Otherwise, dispose of all\n   *     children of this block.\n   * @param animate If true, show a disposal animation and sound.\n   * @suppress {checkTypes}\n   */\n  override dispose(healStack?: boolean, animate?: boolean) {\n    if (this.isDeadOrDying()) {\n      return;\n    }\n    Tooltip.dispose();\n    Tooltip.unbindMouseEvents(this.pathObject.svgPath);\n    dom.startTextWidthCache();\n    // Save the block's workspace temporarily so we can resize the\n    // contents once the block is disposed.\n    const blockWorkspace = this.workspace;\n    // If this block is being dragged, unlink the mouse events.\n    if (common.getSelected() === this) {\n      this.unselect();\n      this.workspace.cancelCurrentGesture();\n    }\n    // If this block has a context menu open, close it.\n    if (ContextMenu.getCurrentBlock() === this) {\n      ContextMenu.hide();\n    }\n\n    if (animate && this.rendered) {\n      this.unplug(healStack);\n      blockAnimations.disposeUiEffect(this);\n    }\n    // Stop rerendering.\n    this.rendered = false;\n\n    // Clear pending warnings.\n    for (const n of this.warningTextDb.values()) {\n      clearTimeout(n);\n    }\n    this.warningTextDb.clear();\n\n    const icons = this.getIcons();\n    for (let i = 0; i < icons.length; i++) {\n      icons[i].dispose();\n    }\n\n    // Just deleting this block from the DOM would result in a memory leak as\n    // well as corruption of the connection database.  Therefore we must\n    // methodically step through the blocks and carefully disassemble them.\n    if (common.getSelected() === this) {\n      common.setSelected(null);\n    }\n\n    super.dispose(!!healStack);\n\n    dom.removeNode(this.svgGroup_);\n    blockWorkspace.resizeContents();\n    // Sever JavaScript to DOM connections.\n    // AnyDuringMigration because:  Type 'null' is not assignable to type\n    // 'SVGGElement'.\n    this.svgGroup_ = null as AnyDuringMigration;\n    dom.stopTextWidthCache();\n  }\n\n  /**\n   * Delete a block and hide chaff when doing so. The block will not be deleted\n   * if it's in a flyout. This is called from the context menu and keyboard\n   * shortcuts as the full delete action. If you are disposing of a block from\n   * the workspace and don't need to perform flyout checks, handle event\n   * grouping, or hide chaff, then use `block.dispose()` directly.\n   */\n  checkAndDelete() {\n    if (this.workspace.isFlyout) {\n      return;\n    }\n    eventUtils.setGroup(true);\n    this.workspace.hideChaff();\n    if (this.outputConnection) {\n      // Do not attempt to heal rows\n      // (https://github.com/google/blockly/issues/4832)\n      this.dispose(false, true);\n    } else {\n      this.dispose(/* heal */\n                   true, true);\n    }\n    eventUtils.setGroup(false);\n  }\n\n  /**\n   * Encode a block for copying.\n   *\n   * @returns Copy metadata, or null if the block is an insertion marker.\n   * @internal\n   */\n  toCopyData(): CopyData|null {\n    if (this.isInsertionMarker_) {\n      return null;\n    }\n    return {\n      saveInfo:\n          blocks.save(this, {addCoordinates: true, addNextBlocks: false}) as\n          blocks.State,\n      source: this.workspace,\n      typeCounts: common.getBlockTypeCounts(this, true),\n    };\n  }\n\n  /**\n   * Updates the colour of the block to match the block's state.\n   *\n   * @internal\n   */\n  applyColour() {\n    this.pathObject.applyColour(this);\n\n    const icons = this.getIcons();\n    for (let i = 0; i < icons.length; i++) {\n      icons[i].applyColour();\n    }\n\n    for (let x = 0, input; input = this.inputList[x]; x++) {\n      for (let y = 0, field; field = input.fieldRow[y]; y++) {\n        field.applyColour();\n      }\n    }\n  }\n\n  /**\n   * Updates the colour of the block (and children) to match the current\n   * disabled state.\n   *\n   * @internal\n   */\n  updateDisabled() {\n    const children = (this.getChildren(false));\n    this.applyColour();\n    if (this.isCollapsed()) {\n      return;\n    }\n    for (let i = 0, child; child = children[i]; i++) {\n      if (child.rendered) {\n        child.updateDisabled();\n      }\n    }\n  }\n\n  /**\n   * Get the comment icon attached to this block, or null if the block has no\n   * comment.\n   *\n   * @returns The comment icon attached to this block, or null.\n   */\n  getCommentIcon(): Comment|null {\n    return this.commentIcon_;\n  }\n\n  /**\n   * Set this block's comment text.\n   *\n   * @param text The text, or null to delete.\n   */\n  override setCommentText(text: string|null) {\n    // AnyDuringMigration because:  Property 'get' does not exist on type\n    // '(name: string) => void'.\n    if (this.commentModel.text === text) {\n      return;\n    }\n    super.setCommentText(text);\n\n    const shouldHaveComment = text !== null;\n    if (!!this.commentIcon_ === shouldHaveComment) {\n      // If the comment's state of existence is correct, but the text is new\n      // that means we're just updating a comment.\n      this.commentIcon_!.updateText();\n      return;\n    }\n    if (shouldHaveComment) {\n      this.commentIcon_ = new Comment(this);\n      this.comment = this.commentIcon_;  // For backwards compatibility.\n    } else {\n      this.commentIcon_!.dispose();\n      this.commentIcon_ = null;\n      this.comment = null;  // For backwards compatibility.\n    }\n    if (this.rendered) {\n      this.render();\n      // Adding or removing a comment icon will cause the block to change shape.\n      this.bumpNeighbours();\n    }\n  }\n\n  /**\n   * Set this block's warning text.\n   *\n   * @param text The text, or null to delete.\n   * @param opt_id An optional ID for the warning text to be able to maintain\n   *     multiple warnings.\n   */\n  override setWarningText(text: string|null, opt_id?: string) {\n    const id = opt_id || '';\n    if (!id) {\n      // Kill all previous pending processes, this edit supersedes them all.\n      for (const timeout of this.warningTextDb.values()) {\n        clearTimeout(timeout);\n      }\n      this.warningTextDb.clear();\n    } else if (this.warningTextDb.has(id)) {\n      // Only queue up the latest change.  Kill any earlier pending process.\n      clearTimeout(this.warningTextDb.get(id)!);\n      this.warningTextDb.delete(id);\n    }\n    if (this.workspace.isDragging()) {\n      // Don't change the warning text during a drag.\n      // Wait until the drag finishes.\n      this.warningTextDb.set(id, setTimeout(() => {\n                               if (!this.isDeadOrDying()) {\n                                 this.warningTextDb.delete(id);\n                                 this.setWarningText(text, id);\n                               }\n                             }, 100));\n      return;\n    }\n    if (this.isInFlyout) {\n      text = null;\n    }\n\n    let changedState = false;\n    if (typeof text === 'string') {\n      // Bubble up to add a warning on top-most collapsed block.\n      let parent = this.getSurroundParent();\n      let collapsedParent = null;\n      while (parent) {\n        if (parent.isCollapsed()) {\n          collapsedParent = parent;\n        }\n        parent = parent.getSurroundParent();\n      }\n      if (collapsedParent) {\n        collapsedParent.setWarningText(\n            Msg['COLLAPSED_WARNINGS_WARNING'], BlockSvg.COLLAPSED_WARNING_ID);\n      }\n\n      if (!this.warning) {\n        this.warning = new Warning(this);\n        changedState = true;\n      }\n      this.warning!.setText((text), id);\n    } else {\n      // Dispose all warnings if no ID is given.\n      if (this.warning && !id) {\n        this.warning.dispose();\n        changedState = true;\n      } else if (this.warning) {\n        const oldText = this.warning.getText();\n        this.warning.setText('', id);\n        const newText = this.warning.getText();\n        if (!newText) {\n          this.warning.dispose();\n        }\n        changedState = oldText !== newText;\n      }\n    }\n    if (changedState && this.rendered) {\n      this.render();\n      // Adding or removing a warning icon will cause the block to change shape.\n      this.bumpNeighbours();\n    }\n  }\n\n  /**\n   * Give this block a mutator dialog.\n   *\n   * @param mutator A mutator dialog instance or null to remove.\n   */\n  override setMutator(mutator: Mutator|null) {\n    if (this.mutator && this.mutator !== mutator) {\n      this.mutator.dispose();\n    }\n    if (mutator) {\n      mutator.setBlock(this);\n      this.mutator = mutator;\n      mutator.createIcon();\n    }\n    if (this.rendered) {\n      this.render();\n      // Adding or removing a mutator icon will cause the block to change shape.\n      this.bumpNeighbours();\n    }\n  }\n\n  /**\n   * Set whether the block is enabled or not.\n   *\n   * @param enabled True if enabled.\n   */\n  override setEnabled(enabled: boolean) {\n    if (this.isEnabled() !== enabled) {\n      super.setEnabled(enabled);\n      if (this.rendered && !this.getInheritedDisabled()) {\n        this.updateDisabled();\n      }\n    }\n  }\n\n  /**\n   * Set whether the block is highlighted or not.  Block highlighting is\n   * often used to visually mark blocks currently being executed.\n   *\n   * @param highlighted True if highlighted.\n   */\n  setHighlighted(highlighted: boolean) {\n    if (!this.rendered) {\n      return;\n    }\n    this.pathObject.updateHighlighted(highlighted);\n  }\n\n  /**\n   * Adds the visual \"select\" effect to the block, but does not actually select\n   * it or fire an event.\n   *\n   * @see BlockSvg#select\n   */\n  addSelect() {\n    this.pathObject.updateSelected(true);\n  }\n\n  /**\n   * Removes the visual \"select\" effect from the block, but does not actually\n   * unselect it or fire an event.\n   *\n   * @see BlockSvg#unselect\n   */\n  removeSelect() {\n    this.pathObject.updateSelected(false);\n  }\n\n  /**\n   * Update the cursor over this block by adding or removing a class.\n   *\n   * @param enable True if the delete cursor should be shown, false otherwise.\n   * @internal\n   */\n  setDeleteStyle(enable: boolean) {\n    this.pathObject.updateDraggingDelete(enable);\n  }\n\n  // Overrides of functions on Blockly.Block that take into account whether the\n\n  // block has been rendered.\n\n  /**\n   * Get the colour of a block.\n   *\n   * @returns #RRGGBB string.\n   */\n  override getColour(): string {\n    return this.style.colourPrimary;\n  }\n\n  /**\n   * Change the colour of a block.\n   *\n   * @param colour HSV hue value, or #RRGGBB string.\n   */\n  override setColour(colour: number|string) {\n    super.setColour(colour);\n    const styleObj =\n        this.workspace.getRenderer().getConstants().getBlockStyleForColour(\n            this.colour_);\n\n    this.pathObject.setStyle(styleObj.style);\n    this.style = styleObj.style;\n    this.styleName_ = styleObj.name;\n\n    this.applyColour();\n  }\n\n  /**\n   * Set the style and colour values of a block.\n   *\n   * @param blockStyleName Name of the block style.\n   * @throws {Error} if the block style does not exist.\n   */\n  override setStyle(blockStyleName: string) {\n    const blockStyle =\n        this.workspace.getRenderer().getConstants().getBlockStyle(\n            blockStyleName);\n    this.styleName_ = blockStyleName;\n\n    if (blockStyle) {\n      this.hat = blockStyle.hat;\n      this.pathObject.setStyle(blockStyle);\n      // Set colour to match Block.\n      this.colour_ = blockStyle.colourPrimary;\n      this.style = blockStyle;\n\n      this.applyColour();\n    } else {\n      throw Error('Invalid style name: ' + blockStyleName);\n    }\n  }\n\n  /**\n   * Move this block to the front of the visible workspace.\n   * <g> tags do not respect z-index so SVG renders them in the\n   * order that they are in the DOM.  By placing this block first within the\n   * block group's <g>, it will render on top of any other blocks.\n   *\n   * @internal\n   */\n  bringToFront() {\n    /* eslint-disable-next-line @typescript-eslint/no-this-alias */\n    let block: this|null = this;\n    do {\n      const root = block.getSvgRoot();\n      const parent = root.parentNode;\n      const childNodes = parent!.childNodes;\n      // Avoid moving the block if it's already at the bottom.\n      if (childNodes[childNodes.length - 1] !== root) {\n        parent!.appendChild(root);\n      }\n      block = block.getParent();\n    } while (block);\n  }\n\n  /**\n   * Set whether this block can chain onto the bottom of another block.\n   *\n   * @param newBoolean True if there can be a previous statement.\n   * @param opt_check Statement type or list of statement types.  Null/undefined\n   *     if any type could be connected.\n   */\n  override setPreviousStatement(\n      newBoolean: boolean, opt_check?: string|string[]|null) {\n    super.setPreviousStatement(newBoolean, opt_check);\n\n    if (this.rendered) {\n      this.render();\n      this.bumpNeighbours();\n    }\n  }\n\n  /**\n   * Set whether another block can chain onto the bottom of this block.\n   *\n   * @param newBoolean True if there can be a next statement.\n   * @param opt_check Statement type or list of statement types.  Null/undefined\n   *     if any type could be connected.\n   */\n  override setNextStatement(\n      newBoolean: boolean, opt_check?: string|string[]|null) {\n    super.setNextStatement(newBoolean, opt_check);\n\n    if (this.rendered) {\n      this.render();\n      this.bumpNeighbours();\n    }\n  }\n\n  /**\n   * Set whether this block returns a value.\n   *\n   * @param newBoolean True if there is an output.\n   * @param opt_check Returned type or list of returned types.  Null or\n   *     undefined if any type could be returned (e.g. variable get).\n   */\n  override setOutput(newBoolean: boolean, opt_check?: string|string[]|null) {\n    super.setOutput(newBoolean, opt_check);\n\n    if (this.rendered) {\n      this.render();\n      this.bumpNeighbours();\n    }\n  }\n\n  /**\n   * Set whether value inputs are arranged horizontally or vertically.\n   *\n   * @param newBoolean True if inputs are horizontal.\n   */\n  override setInputsInline(newBoolean: boolean) {\n    super.setInputsInline(newBoolean);\n\n    if (this.rendered) {\n      this.render();\n      this.bumpNeighbours();\n    }\n  }\n\n  /**\n   * Remove an input from this block.\n   *\n   * @param name The name of the input.\n   * @param opt_quiet True to prevent error if input is not present.\n   * @returns True if operation succeeds, false if input is not present and\n   *     opt_quiet is true\n   * @throws {Error} if the input is not present and opt_quiet is not true.\n   */\n  override removeInput(name: string, opt_quiet?: boolean): boolean {\n    const removed = super.removeInput(name, opt_quiet);\n\n    if (this.rendered) {\n      this.render();\n      // Removing an input will cause the block to change shape.\n      this.bumpNeighbours();\n    }\n\n    return removed;\n  }\n\n  /**\n   * Move a numbered input to a different location on this block.\n   *\n   * @param inputIndex Index of the input to move.\n   * @param refIndex Index of input that should be after the moved input.\n   */\n  override moveNumberedInputBefore(inputIndex: number, refIndex: number) {\n    super.moveNumberedInputBefore(inputIndex, refIndex);\n\n    if (this.rendered) {\n      this.render();\n      // Moving an input will cause the block to change shape.\n      this.bumpNeighbours();\n    }\n  }\n\n  /**\n   * Add a value input, statement input or local variable to this block.\n   *\n   * @param type One of Blockly.inputTypes.\n   * @param name Language-neutral identifier which may used to find this input\n   *     again.  Should be unique to this block.\n   * @returns The input object created.\n   */\n  protected override appendInput_(type: number, name: string): Input {\n    const input = super.appendInput_(type, name);\n\n    if (this.rendered) {\n      this.render();\n      // Adding an input will cause the block to change shape.\n      this.bumpNeighbours();\n    }\n    return input;\n  }\n\n  /**\n   * Sets whether this block's connections are tracked in the database or not.\n   *\n   * Used by the deserializer to be more efficient. Setting a connection's\n   * tracked_ value to false keeps it from adding itself to the db when it\n   * gets its first moveTo call, saving expensive ops for later.\n   *\n   * @param track If true, start tracking. If false, stop tracking.\n   * @internal\n   */\n  setConnectionTracking(track: boolean) {\n    if (this.previousConnection) {\n      (this.previousConnection).setTracking(track);\n    }\n    if (this.outputConnection) {\n      (this.outputConnection).setTracking(track);\n    }\n    if (this.nextConnection) {\n      (this.nextConnection).setTracking(track);\n      const child = (this.nextConnection).targetBlock();\n      if (child) {\n        child.setConnectionTracking(track);\n      }\n    }\n\n    if (this.collapsed_) {\n      // When track is true, we don't want to start tracking collapsed\n      // connections. When track is false, we're already not tracking\n      // collapsed connections, so no need to update.\n      return;\n    }\n\n    for (let i = 0; i < this.inputList.length; i++) {\n      const conn = this.inputList[i].connection as RenderedConnection;\n      if (conn) {\n        conn.setTracking(track);\n\n        // Pass tracking on down the chain.\n        const block = conn.targetBlock();\n        if (block) {\n          block.setConnectionTracking(track);\n        }\n      }\n    }\n  }\n\n  /**\n   * Returns connections originating from this block.\n   *\n   * @param all If true, return all connections even hidden ones.\n   *     Otherwise, for a non-rendered block return an empty list, and for a\n   * collapsed block don't return inputs connections.\n   * @returns Array of connections.\n   * @internal\n   */\n  override getConnections_(all: boolean): RenderedConnection[] {\n    const myConnections = [];\n    if (all || this.rendered) {\n      if (this.outputConnection) {\n        myConnections.push(this.outputConnection);\n      }\n      if (this.previousConnection) {\n        myConnections.push(this.previousConnection);\n      }\n      if (this.nextConnection) {\n        myConnections.push(this.nextConnection);\n      }\n      if (all || !this.collapsed_) {\n        for (let i = 0, input; input = this.inputList[i]; i++) {\n          if (input.connection) {\n            myConnections.push(input.connection as RenderedConnection);\n          }\n        }\n      }\n    }\n    return myConnections;\n  }\n\n  /**\n   * Walks down a stack of blocks and finds the last next connection on the\n   * stack.\n   *\n   * @param ignoreShadows If true,the last connection on a non-shadow block will\n   *     be returned. If false, this will follow shadows to find the last\n   *     connection.\n   * @returns The last next connection on the stack, or null.\n   * @internal\n   */\n  override lastConnectionInStack(ignoreShadows: boolean): RenderedConnection\n      |null {\n    return super.lastConnectionInStack(ignoreShadows) as RenderedConnection;\n  }\n\n  /**\n   * Find the connection on this block that corresponds to the given connection\n   * on the other block.\n   * Used to match connections between a block and its insertion marker.\n   *\n   * @param otherBlock The other block to match against.\n   * @param conn The other connection to match.\n   * @returns The matching connection on this block, or null.\n   * @internal\n   */\n  override getMatchingConnection(otherBlock: Block, conn: Connection):\n      RenderedConnection|null {\n    return super.getMatchingConnection(otherBlock, conn) as RenderedConnection;\n  }\n\n  /**\n   * Create a connection of the specified type.\n   *\n   * @param type The type of the connection to create.\n   * @returns A new connection of the specified type.\n   */\n  protected override makeConnection_(type: number): RenderedConnection {\n    return new RenderedConnection(this, type);\n  }\n\n  /**\n   * Return the next statement block directly connected to this block.\n   *\n   * @returns The next statement block or null.\n   */\n  override getNextBlock(): BlockSvg|null {\n    return super.getNextBlock() as BlockSvg;\n  }\n\n  /**\n   * Returns the block connected to the previous connection.\n   *\n   * @returns The previous statement block or null.\n   */\n  override getPreviousBlock(): BlockSvg|null {\n    return super.getPreviousBlock() as BlockSvg;\n  }\n\n  /**\n   * Bumps unconnected blocks out of alignment.\n   *\n   * Two blocks which aren't actually connected should not coincidentally line\n   * up on screen, because that creates confusion for end-users.\n   */\n  override bumpNeighbours() {\n    this.getRootBlock().bumpNeighboursInternal();\n  }\n\n  /**\n   * Bumps unconnected blocks out of alignment.\n   */\n  private bumpNeighboursInternal() {\n    const root = this.getRootBlock();\n    if (this.isDeadOrDying() || this.workspace.isDragging() ||\n        root.isInFlyout) {\n      return;\n    }\n\n    function neighbourIsInStack(neighbour: RenderedConnection) {\n      return neighbour.getSourceBlock().getRootBlock() === root;\n    }\n\n    for (const conn of this.getConnections_(false)) {\n      if (conn.isSuperior()) {\n        // Recurse down the block stack.\n        conn.targetBlock()?.bumpNeighboursInternal();\n      }\n\n      for (const neighbour of conn.neighbours(config.snapRadius)) {\n        // Don't bump away from things that are in our stack.\n        if (neighbourIsInStack(neighbour)) continue;\n        // If both connections are connected, that's fine.\n        if (conn.isConnected() && neighbour.isConnected()) continue;\n\n        // Always bump the inferior connection.\n        if (conn.isSuperior()) {\n          neighbour.bumpAwayFrom(conn);\n        } else {\n          conn.bumpAwayFrom(neighbour);\n        }\n      }\n    }\n  }\n\n  /**\n   * Schedule snapping to grid and bumping neighbours to occur after a brief\n   * delay.\n   *\n   * @internal\n   */\n  scheduleSnapAndBump() {\n    // Ensure that any snap and bump are part of this move's event group.\n    const group = eventUtils.getGroup();\n\n    setTimeout(() => {\n      eventUtils.setGroup(group);\n      this.snapToGrid();\n      eventUtils.setGroup(false);\n    }, config.bumpDelay / 2);\n\n    setTimeout(() => {\n      eventUtils.setGroup(group);\n      this.bumpNeighbours();\n      eventUtils.setGroup(false);\n    }, config.bumpDelay);\n  }\n\n  /**\n   * Position a block so that it doesn't move the target block when connected.\n   * The block to position is usually either the first block in a dragged stack\n   * or an insertion marker.\n   *\n   * @param sourceConnection The connection on the moving block's stack.\n   * @param targetConnection The connection that should stay stationary as this\n   *     block is positioned.\n   * @internal\n   */\n  positionNearConnection(\n      sourceConnection: RenderedConnection,\n      targetConnection: RenderedConnection) {\n    // We only need to position the new block if it's before the existing one,\n    // otherwise its position is set by the previous block.\n    if (sourceConnection.type === ConnectionType.NEXT_STATEMENT ||\n        sourceConnection.type === ConnectionType.INPUT_VALUE) {\n      const dx = targetConnection.x - sourceConnection.x;\n      const dy = targetConnection.y - sourceConnection.y;\n\n      this.moveBy(dx, dy);\n    }\n  }\n\n  /**\n   * @returns The first statement connection or null.\n   * @internal\n   */\n  override getFirstStatementConnection(): RenderedConnection|null {\n    return super.getFirstStatementConnection() as RenderedConnection | null;\n  }\n\n  /**\n   * Find all the blocks that are directly nested inside this one.\n   * Includes value and statement inputs, as well as any following statement.\n   * Excludes any connection on an output tab or any preceding statement.\n   * Blocks are optionally sorted by position; top to bottom.\n   *\n   * @param ordered Sort the list if true.\n   * @returns Array of blocks.\n   */\n  override getChildren(ordered: boolean): BlockSvg[] {\n    return super.getChildren(ordered) as BlockSvg[];\n  }\n\n  /**\n   * Lays out and reflows a block based on its contents and settings.\n   *\n   * @param opt_bubble If false, just render this block.\n   *   If true, also render block's parent, grandparent, etc.  Defaults to true.\n   */\n  render(opt_bubble?: boolean) {\n    if (this.renderIsInProgress_) {\n      return;  // Don't allow recursive renders.\n    }\n    this.renderIsInProgress_ = true;\n    try {\n      this.rendered = true;\n      dom.startTextWidthCache();\n\n      if (this.isCollapsed()) {\n        this.updateCollapsed_();\n      }\n      this.workspace.getRenderer().render(this);\n      this.updateConnectionLocations_();\n\n      if (opt_bubble !== false) {\n        const parentBlock = this.getParent();\n        if (parentBlock) {\n          parentBlock.render(true);\n        } else {\n          // Top-most block. Fire an event to allow scrollbars to resize.\n          this.workspace.resizeContents();\n        }\n      }\n\n      dom.stopTextWidthCache();\n      this.updateMarkers_();\n    } finally {\n      this.renderIsInProgress_ = false;\n    }\n  }\n\n  /** Redraw any attached marker or cursor svgs if needed. */\n  protected updateMarkers_() {\n    if (this.workspace.keyboardAccessibilityMode && this.pathObject.cursorSvg) {\n      this.workspace.getCursor()!.draw();\n    }\n    if (this.workspace.keyboardAccessibilityMode && this.pathObject.markerSvg) {\n      // TODO(#4592): Update all markers on the block.\n      this.workspace.getMarker(MarkerManager.LOCAL_MARKER)!.draw();\n    }\n  }\n\n  /**\n   * Update all of the connections on this block with the new locations\n   * calculated during rendering.  Also move all of the connected blocks based\n   * on the new connection locations.\n   */\n  private updateConnectionLocations_() {\n    const blockTL = this.getRelativeToSurfaceXY();\n    // Don't tighten previous or output connections because they are inferior\n    // connections.\n    if (this.previousConnection) {\n      this.previousConnection.moveToOffset(blockTL);\n    }\n    if (this.outputConnection) {\n      this.outputConnection.moveToOffset(blockTL);\n    }\n\n    for (let i = 0; i < this.inputList.length; i++) {\n      const conn = this.inputList[i].connection as RenderedConnection;\n      if (conn) {\n        conn.moveToOffset(blockTL);\n        if (conn.isConnected()) {\n          conn.tighten();\n        }\n      }\n    }\n\n    if (this.nextConnection) {\n      this.nextConnection.moveToOffset(blockTL);\n      if (this.nextConnection.isConnected()) {\n        this.nextConnection.tighten();\n      }\n    }\n  }\n\n  /**\n   * Add the cursor SVG to this block's SVG group.\n   *\n   * @param cursorSvg The SVG root of the cursor to be added to the block SVG\n   *     group.\n   * @internal\n   */\n  setCursorSvg(cursorSvg: SVGElement) {\n    this.pathObject.setCursorSvg(cursorSvg);\n  }\n\n  /**\n   * Add the marker SVG to this block's SVG group.\n   *\n   * @param markerSvg The SVG root of the marker to be added to the block SVG\n   *     group.\n   * @internal\n   */\n  setMarkerSvg(markerSvg: SVGElement) {\n    this.pathObject.setMarkerSvg(markerSvg);\n  }\n\n  /**\n   * Returns a bounding box describing the dimensions of this block\n   * and any blocks stacked below it.\n   *\n   * @returns Object with height and width properties in workspace units.\n   * @internal\n   */\n  getHeightWidth(): {height: number, width: number} {\n    let height = this.height;\n    let width = this.width;\n    // Recursively add size of subsequent blocks.\n    const nextBlock = this.getNextBlock();\n    if (nextBlock) {\n      const nextHeightWidth = nextBlock.getHeightWidth();\n      const tabHeight =\n          this.workspace.getRenderer().getConstants().NOTCH_HEIGHT;\n      height += nextHeightWidth.height - tabHeight;\n      width = Math.max(width, nextHeightWidth.width);\n    }\n    return {height, width};\n  }\n\n  /**\n   * Visual effect to show that if the dragging block is dropped, this block\n   * will be replaced.  If a shadow block, it will disappear.  Otherwise it will\n   * bump.\n   *\n   * @param add True if highlighting should be added.\n   * @internal\n   */\n  fadeForReplacement(add: boolean) {\n    this.pathObject.updateReplacementFade(add);\n  }\n\n  /**\n   * Visual effect to show that if the dragging block is dropped it will connect\n   * to this input.\n   *\n   * @param conn The connection on the input to highlight.\n   * @param add True if highlighting should be added.\n   * @internal\n   */\n  highlightShapeForInput(conn: RenderedConnection, add: boolean) {\n    this.pathObject.updateShapeForInputHighlight(conn, add);\n  }\n}\n","/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The abstract class for a component with custom behaviour when a\n * block or bubble is dragged over or dropped on top of it.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.DragTarget');\n\nimport type {IDragTarget} from './interfaces/i_drag_target.js';\nimport type {IDraggable} from './interfaces/i_draggable.js';\nimport type {Rect} from './utils/rect.js';\n\n\n/**\n * Abstract class for a component with custom behaviour when a block or bubble\n * is dragged over or dropped on top of it.\n *\n * @alias Blockly.DragTarget\n */\nexport class DragTarget implements IDragTarget {\n  /**\n   * The unique id for this component that is used to register with the\n   * ComponentManager.\n   */\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  id!: string;\n\n  /**\n   * Constructor for DragTarget. It exists to add the id property and should not\n   * be called directly, only by a subclass.\n   */\n  constructor() {}\n\n  /**\n   * Handles when a cursor with a block or bubble enters this drag target.\n   *\n   * @param _dragElement The block or bubble currently being dragged.\n   */\n  onDragEnter(_dragElement: IDraggable) {}\n  // no-op\n\n  /**\n   * Handles when a cursor with a block or bubble is dragged over this drag\n   * target.\n   *\n   * @param _dragElement The block or bubble currently being dragged.\n   */\n  onDragOver(_dragElement: IDraggable) {}\n  // no-op\n\n  /**\n   * Handles when a cursor with a block or bubble exits this drag target.\n   *\n   * @param _dragElement The block or bubble currently being dragged.\n   */\n  onDragExit(_dragElement: IDraggable) {}\n  // no-op\n  /**\n   * Handles when a block or bubble is dropped on this component.\n   * Should not handle delete here.\n   *\n   * @param _dragElement The block or bubble currently being dragged.\n   */\n  onDrop(_dragElement: IDraggable) {}\n  // no-op\n\n  /**\n   * Returns the bounding rectangle of the drag target area in pixel units\n   * relative to the Blockly injection div.\n   *\n   * @returns The component's bounding box. Null if drag target area should be\n   *     ignored.\n   */\n  getClientRect(): Rect|null {\n    return null;\n  }\n\n  /**\n   * Returns whether the provided block or bubble should not be moved after\n   * being dropped on this component. If true, the element will return to where\n   * it was when the drag started.\n   *\n   * @param _dragElement The block or bubble currently being dragged.\n   * @returns Whether the block or bubble provided should be returned to drag\n   *     start.\n   */\n  shouldPreventMove(_dragElement: IDraggable): boolean {\n    return false;\n  }\n}\n","/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The abstract class for a component that can delete a block or\n * bubble that is dropped on top of it.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.DeleteArea');\n\nimport {BlockSvg} from './block_svg.js';\nimport {DragTarget} from './drag_target.js';\nimport type {IDeleteArea} from './interfaces/i_delete_area.js';\nimport type {IDraggable} from './interfaces/i_draggable.js';\n\n\n/**\n * Abstract class for a component that can delete a block or bubble that is\n * dropped on top of it.\n *\n * @alias Blockly.DeleteArea\n */\nexport class DeleteArea extends DragTarget implements IDeleteArea {\n  /**\n   * Whether the last block or bubble dragged over this delete area would be\n   * deleted if dropped on this component.\n   * This property is not updated after the block or bubble is deleted.\n   */\n  protected wouldDelete_ = false;\n\n  /**\n   * The unique id for this component that is used to register with the\n   * ComponentManager.\n   */\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  override id!: string;\n\n  /**\n   * Constructor for DeleteArea. Should not be called directly, only by a\n   * subclass.\n   */\n  constructor() {\n    super();\n  }\n\n  /**\n   * Returns whether the provided block or bubble would be deleted if dropped on\n   * this area.\n   * This method should check if the element is deletable and is always called\n   * before onDragEnter/onDragOver/onDragExit.\n   *\n   * @param element The block or bubble currently being dragged.\n   * @param couldConnect Whether the element could could connect to another.\n   * @returns Whether the element provided would be deleted if dropped on this\n   *     area.\n   */\n  wouldDelete(element: IDraggable, couldConnect: boolean): boolean {\n    if (element instanceof BlockSvg) {\n      const block = (element);\n      const couldDeleteBlock = !block.getParent() && block.isDeletable();\n      this.updateWouldDelete_(couldDeleteBlock && !couldConnect);\n    } else {\n      this.updateWouldDelete_(element.isDeletable());\n    }\n    return this.wouldDelete_;\n  }\n\n  /**\n   * Updates the internal wouldDelete_ state.\n   *\n   * @param wouldDelete The new value for the wouldDelete state.\n   */\n  protected updateWouldDelete_(wouldDelete: boolean) {\n    this.wouldDelete_ = wouldDelete;\n  }\n}\n","/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Contains the path to a single png tat holds the images for the trashcan\n * as well as the zoom controls.\n *\n * @alias Blockly.sprite.SPRITE\n */\nexport const SPRITE = {\n  width: 96,\n  height: 124,\n  url: 'sprites.png',\n};\n","/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing a trash can icon.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Trashcan');\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_trashcan_open.js';\n\nimport type {BlocklyOptions} from './blockly_options.js';\nimport * as browserEvents from './browser_events.js';\nimport {ComponentManager} from './component_manager.js';\nimport {DeleteArea} from './delete_area.js';\nimport type {Abstract} from './events/events_abstract.js';\nimport type {BlockDelete} from './events/events_block_delete.js';\nimport * as eventUtils from './events/utils.js';\nimport type {IAutoHideable} from './interfaces/i_autohideable.js';\nimport type {IDraggable} from './interfaces/i_draggable.js';\nimport type {IFlyout} from './interfaces/i_flyout.js';\nimport type {IPositionable} from './interfaces/i_positionable.js';\nimport type {UiMetrics} from './metrics_manager.js';\nimport {Options} from './options.js';\nimport * as uiPosition from './positionable_helpers.js';\nimport * as registry from './registry.js';\nimport type * as blocks from './serialization/blocks.js';\nimport {SPRITE} from './sprites.js';\nimport * as dom from './utils/dom.js';\nimport {Rect} from './utils/rect.js';\nimport {Size} from './utils/size.js';\nimport {Svg} from './utils/svg.js';\nimport {BlockInfo} from './utils/toolbox.js';\nimport * as toolbox from './utils/toolbox.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/**\n * Class for a trash can.\n *\n * @alias Blockly.Trashcan\n */\nexport class Trashcan extends DeleteArea implements IAutoHideable,\n                                                    IPositionable {\n  /**\n   * The unique id for this component that is used to register with the\n   * ComponentManager.\n   */\n  override id = 'trashcan';\n\n  /**\n   * A list of JSON (stored as strings) representing blocks in the trashcan.\n   */\n  private readonly contents_: string[] = [];\n\n  /**\n   * The trashcan flyout.\n   *\n   * @internal\n   */\n  flyout: IFlyout|null = null;\n\n  /** Current open/close state of the lid. */\n  isLidOpen = false;\n\n  /**\n   * The minimum openness of the lid. Used to indicate if the trashcan\n   * contains blocks.\n   */\n  private minOpenness_ = 0;\n\n  /** The SVG group containing the trash can. */\n  private svgGroup_: SVGElement|null = null;\n\n  /** The SVG image element of the trash can lid. */\n  private svgLid_: SVGElement|null = null;\n\n  /** Task ID of opening/closing animation. */\n  private lidTask_: ReturnType<typeof setTimeout>|null = null;\n\n  /** Current state of lid opening (0.0 = closed, 1.0 = open). */\n  private lidOpen_ = 0;\n\n  /** Left coordinate of the trash can. */\n  private left_ = 0;\n\n  /** Top coordinate of the trash can. */\n  private top_ = 0;\n\n  /** Whether this trash can has been initialized. */\n  private initialized_ = false;\n\n  /** @param workspace The workspace to sit in. */\n  constructor(private workspace: WorkspaceSvg) {\n    super();\n\n    if (this.workspace.options.maxTrashcanContents <= 0) {\n      return;\n    }\n\n    // Create flyout options.\n    const flyoutWorkspaceOptions = new Options(({\n      'scrollbars': true,\n      'parentWorkspace': this.workspace,\n      'rtl': this.workspace.RTL,\n      'oneBasedIndex': this.workspace.options.oneBasedIndex,\n      'renderer': this.workspace.options.renderer,\n      'rendererOverrides': this.workspace.options.rendererOverrides,\n      'move': {\n        'scrollbars': true,\n      },\n    } as BlocklyOptions));\n    // Create vertical or horizontal flyout.\n    if (this.workspace.horizontalLayout) {\n      flyoutWorkspaceOptions.toolboxPosition =\n          this.workspace.toolboxPosition === toolbox.Position.TOP ?\n          toolbox.Position.BOTTOM :\n          toolbox.Position.TOP;\n      const HorizontalFlyout = registry.getClassFromOptions(\n          registry.Type.FLYOUTS_HORIZONTAL_TOOLBOX, this.workspace.options,\n          true);\n      this.flyout = new HorizontalFlyout!(flyoutWorkspaceOptions);\n    } else {\n      flyoutWorkspaceOptions.toolboxPosition =\n          this.workspace.toolboxPosition === toolbox.Position.RIGHT ?\n          toolbox.Position.LEFT :\n          toolbox.Position.RIGHT;\n      const VerticalFlyout = registry.getClassFromOptions(\n          registry.Type.FLYOUTS_VERTICAL_TOOLBOX, this.workspace.options, true);\n      this.flyout = new VerticalFlyout!(flyoutWorkspaceOptions);\n    }\n    this.workspace.addChangeListener(this.onDelete_.bind(this));\n  }\n\n  /**\n   * Create the trash can elements.\n   *\n   * @returns The trash can's SVG group.\n   */\n  createDom(): SVGElement {\n    /* Here's the markup that will be generated:\n        <g class=\"blocklyTrash\">\n          <clippath id=\"blocklyTrashBodyClipPath837493\">\n            <rect width=\"47\" height=\"45\" y=\"15\"></rect>\n          </clippath>\n          <image width=\"64\" height=\"92\" y=\"-32\" xlink:href=\"media/sprites.png\"\n              clip-path=\"url(#blocklyTrashBodyClipPath837493)\"></image>\n          <clippath id=\"blocklyTrashLidClipPath837493\">\n            <rect width=\"47\" height=\"15\"></rect>\n          </clippath>\n          <image width=\"84\" height=\"92\" y=\"-32\" xlink:href=\"media/sprites.png\"\n              clip-path=\"url(#blocklyTrashLidClipPath837493)\"></image>\n        </g>\n        */\n    this.svgGroup_ = dom.createSvgElement(Svg.G, {'class': 'blocklyTrash'});\n    let clip;\n    const rnd = String(Math.random()).substring(2);\n    clip = dom.createSvgElement(\n        Svg.CLIPPATH, {'id': 'blocklyTrashBodyClipPath' + rnd}, this.svgGroup_);\n    dom.createSvgElement(\n        Svg.RECT, {'width': WIDTH, 'height': BODY_HEIGHT, 'y': LID_HEIGHT},\n        clip);\n    const body = dom.createSvgElement(\n        Svg.IMAGE, {\n          'width': SPRITE.width,\n          'x': -SPRITE_LEFT,\n          'height': SPRITE.height,\n          'y': -SPRITE_TOP,\n          'clip-path': 'url(#blocklyTrashBodyClipPath' + rnd + ')',\n        },\n        this.svgGroup_);\n    body.setAttributeNS(\n        dom.XLINK_NS, 'xlink:href',\n        this.workspace.options.pathToMedia + SPRITE.url);\n\n    clip = dom.createSvgElement(\n        Svg.CLIPPATH, {'id': 'blocklyTrashLidClipPath' + rnd}, this.svgGroup_);\n    dom.createSvgElement(\n        Svg.RECT, {'width': WIDTH, 'height': LID_HEIGHT}, clip);\n    this.svgLid_ = dom.createSvgElement(\n        Svg.IMAGE, {\n          'width': SPRITE.width,\n          'x': -SPRITE_LEFT,\n          'height': SPRITE.height,\n          'y': -SPRITE_TOP,\n          'clip-path': 'url(#blocklyTrashLidClipPath' + rnd + ')',\n        },\n        this.svgGroup_);\n    this.svgLid_.setAttributeNS(\n        dom.XLINK_NS, 'xlink:href',\n        this.workspace.options.pathToMedia + SPRITE.url);\n\n    // bindEventWithChecks_ quashes events too aggressively. See:\n    // https://groups.google.com/forum/#!topic/blockly/QF4yB9Wx00s\n    // Using bindEventWithChecks_ for blocking mousedown causes issue in mobile.\n    // See #4303\n    browserEvents.bind(\n        this.svgGroup_, 'pointerdown', this, this.blockMouseDownWhenOpenable_);\n    browserEvents.bind(this.svgGroup_, 'pointerup', this, this.click);\n    // Bind to body instead of this.svgGroup_ so that we don't get lid jitters\n    browserEvents.bind(body, 'pointerover', this, this.mouseOver_);\n    browserEvents.bind(body, 'pointerout', this, this.mouseOut_);\n    this.animateLid_();\n    return this.svgGroup_;\n  }\n\n  /** Initializes the trash can. */\n  init() {\n    if (this.workspace.options.maxTrashcanContents > 0) {\n      dom.insertAfter(\n          this.flyout!.createDom(Svg.SVG)!, this.workspace.getParentSvg());\n      this.flyout!.init(this.workspace);\n    }\n    this.workspace.getComponentManager().addComponent({\n      component: this,\n      weight: 1,\n      capabilities: [\n        ComponentManager.Capability.AUTOHIDEABLE,\n        ComponentManager.Capability.DELETE_AREA,\n        ComponentManager.Capability.DRAG_TARGET,\n        ComponentManager.Capability.POSITIONABLE,\n      ],\n    });\n    this.initialized_ = true;\n    this.setLidOpen(false);\n  }\n\n  /**\n   * Dispose of this trash can.\n   * Unlink from all DOM elements to prevent memory leaks.\n   *\n   * @suppress {checkTypes}\n   */\n  dispose() {\n    this.workspace.getComponentManager().removeComponent('trashcan');\n    if (this.svgGroup_) {\n      dom.removeNode(this.svgGroup_);\n      this.svgGroup_ = null;\n    }\n    this.svgLid_ = null;\n    if (this.lidTask_) {\n      clearTimeout(this.lidTask_);\n    }\n  }\n\n  /**\n   * Whether the trashcan has contents.\n   *\n   * @returns True if the trashcan has contents.\n   */\n  private hasContents_(): boolean {\n    return !!this.contents_.length;\n  }\n\n  /**\n   * Returns true if the trashcan contents-flyout is currently open.\n   *\n   * @returns True if the trashcan contents-flyout is currently open.\n   */\n  contentsIsOpen(): boolean {\n    return !!this.flyout && this.flyout.isVisible();\n  }\n\n  /** Opens the trashcan flyout. */\n  openFlyout() {\n    if (this.contentsIsOpen()) {\n      return;\n    }\n    const contents = this.contents_.map(function(string) {\n      return JSON.parse(string);\n    });\n    // Trashcans with lots of blocks can take a second to render.\n    const blocklyStyle = this.workspace.getParentSvg().style;\n    blocklyStyle.cursor = 'wait';\n    setTimeout(() => {\n      this.flyout?.show(contents);\n      blocklyStyle.cursor = '';\n    }, 10);\n    this.fireUiEvent_(true);\n  }\n\n  /** Closes the trashcan flyout. */\n  closeFlyout() {\n    if (!this.contentsIsOpen()) {\n      return;\n    }\n    this.flyout?.hide();\n    this.fireUiEvent_(false);\n    this.workspace.recordDragTargets();\n  }\n\n  /**\n   * Hides the component. Called in WorkspaceSvg.hideChaff.\n   *\n   * @param onlyClosePopups Whether only popups should be closed.\n   *     Flyouts should not be closed if this is true.\n   */\n  autoHide(onlyClosePopups: boolean) {\n    // For now the trashcan flyout always autocloses because it overlays the\n    // trashcan UI (no trashcan to click to close it).\n    if (!onlyClosePopups && this.flyout) {\n      this.closeFlyout();\n    }\n  }\n\n  /**\n   * Empties the trashcan's contents. If the contents-flyout is currently open\n   * it will be closed.\n   */\n  emptyContents() {\n    if (!this.hasContents_()) {\n      return;\n    }\n    this.contents_.length = 0;\n    this.setMinOpenness_(0);\n    this.closeFlyout();\n  }\n\n  /**\n   * Positions the trashcan.\n   * It is positioned in the opposite corner to the corner the\n   * categories/toolbox starts at.\n   *\n   * @param metrics The workspace metrics.\n   * @param savedPositions List of rectangles that are already on the workspace.\n   */\n  position(metrics: UiMetrics, savedPositions: Rect[]) {\n    // Not yet initialized.\n    if (!this.initialized_) {\n      return;\n    }\n\n    const cornerPosition =\n        uiPosition.getCornerOppositeToolbox(this.workspace, metrics);\n\n    const height = BODY_HEIGHT + LID_HEIGHT;\n    const startRect = uiPosition.getStartPositionRect(\n        cornerPosition, new Size(WIDTH, height), MARGIN_HORIZONTAL,\n        MARGIN_VERTICAL, metrics, this.workspace);\n\n    const verticalPosition = cornerPosition.vertical;\n    const bumpDirection = verticalPosition === uiPosition.verticalPosition.TOP ?\n        uiPosition.bumpDirection.DOWN :\n        uiPosition.bumpDirection.UP;\n    const positionRect = uiPosition.bumpPositionRect(\n        startRect, MARGIN_VERTICAL, bumpDirection, savedPositions);\n\n    this.top_ = positionRect.top;\n    this.left_ = positionRect.left;\n    this.svgGroup_?.setAttribute(\n        'transform', 'translate(' + this.left_ + ',' + this.top_ + ')');\n  }\n\n  /**\n   * Returns the bounding rectangle of the UI element in pixel units relative to\n   * the Blockly injection div.\n   *\n   * @returns The UI elements's bounding box. Null if bounding box should be\n   *     ignored by other UI elements.\n   */\n  getBoundingRectangle(): Rect|null {\n    const bottom = this.top_ + BODY_HEIGHT + LID_HEIGHT;\n    const right = this.left_ + WIDTH;\n    return new Rect(this.top_, bottom, this.left_, right);\n  }\n\n  /**\n   * Returns the bounding rectangle of the drag target area in pixel units\n   * relative to viewport.\n   *\n   * @returns The component's bounding box. Null if drag target area should be\n   *     ignored.\n   */\n  override getClientRect(): Rect|null {\n    if (!this.svgGroup_) {\n      return null;\n    }\n\n    const trashRect = this.svgGroup_.getBoundingClientRect();\n    const top = trashRect.top + SPRITE_TOP - MARGIN_HOTSPOT;\n    const bottom = top + LID_HEIGHT + BODY_HEIGHT + 2 * MARGIN_HOTSPOT;\n    const left = trashRect.left + SPRITE_LEFT - MARGIN_HOTSPOT;\n    const right = left + WIDTH + 2 * MARGIN_HOTSPOT;\n    return new Rect(top, bottom, left, right);\n  }\n\n  /**\n   * Handles when a cursor with a block or bubble is dragged over this drag\n   * target.\n   *\n   * @param _dragElement The block or bubble currently being dragged.\n   */\n  override onDragOver(_dragElement: IDraggable) {\n    this.setLidOpen(this.wouldDelete_);\n  }\n\n  /**\n   * Handles when a cursor with a block or bubble exits this drag target.\n   *\n   * @param _dragElement The block or bubble currently being dragged.\n   */\n  override onDragExit(_dragElement: IDraggable) {\n    this.setLidOpen(false);\n  }\n\n  /**\n   * Handles when a block or bubble is dropped on this component.\n   * Should not handle delete here.\n   *\n   * @param _dragElement The block or bubble currently being dragged.\n   */\n  override onDrop(_dragElement: IDraggable) {\n    setTimeout(this.setLidOpen.bind(this, false), 100);\n  }\n\n  /**\n   * Flip the lid open or shut.\n   *\n   * @param state True if open.\n   * @internal\n   */\n  setLidOpen(state: boolean) {\n    if (this.isLidOpen === state) {\n      return;\n    }\n    if (this.lidTask_) {\n      clearTimeout(this.lidTask_);\n    }\n    this.isLidOpen = state;\n    this.animateLid_();\n  }\n\n  /** Rotate the lid open or closed by one step.  Then wait and recurse. */\n  private animateLid_() {\n    const frames = ANIMATION_FRAMES;\n\n    const delta = 1 / (frames + 1);\n    this.lidOpen_ += this.isLidOpen ? delta : -delta;\n    this.lidOpen_ = Math.min(Math.max(this.lidOpen_, this.minOpenness_), 1);\n\n    this.setLidAngle_(this.lidOpen_ * MAX_LID_ANGLE);\n\n    // Linear interpolation between min and max.\n    const opacity = OPACITY_MIN + this.lidOpen_ * (OPACITY_MAX - OPACITY_MIN);\n    if (this.svgGroup_) {\n      this.svgGroup_.style.opacity = opacity.toString();\n    }\n\n    if (this.lidOpen_ > this.minOpenness_ && this.lidOpen_ < 1) {\n      this.lidTask_ =\n          setTimeout(this.animateLid_.bind(this), ANIMATION_LENGTH / frames);\n    }\n  }\n\n  /**\n   * Set the angle of the trashcan's lid.\n   *\n   * @param lidAngle The angle at which to set the lid.\n   */\n  private setLidAngle_(lidAngle: number) {\n    const openAtRight =\n        this.workspace.toolboxPosition === toolbox.Position.RIGHT ||\n        this.workspace.horizontalLayout && this.workspace.RTL;\n    this.svgLid_?.setAttribute(\n        'transform',\n        'rotate(' + (openAtRight ? -lidAngle : lidAngle) + ',' +\n            (openAtRight ? 4 : WIDTH - 4) + ',' + (LID_HEIGHT - 2) + ')');\n  }\n\n  /**\n   * Sets the minimum openness of the trashcan lid. If the lid is currently\n   * closed, this will update lid's position.\n   *\n   * @param newMin The new minimum openness of the lid. Should be between 0\n   *     and 1.\n   */\n  private setMinOpenness_(newMin: number) {\n    this.minOpenness_ = newMin;\n    if (!this.isLidOpen) {\n      this.setLidAngle_(newMin * MAX_LID_ANGLE);\n    }\n  }\n\n  /**\n   * Flip the lid shut.\n   * Called externally after a drag.\n   */\n  closeLid() {\n    this.setLidOpen(false);\n  }\n\n  /** Inspect the contents of the trash. */\n  click() {\n    if (!this.hasContents_()) {\n      return;\n    }\n    this.openFlyout();\n  }\n\n  /**\n   * Fires a UI event for trashcan flyout open or close.\n   *\n   * @param trashcanOpen Whether the flyout is opening.\n   */\n  private fireUiEvent_(trashcanOpen: boolean) {\n    const uiEvent = new (eventUtils.get(eventUtils.TRASHCAN_OPEN))(\n        trashcanOpen, this.workspace.id);\n    eventUtils.fire(uiEvent);\n  }\n\n  /**\n   * Prevents a workspace scroll and click event if the trashcan has blocks.\n   *\n   * @param e A mouse down event.\n   */\n  private blockMouseDownWhenOpenable_(e: PointerEvent) {\n    if (!this.contentsIsOpen() && this.hasContents_()) {\n      // Don't start a workspace scroll.\n      e.stopPropagation();\n    }\n  }\n\n  /**\n   * Indicate that the trashcan can be clicked (by opening it) if it has blocks.\n   */\n  private mouseOver_() {\n    if (this.hasContents_()) {\n      this.setLidOpen(true);\n    }\n  }\n\n  /**\n   * Close the lid of the trashcan if it was open (Vis. it was indicating it had\n   *    blocks).\n   */\n  private mouseOut_() {\n    // No need to do a .hasBlocks check here because if it doesn't the trashcan\n    // won't be open in the first place, and setOpen won't run.\n    this.setLidOpen(false);\n  }\n\n  /**\n   * Handle a BLOCK_DELETE event. Adds deleted blocks oldXml to the content\n   * array.\n   *\n   * @param event Workspace event.\n   */\n  private onDelete_(event: Abstract) {\n    if (this.workspace.options.maxTrashcanContents <= 0 ||\n        event.type !== eventUtils.BLOCK_DELETE) {\n      return;\n    }\n    const deleteEvent = event as BlockDelete;\n    if (event.type === eventUtils.BLOCK_DELETE && !deleteEvent.wasShadow) {\n      if (!deleteEvent.oldJson) {\n        throw new Error('Encountered a delete event without proper oldJson');\n      }\n      const cleanedJson =\n          JSON.stringify(this.cleanBlockJson_(deleteEvent.oldJson));\n      if (this.contents_.indexOf(cleanedJson) !== -1) {\n        return;\n      }\n      this.contents_.unshift(cleanedJson);\n      while (this.contents_.length >\n             this.workspace.options.maxTrashcanContents) {\n        this.contents_.pop();\n      }\n\n      this.setMinOpenness_(HAS_BLOCKS_LID_ANGLE);\n    }\n  }\n\n  /**\n   * Converts JSON representing a block into text that can be stored in the\n   * content array.\n   *\n   * @param json A JSON representation of a block's state.\n   * @returns A BlockInfo object corresponding to the JSON, cleaned of all\n   *     unnecessary attributes.\n   */\n  private cleanBlockJson_(json: blocks.State): BlockInfo {\n    // Create a deep copy.\n    json = JSON.parse(JSON.stringify(json)) as blocks.State;\n\n    /**\n     * Reshape JSON into a nicer format.\n     *\n     * @param json The JSON to clean.\n     */\n    function cleanRec(json: blocks.State) {\n      if (!json) {\n        return;\n      }\n\n      delete json['id'];\n      delete json['x'];\n      delete json['y'];\n      delete json['enabled'];\n\n      if (json['icons'] && json['icons']['comment']) {\n        const comment = json['icons']['comment'];\n        delete comment['height'];\n        delete comment['width'];\n        delete comment['pinned'];\n      }\n\n      const inputs = json['inputs'];\n      for (const name in inputs) {\n        const input = inputs[name];\n        const block = input['block'];\n        const shadow = input['shadow'];\n        if (block) {\n          cleanRec(block);\n        }\n        if (shadow) {\n          cleanRec(shadow);\n        }\n      }\n      if (json['next']) {\n        const next = json['next'];\n        const block = next['block'];\n        const shadow = next['shadow'];\n        if (block) {\n          cleanRec(block);\n        }\n        if (shadow) {\n          cleanRec(shadow);\n        }\n      }\n    }\n\n    cleanRec(json);\n\n    const blockInfo: BlockInfo = {\n      'kind': 'BLOCK',\n      ...json,\n    };\n    return blockInfo;\n  }\n}\n\n\n/** Width of both the trash can and lid images. */\nconst WIDTH = 47;\n\n/** Height of the trashcan image (minus lid). */\nconst BODY_HEIGHT = 44;\n\n/** Height of the lid image. */\nconst LID_HEIGHT = 16;\n\n/** Distance between trashcan and bottom or top edge of workspace. */\nconst MARGIN_VERTICAL = 20;\n\n/** Distance between trashcan and right or left edge of workspace. */\nconst MARGIN_HORIZONTAL = 20;\n\n/** Extent of hotspot on all sides beyond the size of the image. */\nconst MARGIN_HOTSPOT = 10;\n\n/** Location of trashcan in sprite image. */\nconst SPRITE_LEFT = 0;\n\n/** Location of trashcan in sprite image. */\nconst SPRITE_TOP = 32;\n\n/**\n * The openness of the lid when the trashcan contains blocks.\n *    (0.0 = closed, 1.0 = open)\n */\nconst HAS_BLOCKS_LID_ANGLE = 0.1;\n\n/** The length of the lid open/close animation in milliseconds. */\nconst ANIMATION_LENGTH = 80;\n\n/** The number of frames in the animation. */\nconst ANIMATION_FRAMES = 4;\n\n/** The minimum (resting) opacity of the trashcan and lid. */\nconst OPACITY_MIN = 0.4;\n\n/** The maximum (hovered) opacity of the trashcan and lid. */\nconst OPACITY_MAX = 0.8;\n\n/**\n * The maximum angle the trashcan lid can opens to. At the end of the open\n * animation the lid will be open to this angle.\n */\nconst MAX_LID_ANGLE = 45;\n","/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Events fired as a result of selecting an item on the toolbox.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events.ToolboxItemSelect');\n\nimport * as deprecation from '../utils/deprecation.js';\nimport * as registry from '../registry.js';\nimport {AbstractEventJson} from './events_abstract.js';\nimport {UiBase} from './events_ui_base.js';\nimport * as eventUtils from './utils.js';\nimport type {Workspace} from '../workspace.js';\n\n\n/**\n * Class for a toolbox item select event.\n *\n * @alias Blockly.Events.ToolboxItemSelect\n */\nexport class ToolboxItemSelect extends UiBase {\n  oldItem?: string;\n  newItem?: string;\n  override type = eventUtils.TOOLBOX_ITEM_SELECT;\n\n  /**\n   * @param opt_oldItem The previously selected toolbox item.\n   *     Undefined for a blank event.\n   * @param opt_newItem The newly selected toolbox item. Undefined for a blank\n   *     event.\n   * @param opt_workspaceId The workspace identifier for this event.\n   *    Undefined for a blank event.\n   */\n  constructor(\n      opt_oldItem?: string|null, opt_newItem?: string|null,\n      opt_workspaceId?: string) {\n    super(opt_workspaceId);\n\n    /** The previously selected toolbox item. */\n    this.oldItem = opt_oldItem ?? undefined;\n\n    /** The newly selected toolbox item. */\n    this.newItem = opt_newItem ?? undefined;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): ToolboxItemSelectJson {\n    const json = super.toJson() as ToolboxItemSelectJson;\n    json['oldItem'] = this.oldItem;\n    json['newItem'] = this.newItem;\n    return json;\n  }\n\n  /**\n   * Decode the JSON event.\n   *\n   * @param json JSON representation.\n   */\n  override fromJson(json: ToolboxItemSelectJson) {\n    deprecation.warn(\n        'Blockly.Events.ToolboxItemSelect.prototype.fromJson', 'version 9',\n        'version 10', 'Blockly.Events.fromJson');\n    super.fromJson(json);\n    this.oldItem = json['oldItem'];\n    this.newItem = json['newItem'];\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of ToolboxItemSelect, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n      json: ToolboxItemSelectJson, workspace: Workspace,\n      event?: any): ToolboxItemSelect {\n    const newEvent =\n        super.fromJson(json, workspace, event ?? new ToolboxItemSelect()) as\n        ToolboxItemSelect;\n    newEvent.oldItem = json['oldItem'];\n    newEvent.newItem = json['newItem'];\n    return newEvent;\n  }\n}\n\nexport interface ToolboxItemSelectJson extends AbstractEventJson {\n  oldItem?: string;\n  newItem?: string;\n}\n\nregistry.register(\n    registry.Type.EVENT, eventUtils.TOOLBOX_ITEM_SELECT, ToolboxItemSelect);\n","/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * An item in the toolbox.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.ToolboxItem');\n\nimport type {ICollapsibleToolboxItem} from '../interfaces/i_collapsible_toolbox_item.js';\nimport type {IToolbox} from '../interfaces/i_toolbox.js';\nimport type {IToolboxItem} from '../interfaces/i_toolbox_item.js';\nimport * as idGenerator from '../utils/idgenerator.js';\nimport type * as toolbox from '../utils/toolbox.js';\nimport type {WorkspaceSvg} from '../workspace_svg.js';\n\n\n/**\n * Class for an item in the toolbox.\n *\n * @alias Blockly.ToolboxItem\n */\nexport class ToolboxItem implements IToolboxItem {\n  protected id_: string;\n  protected parent_: ICollapsibleToolboxItem|null;\n  protected level_: number;\n  protected toolboxItemDef_: toolbox.ToolboxItemInfo|null;\n  protected workspace_: WorkspaceSvg;\n  /** The toolbox this category belongs to. */\n  protected readonly parentToolbox_: IToolbox;\n\n  /**\n   * @param toolboxItemDef The JSON defining the toolbox item.\n   * @param parentToolbox The toolbox that holds the toolbox item.\n   * @param opt_parent The parent toolbox item or null if the category does not\n   *     have a parent.\n   */\n  constructor(\n      toolboxItemDef: toolbox.ToolboxItemInfo, parentToolbox: IToolbox,\n      opt_parent?: ICollapsibleToolboxItem) {\n    /** The ID for the category. */\n    this.id_ = (toolboxItemDef as AnyDuringMigration)['toolboxitemid'] ||\n        idGenerator.getNextUniqueId();\n\n    /** The parent of the category. */\n    this.parent_ = opt_parent || null;\n\n    /** The level that the category is nested at. */\n    this.level_ = this.parent_ ? this.parent_.getLevel() + 1 : 0;\n\n    /** The JSON definition of the toolbox item. */\n    this.toolboxItemDef_ = toolboxItemDef;\n\n    this.parentToolbox_ = parentToolbox;\n\n    /** The workspace of the parent toolbox. */\n    this.workspace_ = this.parentToolbox_.getWorkspace();\n  }\n\n  /**\n   * Initializes the toolbox item.\n   * This includes creating the DOM and updating the state of any items based\n   * on the info object.\n   */\n  init() {}\n  // No-op by default.\n\n  /**\n   * Gets the div for the toolbox item.\n   *\n   * @returns The div for the toolbox item.\n   */\n  getDiv(): Element|null {\n    return null;\n  }\n\n  /**\n   * Gets the HTML element that is clickable.\n   * The parent toolbox element receives clicks. The parent toolbox will add an\n   * ID to this element so it can pass the onClick event to the correct\n   * toolboxItem.\n   *\n   * @returns The HTML element that receives clicks, or null if this item should\n   *     not receive clicks.\n   */\n  getClickTarget(): Element|null {\n    return null;\n  }\n\n  /**\n   * Gets a unique identifier for this toolbox item.\n   *\n   * @returns The ID for the toolbox item.\n   */\n  getId(): string {\n    return this.id_;\n  }\n\n  /**\n   * Gets the parent if the toolbox item is nested.\n   *\n   * @returns The parent toolbox item, or null if this toolbox item is not\n   *     nested.\n   */\n  getParent(): ICollapsibleToolboxItem|null {\n    return null;\n  }\n\n  /**\n   * Gets the nested level of the category.\n   *\n   * @returns The nested level of the category.\n   * @internal\n   */\n  getLevel(): number {\n    return this.level_;\n  }\n\n  /**\n   * Whether the toolbox item is selectable.\n   *\n   * @returns True if the toolbox item can be selected.\n   */\n  isSelectable(): boolean {\n    return false;\n  }\n\n  /**\n   * Whether the toolbox item is collapsible.\n   *\n   * @returns True if the toolbox item is collapsible.\n   */\n  isCollapsible(): boolean {\n    return false;\n  }\n\n  /** Dispose of this toolbox item. No-op by default. */\n  dispose() {}\n\n  /**\n   * Sets whether the category is visible or not.\n   * For a category to be visible its parent category must also be expanded.\n   *\n   * @param _isVisible True if category should be visible.\n   */\n  setVisible_(_isVisible: boolean) {}\n}\n// nop by default\n","/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * A toolbox category used to organize blocks in the toolbox.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.ToolboxCategory');\n\nimport * as Css from '../css.js';\nimport type {ICollapsibleToolboxItem} from '../interfaces/i_collapsible_toolbox_item.js';\nimport type {ISelectableToolboxItem} from '../interfaces/i_selectable_toolbox_item.js';\nimport type {IToolbox} from '../interfaces/i_toolbox.js';\nimport type {IToolboxItem} from '../interfaces/i_toolbox_item.js';\nimport type {CategoryInfo, DynamicCategoryInfo, FlyoutDefinition, FlyoutItemInfo, FlyoutItemInfoArray, StaticCategoryInfo} from '../utils/toolbox.js';\nimport * as registry from '../registry.js';\nimport * as aria from '../utils/aria.js';\nimport * as colourUtils from '../utils/colour.js';\nimport * as dom from '../utils/dom.js';\nimport * as parsing from '../utils/parsing.js';\nimport * as toolbox from '../utils/toolbox.js';\n\nimport {ToolboxItem} from './toolbox_item.js';\n\n\n/**\n * Class for a category in a toolbox.\n *\n * @alias Blockly.ToolboxCategory\n */\nexport class ToolboxCategory extends ToolboxItem implements\n    ISelectableToolboxItem {\n  /** Name used for registering a toolbox category. */\n  static registrationName = 'category';\n\n  /** The number of pixels to move the category over at each nested level. */\n  static nestedPadding = 19;\n\n  /** The width in pixels of the strip of colour next to each category. */\n  static borderWidth = 8;\n\n  /**\n   * The default colour of the category. This is used as the background colour\n   * of the category when it is selected.\n   */\n  static defaultBackgroundColour = '#57e';\n\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  override toolboxItemDef_!: CategoryInfo;\n\n  /** The name that will be displayed on the category. */\n  protected name_ = '';\n\n  /** The colour of the category. */\n  protected colour_ = '';\n\n  /** The html container for the category. */\n  protected htmlDiv_: HTMLDivElement|null = null;\n\n  /** The html element for the category row. */\n  protected rowDiv_: HTMLDivElement|null = null;\n\n  /** The html element that holds children elements of the category row. */\n  protected rowContents_: HTMLDivElement|null = null;\n\n  /** The html element for the toolbox icon. */\n  protected iconDom_: Element|null = null;\n\n  /** The html element for the toolbox label. */\n  protected labelDom_: Element|null = null;\n  protected cssConfig_: CssConfig;\n\n  /** True if the category is meant to be hidden, false otherwise. */\n  protected isHidden_ = false;\n\n  /** True if this category is disabled, false otherwise. */\n  protected isDisabled_ = false;\n\n  /** The flyout items for this category. */\n  protected flyoutItems_: string|FlyoutItemInfoArray = [];\n\n  /**\n   * @param categoryDef The information needed to create a category in the\n   *     toolbox.\n   * @param parentToolbox The parent toolbox for the category.\n   * @param opt_parent The parent category or null if the category does not have\n   *     a parent.\n   */\n  constructor(\n      categoryDef: CategoryInfo, parentToolbox: IToolbox,\n      opt_parent?: ICollapsibleToolboxItem) {\n    super(categoryDef, parentToolbox, opt_parent);\n\n    /** All the css class names that are used to create a category. */\n    this.cssConfig_ = this.makeDefaultCssConfig_();\n  }\n\n  /**\n   * Initializes the toolbox item.\n   * This includes creating the DOM and updating the state of any items based\n   * on the info object.\n   * Init should be called immediately after the construction of the toolbox\n   * item, to ensure that the category contents are properly parsed.\n   */\n  override init() {\n    this.parseCategoryDef_(this.toolboxItemDef_);\n    this.parseContents_(this.toolboxItemDef_);\n    this.createDom_();\n    if (this.toolboxItemDef_['hidden'] === 'true') {\n      this.hide();\n    }\n  }\n\n  /**\n   * Creates an object holding the default classes for a category.\n   *\n   * @returns The configuration object holding all the CSS classes for a\n   *     category.\n   */\n  protected makeDefaultCssConfig_(): CssConfig {\n    return {\n      'container': 'blocklyToolboxCategory',\n      'row': 'blocklyTreeRow',\n      'rowcontentcontainer': 'blocklyTreeRowContentContainer',\n      'icon': 'blocklyTreeIcon',\n      'label': 'blocklyTreeLabel',\n      'contents': 'blocklyToolboxContents',\n      'selected': 'blocklyTreeSelected',\n      'openicon': 'blocklyTreeIconOpen',\n      'closedicon': 'blocklyTreeIconClosed',\n    };\n  }\n\n  /**\n   * Parses the contents array depending on if the category is a dynamic\n   * category, or if its contents are meant to be shown in the flyout.\n   *\n   * @param categoryDef The information needed to create a category.\n   */\n  protected parseContents_(categoryDef: CategoryInfo) {\n    if ('custom' in categoryDef) {\n      this.flyoutItems_ = categoryDef['custom'];\n    } else {\n      const contents = categoryDef['contents'];\n      if (!contents) return;\n\n      for (let i = 0; i < contents.length; i++) {\n        const itemDef = contents[i];\n        const flyoutItem = itemDef as FlyoutItemInfo;\n        if (Array.isArray(this.flyoutItems_)) {\n          this.flyoutItems_.push(flyoutItem);\n        }\n      }\n    }\n  }\n\n  /**\n   * Parses the non-contents parts of the category def.\n   *\n   * @param categoryDef The information needed to create a category.\n   */\n  protected parseCategoryDef_(categoryDef: CategoryInfo) {\n    this.name_ = 'name' in categoryDef ?\n        parsing.replaceMessageReferences(categoryDef['name']) :\n        '';\n    this.colour_ = this.getColour_(categoryDef);\n    Object.assign(\n        this.cssConfig_,\n        categoryDef['cssconfig'] || (categoryDef as any)['cssConfig']);\n  }\n\n  /**\n   * Creates the DOM for the category.\n   *\n   * @returns The parent element for the category.\n   */\n  protected createDom_(): HTMLDivElement {\n    this.htmlDiv_ = this.createContainer_();\n    aria.setRole(this.htmlDiv_, aria.Role.TREEITEM);\n    aria.setState(this.htmlDiv_, aria.State.SELECTED, false);\n    aria.setState(this.htmlDiv_, aria.State.LEVEL, this.level_);\n\n    this.rowDiv_ = this.createRowContainer_();\n    this.rowDiv_.style.pointerEvents = 'auto';\n    this.htmlDiv_.appendChild(this.rowDiv_);\n\n    this.rowContents_ = this.createRowContentsContainer_();\n    this.rowContents_.style.pointerEvents = 'none';\n    this.rowDiv_.appendChild(this.rowContents_);\n\n    this.iconDom_ = this.createIconDom_();\n    aria.setRole(this.iconDom_, aria.Role.PRESENTATION);\n    this.rowContents_.appendChild(this.iconDom_);\n\n    this.labelDom_ = this.createLabelDom_(this.name_);\n    this.rowContents_.appendChild(this.labelDom_);\n\n    const id = this.labelDom_.getAttribute('id');\n    if (id) {\n      aria.setState(this.htmlDiv_, aria.State.LABELLEDBY, id);\n    }\n\n    this.addColourBorder_(this.colour_);\n\n    return this.htmlDiv_;\n  }\n\n  /**\n   * Creates the container that holds the row and any subcategories.\n   *\n   * @returns The div that holds the icon and the label.\n   */\n  protected createContainer_(): HTMLDivElement {\n    const container = document.createElement('div');\n    const className = this.cssConfig_['container'];\n    if (className) {\n      dom.addClass(container, className);\n    }\n    return container;\n  }\n\n  /**\n   * Creates the parent of the contents container. All clicks will happen on\n   * this div.\n   *\n   * @returns The div that holds the contents container.\n   */\n  protected createRowContainer_(): HTMLDivElement {\n    const rowDiv = document.createElement('div');\n    const className = this.cssConfig_['row'];\n    if (className) {\n      dom.addClass(rowDiv, className);\n    }\n    const nestedPadding =\n        `${ToolboxCategory.nestedPadding * this.getLevel()}px`;\n    this.workspace_.RTL ? rowDiv.style.paddingRight = nestedPadding :\n                          rowDiv.style.paddingLeft = nestedPadding;\n    return rowDiv;\n  }\n\n  /**\n   * Creates the container for the label and icon.\n   * This is necessary so we can set all subcategory pointer events to none.\n   *\n   * @returns The div that holds the icon and the label.\n   */\n  protected createRowContentsContainer_(): HTMLDivElement {\n    const contentsContainer = document.createElement('div');\n    const className = this.cssConfig_['rowcontentcontainer'];\n    if (className) {\n      dom.addClass(contentsContainer, className);\n    }\n    return contentsContainer;\n  }\n\n  /**\n   * Creates the span that holds the category icon.\n   *\n   * @returns The span that holds the category icon.\n   */\n  protected createIconDom_(): Element {\n    const toolboxIcon = document.createElement('span');\n    if (!this.parentToolbox_.isHorizontal()) {\n      const className = this.cssConfig_['icon'];\n      if (className) {\n        dom.addClass(toolboxIcon, className);\n      }\n    }\n\n    toolboxIcon.style.display = 'inline-block';\n    return toolboxIcon;\n  }\n\n  /**\n   * Creates the span that holds the category label.\n   * This should have an ID for accessibility purposes.\n   *\n   * @param name The name of the category.\n   * @returns The span that holds the category label.\n   */\n  protected createLabelDom_(name: string): Element {\n    const toolboxLabel = document.createElement('span');\n    toolboxLabel.setAttribute('id', this.getId() + '.label');\n    toolboxLabel.textContent = name;\n    const className = this.cssConfig_['label'];\n    if (className) {\n      dom.addClass(toolboxLabel, className);\n    }\n    return toolboxLabel;\n  }\n\n  /** Updates the colour for this category. */\n  refreshTheme() {\n    this.colour_ = this.getColour_(this.toolboxItemDef_);\n    this.addColourBorder_(this.colour_);\n  }\n\n  /**\n   * Add the strip of colour to the toolbox category.\n   *\n   * @param colour The category colour.\n   */\n  protected addColourBorder_(colour: string) {\n    if (colour) {\n      const border =\n          ToolboxCategory.borderWidth + 'px solid ' + (colour || '#ddd');\n      if (this.workspace_.RTL) {\n        this.rowDiv_!.style.borderRight = border;\n      } else {\n        this.rowDiv_!.style.borderLeft = border;\n      }\n    }\n  }\n\n  /**\n   * Gets either the colour or the style for a category.\n   *\n   * @param categoryDef The object holding information on the category.\n   * @returns The hex colour for the category.\n   */\n  protected getColour_(categoryDef: CategoryInfo): string {\n    const styleName =\n        categoryDef['categorystyle'] || (categoryDef as any)['categoryStyle'];\n    const colour = categoryDef['colour'];\n\n    if (colour && styleName) {\n      console.warn(\n          'Toolbox category \"' + this.name_ +\n          '\" must not have both a style and a colour');\n    } else if (styleName) {\n      return this.getColourfromStyle_(styleName);\n    } else if (colour) {\n      return this.parseColour_(colour);\n    }\n    return '';\n  }\n\n  /**\n   * Sets the colour for the category using the style name and returns the new\n   * colour as a hex string.\n   *\n   * @param styleName Name of the style.\n   * @returns The hex colour for the category.\n   */\n  private getColourfromStyle_(styleName: string): string {\n    const theme = this.workspace_.getTheme();\n    if (styleName && theme) {\n      const style = theme.categoryStyles[styleName];\n      if (style && style.colour) {\n        return this.parseColour_(style.colour);\n      } else {\n        console.warn(\n            'Style \"' + styleName + '\" must exist and contain a colour value');\n      }\n    }\n    return '';\n  }\n\n  /**\n   * Gets the HTML element that is clickable.\n   * The parent toolbox element receives clicks. The parent toolbox will add an\n   * ID to this element so it can pass the onClick event to the correct\n   * toolboxItem.\n   *\n   * @returns The HTML element that receives clicks.\n   */\n  override getClickTarget(): Element {\n    return this.rowDiv_ as Element;\n  }\n\n  /**\n   * Parses the colour on the category.\n   *\n   * @param colourValue HSV hue value (0 to 360), #RRGGBB string, or a message\n   *     reference string pointing to one of those two values.\n   * @returns The hex colour for the category.\n   */\n  private parseColour_(colourValue: number|string): string {\n    // Decode the colour for any potential message references\n    // (eg. `%{BKY_MATH_HUE}`).\n    const colour = parsing.replaceMessageReferences(colourValue);\n    if (colour == null || colour === '') {\n      // No attribute. No colour.\n      return '';\n    } else {\n      const hue = Number(colour);\n      if (!isNaN(hue)) {\n        return colourUtils.hueToHex(hue);\n      } else {\n        const hex = colourUtils.parse(colour);\n        if (hex) {\n          return hex;\n        } else {\n          console.warn(\n              'Toolbox category \"' + this.name_ +\n              '\" has unrecognized colour attribute: ' + colour);\n          return '';\n        }\n      }\n    }\n  }\n\n  /**\n   * Adds appropriate classes to display an open icon.\n   *\n   * @param iconDiv The div that holds the icon.\n   */\n  protected openIcon_(iconDiv: Element|null) {\n    if (!iconDiv) {\n      return;\n    }\n    const closedIconClass = this.cssConfig_['closedicon'];\n    if (closedIconClass) {\n      dom.removeClasses(iconDiv, closedIconClass);\n    }\n    const className = this.cssConfig_['openicon'];\n    if (className) {\n      dom.addClass(iconDiv, className);\n    }\n  }\n\n  /**\n   * Adds appropriate classes to display a closed icon.\n   *\n   * @param iconDiv The div that holds the icon.\n   */\n  protected closeIcon_(iconDiv: Element|null) {\n    if (!iconDiv) {\n      return;\n    }\n    const openIconClass = this.cssConfig_['openicon'];\n    if (openIconClass) {\n      dom.removeClasses(iconDiv, openIconClass);\n    }\n    const className = this.cssConfig_['closedicon'];\n    if (className) {\n      dom.addClass(iconDiv, className);\n    }\n  }\n\n  /**\n   * Sets whether the category is visible or not.\n   * For a category to be visible its parent category must also be expanded.\n   *\n   * @param isVisible True if category should be visible.\n   */\n  override setVisible_(isVisible: boolean) {\n    this.htmlDiv_!.style.display = isVisible ? 'block' : 'none';\n    this.isHidden_ = !isVisible;\n\n    if (this.parentToolbox_.getSelectedItem() === this) {\n      this.parentToolbox_.clearSelection();\n    }\n  }\n\n  /** Hide the category. */\n  hide() {\n    this.setVisible_(false);\n  }\n\n  /**\n   * Show the category. Category will only appear if its parent category is also\n   * expanded.\n   */\n  show() {\n    this.setVisible_(true);\n  }\n\n  /**\n   * Whether the category is visible.\n   * A category is only visible if all of its ancestors are expanded and\n   * isHidden_ is false.\n   *\n   * @returns True if the category is visible, false otherwise.\n   */\n  isVisible(): boolean {\n    return !this.isHidden_ && this.allAncestorsExpanded_();\n  }\n\n  /**\n   * Whether all ancestors of a category (parent and parent's parent, etc.) are\n   * expanded.\n   *\n   * @returns True only if every ancestor is expanded\n   */\n  protected allAncestorsExpanded_(): boolean {\n    /* eslint-disable-next-line @typescript-eslint/no-this-alias */\n    let category: IToolboxItem = this;\n    while (category.getParent()) {\n      category = category.getParent()!;\n      if (!(category as ICollapsibleToolboxItem).isExpanded()) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  override isSelectable() {\n    return this.isVisible() && !this.isDisabled_;\n  }\n\n  /**\n   * Handles when the toolbox item is clicked.\n   *\n   * @param _e Click event to handle.\n   */\n  onClick(_e: Event) {}\n  // No-op\n\n  /**\n   * Sets the current category as selected.\n   *\n   * @param isSelected True if this category is selected, false otherwise.\n   */\n  setSelected(isSelected: boolean) {\n    if (!this.rowDiv_) {\n      return;\n    }\n    const className = this.cssConfig_['selected'];\n    if (isSelected) {\n      const defaultColour =\n          this.parseColour_(ToolboxCategory.defaultBackgroundColour);\n      this.rowDiv_.style.backgroundColor = this.colour_ || defaultColour;\n      if (className) {\n        dom.addClass(this.rowDiv_, className);\n      }\n    } else {\n      this.rowDiv_.style.backgroundColor = '';\n      if (className) {\n        dom.removeClass(this.rowDiv_, className);\n      }\n    }\n    aria.setState(this.htmlDiv_ as Element, aria.State.SELECTED, isSelected);\n  }\n\n  /**\n   * Sets whether the category is disabled.\n   *\n   * @param isDisabled True to disable the category, false otherwise.\n   */\n  setDisabled(isDisabled: boolean) {\n    this.isDisabled_ = isDisabled;\n    this.getDiv()!.setAttribute('disabled', `${isDisabled}`);\n    isDisabled ? this.getDiv()!.setAttribute('disabled', 'true') :\n                 this.getDiv()!.removeAttribute('disabled');\n  }\n\n  /**\n   * Gets the name of the category. Used for emitting events.\n   *\n   * @returns The name of the toolbox item.\n   */\n  getName(): string {\n    return this.name_;\n  }\n\n  override getParent() {\n    return this.parent_;\n  }\n\n  override getDiv() {\n    return this.htmlDiv_;\n  }\n\n  /**\n   * Gets the contents of the category. These are items that are meant to be\n   * displayed in the flyout.\n   *\n   * @returns The definition of items to be displayed in the flyout.\n   */\n  getContents(): FlyoutItemInfoArray|string {\n    return this.flyoutItems_;\n  }\n\n  /**\n   * Updates the contents to be displayed in the flyout.\n   * If the flyout is open when the contents are updated, refreshSelection on\n   * the toolbox must also be called.\n   *\n   * @param contents The contents to be displayed in the flyout. A string can be\n   *     supplied to create a dynamic category.\n   */\n  updateFlyoutContents(contents: FlyoutDefinition|string) {\n    this.flyoutItems_ = [];\n\n    if (typeof contents === 'string') {\n      const newDefinition: DynamicCategoryInfo = {\n        kind: this.toolboxItemDef_.kind,\n        custom: contents,\n        id: this.toolboxItemDef_.id,\n        categorystyle: this.toolboxItemDef_.categorystyle,\n        colour: this.toolboxItemDef_.colour,\n        cssconfig: this.toolboxItemDef_.cssconfig,\n        hidden: this.toolboxItemDef_.hidden,\n      };\n      this.toolboxItemDef_ = newDefinition;\n    } else {\n      const newDefinition: StaticCategoryInfo = {\n        kind: this.toolboxItemDef_.kind,\n        name: 'name' in this.toolboxItemDef_ ? this.toolboxItemDef_['name'] :\n                                               '',\n        contents: toolbox.convertFlyoutDefToJsonArray(contents),\n        id: this.toolboxItemDef_.id,\n        categorystyle: this.toolboxItemDef_.categorystyle,\n        colour: this.toolboxItemDef_.colour,\n        cssconfig: this.toolboxItemDef_.cssconfig,\n        hidden: this.toolboxItemDef_.hidden,\n      };\n      this.toolboxItemDef_ = newDefinition;\n    }\n    this.parseContents_(this.toolboxItemDef_);\n  }\n\n  override dispose() {\n    dom.removeNode(this.htmlDiv_);\n  }\n}\n\nexport namespace ToolboxCategory {\n  /** All the CSS class names that are used to create a category. */\n  export interface CssConfig {\n    container?: string;\n    row?: string;\n    rowcontentcontainer?: string;\n    icon?: string;\n    label?: string;\n    contents?: string;\n    selected?: string;\n    openicon?: string;\n    closedicon?: string;\n  }\n}\n\nexport type CssConfig = ToolboxCategory.CssConfig;\n\n/** CSS for Toolbox.  See css.js for use. */\nCss.register(`\n.blocklyTreeRow:not(.blocklyTreeSelected):hover {\n  background-color: rgba(255, 255, 255, .2);\n}\n\n.blocklyToolboxDiv[layout=\"h\"] .blocklyToolboxCategory {\n  margin: 1px 5px 1px 0;\n}\n\n.blocklyToolboxDiv[dir=\"RTL\"][layout=\"h\"] .blocklyToolboxCategory {\n  margin: 1px 0 1px 5px;\n}\n\n.blocklyTreeRow {\n  height: 22px;\n  line-height: 22px;\n  margin-bottom: 3px;\n  padding-right: 8px;\n  white-space: nowrap;\n}\n\n.blocklyToolboxDiv[dir=\"RTL\"] .blocklyTreeRow {\n  margin-left: 8px;\n  padding-right: 0;\n}\n\n.blocklyTreeIcon {\n  background-image: url(<<<PATH>>>/sprites.png);\n  height: 16px;\n  vertical-align: middle;\n  visibility: hidden;\n  width: 16px;\n}\n\n.blocklyTreeIconClosed {\n  background-position: -32px -1px;\n}\n\n.blocklyToolboxDiv[dir=\"RTL\"] .blocklyTreeIconClosed {\n  background-position: 0 -1px;\n}\n\n.blocklyTreeSelected>.blocklyTreeIconClosed {\n  background-position: -32px -17px;\n}\n\n.blocklyToolboxDiv[dir=\"RTL\"] .blocklyTreeSelected>.blocklyTreeIconClosed {\n  background-position: 0 -17px;\n}\n\n.blocklyTreeIconOpen {\n  background-position: -16px -1px;\n}\n\n.blocklyTreeSelected>.blocklyTreeIconOpen {\n  background-position: -16px -17px;\n}\n\n.blocklyTreeLabel {\n  cursor: default;\n  font: 16px sans-serif;\n  padding: 0 3px;\n  vertical-align: middle;\n}\n\n.blocklyToolboxDelete .blocklyTreeLabel {\n  cursor: url(\"<<<PATH>>>/handdelete.cur\"), auto;\n}\n\n.blocklyTreeSelected .blocklyTreeLabel {\n  color: #fff;\n}\n`);\n\nregistry.register(\n    registry.Type.TOOLBOX_ITEM, ToolboxCategory.registrationName,\n    ToolboxCategory);\n","/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * A separator used for separating toolbox categories.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.ToolboxSeparator');\n\nimport * as Css from '../css.js';\nimport type {IToolbox} from '../interfaces/i_toolbox.js';\nimport * as registry from '../registry.js';\nimport * as dom from '../utils/dom.js';\nimport type * as toolbox from '../utils/toolbox.js';\n\nimport {ToolboxItem} from './toolbox_item.js';\n\n\n/**\n * Class for a toolbox separator. This is the thin visual line that appears on\n * the toolbox. This item is not interactable.\n *\n * @alias Blockly.ToolboxSeparator\n */\nexport class ToolboxSeparator extends ToolboxItem {\n  /** Name used for registering a toolbox separator. */\n  static registrationName = 'sep';\n\n  /** All the CSS class names that are used to create a separator. */\n  protected cssConfig_: CssConfig = {'container': 'blocklyTreeSeparator'};\n\n  private htmlDiv_: HTMLDivElement|null = null;\n\n  /**\n   * @param separatorDef The information needed to create a separator.\n   * @param toolbox The parent toolbox for the separator.\n   */\n  constructor(separatorDef: toolbox.SeparatorInfo, toolbox: IToolbox) {\n    super(separatorDef, toolbox);\n\n    const cssConfig =\n        separatorDef['cssconfig'] || (separatorDef as any)['cssConfig'];\n    Object.assign(this.cssConfig_, cssConfig);\n  }\n\n  override init() {\n    this.createDom_();\n  }\n\n  /**\n   * Creates the DOM for a separator.\n   *\n   * @returns The parent element for the separator.\n   */\n  protected createDom_(): HTMLDivElement {\n    const container = document.createElement('div');\n    const className = this.cssConfig_['container'];\n    if (className) {\n      dom.addClass(container, className);\n    }\n    this.htmlDiv_ = container;\n    return container;\n  }\n\n  override getDiv() {\n    return this.htmlDiv_ as HTMLDivElement;\n  }\n\n  override dispose() {\n    dom.removeNode(this.htmlDiv_ as HTMLDivElement);\n  }\n}\n\nexport namespace ToolboxSeparator {\n  export interface CssConfig {\n    container: string|undefined;\n  }\n}\n\nexport type CssConfig = ToolboxSeparator.CssConfig;\n\n/** CSS for Toolbox.  See css.js for use. */\nCss.register(`\n.blocklyTreeSeparator {\n  border-bottom: solid #e5e5e5 1px;\n  height: 0;\n  margin: 5px 0;\n}\n\n.blocklyToolboxDiv[layout=\"h\"] .blocklyTreeSeparator {\n  border-right: solid #e5e5e5 1px;\n  border-bottom: none;\n  height: auto;\n  margin: 0 5px 0 5px;\n  padding: 5px 0;\n  width: 0;\n}\n`);\n\nregistry.register(\n    registry.Type.TOOLBOX_ITEM, ToolboxSeparator.registrationName,\n    ToolboxSeparator);\n","/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * A toolbox category used to organize blocks in the toolbox.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.CollapsibleToolboxCategory');\n\nimport type {ICollapsibleToolboxItem} from '../interfaces/i_collapsible_toolbox_item.js';\nimport type {IToolbox} from '../interfaces/i_toolbox.js';\nimport type {IToolboxItem} from '../interfaces/i_toolbox_item.js';\nimport * as registry from '../registry.js';\nimport * as aria from '../utils/aria.js';\nimport * as dom from '../utils/dom.js';\nimport * as toolbox from '../utils/toolbox.js';\n\nimport {ToolboxCategory} from './category.js';\nimport {ToolboxSeparator} from './separator.js';\n\n\n/**\n * Class for a category in a toolbox that can be collapsed.\n *\n * @alias Blockly.CollapsibleToolboxCategory\n */\nexport class CollapsibleToolboxCategory extends ToolboxCategory implements\n    ICollapsibleToolboxItem {\n  /** Name used for registering a collapsible toolbox category. */\n  static override registrationName = 'collapsibleCategory';\n\n  /** Container for any child categories. */\n  protected subcategoriesDiv_: HTMLDivElement|null = null;\n\n  /** Whether or not the category should display its subcategories. */\n  protected expanded_ = false;\n\n  /** The child toolbox items for this category. */\n  protected toolboxItems_: IToolboxItem[] = [];\n  override flyoutItems_: AnyDuringMigration;\n  override isHidden_: AnyDuringMigration;\n\n  /**\n   * @param categoryDef The information needed to create a category in the\n   *     toolbox.\n   * @param toolbox The parent toolbox for the category.\n   * @param opt_parent The parent category or null if the category does not have\n   *     a parent.\n   */\n  constructor(\n      categoryDef: toolbox.CategoryInfo, toolbox: IToolbox,\n      opt_parent?: ICollapsibleToolboxItem) {\n    super(categoryDef, toolbox, opt_parent);\n  }\n\n  override makeDefaultCssConfig_() {\n    const cssConfig = super.makeDefaultCssConfig_();\n    (cssConfig as AnyDuringMigration)['contents'] = 'blocklyToolboxContents';\n    return cssConfig;\n  }\n\n  override parseContents_(categoryDef: toolbox.CategoryInfo) {\n    // AnyDuringMigration because:  Element implicitly has an 'any' type because\n    // expression of type '\"contents\"' can't be used to index type\n    // 'CategoryInfo'.\n    const contents = (categoryDef as AnyDuringMigration)['contents'];\n    let prevIsFlyoutItem = true;\n\n    // AnyDuringMigration because:  Element implicitly has an 'any' type because\n    // expression of type '\"custom\"' can't be used to index type 'CategoryInfo'.\n    if ((categoryDef as AnyDuringMigration)['custom']) {\n      // AnyDuringMigration because:  Element implicitly has an 'any' type\n      // because expression of type '\"custom\"' can't be used to index type\n      // 'CategoryInfo'.\n      this.flyoutItems_ = (categoryDef as AnyDuringMigration)['custom'];\n    } else if (contents) {\n      for (let i = 0; i < contents.length; i++) {\n        const itemDef = contents[i];\n        // Separators can exist as either a flyout item or a toolbox item so\n        // decide where it goes based on the type of the previous item.\n        if (!registry.hasItem(registry.Type.TOOLBOX_ITEM, itemDef['kind']) ||\n            itemDef['kind'].toLowerCase() ===\n                    ToolboxSeparator.registrationName &&\n                prevIsFlyoutItem) {\n          const flyoutItem = itemDef as toolbox.FlyoutItemInfo;\n          this.flyoutItems_.push(flyoutItem);\n          prevIsFlyoutItem = true;\n        } else {\n          this.createToolboxItem_(itemDef);\n          prevIsFlyoutItem = false;\n        }\n      }\n    }\n  }\n\n  /**\n   * Creates a toolbox item and adds it to the list of toolbox items.\n   *\n   * @param itemDef The information needed to create a toolbox item.\n   */\n  private createToolboxItem_(itemDef: toolbox.ToolboxItemInfo) {\n    let registryName = itemDef['kind'];\n    const categoryDef = itemDef as toolbox.CategoryInfo;\n    // Categories that are collapsible are created using a class registered\n    // under a different name.\n    if (registryName.toUpperCase() === 'CATEGORY' &&\n        toolbox.isCategoryCollapsible(categoryDef)) {\n      registryName = CollapsibleToolboxCategory.registrationName;\n    }\n    const ToolboxItemClass =\n        registry.getClass(registry.Type.TOOLBOX_ITEM, registryName);\n    const toolboxItem =\n        new ToolboxItemClass!(itemDef, this.parentToolbox_, this);\n    this.toolboxItems_.push(toolboxItem);\n  }\n\n  override init() {\n    super.init();\n\n    this.setExpanded(\n        (this.toolboxItemDef_ as AnyDuringMigration)['expanded'] === 'true' ||\n        (this.toolboxItemDef_ as AnyDuringMigration)['expanded']);\n  }\n\n  override createDom_() {\n    super.createDom_();\n\n    const subCategories = this.getChildToolboxItems();\n    this.subcategoriesDiv_ = this.createSubCategoriesDom_(subCategories);\n    aria.setRole(this.subcategoriesDiv_, aria.Role.GROUP);\n    this.htmlDiv_!.appendChild(this.subcategoriesDiv_);\n\n    return this.htmlDiv_!;\n  }\n\n  override createIconDom_() {\n    const toolboxIcon = document.createElement('span');\n    if (!this.parentToolbox_.isHorizontal()) {\n      const className = (this.cssConfig_ as AnyDuringMigration)['icon'];\n      if (className) {\n        dom.addClass(toolboxIcon, className);\n      }\n      toolboxIcon.style.visibility = 'visible';\n    }\n\n    toolboxIcon.style.display = 'inline-block';\n    return toolboxIcon;\n  }\n\n  /**\n   * Create the DOM for all subcategories.\n   *\n   * @param subcategories The subcategories.\n   * @returns The div holding all the subcategories.\n   */\n  protected createSubCategoriesDom_(subcategories: IToolboxItem[]):\n      HTMLDivElement {\n    const contentsContainer = document.createElement('div');\n    const className = (this.cssConfig_ as AnyDuringMigration)['contents'];\n    if (className) {\n      dom.addClass(contentsContainer, className);\n    }\n\n    for (let i = 0; i < subcategories.length; i++) {\n      const newCategory = subcategories[i];\n      newCategory.init();\n      const newCategoryDiv = newCategory.getDiv();\n      contentsContainer.appendChild(newCategoryDiv!);\n      if (newCategory.getClickTarget) {\n        newCategory.getClickTarget()?.setAttribute('id', newCategory.getId());\n      }\n    }\n    return contentsContainer;\n  }\n\n  /**\n   * Opens or closes the current category.\n   *\n   * @param isExpanded True to expand the category, false to close.\n   */\n  setExpanded(isExpanded: boolean) {\n    if (this.expanded_ === isExpanded) {\n      return;\n    }\n    this.expanded_ = isExpanded;\n    if (isExpanded) {\n      this.subcategoriesDiv_!.style.display = 'block';\n      this.openIcon_(this.iconDom_);\n    } else {\n      this.subcategoriesDiv_!.style.display = 'none';\n      this.closeIcon_(this.iconDom_);\n    }\n    aria.setState(\n        this.htmlDiv_ as HTMLDivElement, aria.State.EXPANDED, isExpanded);\n\n    this.parentToolbox_.handleToolboxItemResize();\n  }\n\n  override setVisible_(isVisible: boolean) {\n    this.htmlDiv_!.style.display = isVisible ? 'block' : 'none';\n    const childToolboxItems = this.getChildToolboxItems();\n    for (let i = 0; i < childToolboxItems.length; i++) {\n      const child = childToolboxItems[i];\n      child.setVisible_(isVisible);\n    }\n    this.isHidden_ = !isVisible;\n\n    if (this.parentToolbox_.getSelectedItem() === this) {\n      this.parentToolbox_.clearSelection();\n    }\n  }\n\n  /**\n   * Whether the category is expanded to show its child subcategories.\n   *\n   * @returns True if the toolbox item shows its children, false if it is\n   *     collapsed.\n   */\n  isExpanded(): boolean {\n    return this.expanded_;\n  }\n\n  override isCollapsible() {\n    return true;\n  }\n\n  override onClick(_e: Event) {\n    this.toggleExpanded();\n  }\n\n  /** Toggles whether or not the category is expanded. */\n  toggleExpanded() {\n    this.setExpanded(!this.expanded_);\n  }\n\n  override getDiv() {\n    return this.htmlDiv_;\n  }\n\n  /**\n   * Gets any children toolbox items. (ex. Gets the subcategories)\n   *\n   * @returns The child toolbox items.\n   */\n  getChildToolboxItems(): IToolboxItem[] {\n    return this.toolboxItems_;\n  }\n}\n\nexport namespace CollapsibleToolboxCategory {\n  /**\n   * All the CSS class names that are used to create a collapsible\n   * category. This is all the properties from the regular category plus\n   * contents.\n   */\n  export interface CssConfig {\n    container: string|null;\n    row: string|null;\n    rowcontentcontainer: string|null;\n    icon: string|null;\n    label: string|null;\n    selected: string|null;\n    openicon: string|null;\n    closedicon: string|null;\n    contents: string|null;\n  }\n}\n\nexport type CssConfig = CollapsibleToolboxCategory.CssConfig;\n\nregistry.register(\n    registry.Type.TOOLBOX_ITEM, CollapsibleToolboxCategory.registrationName,\n    CollapsibleToolboxCategory);\n","/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Toolbox from whence to create blocks.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Toolbox');\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport '../events/events_toolbox_item_select.js';\n\nimport {BlockSvg} from '../block_svg.js';\nimport type {BlocklyOptions} from '../blockly_options.js';\nimport * as browserEvents from '../browser_events.js';\nimport * as common from '../common.js';\nimport {ComponentManager} from '../component_manager.js';\nimport * as Css from '../css.js';\nimport {DeleteArea} from '../delete_area.js';\nimport * as eventUtils from '../events/utils.js';\nimport type {IAutoHideable} from '../interfaces/i_autohideable.js';\nimport type {ICollapsibleToolboxItem} from '../interfaces/i_collapsible_toolbox_item.js';\nimport type {IDraggable} from '../interfaces/i_draggable.js';\nimport type {IFlyout} from '../interfaces/i_flyout.js';\nimport type {IKeyboardAccessible} from '../interfaces/i_keyboard_accessible.js';\nimport type {ISelectableToolboxItem} from '../interfaces/i_selectable_toolbox_item.js';\nimport type {IStyleable} from '../interfaces/i_styleable.js';\nimport type {IToolbox} from '../interfaces/i_toolbox.js';\nimport type {IToolboxItem} from '../interfaces/i_toolbox_item.js';\nimport {Options} from '../options.js';\nimport * as registry from '../registry.js';\nimport type {KeyboardShortcut} from '../shortcut_registry.js';\nimport * as Touch from '../touch.js';\nimport * as aria from '../utils/aria.js';\nimport * as dom from '../utils/dom.js';\nimport {KeyCodes} from '../utils/keycodes.js';\nimport {Rect} from '../utils/rect.js';\nimport * as toolbox from '../utils/toolbox.js';\nimport type {WorkspaceSvg} from '../workspace_svg.js';\n\nimport type {ToolboxCategory} from './category.js';\nimport {CollapsibleToolboxCategory} from './collapsible_category.js';\n\n\n/**\n * Class for a Toolbox.\n * Creates the toolbox's DOM.\n *\n * @alias Blockly.Toolbox\n */\nexport class Toolbox extends DeleteArea implements IAutoHideable,\n                                                   IKeyboardAccessible,\n                                                   IStyleable, IToolbox {\n  /**\n   * The unique ID for this component that is used to register with the\n   * ComponentManager.\n   */\n  override id = 'toolbox';\n  protected toolboxDef_: toolbox.ToolboxInfo;\n  private readonly horizontalLayout_: boolean;\n\n  /** The html container for the toolbox. */\n  HtmlDiv: HTMLDivElement|null = null;\n\n  /** The html container for the contents of a toolbox. */\n  protected contentsDiv_: HTMLDivElement|null = null;\n\n  /** Whether the Toolbox is visible. */\n  protected isVisible_ = false;\n\n  /** The list of items in the toolbox. */\n  protected contents_: IToolboxItem[] = [];\n\n  /** The width of the toolbox. */\n  protected width_ = 0;\n\n  /** The height of the toolbox. */\n  protected height_ = 0;\n  RTL: boolean;\n\n  /** The flyout for the toolbox. */\n  private flyout_: IFlyout|null = null;\n  protected contentMap_: {[key: string]: IToolboxItem};\n  toolboxPosition: toolbox.Position;\n\n  /** The currently selected item. */\n  protected selectedItem_: ISelectableToolboxItem|null = null;\n\n  /** The previously selected item. */\n  protected previouslySelectedItem_: ISelectableToolboxItem|null = null;\n\n  /**\n   * Array holding info needed to unbind event handlers.\n   * Used for disposing.\n   * Ex: [[node, name, func], [node, name, func]].\n   */\n  protected boundEvents_: browserEvents.Data[] = [];\n  override wouldDelete_: AnyDuringMigration;\n\n  /** The workspace this toolbox is on. */\n  protected readonly workspace_: WorkspaceSvg;\n\n  /** @param workspace The workspace in which to create new blocks. */\n  constructor(workspace: WorkspaceSvg) {\n    super();\n\n    this.workspace_ = workspace;\n\n    /** The JSON describing the contents of this toolbox. */\n    // AnyDuringMigration because:  Type 'ToolboxInfo | { contents: never[]; }'\n    // is not assignable to type 'ToolboxInfo'.\n    this.toolboxDef_ = (workspace.options.languageTree || {'contents': []}) as\n        AnyDuringMigration;\n\n    /** Whether the toolbox should be laid out horizontally. */\n    this.horizontalLayout_ = workspace.options.horizontalLayout;\n\n    /** Is RTL vs LTR. */\n    this.RTL = workspace.options.RTL;\n\n    /** A map from toolbox item IDs to toolbox items. */\n    this.contentMap_ = Object.create(null);\n\n    /** Position of the toolbox and flyout relative to the workspace. */\n    this.toolboxPosition = workspace.options.toolboxPosition;\n  }\n\n  /**\n   * Handles the given keyboard shortcut.\n   *\n   * @param _shortcut The shortcut to be handled.\n   * @returns True if the shortcut has been handled, false otherwise.\n   */\n  onShortcut(_shortcut: KeyboardShortcut): boolean {\n    return false;\n  }\n\n  /** Initializes the toolbox */\n  init() {\n    const workspace = this.workspace_;\n    const svg = workspace.getParentSvg();\n\n    this.flyout_ = this.createFlyout_();\n\n    this.HtmlDiv = this.createDom_(this.workspace_);\n    dom.insertAfter(this.flyout_.createDom('svg'), svg);\n    this.setVisible(true);\n    this.flyout_.init(workspace);\n\n    this.render(this.toolboxDef_);\n    const themeManager = workspace.getThemeManager();\n    themeManager.subscribe(\n        this.HtmlDiv, 'toolboxBackgroundColour', 'background-color');\n    themeManager.subscribe(this.HtmlDiv, 'toolboxForegroundColour', 'color');\n    this.workspace_.getComponentManager().addComponent({\n      component: this,\n      weight: 1,\n      capabilities: [\n        ComponentManager.Capability.AUTOHIDEABLE,\n        ComponentManager.Capability.DELETE_AREA,\n        ComponentManager.Capability.DRAG_TARGET,\n      ],\n    });\n  }\n\n  /**\n   * Creates the DOM for the toolbox.\n   *\n   * @param workspace The workspace this toolbox is on.\n   * @returns The HTML container for the toolbox.\n   */\n  protected createDom_(workspace: WorkspaceSvg): HTMLDivElement {\n    const svg = workspace.getParentSvg();\n\n    const container = this.createContainer_();\n\n    this.contentsDiv_ = this.createContentsContainer_();\n    this.contentsDiv_.tabIndex = 0;\n    aria.setRole(this.contentsDiv_, aria.Role.TREE);\n    container.appendChild(this.contentsDiv_);\n\n    svg.parentNode!.insertBefore(container, svg);\n\n    this.attachEvents_(container, this.contentsDiv_);\n    return container;\n  }\n\n  /**\n   * Creates the container div for the toolbox.\n   *\n   * @returns The HTML container for the toolbox.\n   */\n  protected createContainer_(): HTMLDivElement {\n    const toolboxContainer = (document.createElement('div'));\n    toolboxContainer.setAttribute('layout', this.isHorizontal() ? 'h' : 'v');\n    dom.addClass(toolboxContainer, 'blocklyToolboxDiv');\n    dom.addClass(toolboxContainer, 'blocklyNonSelectable');\n    toolboxContainer.setAttribute('dir', this.RTL ? 'RTL' : 'LTR');\n    return toolboxContainer;\n  }\n\n  /**\n   * Creates the container for all the contents in the toolbox.\n   *\n   * @returns The HTML container for the toolbox contents.\n   */\n  protected createContentsContainer_(): HTMLDivElement {\n    const contentsContainer = (document.createElement('div'));\n    dom.addClass(contentsContainer, 'blocklyToolboxContents');\n    if (this.isHorizontal()) {\n      contentsContainer.style.flexDirection = 'row';\n    }\n    return contentsContainer;\n  }\n\n  /**\n   * Adds event listeners to the toolbox container div.\n   *\n   * @param container The HTML container for the toolbox.\n   * @param contentsContainer The HTML container for the contents of the\n   *     toolbox.\n   */\n  protected attachEvents_(\n      container: HTMLDivElement, contentsContainer: HTMLDivElement) {\n    // Clicking on toolbox closes popups.\n    const clickEvent = browserEvents.conditionalBind(\n        container, 'pointerdown', this, this.onClick_,\n        /* opt_noCaptureIdentifier */ false);\n    this.boundEvents_.push(clickEvent);\n\n    const keyDownEvent = browserEvents.conditionalBind(\n        contentsContainer, 'keydown', this, this.onKeyDown_,\n        /* opt_noCaptureIdentifier */ false);\n    this.boundEvents_.push(keyDownEvent);\n  }\n\n  /**\n   * Handles on click events for when the toolbox or toolbox items are clicked.\n   *\n   * @param e Click event to handle.\n   */\n  protected onClick_(e: PointerEvent) {\n    if (browserEvents.isRightButton(e) || e.target === this.HtmlDiv) {\n      // Close flyout.\n      (common.getMainWorkspace() as WorkspaceSvg).hideChaff(false);\n    } else {\n      const targetElement = e.target;\n      const itemId = (targetElement as Element).getAttribute('id');\n      if (itemId) {\n        const item = this.getToolboxItemById(itemId);\n        if (item!.isSelectable()) {\n          this.setSelectedItem(item);\n          (item as ISelectableToolboxItem).onClick(e);\n        }\n      }\n      // Just close popups.\n      (common.getMainWorkspace() as WorkspaceSvg).hideChaff(true);\n    }\n    Touch.clearTouchIdentifier();\n  }\n\n  /**\n   * Handles key down events for the toolbox.\n   *\n   * @param e The key down event.\n   */\n  protected onKeyDown_(e: KeyboardEvent) {\n    let handled = false;\n    switch (e.keyCode) {\n      case KeyCodes.DOWN:\n        handled = this.selectNext_();\n        break;\n      case KeyCodes.UP:\n        handled = this.selectPrevious_();\n        break;\n      case KeyCodes.LEFT:\n        handled = this.selectParent_();\n        break;\n      case KeyCodes.RIGHT:\n        handled = this.selectChild_();\n        break;\n      case KeyCodes.ENTER:\n      case KeyCodes.SPACE:\n        if (this.selectedItem_ && this.selectedItem_.isCollapsible()) {\n          const collapsibleItem = this.selectedItem_ as ICollapsibleToolboxItem;\n          collapsibleItem.toggleExpanded();\n          handled = true;\n        }\n        break;\n      default:\n        handled = false;\n        break;\n    }\n    if (!handled && this.selectedItem_) {\n      // TODO(#6097): Figure out who implements onKeyDown and which interface it\n      // should be part of.\n      const untypedItem = this.selectedItem_ as AnyDuringMigration;\n      if (untypedItem.onKeyDown) {\n        handled = untypedItem.onKeyDown(e);\n      }\n    }\n\n    if (handled) {\n      e.preventDefault();\n    }\n  }\n\n  /**\n   * Creates the flyout based on the toolbox layout.\n   *\n   * @returns The flyout for the toolbox.\n   * @throws {Error} If missing a require for `Blockly.HorizontalFlyout`,\n   *     `Blockly.VerticalFlyout`, and no flyout plugin is specified.\n   */\n  protected createFlyout_(): IFlyout {\n    const workspace = this.workspace_;\n    // TODO (#4247): Look into adding a makeFlyout method to Blockly Options.\n    const workspaceOptions = new Options(({\n      'parentWorkspace': workspace,\n      'rtl': workspace.RTL,\n      'oneBasedIndex': workspace.options.oneBasedIndex,\n      'horizontalLayout': workspace.horizontalLayout,\n      'renderer': workspace.options.renderer,\n      'rendererOverrides': workspace.options.rendererOverrides,\n      'move': {\n        'scrollbars': true,\n      },\n    } as BlocklyOptions));\n    // Options takes in either 'end' or 'start'. This has already been parsed to\n    // be either 0 or 1, so set it after.\n    workspaceOptions.toolboxPosition = workspace.options.toolboxPosition;\n    let FlyoutClass = null;\n    if (workspace.horizontalLayout) {\n      FlyoutClass = registry.getClassFromOptions(\n          registry.Type.FLYOUTS_HORIZONTAL_TOOLBOX, workspace.options, true);\n    } else {\n      FlyoutClass = registry.getClassFromOptions(\n          registry.Type.FLYOUTS_VERTICAL_TOOLBOX, workspace.options, true);\n    }\n    return new FlyoutClass!(workspaceOptions);\n  }\n\n  /**\n   * Fills the toolbox with new toolbox items and removes any old contents.\n   *\n   * @param toolboxDef Object holding information for creating a toolbox.\n   * @internal\n   */\n  render(toolboxDef: toolbox.ToolboxInfo) {\n    this.toolboxDef_ = toolboxDef;\n    for (let i = 0; i < this.contents_.length; i++) {\n      const toolboxItem = this.contents_[i];\n      if (toolboxItem) {\n        toolboxItem.dispose();\n      }\n    }\n    this.contents_ = [];\n    this.contentMap_ = Object.create(null);\n    this.renderContents_(toolboxDef['contents']);\n    this.position();\n    this.handleToolboxItemResize();\n  }\n\n  /**\n   * Adds all the toolbox items to the toolbox.\n   *\n   * @param toolboxDef Array holding objects containing information on the\n   *     contents of the toolbox.\n   */\n  protected renderContents_(toolboxDef: toolbox.ToolboxItemInfo[]) {\n    // This is for performance reasons. By using document fragment we only have\n    // to add to the DOM once.\n    const fragment = document.createDocumentFragment();\n    for (let i = 0; i < toolboxDef.length; i++) {\n      const toolboxItemDef = toolboxDef[i];\n      this.createToolboxItem_(toolboxItemDef, fragment);\n    }\n    this.contentsDiv_!.appendChild(fragment);\n  }\n\n  /**\n   * Creates and renders the toolbox item.\n   *\n   * @param toolboxItemDef Any information that can be used to create an item in\n   *     the toolbox.\n   * @param fragment The document fragment to add the child toolbox elements to.\n   */\n  private createToolboxItem_(\n      toolboxItemDef: toolbox.ToolboxItemInfo, fragment: DocumentFragment) {\n    let registryName = toolboxItemDef['kind'];\n\n    // Categories that are collapsible are created using a class registered\n    // under a different name.\n    if (registryName.toUpperCase() === 'CATEGORY' &&\n        toolbox.isCategoryCollapsible(toolboxItemDef as toolbox.CategoryInfo)) {\n      registryName = CollapsibleToolboxCategory.registrationName;\n    }\n\n    const ToolboxItemClass = registry.getClass(\n        registry.Type.TOOLBOX_ITEM, registryName.toLowerCase());\n    if (ToolboxItemClass) {\n      const toolboxItem = new ToolboxItemClass(toolboxItemDef, this);\n      toolboxItem.init();\n      this.addToolboxItem_(toolboxItem);\n      const toolboxItemDom = toolboxItem.getDiv();\n      if (toolboxItemDom) {\n        fragment.appendChild(toolboxItemDom);\n      }\n      // Adds the ID to the HTML element that can receive a click.\n      // This is used in onClick_ to find the toolboxItem that was clicked.\n      if (toolboxItem.getClickTarget()) {\n        toolboxItem.getClickTarget()!.setAttribute('id', toolboxItem.getId());\n      }\n    }\n  }\n\n  /**\n   * Adds an item to the toolbox.\n   *\n   * @param toolboxItem The item in the toolbox.\n   */\n  protected addToolboxItem_(toolboxItem: IToolboxItem) {\n    this.contents_.push(toolboxItem);\n    this.contentMap_[toolboxItem.getId()] = toolboxItem;\n    if (toolboxItem.isCollapsible()) {\n      const collapsibleItem = toolboxItem as ICollapsibleToolboxItem;\n      const childToolboxItems = collapsibleItem.getChildToolboxItems();\n      for (let i = 0; i < childToolboxItems.length; i++) {\n        const child = childToolboxItems[i];\n        this.addToolboxItem_(child);\n      }\n    }\n  }\n\n  /**\n   * Gets the items in the toolbox.\n   *\n   * @returns The list of items in the toolbox.\n   */\n  getToolboxItems(): IToolboxItem[] {\n    return this.contents_;\n  }\n\n  /**\n   * Adds a style on the toolbox. Usually used to change the cursor.\n   *\n   * @param style The name of the class to add.\n   * @internal\n   */\n  addStyle(style: string) {\n    if (style && this.HtmlDiv) {\n      dom.addClass(this.HtmlDiv, style);\n    }\n  }\n\n  /**\n   * Removes a style from the toolbox. Usually used to change the cursor.\n   *\n   * @param style The name of the class to remove.\n   * @internal\n   */\n  removeStyle(style: string) {\n    if (style && this.HtmlDiv) {\n      dom.removeClass(this.HtmlDiv, style);\n    }\n  }\n\n  /**\n   * Returns the bounding rectangle of the drag target area in pixel units\n   * relative to viewport.\n   *\n   * @returns The component's bounding box. Null if drag target area should be\n   *     ignored.\n   */\n  override getClientRect(): Rect|null {\n    if (!this.HtmlDiv || !this.isVisible_) {\n      return null;\n    }\n    // BIG_NUM is offscreen padding so that blocks dragged beyond the toolbox\n    // area are still deleted.  Must be smaller than Infinity, but larger than\n    // the largest screen size.\n    const BIG_NUM = 10000000;\n    const toolboxRect = this.HtmlDiv.getBoundingClientRect();\n\n    const top = toolboxRect.top;\n    const bottom = top + toolboxRect.height;\n    const left = toolboxRect.left;\n    const right = left + toolboxRect.width;\n\n    // Assumes that the toolbox is on the SVG edge.  If this changes\n    // (e.g. toolboxes in mutators) then this code will need to be more complex.\n    if (this.toolboxPosition === toolbox.Position.TOP) {\n      return new Rect(-BIG_NUM, bottom, -BIG_NUM, BIG_NUM);\n    } else if (this.toolboxPosition === toolbox.Position.BOTTOM) {\n      return new Rect(top, BIG_NUM, -BIG_NUM, BIG_NUM);\n    } else if (this.toolboxPosition === toolbox.Position.LEFT) {\n      return new Rect(-BIG_NUM, BIG_NUM, -BIG_NUM, right);\n    } else {  // Right\n      return new Rect(-BIG_NUM, BIG_NUM, left, BIG_NUM);\n    }\n  }\n\n  /**\n   * Returns whether the provided block or bubble would be deleted if dropped on\n   * this area.\n   * This method should check if the element is deletable and is always called\n   * before onDragEnter/onDragOver/onDragExit.\n   *\n   * @param element The block or bubble currently being dragged.\n   * @param _couldConnect Whether the element could could connect to another.\n   * @returns Whether the element provided would be deleted if dropped on this\n   *     area.\n   */\n  override wouldDelete(element: IDraggable, _couldConnect: boolean): boolean {\n    if (element instanceof BlockSvg) {\n      const block = (element);\n      // Prefer dragging to the toolbox over connecting to other blocks.\n      this.updateWouldDelete_(!block.getParent() && block.isDeletable());\n    } else {\n      this.updateWouldDelete_(element.isDeletable());\n    }\n    return this.wouldDelete_;\n  }\n\n  /**\n   * Handles when a cursor with a block or bubble enters this drag target.\n   *\n   * @param _dragElement The block or bubble currently being dragged.\n   */\n  override onDragEnter(_dragElement: IDraggable) {\n    this.updateCursorDeleteStyle_(true);\n  }\n\n  /**\n   * Handles when a cursor with a block or bubble exits this drag target.\n   *\n   * @param _dragElement The block or bubble currently being dragged.\n   */\n  override onDragExit(_dragElement: IDraggable) {\n    this.updateCursorDeleteStyle_(false);\n  }\n\n  /**\n   * Handles when a block or bubble is dropped on this component.\n   * Should not handle delete here.\n   *\n   * @param _dragElement The block or bubble currently being dragged.\n   */\n  override onDrop(_dragElement: IDraggable) {\n    this.updateCursorDeleteStyle_(false);\n  }\n\n  /**\n   * Updates the internal wouldDelete_ state.\n   *\n   * @param wouldDelete The new value for the wouldDelete state.\n   */\n  protected override updateWouldDelete_(wouldDelete: boolean) {\n    if (wouldDelete === this.wouldDelete_) {\n      return;\n    }\n    // This logic handles updating the deleteStyle properly if the delete state\n    // changes while the block is over the Toolbox. This could happen if the\n    // implementation of wouldDeleteBlock depends on the couldConnect parameter\n    // or if the isDeletable property of the block currently being dragged\n    // changes during the drag.\n    this.updateCursorDeleteStyle_(false);\n    this.wouldDelete_ = wouldDelete;\n    this.updateCursorDeleteStyle_(true);\n  }\n\n  /**\n   * Adds or removes the CSS style of the cursor over the toolbox based whether\n   * the block or bubble over it is expected to be deleted if dropped (using the\n   * internal this.wouldDelete_ property).\n   *\n   * @param addStyle Whether the style should be added or removed.\n   */\n  protected updateCursorDeleteStyle_(addStyle: boolean) {\n    const style =\n        this.wouldDelete_ ? 'blocklyToolboxDelete' : 'blocklyToolboxGrab';\n    if (addStyle) {\n      this.addStyle(style);\n    } else {\n      this.removeStyle(style);\n    }\n  }\n\n  /**\n   * Gets the toolbox item with the given ID.\n   *\n   * @param id The ID of the toolbox item.\n   * @returns The toolbox item with the given ID, or null if no item exists.\n   */\n  getToolboxItemById(id: string): IToolboxItem|null {\n    return this.contentMap_[id] || null;\n  }\n\n  /**\n   * Gets the width of the toolbox.\n   *\n   * @returns The width of the toolbox.\n   */\n  getWidth(): number {\n    return this.width_;\n  }\n\n  /**\n   * Gets the height of the toolbox.\n   *\n   * @returns The width of the toolbox.\n   */\n  getHeight(): number {\n    return this.height_;\n  }\n\n  /**\n   * Gets the toolbox flyout.\n   *\n   * @returns The toolbox flyout.\n   */\n  getFlyout(): IFlyout|null {\n    return this.flyout_;\n  }\n\n  /**\n   * Gets the workspace for the toolbox.\n   *\n   * @returns The parent workspace for the toolbox.\n   */\n  getWorkspace(): WorkspaceSvg {\n    return this.workspace_;\n  }\n\n  /**\n   * Gets the selected item.\n   *\n   * @returns The selected item, or null if no item is currently selected.\n   */\n  getSelectedItem(): ISelectableToolboxItem|null {\n    return this.selectedItem_;\n  }\n\n  /**\n   * Gets the previously selected item.\n   *\n   * @returns The previously selected item, or null if no item was previously\n   *     selected.\n   */\n  getPreviouslySelectedItem(): ISelectableToolboxItem|null {\n    return this.previouslySelectedItem_;\n  }\n\n  /**\n   * Gets whether or not the toolbox is horizontal.\n   *\n   * @returns True if the toolbox is horizontal, false if the toolbox is\n   *     vertical.\n   */\n  isHorizontal(): boolean {\n    return this.horizontalLayout_;\n  }\n\n  /**\n   * Positions the toolbox based on whether it is a horizontal toolbox and\n   * whether the workspace is in rtl.\n   */\n  position() {\n    const workspaceMetrics = this.workspace_.getMetrics();\n    const toolboxDiv = this.HtmlDiv;\n    if (!toolboxDiv) {\n      // Not initialized yet.\n      return;\n    }\n\n    if (this.horizontalLayout_) {\n      toolboxDiv.style.left = '0';\n      toolboxDiv.style.height = 'auto';\n      toolboxDiv.style.width = '100%';\n      this.height_ = toolboxDiv.offsetHeight;\n      this.width_ = workspaceMetrics.viewWidth;\n      if (this.toolboxPosition === toolbox.Position.TOP) {\n        toolboxDiv.style.top = '0';\n      } else {  // Bottom\n        toolboxDiv.style.bottom = '0';\n      }\n    } else {\n      if (this.toolboxPosition === toolbox.Position.RIGHT) {\n        toolboxDiv.style.right = '0';\n      } else {  // Left\n        toolboxDiv.style.left = '0';\n      }\n      toolboxDiv.style.height = '100%';\n      this.width_ = toolboxDiv.offsetWidth;\n      this.height_ = workspaceMetrics.viewHeight;\n    }\n    this.flyout_!.position();\n  }\n\n  /**\n   * Handles resizing the toolbox when a toolbox item resizes.\n   *\n   * @internal\n   */\n  handleToolboxItemResize() {\n    // Reposition the workspace so that (0,0) is in the correct position\n    // relative to the new absolute edge (ie toolbox edge).\n    const workspace = this.workspace_;\n    const rect = this.HtmlDiv!.getBoundingClientRect();\n    const newX = this.toolboxPosition === toolbox.Position.LEFT ?\n        workspace.scrollX + rect.width :\n        workspace.scrollX;\n    const newY = this.toolboxPosition === toolbox.Position.TOP ?\n        workspace.scrollY + rect.height :\n        workspace.scrollY;\n    workspace.translate(newX, newY);\n\n    // Even though the div hasn't changed size, the visible workspace\n    // surface of the workspace has, so we may need to reposition everything.\n    common.svgResize(workspace);\n  }\n\n  /** Unhighlights any previously selected item. */\n  clearSelection() {\n    this.setSelectedItem(null);\n  }\n\n  /**\n   * Updates the category colours and background colour of selected categories.\n   *\n   * @internal\n   */\n  refreshTheme() {\n    for (let i = 0; i < this.contents_.length; i++) {\n      const child = this.contents_[i];\n      // TODO(#6097): Fix types or add refreshTheme to IToolboxItem.\n      const childAsCategory = child as ToolboxCategory;\n      if (childAsCategory.refreshTheme) {\n        childAsCategory.refreshTheme();\n      }\n    }\n  }\n\n  /**\n   * Updates the flyout's content without closing it.  Should be used in\n   * response to a change in one of the dynamic categories, such as variables or\n   * procedures.\n   */\n  refreshSelection() {\n    if (this.selectedItem_ && this.selectedItem_.isSelectable() &&\n        this.selectedItem_.getContents().length) {\n      this.flyout_!.show(this.selectedItem_.getContents());\n    }\n  }\n\n  /**\n   * Shows or hides the toolbox.\n   *\n   * @param isVisible True if toolbox should be visible.\n   */\n  setVisible(isVisible: boolean) {\n    if (this.isVisible_ === isVisible) {\n      return;\n    }\n\n    this.HtmlDiv!.style.display = isVisible ? 'block' : 'none';\n    this.isVisible_ = isVisible;\n    // Invisible toolbox is ignored as drag targets and must have the drag\n    // target updated.\n    this.workspace_.recordDragTargets();\n  }\n\n  /**\n   * Hides the component. Called in WorkspaceSvg.hideChaff.\n   *\n   * @param onlyClosePopups Whether only popups should be closed.\n   *     Flyouts should not be closed if this is true.\n   */\n  autoHide(onlyClosePopups: boolean) {\n    if (!onlyClosePopups && this.flyout_ && this.flyout_.autoClose) {\n      this.clearSelection();\n    }\n  }\n\n  /**\n   * Sets the given item as selected.\n   * No-op if the item is not selectable.\n   *\n   * @param newItem The toolbox item to select.\n   */\n  setSelectedItem(newItem: IToolboxItem|null) {\n    const oldItem = this.selectedItem_;\n\n    if (!newItem && !oldItem || newItem && !newItem.isSelectable()) {\n      return;\n    }\n    newItem = newItem as ISelectableToolboxItem;\n\n    // AnyDuringMigration because:  Argument of type 'IToolboxItem' is not\n    // assignable to parameter of type 'ISelectableToolboxItem'.\n    if (this.shouldDeselectItem_(oldItem, newItem as AnyDuringMigration) &&\n        oldItem !== null) {\n      this.deselectItem_(oldItem);\n    }\n\n    // AnyDuringMigration because:  Argument of type 'IToolboxItem' is not\n    // assignable to parameter of type 'ISelectableToolboxItem'.\n    if (this.shouldSelectItem_(oldItem, newItem as AnyDuringMigration) &&\n        newItem !== null) {\n      // AnyDuringMigration because:  Argument of type 'IToolboxItem' is not\n      // assignable to parameter of type 'ISelectableToolboxItem'.\n      this.selectItem_(oldItem, newItem as AnyDuringMigration);\n    }\n\n    // AnyDuringMigration because:  Argument of type 'IToolboxItem' is not\n    // assignable to parameter of type 'ISelectableToolboxItem'.\n    this.updateFlyout_(oldItem, newItem as AnyDuringMigration);\n    // AnyDuringMigration because:  Argument of type 'IToolboxItem' is not\n    // assignable to parameter of type 'ISelectableToolboxItem'.\n    this.fireSelectEvent_(oldItem, newItem as AnyDuringMigration);\n  }\n\n  /**\n   * Decides whether the old item should be deselected.\n   *\n   * @param oldItem The previously selected toolbox item.\n   * @param newItem The newly selected toolbox item.\n   * @returns True if the old item should be deselected, false otherwise.\n   */\n  protected shouldDeselectItem_(\n      oldItem: ISelectableToolboxItem|null,\n      newItem: ISelectableToolboxItem|null): boolean {\n    // Deselect the old item unless the old item is collapsible and has been\n    // previously clicked on.\n    return oldItem !== null &&\n        (!oldItem.isCollapsible() || oldItem !== newItem);\n  }\n\n  /**\n   * Decides whether the new item should be selected.\n   *\n   * @param oldItem The previously selected toolbox item.\n   * @param newItem The newly selected toolbox item.\n   * @returns True if the new item should be selected, false otherwise.\n   */\n  protected shouldSelectItem_(\n      oldItem: ISelectableToolboxItem|null,\n      newItem: ISelectableToolboxItem|null): boolean {\n    // Select the new item unless the old item equals the new item.\n    return newItem !== null && newItem !== oldItem;\n  }\n\n  /**\n   * Deselects the given item, marks it as unselected, and updates aria state.\n   *\n   * @param item The previously selected toolbox item which should be\n   *     deselected.\n   */\n  protected deselectItem_(item: ISelectableToolboxItem) {\n    this.selectedItem_ = null;\n    this.previouslySelectedItem_ = item;\n    item.setSelected(false);\n    aria.setState(\n        this.contentsDiv_ as Element, aria.State.ACTIVEDESCENDANT, '');\n  }\n\n  /**\n   * Selects the given item, marks it selected, and updates aria state.\n   *\n   * @param oldItem The previously selected toolbox item.\n   * @param newItem The newly selected toolbox item.\n   */\n  protected selectItem_(\n      oldItem: ISelectableToolboxItem|null, newItem: ISelectableToolboxItem) {\n    this.selectedItem_ = newItem;\n    this.previouslySelectedItem_ = oldItem;\n    newItem.setSelected(true);\n    aria.setState(\n        this.contentsDiv_ as Element, aria.State.ACTIVEDESCENDANT,\n        newItem.getId());\n  }\n\n  /**\n   * Selects the toolbox item by its position in the list of toolbox items.\n   *\n   * @param position The position of the item to select.\n   */\n  selectItemByPosition(position: number) {\n    if (position > -1 && position < this.contents_.length) {\n      const item = this.contents_[position];\n      if (item.isSelectable()) {\n        this.setSelectedItem(item);\n      }\n    }\n  }\n\n  /**\n   * Decides whether to hide or show the flyout depending on the selected item.\n   *\n   * @param oldItem The previously selected toolbox item.\n   * @param newItem The newly selected toolbox item.\n   */\n  protected updateFlyout_(\n      oldItem: ISelectableToolboxItem|null,\n      newItem: ISelectableToolboxItem|null) {\n    if (!newItem || oldItem === newItem && !newItem.isCollapsible() ||\n        !newItem.getContents().length) {\n      this.flyout_!.hide();\n    } else {\n      this.flyout_!.show(newItem.getContents());\n      this.flyout_!.scrollToStart();\n    }\n  }\n\n  /**\n   * Emits an event when a new toolbox item is selected.\n   *\n   * @param oldItem The previously selected toolbox item.\n   * @param newItem The newly selected toolbox item.\n   */\n  private fireSelectEvent_(\n      oldItem: ISelectableToolboxItem|null,\n      newItem: ISelectableToolboxItem|null) {\n    const oldElement = oldItem && oldItem.getName();\n    let newElement = newItem && newItem.getName();\n    // In this case the toolbox closes, so the newElement should be null.\n    if (oldItem === newItem) {\n      newElement = null;\n    }\n    const event = new (eventUtils.get(eventUtils.TOOLBOX_ITEM_SELECT))(\n        oldElement, newElement, this.workspace_.id);\n    eventUtils.fire(event);\n  }\n\n  /**\n   * Closes the current item if it is expanded, or selects the parent.\n   *\n   * @returns True if a parent category was selected, false otherwise.\n   */\n  private selectParent_(): boolean {\n    if (!this.selectedItem_) {\n      return false;\n    }\n\n    if (this.selectedItem_.isCollapsible() &&\n        (this.selectedItem_ as ICollapsibleToolboxItem).isExpanded()) {\n      const collapsibleItem = this.selectedItem_ as ICollapsibleToolboxItem;\n      collapsibleItem.toggleExpanded();\n      return true;\n    } else if (\n        this.selectedItem_.getParent() &&\n        this.selectedItem_.getParent()!.isSelectable()) {\n      this.setSelectedItem(this.selectedItem_.getParent());\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Selects the first child of the currently selected item, or nothing if the\n   * toolbox item has no children.\n   *\n   * @returns True if a child category was selected, false otherwise.\n   */\n  private selectChild_(): boolean {\n    if (!this.selectedItem_ || !this.selectedItem_.isCollapsible()) {\n      return false;\n    }\n    const collapsibleItem = this.selectedItem_ as ICollapsibleToolboxItem;\n    if (!collapsibleItem.isExpanded()) {\n      collapsibleItem.toggleExpanded();\n      return true;\n    } else {\n      this.selectNext_();\n      return true;\n    }\n  }\n\n  /**\n   * Selects the next visible toolbox item.\n   *\n   * @returns True if a next category was selected, false otherwise.\n   */\n  private selectNext_(): boolean {\n    if (!this.selectedItem_) {\n      return false;\n    }\n\n    let nextItemIdx = this.contents_.indexOf(this.selectedItem_) + 1;\n    if (nextItemIdx > -1 && nextItemIdx < this.contents_.length) {\n      let nextItem = this.contents_[nextItemIdx];\n      while (nextItem && !nextItem.isSelectable()) {\n        nextItem = this.contents_[++nextItemIdx];\n      }\n      if (nextItem && nextItem.isSelectable()) {\n        this.setSelectedItem(nextItem);\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Selects the previous visible toolbox item.\n   *\n   * @returns True if a previous category was selected, false otherwise.\n   */\n  private selectPrevious_(): boolean {\n    if (!this.selectedItem_) {\n      return false;\n    }\n\n    let prevItemIdx = this.contents_.indexOf(this.selectedItem_) - 1;\n    if (prevItemIdx > -1 && prevItemIdx < this.contents_.length) {\n      let prevItem = this.contents_[prevItemIdx];\n      while (prevItem && !prevItem.isSelectable()) {\n        prevItem = this.contents_[--prevItemIdx];\n      }\n      if (prevItem && prevItem.isSelectable()) {\n        this.setSelectedItem(prevItem);\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /** Disposes of this toolbox. */\n  dispose() {\n    this.workspace_.getComponentManager().removeComponent('toolbox');\n    this.flyout_!.dispose();\n    for (let i = 0; i < this.contents_.length; i++) {\n      const toolboxItem = this.contents_[i];\n      toolboxItem.dispose();\n    }\n\n    for (let j = 0; j < this.boundEvents_.length; j++) {\n      browserEvents.unbind(this.boundEvents_[j]);\n    }\n    this.boundEvents_ = [];\n    this.contents_ = [];\n\n    // AnyDuringMigration because:  Argument of type 'HTMLDivElement | null' is\n    // not assignable to parameter of type 'Element'.\n    this.workspace_.getThemeManager().unsubscribe(\n        this.HtmlDiv as AnyDuringMigration);\n    dom.removeNode(this.HtmlDiv);\n  }\n}\n\n/** CSS for Toolbox.  See css.js for use. */\nCss.register(`\n.blocklyToolboxDelete {\n  cursor: url(\"<<<PATH>>>/handdelete.cur\"), auto;\n}\n\n.blocklyToolboxGrab {\n  cursor: url(\"<<<PATH>>>/handclosed.cur\"), auto;\n  cursor: grabbing;\n  cursor: -webkit-grabbing;\n}\n\n/* Category tree in Toolbox. */\n.blocklyToolboxDiv {\n  background-color: #ddd;\n  overflow-x: visible;\n  overflow-y: auto;\n  padding: 4px 0 4px 0;\n  position: absolute;\n  z-index: 70;  /* so blocks go under toolbox when dragging */\n  -webkit-tap-highlight-color: transparent;  /* issue #1345 */\n}\n\n.blocklyToolboxContents {\n  display: flex;\n  flex-wrap: wrap;\n  flex-direction: column;\n}\n\n.blocklyToolboxContents:focus {\n  outline: none;\n}\n`);\n\nregistry.register(registry.Type.TOOLBOX, registry.DEFAULT, Toolbox);\n","/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Zelos theme.\n *\n * @namespace Blockly.Themes.Zelos\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Themes.Zelos');\n\nimport {Theme} from '../theme.js';\n\n\nconst defaultBlockStyles = {\n  'colour_blocks': {\n    'colourPrimary': '#CF63CF',\n    'colourSecondary': '#C94FC9',\n    'colourTertiary': '#BD42BD',\n  },\n  'list_blocks': {\n    'colourPrimary': '#9966FF',\n    'colourSecondary': '#855CD6',\n    'colourTertiary': '#774DCB',\n  },\n  'logic_blocks': {\n    'colourPrimary': '#4C97FF',\n    'colourSecondary': '#4280D7',\n    'colourTertiary': '#3373CC',\n  },\n  'loop_blocks': {\n    'colourPrimary': '#0fBD8C',\n    'colourSecondary': '#0DA57A',\n    'colourTertiary': '#0B8E69',\n  },\n  'math_blocks': {\n    'colourPrimary': '#59C059',\n    'colourSecondary': '#46B946',\n    'colourTertiary': '#389438',\n  },\n  'procedure_blocks': {\n    'colourPrimary': '#FF6680',\n    'colourSecondary': '#FF4D6A',\n    'colourTertiary': '#FF3355',\n  },\n  'text_blocks': {\n    'colourPrimary': '#FFBF00',\n    'colourSecondary': '#E6AC00',\n    'colourTertiary': '#CC9900',\n  },\n  'variable_blocks': {\n    'colourPrimary': '#FF8C1A',\n    'colourSecondary': '#FF8000',\n    'colourTertiary': '#DB6E00',\n  },\n  'variable_dynamic_blocks': {\n    'colourPrimary': '#FF8C1A',\n    'colourSecondary': '#FF8000',\n    'colourTertiary': '#DB6E00',\n  },\n  'hat_blocks': {\n    'colourPrimary': '#4C97FF',\n    'colourSecondary': '#4280D7',\n    'colourTertiary': '#3373CC',\n    'hat': 'cap',\n  },\n};\n\nconst categoryStyles = {\n  'colour_category': {'colour': '#CF63CF'},\n  'list_category': {'colour': '#9966FF'},\n  'logic_category': {'colour': '#4C97FF'},\n  'loop_category': {'colour': '#0fBD8C'},\n  'math_category': {'colour': '#59C059'},\n  'procedure_category': {'colour': '#FF6680'},\n  'text_category': {'colour': '#FFBF00'},\n  'variable_category': {'colour': '#FF8C1A'},\n  'variable_dynamic_category': {'colour': '#FF8C1A'},\n};\n\n/**\n * Zelos theme.\n *\n * @alias Blockly.Themes.Zelos\n */\nexport const Zelos = new Theme('zelos', defaultBlockStyles, categoryStyles);\n","/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Namespace for themes.\n *\n * @namespace Blockly.Themes\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Themes');\n\nimport {Classic} from './classic.js';\nimport {Zelos} from './zelos.js';\n\n\nexport {Classic, Zelos};\n","/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Events fired as a result of UI click in Blockly's editor.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events.Click');\n\nimport type {Block} from '../block.js';\nimport * as deprecation from '../utils/deprecation.js';\nimport * as registry from '../registry.js';\nimport {AbstractEventJson} from './events_abstract.js';\n\nimport {UiBase} from './events_ui_base.js';\nimport * as eventUtils from './utils.js';\nimport {Workspace} from '../workspace.js';\n\n\n/**\n * Class for a click event.\n *\n * @alias Blockly.Events.Click\n */\nexport class Click extends UiBase {\n  blockId?: string;\n  targetType?: ClickTarget;\n  override type = eventUtils.CLICK;\n\n  /**\n   * @param opt_block The affected block. Null for click events that do not have\n   *     an associated block (i.e. workspace click). Undefined for a blank\n   *     event.\n   * @param opt_workspaceId The workspace identifier for this event.\n   *    Not used if block is passed. Undefined for a blank event.\n   * @param opt_targetType The type of element targeted by this click event.\n   *     Undefined for a blank event.\n   */\n  constructor(\n      opt_block?: Block|null, opt_workspaceId?: string|null,\n      opt_targetType?: ClickTarget) {\n    let workspaceId = opt_block ? opt_block.workspace.id : opt_workspaceId;\n    if (workspaceId === null) {\n      workspaceId = undefined;\n    }\n    super(workspaceId);\n\n    this.blockId = opt_block ? opt_block.id : undefined;\n\n    /** The type of element targeted by this click event. */\n    this.targetType = opt_targetType;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): ClickJson {\n    const json = super.toJson() as ClickJson;\n    if (!this.targetType) {\n      throw new Error(\n          'The click target type is undefined. Either pass a block to ' +\n          'the constructor, or call fromJson');\n    }\n    json['targetType'] = this.targetType;\n    json['blockId'] = this.blockId;\n    return json;\n  }\n\n  /**\n   * Decode the JSON event.\n   *\n   * @param json JSON representation.\n   */\n  override fromJson(json: ClickJson) {\n    deprecation.warn(\n        'Blockly.Events.Click.prototype.fromJson', 'version 9', 'version 10',\n        'Blockly.Events.fromJson');\n    super.fromJson(json);\n    this.targetType = json['targetType'];\n    this.blockId = json['blockId'];\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of Click, but we can't specify that due to the fact that parameters to\n   *     static methods in subclasses must be supertypes of parameters to\n   *     static methods in superclasses.\n   * @internal\n   */\n  static fromJson(json: ClickJson, workspace: Workspace, event?: any): Click {\n    const newEvent =\n        super.fromJson(json, workspace, event ?? new Click()) as Click;\n    newEvent.targetType = json['targetType'];\n    newEvent.blockId = json['blockId'];\n    return newEvent;\n  }\n}\n\nexport enum ClickTarget {\n  BLOCK = 'block',\n  WORKSPACE = 'workspace',\n  ZOOM_CONTROLS = 'zoom_controls',\n}\n\nexport interface ClickJson extends AbstractEventJson {\n  targetType: ClickTarget;\n  blockId?: string;\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.CLICK, Click);\n","/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Methods for dragging a bubble visually.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.BubbleDragger');\n\nimport type {BlockDragSurfaceSvg} from './block_drag_surface.js';\nimport {ComponentManager} from './component_manager.js';\nimport type {CommentMove} from './events/events_comment_move.js';\nimport * as eventUtils from './events/utils.js';\nimport type {IBubble} from './interfaces/i_bubble.js';\nimport type {IDeleteArea} from './interfaces/i_delete_area.js';\nimport type {IDragTarget} from './interfaces/i_drag_target.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport {WorkspaceCommentSvg} from './workspace_comment_svg.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/**\n * Class for a bubble dragger.  It moves things on the bubble canvas around the\n * workspace when they are being dragged by a mouse or touch.  These can be\n * block comments, mutators, warnings, or workspace comments.\n *\n * @alias Blockly.BubbleDragger\n */\nexport class BubbleDragger {\n  /** Which drag target the mouse pointer is over, if any. */\n  private dragTarget_: IDragTarget|null = null;\n\n  /** Whether the bubble would be deleted if dropped immediately. */\n  private wouldDeleteBubble_ = false;\n  private readonly startXY_: Coordinate;\n  private dragSurface_: BlockDragSurfaceSvg|null;\n\n  /**\n   * @param bubble The item on the bubble canvas to drag.\n   * @param workspace The workspace to drag on.\n   */\n  constructor(private bubble: IBubble, private workspace: WorkspaceSvg) {\n    /**\n     * The location of the top left corner of the dragging bubble's body at the\n     * beginning of the drag, in workspace coordinates.\n     */\n    this.startXY_ = this.bubble.getRelativeToSurfaceXY();\n\n    /**\n     * The drag surface to move bubbles to during a drag, or null if none should\n     * be used.  Block dragging and bubble dragging use the same surface.\n     */\n    this.dragSurface_ = workspace.getBlockDragSurface();\n  }\n\n  /**\n   * Start dragging a bubble.  This includes moving it to the drag surface.\n   *\n   * @internal\n   */\n  startBubbleDrag() {\n    if (!eventUtils.getGroup()) {\n      eventUtils.setGroup(true);\n    }\n\n    this.workspace.setResizesEnabled(false);\n    this.bubble.setAutoLayout(false);\n    if (this.dragSurface_) {\n      this.bubble.moveTo(0, 0);\n      this.dragSurface_.translateSurface(this.startXY_.x, this.startXY_.y);\n      // Execute the move on the top-level SVG component.\n      this.dragSurface_.setBlocksAndShow(this.bubble.getSvgRoot());\n    }\n\n    this.bubble.setDragging && this.bubble.setDragging(true);\n  }\n\n  /**\n   * Execute a step of bubble dragging, based on the given event.  Update the\n   * display accordingly.\n   *\n   * @param e The most recent move event.\n   * @param currentDragDeltaXY How far the pointer has moved from the position\n   *     at the start of the drag, in pixel units.\n   * @internal\n   */\n  dragBubble(e: PointerEvent, currentDragDeltaXY: Coordinate) {\n    const delta = this.pixelsToWorkspaceUnits_(currentDragDeltaXY);\n    const newLoc = Coordinate.sum(this.startXY_, delta);\n    this.bubble.moveDuringDrag(this.dragSurface_, newLoc);\n\n    const oldDragTarget = this.dragTarget_;\n    this.dragTarget_ = this.workspace.getDragTarget(e);\n\n    const oldWouldDeleteBubble = this.wouldDeleteBubble_;\n    this.wouldDeleteBubble_ = this.shouldDelete_(this.dragTarget_);\n    if (oldWouldDeleteBubble !== this.wouldDeleteBubble_) {\n      // Prevent unnecessary add/remove class calls.\n      this.updateCursorDuringBubbleDrag_();\n    }\n    // Call drag enter/exit/over after wouldDeleteBlock is called in\n    // shouldDelete_\n    if (this.dragTarget_ !== oldDragTarget) {\n      oldDragTarget && oldDragTarget.onDragExit(this.bubble);\n      this.dragTarget_ && this.dragTarget_.onDragEnter(this.bubble);\n    }\n    this.dragTarget_ && this.dragTarget_.onDragOver(this.bubble);\n  }\n\n  /**\n   * Whether ending the drag would delete the bubble.\n   *\n   * @param dragTarget The drag target that the bubblee is currently over.\n   * @returns Whether dropping the bubble immediately would delete the block.\n   */\n  private shouldDelete_(dragTarget: IDragTarget|null): boolean {\n    if (dragTarget) {\n      const componentManager = this.workspace.getComponentManager();\n      const isDeleteArea = componentManager.hasCapability(\n          dragTarget.id, ComponentManager.Capability.DELETE_AREA);\n      if (isDeleteArea) {\n        return (dragTarget as IDeleteArea).wouldDelete(this.bubble, false);\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Update the cursor (and possibly the trash can lid) to reflect whether the\n   * dragging bubble would be deleted if released immediately.\n   */\n  private updateCursorDuringBubbleDrag_() {\n    this.bubble.setDeleteStyle(this.wouldDeleteBubble_);\n  }\n\n  /**\n   * Finish a bubble drag and put the bubble back on the workspace.\n   *\n   * @param e The pointerup event.\n   * @param currentDragDeltaXY How far the pointer has moved from the position\n   *     at the start of the drag, in pixel units.\n   * @internal\n   */\n  endBubbleDrag(e: PointerEvent, currentDragDeltaXY: Coordinate) {\n    // Make sure internal state is fresh.\n    this.dragBubble(e, currentDragDeltaXY);\n\n    const preventMove =\n        this.dragTarget_ && this.dragTarget_.shouldPreventMove(this.bubble);\n    let newLoc;\n    if (preventMove) {\n      newLoc = this.startXY_;\n    } else {\n      const delta = this.pixelsToWorkspaceUnits_(currentDragDeltaXY);\n      newLoc = Coordinate.sum(this.startXY_, delta);\n    }\n    // Move the bubble to its final location.\n    this.bubble.moveTo(newLoc.x, newLoc.y);\n\n    if (this.dragTarget_) {\n      this.dragTarget_.onDrop(this.bubble);\n    }\n\n    if (this.wouldDeleteBubble_) {\n      // Fire a move event, so we know where to go back to for an undo.\n      this.fireMoveEvent_();\n      this.bubble.dispose();\n    } else {\n      // Put everything back onto the bubble canvas.\n      if (this.dragSurface_) {\n        this.dragSurface_.clearAndHide(this.workspace.getBubbleCanvas());\n      }\n      if (this.bubble.setDragging) {\n        this.bubble.setDragging(false);\n      }\n      this.fireMoveEvent_();\n    }\n    this.workspace.setResizesEnabled(true);\n\n    eventUtils.setGroup(false);\n  }\n\n  /** Fire a move event at the end of a bubble drag. */\n  private fireMoveEvent_() {\n    if (this.bubble instanceof WorkspaceCommentSvg) {\n      const event = new (eventUtils.get(eventUtils.COMMENT_MOVE))(\n                        this.bubble) as CommentMove;\n      event.setOldCoordinate(this.startXY_);\n      event.recordNew();\n      eventUtils.fire(event);\n    }\n    // TODO (fenichel): move events for comments.\n    return;\n  }\n\n  /**\n   * Convert a coordinate object from pixels to workspace units, including a\n   * correction for mutator workspaces.\n   * This function does not consider differing origins.  It simply scales the\n   * input's x and y values.\n   *\n   * @param pixelCoord A coordinate with x and y values in CSS pixel units.\n   * @returns The input coordinate divided by the workspace scale.\n   */\n  private pixelsToWorkspaceUnits_(pixelCoord: Coordinate): Coordinate {\n    const result = new Coordinate(\n        pixelCoord.x / this.workspace.scale,\n        pixelCoord.y / this.workspace.scale);\n    if (this.workspace.isMutator) {\n      // If we're in a mutator, its scale is always 1, purely because of some\n      // oddities in our rendering optimizations.  The actual scale is the same\n      // as the scale on the parent workspace. Fix that for dragging.\n      const mainScale = this.workspace.options.parentWorkspace!.scale;\n      result.scale(1 / mainScale);\n    }\n    return result;\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Methods for dragging a workspace visually.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.WorkspaceDragger');\n\nimport * as common from './common.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/**\n * Class for a workspace dragger.  It moves the workspace around when it is\n * being dragged by a mouse or touch.\n * Note that the workspace itself manages whether or not it has a drag surface\n * and how to do translations based on that.  This simply passes the right\n * commands based on events.\n *\n * @alias Blockly.WorkspaceDragger\n */\nexport class WorkspaceDragger {\n  private readonly horizontalScrollEnabled_: boolean;\n  private readonly verticalScrollEnabled_: boolean;\n  protected startScrollXY_: Coordinate;\n\n  /** @param workspace The workspace to drag. */\n  constructor(private workspace: WorkspaceSvg) {\n    /** Whether horizontal scroll is enabled. */\n    this.horizontalScrollEnabled_ = this.workspace.isMovableHorizontally();\n\n    /** Whether vertical scroll is enabled. */\n    this.verticalScrollEnabled_ = this.workspace.isMovableVertically();\n\n    /**\n     * The scroll position of the workspace at the beginning of the drag.\n     * Coordinate system: pixel coordinates.\n     */\n    this.startScrollXY_ = new Coordinate(workspace.scrollX, workspace.scrollY);\n  }\n\n  /**\n   * Sever all links from this object.\n   *\n   * @suppress {checkTypes}\n   * @internal\n   */\n  dispose() {\n    // AnyDuringMigration because:  Type 'null' is not assignable to type\n    // 'WorkspaceSvg'.\n    this.workspace = null as AnyDuringMigration;\n  }\n\n  /**\n   * Start dragging the workspace.\n   *\n   * @internal\n   */\n  startDrag() {\n    if (common.getSelected()) {\n      common.getSelected()!.unselect();\n    }\n    this.workspace.setupDragSurface();\n  }\n\n  /**\n   * Finish dragging the workspace and put everything back where it belongs.\n   *\n   * @param currentDragDeltaXY How far the pointer has moved from the position\n   *     at the start of the drag, in pixel coordinates.\n   * @internal\n   */\n  endDrag(currentDragDeltaXY: Coordinate) {\n    // Make sure everything is up to date.\n    this.drag(currentDragDeltaXY);\n    this.workspace.resetDragSurface();\n  }\n\n  /**\n   * Move the workspace based on the most recent mouse movements.\n   *\n   * @param currentDragDeltaXY How far the pointer has moved from the position\n   *     at the start of the drag, in pixel coordinates.\n   * @internal\n   */\n  drag(currentDragDeltaXY: Coordinate) {\n    const newXY = Coordinate.sum(this.startScrollXY_, currentDragDeltaXY);\n\n    if (this.horizontalScrollEnabled_ && this.verticalScrollEnabled_) {\n      this.workspace.scroll(newXY.x, newXY.y);\n    } else if (this.horizontalScrollEnabled_) {\n      this.workspace.scroll(newXY.x, this.workspace.scrollY);\n    } else if (this.verticalScrollEnabled_) {\n      this.workspace.scroll(this.workspace.scrollX, newXY.y);\n    } else {\n      throw new TypeError('Invalid state.');\n    }\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The class representing an in-progress gesture, e.g. a drag,\n * tap, or pinch to zoom.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Gesture');\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_click.js';\n\nimport * as blockAnimations from './block_animations.js';\nimport type {BlockSvg} from './block_svg.js';\nimport * as browserEvents from './browser_events.js';\nimport {BubbleDragger} from './bubble_dragger.js';\nimport * as common from './common.js';\nimport {config} from './config.js';\nimport * as dropDownDiv from './dropdowndiv.js';\nimport * as eventUtils from './events/utils.js';\nimport type {Field} from './field.js';\nimport type {IBlockDragger} from './interfaces/i_block_dragger.js';\nimport type {IBubble} from './interfaces/i_bubble.js';\nimport type {IFlyout} from './interfaces/i_flyout.js';\nimport * as internalConstants from './internal_constants.js';\nimport * as registry from './registry.js';\nimport * as Tooltip from './tooltip.js';\nimport * as Touch from './touch.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport {WorkspaceCommentSvg} from './workspace_comment_svg.js';\nimport {WorkspaceDragger} from './workspace_dragger.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/**\n * Note: In this file \"start\" refers to pointerdown\n * events.  \"End\" refers to pointerup events.\n */\n\n/** A multiplier used to convert the gesture scale to a zoom in delta. */\nconst ZOOM_IN_MULTIPLIER = 5;\n\n/** A multiplier used to convert the gesture scale to a zoom out delta. */\nconst ZOOM_OUT_MULTIPLIER = 6;\n\n/**\n * Class for one gesture.\n *\n * @alias Blockly.Gesture\n */\nexport class Gesture {\n  /**\n   * The position of the pointer when the gesture started.  Units are CSS\n   * pixels, with (0, 0) at the top left of the browser window (pointer event\n   * clientX/Y).\n   */\n  private mouseDownXY_ = new Coordinate(0, 0);\n  private currentDragDeltaXY_: Coordinate;\n\n  /**\n   * The bubble that the gesture started on, or null if it did not start on a\n   * bubble.\n   */\n  private startBubble_: IBubble|null = null;\n\n  /**\n   * The field that the gesture started on, or null if it did not start on a\n   * field.\n   */\n  private startField_: Field|null = null;\n\n  /**\n   * The block that the gesture started on, or null if it did not start on a\n   * block.\n   */\n  private startBlock_: BlockSvg|null = null;\n\n  /**\n   * The block that this gesture targets.  If the gesture started on a\n   * shadow block, this is the first non-shadow parent of the block.  If the\n   * gesture started in the flyout, this is the root block of the block group\n   * that was clicked or dragged.\n   */\n  private targetBlock_: BlockSvg|null = null;\n\n  /**\n   * The workspace that the gesture started on.  There may be multiple\n   * workspaces on a page; this is more accurate than using\n   * Blockly.common.getMainWorkspace().\n   */\n  protected startWorkspace_: WorkspaceSvg|null = null;\n\n  /**\n   * Whether the pointer has at any point moved out of the drag radius.\n   * A gesture that exceeds the drag radius is a drag even if it ends exactly\n   * at its start point.\n   */\n  private hasExceededDragRadius_ = false;\n\n  /**\n   * A handle to use to unbind a pointermove listener at the end of a drag.\n   * Opaque data returned from Blockly.bindEventWithChecks_.\n   */\n  protected onMoveWrapper_: browserEvents.Data|null = null;\n\n  /**\n   * A handle to use to unbind a pointerup listener at the end of a drag.\n   * Opaque data returned from Blockly.bindEventWithChecks_.\n   */\n  protected onUpWrapper_: browserEvents.Data|null = null;\n\n  /** The object tracking a bubble drag, or null if none is in progress. */\n  private bubbleDragger_: BubbleDragger|null = null;\n\n  /** The object tracking a block drag, or null if none is in progress. */\n  private blockDragger_: IBlockDragger|null = null;\n\n  /**\n   * The object tracking a workspace or flyout workspace drag, or null if none\n   * is in progress.\n   */\n  private workspaceDragger_: WorkspaceDragger|null = null;\n\n  /** The flyout a gesture started in, if any. */\n  private flyout_: IFlyout|null = null;\n\n  /** Boolean for sanity-checking that some code is only called once. */\n  private calledUpdateIsDragging_ = false;\n\n  /** Boolean for sanity-checking that some code is only called once. */\n  private hasStarted_ = false;\n\n  /** Boolean used internally to break a cycle in disposal. */\n  protected isEnding_ = false;\n  private healStack_: boolean;\n\n  /** The event that most recently updated this gesture. */\n  private mostRecentEvent_: PointerEvent;\n\n  /** Boolean for whether or not this gesture is a multi-touch gesture. */\n  private isMultiTouch_ = false;\n\n  /** A map of cached points used for tracking multi-touch gestures. */\n  private cachedPoints = new Map<string, Coordinate|null>();\n\n  /**\n   * This is the ratio between the starting distance between the touch points\n   * and the most recent distance between the touch points.\n   * Scales between 0 and 1 mean the most recent zoom was a zoom out.\n   * Scales above 1.0 mean the most recent zoom was a zoom in.\n   */\n  private previousScale_ = 0;\n\n  /** The starting distance between two touch points. */\n  private startDistance_ = 0;\n\n  /**\n   * A handle to use to unbind the second pointerdown listener\n   * at the end of a drag.\n   * Opaque data returned from Blockly.bindEventWithChecks_.\n   */\n  private onStartWrapper_: browserEvents.Data|null = null;\n\n  /** Boolean for whether or not the workspace supports pinch-zoom. */\n  private isPinchZoomEnabled_: boolean|null = null;\n\n  /**\n   * The owner of the dropdownDiv when this gesture first starts.\n   * Needed because we'll close the dropdown before fields get to\n   * act on their events, and some fields care about who owns\n   * the dropdown.\n   */\n  currentDropdownOwner: Field|null = null;\n\n  /**\n   * @param e The event that kicked off this gesture.\n   * @param creatorWorkspace The workspace that created this gesture and has a\n   *     reference to it.\n   */\n  constructor(\n      e: PointerEvent, private readonly creatorWorkspace: WorkspaceSvg) {\n    this.mostRecentEvent_ = e;\n\n    /**\n     * How far the pointer has moved during this drag, in pixel units.\n     * (0, 0) is at this.mouseDownXY_.\n     */\n    this.currentDragDeltaXY_ = new Coordinate(0, 0);\n\n    /**\n     * Boolean used to indicate whether or not to heal the stack after\n     * disconnecting a block.\n     */\n    this.healStack_ = !internalConstants.DRAG_STACK;\n  }\n\n  /**\n   * Sever all links from this object.\n   *\n   * @internal\n   */\n  dispose() {\n    Touch.clearTouchIdentifier();\n    Tooltip.unblock();\n    // Clear the owner's reference to this gesture.\n    this.creatorWorkspace.clearGesture();\n\n    if (this.onMoveWrapper_) {\n      browserEvents.unbind(this.onMoveWrapper_);\n    }\n    if (this.onUpWrapper_) {\n      browserEvents.unbind(this.onUpWrapper_);\n    }\n\n    if (this.blockDragger_) {\n      this.blockDragger_.dispose();\n    }\n    if (this.workspaceDragger_) {\n      this.workspaceDragger_.dispose();\n    }\n\n    if (this.onStartWrapper_) {\n      browserEvents.unbind(this.onStartWrapper_);\n    }\n  }\n\n  /**\n   * Update internal state based on an event.\n   *\n   * @param e The most recent pointer event.\n   */\n  private updateFromEvent_(e: PointerEvent) {\n    const currentXY = new Coordinate(e.clientX, e.clientY);\n    const changed = this.updateDragDelta_(currentXY);\n    // Exceeded the drag radius for the first time.\n    if (changed) {\n      this.updateIsDragging_();\n      Touch.longStop();\n    }\n    this.mostRecentEvent_ = e;\n  }\n\n  /**\n   * DO MATH to set currentDragDeltaXY_ based on the most recent pointer\n   * position.\n   *\n   * @param currentXY The most recent pointer position, in pixel units,\n   *     with (0, 0) at the window's top left corner.\n   * @returns True if the drag just exceeded the drag radius for the first time.\n   */\n  private updateDragDelta_(currentXY: Coordinate): boolean {\n    this.currentDragDeltaXY_ =\n        Coordinate.difference(currentXY, (this.mouseDownXY_));\n\n    if (!this.hasExceededDragRadius_) {\n      const currentDragDelta = Coordinate.magnitude(this.currentDragDeltaXY_);\n\n      // The flyout has a different drag radius from the rest of Blockly.\n      const limitRadius =\n          this.flyout_ ? config.flyoutDragRadius : config.dragRadius;\n\n      this.hasExceededDragRadius_ = currentDragDelta > limitRadius;\n      return this.hasExceededDragRadius_;\n    }\n    return false;\n  }\n\n  /**\n   * Update this gesture to record whether a block is being dragged from the\n   * flyout.\n   * This function should be called on a pointermove event the first time\n   * the drag radius is exceeded.  It should be called no more than once per\n   * gesture. If a block should be dragged from the flyout this function creates\n   * the new block on the main workspace and updates targetBlock_ and\n   * startWorkspace_.\n   *\n   * @returns True if a block is being dragged from the flyout.\n   */\n  private updateIsDraggingFromFlyout_(): boolean {\n    if (!this.targetBlock_ ||\n        !this.flyout_?.isBlockCreatable(this.targetBlock_)) {\n      return false;\n    }\n    if (!this.flyout_.targetWorkspace) {\n      throw new Error(`Cannot update dragging from the flyout because the ' +\n          'flyout's target workspace is undefined`);\n    }\n    if (!this.flyout_.isScrollable() ||\n        this.flyout_.isDragTowardWorkspace(this.currentDragDeltaXY_)) {\n      this.startWorkspace_ = this.flyout_.targetWorkspace;\n      this.startWorkspace_.updateScreenCalculationsIfScrolled();\n      // Start the event group now, so that the same event group is used for\n      // block creation and block dragging.\n      if (!eventUtils.getGroup()) {\n        eventUtils.setGroup(true);\n      }\n      // The start block is no longer relevant, because this is a drag.\n      this.startBlock_ = null;\n      this.targetBlock_ = this.flyout_.createBlock(this.targetBlock_);\n      this.targetBlock_.select();\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Update this gesture to record whether a bubble is being dragged.\n   * This function should be called on a pointermove event the first time\n   * the drag radius is exceeded.  It should be called no more than once per\n   * gesture. If a bubble should be dragged this function creates the necessary\n   * BubbleDragger and starts the drag.\n   *\n   * @returns True if a bubble is being dragged.\n   */\n  private updateIsDraggingBubble_(): boolean {\n    if (!this.startBubble_) {\n      return false;\n    }\n\n    this.startDraggingBubble_();\n    return true;\n  }\n\n  /**\n   * Check whether to start a block drag. If a block should be dragged, either\n   * from the flyout or in the workspace, create the necessary BlockDragger and\n   * start the drag.\n   *\n   * This function should be called on a pointermove event the first time\n   * the drag radius is exceeded.  It should be called no more than once per\n   * gesture. If a block should be dragged, either from the flyout or in the\n   * workspace, this function creates the necessary BlockDragger and starts the\n   * drag.\n   *\n   * @returns True if a block is being dragged.\n   */\n  private updateIsDraggingBlock_(): boolean {\n    if (!this.targetBlock_) {\n      return false;\n    }\n    if (this.flyout_) {\n      if (this.updateIsDraggingFromFlyout_()) {\n        this.startDraggingBlock_();\n        return true;\n      }\n    } else if (this.targetBlock_.isMovable()) {\n      this.startDraggingBlock_();\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Check whether to start a workspace drag. If a workspace is being dragged,\n   * create the necessary WorkspaceDragger and start the drag.\n   *\n   * This function should be called on a pointermove event the first time\n   * the drag radius is exceeded.  It should be called no more than once per\n   * gesture. If a workspace is being dragged this function creates the\n   * necessary WorkspaceDragger and starts the drag.\n   */\n  private updateIsDraggingWorkspace_() {\n    if (!this.startWorkspace_) {\n      throw new Error(\n          'Cannot update dragging the workspace because the ' +\n          'start workspace is undefined');\n    }\n\n    const wsMovable = this.flyout_ ?\n        this.flyout_.isScrollable() :\n        this.startWorkspace_ && this.startWorkspace_.isDraggable();\n    if (!wsMovable) return;\n\n    this.workspaceDragger_ = new WorkspaceDragger(this.startWorkspace_);\n\n    this.workspaceDragger_.startDrag();\n  }\n\n  /**\n   * Update this gesture to record whether anything is being dragged.\n   * This function should be called on a pointermove event the first time\n   * the drag radius is exceeded.  It should be called no more than once per\n   * gesture.\n   */\n  private updateIsDragging_() {\n    // Sanity check.\n    if (this.calledUpdateIsDragging_) {\n      throw Error('updateIsDragging_ should only be called once per gesture.');\n    }\n    this.calledUpdateIsDragging_ = true;\n\n    // First check if it was a bubble drag.  Bubbles always sit on top of\n    // blocks.\n    if (this.updateIsDraggingBubble_()) {\n      return;\n    }\n    // Then check if it was a block drag.\n    if (this.updateIsDraggingBlock_()) {\n      return;\n    }\n    // Then check if it's a workspace drag.\n    this.updateIsDraggingWorkspace_();\n  }\n\n  /** Create a block dragger and start dragging the selected block. */\n  private startDraggingBlock_() {\n    const BlockDraggerClass = registry.getClassFromOptions(\n        registry.Type.BLOCK_DRAGGER, this.creatorWorkspace.options, true);\n\n    this.blockDragger_ =\n        new BlockDraggerClass!((this.targetBlock_), (this.startWorkspace_));\n    this.blockDragger_!.startDrag(this.currentDragDeltaXY_, this.healStack_);\n    this.blockDragger_!.drag(this.mostRecentEvent_, this.currentDragDeltaXY_);\n  }\n\n  // TODO (fenichel): Possibly combine this and startDraggingBlock_.\n  /** Create a bubble dragger and start dragging the selected bubble. */\n  private startDraggingBubble_() {\n    if (!this.startBubble_) {\n      throw new Error(\n          'Cannot update dragging the bubble because the start ' +\n          'bubble is undefined');\n    }\n    if (!this.startWorkspace_) {\n      throw new Error(\n          'Cannot update dragging the bubble because the start ' +\n          'workspace is undefined');\n    }\n\n    this.bubbleDragger_ =\n        new BubbleDragger(this.startBubble_, this.startWorkspace_);\n    this.bubbleDragger_.startBubbleDrag();\n    this.bubbleDragger_.dragBubble(\n        this.mostRecentEvent_, this.currentDragDeltaXY_);\n  }\n\n  /**\n   * Start a gesture: update the workspace to indicate that a gesture is in\n   * progress and bind pointermove and pointerup handlers.\n   *\n   * @param e A pointerdown event.\n   * @internal\n   */\n  doStart(e: PointerEvent) {\n    if (!this.startWorkspace_) {\n      throw new Error(\n          'Cannot start the touch gesture becauase the start ' +\n          'workspace is undefined');\n    }\n    this.isPinchZoomEnabled_ = this.startWorkspace_.options.zoomOptions &&\n        this.startWorkspace_.options.zoomOptions.pinch;\n\n    if (browserEvents.isTargetInput(e)) {\n      this.cancel();\n      return;\n    }\n\n    this.hasStarted_ = true;\n\n    blockAnimations.disconnectUiStop();\n\n    this.startWorkspace_.updateScreenCalculationsIfScrolled();\n    if (this.startWorkspace_.isMutator) {\n      // Mutator's coordinate system could be out of date because the bubble was\n      // dragged, the block was moved, the parent workspace zoomed, etc.\n      this.startWorkspace_.resize();\n    }\n\n    // Keep track of which field owns the dropdown before we close it.\n    this.currentDropdownOwner = dropDownDiv.getOwner();\n    // Hide chaff also hides the flyout, so don't do it if the click is in a\n    // flyout.\n    this.startWorkspace_.hideChaff(!!this.flyout_);\n\n    this.startWorkspace_.markFocused();\n    this.mostRecentEvent_ = e;\n\n    Tooltip.block();\n\n    if (this.targetBlock_) {\n      this.targetBlock_.select();\n    }\n\n    if (browserEvents.isRightButton(e)) {\n      this.handleRightClick(e);\n      return;\n    }\n\n    if (e.type.toLowerCase() === 'pointerdown' && e.pointerType !== 'mouse') {\n      Touch.longStart(e, this);\n    }\n\n    this.mouseDownXY_ = new Coordinate(e.clientX, e.clientY);\n    this.healStack_ = e.altKey || e.ctrlKey || e.metaKey;\n\n    this.bindMouseEvents(e);\n\n    if (!this.isEnding_) {\n      this.handleTouchStart(e);\n    }\n  }\n\n  /**\n   * Bind gesture events.\n   *\n   * @param e A pointerdown event.\n   * @internal\n   */\n  bindMouseEvents(e: PointerEvent) {\n    this.onStartWrapper_ = browserEvents.conditionalBind(\n        document, 'pointerdown', null, this.handleStart.bind(this),\n        /* opt_noCaptureIdentifier */ true);\n    this.onMoveWrapper_ = browserEvents.conditionalBind(\n        document, 'pointermove', null, this.handleMove.bind(this),\n        /* opt_noCaptureIdentifier */ true);\n    this.onUpWrapper_ = browserEvents.conditionalBind(\n        document, 'pointerup', null, this.handleUp.bind(this),\n        /* opt_noCaptureIdentifier */ true);\n\n    e.preventDefault();\n    e.stopPropagation();\n  }\n\n  /**\n   * Handle a pointerdown event.\n   *\n   * @param e A pointerdown event.\n   * @internal\n   */\n  handleStart(e: PointerEvent) {\n    if (this.isDragging()) {\n      // A drag has already started, so this can no longer be a pinch-zoom.\n      return;\n    }\n    this.handleTouchStart(e);\n\n    if (this.isMultiTouch()) {\n      Touch.longStop();\n    }\n  }\n\n  /**\n   * Handle a pointermove event.\n   *\n   * @param e A pointermove event.\n   * @internal\n   */\n  handleMove(e: PointerEvent) {\n    if ((this.isDragging() && Touch.shouldHandleEvent(e)) ||\n        !this.isMultiTouch()) {\n      this.updateFromEvent_(e);\n      if (this.workspaceDragger_) {\n        this.workspaceDragger_.drag(this.currentDragDeltaXY_);\n      } else if (this.blockDragger_) {\n        this.blockDragger_.drag(\n            this.mostRecentEvent_, this.currentDragDeltaXY_);\n      } else if (this.bubbleDragger_) {\n        this.bubbleDragger_.dragBubble(\n            this.mostRecentEvent_, this.currentDragDeltaXY_);\n      }\n      e.preventDefault();\n      e.stopPropagation();\n    } else if (this.isMultiTouch()) {\n      this.handleTouchMove(e);\n      Touch.longStop();\n    }\n  }\n\n  /**\n   * Handle a pointerup event.\n   *\n   * @param e A pointerup event.\n   * @internal\n   */\n  handleUp(e: PointerEvent) {\n    if (!this.isDragging()) {\n      this.handleTouchEnd(e);\n    }\n    if (!this.isMultiTouch() || this.isDragging()) {\n      if (!Touch.shouldHandleEvent(e)) {\n        return;\n      }\n      this.updateFromEvent_(e);\n      Touch.longStop();\n\n      if (this.isEnding_) {\n        console.log('Trying to end a gesture recursively.');\n        return;\n      }\n      this.isEnding_ = true;\n      // The ordering of these checks is important: drags have higher priority\n      // than clicks.  Fields have higher priority than blocks; blocks have\n      // higher priority than workspaces. The ordering within drags does not\n      // matter, because the three types of dragging are exclusive.\n      if (this.bubbleDragger_) {\n        this.bubbleDragger_.endBubbleDrag(e, this.currentDragDeltaXY_);\n      } else if (this.blockDragger_) {\n        this.blockDragger_.endDrag(e, this.currentDragDeltaXY_);\n      } else if (this.workspaceDragger_) {\n        this.workspaceDragger_.endDrag(this.currentDragDeltaXY_);\n      } else if (this.isBubbleClick_()) {\n        // Bubbles are in front of all fields and blocks.\n        this.doBubbleClick_();\n      } else if (this.isFieldClick_()) {\n        this.doFieldClick_();\n      } else if (this.isBlockClick_()) {\n        this.doBlockClick_();\n      } else if (this.isWorkspaceClick_()) {\n        this.doWorkspaceClick_(e);\n      }\n\n      e.preventDefault();\n      e.stopPropagation();\n\n      this.dispose();\n    } else {\n      e.preventDefault();\n      e.stopPropagation();\n\n      this.dispose();\n    }\n  }\n\n  /**\n   * Handle a pointerdown event and keep track of current\n   * pointers.\n   *\n   * @param e A pointerdown event.\n   * @internal\n   */\n  handleTouchStart(e: PointerEvent) {\n    const pointerId = Touch.getTouchIdentifierFromEvent(e);\n    // store the pointerId in the current list of pointers\n    this.cachedPoints.set(pointerId, this.getTouchPoint(e));\n    const pointers = Array.from(this.cachedPoints.keys());\n    // If two pointers are down, store info\n    if (pointers.length === 2) {\n      const point0 = (this.cachedPoints.get(pointers[0]))!;\n      const point1 = (this.cachedPoints.get(pointers[1]))!;\n      this.startDistance_ = Coordinate.distance(point0, point1);\n      this.isMultiTouch_ = true;\n      e.preventDefault();\n    }\n  }\n\n  /**\n   * Handle a pointermove event and zoom in/out if two pointers\n   * are on the screen.\n   *\n   * @param e A pointermove event.\n   * @internal\n   */\n  handleTouchMove(e: PointerEvent) {\n    const pointerId = Touch.getTouchIdentifierFromEvent(e);\n    // Update the cache\n    this.cachedPoints.set(pointerId, this.getTouchPoint(e));\n\n    if (this.isPinchZoomEnabled_ && this.cachedPoints.size === 2) {\n      this.handlePinch_(e);\n    } else {\n      this.handleMove(e);\n    }\n  }\n\n  /**\n   * Handle pinch zoom gesture.\n   *\n   * @param e A pointermove event.\n   */\n  private handlePinch_(e: PointerEvent) {\n    const pointers = Array.from(this.cachedPoints.keys());\n    // Calculate the distance between the two pointers\n    const point0 = (this.cachedPoints.get(pointers[0]))!;\n    const point1 = (this.cachedPoints.get(pointers[1]))!;\n    const moveDistance = Coordinate.distance(point0, point1);\n    const scale = moveDistance / this.startDistance_;\n\n    if (this.previousScale_ > 0 && this.previousScale_ < Infinity) {\n      const gestureScale = scale - this.previousScale_;\n      const delta = gestureScale > 0 ? gestureScale * ZOOM_IN_MULTIPLIER :\n                                       gestureScale * ZOOM_OUT_MULTIPLIER;\n      if (!this.startWorkspace_) {\n        throw new Error(\n            'Cannot handle a pinch because the start workspace ' +\n            'is undefined');\n      }\n      const workspace = this.startWorkspace_;\n      const position = browserEvents.mouseToSvg(\n          e, workspace.getParentSvg(), workspace.getInverseScreenCTM());\n      workspace.zoom(position.x, position.y, delta);\n    }\n    this.previousScale_ = scale;\n    e.preventDefault();\n  }\n\n  /**\n   * Handle a pointerup event and end the gesture.\n   *\n   * @param e A pointerup event.\n   * @internal\n   */\n  handleTouchEnd(e: PointerEvent) {\n    const pointerId = Touch.getTouchIdentifierFromEvent(e);\n    if (this.cachedPoints.has(pointerId)) {\n      this.cachedPoints.delete(pointerId);\n    }\n    if (this.cachedPoints.size < 2) {\n      this.cachedPoints.clear();\n      this.previousScale_ = 0;\n    }\n  }\n\n  /**\n   * Helper function returning the current touch point coordinate.\n   *\n   * @param e A pointer event.\n   * @returns The current touch point coordinate\n   * @internal\n   */\n  getTouchPoint(e: PointerEvent): Coordinate|null {\n    if (!this.startWorkspace_) {\n      return null;\n    }\n    return new Coordinate(e.pageX, e.pageY);\n  }\n\n  /**\n   * Whether this gesture is part of a multi-touch gesture.\n   *\n   * @returns Whether this gesture is part of a multi-touch gesture.\n   * @internal\n   */\n  isMultiTouch(): boolean {\n    return this.isMultiTouch_;\n  }\n\n  /**\n   * Cancel an in-progress gesture.  If a workspace or block drag is in\n   * progress, end the drag at the most recent location.\n   *\n   * @internal\n   */\n  cancel() {\n    // Disposing of a block cancels in-progress drags, but dragging to a delete\n    // area disposes of a block and leads to recursive disposal. Break that\n    // cycle.\n    if (this.isEnding_) {\n      return;\n    }\n    Touch.longStop();\n    if (this.bubbleDragger_) {\n      this.bubbleDragger_.endBubbleDrag(\n          this.mostRecentEvent_, this.currentDragDeltaXY_);\n    } else if (this.blockDragger_) {\n      this.blockDragger_.endDrag(\n          this.mostRecentEvent_, this.currentDragDeltaXY_);\n    } else if (this.workspaceDragger_) {\n      this.workspaceDragger_.endDrag(this.currentDragDeltaXY_);\n    }\n    this.dispose();\n  }\n\n  /**\n   * Handle a real or faked right-click event by showing a context menu.\n   *\n   * @param e A pointerdown event.\n   * @internal\n   */\n  handleRightClick(e: PointerEvent) {\n    if (this.targetBlock_) {\n      this.bringBlockToFront_();\n      this.targetBlock_.workspace.hideChaff(!!this.flyout_);\n      this.targetBlock_.showContextMenu(e);\n    } else if (this.startBubble_) {\n      this.startBubble_.showContextMenu(e);\n    } else if (this.startWorkspace_ && !this.flyout_) {\n      this.startWorkspace_.hideChaff();\n      this.startWorkspace_.showContextMenu(e);\n    }\n\n    // TODO: Handle right-click on a bubble.\n    e.preventDefault();\n    e.stopPropagation();\n\n    this.dispose();\n  }\n\n  /**\n   * Handle a pointerdown event on a workspace.\n   *\n   * @param e A pointerdown event.\n   * @param ws The workspace the event hit.\n   * @internal\n   */\n  handleWsStart(e: PointerEvent, ws: WorkspaceSvg) {\n    if (this.hasStarted_) {\n      throw Error(\n          'Tried to call gesture.handleWsStart, ' +\n          'but the gesture had already been started.');\n    }\n    this.setStartWorkspace_(ws);\n    this.mostRecentEvent_ = e;\n    this.doStart(e);\n  }\n\n  /**\n   * Fires a workspace click event.\n   *\n   * @param ws The workspace that a user clicks on.\n   */\n  private fireWorkspaceClick_(ws: WorkspaceSvg) {\n    eventUtils.fire(\n        new (eventUtils.get(eventUtils.CLICK))(null, ws.id, 'workspace'));\n  }\n\n  /**\n   * Handle a pointerdown event on a flyout.\n   *\n   * @param e A pointerdown event.\n   * @param flyout The flyout the event hit.\n   * @internal\n   */\n  handleFlyoutStart(e: PointerEvent, flyout: IFlyout) {\n    if (this.hasStarted_) {\n      throw Error(\n          'Tried to call gesture.handleFlyoutStart, ' +\n          'but the gesture had already been started.');\n    }\n    this.setStartFlyout_(flyout);\n    this.handleWsStart(e, flyout.getWorkspace());\n  }\n\n  /**\n   * Handle a pointerdown event on a block.\n   *\n   * @param e A pointerdown event.\n   * @param block The block the event hit.\n   * @internal\n   */\n  handleBlockStart(e: PointerEvent, block: BlockSvg) {\n    if (this.hasStarted_) {\n      throw Error(\n          'Tried to call gesture.handleBlockStart, ' +\n          'but the gesture had already been started.');\n    }\n    this.setStartBlock(block);\n    this.mostRecentEvent_ = e;\n  }\n\n  /**\n   * Handle a pointerdown event on a bubble.\n   *\n   * @param e A pointerdown event.\n   * @param bubble The bubble the event hit.\n   * @internal\n   */\n  handleBubbleStart(e: PointerEvent, bubble: IBubble) {\n    if (this.hasStarted_) {\n      throw Error(\n          'Tried to call gesture.handleBubbleStart, ' +\n          'but the gesture had already been started.');\n    }\n    this.setStartBubble(bubble);\n    this.mostRecentEvent_ = e;\n  }\n\n  /* Begin functions defining what actions to take to execute clicks on each\n   * type of target.  Any developer wanting to add behaviour on clicks should\n   * modify only this code. */\n\n  /** Execute a bubble click. */\n  private doBubbleClick_() {\n    // TODO (#1673): Consistent handling of single clicks.\n    if (this.startBubble_ instanceof WorkspaceCommentSvg) {\n      this.startBubble_.setFocus();\n      this.startBubble_.select();\n    }\n  }\n\n  /** Execute a field click. */\n  private doFieldClick_() {\n    if (!this.startField_) {\n      throw new Error(\n          'Cannot do a field click because the start field is ' +\n          'undefined');\n    }\n\n    // Only show the editor if the field's editor wasn't already open\n    // right before this gesture started.\n    const dropdownAlreadyOpen = this.currentDropdownOwner === this.startField_;\n    if (!dropdownAlreadyOpen) {\n      this.startField_.showEditor(this.mostRecentEvent_);\n    }\n    this.bringBlockToFront_();\n  }\n\n  /** Execute a block click. */\n  private doBlockClick_() {\n    // Block click in an autoclosing flyout.\n    if (this.flyout_ && this.flyout_.autoClose) {\n      if (!this.targetBlock_) {\n        throw new Error(\n            'Cannot do a block click because the target block is ' +\n            'undefined');\n      }\n      if (this.targetBlock_.isEnabled()) {\n        if (!eventUtils.getGroup()) {\n          eventUtils.setGroup(true);\n        }\n        const newBlock = this.flyout_.createBlock(this.targetBlock_);\n        newBlock.scheduleSnapAndBump();\n      }\n    } else {\n      if (!this.startWorkspace_) {\n        throw new Error(\n            'Cannot do a block click because the start workspace ' +\n            'is undefined');\n      }\n      // Clicks events are on the start block, even if it was a shadow.\n      const event = new (eventUtils.get(eventUtils.CLICK))(\n          this.startBlock_, this.startWorkspace_.id, 'block');\n      eventUtils.fire(event);\n    }\n    this.bringBlockToFront_();\n    eventUtils.setGroup(false);\n  }\n\n  /**\n   * Execute a workspace click. When in accessibility mode shift clicking will\n   * move the cursor.\n   *\n   * @param _e A pointerup event.\n   */\n  private doWorkspaceClick_(_e: PointerEvent) {\n    const ws = this.creatorWorkspace;\n    if (common.getSelected()) {\n      common.getSelected()!.unselect();\n    }\n    this.fireWorkspaceClick_(this.startWorkspace_ || ws);\n  }\n\n  /* End functions defining what actions to take to execute clicks on each type\n   * of target. */\n\n  // TODO (fenichel): Move bubbles to the front.\n\n  /**\n   * Move the dragged/clicked block to the front of the workspace so that it is\n   * not occluded by other blocks.\n   */\n  private bringBlockToFront_() {\n    // Blocks in the flyout don't overlap, so skip the work.\n    if (this.targetBlock_ && !this.flyout_) {\n      this.targetBlock_.bringToFront();\n    }\n  }\n\n  /* Begin functions for populating a gesture at pointerdown. */\n\n  /**\n   * Record the field that a gesture started on.\n   *\n   * @param field The field the gesture started on.\n   * @internal\n   */\n  setStartField(field: Field) {\n    if (this.hasStarted_) {\n      throw Error(\n          'Tried to call gesture.setStartField, ' +\n          'but the gesture had already been started.');\n    }\n    if (!this.startField_) {\n      this.startField_ = field;\n    }\n  }\n\n  /**\n   * Record the bubble that a gesture started on\n   *\n   * @param bubble The bubble the gesture started on.\n   * @internal\n   */\n  setStartBubble(bubble: IBubble) {\n    if (!this.startBubble_) {\n      this.startBubble_ = bubble;\n    }\n  }\n\n  /**\n   * Record the block that a gesture started on, and set the target block\n   * appropriately.\n   *\n   * @param block The block the gesture started on.\n   * @internal\n   */\n  setStartBlock(block: BlockSvg) {\n    // If the gesture already went through a bubble, don't set the start block.\n    if (!this.startBlock_ && !this.startBubble_) {\n      this.startBlock_ = block;\n      if (block.isInFlyout && block !== block.getRootBlock()) {\n        this.setTargetBlock_(block.getRootBlock());\n      } else {\n        this.setTargetBlock_(block);\n      }\n    }\n  }\n\n  /**\n   * Record the block that a gesture targets, meaning the block that will be\n   * dragged if this turns into a drag.  If this block is a shadow, that will be\n   * its first non-shadow parent.\n   *\n   * @param block The block the gesture targets.\n   */\n  private setTargetBlock_(block: BlockSvg) {\n    if (block.isShadow()) {\n      // Non-null assertion is fine b/c it is an invariant that shadows always\n      // have parents.\n      this.setTargetBlock_(block.getParent()!);\n    } else {\n      this.targetBlock_ = block;\n    }\n  }\n\n  /**\n   * Record the workspace that a gesture started on.\n   *\n   * @param ws The workspace the gesture started on.\n   */\n  private setStartWorkspace_(ws: WorkspaceSvg) {\n    if (!this.startWorkspace_) {\n      this.startWorkspace_ = ws;\n    }\n  }\n\n  /**\n   * Record the flyout that a gesture started on.\n   *\n   * @param flyout The flyout the gesture started on.\n   */\n  private setStartFlyout_(flyout: IFlyout) {\n    if (!this.flyout_) {\n      this.flyout_ = flyout;\n    }\n  }\n\n  /* End functions for populating a gesture at pointerdown. */\n\n  /* Begin helper functions defining types of clicks.  Any developer wanting\n   * to change the definition of a click should modify only this code. */\n\n  /**\n   * Whether this gesture is a click on a bubble.  This should only be called\n   * when ending a gesture (pointerup).\n   *\n   * @returns Whether this gesture was a click on a bubble.\n   */\n  private isBubbleClick_(): boolean {\n    // A bubble click starts on a bubble and never escapes the drag radius.\n    const hasStartBubble = !!this.startBubble_;\n    return hasStartBubble && !this.hasExceededDragRadius_;\n  }\n\n  /**\n   * Whether this gesture is a click on a block.  This should only be called\n   * when ending a gesture (pointerup).\n   *\n   * @returns Whether this gesture was a click on a block.\n   */\n  private isBlockClick_(): boolean {\n    // A block click starts on a block, never escapes the drag radius, and is\n    // not a field click.\n    const hasStartBlock = !!this.startBlock_;\n    return hasStartBlock && !this.hasExceededDragRadius_ &&\n        !this.isFieldClick_();\n  }\n\n  /**\n   * Whether this gesture is a click on a field.  This should only be called\n   * when ending a gesture (pointerup).\n   *\n   * @returns Whether this gesture was a click on a field.\n   */\n  private isFieldClick_(): boolean {\n    const fieldClickable =\n        this.startField_ ? this.startField_.isClickable() : false;\n    return fieldClickable && !this.hasExceededDragRadius_ &&\n        (!this.flyout_ || !this.flyout_.autoClose);\n  }\n\n  /**\n   * Whether this gesture is a click on a workspace.  This should only be called\n   * when ending a gesture (pointerup).\n   *\n   * @returns Whether this gesture was a click on a workspace.\n   */\n  private isWorkspaceClick_(): boolean {\n    const onlyTouchedWorkspace =\n        !this.startBlock_ && !this.startBubble_ && !this.startField_;\n    return onlyTouchedWorkspace && !this.hasExceededDragRadius_;\n  }\n\n  /* End helper functions defining types of clicks. */\n\n  /**\n   * Whether this gesture is a drag of either a workspace or block.\n   * This function is called externally to block actions that cannot be taken\n   * mid-drag (e.g. using the keyboard to delete the selected blocks).\n   *\n   * @returns True if this gesture is a drag of a workspace or block.\n   * @internal\n   */\n  isDragging(): boolean {\n    return !!this.workspaceDragger_ || !!this.blockDragger_ ||\n        !!this.bubbleDragger_;\n  }\n\n  /**\n   * Whether this gesture has already been started.  In theory every pointerdown\n   * has a corresponding pointerup, but in reality it is possible to lose a\n   * pointerup, leaving an in-process gesture hanging.\n   *\n   * @returns Whether this gesture was a click on a workspace.\n   * @internal\n   */\n  hasStarted(): boolean {\n    return this.hasStarted_;\n  }\n\n  /**\n   * Get a list of the insertion markers that currently exist.  Block drags have\n   * 0, 1, or 2 insertion markers.\n   *\n   * @returns A possibly empty list of insertion marker blocks.\n   * @internal\n   */\n  getInsertionMarkers(): BlockSvg[] {\n    if (this.blockDragger_) {\n      return this.blockDragger_.getInsertionMarkers();\n    }\n    return [];\n  }\n\n  /**\n   * Gets the current dragger if an item is being dragged. Null if nothing is\n   * being dragged.\n   *\n   * @returns The dragger that is currently in use or null if no drag is in\n   *     progress.\n   */\n  getCurrentDragger(): WorkspaceDragger|BubbleDragger|IBlockDragger|null {\n    return this.blockDragger_ ?? this.workspaceDragger_ ?? this.bubbleDragger_;\n  }\n\n  /**\n   * Is a drag or other gesture currently in progress on any workspace?\n   *\n   * @returns True if gesture is occurring.\n   */\n  static inProgress(): boolean {\n    const workspaces = common.getAllWorkspaces();\n    for (let i = 0, workspace; workspace = workspaces[i]; i++) {\n      // Not actually necessarily a WorkspaceSvg, but it doesn't matter b/c\n      // we're just checking if the property exists. Theoretically we would\n      // want to use instanceof, but that causes a circular dependency.\n      if ((workspace as WorkspaceSvg).currentGesture_) {\n        return true;\n      }\n    }\n    return false;\n  }\n}\n","/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The namespace used to keep track of keyboard shortcuts and the\n * key codes used to execute those shortcuts.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.ShortcutRegistry');\n\nimport {KeyCodes} from './utils/keycodes.js';\nimport * as object from './utils/object.js';\nimport type {Workspace} from './workspace.js';\n\n\n/**\n * Class for the registry of keyboard shortcuts. This is intended to be a\n * singleton. You should not create a new instance, and only access this class\n * from ShortcutRegistry.registry.\n *\n * @alias Blockly.ShortcutRegistry\n */\nexport class ShortcutRegistry {\n  static readonly registry = new ShortcutRegistry();\n\n  /** Registry of all keyboard shortcuts, keyed by name of shortcut. */\n  private shortcuts = new Map<string, KeyboardShortcut>();\n\n  /** Map of key codes to an array of shortcut names. */\n  private keyMap = new Map<string, string[]>();\n\n  /** Resets the existing ShortcutRegistry singleton. */\n  private constructor() {\n    this.reset();\n  }\n\n  /** Clear and recreate the registry and keyMap. */\n  reset() {\n    this.shortcuts.clear();\n    this.keyMap.clear();\n  }\n\n  /**\n   * Registers a keyboard shortcut.\n   *\n   * @param shortcut The shortcut for this key code.\n   * @param opt_allowOverrides True to prevent a warning when overriding an\n   *     already registered item.\n   * @throws {Error} if a shortcut with the same name already exists.\n   */\n  register(shortcut: KeyboardShortcut, opt_allowOverrides?: boolean) {\n    const registeredShortcut = this.shortcuts.get(shortcut.name);\n    if (registeredShortcut && !opt_allowOverrides) {\n      throw new Error(`Shortcut named \"${shortcut.name}\" already exists.`);\n    }\n    this.shortcuts.set(shortcut.name, shortcut);\n\n    const keyCodes = shortcut.keyCodes;\n    if (keyCodes && keyCodes.length > 0) {\n      for (let i = 0; i < keyCodes.length; i++) {\n        this.addKeyMapping(\n            keyCodes[i], shortcut.name, !!shortcut.allowCollision);\n      }\n    }\n  }\n\n  /**\n   * Unregisters a keyboard shortcut registered with the given key code. This\n   * will also remove any key mappings that reference this shortcut.\n   *\n   * @param shortcutName The name of the shortcut to unregister.\n   * @returns True if an item was unregistered, false otherwise.\n   */\n  unregister(shortcutName: string): boolean {\n    const shortcut = this.shortcuts.get(shortcutName);\n\n    if (!shortcut) {\n      console.warn(`Keyboard shortcut named \"${shortcutName}\" not found.`);\n      return false;\n    }\n\n    this.removeAllKeyMappings(shortcutName);\n\n    this.shortcuts.delete(shortcutName);\n    return true;\n  }\n\n  /**\n   * Adds a mapping between a keycode and a keyboard shortcut.\n   *\n   * @param keyCode The key code for the keyboard shortcut. If registering a key\n   *     code with a modifier (ex: ctrl+c) use\n   *     ShortcutRegistry.registry.createSerializedKey;\n   * @param shortcutName The name of the shortcut to execute when the given\n   *     keycode is pressed.\n   * @param opt_allowCollision True to prevent an error when adding a shortcut\n   *     to a key that is already mapped to a shortcut.\n   * @throws {Error} if the given key code is already mapped to a shortcut.\n   */\n  addKeyMapping(\n      keyCode: string|number|KeyCodes, shortcutName: string,\n      opt_allowCollision?: boolean) {\n    keyCode = String(keyCode);\n    const shortcutNames = this.keyMap.get(keyCode);\n    if (shortcutNames && !opt_allowCollision) {\n      throw new Error(`Shortcut named \"${\n          shortcutName}\" collides with shortcuts \"${shortcutNames}\"`);\n    } else if (shortcutNames && opt_allowCollision) {\n      shortcutNames.unshift(shortcutName);\n    } else {\n      this.keyMap.set(keyCode, [shortcutName]);\n    }\n  }\n\n  /**\n   * Removes a mapping between a keycode and a keyboard shortcut.\n   *\n   * @param keyCode The key code for the keyboard shortcut. If registering a key\n   *     code with a modifier (ex: ctrl+c) use\n   *     ShortcutRegistry.registry.createSerializedKey;\n   * @param shortcutName The name of the shortcut to execute when the given\n   *     keycode is pressed.\n   * @param opt_quiet True to not console warn when there is no shortcut to\n   *     remove.\n   * @returns True if a key mapping was removed, false otherwise.\n   */\n  removeKeyMapping(keyCode: string, shortcutName: string, opt_quiet?: boolean):\n      boolean {\n    const shortcutNames = this.keyMap.get(keyCode);\n\n    if (!shortcutNames) {\n      if (!opt_quiet) {\n        console.warn(`No keyboard shortcut named \"${\n            shortcutName}\" registered with key code \"${keyCode}\"`);\n      }\n      return false;\n    }\n\n    const shortcutIdx = shortcutNames.indexOf(shortcutName);\n    if (shortcutIdx > -1) {\n      shortcutNames.splice(shortcutIdx, 1);\n      if (shortcutNames.length === 0) {\n        this.keyMap.delete(keyCode);\n      }\n      return true;\n    }\n    if (!opt_quiet) {\n      console.warn(`No keyboard shortcut named \"${\n          shortcutName}\" registered with key code \"${keyCode}\"`);\n    }\n    return false;\n  }\n\n  /**\n   * Removes all the key mappings for a shortcut with the given name.\n   * Useful when changing the default key mappings and the key codes registered\n   * to the shortcut are unknown.\n   *\n   * @param shortcutName The name of the shortcut to remove from the key map.\n   */\n  removeAllKeyMappings(shortcutName: string) {\n    for (const keyCode of this.keyMap.keys()) {\n      this.removeKeyMapping(keyCode, shortcutName, true);\n    }\n  }\n\n  /**\n   * Sets the key map. Setting the key map will override any default key\n   * mappings.\n   *\n   * @param newKeyMap The object with key code to shortcut names.\n   */\n  setKeyMap(newKeyMap: {[key: string]: string[]}) {\n    this.keyMap.clear();\n    for (const key in newKeyMap) {\n      this.keyMap.set(key, newKeyMap[key]);\n    }\n  }\n\n  /**\n   * Gets the current key map.\n   *\n   * @returns The object holding key codes to ShortcutRegistry.KeyboardShortcut.\n   */\n  getKeyMap(): {[key: string]: string[]} {\n    const legacyKeyMap: {[key: string]: string[]} = Object.create(null);\n    for (const [key, value] of this.keyMap) {\n      legacyKeyMap[key] = value;\n    }\n    return legacyKeyMap;\n  }\n\n  /**\n   * Gets the registry of keyboard shortcuts.\n   *\n   * @returns The registry of keyboard shortcuts.\n   */\n  getRegistry(): {[key: string]: KeyboardShortcut} {\n    const legacyRegistry: {[key: string]: KeyboardShortcut} =\n        Object.create(null);\n    for (const [key, value] of this.shortcuts) {\n      legacyRegistry[key] = value;\n    }\n    return object.deepMerge(Object.create(null), legacyRegistry);\n  }\n\n  /**\n   * Handles key down events.\n   *\n   * @param workspace The main workspace where the event was captured.\n   * @param e The key down event.\n   * @returns True if the event was handled, false otherwise.\n   */\n  onKeyDown(workspace: Workspace, e: KeyboardEvent): boolean {\n    const key = this.serializeKeyEvent_(e);\n    const shortcutNames = this.getShortcutNamesByKeyCode(key);\n    if (!shortcutNames) {\n      return false;\n    }\n    for (let i = 0, shortcutName; shortcutName = shortcutNames[i]; i++) {\n      const shortcut = this.shortcuts.get(shortcutName);\n      if (!shortcut?.preconditionFn || shortcut?.preconditionFn(workspace)) {\n        // If the key has been handled, stop processing shortcuts.\n        if (shortcut?.callback && shortcut?.callback(workspace, e, shortcut)) {\n          return true;\n        }\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Gets the shortcuts registered to the given key code.\n   *\n   * @param keyCode The serialized key code.\n   * @returns The list of shortcuts to call when the given keyCode is used.\n   *     Undefined if no shortcuts exist.\n   */\n  getShortcutNamesByKeyCode(keyCode: string): string[]|undefined {\n    return this.keyMap.get(keyCode) || [];\n  }\n\n  /**\n   * Gets the serialized key codes that the shortcut with the given name is\n   * registered under.\n   *\n   * @param shortcutName The name of the shortcut.\n   * @returns An array with all the key codes the shortcut is registered under.\n   */\n  getKeyCodesByShortcutName(shortcutName: string): string[] {\n    const keys = [];\n    for (const [keyCode, shortcuts] of this.keyMap) {\n      const shortcutIdx = shortcuts.indexOf(shortcutName);\n      if (shortcutIdx > -1) {\n        keys.push(keyCode);\n      }\n    }\n    return keys;\n  }\n\n  /**\n   * Serializes a key event.\n   *\n   * @param e A key down event.\n   * @returns The serialized key code for the given event.\n   */\n  private serializeKeyEvent_(e: KeyboardEvent): string {\n    let serializedKey = '';\n    for (const modifier in ShortcutRegistry.modifierKeys) {\n      if (e.getModifierState(modifier)) {\n        if (serializedKey !== '') {\n          serializedKey += '+';\n        }\n        serializedKey += modifier;\n      }\n    }\n    if (serializedKey !== '' && e.keyCode) {\n      serializedKey = serializedKey + '+' + e.keyCode;\n    } else if (e.keyCode) {\n      serializedKey = e.keyCode.toString();\n    }\n    return serializedKey;\n  }\n\n  /**\n   * Checks whether any of the given modifiers are not valid.\n   *\n   * @param modifiers List of modifiers to be used with the key.\n   * @throws {Error} if the modifier is not in the valid modifiers list.\n   */\n  private checkModifiers_(modifiers: KeyCodes[]) {\n    for (let i = 0, modifier; modifier = modifiers[i]; i++) {\n      if (!(modifier in ShortcutRegistry.modifierKeys)) {\n        throw new Error(modifier + ' is not a valid modifier key.');\n      }\n    }\n  }\n\n  /**\n   * Creates the serialized key code that will be used in the key map.\n   *\n   * @param keyCode Number code representing the key.\n   * @param modifiers List of modifier key codes to be used with the key. All\n   *     valid modifiers can be found in the ShortcutRegistry.modifierKeys.\n   * @returns The serialized key code for the given modifiers and key.\n   */\n  createSerializedKey(keyCode: number, modifiers: KeyCodes[]|null): string {\n    let serializedKey = '';\n\n    if (modifiers) {\n      this.checkModifiers_(modifiers);\n      for (const modifier in ShortcutRegistry.modifierKeys) {\n        const modifierKeyCode =\n            (ShortcutRegistry.modifierKeys as AnyDuringMigration)[modifier];\n        if (modifiers.indexOf(modifierKeyCode) > -1) {\n          if (serializedKey !== '') {\n            serializedKey += '+';\n          }\n          serializedKey += modifier;\n        }\n      }\n    }\n\n    if (serializedKey !== '' && keyCode) {\n      serializedKey = serializedKey + '+' + keyCode;\n    } else if (keyCode) {\n      serializedKey = keyCode.toString();\n    }\n    return serializedKey;\n  }\n}\n\nexport namespace ShortcutRegistry {\n  export interface KeyboardShortcut {\n    callback?: ((p1: Workspace, p2: Event, p3: KeyboardShortcut) => boolean);\n    name: string;\n    preconditionFn?: ((p1: Workspace) => boolean);\n    metadata?: object;\n    keyCodes?: (number|string)[];\n    allowCollision?: boolean;\n  }\n\n  /** Supported modifiers. */\n  export enum modifierKeys {\n    Shift = KeyCodes.SHIFT,\n    Control = KeyCodes.CTRL,\n    Alt = KeyCodes.ALT,\n    Meta = KeyCodes.META,\n  }\n}\n\nexport type KeyboardShortcut = ShortcutRegistry.KeyboardShortcut;\n// No need to export ShorcutRegistry.modifierKeys from the module at this time\n// because (1) it wasn't automatically converted by the automatic migration\n// script, (2) the name doesn't follow the styleguide.\n","/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Events fired as a result of a theme update.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events.ThemeChange');\n\nimport * as deprecation from '../utils/deprecation.js';\nimport * as registry from '../registry.js';\nimport {AbstractEventJson} from './events_abstract.js';\nimport {UiBase} from './events_ui_base.js';\nimport * as eventUtils from './utils.js';\nimport type {Workspace} from '../workspace.js';\n\n\n/**\n * Class for a theme change event.\n *\n * @alias Blockly.Events.ThemeChange\n */\nexport class ThemeChange extends UiBase {\n  themeName?: string;\n  override type = eventUtils.THEME_CHANGE;\n\n  /**\n   * @param opt_themeName The theme name. Undefined for a blank event.\n   * @param opt_workspaceId The workspace identifier for this event.\n   *    event. Undefined for a blank event.\n   */\n  constructor(opt_themeName?: string, opt_workspaceId?: string) {\n    super(opt_workspaceId);\n\n    /** The theme name. */\n    this.themeName = opt_themeName;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): ThemeChangeJson {\n    const json = super.toJson() as ThemeChangeJson;\n    if (!this.themeName) {\n      throw new Error(\n          'The theme name is undefined. Either pass a theme name to ' +\n          'the constructor, or call fromJson');\n    }\n    json['themeName'] = this.themeName;\n    return json;\n  }\n\n  /**\n   * Decode the JSON event.\n   *\n   * @param json JSON representation.\n   */\n  override fromJson(json: ThemeChangeJson) {\n    deprecation.warn(\n        'Blockly.Events.ThemeChange.prototype.fromJson', 'version 9',\n        'version 10', 'Blockly.Events.fromJson');\n    super.fromJson(json);\n    this.themeName = json['themeName'];\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of ThemeChange, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(json: ThemeChangeJson, workspace: Workspace, event?: any):\n      ThemeChange {\n    const newEvent =\n        super.fromJson(json, workspace, event ?? new ThemeChange()) as\n        ThemeChange;\n    newEvent.themeName = json['themeName'];\n    return newEvent;\n  }\n}\n\nexport interface ThemeChangeJson extends AbstractEventJson {\n  themeName: string;\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.THEME_CHANGE, ThemeChange);\n","/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Events fired as a result of a viewport change.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events.ViewportChange');\n\nimport * as deprecation from '../utils/deprecation.js';\nimport * as registry from '../registry.js';\nimport {AbstractEventJson} from './events_abstract.js';\nimport {UiBase} from './events_ui_base.js';\nimport * as eventUtils from './utils.js';\nimport type {Workspace} from '../workspace.js';\n\n\n/**\n * Class for a viewport change event.\n *\n * @alias Blockly.Events.ViewportChange\n */\nexport class ViewportChange extends UiBase {\n  viewTop?: number;\n  viewLeft?: number;\n  scale?: number;\n  oldScale?: number;\n  override type = eventUtils.VIEWPORT_CHANGE;\n\n  /**\n   * @param opt_top Top-edge of the visible portion of the workspace, relative\n   *     to the workspace origin. Undefined for a blank event.\n   * @param opt_left Left-edge of the visible portion of the workspace relative\n   *     to the workspace origin. Undefined for a blank event.\n   * @param opt_scale The scale of the workspace. Undefined for a blank event.\n   * @param opt_workspaceId The workspace identifier for this event.\n   *    Undefined for a blank event.\n   * @param opt_oldScale The old scale of the workspace. Undefined for a blank\n   *     event.\n   */\n  constructor(\n      opt_top?: number, opt_left?: number, opt_scale?: number,\n      opt_workspaceId?: string, opt_oldScale?: number) {\n    super(opt_workspaceId);\n\n    /**\n     * Top-edge of the visible portion of the workspace, relative to the\n     * workspace origin.\n     */\n    this.viewTop = opt_top;\n\n    /**\n     * Left-edge of the visible portion of the workspace, relative to the\n     * workspace origin.\n     */\n    this.viewLeft = opt_left;\n\n    /** The scale of the workspace. */\n    this.scale = opt_scale;\n\n    /** The old scale of the workspace. */\n    this.oldScale = opt_oldScale;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): ViewportChangeJson {\n    const json = super.toJson() as ViewportChangeJson;\n    if (this.viewTop === undefined) {\n      throw new Error(\n          'The view top is undefined. Either pass a value to ' +\n          'the constructor, or call fromJson');\n    }\n    if (this.viewLeft === undefined) {\n      throw new Error(\n          'The view left is undefined. Either pass a value to ' +\n          'the constructor, or call fromJson');\n    }\n    if (this.scale === undefined) {\n      throw new Error(\n          'The scale is undefined. Either pass a value to ' +\n          'the constructor, or call fromJson');\n    }\n    if (this.oldScale === undefined) {\n      throw new Error(\n          'The old scale is undefined. Either pass a value to ' +\n          'the constructor, or call fromJson');\n    }\n    json['viewTop'] = this.viewTop;\n    json['viewLeft'] = this.viewLeft;\n    json['scale'] = this.scale;\n    json['oldScale'] = this.oldScale;\n    return json;\n  }\n\n  /**\n   * Decode the JSON event.\n   *\n   * @param json JSON representation.\n   */\n  override fromJson(json: ViewportChangeJson) {\n    deprecation.warn(\n        'Blockly.Events.Viewport.prototype.fromJson', 'version 9', 'version 10',\n        'Blockly.Events.fromJson');\n    super.fromJson(json);\n    this.viewTop = json['viewTop'];\n    this.viewLeft = json['viewLeft'];\n    this.scale = json['scale'];\n    this.oldScale = json['oldScale'];\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of Viewport, but we can't specify that due to the fact that parameters\n   *     to static methods in subclasses must be supertypes of parameters to\n   *     static methods in superclasses.\n   * @internal\n   */\n  static fromJson(json: ViewportChangeJson, workspace: Workspace, event?: any):\n      ViewportChange {\n    const newEvent =\n        super.fromJson(json, workspace, event ?? new ViewportChange()) as\n        ViewportChange;\n    newEvent.viewTop = json['viewTop'];\n    newEvent.viewLeft = json['viewLeft'];\n    newEvent.scale = json['scale'];\n    newEvent.oldScale = json['oldScale'];\n    return newEvent;\n  }\n}\n\nexport interface ViewportChangeJson extends AbstractEventJson {\n  viewTop: number;\n  viewLeft: number;\n  scale: number;\n  oldScale: number;\n}\n\nregistry.register(\n    registry.Type.EVENT, eventUtils.VIEWPORT_CHANGE, ViewportChange);\n","/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * A database of all the rendered connections that could\n *    possibly be connected to (i.e. not collapsed, etc).\n *    Sorted by y coordinate.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.ConnectionDB');\n\nimport {ConnectionType} from './connection_type.js';\nimport type {IConnectionChecker} from './interfaces/i_connection_checker.js';\nimport type {RenderedConnection} from './rendered_connection.js';\nimport type {Coordinate} from './utils/coordinate.js';\n\n\n/**\n * Database of connections.\n * Connections are stored in order of their vertical component.  This way\n * connections in an area may be looked up quickly using a binary search.\n *\n * @alias Blockly.ConnectionDB\n */\nexport class ConnectionDB {\n  /** Array of connections sorted by y position in workspace units. */\n  private readonly connections_: RenderedConnection[] = [];\n\n  /**\n   * @param connectionChecker The workspace's connection type checker, used to\n   *     decide if connections are valid during a drag.\n   */\n  constructor(private readonly connectionChecker: IConnectionChecker) {}\n\n  /**\n   * Add a connection to the database. Should not already exist in the database.\n   *\n   * @param connection The connection to be added.\n   * @param yPos The y position used to decide where to insert the connection.\n   * @internal\n   */\n  addConnection(connection: RenderedConnection, yPos: number) {\n    const index = this.calculateIndexForYPos_(yPos);\n    this.connections_.splice(index, 0, connection);\n  }\n\n  /**\n   * Finds the index of the given connection.\n   *\n   * Starts by doing a binary search to find the approximate location, then\n   * linearly searches nearby for the exact connection.\n   *\n   * @param conn The connection to find.\n   * @param yPos The y position used to find the index of the connection.\n   * @returns The index of the connection, or -1 if the connection was not\n   *     found.\n   */\n  private findIndexOfConnection_(conn: RenderedConnection, yPos: number):\n      number {\n    if (!this.connections_.length) {\n      return -1;\n    }\n\n    const bestGuess = this.calculateIndexForYPos_(yPos);\n    if (bestGuess >= this.connections_.length) {\n      // Not in list\n      return -1;\n    }\n\n    yPos = conn.y;\n    // Walk forward and back on the y axis looking for the connection.\n    let pointer = bestGuess;\n    while (pointer >= 0 && this.connections_[pointer].y === yPos) {\n      if (this.connections_[pointer] === conn) {\n        return pointer;\n      }\n      pointer--;\n    }\n\n    pointer = bestGuess;\n    while (pointer < this.connections_.length &&\n           this.connections_[pointer].y === yPos) {\n      if (this.connections_[pointer] === conn) {\n        return pointer;\n      }\n      pointer++;\n    }\n    return -1;\n  }\n\n  /**\n   * Finds the correct index for the given y position.\n   *\n   * @param yPos The y position used to decide where to insert the connection.\n   * @returns The candidate index.\n   */\n  private calculateIndexForYPos_(yPos: number): number {\n    if (!this.connections_.length) {\n      return 0;\n    }\n    let pointerMin = 0;\n    let pointerMax = this.connections_.length;\n    while (pointerMin < pointerMax) {\n      const pointerMid = Math.floor((pointerMin + pointerMax) / 2);\n      if (this.connections_[pointerMid].y < yPos) {\n        pointerMin = pointerMid + 1;\n      } else if (this.connections_[pointerMid].y > yPos) {\n        pointerMax = pointerMid;\n      } else {\n        pointerMin = pointerMid;\n        break;\n      }\n    }\n    return pointerMin;\n  }\n\n  /**\n   * Remove a connection from the database.  Must already exist in DB.\n   *\n   * @param connection The connection to be removed.\n   * @param yPos The y position used to find the index of the connection.\n   * @throws {Error} If the connection cannot be found in the database.\n   */\n  removeConnection(connection: RenderedConnection, yPos: number) {\n    const index = this.findIndexOfConnection_(connection, yPos);\n    if (index === -1) {\n      throw Error('Unable to find connection in connectionDB.');\n    }\n    this.connections_.splice(index, 1);\n  }\n\n  /**\n   * Find all nearby connections to the given connection.\n   * Type checking does not apply, since this function is used for bumping.\n   *\n   * @param connection The connection whose neighbours should be returned.\n   * @param maxRadius The maximum radius to another connection.\n   * @returns List of connections.\n   */\n  getNeighbours(connection: RenderedConnection, maxRadius: number):\n      RenderedConnection[] {\n    const db = this.connections_;\n    const currentX = connection.x;\n    const currentY = connection.y;\n\n    // Binary search to find the closest y location.\n    let pointerMin = 0;\n    let pointerMax = db.length - 2;\n    let pointerMid = pointerMax;\n    while (pointerMin < pointerMid) {\n      if (db[pointerMid].y < currentY) {\n        pointerMin = pointerMid;\n      } else {\n        pointerMax = pointerMid;\n      }\n      pointerMid = Math.floor((pointerMin + pointerMax) / 2);\n    }\n\n    const neighbours: RenderedConnection[] = [];\n    /**\n     * Computes if the current connection is within the allowed radius of\n     * another connection. This function is a closure and has access to outside\n     * variables.\n     *\n     * @param yIndex The other connection's index in the database.\n     * @returns True if the current connection's vertical distance from the\n     *     other connection is less than the allowed radius.\n     */\n    function checkConnection_(yIndex: number): boolean {\n      const dx = currentX - db[yIndex].x;\n      const dy = currentY - db[yIndex].y;\n      const r = Math.sqrt(dx * dx + dy * dy);\n      if (r <= maxRadius) {\n        neighbours.push(db[yIndex]);\n      }\n      return dy < maxRadius;\n    }\n\n    // Walk forward and back on the y axis looking for the closest x,y point.\n    pointerMin = pointerMid;\n    pointerMax = pointerMid;\n    if (db.length) {\n      while (pointerMin >= 0 && checkConnection_(pointerMin)) {\n        pointerMin--;\n      }\n      do {\n        pointerMax++;\n      } while (pointerMax < db.length && checkConnection_(pointerMax));\n    }\n\n    return neighbours;\n  }\n\n  /**\n   * Is the candidate connection close to the reference connection.\n   * Extremely fast; only looks at Y distance.\n   *\n   * @param index Index in database of candidate connection.\n   * @param baseY Reference connection's Y value.\n   * @param maxRadius The maximum radius to another connection.\n   * @returns True if connection is in range.\n   */\n  private isInYRange_(index: number, baseY: number, maxRadius: number):\n      boolean {\n    return Math.abs(this.connections_[index].y - baseY) <= maxRadius;\n  }\n\n  /**\n   * Find the closest compatible connection to this connection.\n   *\n   * @param conn The connection searching for a compatible mate.\n   * @param maxRadius The maximum radius to another connection.\n   * @param dxy Offset between this connection's location in the database and\n   *     the current location (as a result of dragging).\n   * @returns Contains two properties: 'connection' which is either another\n   *     connection or null, and 'radius' which is the distance.\n   */\n  searchForClosest(\n      conn: RenderedConnection, maxRadius: number,\n      dxy: Coordinate): {connection: RenderedConnection|null, radius: number} {\n    if (!this.connections_.length) {\n      // Don't bother.\n      return {connection: null, radius: maxRadius};\n    }\n\n    // Stash the values of x and y from before the drag.\n    const baseY = conn.y;\n    const baseX = conn.x;\n\n    conn.x = baseX + dxy.x;\n    conn.y = baseY + dxy.y;\n\n    // calculateIndexForYPos_ finds an index for insertion, which is always\n    // after any block with the same y index.  We want to search both forward\n    // and back, so search on both sides of the index.\n    const closestIndex = this.calculateIndexForYPos_(conn.y);\n\n    let bestConnection = null;\n    let bestRadius = maxRadius;\n    let temp;\n\n    // Walk forward and back on the y axis looking for the closest x,y point.\n    let pointerMin = closestIndex - 1;\n    while (pointerMin >= 0 && this.isInYRange_(pointerMin, conn.y, maxRadius)) {\n      temp = this.connections_[pointerMin];\n      if (this.connectionChecker.canConnect(conn, temp, true, bestRadius)) {\n        bestConnection = temp;\n        bestRadius = temp.distanceFrom(conn);\n      }\n      pointerMin--;\n    }\n\n    let pointerMax = closestIndex;\n    while (pointerMax < this.connections_.length &&\n           this.isInYRange_(pointerMax, conn.y, maxRadius)) {\n      temp = this.connections_[pointerMax];\n      if (this.connectionChecker.canConnect(conn, temp, true, bestRadius)) {\n        bestConnection = temp;\n        bestRadius = temp.distanceFrom(conn);\n      }\n      pointerMax++;\n    }\n\n    // Reset the values of x and y.\n    conn.x = baseX;\n    conn.y = baseY;\n    // If there were no valid connections, bestConnection will be null.\n    return {connection: bestConnection, radius: bestRadius};\n  }\n\n  /**\n   * Initialize a set of connection DBs for a workspace.\n   *\n   * @param checker The workspace's connection checker, used to decide if\n   *     connections are valid during a drag.\n   * @returns Array of databases.\n   */\n  static init(checker: IConnectionChecker): ConnectionDB[] {\n    // Create four databases, one for each connection type.\n    const dbList = [];\n    dbList[ConnectionType.INPUT_VALUE] = new ConnectionDB(checker);\n    dbList[ConnectionType.OUTPUT_VALUE] = new ConnectionDB(checker);\n    dbList[ConnectionType.NEXT_STATEMENT] = new ConnectionDB(checker);\n    dbList[ConnectionType.PREVIOUS_STATEMENT] = new ConnectionDB(checker);\n    return dbList;\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object for configuring and updating a workspace grid in\n * Blockly.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Grid');\n\nimport * as dom from './utils/dom.js';\nimport {Svg} from './utils/svg.js';\nimport {GridOptions} from './options.js';\n\n\n/**\n * Class for a workspace's grid.\n *\n * @alias Blockly.Grid\n */\nexport class Grid {\n  private readonly spacing: number;\n  private readonly length: number;\n  private readonly line1: SVGElement;\n  private readonly line2: SVGElement;\n  private readonly snapToGrid: boolean;\n\n  /**\n   * @param pattern The grid's SVG pattern, created during injection.\n   * @param options A dictionary of normalized options for the grid.\n   *     See grid documentation:\n   *     https://developers.google.com/blockly/guides/configure/web/grid\n   */\n  constructor(private pattern: SVGElement, options: GridOptions) {\n    /** The spacing of the grid lines (in px). */\n    this.spacing = options['spacing'] ?? 0;\n\n    /** How long the grid lines should be (in px). */\n    this.length = options['length'] ?? 1;\n\n    /** The horizontal grid line, if it exists. */\n    this.line1 = pattern.firstChild as SVGElement;\n\n    /** The vertical grid line, if it exists. */\n    this.line2 = this.line1 && this.line1.nextSibling as SVGElement;\n\n    /** Whether blocks should snap to the grid. */\n    this.snapToGrid = options['snap'] ?? false;\n  }\n\n  /**\n   * Whether blocks should snap to the grid, based on the initial configuration.\n   *\n   * @returns True if blocks should snap, false otherwise.\n   * @internal\n   */\n  shouldSnap(): boolean {\n    return this.snapToGrid;\n  }\n\n  /**\n   * Get the spacing of the grid points (in px).\n   *\n   * @returns The spacing of the grid points.\n   * @internal\n   */\n  getSpacing(): number {\n    return this.spacing;\n  }\n\n  /**\n   * Get the ID of the pattern element, which should be randomized to avoid\n   * conflicts with other Blockly instances on the page.\n   *\n   * @returns The pattern ID.\n   * @internal\n   */\n  getPatternId(): string {\n    return this.pattern.id;\n  }\n\n  /**\n   * Update the grid with a new scale.\n   *\n   * @param scale The new workspace scale.\n   * @internal\n   */\n  update(scale: number) {\n    // MSIE freaks if it sees a 0x0 pattern, so set empty patterns to 100x100.\n    const safeSpacing = this.spacing * scale || 100;\n\n    this.pattern.setAttribute('width', safeSpacing.toString());\n    this.pattern.setAttribute('height', safeSpacing.toString());\n\n    let half = Math.floor(this.spacing / 2) + 0.5;\n    let start = half - this.length / 2;\n    let end = half + this.length / 2;\n\n    half *= scale;\n    start *= scale;\n    end *= scale;\n\n    this.setLineAttributes(this.line1, scale, start, end, half, half);\n    this.setLineAttributes(this.line2, scale, half, half, start, end);\n  }\n\n  /**\n   * Set the attributes on one of the lines in the grid.  Use this to update the\n   * length and stroke width of the grid lines.\n   *\n   * @param line Which line to update.\n   * @param width The new stroke size (in px).\n   * @param x1 The new x start position of the line (in px).\n   * @param x2 The new x end position of the line (in px).\n   * @param y1 The new y start position of the line (in px).\n   * @param y2 The new y end position of the line (in px).\n   */\n  private setLineAttributes(\n      line: SVGElement, width: number, x1: number, x2: number, y1: number,\n      y2: number) {\n    if (line) {\n      line.setAttribute('stroke-width', width.toString());\n      line.setAttribute('x1', x1.toString());\n      line.setAttribute('y1', y1.toString());\n      line.setAttribute('x2', x2.toString());\n      line.setAttribute('y2', y2.toString());\n    }\n  }\n\n  /**\n   * Move the grid to a new x and y position, and make sure that change is\n   * visible.\n   *\n   * @param x The new x position of the grid (in px).\n   * @param y The new y position of the grid (in px).\n   * @internal\n   */\n  moveTo(x: number, y: number) {\n    this.pattern.setAttribute('x', x.toString());\n    this.pattern.setAttribute('y', y.toString());\n  }\n\n  /**\n   * Create the DOM for the grid described by options.\n   *\n   * @param rnd A random ID to append to the pattern's ID.\n   * @param gridOptions The object containing grid configuration.\n   * @param defs The root SVG element for this workspace's defs.\n   * @returns The SVG element for the grid pattern.\n   * @internal\n   */\n  static createDom(rnd: string, gridOptions: GridOptions, defs: SVGElement):\n      SVGElement {\n    /*\n          <pattern id=\"blocklyGridPattern837493\" patternUnits=\"userSpaceOnUse\">\n            <rect stroke=\"#888\" />\n            <rect stroke=\"#888\" />\n          </pattern>\n        */\n    const gridPattern = dom.createSvgElement(\n        Svg.PATTERN,\n        {'id': 'blocklyGridPattern' + rnd, 'patternUnits': 'userSpaceOnUse'},\n        defs);\n    // x1, y1, x1, x2 properties will be set later in update.\n    if ((gridOptions['length'] ?? 1) > 0 && (gridOptions['spacing'] ?? 0) > 0) {\n      dom.createSvgElement(\n          Svg.LINE, {'stroke': gridOptions['colour']}, gridPattern);\n      if (gridOptions['length'] ?? 1 > 1) {\n        dom.createSvgElement(\n            Svg.LINE, {'stroke': gridOptions['colour']}, gridPattern);\n      }\n    } else {\n      // Edge 16 doesn't handle empty patterns\n      dom.createSvgElement(Svg.LINE, {}, gridPattern);\n    }\n    return gridPattern;\n  }\n}\n","/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Utility functions for handling variable and procedure names.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Names');\n\nimport {Msg} from './msg.js';\n// import * as Procedures from './procedures.js';\nimport type {VariableMap} from './variable_map.js';\nimport * as Variables from './variables.js';\nimport type {Workspace} from './workspace.js';\n\n\n/**\n * Class for a database of entity names (variables, procedures, etc).\n *\n * @alias Blockly.Names\n */\nexport class Names {\n  static DEVELOPER_VARIABLE_TYPE: NameType;\n  private readonly variablePrefix_: string;\n\n  /** A set of reserved words. */\n  private readonly reservedWords: Set<string>;\n\n  /**\n   * A map from type (e.g. name, procedure) to maps from names to generated\n   * names.\n   */\n  private readonly db = new Map<string, Map<string, string>>();\n\n  /** A set of used names to avoid collisions. */\n  private readonly dbReverse = new Set<string>();\n\n  /**\n   * The variable map from the workspace, containing Blockly variable models.\n   */\n  private variableMap_: VariableMap|null = null;\n\n  /**\n   * @param reservedWordsList A comma-separated string of words that are illegal\n   *     for use as names in a language (e.g. 'new,if,this,...').\n   * @param opt_variablePrefix Some languages need a '$' or a namespace before\n   *     all variable names (but not procedure names).\n   */\n  constructor(reservedWordsList: string, opt_variablePrefix?: string) {\n    /** The prefix to attach to variable names in generated code. */\n    this.variablePrefix_ = opt_variablePrefix || '';\n\n    this.reservedWords =\n        new Set<string>(reservedWordsList ? reservedWordsList.split(',') : []);\n  }\n\n  /**\n   * Empty the database and start from scratch.  The reserved words are kept.\n   */\n  reset() {\n    this.db.clear();\n    this.dbReverse.clear();\n    this.variableMap_ = null;\n  }\n\n  /**\n   * Set the variable map that maps from variable name to variable object.\n   *\n   * @param map The map to track.\n   */\n  setVariableMap(map: VariableMap) {\n    this.variableMap_ = map;\n  }\n\n  /**\n   * Get the name for a user-defined variable, based on its ID.\n   * This should only be used for variables of NameType VARIABLE.\n   *\n   * @param id The ID to look up in the variable map.\n   * @returns The name of the referenced variable, or null if there was no\n   *     variable map or the variable was not found in the map.\n   */\n  private getNameForUserVariable_(id: string): string|null {\n    if (!this.variableMap_) {\n      console.warn(\n          'Deprecated call to Names.prototype.getName without ' +\n          'defining a variable map. To fix, add the following code in your ' +\n          'generator\\'s init() function:\\n' +\n          'Blockly.YourGeneratorName.nameDB_.setVariableMap(' +\n          'workspace.getVariableMap());');\n      return null;\n    }\n    const variable = this.variableMap_.getVariableById(id);\n    if (variable) {\n      return variable.name;\n    }\n    return null;\n  }\n\n  /**\n   * Generate names for user variables, but only ones that are being used.\n   *\n   * @param workspace Workspace to generate variables from.\n   */\n  populateVariables(workspace: Workspace) {\n    const variables = Variables.allUsedVarModels(workspace);\n    for (let i = 0; i < variables.length; i++) {\n      this.getName(variables[i].getId(), NameType.VARIABLE);\n    }\n  }\n\n  /**\n   * Generate names for procedures.\n   *\n   * @param workspace Workspace to generate procedures from.\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  populateProcedures(workspace: Workspace) {\n    throw new Error(\n        'The implementation of populateProcedures should be ' +\n        'monkey-patched in by blockly.ts');\n  }\n\n  /**\n   * Convert a Blockly entity name to a legal exportable entity name.\n   *\n   * @param nameOrId The Blockly entity name (no constraints) or variable ID.\n   * @param type The type of the name in Blockly ('VARIABLE', 'PROCEDURE',\n   *     'DEVELOPER_VARIABLE', etc...).\n   * @returns An entity name that is legal in the exported language.\n   */\n  getName(nameOrId: string, type: NameType|string): string {\n    let name = nameOrId;\n    if (type === NameType.VARIABLE) {\n      const varName = this.getNameForUserVariable_(nameOrId);\n      if (varName) {\n        // Successful ID lookup.\n        name = varName;\n      }\n    }\n    const normalizedName = name.toLowerCase();\n\n    const isVar =\n        type === NameType.VARIABLE || type === NameType.DEVELOPER_VARIABLE;\n\n    const prefix = isVar ? this.variablePrefix_ : '';\n    if (!this.db.has(type)) {\n      this.db.set(type, new Map<string, string>());\n    }\n    const typeDb = this.db.get(type);\n    if (typeDb!.has(normalizedName)) {\n      return prefix + typeDb!.get(normalizedName);\n    }\n    const safeName = this.getDistinctName(name, type);\n    typeDb!.set(normalizedName, safeName.substr(prefix.length));\n    return safeName;\n  }\n\n  /**\n   * Return a list of all known user-created names of a specified name type.\n   *\n   * @param type The type of entity in Blockly ('VARIABLE', 'PROCEDURE',\n   *     'DEVELOPER_VARIABLE', etc...).\n   * @returns A list of Blockly entity names (no constraints).\n   */\n  getUserNames(type: NameType|string): string[] {\n    const userNames = this.db.get(type)?.keys();\n    return userNames ? Array.from(userNames) : [];\n  }\n\n  /**\n   * Convert a Blockly entity name to a legal exportable entity name.\n   * Ensure that this is a new name not overlapping any previously defined name.\n   * Also check against list of reserved words for the current language and\n   * ensure name doesn't collide.\n   *\n   * @param name The Blockly entity name (no constraints).\n   * @param type The type of entity in Blockly ('VARIABLE', 'PROCEDURE',\n   *     'DEVELOPER_VARIABLE', etc...).\n   * @returns An entity name that is legal in the exported language.\n   */\n  getDistinctName(name: string, type: NameType|string): string {\n    let safeName = this.safeName_(name);\n    let i = '';\n    while (this.dbReverse.has(safeName + i) ||\n           this.reservedWords.has(safeName + i)) {\n      // Collision with existing name.  Create a unique name.\n      // AnyDuringMigration because:  Type 'string | 2' is not assignable to\n      // type 'string'.\n      i = (i ? i + 1 : 2) as AnyDuringMigration;\n    }\n    safeName += i;\n    this.dbReverse.add(safeName);\n    const isVar =\n        type === NameType.VARIABLE || type === NameType.DEVELOPER_VARIABLE;\n    const prefix = isVar ? this.variablePrefix_ : '';\n    return prefix + safeName;\n  }\n\n  /**\n   * Given a proposed entity name, generate a name that conforms to the\n   * [_A-Za-z][_A-Za-z0-9]* format that most languages consider legal for\n   * variable and function names.\n   *\n   * @param name Potentially illegal entity name.\n   * @returns Safe entity name.\n   */\n  private safeName_(name: string): string {\n    if (!name) {\n      name = Msg['UNNAMED_KEY'] || 'unnamed';\n    } else {\n      // Unfortunately names in non-latin characters will look like\n      // _E9_9F_B3_E4_B9_90 which is pretty meaningless.\n      // https://github.com/google/blockly/issues/1654\n      name = encodeURI(name.replace(/ /g, '_')).replace(/[^\\w]/g, '_');\n      // Most languages don't allow names with leading numbers.\n      if ('0123456789'.indexOf(name[0]) !== -1) {\n        name = 'my_' + name;\n      }\n    }\n    return name;\n  }\n\n  /**\n   * Do the given two entity names refer to the same entity?\n   * Blockly names are case-insensitive.\n   *\n   * @param name1 First name.\n   * @param name2 Second name.\n   * @returns True if names are the same.\n   */\n  static equals(name1: string, name2: string): boolean {\n    // name1.localeCompare(name2) is slower.\n    return name1.toLowerCase() === name2.toLowerCase();\n  }\n}\n\nexport namespace Names {\n  /**\n   * Enum for the type of a name. Different name types may have different rules\n   * about collisions.\n   * When JavaScript (or most other languages) is generated, variable 'foo' and\n   * procedure 'foo' would collide.  However, Blockly has no such problems since\n   * variable get 'foo' and procedure call 'foo' are unambiguous.\n   * Therefore, Blockly keeps a separate name type to disambiguate.\n   * getName('foo', 'VARIABLE') = 'foo'\n   * getName('foo', 'PROCEDURE') = 'foo2'\n   *\n   * @alias Blockly.Names.NameType\n   */\n  export enum NameType {\n    DEVELOPER_VARIABLE = 'DEVELOPER_VARIABLE',\n    VARIABLE = 'VARIABLE',\n    PROCEDURE = 'PROCEDURE',\n  }\n}\n\nexport type NameType = Names.NameType;\nexport const NameType = Names.NameType;\n\n/**\n * Constant to separate developer variable names from user-defined variable\n * names when running generators.\n * A developer variable will be declared as a global in the generated code, but\n * will never be shown to the user in the workspace or stored in the variable\n * map.\n */\nNames.DEVELOPER_VARIABLE_TYPE = NameType.DEVELOPER_VARIABLE;\n","/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as eventUtils from '../events/utils.js';\nimport {IProcedureMap} from '../interfaces/i_procedure_map.js';\nimport type {IProcedureModel} from '../interfaces/i_procedure_model.js';\nimport {isObservable} from '../interfaces/i_observable.js';\nimport {triggerProceduresUpdate} from './update_procedures.js';\nimport type {Workspace} from '../workspace.js';\n\n\nexport class ObservableProcedureMap extends\n    Map<string, IProcedureModel> implements IProcedureMap {\n  constructor(private readonly workspace: Workspace) {\n    super();\n  }\n\n  /**\n   * Adds the given procedure model to the procedure map.\n   */\n  override set(id: string, proc: IProcedureModel): this {\n    if (this.get(id) === proc) return this;\n    super.set(id, proc);\n    eventUtils.fire(new (eventUtils.get(eventUtils.PROCEDURE_CREATE))(\n        this.workspace, proc));\n    if (isObservable(proc)) proc.startPublishing();\n    return this;\n  }\n\n  /**\n   * Deletes the ProcedureModel with the given ID from the procedure map (if it\n   * exists).\n   */\n  override delete(id: string): boolean {\n    const proc = this.get(id);\n    const existed = super.delete(id);\n    if (!existed) return existed;\n    triggerProceduresUpdate(this.workspace);\n    eventUtils.fire(new (eventUtils.get(eventUtils.PROCEDURE_DELETE))(\n        this.workspace, proc));\n    if (isObservable(proc)) proc.stopPublishing();\n    return existed;\n  }\n\n  /**\n   * Removes all ProcedureModels from the procedure map.\n   */\n  override clear() {\n    if (!this.size) return;\n    for (const id of this.keys()) {\n      const proc = this.get(id);\n      super.delete(id);\n      eventUtils.fire(new (eventUtils.get(eventUtils.PROCEDURE_DELETE))(\n          this.workspace, proc));\n    }\n    triggerProceduresUpdate(this.workspace);\n  }\n\n  /**\n   * Adds the given ProcedureModel to the map of procedure models, so that\n   * blocks can find it.\n   */\n  add(proc: IProcedureModel): this {\n    // TODO(#6526): See if this method is actually useful.\n    return this.set(proc.getId(), proc);\n  }\n\n  /**\n   * Returns all of the procedures stored in this map.\n   */\n  getProcedures(): IProcedureModel[] {\n    return [...this.values()];\n  }\n}\n","/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as eventUtils from '../events/utils.js';\nimport {genUid} from '../utils/idgenerator.js';\nimport type {IParameterModel} from '../interfaces/i_parameter_model.js';\nimport type {IProcedureModel} from '../interfaces/i_procedure_model.js';\nimport {isObservable} from '../interfaces/i_observable.js';\nimport {triggerProceduresUpdate} from './update_procedures.js';\nimport type {Workspace} from '../workspace.js';\n\n\nexport class ObservableProcedureModel implements IProcedureModel {\n  private id: string;\n  private name: string;\n  private parameters: IParameterModel[] = [];\n  private returnTypes: string[]|null = null;\n  private enabled = true;\n  private shouldFireEvents = false;\n\n  constructor(\n      private readonly workspace: Workspace, name: string, id?: string) {\n    this.id = id ?? genUid();\n    this.name = name;\n  }\n\n  /** Sets the human-readable name of the procedure. */\n  setName(name: string): this {\n    if (name === this.name) return this;\n    const prevName = this.name;\n    this.name = name;\n    triggerProceduresUpdate(this.workspace);\n    if (this.shouldFireEvents) {\n      eventUtils.fire(new (eventUtils.get(eventUtils.PROCEDURE_RENAME))(\n          this.workspace, this, prevName));\n    }\n    return this;\n  }\n\n  /**\n   * Inserts a parameter into the list of parameters.\n   *\n   * To move a parameter, first delete it, and then re-insert.\n   */\n  insertParameter(parameterModel: IParameterModel, index: number): this {\n    if (this.parameters[index] &&\n        this.parameters[index].getId() === parameterModel.getId()) {\n      return this;\n    }\n\n    this.parameters.splice(index, 0, parameterModel);\n    parameterModel.setProcedureModel(this);\n    if (isObservable(parameterModel)) {\n      if (this.shouldFireEvents) {\n        parameterModel.startPublishing();\n      } else {\n        parameterModel.stopPublishing();\n      }\n    }\n\n    triggerProceduresUpdate(this.workspace);\n    if (this.shouldFireEvents) {\n      eventUtils.fire(\n          new (eventUtils.get(eventUtils.PROCEDURE_PARAMETER_CREATE))(\n              this.workspace, this, parameterModel, index));\n    }\n    return this;\n  }\n\n  /** Removes the parameter at the given index from the parameter list. */\n  deleteParameter(index: number): this {\n    if (!this.parameters[index]) return this;\n    const oldParam = this.parameters[index];\n\n    this.parameters.splice(index, 1);\n    triggerProceduresUpdate(this.workspace);\n    if (isObservable(oldParam)) {\n      oldParam.stopPublishing();\n    }\n\n    if (this.shouldFireEvents) {\n      eventUtils.fire(\n          new (eventUtils.get(eventUtils.PROCEDURE_PARAMETER_DELETE))(\n              this.workspace, this, oldParam, index));\n    }\n    return this;\n  }\n\n  /**\n   * Sets whether the procedure has a return value (empty array) or no return\n   * value (null).\n   *\n   * The built-in procedure model does not support procedures that have actual\n   * return types (i.e. non-empty arrays, e.g. ['number']). If you want your\n   * procedure block to have return types, you need to implement your own\n   * procedure model.\n   */\n  setReturnTypes(types: string[]|null): this {\n    if (types && types.length) {\n      throw new Error(\n          'The built-in ProcedureModel does not support typing. You need to ' +\n          'implement your own custom ProcedureModel.');\n    }\n    // Either they're both an empty array, or both null. Noop either way.\n    if (!!types === !!this.returnTypes) return this;\n    const oldReturnTypes = this.returnTypes;\n    this.returnTypes = types;\n    triggerProceduresUpdate(this.workspace);\n    if (this.shouldFireEvents) {\n      eventUtils.fire(new (eventUtils.get(eventUtils.PROCEDURE_CHANGE_RETURN))(\n          this.workspace, this, oldReturnTypes));\n    }\n    return this;\n  }\n\n  /**\n   * Sets whether this procedure is enabled/disabled. If a procedure is disabled\n   * all procedure caller blocks should be disabled as well.\n   */\n  setEnabled(enabled: boolean): this {\n    if (enabled === this.enabled) return this;\n    this.enabled = enabled;\n    triggerProceduresUpdate(this.workspace);\n    if (this.shouldFireEvents) {\n      eventUtils.fire(new (eventUtils.get(eventUtils.PROCEDURE_ENABLE))(\n          this.workspace, this));\n    }\n    return this;\n  }\n\n  /** Returns the unique language-neutral ID for the procedure. */\n  getId(): string {\n    return this.id;\n  }\n\n  /** Returns the human-readable name of the procedure. */\n  getName(): string {\n    return this.name;\n  }\n\n  /** Returns the parameter at the given index in the parameter list. */\n  getParameter(index: number): IParameterModel {\n    return this.parameters[index];\n  }\n\n  /** Returns an array of all of the parameters in the parameter list. */\n  getParameters(): IParameterModel[] {\n    return [...this.parameters];\n  }\n\n  /**\n   * Returns the return type of the procedure.\n   *\n   * Null represents a procedure that does not return a value.\n   */\n  getReturnTypes(): string[]|null {\n    return this.returnTypes;\n  }\n\n  /**\n   * Returns whether the procedure is enabled/disabled. If a procedure is\n   * disabled, all procedure caller blocks should be disabled as well.\n   */\n  getEnabled(): boolean {\n    return this.enabled;\n  }\n\n  /**\n   * Tells the procedure model it should fire events.\n   *\n   * @internal\n   */\n  startPublishing() {\n    this.shouldFireEvents = true;\n    for (const param of this.parameters) {\n      if (isObservable(param)) param.startPublishing();\n    }\n  }\n\n  /**\n   * Tells the procedure model it should not fire events.\n   *\n   * @internal\n   */\n  stopPublishing() {\n    this.shouldFireEvents = false;\n    for (const param of this.parameters) {\n      if (isObservable(param)) param.stopPublishing();\n    }\n  }\n}\n","/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as eventUtils from '../events/utils.js';\nimport {genUid} from '../utils/idgenerator.js';\nimport type {IParameterModel} from '../interfaces/i_parameter_model.js';\nimport type {IProcedureModel} from '../interfaces/i_procedure_model';\nimport {triggerProceduresUpdate} from './update_procedures.js';\nimport type {VariableModel} from '../variable_model.js';\nimport type {Workspace} from '../workspace.js';\n\n\nexport class ObservableParameterModel implements IParameterModel {\n  private id: string;\n  private variable: VariableModel;\n  private shouldFireEvents = false;\n  private procedureModel: IProcedureModel|null = null;\n\n  constructor(\n      private readonly workspace: Workspace, name: string, id?: string) {\n    this.id = id ?? genUid();\n    this.variable =\n        this.workspace.getVariable(name) ?? workspace.createVariable(name);\n  }\n\n  /**\n   * Sets the name of this parameter to the given name.\n   */\n  setName(name: string): this {\n    if (name === this.variable.name) return this;\n    const oldName = this.variable.name;\n    this.variable =\n        this.workspace.getVariable(name) ?? this.workspace.createVariable(name);\n    triggerProceduresUpdate(this.workspace);\n    if (this.shouldFireEvents) {\n      eventUtils.fire(\n          new (eventUtils.get(eventUtils.PROCEDURE_PARAMETER_RENAME))(\n              this.workspace, this.procedureModel, this, oldName));\n    }\n    return this;\n  }\n\n  /**\n   * Unimplemented. The built-in ParameterModel does not support typing.\n   * If you want your procedure blocks to have typed parameters, you need to\n   * implement your own ParameterModel.\n   *\n   * @throws Throws for the ObservableParameterModel specifically because this\n   *     method is unimplemented.\n   */\n  setTypes(_types: string[]): this {\n    throw new Error(\n        'The built-in ParameterModel does not support typing. You need to ' +\n        'implement your own custom ParameterModel.');\n  }\n\n  /**\n   * Returns the name of this parameter.\n   */\n  getName(): string {\n    return this.variable.name;\n  }\n\n  /**\n   * Returns the types of this parameter.\n   */\n  getTypes(): string[] {\n    return [];\n  }\n\n  /**\n   * Returns the unique language-neutral ID for the parameter.\n   *\n   * This represents the identify of the variable model which does not change\n   * over time.\n   */\n  getId(): string {\n    return this.id;\n  }\n\n  /** Returns the variable model associated with the parameter model. */\n  getVariableModel(): VariableModel {\n    return this.variable;\n  }\n\n  /**\n   * Tells the parameter model it should fire events.\n   *\n   * @internal\n   */\n  startPublishing() {\n    this.shouldFireEvents = true;\n  }\n\n  /**\n   * Tells the parameter model it should not fire events.\n   *\n   * @internal\n   */\n  stopPublishing() {\n    this.shouldFireEvents = false;\n  }\n\n  /** Sets the procedure model this parameter is a part of. */\n  setProcedureModel(model: IProcedureModel): this {\n    // TODO: Not sure if we want to do this, or accept it via the constructor.\n    //   That means it could be non-null, but it would also break the fluent\n    //   API.\n    this.procedureModel = model;\n    return this;\n  }\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Measurable types.\n *\n * @namespace Blockly.blockRendering.Types\n */\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.Types');\n\nimport type {Measurable} from './base.js';\nimport type {Row} from './row.js';\n\n\n/**\n * Types of rendering elements.\n *\n * @alias Blockly.blockRendering.Types\n */\nclass TypesContainer {\n  [index: string]: number|Function;\n\n  NONE = 0;                       // None\n  FIELD = 1 << 0;                 // Field.\n  HAT = 1 << 1;                   // Hat.\n  ICON = 1 << 2;                  // Icon.\n  SPACER = 1 << 3;                // Spacer.\n  BETWEEN_ROW_SPACER = 1 << 4;    // Between Row Spacer.\n  IN_ROW_SPACER = 1 << 5;         // In Row Spacer.\n  EXTERNAL_VALUE_INPUT = 1 << 6;  // External Value Input.\n  INPUT = 1 << 7;                 // Input.\n  INLINE_INPUT = 1 << 8;          // Inline Input.\n  STATEMENT_INPUT = 1 << 9;       // Statement Input.\n  CONNECTION = 1 << 10;           // Connection.\n  PREVIOUS_CONNECTION = 1 << 11;  // Previous Connection.\n  NEXT_CONNECTION = 1 << 12;      // Next Connection.\n  OUTPUT_CONNECTION = 1 << 13;    // Output Connection.\n  CORNER = 1 << 14;               // Corner.\n  LEFT_SQUARE_CORNER = 1 << 15;   // Square Corner.\n  LEFT_ROUND_CORNER = 1 << 16;    // Round Corner.\n  RIGHT_SQUARE_CORNER = 1 << 17;  // Right Square Corner.\n  RIGHT_ROUND_CORNER = 1 << 18;   // Right Round Corner.\n  JAGGED_EDGE = 1 << 19;          // Jagged Edge.\n  ROW = 1 << 20;                  // Row.\n  TOP_ROW = 1 << 21;              // Top Row.\n  BOTTOM_ROW = 1 << 22;           // Bottom Row.\n  INPUT_ROW = 1 << 23;            // Input Row.\n\n  /**\n   * A Left Corner Union Type.\n   *\n   * @internal\n   */\n  LEFT_CORNER = this.LEFT_SQUARE_CORNER | this.LEFT_ROUND_CORNER;\n\n  /**\n   * A Right Corner Union Type.\n   *\n   * @internal\n   */\n  RIGHT_CORNER = this.RIGHT_SQUARE_CORNER | this.RIGHT_ROUND_CORNER;\n\n  /**\n   * Next flag value to use for custom rendering element types.\n   * This must be updated to reflect the next enum flag value\n   * to use if additional elements are added to\n   * `Types`.\n   */\n  nextTypeValue_ = 1 << 24;\n\n  /**\n   * Get the enum flag value of an existing type or register a new type.\n   *\n   * @param type The name of the type.\n   * @returns The enum flag value associated with that type.\n   * @internal\n   */\n  getType(type: string): number {\n    if (!Object.prototype.hasOwnProperty.call(this, type)) {\n      this[type] = this.nextTypeValue_;\n      this.nextTypeValue_ <<= 1;\n    }\n    return this[type] as number;\n  }\n\n  /**\n   * Whether a measurable stores information about a field.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a field.\n   * @internal\n   */\n  isField(elem: Measurable): number {\n    return elem.type & this.FIELD;\n  }\n\n  /**\n   * Whether a measurable stores information about a hat.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a hat.\n   * @internal\n   */\n  isHat(elem: Measurable): number {\n    return elem.type & this.HAT;\n  }\n\n  /**\n   * Whether a measurable stores information about an icon.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about an icon.\n   * @internal\n   */\n  isIcon(elem: Measurable): number {\n    return elem.type & this.ICON;\n  }\n\n  /**\n   * Whether a measurable stores information about a spacer.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a spacer.\n   * @internal\n   */\n  isSpacer(elem: Measurable|Row): number {\n    return elem.type & this.SPACER;\n  }\n\n  /**\n   * Whether a measurable stores information about an in-row spacer.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about an in-row spacer.\n   * @internal\n   */\n  isInRowSpacer(elem: Measurable): number {\n    return elem.type & this.IN_ROW_SPACER;\n  }\n\n  /**\n   * Whether a measurable stores information about an input.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about an input.\n   * @internal\n   */\n  isInput(elem: Measurable): number {\n    return elem.type & this.INPUT;\n  }\n\n  /**\n   * Whether a measurable stores information about an external input.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about an external input.\n   * @internal\n   */\n  isExternalInput(elem: Measurable): number {\n    return elem.type & this.EXTERNAL_VALUE_INPUT;\n  }\n\n  /**\n   * Whether a measurable stores information about an inline input.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about an inline input.\n   * @internal\n   */\n  isInlineInput(elem: Measurable): number {\n    return elem.type & this.INLINE_INPUT;\n  }\n\n  /**\n   * Whether a measurable stores information about a statement input.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a statement input.\n   * @internal\n   */\n  isStatementInput(elem: Measurable): number {\n    return elem.type & this.STATEMENT_INPUT;\n  }\n\n  /**\n   * Whether a measurable stores information about a previous connection.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a previous connection.\n   * @internal\n   */\n  isPreviousConnection(elem: Measurable): number {\n    return elem.type & this.PREVIOUS_CONNECTION;\n  }\n\n  /**\n   * Whether a measurable stores information about a next connection.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a next connection.\n   * @internal\n   */\n  isNextConnection(elem: Measurable): number {\n    return elem.type & this.NEXT_CONNECTION;\n  }\n\n  /**\n   * Whether a measurable stores information about a previous or next\n   * connection.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a previous or next\n   *     connection.\n   * @internal\n   */\n  isPreviousOrNextConnection(elem: Measurable): number {\n    return elem.type & (this.PREVIOUS_CONNECTION | this.NEXT_CONNECTION);\n  }\n\n  /**\n   * Whether a measurable stores information about a left round corner.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a left round corner.\n   * @internal\n   */\n  isLeftRoundedCorner(elem: Measurable): number {\n    return elem.type & this.LEFT_ROUND_CORNER;\n  }\n\n  /**\n   * Whether a measurable stores information about a right round corner.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a right round corner.\n   * @internal\n   */\n  isRightRoundedCorner(elem: Measurable): number {\n    return elem.type & this.RIGHT_ROUND_CORNER;\n  }\n\n  /**\n   * Whether a measurable stores information about a left square corner.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a left square corner.\n   * @internal\n   */\n  isLeftSquareCorner(elem: Measurable): number {\n    return elem.type & this.LEFT_SQUARE_CORNER;\n  }\n\n  /**\n   * Whether a measurable stores information about a right square corner.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a right square corner.\n   * @internal\n   */\n  isRightSquareCorner(elem: Measurable): number {\n    return elem.type & this.RIGHT_SQUARE_CORNER;\n  }\n\n  /**\n   * Whether a measurable stores information about a corner.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a corner.\n   * @internal\n   */\n  isCorner(elem: Measurable): number {\n    return elem.type & this.CORNER;\n  }\n\n  /**\n   * Whether a measurable stores information about a jagged edge.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a jagged edge.\n   * @internal\n   */\n  isJaggedEdge(elem: Measurable): number {\n    return elem.type & this.JAGGED_EDGE;\n  }\n\n  /**\n   * Whether a measurable stores information about a row.\n   *\n   * @param row The row to check.\n   * @returns 1 if the object stores information about a row.\n   * @internal\n   */\n  isRow(row: Row): number {\n    return row.type & this.ROW;\n  }\n\n  /**\n   * Whether a measurable stores information about a between-row spacer.\n   *\n   * @param row The row to check.\n   * @returns 1 if the object stores information about a between-row spacer.\n   * @internal\n   */\n  isBetweenRowSpacer(row: Row): number {\n    return row.type & this.BETWEEN_ROW_SPACER;\n  }\n\n  /**\n   * Whether a measurable stores information about a top row.\n   *\n   * @param row The row to check.\n   * @returns 1 if the object stores information about a top row.\n   * @internal\n   */\n  isTopRow(row: Row): number {\n    return row.type & this.TOP_ROW;\n  }\n\n  /**\n   * Whether a measurable stores information about a bottom row.\n   *\n   * @param row The row to check.\n   * @returns 1 if the object stores information about a bottom row.\n   * @internal\n   */\n  isBottomRow(row: Row): number {\n    return row.type & this.BOTTOM_ROW;\n  }\n\n  /**\n   * Whether a measurable stores information about a top or bottom row.\n   *\n   * @param row The row to check.\n   * @returns 1 if the object stores information about a top or bottom row.\n   * @internal\n   */\n  isTopOrBottomRow(row: Row): number {\n    return row.type & (this.TOP_ROW | this.BOTTOM_ROW);\n  }\n\n  /**\n   * Whether a measurable stores information about an input row.\n   *\n   * @param row The row to check.\n   * @returns 1 if the object stores information about an input row.\n   * @internal\n   */\n  isInputRow(row: Row): number {\n    return row.type & this.INPUT_ROW;\n  }\n}\n\nexport const Types = new TypesContainer();\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Methods for graphically rendering a block as SVG.\n *\n * @class\n */\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.Measurable');\n\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {Types} from './types.js';\n\n\n/**\n * The base class to represent a part of a block that takes up space during\n * rendering.  The constructor for each non-spacer Measurable records the size\n * of the block element (e.g. field, statement input).\n *\n * @alias Blockly.blockRendering.Measurable\n */\nexport class Measurable {\n  width = 0;\n\n  height = 0;\n  type: number;\n  xPos = 0;\n\n  centerline = 0;\n  notchOffset: number;\n\n  /** The renderer's constant provider. */\n  protected readonly constants_: ConstantProvider;\n\n  /**\n   * @param constants The rendering constants provider.\n   * @internal\n   */\n  constructor(constants: ConstantProvider) {\n    this.constants_ = constants;\n\n    this.type = Types.NONE;\n\n    this.notchOffset = this.constants_.NOTCH_OFFSET_LEFT;\n  }\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing a single row on a rendered block.\n *\n * @class\n */\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.Row');\n\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport type {Measurable} from './base.js';\nimport type {InRowSpacer} from './in_row_spacer.js';\nimport type {InputConnection} from './input_connection.js';\nimport {Types} from './types.js';\n\n\n/**\n * An object representing a single row on a rendered block and all of its\n * subcomponents.\n *\n * @alias Blockly.blockRendering.Row\n */\nexport class Row {\n  /** @internal */\n  type: number;\n\n  /**\n   * An array of elements contained in this row.\n   *\n   * @internal\n   */\n  elements: Measurable[] = [];\n\n  /**\n   * The height of the row.\n   *\n   * @internal\n   */\n  height = 0;\n\n  /**\n   * The width of the row, from the left edge of the block to the right.\n   * Does not include child blocks unless they are inline.\n   *\n   * @internal\n   */\n  width = 0;\n\n  /**\n   * The minimum height of the row.\n   *\n   * @internal\n   */\n  minHeight = 0;\n\n  /**\n   * The minimum width of the row, from the left edge of the block to the\n   * right. Does not include child blocks unless they are inline.\n   *\n   * @internal\n   */\n  minWidth = 0;\n\n  /**\n   * The width of the row, from the left edge of the block to the edge of the\n   * block or any connected child blocks.\n   *\n   * @internal\n   */\n  widthWithConnectedBlocks = 0;\n\n  /**\n   * The Y position of the row relative to the origin of the block's svg\n   * group.\n   *\n   * @internal\n   */\n  yPos = 0;\n\n  /**\n   * The X position of the row relative to the origin of the block's svg\n   * group.\n   *\n   * @internal\n   */\n  xPos = 0;\n\n  /**\n   * Whether the row has any external inputs.\n   *\n   * @internal\n   */\n  hasExternalInput = false;\n\n  /**\n   * Whether the row has any statement inputs.\n   *\n   * @internal\n   */\n  hasStatement = false;\n\n  /**\n   * Where the left edge of all of the statement inputs on the block should\n   * be. This makes sure that statement inputs which are proceded by fields\n   * of varius widths are all aligned.\n   */\n  statementEdge = 0;\n\n  /**\n   * Whether the row has any inline inputs.\n   *\n   * @internal\n   */\n  hasInlineInput = false;\n\n  /**\n   * Whether the row has any dummy inputs.\n   *\n   * @internal\n   */\n  hasDummyInput = false;\n\n  /**\n   * Whether the row has a jagged edge.\n   *\n   * @internal\n   */\n  hasJaggedEdge = false;\n  notchOffset: number;\n\n  /**\n   * Alignment of the row.\n   *\n   * @internal\n   */\n  align: number|null = null;\n\n  protected readonly constants_: ConstantProvider;\n\n  /**\n   * @param constants The rendering constants provider.\n   * @internal\n   */\n  constructor(constants: ConstantProvider) {\n    /** The renderer's constant provider. */\n    this.constants_ = constants;\n\n    /** The type of this rendering object. */\n    this.type = Types.ROW;\n\n    this.notchOffset = this.constants_.NOTCH_OFFSET_LEFT;\n  }\n\n  /**\n   * Get the last input on this row, if it has one.\n   *\n   * @returns The last input on the row, or null.\n   * @internal\n   */\n  getLastInput(): InputConnection|null {\n    // TODO: Consider moving this to InputRow, if possible.\n    for (let i = this.elements.length - 1; i >= 0; i--) {\n      const elem = this.elements[i];\n      if (Types.isInput(elem)) {\n        return elem as InputConnection;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Inspect all subcomponents and populate all size properties on the row.\n   *\n   * @internal\n   */\n  measure() {\n    throw Error('Unexpected attempt to measure a base Row.');\n  }\n\n  /**\n   * Determines whether this row should start with an element spacer.\n   *\n   * @returns Whether the row should start with a spacer.\n   * @internal\n   */\n  startsWithElemSpacer(): boolean {\n    return true;\n  }\n\n  /**\n   * Determines whether this row should end with an element spacer.\n   *\n   * @returns Whether the row should end with a spacer.\n   * @internal\n   */\n  endsWithElemSpacer(): boolean {\n    return true;\n  }\n\n  /**\n   * Convenience method to get the first spacer element on this row.\n   *\n   * @returns The first spacer element on this row.\n   * @internal\n   */\n  getFirstSpacer(): InRowSpacer|null {\n    for (let i = 0; i < this.elements.length; i++) {\n      const elem = this.elements[i];\n      if (Types.isSpacer(elem)) {\n        return elem as InRowSpacer;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Convenience method to get the last spacer element on this row.\n   *\n   * @returns The last spacer element on this row.\n   * @internal\n   */\n  getLastSpacer(): InRowSpacer|null {\n    for (let i = this.elements.length - 1; i >= 0; i--) {\n      const elem = this.elements[i];\n      if (Types.isSpacer(elem)) {\n        return elem as InRowSpacer;\n      }\n    }\n    return null;\n  }\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing a bottom row on a rendered block.\n * of its subcomponents.\n *\n * @class\n */\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.BottomRow');\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport type {NextConnection} from './next_connection.js';\nimport {Row} from './row.js';\nimport {Types} from './types.js';\n\n\n/**\n * An object containing information about what elements are in the bottom row of\n * a block as well as spacing information for the bottom row.\n * Elements in a bottom row can consist of corners, spacers and next\n * connections.\n *\n * @alias Blockly.blockRendering.BottomRow\n */\nexport class BottomRow extends Row {\n  /**\n   * Whether this row has a next connection.\n   *\n   * @internal\n   */\n  hasNextConnection = false;\n\n  /**\n   * The next connection on the row, if any.\n   *\n   * @internal\n   */\n  connection: NextConnection|null = null;\n\n  /**\n   * The amount that the bottom of the block extends below the horizontal\n   * edge, e.g. because of a next connection.  Must be non-negative (see\n   * #2820).\n   *\n   * @internal\n   */\n  descenderHeight = 0;\n\n  /**\n   * The Y position of the bottom edge of the block, relative to the origin\n   * of the block rendering.\n   */\n  baseline = 0;\n\n  /**\n   * @param constants The rendering constants provider.\n   * @internal\n   */\n  constructor(constants: ConstantProvider) {\n    super(constants);\n    this.type |= Types.BOTTOM_ROW;\n  }\n\n  /**\n   * Returns whether or not the bottom row has a left square corner.\n   *\n   * @param block The block whose bottom row this represents.\n   * @returns Whether or not the bottom row has a left square corner.\n   */\n  hasLeftSquareCorner(block: BlockSvg): boolean {\n    return !!block.outputConnection || !!block.getNextBlock();\n  }\n\n  /**\n   * Returns whether or not the bottom row has a right square corner.\n   *\n   * @param _block The block whose bottom row this represents.\n   * @returns Whether or not the bottom row has a right square corner.\n   */\n  hasRightSquareCorner(_block: BlockSvg): boolean {\n    return true;\n  }\n\n  override measure() {\n    let height = 0;\n    let width = 0;\n    let descenderHeight = 0;\n    for (let i = 0; i < this.elements.length; i++) {\n      const elem = this.elements[i];\n      width += elem.width;\n      if (!Types.isSpacer(elem)) {\n        // Note: this assumes that next connections have *only* descenderHeight,\n        // with no height above the baseline.\n        if (Types.isNextConnection(elem)) {\n          descenderHeight = Math.max(descenderHeight, elem.height);\n        } else {\n          height = Math.max(height, elem.height);\n        }\n      }\n    }\n    this.width = Math.max(this.minWidth, width);\n    this.height = Math.max(this.minHeight, height) + descenderHeight;\n    this.descenderHeight = descenderHeight;\n    this.widthWithConnectedBlocks = this.width;\n  }\n\n  override startsWithElemSpacer() {\n    return false;\n  }\n\n  override endsWithElemSpacer() {\n    return false;\n  }\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Base class representing the space a connection takes up during\n * rendering.\n *\n * @class\n */\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.Connection');\n\n/* eslint-disable-next-line no-unused-vars */\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport type {ConstantProvider, Shape} from '../common/constants.js';\n\nimport {Measurable} from './base.js';\nimport {Types} from './types.js';\n\n\n/**\n * The base class to represent a connection and the space that it takes up on\n * the block.\n *\n * @alias Blockly.blockRendering.Connection\n */\nexport class Connection extends Measurable {\n  shape: Shape;\n  isDynamicShape: boolean;\n\n  /**\n   * @param constants The rendering constants provider.\n   * @param connectionModel The connection object on the block that this\n   *     represents.\n   * @internal\n   */\n  constructor(\n      constants: ConstantProvider, public connectionModel: RenderedConnection) {\n    super(constants);\n\n    this.shape = this.constants_.shapeFor(connectionModel);\n\n    this.isDynamicShape = 'isDynamic' in this.shape && this.shape.isDynamic;\n    this.type |= Types.CONNECTION;\n  }\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class representing inputs with connections on a rendered block.\n *\n * @class\n */\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.InputConnection');\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport type {Input} from '../../input.js';\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {Connection} from './connection.js';\nimport {Types} from './types.js';\n\n\n/**\n * The base class to represent an input that takes up space on a block\n * during rendering\n *\n * @alias Blockly.blockRendering.InputConnection\n */\nexport class InputConnection extends Connection {\n  align: number;\n  connectedBlock: BlockSvg|null;\n  connectedBlockWidth: number;\n  connectedBlockHeight: number;\n  connectionOffsetX = 0;\n  connectionOffsetY = 0;\n\n  /**\n   * @param constants The rendering constants provider.\n   * @param input The input to measure and store information for.\n   * @internal\n   */\n  constructor(constants: ConstantProvider, public input: Input) {\n    super(constants, input.connection as RenderedConnection);\n\n    this.type |= Types.INPUT;\n\n    this.align = input.align;\n\n    this.connectedBlock =\n        (input.connection && input.connection.targetBlock() ?\n             input.connection.targetBlock() as BlockSvg :\n             null);\n\n    if (this.connectedBlock) {\n      const bBox = this.connectedBlock.getHeightWidth();\n      this.connectedBlockWidth = bBox.width;\n      this.connectedBlockHeight = bBox.height;\n    } else {\n      this.connectedBlockWidth = 0;\n      this.connectedBlockHeight = 0;\n    }\n  }\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class representing external value inputs with connections on a\n * rendered block.\n *\n * @class\n */\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.ExternalValueInput');\n\n/* eslint-disable-next-line no-unused-vars */\nimport type {Input} from '../../input.js';\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {InputConnection} from './input_connection.js';\nimport {Types} from './types.js';\n\n\n/**\n * An object containing information about the space an external value input\n * takes up during rendering\n *\n * @alias Blockly.blockRendering.ExternalValueInput\n */\nexport class ExternalValueInput extends InputConnection {\n  override height = 0;\n  override width: number;\n  override connectionOffsetY: number;\n  connectionHeight: number;\n  connectionWidth: number;\n\n  /**\n   * @param constants The rendering constants provider.\n   * @param input The external value input to measure and store information for.\n   * @internal\n   */\n  constructor(constants: ConstantProvider, input: Input) {\n    super(constants, input);\n    this.type |= Types.EXTERNAL_VALUE_INPUT;\n    if (!this.connectedBlock) {\n      this.height = this.shape.height as number;\n    } else {\n      this.height = this.connectedBlockHeight -\n          this.constants_.TAB_OFFSET_FROM_TOP - this.constants_.MEDIUM_PADDING;\n    }\n\n    this.width = this.shape.width as\n        number + this.constants_.EXTERNAL_VALUE_INPUT_PADDING;\n\n    this.connectionOffsetY = this.constants_.TAB_OFFSET_FROM_TOP;\n\n    this.connectionHeight = this.shape.height as number;\n\n    this.connectionWidth = this.shape.width as number;\n  }\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Objects representing a field in a row of a rendered\n * block.\n *\n * @class\n */\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.Field');\n\n/* eslint-disable-next-line no-unused-vars */\nimport type {Field as BlocklyField} from '../../field.js';\nimport type {Input} from '../../input.js';\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {Measurable} from './base.js';\nimport {Types} from './types.js';\n\n\n/**\n * An object containing information about the space a field takes up during\n * rendering\n *\n * @alias Blockly.blockRendering.Field\n */\nexport class Field extends Measurable {\n  isEditable: boolean;\n  flipRtl: boolean;\n  override height: number;\n  override width: number;\n\n  /**\n   * @param constants The rendering constants provider.\n   * @param field The field to measure and store information for.\n   * @param parentInput The parent input for the field.\n   * @internal\n   */\n  constructor(\n      constants: ConstantProvider, public field: BlocklyField,\n      public parentInput: Input) {\n    super(constants);\n\n    this.isEditable = field.EDITABLE;\n\n    this.flipRtl = field.getFlipRtl();\n    this.type |= Types.FIELD;\n\n    const size = this.field.getSize();\n\n    this.height = size.height;\n\n    this.width = size.width;\n  }\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Objects representing a hat in a row of a rendered\n * block.\n *\n * @class\n */\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.Hat');\n\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {Measurable} from './base.js';\nimport {Types} from './types.js';\n\n\n/**\n * An object containing information about the space a hat takes up during\n * rendering.\n *\n * @alias Blockly.blockRendering.Hat\n */\nexport class Hat extends Measurable {\n  ascenderHeight: number;\n\n  /**\n   * @param constants The rendering constants provider.\n   * @internal\n   */\n  constructor(constants: ConstantProvider) {\n    super(constants);\n    this.type |= Types.HAT;\n\n    this.height = this.constants_.START_HAT.height;\n    this.width = this.constants_.START_HAT.width;\n\n    this.ascenderHeight = this.height;\n  }\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Objects representing an icon in a row of a rendered\n * block.\n *\n * @class\n */\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.Icon');\n\n/* eslint-disable-next-line no-unused-vars */\nimport type {Icon as BlocklyIcon} from '../../icon.js';\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {Measurable} from './base.js';\nimport {Types} from './types.js';\n\n\n/**\n * An object containing information about the space an icon takes up during\n * rendering\n *\n * @alias Blockly.blockRendering.Icon\n */\nexport class Icon extends Measurable {\n  isVisible: boolean;\n  flipRtl = false;\n\n  /**\n   * An object containing information about the space an icon takes up during\n   * rendering\n   *\n   * @param constants The rendering constants provider.\n   * @param icon The icon to measure and store information for.\n   * @internal\n   */\n  constructor(constants: ConstantProvider, public icon: BlocklyIcon) {\n    super(constants);\n\n    this.isVisible = icon.isVisible();\n    this.type |= Types.ICON;\n\n    const size = icon.getCorrectedSize();\n    this.height = size.height;\n    this.width = size.width;\n  }\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Objects representing a spacer in a row of a rendered\n * block.\n *\n * @class\n */\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.InRowSpacer');\n\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {Measurable} from './base.js';\nimport {Types} from './types.js';\n\n\n/**\n * An object containing information about a spacer between two elements on a\n * row.\n *\n * @alias Blockly.blockRendering.InRowSpacer\n */\nexport class InRowSpacer extends Measurable {\n  /**\n   * @param constants The rendering constants provider.\n   * @param width The width of the spacer.\n   * @internal\n   */\n  constructor(constants: ConstantProvider, width: number) {\n    super(constants);\n    this.type |= Types.SPACER | Types.IN_ROW_SPACER;\n    this.width = width;\n    this.height = this.constants_.SPACER_DEFAULT_HEIGHT;\n  }\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class representing inline inputs with connections on a rendered\n * block.\n *\n * @class\n */\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.InlineInput');\n\n/* eslint-disable-next-line no-unused-vars */\nimport type {Input} from '../../input.js';\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {InputConnection} from './input_connection.js';\nimport {Types} from './types.js';\n\n\n/**\n * An object containing information about the space an inline input takes up\n * during rendering\n *\n * @alias Blockly.blockRendering.InlineInput\n */\nexport class InlineInput extends InputConnection {\n  connectionHeight: number;\n  connectionWidth: number;\n\n  /**\n   * @param constants The rendering constants provider.\n   * @param input The inline input to measure and store information for.\n   * @internal\n   */\n  constructor(constants: ConstantProvider, input: Input) {\n    super(constants, input);\n    this.type |= Types.INLINE_INPUT;\n\n    if (!this.connectedBlock) {\n      this.height = this.constants_.EMPTY_INLINE_INPUT_HEIGHT;\n      this.width = this.constants_.EMPTY_INLINE_INPUT_PADDING;\n    } else {\n      // We allow the dark path to show on the parent block so that the child\n      // block looks embossed.  This takes up an extra pixel in both x and y.\n      this.width = this.connectedBlockWidth;\n      this.height = this.connectedBlockHeight;\n    }\n\n    this.connectionHeight = !this.isDynamicShape ?\n        this.shape.height as number :\n        (this.shape.height as (p1: number) => number)(this.height);\n\n    this.connectionWidth = !this.isDynamicShape ?\n        this.shape.width as number :\n        (this.shape.width as (p1: number) => number)(this.height);\n    if (!this.connectedBlock) {\n      this.width += this.connectionWidth * (this.isDynamicShape ? 2 : 1);\n    }\n\n    this.connectionOffsetY = 'connectionOffsetY' in this.shape ?\n        this.shape.connectionOffsetY(this.connectionHeight) :\n        this.constants_.TAB_OFFSET_FROM_TOP;\n\n    this.connectionOffsetX = 'connectionOffsetX' in this.shape ?\n        this.shape.connectionOffsetX(this.connectionWidth) :\n        0;\n  }\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class representing statement inputs with connections on a\n * rendered block.\n *\n * @class\n */\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.StatementInput');\n\n/* eslint-disable-next-line no-unused-vars */\nimport type {Input} from '../../input.js';\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {InputConnection} from './input_connection.js';\nimport {Types} from './types.js';\n\n\n/**\n * An object containing information about the space a statement input takes up\n * during rendering\n *\n * @alias Blockly.blockRendering.StatementInput\n */\nexport class StatementInput extends InputConnection {\n  /**\n   * @param constants The rendering constants provider.\n   * @param input The statement input to measure and store information for.\n   * @internal\n   */\n  constructor(constants: ConstantProvider, input: Input) {\n    super(constants, input);\n    this.type |= Types.STATEMENT_INPUT;\n\n    if (!this.connectedBlock) {\n      this.height = this.constants_.EMPTY_STATEMENT_INPUT_HEIGHT;\n    } else {\n      // We allow the dark path to show on the parent block so that the child\n      // block looks embossed.  This takes up an extra pixel in both x and y.\n      this.height =\n          this.connectedBlockHeight + this.constants_.STATEMENT_BOTTOM_SPACER;\n    }\n    this.width = this.constants_.STATEMENT_INPUT_NOTCH_OFFSET +\n        (this.shape.width as number);\n  }\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing a row that holds one or more inputs on a\n * rendered block.\n *\n * @class\n */\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.InputRow');\n\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {ExternalValueInput} from './external_value_input.js';\nimport {InputConnection} from './input_connection.js';\nimport {Row} from './row.js';\nimport {StatementInput} from './statement_input.js';\nimport {Types} from './types.js';\n\n\n/**\n * An object containing information about a row that holds one or more inputs.\n *\n * @alias Blockly.blockRendering.InputRow\n */\nexport class InputRow extends Row {\n  /**\n   * The total width of all blocks connected to this row.\n   *\n   * @internal\n   */\n  connectedBlockWidths = 0;\n\n  /**\n   * @param constants The rendering constants provider.\n   * @internal\n   */\n  constructor(constants: ConstantProvider) {\n    super(constants);\n    this.type |= Types.INPUT_ROW;\n  }\n\n  /**\n   * Inspect all subcomponents and populate all size properties on the row.\n   *\n   * @internal\n   */\n  override measure() {\n    this.width = this.minWidth;\n    this.height = this.minHeight;\n    let connectedBlockWidths = 0;\n    for (let i = 0; i < this.elements.length; i++) {\n      const elem = this.elements[i];\n      this.width += elem.width;\n      if (Types.isInput(elem) && elem instanceof InputConnection) {\n        if (Types.isStatementInput(elem) && elem instanceof StatementInput) {\n          connectedBlockWidths += elem.connectedBlockWidth;\n        } else if (\n            Types.isExternalInput(elem) && elem instanceof ExternalValueInput &&\n            elem.connectedBlockWidth !== 0) {\n          connectedBlockWidths +=\n              elem.connectedBlockWidth - elem.connectionWidth;\n        }\n      }\n      if (!Types.isSpacer(elem)) {\n        this.height = Math.max(this.height, elem.height);\n      }\n    }\n    this.connectedBlockWidths = connectedBlockWidths;\n    this.widthWithConnectedBlocks = this.width + connectedBlockWidths;\n  }\n\n  override endsWithElemSpacer() {\n    return !this.hasExternalInput && !this.hasStatement;\n  }\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Objects representing a jagged edge in a row of a rendered\n * block.\n *\n * @class\n */\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.JaggedEdge');\n\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {Measurable} from './base.js';\nimport {Types} from './types.js';\n\n\n/**\n * An object containing information about the jagged edge of a collapsed block\n * takes up during rendering\n *\n * @alias Blockly.blockRendering.JaggedEdge\n */\nexport class JaggedEdge extends Measurable {\n  /**\n   * @param constants The rendering constants provider.\n   * @internal\n   */\n  constructor(constants: ConstantProvider) {\n    super(constants);\n    this.type |= Types.JAGGED_EDGE;\n    this.height = this.constants_.JAGGED_TEETH.height;\n    this.width = this.constants_.JAGGED_TEETH.width;\n  }\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class representing the space a next connection takes up during\n * rendering.\n *\n * @class\n */\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.NextConnection');\n\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {Connection} from './connection.js';\nimport {Types} from './types.js';\n\n\n/**\n * An object containing information about the space a next connection takes\n * up during rendering.\n *\n * @alias Blockly.blockRendering.NextConnection\n */\nexport class NextConnection extends Connection {\n  /**\n   * @param constants The rendering constants provider.\n   * @param connectionModel The connection object on the block that this\n   *     represents.\n   * @internal\n   */\n  constructor(\n      constants: ConstantProvider, connectionModel: RenderedConnection) {\n    super(constants, connectionModel);\n    this.type |= Types.NEXT_CONNECTION;\n    this.height = this.shape.height as number;\n    this.width = this.shape.width as number;\n  }\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class representing the space a output connection takes up\n * during rendering.\n *\n * @class\n */\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.OutputConnection');\n\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {Connection} from './connection.js';\nimport {Types} from './types.js';\n\n\n/**\n * An object containing information about the space an output connection takes\n * up during rendering.\n *\n * @alias Blockly.blockRendering.OutputConnection\n */\nexport class OutputConnection extends Connection {\n  startX: number;\n  connectionOffsetY: number;\n  connectionOffsetX = 0;\n\n  /**\n   * @param constants The rendering constants provider.\n   * @param connectionModel The connection object on the block that this\n   *     represents.\n   * @internal\n   */\n  constructor(\n      constants: ConstantProvider, connectionModel: RenderedConnection) {\n    super(constants, connectionModel);\n    this.type |= Types.OUTPUT_CONNECTION;\n\n    this.height = !this.isDynamicShape ? this.shape.height as number : 0;\n    this.width = !this.isDynamicShape ? this.shape.width as number : 0;\n\n    this.startX = this.width;\n\n    this.connectionOffsetY = this.constants_.TAB_OFFSET_FROM_TOP;\n  }\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class representing the space a previous connection takes up\n * during rendering.\n *\n * @class\n */\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.PreviousConnection');\n\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {Connection} from './connection.js';\nimport {Types} from './types.js';\n\n\n/**\n * An object containing information about the space a previous connection takes\n * up during rendering.\n *\n * @alias Blockly.blockRendering.PreviousConnection\n */\nexport class PreviousConnection extends Connection {\n  /**\n   * @param constants The rendering constants provider.\n   * @param connectionModel The connection object on the block that this\n   *     represents.\n   * @internal\n   */\n  constructor(\n      constants: ConstantProvider, connectionModel: RenderedConnection) {\n    super(constants, connectionModel);\n    this.type |= Types.PREVIOUS_CONNECTION;\n    this.height = this.shape.height as number;\n    this.width = this.shape.width as number;\n  }\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Objects representing a round corner in a row of a rendered\n * block.\n *\n * @class\n */\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.RoundCorner');\n\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {Measurable} from './base.js';\nimport {Types} from './types.js';\n\n\n/**\n * An object containing information about the space a rounded corner takes up\n * during rendering.\n *\n * @alias Blockly.blockRendering.RoundCorner\n */\nexport class RoundCorner extends Measurable {\n  /**\n   * @param constants The rendering constants provider.\n   * @param opt_position The position of this corner.\n   * @internal\n   */\n  constructor(constants: ConstantProvider, opt_position?: string) {\n    super(constants);\n    this.type =\n        (!opt_position || opt_position === 'left' ? Types.LEFT_ROUND_CORNER :\n                                                    Types.RIGHT_ROUND_CORNER) |\n        Types.CORNER;\n    this.width = this.constants_.CORNER_RADIUS;\n    // The rounded corner extends into the next row by 4 so we only take the\n    // height that is aligned with this row.\n    this.height = this.constants_.CORNER_RADIUS / 2;\n  }\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing a spacer between two rows.\n *\n * @class\n */\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.SpacerRow');\n\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {InRowSpacer} from './in_row_spacer.js';\nimport {Row} from './row.js';\nimport {Types} from './types.js';\n\n\n/**\n * An object containing information about a spacer between two rows.\n *\n * @alias Blockly.blockRendering.SpacerRow\n */\nexport class SpacerRow extends Row {\n  followsStatement = false;\n\n  precedesStatement = false;\n\n  override widthWithConnectedBlocks = 0;\n  override elements: InRowSpacer[];\n\n  /**\n   * @param constants The rendering constants provider.\n   * @param height The height of the spacer.\n   * @param width The width of the spacer.\n   * @internal\n   */\n  constructor(\n      constants: ConstantProvider, public override height: number,\n      public override width: number) {\n    super(constants);\n    this.type |= Types.SPACER | Types.BETWEEN_ROW_SPACER;\n\n    this.elements = [new InRowSpacer(this.constants_, width)];\n  }\n\n  override measure() {}\n}\n// NOP.  Width and height were set at creation.\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Objects representing a square corner in a row of a rendered\n * block.\n *\n * @class\n */\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.SquareCorner');\n\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {Measurable} from './base.js';\nimport {Types} from './types.js';\n\n\n/**\n * An object containing information about the space a square corner takes up\n * during rendering.\n *\n * @alias Blockly.blockRendering.SquareCorner\n */\nexport class SquareCorner extends Measurable {\n  /**\n   * @param constants The rendering constants provider.\n   * @param opt_position The position of this corner.\n   * @internal\n   */\n  constructor(constants: ConstantProvider, opt_position?: string) {\n    super(constants);\n    this.type =\n        (!opt_position || opt_position === 'left' ? Types.LEFT_SQUARE_CORNER :\n                                                    Types.RIGHT_SQUARE_CORNER) |\n        Types.CORNER;\n    this.height = this.constants_.NO_PADDING;\n    this.width = this.constants_.NO_PADDING;\n  }\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing a top row on a rendered block.\n *\n * @class\n */\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.TopRow');\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {Hat} from './hat.js';\nimport type {PreviousConnection} from './previous_connection.js';\nimport {Row} from './row.js';\nimport {Types} from './types.js';\n\n\n/**\n * An object containing information about what elements are in the top row of a\n * block as well as sizing information for the top row.\n * Elements in a top row can consist of corners, hats, spacers, and previous\n * connections.\n * After this constructor is called, the row will contain all non-spacer\n * elements it needs.\n *\n * @alias Blockly.blockRendering.TopRow\n */\nexport class TopRow extends Row {\n  /**\n   * The starting point for drawing the row, in the y direction.\n   * This allows us to draw hats and similar shapes that don't start at the\n   * origin. Must be non-negative (see #2820).\n   *\n   * @internal\n   */\n  capline = 0;\n\n  /** How much the row extends up above its capline. */\n  ascenderHeight = 0;\n\n  /** Whether the block has a previous connection. */\n  hasPreviousConnection = false;\n\n  /** The previous connection on the block, if any. */\n  connection: PreviousConnection|null = null;\n\n  /**\n   * @param constants The rendering constants provider.\n   * @internal\n   */\n  constructor(constants: ConstantProvider) {\n    super(constants);\n\n    this.type |= Types.TOP_ROW;\n  }\n\n  /**\n   * Returns whether or not the top row has a left square corner.\n   *\n   * @param block The block whose top row this represents.\n   * @returns Whether or not the top row has a left square corner.\n   * @internal\n   */\n  hasLeftSquareCorner(block: BlockSvg): boolean {\n    const hasHat =\n        (block.hat ? block.hat === 'cap' : this.constants_.ADD_START_HATS) &&\n        !block.outputConnection && !block.previousConnection;\n    const prevBlock = block.getPreviousBlock();\n\n    return !!block.outputConnection || hasHat ||\n        (prevBlock ? prevBlock.getNextBlock() === block : false);\n  }\n\n  /**\n   * Returns whether or not the top row has a right square corner.\n   *\n   * @param _block The block whose top row this represents.\n   * @returns Whether or not the top row has a right square corner.\n   */\n  hasRightSquareCorner(_block: BlockSvg): boolean {\n    return true;\n  }\n\n  override measure() {\n    let height = 0;\n    let width = 0;\n    let ascenderHeight = 0;\n    for (let i = 0; i < this.elements.length; i++) {\n      const elem = this.elements[i];\n      width += elem.width;\n      if (!Types.isSpacer(elem)) {\n        if (Types.isHat(elem) && elem instanceof Hat) {\n          ascenderHeight = Math.max(ascenderHeight, elem.ascenderHeight);\n        } else {\n          height = Math.max(height, elem.height);\n        }\n      }\n    }\n    this.width = Math.max(this.minWidth, width);\n    this.height = Math.max(this.minHeight, height) + ascenderHeight;\n    this.ascenderHeight = ascenderHeight;\n    this.capline = this.ascenderHeight;\n    this.widthWithConnectedBlocks = this.width;\n  }\n\n  override startsWithElemSpacer() {\n    return false;\n  }\n\n  override endsWithElemSpacer() {\n    return false;\n  }\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Methods for rendering debug graphics.\n *\n * @class\n */\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.Debug');\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport {ConnectionType} from '../../connection_type.js';\nimport {FieldLabel} from '../../field_label.js';\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport * as dom from '../../utils/dom.js';\nimport {Svg} from '../../utils/svg.js';\nimport type {Measurable} from '../measurables/base.js';\nimport {Field} from '../measurables/field.js';\nimport type {InRowSpacer} from '../measurables/in_row_spacer.js';\nimport {InputConnection} from '../measurables/input_connection.js';\nimport type {Row} from '../measurables/row.js';\nimport {Types} from '../measurables/types.js';\nimport type {RenderInfo as ZelosInfo} from '../zelos/info.js';\n\nimport type {ConstantProvider} from './constants.js';\nimport type {RenderInfo} from './info.js';\n\n\n/**\n * An object that renders rectangles and dots for debugging rendering code.\n *\n * @alias Blockly.blockRendering.Debug\n */\nexport class Debug {\n  /**\n   * Configuration object containing booleans to enable and disable debug\n   * rendering of specific rendering components.\n   */\n  static config = {\n    rowSpacers: true,\n    elemSpacers: true,\n    rows: true,\n    elems: true,\n    connections: true,\n    blockBounds: true,\n    connectedBlockBounds: true,\n    render: true,\n  };\n\n  /** An array of SVG elements that have been created by this object. */\n  private debugElements_: SVGElement[] = [];\n\n  /**\n   * The SVG root of the block that is being rendered.  Debug elements will\n   * be attached to this root.\n   */\n  private svgRoot_: SVGElement|null = null;\n\n  private randomColour_ = '';\n\n  /**\n   * @param constants The renderer's constants.\n   * @internal\n   */\n  constructor(private readonly constants: ConstantProvider) {}\n\n  /**\n   * Remove all elements the this object created on the last pass.\n   *\n   * @internal\n   */\n  clearElems() {\n    for (let i = 0; i < this.debugElements_.length; i++) {\n      const elem = this.debugElements_[i];\n      dom.removeNode(elem);\n    }\n\n    this.debugElements_ = [];\n  }\n\n  /**\n   * Draw a debug rectangle for a spacer (empty) row.\n   *\n   * @param row The row to render.\n   * @param cursorY The y position of the top of the row.\n   * @param isRtl Whether the block is rendered RTL.\n   * @internal\n   */\n  drawSpacerRow(row: Row, cursorY: number, isRtl: boolean) {\n    if (!Debug.config.rowSpacers) {\n      return;\n    }\n\n    const height = Math.abs(row.height);\n    const isNegativeSpacing = row.height < 0;\n    if (isNegativeSpacing) {\n      cursorY -= height;\n    }\n\n    this.debugElements_.push(dom.createSvgElement(\n        Svg.RECT, {\n          'class': 'rowSpacerRect blockRenderDebug',\n          'x': isRtl ? -(row.xPos + row.width) : row.xPos,\n          'y': cursorY,\n          'width': row.width,\n          'height': height,\n          'stroke': isNegativeSpacing ? 'black' : 'blue',\n          'fill': 'blue',\n          'fill-opacity': '0.5',\n          'stroke-width': '1px',\n        },\n        this.svgRoot_));\n  }\n\n  /**\n   * Draw a debug rectangle for a horizontal spacer.\n   *\n   * @param elem The spacer to render.\n   * @param rowHeight The height of the container row.\n   * @param isRtl Whether the block is rendered RTL.\n   * @internal\n   */\n  drawSpacerElem(elem: InRowSpacer, rowHeight: number, isRtl: boolean) {\n    if (!Debug.config.elemSpacers) {\n      return;\n    }\n\n    const width = Math.abs(elem.width);\n    const isNegativeSpacing = elem.width < 0;\n    let xPos = isNegativeSpacing ? elem.xPos - width : elem.xPos;\n    if (isRtl) {\n      xPos = -(xPos + width);\n    }\n    const yPos = elem.centerline - elem.height / 2;\n    this.debugElements_.push(dom.createSvgElement(\n        Svg.RECT, {\n          'class': 'elemSpacerRect blockRenderDebug',\n          'x': xPos,\n          'y': yPos,\n          'width': width,\n          'height': elem.height,\n          'stroke': 'pink',\n          'fill': isNegativeSpacing ? 'black' : 'pink',\n          'fill-opacity': '0.5',\n          'stroke-width': '1px',\n        },\n        this.svgRoot_));\n  }\n\n  /**\n   * Draw a debug rectangle for an in-row element.\n   *\n   * @param elem The element to render.\n   * @param isRtl Whether the block is rendered RTL.\n   * @internal\n   */\n  drawRenderedElem(elem: Measurable, isRtl: boolean) {\n    if (Debug.config.elems) {\n      let xPos = elem.xPos;\n      if (isRtl) {\n        xPos = -(xPos + elem.width);\n      }\n      const yPos = elem.centerline - elem.height / 2;\n      this.debugElements_.push(dom.createSvgElement(\n          Svg.RECT, {\n            'class': 'rowRenderingRect blockRenderDebug',\n            'x': xPos,\n            'y': yPos,\n            'width': elem.width,\n            'height': elem.height,\n            'stroke': 'black',\n            'fill': 'none',\n            'stroke-width': '1px',\n          },\n          this.svgRoot_));\n\n      if (Types.isField(elem) && elem instanceof Field &&\n          elem.field instanceof FieldLabel) {\n        const baseline = this.constants.FIELD_TEXT_BASELINE;\n        this.debugElements_.push(dom.createSvgElement(\n            Svg.RECT, {\n              'class': 'rowRenderingRect blockRenderDebug',\n              'x': xPos,\n              'y': yPos + baseline,\n              'width': elem.width,\n              'height': '0.1px',\n              'stroke': 'red',\n              'fill': 'none',\n              'stroke-width': '0.5px',\n            },\n            this.svgRoot_));\n      }\n    }\n\n    if (Types.isInput(elem) && elem instanceof InputConnection &&\n        Debug.config.connections) {\n      this.drawConnection(elem.connectionModel);\n    }\n  }\n\n  /**\n   * Draw a circle at the location of the given connection.  Inputs and outputs\n   * share the same colours, as do previous and next.  When positioned correctly\n   * a connected pair will look like a bullseye.\n   *\n   * @param conn The connection to circle.\n   * @suppress {visibility} Suppress visibility of conn.offsetInBlock_ since\n   * this is a debug module.\n   * @internal\n   */\n  drawConnection(conn: RenderedConnection) {\n    if (!Debug.config.connections) {\n      return;\n    }\n\n    let colour = '';\n    let size = 0;\n    let fill = '';\n    if (conn.type === ConnectionType.INPUT_VALUE) {\n      size = 4;\n      colour = 'magenta';\n      fill = 'none';\n    } else if (conn.type === ConnectionType.OUTPUT_VALUE) {\n      size = 2;\n      colour = 'magenta';\n      fill = colour;\n    } else if (conn.type === ConnectionType.NEXT_STATEMENT) {\n      size = 4;\n      colour = 'goldenrod';\n      fill = 'none';\n    } else if (conn.type === ConnectionType.PREVIOUS_STATEMENT) {\n      size = 2;\n      colour = 'goldenrod';\n      fill = colour;\n    }\n    this.debugElements_.push(dom.createSvgElement(\n        Svg.CIRCLE, {\n          'class': 'blockRenderDebug',\n          'cx': conn.getOffsetInBlock().x,\n          'cy': conn.getOffsetInBlock().y,\n          'r': size,\n          'fill': fill,\n          'stroke': colour,\n        },\n        this.svgRoot_));\n  }\n\n  /**\n   * Draw a debug rectangle for a non-empty row.\n   *\n   * @param row The non-empty row to render.\n   * @param cursorY The y position of the top of the row.\n   * @param isRtl Whether the block is rendered RTL.\n   * @internal\n   */\n  drawRenderedRow(row: Row, cursorY: number, isRtl: boolean) {\n    if (!Debug.config.rows) {\n      return;\n    }\n    this.debugElements_.push(dom.createSvgElement(\n        Svg.RECT, {\n          'class': 'elemRenderingRect blockRenderDebug',\n          'x': isRtl ? -(row.xPos + row.width) : row.xPos,\n          'y': row.yPos,\n          'width': row.width,\n          'height': row.height,\n          'stroke': 'red',\n          'fill': 'none',\n          'stroke-width': '1px',\n        },\n        this.svgRoot_));\n\n    if (Types.isTopOrBottomRow(row)) {\n      return;\n    }\n\n    if (Debug.config.connectedBlockBounds) {\n      this.debugElements_.push(dom.createSvgElement(\n          Svg.RECT, {\n            'class': 'connectedBlockWidth blockRenderDebug',\n            'x': isRtl ? -(row.xPos + row.widthWithConnectedBlocks) : row.xPos,\n            'y': row.yPos,\n            'width': row.widthWithConnectedBlocks,\n            'height': row.height,\n            'stroke': this.randomColour_,\n            'fill': 'none',\n            'stroke-width': '1px',\n            'stroke-dasharray': '3,3',\n          },\n          this.svgRoot_));\n    }\n  }\n\n  /**\n   * Draw debug rectangles for a non-empty row and all of its subcomponents.\n   *\n   * @param row The non-empty row to render.\n   * @param cursorY The y position of the top of the row.\n   * @param isRtl Whether the block is rendered RTL.\n   * @internal\n   */\n  drawRowWithElements(row: Row, cursorY: number, isRtl: boolean) {\n    for (let i = 0; i < row.elements.length; i++) {\n      const elem = row.elements[i];\n      if (!elem) {\n        console.warn('A row has an undefined or null element.', row, elem);\n        continue;\n      }\n      if (Types.isSpacer(elem)) {\n        this.drawSpacerElem(elem as InRowSpacer, row.height, isRtl);\n      } else {\n        this.drawRenderedElem(elem, isRtl);\n      }\n    }\n    this.drawRenderedRow(row, cursorY, isRtl);\n  }\n\n  /**\n   * Draw a debug rectangle around the entire block.\n   *\n   * @param info Rendering information about the block to debug.\n   * @internal\n   */\n  drawBoundingBox(info: RenderInfo) {\n    if (!Debug.config.blockBounds) {\n      return;\n    }\n    // Bounding box without children.\n    let xPos = info.RTL ? -info.width : 0;\n    const yPos = 0;\n    this.debugElements_.push(dom.createSvgElement(\n        Svg.RECT, {\n          'class': 'blockBoundingBox blockRenderDebug',\n          'x': xPos,\n          'y': yPos,\n          'width': info.width,\n          'height': info.height,\n          'stroke': 'black',\n          'fill': 'none',\n          'stroke-width': '1px',\n          'stroke-dasharray': '5,5',\n        },\n        this.svgRoot_));\n\n    if (Debug.config.connectedBlockBounds) {\n      // Bounding box with children.\n      xPos = info.RTL ? -info.widthWithChildren : 0;\n      this.debugElements_.push(dom.createSvgElement(\n          Svg.RECT, {\n            'class': 'blockRenderDebug',\n            'x': xPos,\n            'y': yPos,\n            'width': info.widthWithChildren,\n            'height': info.height,\n            'stroke': '#DF57BC',\n            'fill': 'none',\n            'stroke-width': '1px',\n            'stroke-dasharray': '3,3',\n          },\n          this.svgRoot_));\n    }\n  }\n\n  /**\n   * Do all of the work to draw debug information for the whole block.\n   *\n   * @param block The block to draw debug information for.\n   * @param info Rendering information about the block to debug.\n   * @internal\n   */\n  drawDebug(block: BlockSvg, info: RenderInfo) {\n    this.clearElems();\n    this.svgRoot_ = block.getSvgRoot();\n\n    this.randomColour_ =\n        '#' + Math.floor(Math.random() * 16777215).toString(16);\n\n    let cursorY = 0;\n    for (let i = 0; i < info.rows.length; i++) {\n      const row = info.rows[i];\n      if (Types.isBetweenRowSpacer(row)) {\n        this.drawSpacerRow(row, cursorY, info.RTL);\n      } else {\n        this.drawRowWithElements(row, cursorY, info.RTL);\n      }\n      cursorY += row.height;\n    }\n\n    if (block.previousConnection) {\n      this.drawConnection(block.previousConnection);\n    }\n    if (block.nextConnection) {\n      this.drawConnection(block.nextConnection);\n    }\n    if (block.outputConnection) {\n      this.drawConnection(block.outputConnection);\n    }\n    /**\n     * TODO: Find a better way to do this check without pulling in all of\n     * zelos, or just delete this line or the whole debug renderer.\n     */\n    const maybeZelosInfo = info as ZelosInfo;\n    if (maybeZelosInfo.rightSide) {\n      this.drawRenderedElem(maybeZelosInfo.rightSide, info.RTL);\n    }\n\n    this.drawBoundingBox(info);\n\n    this.drawRender(block.pathObject.svgPath);\n  }\n\n  /**\n   * Show a debug filter to highlight that a block has been rendered.\n   *\n   * @param svgPath The block's SVG path.\n   * @internal\n   */\n  drawRender(svgPath: SVGElement) {\n    if (!Debug.config.render) {\n      return;\n    }\n    svgPath.setAttribute(\n        'filter', 'url(#' + this.constants.debugFilterId + ')');\n    setTimeout(function() {\n      svgPath.setAttribute('filter', '');\n    }, 100);\n  }\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Methods for graphically rendering a block as SVG.\n *\n * @class\n */\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.Drawer');\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport {Coordinate} from '../../utils.js';\nimport * as svgPaths from '../../utils/svg_paths.js';\nimport {Connection} from '../measurables/connection.js';\nimport type {ExternalValueInput} from '../measurables/external_value_input.js';\nimport type {Field} from '../measurables/field.js';\nimport type {Icon} from '../measurables/icon.js';\nimport type {InlineInput} from '../measurables/inline_input.js';\nimport type {PreviousConnection} from '../measurables/previous_connection.js';\nimport type {Row} from '../measurables/row.js';\nimport {Types} from '../measurables/types.js';\n\nimport {isDynamicShape} from './constants.js';\nimport type {ConstantProvider, Notch, PuzzleTab} from './constants.js';\nimport * as debug from './debug.js';\nimport type {RenderInfo} from './info.js';\n\n\n/**\n * An object that draws a block based on the given rendering information.\n *\n * @alias Blockly.blockRendering.Drawer\n */\nexport class Drawer {\n  block_: BlockSvg;\n  info_: RenderInfo;\n  topLeft_: Coordinate;\n  outlinePath_ = '';\n  inlinePath_ = '';\n  protected constants_: ConstantProvider;\n\n  /**\n   * @param block The block to render.\n   * @param info An object containing all information needed to render this\n   *     block.\n   * @internal\n   */\n  constructor(block: BlockSvg, info: RenderInfo) {\n    this.block_ = block;\n    this.info_ = info;\n    this.topLeft_ = block.getRelativeToSurfaceXY();\n\n    /** The renderer's constant provider. */\n    this.constants_ = info.getRenderer().getConstants();\n  }\n\n  /**\n   * Draw the block to the workspace. Here \"drawing\" means setting SVG path\n   * elements and moving fields, icons, and connections on the screen.\n   *\n   * The pieces of the paths are pushed into arrays of \"steps\", which are then\n   * joined with spaces and set directly on the block.  This guarantees that\n   * the steps are separated by spaces for improved readability, but isn't\n   * required.\n   *\n   * @internal\n   */\n  draw() {\n    this.hideHiddenIcons_();\n    this.drawOutline_();\n    this.drawInternals_();\n\n    this.block_.pathObject.setPath(this.outlinePath_ + '\\n' + this.inlinePath_);\n    if (this.info_.RTL) {\n      this.block_.pathObject.flipRTL();\n    }\n    if (debug.isDebuggerEnabled()) {\n      this.block_.renderingDebugger?.drawDebug(this.block_, this.info_);\n    }\n    this.recordSizeOnBlock_();\n  }\n\n  /**\n   * Save sizing information back to the block\n   * Most of the rendering information can be thrown away at the end of the\n   * render. Anything that needs to be kept around should be set in this\n   * function.\n   */\n  protected recordSizeOnBlock_() {\n    // This is used when the block is reporting its size to anyone else.\n    // The dark path adds to the size of the block in both X and Y.\n    this.block_.height = this.info_.height;\n    this.block_.width = this.info_.widthWithChildren;\n  }\n\n  /** Hide icons that were marked as hidden. */\n  protected hideHiddenIcons_() {\n    for (let i = 0, iconInfo; iconInfo = this.info_.hiddenIcons[i]; i++) {\n      iconInfo.icon.iconGroup_?.setAttribute('display', 'none');\n    }\n  }\n\n  /** Create the outline of the block.  This is a single continuous path. */\n  protected drawOutline_() {\n    this.drawTop_();\n    for (let r = 1; r < this.info_.rows.length - 1; r++) {\n      const row = this.info_.rows[r];\n      if (row.hasJaggedEdge) {\n        this.drawJaggedEdge_(row);\n      } else if (row.hasStatement) {\n        this.drawStatementInput_(row);\n      } else if (row.hasExternalInput) {\n        this.drawValueInput_(row);\n      } else {\n        this.drawRightSideRow_(row);\n      }\n    }\n    this.drawBottom_();\n    this.drawLeft_();\n  }\n\n  /**\n   * Add steps for the top corner of the block, taking into account\n   * details such as hats and rounded corners.\n   */\n  protected drawTop_() {\n    const topRow = this.info_.topRow;\n    const elements = topRow.elements;\n\n    this.positionPreviousConnection_();\n    this.outlinePath_ += svgPaths.moveBy(topRow.xPos, this.info_.startY);\n    for (let i = 0, elem; elem = elements[i]; i++) {\n      if (Types.isLeftRoundedCorner(elem)) {\n        this.outlinePath_ += this.constants_.OUTSIDE_CORNERS.topLeft;\n      } else if (Types.isRightRoundedCorner(elem)) {\n        this.outlinePath_ += this.constants_.OUTSIDE_CORNERS.topRight;\n      } else if (\n          Types.isPreviousConnection(elem) && elem instanceof Connection) {\n        this.outlinePath_ +=\n            ((elem as PreviousConnection).shape as Notch).pathLeft;\n      } else if (Types.isHat(elem)) {\n        this.outlinePath_ += this.constants_.START_HAT.path;\n      } else if (Types.isSpacer(elem)) {\n        this.outlinePath_ += svgPaths.lineOnAxis('h', elem.width);\n      }\n    }\n    // No branch for a square corner, because it's a no-op.\n    this.outlinePath_ += svgPaths.lineOnAxis('v', topRow.height);\n  }\n\n  /**\n   * Add steps for the jagged edge of a row on a collapsed block.\n   *\n   * @param row The row to draw the side of.\n   */\n  protected drawJaggedEdge_(row: Row) {\n    const remainder = row.height - this.constants_.JAGGED_TEETH.height;\n    this.outlinePath_ +=\n        this.constants_.JAGGED_TEETH.path + svgPaths.lineOnAxis('v', remainder);\n  }\n\n  /**\n   * Add steps for an external value input, rendered as a notch in the side\n   * of the block.\n   *\n   * @param row The row that this input belongs to.\n   */\n  protected drawValueInput_(row: Row) {\n    const input = row.getLastInput() as ExternalValueInput | InlineInput;\n    this.positionExternalValueConnection_(row);\n\n    const pathDown = isDynamicShape(input.shape) ?\n        input.shape.pathDown(input.height) :\n        (input.shape as PuzzleTab).pathDown;\n\n    this.outlinePath_ += svgPaths.lineOnAxis('H', input.xPos + input.width) +\n        pathDown +\n        svgPaths.lineOnAxis('v', row.height - input.connectionHeight);\n  }\n\n  /**\n   * Add steps for a statement input.\n   *\n   * @param row The row that this input belongs to.\n   */\n  protected drawStatementInput_(row: Row) {\n    const input = row.getLastInput();\n    if (!input) return;\n    // Where to start drawing the notch, which is on the right side in LTR.\n    const x = input.xPos + input.notchOffset + (input.shape as Notch).width;\n\n    const innerTopLeftCorner = (input.shape as Notch).pathRight +\n        svgPaths.lineOnAxis(\n            'h', -(input.notchOffset - this.constants_.INSIDE_CORNERS.width)) +\n        this.constants_.INSIDE_CORNERS.pathTop;\n\n    const innerHeight = row.height - 2 * this.constants_.INSIDE_CORNERS.height;\n\n    this.outlinePath_ += svgPaths.lineOnAxis('H', x) + innerTopLeftCorner +\n        svgPaths.lineOnAxis('v', innerHeight) +\n        this.constants_.INSIDE_CORNERS.pathBottom +\n        svgPaths.lineOnAxis('H', row.xPos + row.width);\n\n    this.positionStatementInputConnection_(row);\n  }\n\n  /**\n   * Add steps for the right side of a row that does not have value or\n   * statement input connections.\n   *\n   * @param row The row to draw the side of.\n   */\n  protected drawRightSideRow_(row: Row) {\n    this.outlinePath_ += svgPaths.lineOnAxis('V', row.yPos + row.height);\n  }\n\n  /**\n   * Add steps for the bottom edge of a block, possibly including a notch\n   * for the next connection.\n   */\n  protected drawBottom_() {\n    const bottomRow = this.info_.bottomRow;\n    const elems = bottomRow.elements;\n    this.positionNextConnection_();\n\n    let rightCornerYOffset = 0;\n    let outlinePath = '';\n    for (let i = elems.length - 1, elem; elem = elems[i]; i--) {\n      if (Types.isNextConnection(elem) && elem instanceof Connection) {\n        outlinePath += (elem.shape as Notch).pathRight;\n      } else if (Types.isLeftSquareCorner(elem)) {\n        outlinePath += svgPaths.lineOnAxis('H', bottomRow.xPos);\n      } else if (Types.isLeftRoundedCorner(elem)) {\n        outlinePath += this.constants_.OUTSIDE_CORNERS.bottomLeft;\n      } else if (Types.isRightRoundedCorner(elem)) {\n        outlinePath += this.constants_.OUTSIDE_CORNERS.bottomRight;\n        rightCornerYOffset = this.constants_.OUTSIDE_CORNERS.rightHeight;\n      } else if (Types.isSpacer(elem)) {\n        outlinePath += svgPaths.lineOnAxis('h', elem.width * -1);\n      }\n    }\n\n    this.outlinePath_ +=\n        svgPaths.lineOnAxis('V', bottomRow.baseline - rightCornerYOffset);\n    this.outlinePath_ += outlinePath;\n  }\n\n  /**\n   * Add steps for the left side of the block, which may include an output\n   * connection\n   */\n  protected drawLeft_() {\n    const outputConnection = this.info_.outputConnection;\n    this.positionOutputConnection_();\n\n    if (outputConnection) {\n      const tabBottom =\n          outputConnection.connectionOffsetY + outputConnection.height;\n      const pathUp = isDynamicShape(outputConnection.shape) ?\n          outputConnection.shape.pathUp(outputConnection.height) :\n          (outputConnection.shape as PuzzleTab).pathUp;\n\n      // Draw a line up to the bottom of the tab.\n      this.outlinePath_ += svgPaths.lineOnAxis('V', tabBottom) + pathUp;\n    }\n    // Close off the path.  This draws a vertical line up to the start of the\n    // block's path, which may be either a rounded or a sharp corner.\n    this.outlinePath_ += 'z';\n  }\n\n  /**\n   * Draw the internals of the block: inline inputs, fields, and icons.  These\n   * do not depend on the outer path for placement.\n   */\n  protected drawInternals_() {\n    for (let i = 0, row; row = this.info_.rows[i]; i++) {\n      for (let j = 0, elem; elem = row.elements[j]; j++) {\n        if (Types.isInlineInput(elem)) {\n          this.drawInlineInput_(elem as InlineInput);\n        } else if (Types.isIcon(elem) || Types.isField(elem)) {\n          this.layoutField_(elem as Field | Icon);\n        }\n      }\n    }\n  }\n\n  /**\n   * Push a field or icon's new position to its SVG root.\n   *\n   * @param fieldInfo The rendering information for the field or icon.\n   */\n  protected layoutField_(fieldInfo: Icon|Field) {\n    const svgGroup = Types.isField(fieldInfo) ?\n        (fieldInfo as Field).field.getSvgRoot()! :\n        (fieldInfo as Icon).icon.iconGroup_!;  // Never null in rendered case.\n\n    const yPos = fieldInfo.centerline - fieldInfo.height / 2;\n    let xPos = fieldInfo.xPos;\n    let scale = '';\n    if (this.info_.RTL) {\n      xPos = -(xPos + fieldInfo.width);\n      if (fieldInfo.flipRtl) {\n        xPos += fieldInfo.width;\n        scale = 'scale(-1 1)';\n      }\n    }\n    if (Types.isIcon(fieldInfo)) {\n      svgGroup.setAttribute('display', 'block');\n      svgGroup.setAttribute(\n          'transform', 'translate(' + xPos + ',' + yPos + ')');\n      (fieldInfo as Icon).icon.computeIconLocation();\n    } else {\n      svgGroup.setAttribute(\n          'transform', 'translate(' + xPos + ',' + yPos + ')' + scale);\n    }\n\n    if (this.info_.isInsertionMarker) {\n      // Fields and icons are invisible on insertion marker.  They still have to\n      // be rendered so that the block can be sized correctly.\n      svgGroup.setAttribute('display', 'none');\n    }\n  }\n\n  /**\n   * Add steps for an inline input.\n   *\n   * @param input The information about the input to render.\n   */\n  protected drawInlineInput_(input: InlineInput) {\n    const width = input.width;\n    const height = input.height;\n    const yPos = input.centerline - height / 2;\n\n    const connectionTop = input.connectionOffsetY;\n    const connectionBottom = input.connectionHeight + connectionTop;\n    const connectionRight = input.xPos + input.connectionWidth;\n\n    this.inlinePath_ += svgPaths.moveTo(connectionRight, yPos) +\n        svgPaths.lineOnAxis('v', connectionTop) +\n        (input.shape as PuzzleTab).pathDown +\n        svgPaths.lineOnAxis('v', height - connectionBottom) +\n        svgPaths.lineOnAxis('h', width - input.connectionWidth) +\n        svgPaths.lineOnAxis('v', -height) + 'z';\n\n    this.positionInlineInputConnection_(input);\n  }\n\n  /**\n   * Position the connection on an inline value input, taking into account\n   * RTL and the small gap between the parent block and child block which lets\n   * the parent block's dark path show through.\n   *\n   * @param input The information about the input that the connection is on.\n   */\n  protected positionInlineInputConnection_(input: InlineInput) {\n    const yPos = input.centerline - input.height / 2;\n    // Move the connection.\n    if (input.connectionModel) {\n      // xPos already contains info about startX\n      let connX = input.xPos + input.connectionWidth + input.connectionOffsetX;\n      if (this.info_.RTL) {\n        connX *= -1;\n      }\n      input.connectionModel.setOffsetInBlock(\n          connX, yPos + input.connectionOffsetY);\n    }\n  }\n\n  /**\n   * Position the connection on a statement input, taking into account\n   * RTL and the small gap between the parent block and child block which lets\n   * the parent block's dark path show through.\n   *\n   * @param row The row that the connection is on.\n   */\n  protected positionStatementInputConnection_(row: Row) {\n    const input = row.getLastInput();\n    if (input?.connectionModel) {\n      let connX = row.xPos + row.statementEdge + input.notchOffset;\n      if (this.info_.RTL) {\n        connX *= -1;\n      }\n      input.connectionModel.setOffsetInBlock(connX, row.yPos);\n    }\n  }\n\n  /**\n   * Position the connection on an external value input, taking into account\n   * RTL and the small gap between the parent block and child block which lets\n   * the parent block's dark path show through.\n   *\n   * @param row The row that the connection is on.\n   */\n  protected positionExternalValueConnection_(row: Row) {\n    const input = row.getLastInput();\n    if (input && input.connectionModel) {\n      let connX = row.xPos + row.width;\n      if (this.info_.RTL) {\n        connX *= -1;\n      }\n      input.connectionModel.setOffsetInBlock(connX, row.yPos);\n    }\n  }\n\n  /** Position the previous connection on a block. */\n  protected positionPreviousConnection_() {\n    const topRow = this.info_.topRow;\n    if (topRow.connection) {\n      const x = topRow.xPos + topRow.notchOffset;\n      const connX = this.info_.RTL ? -x : x;\n      topRow.connection.connectionModel.setOffsetInBlock(connX, 0);\n    }\n  }\n\n  /** Position the next connection on a block. */\n  protected positionNextConnection_() {\n    const bottomRow = this.info_.bottomRow;\n\n    if (bottomRow.connection) {\n      const connInfo = bottomRow.connection;\n      const x = connInfo.xPos;  // Already contains info about startX.\n      const connX = this.info_.RTL ? -x : x;\n      connInfo.connectionModel.setOffsetInBlock(connX, bottomRow.baseline);\n    }\n  }\n\n  /** Position the output connection on a block. */\n  protected positionOutputConnection_() {\n    if (this.info_.outputConnection) {\n      const x =\n          this.info_.startX + this.info_.outputConnection.connectionOffsetX;\n      const connX = this.info_.RTL ? -x : x;\n      this.block_.outputConnection.setOffsetInBlock(\n          connX, this.info_.outputConnection.connectionOffsetY);\n    }\n  }\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Methods for graphically rendering a block as SVG.\n *\n * @class\n */\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.RenderInfo');\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport {Align, Input} from '../../input.js';\nimport {inputTypes} from '../../input_types.js';\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport type {Measurable} from '../measurables/base.js';\nimport {BottomRow} from '../measurables/bottom_row.js';\nimport {ExternalValueInput} from '../measurables/external_value_input.js';\nimport {Field} from '../measurables/field.js';\nimport {Hat} from '../measurables/hat.js';\nimport {Icon} from '../measurables/icon.js';\nimport {InRowSpacer} from '../measurables/in_row_spacer.js';\nimport {InlineInput} from '../measurables/inline_input.js';\nimport {InputRow} from '../measurables/input_row.js';\nimport {JaggedEdge} from '../measurables/jagged_edge.js';\nimport {NextConnection} from '../measurables/next_connection.js';\nimport {OutputConnection} from '../measurables/output_connection.js';\nimport {PreviousConnection} from '../measurables/previous_connection.js';\nimport {RoundCorner} from '../measurables/round_corner.js';\nimport type {Row} from '../measurables/row.js';\nimport {SpacerRow} from '../measurables/spacer_row.js';\nimport {SquareCorner} from '../measurables/square_corner.js';\nimport {StatementInput} from '../measurables/statement_input.js';\nimport {TopRow} from '../measurables/top_row.js';\nimport {Types} from '../measurables/types.js';\n\nimport type {ConstantProvider} from './constants.js';\nimport type {Renderer} from './renderer.js';\n\n\n/**\n * An object containing all sizing information needed to draw this block.\n *\n * This measure pass does not propagate changes to the block (although fields\n * may choose to rerender when getSize() is called).  However, calling it\n * repeatedly may be expensive.\n *\n * @alias Blockly.blockRendering.RenderInfo\n */\nexport class RenderInfo {\n  block_: BlockSvg;\n  protected constants_: ConstantProvider;\n  outputConnection: OutputConnection|null;\n  isInline: boolean;\n  isCollapsed: boolean;\n  isInsertionMarker: boolean;\n  RTL: boolean;\n\n  /** The block renderer in use. */\n  protected readonly renderer_!: Renderer;\n\n  /** The height of the rendered block, including child blocks. */\n  height = 0;\n\n  /** The width of the rendered block, including child blocks. */\n  widthWithChildren = 0;\n\n  /**\n   * The width of the rendered block, excluding child blocks.  This is the\n   * right edge of the block when rendered LTR.\n   */\n  width = 0;\n  statementEdge = 0;\n\n  /** An array of Row objects containing sizing information. */\n  rows: Row[] = [];\n\n  /** An array of input rows on the block. */\n  inputRows: InputRow[] = [];\n\n  /** An array of measurable objects containing hidden icons. */\n  hiddenIcons: Icon[] = [];\n  topRow: TopRow;\n  bottomRow: BottomRow;\n\n  // The position of the start point for drawing, relative to the block's\n  // location.\n  startX = 0;\n  startY = 0;\n\n  /**\n   * @param renderer The renderer in use.\n   * @param block The block to measure.\n   * @internal\n   */\n  constructor(renderer: Renderer, block: BlockSvg) {\n    this.renderer_ = renderer;\n\n    this.block_ = block;\n\n    /** The renderer's constant provider. */\n    this.constants_ = this.renderer_.getConstants();\n\n    /**\n     * A measurable representing the output connection if the block has one.\n     * Otherwise null.\n     */\n    this.outputConnection = block.outputConnection ?\n        new OutputConnection(this.constants_, block.outputConnection) :\n        null;\n\n    /**\n     * Whether the block should be rendered as a single line, either because\n     * it's inline or because it has been collapsed.\n     */\n    this.isInline = block.getInputsInline() && !block.isCollapsed();\n\n    /** Whether the block is collapsed. */\n    this.isCollapsed = block.isCollapsed();\n\n    /**\n     * Whether the block is an insertion marker.  Insertion markers are the same\n     * shape as normal blocks, but don't show fields.\n     */\n    this.isInsertionMarker = block.isInsertionMarker();\n\n    /** True if the block should be rendered right-to-left. */\n    this.RTL = block.RTL;\n\n    /**\n     * An object with rendering information about the top row of the block.\n     */\n    this.topRow = new TopRow(this.constants_);\n\n    /**\n     * An object with rendering information about the bottom row of the block.\n     */\n    this.bottomRow = new BottomRow(this.constants_);\n  }\n\n  /**\n   * Get the block renderer in use.\n   *\n   * @returns The block renderer in use.\n   * @internal\n   */\n  getRenderer(): Renderer {\n    return this.renderer_;\n  }\n\n  /**\n   * Populate and return an object containing all sizing information needed to\n   * draw this block.\n   *\n   * This measure pass does not propagate changes to the block (although fields\n   * may choose to rerender when getSize() is called).  However, calling it\n   * repeatedly may be expensive.\n   *\n   * @internal\n   */\n  measure() {\n    this.createRows_();\n    this.addElemSpacing_();\n    this.addRowSpacing_();\n    this.computeBounds_();\n    this.alignRowElements_();\n    this.finalize_();\n  }\n\n  /**\n   * Create rows of Measurable objects representing all renderable parts of the\n   * block.\n   */\n  protected createRows_() {\n    this.populateTopRow_();\n    this.rows.push(this.topRow);\n    let activeRow = new InputRow(this.constants_);\n    this.inputRows.push(activeRow);\n\n    // Icons always go on the first row, before anything else.\n    const icons = this.block_.getIcons();\n    for (let i = 0, icon; icon = icons[i]; i++) {\n      const iconInfo = new Icon(this.constants_, icon);\n      if (this.isCollapsed && icon.collapseHidden) {\n        this.hiddenIcons.push(iconInfo);\n      } else {\n        activeRow.elements.push(iconInfo);\n      }\n    }\n\n    let lastInput = undefined;\n    // Loop across all of the inputs on the block, creating objects for anything\n    // that needs to be rendered and breaking the block up into visual rows.\n    for (let i = 0, input; input = this.block_.inputList[i]; i++) {\n      if (!input.isVisible()) {\n        continue;\n      }\n      if (this.shouldStartNewRow_(input, lastInput)) {\n        // Finish this row and create a new one.\n        this.rows.push(activeRow);\n        activeRow = new InputRow(this.constants_);\n        this.inputRows.push(activeRow);\n      }\n\n      // All of the fields in an input go on the same row.\n      for (let j = 0, field; field = input.fieldRow[j]; j++) {\n        activeRow.elements.push(new Field(this.constants_, field, input));\n      }\n      this.addInput_(input, activeRow);\n      lastInput = input;\n    }\n\n    if (this.isCollapsed) {\n      activeRow.hasJaggedEdge = true;\n      activeRow.elements.push(new JaggedEdge(this.constants_));\n    }\n\n    if (activeRow.elements.length || activeRow.hasDummyInput) {\n      this.rows.push(activeRow);\n    }\n    this.populateBottomRow_();\n    this.rows.push(this.bottomRow);\n  }\n\n  /**\n   * Create all non-spacer elements that belong on the top row.\n   *\n   * @internal\n   */\n  populateTopRow_() {\n    const hasPrevious = !!this.block_.previousConnection;\n    const hasHat = (this.block_.hat ? this.block_.hat === 'cap' :\n                                      this.constants_.ADD_START_HATS) &&\n        !this.outputConnection && !hasPrevious;\n\n    let cornerClass = this.topRow.hasLeftSquareCorner(this.block_) ?\n        SquareCorner :\n        RoundCorner;\n    this.topRow.elements.push(new cornerClass(this.constants_));\n\n    if (hasHat) {\n      const hat = new Hat(this.constants_);\n      this.topRow.elements.push(hat);\n      this.topRow.capline = hat.ascenderHeight;\n    } else if (hasPrevious) {\n      this.topRow.hasPreviousConnection = true;\n      this.topRow.connection = new PreviousConnection(\n          this.constants_,\n          (this.block_.previousConnection as RenderedConnection));\n      this.topRow.elements.push(this.topRow.connection);\n    }\n\n    const precedesStatement = this.block_.inputList.length &&\n        this.block_.inputList[0].type === inputTypes.STATEMENT;\n\n    // This is the minimum height for the row. If one of its elements has a\n    // greater height it will be overwritten in the compute pass.\n    if (precedesStatement && !this.block_.isCollapsed()) {\n      this.topRow.minHeight =\n          this.constants_.TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT;\n    } else {\n      this.topRow.minHeight = this.constants_.TOP_ROW_MIN_HEIGHT;\n    }\n\n    cornerClass = this.topRow.hasRightSquareCorner(this.block_) ? SquareCorner :\n                                                                  RoundCorner;\n    this.topRow.elements.push(new cornerClass(this.constants_, 'right'));\n  }\n\n  /**\n   * Create all non-spacer elements that belong on the bottom row.\n   *\n   * @internal\n   */\n  populateBottomRow_() {\n    this.bottomRow.hasNextConnection = !!this.block_.nextConnection;\n\n    const followsStatement = this.block_.inputList.length &&\n        this.block_.inputList[this.block_.inputList.length - 1].type ===\n            inputTypes.STATEMENT;\n\n    // This is the minimum height for the row. If one of its elements has a\n    // greater height it will be overwritten in the compute pass.\n    if (followsStatement) {\n      this.bottomRow.minHeight =\n          this.constants_.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT;\n    } else {\n      this.bottomRow.minHeight = this.constants_.BOTTOM_ROW_MIN_HEIGHT;\n    }\n\n    const leftSquareCorner = this.bottomRow.hasLeftSquareCorner(this.block_);\n\n    if (leftSquareCorner) {\n      this.bottomRow.elements.push(new SquareCorner(this.constants_));\n    } else {\n      this.bottomRow.elements.push(new RoundCorner(this.constants_));\n    }\n\n    if (this.bottomRow.hasNextConnection) {\n      this.bottomRow.connection = new NextConnection(\n          this.constants_, (this.block_.nextConnection as RenderedConnection));\n      this.bottomRow.elements.push(this.bottomRow.connection);\n    }\n\n    const rightSquareCorner = this.bottomRow.hasRightSquareCorner(this.block_);\n\n    if (rightSquareCorner) {\n      this.bottomRow.elements.push(new SquareCorner(this.constants_, 'right'));\n    } else {\n      this.bottomRow.elements.push(new RoundCorner(this.constants_, 'right'));\n    }\n  }\n\n  /**\n   * Add an input element to the active row, if needed, and record the type of\n   * the input on the row.\n   *\n   * @param input The input to record information about.\n   * @param activeRow The row that is currently being populated.\n   */\n  protected addInput_(input: Input, activeRow: Row) {\n    // Non-dummy inputs have visual representations onscreen.\n    if (this.isInline && input.type === inputTypes.VALUE) {\n      activeRow.elements.push(new InlineInput(this.constants_, input));\n      activeRow.hasInlineInput = true;\n    } else if (input.type === inputTypes.STATEMENT) {\n      activeRow.elements.push(new StatementInput(this.constants_, input));\n      activeRow.hasStatement = true;\n    } else if (input.type === inputTypes.VALUE) {\n      activeRow.elements.push(new ExternalValueInput(this.constants_, input));\n      activeRow.hasExternalInput = true;\n    } else if (input.type === inputTypes.DUMMY) {\n      // Dummy inputs have no visual representation, but the information is\n      // still important.\n      activeRow.minHeight = Math.max(\n          activeRow.minHeight,\n          input.getSourceBlock() && input.getSourceBlock()!.isShadow() ?\n              this.constants_.DUMMY_INPUT_SHADOW_MIN_HEIGHT :\n              this.constants_.DUMMY_INPUT_MIN_HEIGHT);\n      activeRow.hasDummyInput = true;\n    }\n    if (activeRow.align === null) {\n      activeRow.align = input.align;\n    }\n  }\n\n  /**\n   * Decide whether to start a new row between the two Blockly.Inputs.\n   *\n   * @param input The first input to consider\n   * @param lastInput The input that follows.\n   * @returns True if the next input should be rendered on a new row.\n   */\n  protected shouldStartNewRow_(input: Input, lastInput?: Input): boolean {\n    // If this is the first input, just add to the existing row.\n    // That row is either empty or has some icons in it.\n    if (!lastInput) {\n      return false;\n    }\n    // A statement input or an input following one always gets a new row.\n    if (input.type === inputTypes.STATEMENT ||\n        lastInput.type === inputTypes.STATEMENT) {\n      return true;\n    }\n    // Value and dummy inputs get new row if inputs are not inlined.\n    if (input.type === inputTypes.VALUE || input.type === inputTypes.DUMMY) {\n      return !this.isInline;\n    }\n    return false;\n  }\n\n  /** Add horizontal spacing between and around elements within each row. */\n  protected addElemSpacing_() {\n    for (let i = 0, row; row = this.rows[i]; i++) {\n      const oldElems = row.elements;\n      row.elements = [];\n      // No spacing needed before the corner on the top row or the bottom row.\n      if (row.startsWithElemSpacer()) {\n        // There's a spacer before the first element in the row.\n        row.elements.push(new InRowSpacer(\n            this.constants_, this.getInRowSpacing_(null, oldElems[0])));\n      }\n      if (!oldElems.length) {\n        continue;\n      }\n      for (let e = 0; e < oldElems.length - 1; e++) {\n        row.elements.push(oldElems[e]);\n        const spacing = this.getInRowSpacing_(oldElems[e], oldElems[e + 1]);\n        row.elements.push(new InRowSpacer(this.constants_, spacing));\n      }\n      row.elements.push(oldElems[oldElems.length - 1]);\n      if (row.endsWithElemSpacer()) {\n        // There's a spacer after the last element in the row.\n        row.elements.push(new InRowSpacer(\n            this.constants_,\n            this.getInRowSpacing_(oldElems[oldElems.length - 1], null)));\n      }\n    }\n  }\n\n  /**\n   * Calculate the width of a spacer element in a row based on the previous and\n   * next elements in that row.  For instance, extra padding is added between\n   * two editable fields.\n   *\n   * @param prev The element before the spacer.\n   * @param next The element after the spacer.\n   * @returns The size of the spacing between the two elements.\n   */\n  protected getInRowSpacing_(prev: Measurable|null, next: Measurable|null):\n      number {\n    if (!prev) {\n      // Statement input padding.\n      if (next && Types.isStatementInput(next)) {\n        return this.constants_.STATEMENT_INPUT_PADDING_LEFT;\n      }\n    }\n    // Between inputs and the end of the row.\n    if (prev && Types.isInput(prev) && !next) {\n      if (Types.isExternalInput(prev)) {\n        return this.constants_.NO_PADDING;\n      } else if (Types.isInlineInput(prev)) {\n        return this.constants_.LARGE_PADDING;\n      } else if (Types.isStatementInput(prev)) {\n        return this.constants_.NO_PADDING;\n      }\n    }\n\n    // Spacing between a square corner and a previous or next connection\n    if (prev && Types.isLeftSquareCorner(prev) && next) {\n      if (Types.isPreviousConnection(next) || Types.isNextConnection(next)) {\n        return next.notchOffset;\n      }\n    }\n\n    // Spacing between a rounded corner and a previous or next connection.\n    if (prev && Types.isLeftRoundedCorner(prev) && next) {\n      if (Types.isPreviousConnection(next) || Types.isNextConnection(next)) {\n        return next.notchOffset - this.constants_.CORNER_RADIUS;\n      }\n    }\n\n    return this.constants_.MEDIUM_PADDING;\n  }\n\n  /**\n   * Figure out where the right edge of the block and right edge of statement\n   * inputs should be placed.\n   */\n  protected computeBounds_() {\n    let widestStatementRowFields = 0;\n    let blockWidth = 0;\n    let widestRowWithConnectedBlocks = 0;\n    for (let i = 0, row; row = this.rows[i]; i++) {\n      row.measure();\n      blockWidth = Math.max(blockWidth, row.width);\n      if (row.hasStatement) {\n        const statementInput = row.getLastInput();\n        const innerWidth = row.width - (statementInput?.width ?? 0);\n        widestStatementRowFields =\n            Math.max(widestStatementRowFields, innerWidth);\n      }\n      widestRowWithConnectedBlocks =\n          Math.max(widestRowWithConnectedBlocks, row.widthWithConnectedBlocks);\n    }\n\n    this.statementEdge = widestStatementRowFields;\n    this.width = blockWidth;\n\n    for (let i = 0, row; row = this.rows[i]; i++) {\n      if (row.hasStatement) {\n        row.statementEdge = this.statementEdge;\n      }\n    }\n\n    this.widthWithChildren = Math.max(blockWidth, widestRowWithConnectedBlocks);\n\n    if (this.outputConnection) {\n      this.startX = this.outputConnection.width;\n      this.width += this.outputConnection.width;\n      this.widthWithChildren += this.outputConnection.width;\n    }\n  }\n\n  /**\n   * Extra spacing may be necessary to make sure that the right sides of all\n   * rows line up.  This can only be calculated after a first pass to calculate\n   * the sizes of all rows.\n   */\n  protected alignRowElements_() {\n    for (let i = 0, row; row = this.rows[i]; i++) {\n      if (row.hasStatement) {\n        this.alignStatementRow_(row as InputRow);\n      } else {\n        const currentWidth = row.width;\n        const desiredWidth = this.getDesiredRowWidth_(row);\n        const missingSpace = desiredWidth - currentWidth;\n        if (missingSpace > 0) {\n          this.addAlignmentPadding_(row, missingSpace);\n        }\n        if (Types.isTopOrBottomRow(row)) {\n          row.widthWithConnectedBlocks = row.width;\n        }\n      }\n    }\n  }\n\n  /**\n   * Calculate the desired width of an input row.\n   *\n   * @param _row The input row.\n   * @returns The desired width of the input row.\n   */\n  protected getDesiredRowWidth_(_row: Row): number {\n    return this.width - this.startX;\n  }\n\n  /**\n   * Modify the given row to add the given amount of padding around its fields.\n   * The exact location of the padding is based on the alignment property of the\n   * last input in the field.\n   *\n   * @param row The row to add padding to.\n   * @param missingSpace How much padding to add.\n   */\n  protected addAlignmentPadding_(row: Row, missingSpace: number) {\n    const firstSpacer = row.getFirstSpacer();\n    const lastSpacer = row.getLastSpacer();\n    if (row.hasExternalInput || row.hasStatement) {\n      row.widthWithConnectedBlocks += missingSpace;\n    }\n\n    // Decide where the extra padding goes.\n    if (row.align === Align.LEFT && lastSpacer) {\n      // Add padding to the end of the row.\n      lastSpacer.width += missingSpace;\n    } else if (row.align === Align.CENTRE && firstSpacer && lastSpacer) {\n      // Split the padding between the beginning and end of the row.\n      firstSpacer.width += missingSpace / 2;\n      lastSpacer.width += missingSpace / 2;\n    } else if (row.align === Align.RIGHT && firstSpacer) {\n      // Add padding at the beginning of the row.\n      firstSpacer.width += missingSpace;\n    } else if (lastSpacer) {\n      // Default to left-aligning.\n      lastSpacer.width += missingSpace;\n    } else {\n      return;\n    }\n    row.width += missingSpace;\n  }\n\n  /**\n   * Align the elements of a statement row based on computed bounds.\n   * Unlike other types of rows, statement rows add space in multiple places.\n   *\n   * @param row The statement row to resize.\n   */\n  protected alignStatementRow_(row: InputRow) {\n    const statementInput = row.getLastInput();\n    if (!statementInput) return;\n    let currentWidth = row.width - statementInput.width;\n    let desiredWidth = this.statementEdge;\n    // Add padding before the statement input.\n    const missingSpace = desiredWidth - currentWidth;\n    if (missingSpace > 0) {\n      this.addAlignmentPadding_(row, missingSpace);\n    }\n    // Also widen the statement input to reach to the right side of the\n    // block. Note that this does not add padding.\n    currentWidth = row.width;\n    desiredWidth = this.getDesiredRowWidth_(row);\n    statementInput.width += desiredWidth - currentWidth;\n    statementInput.height = Math.max(statementInput.height, row.height);\n    row.width += desiredWidth - currentWidth;\n    row.widthWithConnectedBlocks =\n        Math.max(row.width, this.statementEdge + row.connectedBlockWidths);\n  }\n\n  /** Add spacers between rows and set their sizes. */\n  protected addRowSpacing_() {\n    const oldRows = this.rows;\n    this.rows = [];\n\n    for (let r = 0; r < oldRows.length; r++) {\n      this.rows.push(oldRows[r]);\n      if (r !== oldRows.length - 1) {\n        this.rows.push(this.makeSpacerRow_(oldRows[r], oldRows[r + 1]));\n      }\n    }\n  }\n\n  /**\n   * Create a spacer row to go between prev and next, and set its size.\n   *\n   * @param prev The previous row.\n   * @param next The next row.\n   * @returns The newly created spacer row.\n   */\n  protected makeSpacerRow_(prev: Row, next: Row): SpacerRow {\n    const height = this.getSpacerRowHeight_(prev, next);\n    const width = this.getSpacerRowWidth_(prev, next);\n    const spacer = new SpacerRow(this.constants_, height, width);\n    if (prev.hasStatement) {\n      spacer.followsStatement = true;\n    }\n    if (next.hasStatement) {\n      spacer.precedesStatement = true;\n    }\n    return spacer;\n  }\n\n  /**\n   * Calculate the width of a spacer row.\n   *\n   * @param _prev The row before the spacer.\n   * @param _next The row after the spacer.\n   * @returns The desired width of the spacer row between these two rows.\n   */\n  protected getSpacerRowWidth_(_prev: Row, _next: Row): number {\n    return this.width - this.startX;\n  }\n\n  /**\n   * Calculate the height of a spacer row.\n   *\n   * @param _prev The row before the spacer.\n   * @param _next The row after the spacer.\n   * @returns The desired height of the spacer row between these two rows.\n   */\n  protected getSpacerRowHeight_(_prev: Row, _next: Row): number {\n    return this.constants_.MEDIUM_PADDING;\n  }\n\n  /**\n   * Calculate the centerline of an element in a rendered row.\n   * This base implementation puts the centerline at the middle of the row\n   * vertically, with no special cases.  You will likely need extra logic to\n   * handle (at minimum) top and bottom rows.\n   *\n   * @param row The row containing the element.\n   * @param elem The element to place.\n   * @returns The desired centerline of the given element, as an offset from the\n   *     top left of the block.\n   */\n  protected getElemCenterline_(row: Row, elem: Measurable): number {\n    if (Types.isSpacer(elem)) {\n      return row.yPos + elem.height / 2;\n    }\n    if (Types.isBottomRow(row)) {\n      const bottomRow = row as BottomRow;\n      const baseline =\n          bottomRow.yPos + bottomRow.height - bottomRow.descenderHeight;\n      if (Types.isNextConnection(elem)) {\n        return baseline + elem.height / 2;\n      }\n      return baseline - elem.height / 2;\n    }\n    if (Types.isTopRow(row)) {\n      const topRow = row as TopRow;\n      if (Types.isHat(elem)) {\n        return topRow.capline - elem.height / 2;\n      }\n      return topRow.capline + elem.height / 2;\n    }\n    return row.yPos + row.height / 2;\n  }\n\n  /**\n   * Record final position information on elements on the given row, for use in\n   * drawing.  At minimum this records xPos and centerline on each element.\n   *\n   * @param row The row containing the elements.\n   */\n  protected recordElemPositions_(row: Row) {\n    let xCursor = row.xPos;\n    for (let j = 0, elem; elem = row.elements[j]; j++) {\n      // Now that row heights are finalized, make spacers use the row height.\n      if (Types.isSpacer(elem)) {\n        elem.height = row.height;\n      }\n      elem.xPos = xCursor;\n      elem.centerline = this.getElemCenterline_(row, elem);\n      xCursor += elem.width;\n    }\n  }\n\n  /**\n   * Make any final changes to the rendering information object.  In particular,\n   * store the y position of each row, and record the height of the full block.\n   */\n  protected finalize_() {\n    // Performance note: this could be combined with the draw pass, if the time\n    // that this takes is excessive.  But it shouldn't be, because it only\n    // accesses and sets properties that already exist on the objects.\n    let widestRowWithConnectedBlocks = 0;\n    let yCursor = 0;\n    for (let i = 0, row; row = this.rows[i]; i++) {\n      row.yPos = yCursor;\n      row.xPos = this.startX;\n      yCursor += row.height;\n\n      widestRowWithConnectedBlocks =\n          Math.max(widestRowWithConnectedBlocks, row.widthWithConnectedBlocks);\n      this.recordElemPositions_(row);\n    }\n    if (this.outputConnection && this.block_.nextConnection) {\n      const target = this.block_.nextConnection.targetBlock();\n      if (target) {\n        // Include width of connected block in value to stack width measurement.\n        widestRowWithConnectedBlocks = Math.max(\n            widestRowWithConnectedBlocks, target.getHeightWidth().width);\n      }\n    }\n\n    this.widthWithChildren = widestRowWithConnectedBlocks + this.startX;\n\n    this.height = yCursor;\n    this.startY = this.topRow.capline;\n    this.bottomRow.baseline = yCursor - this.bottomRow.descenderHeight;\n  }\n}\n","/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Events fired as a result of a marker move.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events.MarkerMove');\n\nimport type {Block} from '../block.js';\nimport {ASTNode} from '../keyboard_nav/ast_node.js';\nimport * as deprecation from '../utils/deprecation.js';\nimport * as registry from '../registry.js';\nimport type {Workspace} from '../workspace.js';\nimport {AbstractEventJson} from './events_abstract.js';\n\nimport {UiBase} from './events_ui_base.js';\nimport * as eventUtils from './utils.js';\n\n\n/**\n * Class for a marker move event.\n *\n * @alias Blockly.Events.MarkerMove\n */\nexport class MarkerMove extends UiBase {\n  blockId?: string;\n  oldNode?: ASTNode;\n  newNode?: ASTNode;\n  isCursor?: boolean;\n  override type = eventUtils.MARKER_MOVE;\n\n  /**\n   * @param opt_block The affected block. Null if current node is of type\n   *     workspace. Undefined for a blank event.\n   * @param isCursor Whether this is a cursor event. Undefined for a blank\n   *     event.\n   * @param opt_oldNode The old node the marker used to be on.\n   *    Undefined for a blank event.\n   * @param opt_newNode The new node the marker is now on.\n   *    Undefined for a blank event.\n   */\n  constructor(\n      opt_block?: Block|null, isCursor?: boolean, opt_oldNode?: ASTNode|null,\n      opt_newNode?: ASTNode) {\n    let workspaceId = opt_block ? opt_block.workspace.id : undefined;\n    if (opt_newNode && opt_newNode.getType() === ASTNode.types.WORKSPACE) {\n      workspaceId = (opt_newNode.getLocation() as Workspace).id;\n    }\n    super(workspaceId);\n\n    /** The block identifier for this event. */\n    this.blockId = opt_block?.id;\n\n    /** The old node the marker used to be on. */\n    this.oldNode = opt_oldNode || undefined;\n\n    /** The new node the  marker is now on. */\n    this.newNode = opt_newNode;\n\n    /** Whether this is a cursor event. */\n    this.isCursor = isCursor;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): MarkerMoveJson {\n    const json = super.toJson() as MarkerMoveJson;\n    if (this.isCursor === undefined) {\n      throw new Error(\n          'Whether this is a cursor event or not is undefined. Either pass ' +\n          'a value to the constructor, or call fromJson');\n    }\n    if (!this.newNode) {\n      throw new Error(\n          'The new node is undefined. Either pass a node to ' +\n          'the constructor, or call fromJson');\n    }\n    json['isCursor'] = this.isCursor;\n    json['blockId'] = this.blockId;\n    json['oldNode'] = this.oldNode;\n    json['newNode'] = this.newNode;\n    return json;\n  }\n\n  /**\n   * Decode the JSON event.\n   *\n   * @param json JSON representation.\n   */\n  override fromJson(json: MarkerMoveJson) {\n    deprecation.warn(\n        'Blockly.Events.MarkerMove.prototype.fromJson', 'version 9',\n        'version 10', 'Blockly.Events.fromJson');\n    super.fromJson(json);\n    this.isCursor = json['isCursor'];\n    this.blockId = json['blockId'];\n    this.oldNode = json['oldNode'];\n    this.newNode = json['newNode'];\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of MarkerMove, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(json: MarkerMoveJson, workspace: Workspace, event?: any):\n      MarkerMove {\n    const newEvent =\n        super.fromJson(json, workspace, event ?? new MarkerMove()) as\n        MarkerMove;\n    newEvent.isCursor = json['isCursor'];\n    newEvent.blockId = json['blockId'];\n    newEvent.oldNode = json['oldNode'];\n    newEvent.newNode = json['newNode'];\n    return newEvent;\n  }\n}\n\nexport interface MarkerMoveJson extends AbstractEventJson {\n  isCursor: boolean;\n  blockId?: string;\n  oldNode?: ASTNode;\n  newNode: ASTNode;\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.MARKER_MOVE, MarkerMove);\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Methods for graphically rendering a marker as SVG.\n *\n * @class\n */\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.MarkerSvg');\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport '../../events/events_marker_move.js';\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport type {Connection} from '../../connection.js';\nimport {ConnectionType} from '../../connection_type.js';\nimport * as eventUtils from '../../events/utils.js';\nimport type {Field} from '../../field.js';\nimport type {IASTNodeLocationSvg} from '../../interfaces/i_ast_node_location_svg.js';\nimport {ASTNode} from '../../keyboard_nav/ast_node.js';\nimport type {Marker} from '../../keyboard_nav/marker.js';\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport * as dom from '../../utils/dom.js';\nimport {Svg} from '../../utils/svg.js';\nimport * as svgPaths from '../../utils/svg_paths.js';\nimport type {WorkspaceSvg} from '../../workspace_svg.js';\n\nimport type {ConstantProvider, Notch, PuzzleTab} from './constants.js';\n\n\n/** The name of the CSS class for a cursor. */\nconst CURSOR_CLASS = 'blocklyCursor';\n\n/** The name of the CSS class for a marker. */\nconst MARKER_CLASS = 'blocklyMarker';\n\n/**\n * What we multiply the height by to get the height of the marker.\n * Only used for the block and block connections.\n */\nconst HEIGHT_MULTIPLIER = 3 / 4;\n\n/**\n * Class for a marker.\n *\n * @alias Blockly.blockRendering.MarkerSvg\n */\nexport class MarkerSvg {\n  /**\n   * The workspace, field, or block that the marker SVG element should be\n   * attached to.\n   */\n  private parent_: IASTNodeLocationSvg|null = null;\n\n  /** The current SVG element for the marker. */\n  currentMarkerSvg: SVGElement|null = null;\n  colour_: string;\n\n  /** The root SVG group containing the marker. */\n  protected markerSvg_: SVGGElement|null = null;\n  protected svgGroup_: SVGGElement|null = null;\n\n  protected markerBlock_: SVGPathElement|null = null;\n\n  protected markerInput_: SVGPathElement|null = null;\n  protected markerSvgLine_: SVGRectElement|null = null;\n\n  protected markerSvgRect_: SVGRectElement|null = null;\n\n  /** The constants necessary to draw the marker. */\n  protected constants_: ConstantProvider;\n\n  /**\n   * @param workspace The workspace the marker belongs to.\n   * @param constants The constants for the renderer.\n   * @param marker The marker to draw.\n   */\n  constructor(\n      private readonly workspace: WorkspaceSvg, constants: ConstantProvider,\n      private readonly marker: Marker) {\n    this.constants_ = constants;\n\n    const defaultColour = this.isCursor() ? this.constants_.CURSOR_COLOUR :\n                                            this.constants_.MARKER_COLOUR;\n\n    /** The colour of the marker. */\n    this.colour_ = marker.colour || defaultColour;\n  }\n\n  /**\n   * Return the root node of the SVG or null if none exists.\n   *\n   * @returns The root SVG node.\n   */\n  getSvgRoot(): SVGElement|null {\n    return this.svgGroup_;\n  }\n\n  /**\n   * Get the marker.\n   *\n   * @returns The marker to draw for.\n   */\n  getMarker(): Marker {\n    return this.marker;\n  }\n\n  /**\n   * True if the marker should be drawn as a cursor, false otherwise.\n   * A cursor is drawn as a flashing line. A marker is drawn as a solid line.\n   *\n   * @returns True if the marker is a cursor, false otherwise.\n   */\n  isCursor(): boolean {\n    return this.marker.type === 'cursor';\n  }\n\n  /**\n   * Create the DOM element for the marker.\n   *\n   * @returns The marker controls SVG group.\n   * @internal\n   */\n  createDom(): SVGElement {\n    const className = this.isCursor() ? CURSOR_CLASS : MARKER_CLASS;\n\n    this.svgGroup_ = dom.createSvgElement(Svg.G, {'class': className});\n\n    this.createDomInternal_();\n    return this.svgGroup_;\n  }\n\n  /**\n   * Attaches the SVG root of the marker to the SVG group of the parent.\n   *\n   * @param newParent The workspace, field, or block that the marker SVG element\n   *     should be attached to.\n   */\n  protected setParent_(newParent: IASTNodeLocationSvg) {\n    if (!this.isCursor()) {\n      if (this.parent_) {\n        this.parent_.setMarkerSvg(null);\n      }\n      newParent.setMarkerSvg(this.getSvgRoot());\n    } else {\n      if (this.parent_) {\n        this.parent_.setCursorSvg(null);\n      }\n      newParent.setCursorSvg(this.getSvgRoot());\n    }\n    this.parent_ = newParent;\n  }\n\n  /**\n   * Update the marker.\n   *\n   * @param oldNode The previous node the marker was on or null.\n   * @param curNode The node that we want to draw the marker for.\n   */\n  draw(oldNode: ASTNode, curNode: ASTNode) {\n    if (!curNode) {\n      this.hide();\n      return;\n    }\n\n    this.constants_ = this.workspace.getRenderer().getConstants();\n\n    const defaultColour = this.isCursor() ? this.constants_.CURSOR_COLOUR :\n                                            this.constants_.MARKER_COLOUR;\n    this.colour_ = this.marker.colour || defaultColour;\n    this.applyColour_(curNode);\n\n    this.showAtLocation_(curNode);\n\n    this.fireMarkerEvent_(oldNode, curNode);\n\n    // Ensures the marker will be visible immediately after the move.\n    const animate = this.currentMarkerSvg!.childNodes[0];\n    if (animate !== undefined) {\n      (animate as SVGAnimationElement).beginElement &&\n          (animate as SVGAnimationElement).beginElement();\n    }\n  }\n\n  /**\n   * Update the marker's visible state based on the type of curNode..\n   *\n   * @param curNode The node that we want to draw the marker for.\n   */\n  protected showAtLocation_(curNode: ASTNode) {\n    const curNodeAsConnection = curNode.getLocation() as Connection;\n    const connectionType = curNodeAsConnection.type;\n    if (curNode.getType() === ASTNode.types.BLOCK) {\n      this.showWithBlock_(curNode);\n    } else if (curNode.getType() === ASTNode.types.OUTPUT) {\n      this.showWithOutput_(curNode);\n    } else if (connectionType === ConnectionType.INPUT_VALUE) {\n      this.showWithInput_(curNode);\n    } else if (connectionType === ConnectionType.NEXT_STATEMENT) {\n      this.showWithNext_(curNode);\n    } else if (curNode.getType() === ASTNode.types.PREVIOUS) {\n      this.showWithPrevious_(curNode);\n    } else if (curNode.getType() === ASTNode.types.FIELD) {\n      this.showWithField_(curNode);\n    } else if (curNode.getType() === ASTNode.types.WORKSPACE) {\n      this.showWithCoordinates_(curNode);\n    } else if (curNode.getType() === ASTNode.types.STACK) {\n      this.showWithStack_(curNode);\n    }\n  }\n\n  /**************************\n   * Display\n   **************************/\n\n  /**\n   * Show the marker as a combination of the previous connection and block,\n   * the output connection and block, or just the block.\n   *\n   * @param curNode The node to draw the marker for.\n   */\n  private showWithBlockPrevOutput_(curNode: ASTNode) {\n    const block = curNode.getSourceBlock() as BlockSvg;\n    const width = block.width;\n    const height = block.height;\n    const markerHeight = height * HEIGHT_MULTIPLIER;\n    const markerOffset = this.constants_.CURSOR_BLOCK_PADDING;\n\n    if (block.previousConnection) {\n      const connectionShape =\n          this.constants_.shapeFor(block.previousConnection) as Notch;\n      this.positionPrevious_(\n          width, markerOffset, markerHeight, connectionShape);\n    } else if (block.outputConnection) {\n      const connectionShape =\n          this.constants_.shapeFor(block.outputConnection) as PuzzleTab;\n      this.positionOutput_(width, height, connectionShape);\n    } else {\n      this.positionBlock_(width, markerOffset, markerHeight);\n    }\n    this.setParent_(block);\n    this.showCurrent_();\n  }\n\n  /**\n   * Position and display the marker for a block.\n   *\n   * @param curNode The node to draw the marker for.\n   */\n  protected showWithBlock_(curNode: ASTNode) {\n    this.showWithBlockPrevOutput_(curNode);\n  }\n\n  /**\n   * Position and display the marker for a previous connection.\n   *\n   * @param curNode The node to draw the marker for.\n   */\n  protected showWithPrevious_(curNode: ASTNode) {\n    this.showWithBlockPrevOutput_(curNode);\n  }\n\n  /**\n   * Position and display the marker for an output connection.\n   *\n   * @param curNode The node to draw the marker for.\n   */\n  protected showWithOutput_(curNode: ASTNode) {\n    this.showWithBlockPrevOutput_(curNode);\n  }\n\n  /**\n   * Position and display the marker for a workspace coordinate.\n   * This is a horizontal line.\n   *\n   * @param curNode The node to draw the marker for.\n   */\n  protected showWithCoordinates_(curNode: ASTNode) {\n    const wsCoordinate = curNode.getWsCoordinate();\n    let x = wsCoordinate.x;\n    const y = wsCoordinate.y;\n\n    if (this.workspace.RTL) {\n      x -= this.constants_.CURSOR_WS_WIDTH;\n    }\n\n    this.positionLine_(x, y, this.constants_.CURSOR_WS_WIDTH);\n    this.setParent_(this.workspace);\n    this.showCurrent_();\n  }\n\n  /**\n   * Position and display the marker for a field.\n   * This is a box around the field.\n   *\n   * @param curNode The node to draw the marker for.\n   */\n  protected showWithField_(curNode: ASTNode) {\n    const field = curNode.getLocation() as Field;\n    const width = field.getSize().width;\n    const height = field.getSize().height;\n\n    this.positionRect_(0, 0, width, height);\n    this.setParent_(field);\n    this.showCurrent_();\n  }\n\n  /**\n   * Position and display the marker for an input.\n   * This is a puzzle piece.\n   *\n   * @param curNode The node to draw the marker for.\n   */\n  protected showWithInput_(curNode: ASTNode) {\n    const connection = curNode.getLocation() as RenderedConnection;\n    const sourceBlock = (connection.getSourceBlock());\n\n    this.positionInput_(connection);\n    this.setParent_(sourceBlock);\n    this.showCurrent_();\n  }\n\n  /**\n   * Position and display the marker for a next connection.\n   * This is a horizontal line.\n   *\n   * @param curNode The node to draw the marker for.\n   */\n  protected showWithNext_(curNode: ASTNode) {\n    const connection = curNode.getLocation() as RenderedConnection;\n    const targetBlock = (connection.getSourceBlock());\n    let x = 0;\n    const y = connection.getOffsetInBlock().y;\n    const width = targetBlock.getHeightWidth().width;\n    if (this.workspace.RTL) {\n      x = -width;\n    }\n    this.positionLine_(x, y, width);\n    this.setParent_(targetBlock);\n    this.showCurrent_();\n  }\n\n  /**\n   * Position and display the marker for a stack.\n   * This is a box with extra padding around the entire stack of blocks.\n   *\n   * @param curNode The node to draw the marker for.\n   */\n  protected showWithStack_(curNode: ASTNode) {\n    const block = curNode.getLocation() as BlockSvg;\n\n    // Gets the height and width of entire stack.\n    const heightWidth = block.getHeightWidth();\n\n    // Add padding so that being on a stack looks different than being on a\n    // block.\n    const width = heightWidth.width + this.constants_.CURSOR_STACK_PADDING;\n    const height = heightWidth.height + this.constants_.CURSOR_STACK_PADDING;\n\n    // Shift the rectangle slightly to upper left so padding is equal on all\n    // sides.\n    const xPadding = -this.constants_.CURSOR_STACK_PADDING / 2;\n    const yPadding = -this.constants_.CURSOR_STACK_PADDING / 2;\n\n    let x = xPadding;\n    const y = yPadding;\n\n    if (this.workspace.RTL) {\n      x = -(width + xPadding);\n    }\n    this.positionRect_(x, y, width, height);\n    this.setParent_(block);\n    this.showCurrent_();\n  }\n\n  /** Show the current marker. */\n  protected showCurrent_() {\n    this.hide();\n    if (this.currentMarkerSvg) {\n      this.currentMarkerSvg.style.display = '';\n    }\n  }\n\n  /**************************\n   * Position\n   **************************/\n\n  /**\n   * Position the marker for a block.\n   * Displays an outline of the top half of a rectangle around a block.\n   *\n   * @param width The width of the block.\n   * @param markerOffset The extra padding for around the block.\n   * @param markerHeight The height of the marker.\n   */\n  protected positionBlock_(\n      width: number, markerOffset: number, markerHeight: number) {\n    const markerPath = svgPaths.moveBy(-markerOffset, markerHeight) +\n        svgPaths.lineOnAxis('V', -markerOffset) +\n        svgPaths.lineOnAxis('H', width + markerOffset * 2) +\n        svgPaths.lineOnAxis('V', markerHeight);\n    if (!this.markerBlock_) {\n      throw new Error(\n          'createDom should be called before positioning the marker');\n    }\n    this.markerBlock_.setAttribute('d', markerPath);\n    if (this.workspace.RTL) {\n      this.flipRtl_(this.markerBlock_);\n    }\n    this.currentMarkerSvg = this.markerBlock_;\n  }\n\n  /**\n   * Position the marker for an input connection.\n   * Displays a filled in puzzle piece.\n   *\n   * @param connection The connection to position marker around.\n   */\n  protected positionInput_(connection: RenderedConnection) {\n    const x = connection.getOffsetInBlock().x;\n    const y = connection.getOffsetInBlock().y;\n\n    const path = svgPaths.moveTo(0, 0) +\n        (this.constants_.shapeFor(connection) as PuzzleTab).pathDown;\n\n    this.markerInput_!.setAttribute('d', path);\n    this.markerInput_!.setAttribute(\n        'transform',\n        'translate(' + x + ',' + y + ')' +\n            (this.workspace.RTL ? ' scale(-1 1)' : ''));\n    this.currentMarkerSvg = this.markerInput_;\n  }\n\n  /**\n   * Move and show the marker at the specified coordinate in workspace units.\n   * Displays a horizontal line.\n   *\n   * @param x The new x, in workspace units.\n   * @param y The new y, in workspace units.\n   * @param width The new width, in workspace units.\n   */\n  protected positionLine_(x: number, y: number, width: number) {\n    if (!this.markerSvgLine_) {\n      throw new Error('createDom should be called before positioning the line');\n    }\n    this.markerSvgLine_.setAttribute('x', `${x}`);\n    this.markerSvgLine_.setAttribute('y', `${y}`);\n    this.markerSvgLine_.setAttribute('width', `${width}`);\n    this.currentMarkerSvg = this.markerSvgLine_;\n  }\n\n  /**\n   * Position the marker for an output connection.\n   * Displays a puzzle outline and the top and bottom path.\n   *\n   * @param width The width of the block.\n   * @param height The height of the block.\n   * @param connectionShape The shape object for the connection.\n   */\n  protected positionOutput_(\n      width: number, height: number, connectionShape: PuzzleTab) {\n    if (!this.markerBlock_) {\n      throw new Error(\n          'createDom should be called before positioning the output');\n    }\n    const markerPath = svgPaths.moveBy(width, 0) +\n        svgPaths.lineOnAxis('h', -(width - connectionShape.width)) +\n        svgPaths.lineOnAxis('v', this.constants_.TAB_OFFSET_FROM_TOP) +\n        connectionShape.pathDown + svgPaths.lineOnAxis('V', height) +\n        svgPaths.lineOnAxis('H', width);\n    this.markerBlock_.setAttribute('d', markerPath);\n    if (this.workspace.RTL) {\n      this.flipRtl_(this.markerBlock_);\n    }\n    this.currentMarkerSvg = this.markerBlock_;\n  }\n\n  /**\n   * Position the marker for a previous connection.\n   * Displays a half rectangle with a notch in the top to represent the previous\n   * connection.\n   *\n   * @param width The width of the block.\n   * @param markerOffset The offset of the marker from around the block.\n   * @param markerHeight The height of the marker.\n   * @param connectionShape The shape object for the connection.\n   */\n  protected positionPrevious_(\n      width: number, markerOffset: number, markerHeight: number,\n      connectionShape: Notch) {\n    if (!this.markerBlock_) {\n      throw new Error(\n          'createDom should be called before positioning the previous connection marker');\n    }\n    const markerPath = svgPaths.moveBy(-markerOffset, markerHeight) +\n        svgPaths.lineOnAxis('V', -markerOffset) +\n        svgPaths.lineOnAxis('H', this.constants_.NOTCH_OFFSET_LEFT) +\n        connectionShape.pathLeft +\n        svgPaths.lineOnAxis('H', width + markerOffset * 2) +\n        svgPaths.lineOnAxis('V', markerHeight);\n    this.markerBlock_.setAttribute('d', markerPath);\n    if (this.workspace.RTL) {\n      this.flipRtl_(this.markerBlock_);\n    }\n    this.currentMarkerSvg = this.markerBlock_;\n  }\n\n  /**\n   * Move and show the marker at the specified coordinate in workspace units.\n   * Displays a filled in rectangle.\n   *\n   * @param x The new x, in workspace units.\n   * @param y The new y, in workspace units.\n   * @param width The new width, in workspace units.\n   * @param height The new height, in workspace units.\n   */\n  protected positionRect_(x: number, y: number, width: number, height: number) {\n    if (!this.markerSvgRect_) {\n      throw new Error('createDom should be called before positioning the rect');\n    }\n    this.markerSvgRect_.setAttribute('x', `${x}`);\n    this.markerSvgRect_.setAttribute('y', `${y}`);\n    this.markerSvgRect_.setAttribute('width', `${width}`);\n    this.markerSvgRect_.setAttribute('height', `${height}`);\n    this.currentMarkerSvg = this.markerSvgRect_;\n  }\n\n  /**\n   * Flip the SVG paths in RTL.\n   *\n   * @param markerSvg The marker that we want to flip.\n   */\n  private flipRtl_(markerSvg: SVGElement) {\n    markerSvg.setAttribute('transform', 'scale(-1 1)');\n  }\n\n  /** Hide the marker. */\n  hide() {\n    if (!this.markerSvgLine_ || !this.markerSvgRect_ || !this.markerInput_ ||\n        !this.markerBlock_) {\n      throw new Error('createDom should be called before hiding the marker');\n    }\n    this.markerSvgLine_.style.display = 'none';\n    this.markerSvgRect_.style.display = 'none';\n    this.markerInput_.style.display = 'none';\n    this.markerBlock_.style.display = 'none';\n  }\n\n  /**\n   * Fire event for the marker or marker.\n   *\n   * @param oldNode The old node the marker used to be on.\n   * @param curNode The new node the marker is currently on.\n   */\n  private fireMarkerEvent_(oldNode: ASTNode, curNode: ASTNode) {\n    const curBlock = curNode.getSourceBlock();\n    const event = new (eventUtils.get(eventUtils.MARKER_MOVE))(\n        curBlock, this.isCursor(), oldNode, curNode);\n    eventUtils.fire(event);\n  }\n\n  /**\n   * Get the properties to make a marker blink.\n   *\n   * @returns The object holding attributes to make the marker blink.\n   */\n  protected getBlinkProperties_(): {[key: string]: string} {\n    return {\n      'attributeType': 'XML',\n      'attributeName': 'fill',\n      'dur': '1s',\n      'values': this.colour_ + ';transparent;transparent;',\n      'repeatCount': 'indefinite',\n    };\n  }\n\n  /**\n   * Create the marker SVG.\n   *\n   * @returns The SVG node created.\n   */\n  protected createDomInternal_(): Element {\n    /* This markup will be generated and added to the .svgGroup_:\n        <g>\n          <rect width=\"100\" height=\"5\">\n            <animate attributeType=\"XML\" attributeName=\"fill\" dur=\"1s\"\n              values=\"transparent;transparent;#fff;transparent\"\n        repeatCount=\"indefinite\" />\n          </rect>\n        </g>\n        */\n\n    this.markerSvg_ = dom.createSvgElement(\n        Svg.G, {\n          'width': this.constants_.CURSOR_WS_WIDTH,\n          'height': this.constants_.WS_CURSOR_HEIGHT,\n        },\n        this.svgGroup_);\n\n    // A horizontal line used to represent a workspace coordinate or next\n    // connection.\n    this.markerSvgLine_ = dom.createSvgElement(\n        Svg.RECT, {\n          'width': this.constants_.CURSOR_WS_WIDTH,\n          'height': this.constants_.WS_CURSOR_HEIGHT,\n          'style': 'display: none',\n        },\n        this.markerSvg_);\n\n    // A filled in rectangle used to represent a stack.\n    this.markerSvgRect_ = dom.createSvgElement(\n        Svg.RECT, {\n          'class': 'blocklyVerticalMarker',\n          'rx': 10,\n          'ry': 10,\n          'style': 'display: none',\n        },\n        this.markerSvg_);\n\n    // A filled in puzzle piece used to represent an input value.\n    this.markerInput_ = dom.createSvgElement(\n        Svg.PATH, {'transform': '', 'style': 'display: none'}, this.markerSvg_);\n\n    // A path used to represent a previous connection and a block, an output\n    // connection and a block, or a block.\n    this.markerBlock_ = dom.createSvgElement(\n        Svg.PATH, {\n          'transform': '',\n          'style': 'display: none',\n          'fill': 'none',\n          'stroke-width': this.constants_.CURSOR_STROKE_WIDTH,\n        },\n        this.markerSvg_);\n\n    // Markers and stack markers don't blink.\n    if (this.isCursor()) {\n      const blinkProperties = this.getBlinkProperties_();\n      dom.createSvgElement(Svg.ANIMATE, blinkProperties, this.markerSvgLine_);\n      dom.createSvgElement(Svg.ANIMATE, blinkProperties, this.markerInput_);\n      dom.createSvgElement(\n          Svg.ANIMATE, {...blinkProperties, attributeName: 'stroke'},\n          this.markerBlock_);\n    }\n\n    return this.markerSvg_;\n  }\n\n  /**\n   * Apply the marker's colour.\n   *\n   * @param _curNode The node that we want to draw the marker for.\n   */\n  protected applyColour_(_curNode: ASTNode) {\n    if (!this.markerSvgLine_ || !this.markerSvgRect_ || !this.markerInput_ ||\n        !this.markerBlock_) {\n      throw new Error(\n          'createDom should be called before applying color to the markerj');\n    }\n    this.markerSvgLine_.setAttribute('fill', this.colour_);\n    this.markerSvgRect_.setAttribute('stroke', this.colour_);\n    this.markerInput_.setAttribute('fill', this.colour_);\n    this.markerBlock_.setAttribute('stroke', this.colour_);\n\n    if (this.isCursor()) {\n      const values = this.colour_ + ';transparent;transparent;';\n      this.markerSvgLine_.firstElementChild!.setAttribute('values', values);\n      this.markerInput_.firstElementChild!.setAttribute('values', values);\n      this.markerBlock_.firstElementChild!.setAttribute('values', values);\n    }\n  }\n\n  /** Dispose of this marker. */\n  dispose() {\n    if (this.svgGroup_) {\n      dom.removeNode(this.svgGroup_);\n    }\n  }\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * An object that owns a block's rendering SVG elements.\n *\n * @class\n */\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.PathObject');\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport type {Connection} from '../../connection.js';\nimport type {BlockStyle} from '../../theme.js';\nimport * as dom from '../../utils/dom.js';\nimport {Svg} from '../../utils/svg.js';\n\nimport type {ConstantProvider} from './constants.js';\nimport type {IPathObject} from './i_path_object.js';\n\n\n/**\n * An object that handles creating and setting each of the SVG elements\n * used by the renderer.\n *\n * @alias Blockly.blockRendering.PathObject\n */\nexport class PathObject implements IPathObject {\n  svgRoot: SVGElement;\n  /** @internal */\n  svgPath: SVGElement;\n\n  /**\n   * Holds the cursors svg element when the cursor is attached to the block.\n   * This is null if there is no cursor on the block.\n   *\n   * @internal\n   */\n  cursorSvg: SVGElement|null = null;\n\n  /**\n   * Holds the markers svg element when the marker is attached to the block.\n   * This is null if there is no marker on the block.\n   *\n   * @internal\n   */\n  markerSvg: SVGElement|null = null;\n\n  /** @internal */\n  constants: ConstantProvider;\n  /** @internal */\n  style: BlockStyle;\n\n  /**\n   * @param root The root SVG element.\n   * @param style The style object to use for colouring.\n   * @param constants The renderer's constants.\n   * @internal\n   */\n  constructor(\n      root: SVGElement, style: BlockStyle, constants: ConstantProvider) {\n    this.constants = constants;\n    this.style = style;\n    this.svgRoot = root;\n\n    /** The primary path of the block. */\n    this.svgPath =\n        dom.createSvgElement(Svg.PATH, {'class': 'blocklyPath'}, this.svgRoot);\n  }\n\n  /**\n   * Set the path generated by the renderer onto the respective SVG element.\n   *\n   * @param pathString The path.\n   * @internal\n   */\n  setPath(pathString: string) {\n    this.svgPath.setAttribute('d', pathString);\n  }\n\n  /**\n   * Flip the SVG paths in RTL.\n   *\n   * @internal\n   */\n  flipRTL() {\n    // Mirror the block's path.\n    this.svgPath.setAttribute('transform', 'scale(-1 1)');\n  }\n\n  /**\n   * Add the cursor SVG to this block's SVG group.\n   *\n   * @param cursorSvg The SVG root of the cursor to be added to the block SVG\n   *     group.\n   * @internal\n   */\n  setCursorSvg(cursorSvg: SVGElement) {\n    if (!cursorSvg) {\n      this.cursorSvg = null;\n      return;\n    }\n\n    this.svgRoot.appendChild(cursorSvg);\n    this.cursorSvg = cursorSvg;\n  }\n\n  /**\n   * Add the marker SVG to this block's SVG group.\n   *\n   * @param markerSvg The SVG root of the marker to be added to the block SVG\n   *     group.\n   * @internal\n   */\n  setMarkerSvg(markerSvg: SVGElement) {\n    if (!markerSvg) {\n      this.markerSvg = null;\n      return;\n    }\n\n    if (this.cursorSvg) {\n      this.svgRoot.insertBefore(markerSvg, this.cursorSvg);\n    } else {\n      this.svgRoot.appendChild(markerSvg);\n    }\n    this.markerSvg = markerSvg;\n  }\n\n  /**\n   * Apply the stored colours to the block's path, taking into account whether\n   * the paths belong to a shadow block.\n   *\n   * @param block The source block.\n   * @internal\n   */\n  applyColour(block: BlockSvg) {\n    this.svgPath.setAttribute('stroke', this.style.colourTertiary);\n    this.svgPath.setAttribute('fill', this.style.colourPrimary);\n\n    this.updateShadow_(block.isShadow());\n    this.updateDisabled_(!block.isEnabled() || block.getInheritedDisabled());\n  }\n\n  /**\n   * Set the style.\n   *\n   * @param blockStyle The block style to use.\n   * @internal\n   */\n  setStyle(blockStyle: BlockStyle) {\n    this.style = blockStyle;\n  }\n\n  /**\n   * Add or remove the given CSS class on the path object's root SVG element.\n   *\n   * @param className The name of the class to add or remove\n   * @param add True if the class should be added.  False if it should be\n   *     removed.\n   */\n  protected setClass_(className: string, add: boolean) {\n    if (!className) {\n      return;\n    }\n    if (add) {\n      dom.addClass(this.svgRoot, className);\n    } else {\n      dom.removeClass(this.svgRoot, className);\n    }\n  }\n\n  /**\n   * Set whether the block shows a highlight or not.  Block highlighting is\n   * often used to visually mark blocks currently being executed.\n   *\n   * @param enable True if highlighted.\n   * @internal\n   */\n  updateHighlighted(enable: boolean) {\n    if (enable) {\n      this.svgPath.setAttribute(\n          'filter', 'url(#' + this.constants.embossFilterId + ')');\n    } else {\n      this.svgPath.setAttribute('filter', 'none');\n    }\n  }\n\n  /**\n   * Updates the look of the block to reflect a shadow state.\n   *\n   * @param shadow True if the block is a shadow block.\n   */\n  protected updateShadow_(shadow: boolean) {\n    if (shadow) {\n      this.svgPath.setAttribute('stroke', 'none');\n      this.svgPath.setAttribute('fill', this.style.colourSecondary);\n    }\n  }\n\n  /**\n   * Updates the look of the block to reflect a disabled state.\n   *\n   * @param disabled True if disabled.\n   */\n  protected updateDisabled_(disabled: boolean) {\n    this.setClass_('blocklyDisabled', disabled);\n    if (disabled) {\n      this.svgPath.setAttribute(\n          'fill', 'url(#' + this.constants.disabledPatternId + ')');\n    }\n  }\n\n  /**\n   * Add or remove styling showing that a block is selected.\n   *\n   * @param enable True if selection is enabled, false otherwise.\n   * @internal\n   */\n  updateSelected(enable: boolean) {\n    this.setClass_('blocklySelected', enable);\n  }\n\n  /**\n   * Add or remove styling showing that a block is dragged over a delete area.\n   *\n   * @param enable True if the block is being dragged over a delete area, false\n   *     otherwise.\n   * @internal\n   */\n  updateDraggingDelete(enable: boolean) {\n    this.setClass_('blocklyDraggingDelete', enable);\n  }\n\n  /**\n   * Add or remove styling showing that a block is an insertion marker.\n   *\n   * @param enable True if the block is an insertion marker, false otherwise.\n   * @internal\n   */\n  updateInsertionMarker(enable: boolean) {\n    this.setClass_('blocklyInsertionMarker', enable);\n  }\n\n  /**\n   * Add or remove styling showing that a block is movable.\n   *\n   * @param enable True if the block is movable, false otherwise.\n   * @internal\n   */\n  updateMovable(enable: boolean) {\n    this.setClass_('blocklyDraggable', enable);\n  }\n\n  /**\n   * Add or remove styling that shows that if the dragging block is dropped,\n   * this block will be replaced.  If a shadow block, it will disappear.\n   * Otherwise it will bump.\n   *\n   * @param enable True if styling should be added.\n   * @internal\n   */\n  updateReplacementFade(enable: boolean) {\n    this.setClass_('blocklyReplaceable', enable);\n  }\n\n  /**\n   * Add or remove styling that shows that if the dragging block is dropped,\n   * this block will be connected to the input.\n   *\n   * @param _conn The connection on the input to highlight.\n   * @param _enable True if styling should be added.\n   * @internal\n   */\n  updateShapeForInputHighlight(_conn: Connection, _enable: boolean) {\n    // NOOP\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class that controls updates to connections during drags.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.InsertionMarkerManager');\n\nimport * as blockAnimations from './block_animations.js';\nimport type {BlockSvg} from './block_svg.js';\nimport * as common from './common.js';\nimport {ComponentManager} from './component_manager.js';\nimport {config} from './config.js';\nimport {ConnectionType} from './connection_type.js';\nimport * as constants from './constants.js';\nimport * as eventUtils from './events/utils.js';\nimport type {IDeleteArea} from './interfaces/i_delete_area.js';\nimport type {IDragTarget} from './interfaces/i_drag_target.js';\nimport type {RenderedConnection} from './rendered_connection.js';\nimport type {Coordinate} from './utils/coordinate.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/** Represents a nearby valid connection. */\ninterface CandidateConnection {\n  /**\n   * A nearby valid connection that is compatible with local.\n   * This is not on any of the blocks that are being dragged.\n   */\n  closest: RenderedConnection;\n  /**\n   * A connection on the dragging stack that is compatible with closest. This is\n   * on the top block that is being dragged or the last block in the dragging\n   * stack.\n   */\n  local: RenderedConnection;\n  radius: number;\n}\n\n/**\n * An error message to throw if the block created by createMarkerBlock_ is\n * missing any components.\n */\nconst DUPLICATE_BLOCK_ERROR = 'The insertion marker ' +\n    'manager tried to create a marker but the result is missing %1. If ' +\n    'you are using a mutator, make sure your domToMutation method is ' +\n    'properly defined.';\n\n/**\n * Class that controls updates to connections during drags.  It is primarily\n * responsible for finding the closest eligible connection and highlighting or\n * unhighlighting it as needed during a drag.\n *\n * @alias Blockly.InsertionMarkerManager\n */\nexport class InsertionMarkerManager {\n  /**\n   * The top block in the stack being dragged.\n   * Does not change during a drag.\n   */\n  private readonly topBlock: BlockSvg;\n\n  /**\n   * The workspace on which these connections are being dragged.\n   * Does not change during a drag.\n   */\n  private readonly workspace: WorkspaceSvg;\n\n  /**\n   * The last connection on the stack, if it's not the last connection on the\n   * first block.\n   * Set in initAvailableConnections, if at all.\n   */\n  private lastOnStack: RenderedConnection|null = null;\n\n  /**\n   * The insertion marker corresponding to the last block in the stack, if\n   * that's not the same as the first block in the stack.\n   * Set in initAvailableConnections, if at all\n   */\n  private lastMarker: BlockSvg|null = null;\n\n  /**\n   * The insertion marker that shows up between blocks to show where a block\n   * would go if dropped immediately.\n   */\n  private firstMarker: BlockSvg;\n\n  /**\n   * Information about the connection that would be made if the dragging block\n   * were released immediately. Updated on every mouse move.\n   */\n  private activeCandidate: CandidateConnection|null = null;\n\n  /**\n   * Whether the block would be deleted if it were dropped immediately.\n   * Updated on every mouse move.\n   *\n   * @internal\n   */\n  public wouldDeleteBlock = false;\n\n  /**\n   * Connection on the insertion marker block that corresponds to\n   * the active candidate's local connection on the currently dragged block.\n   */\n  private markerConnection: RenderedConnection|null = null;\n\n  /** The block that currently has an input being highlighted, or null. */\n  private highlightedBlock: BlockSvg|null = null;\n\n  /** The block being faded to indicate replacement, or null. */\n  private fadedBlock: BlockSvg|null = null;\n\n  /**\n   * The connections on the dragging blocks that are available to connect to\n   * other blocks.  This includes all open connections on the top block, as\n   * well as the last connection on the block stack.\n   */\n  private availableConnections: RenderedConnection[];\n\n  /** @param block The top block in the stack being dragged. */\n  constructor(block: BlockSvg) {\n    common.setSelected(block);\n    this.topBlock = block;\n\n    this.workspace = block.workspace;\n\n    this.firstMarker = this.createMarkerBlock(this.topBlock);\n\n    this.availableConnections = this.initAvailableConnections();\n  }\n\n  /**\n   * Sever all links from this object.\n   *\n   * @internal\n   */\n  dispose() {\n    this.availableConnections.length = 0;\n\n    eventUtils.disable();\n    try {\n      if (this.firstMarker) {\n        this.firstMarker.dispose();\n      }\n      if (this.lastMarker) {\n        this.lastMarker.dispose();\n      }\n    } finally {\n      eventUtils.enable();\n    }\n  }\n\n  /**\n   * Update the available connections for the top block. These connections can\n   * change if a block is unplugged and the stack is healed.\n   *\n   * @internal\n   */\n  updateAvailableConnections() {\n    this.availableConnections = this.initAvailableConnections();\n  }\n\n  /**\n   * Return whether the block would be connected if dropped immediately, based\n   * on information from the most recent move event.\n   *\n   * @returns True if the block would be connected if dropped immediately.\n   * @internal\n   */\n  wouldConnectBlock(): boolean {\n    return !!this.activeCandidate;\n  }\n\n  /**\n   * Connect to the closest connection and render the results.\n   * This should be called at the end of a drag.\n   *\n   * @internal\n   */\n  applyConnections() {\n    if (!this.activeCandidate) return;\n    // Don't fire events for insertion markers.\n    eventUtils.disable();\n    this.hidePreview();\n    eventUtils.enable();\n    const {local, closest} = this.activeCandidate;\n    // Connect two blocks together.\n    local.connect(closest);\n    if (this.topBlock.rendered) {\n      // Trigger a connection animation.\n      // Determine which connection is inferior (lower in the source stack).\n      const inferiorConnection = local.isSuperior() ? closest : local;\n      blockAnimations.connectionUiEffect(inferiorConnection.getSourceBlock());\n      // Bring the just-edited stack to the front.\n      const rootBlock = this.topBlock.getRootBlock();\n      rootBlock.bringToFront();\n    }\n  }\n\n  /**\n   * Update connections based on the most recent move location.\n   *\n   * @param dxy Position relative to drag start, in workspace units.\n   * @param dragTarget The drag target that the block is currently over.\n   * @internal\n   */\n  update(dxy: Coordinate, dragTarget: IDragTarget|null) {\n    const newCandidate = this.getCandidate(dxy);\n\n    this.wouldDeleteBlock = this.shouldDelete(!!newCandidate, dragTarget);\n\n    const shouldUpdate =\n        this.wouldDeleteBlock || this.shouldUpdatePreviews(newCandidate, dxy);\n\n    if (shouldUpdate) {\n      // Don't fire events for insertion marker creation or movement.\n      eventUtils.disable();\n      this.maybeHidePreview(newCandidate);\n      this.maybeShowPreview(newCandidate);\n      eventUtils.enable();\n    }\n  }\n\n  /**\n   * Create an insertion marker that represents the given block.\n   *\n   * @param sourceBlock The block that the insertion marker will represent.\n   * @returns The insertion marker that represents the given block.\n   */\n  private createMarkerBlock(sourceBlock: BlockSvg): BlockSvg {\n    const imType = sourceBlock.type;\n\n    eventUtils.disable();\n    let result: BlockSvg;\n    try {\n      result = this.workspace.newBlock(imType);\n      result.setInsertionMarker(true);\n      if (sourceBlock.saveExtraState) {\n        const state = sourceBlock.saveExtraState();\n        if (state && result.loadExtraState) {\n          result.loadExtraState(state);\n        }\n      } else if (sourceBlock.mutationToDom) {\n        const oldMutationDom = sourceBlock.mutationToDom();\n        if (oldMutationDom && result.domToMutation) {\n          result.domToMutation(oldMutationDom);\n        }\n      }\n      // Copy field values from the other block.  These values may impact the\n      // rendered size of the insertion marker.  Note that we do not care about\n      // child blocks here.\n      for (let i = 0; i < sourceBlock.inputList.length; i++) {\n        const sourceInput = sourceBlock.inputList[i];\n        if (sourceInput.name === constants.COLLAPSED_INPUT_NAME) {\n          continue;  // Ignore the collapsed input.\n        }\n        const resultInput = result.inputList[i];\n        if (!resultInput) {\n          throw new Error(DUPLICATE_BLOCK_ERROR.replace('%1', 'an input'));\n        }\n        for (let j = 0; j < sourceInput.fieldRow.length; j++) {\n          const sourceField = sourceInput.fieldRow[j];\n          const resultField = resultInput.fieldRow[j];\n          if (!resultField) {\n            throw new Error(DUPLICATE_BLOCK_ERROR.replace('%1', 'a field'));\n          }\n          resultField.setValue(sourceField.getValue());\n        }\n      }\n\n      result.setCollapsed(sourceBlock.isCollapsed());\n      result.setInputsInline(sourceBlock.getInputsInline());\n\n      result.initSvg();\n      result.getSvgRoot().setAttribute('visibility', 'hidden');\n    } finally {\n      eventUtils.enable();\n    }\n\n    return result;\n  }\n\n  /**\n   * Populate the list of available connections on this block stack.  This\n   * should only be called once, at the beginning of a drag. If the stack has\n   * more than one block, this function will populate lastOnStack and create\n   * the corresponding insertion marker.\n   *\n   * @returns A list of available connections.\n   */\n  private initAvailableConnections(): RenderedConnection[] {\n    const available = this.topBlock.getConnections_(false);\n    // Also check the last connection on this stack\n    const lastOnStack = this.topBlock.lastConnectionInStack(true);\n    if (lastOnStack && lastOnStack !== this.topBlock.nextConnection) {\n      available.push(lastOnStack);\n      this.lastOnStack = lastOnStack;\n      if (this.lastMarker) {\n        eventUtils.disable();\n        try {\n          this.lastMarker.dispose();\n        } finally {\n          eventUtils.enable();\n        }\n      }\n      this.lastMarker = this.createMarkerBlock(lastOnStack.getSourceBlock());\n    }\n    return available;\n  }\n\n  /**\n   * Whether the previews (insertion marker and replacement marker) should be\n   * updated based on the closest candidate and the current drag distance.\n   *\n   * @param newCandidate A new candidate connection that may replace the current\n   *     best candidate.\n   * @param dxy Position relative to drag start, in workspace units.\n   * @returns Whether the preview should be updated.\n   */\n  private shouldUpdatePreviews(\n      newCandidate: CandidateConnection|null, dxy: Coordinate): boolean {\n    // Only need to update if we were showing a preview before.\n    if (!newCandidate) return !!this.activeCandidate;\n\n    // We weren't showing a preview before, but we should now.\n    if (!this.activeCandidate) return true;\n\n    // We're already showing an insertion marker.\n    // Decide whether the new connection has higher priority.\n    const {local: activeLocal, closest: activeClosest} = this.activeCandidate;\n    if (activeClosest === newCandidate.closest &&\n        activeLocal === newCandidate.local) {\n      // The connection was the same as the current connection.\n      return false;\n    }\n\n    const xDiff = activeLocal.x + dxy.x - activeClosest.x;\n    const yDiff = activeLocal.y + dxy.y - activeClosest.y;\n    const curDistance = Math.sqrt(xDiff * xDiff + yDiff * yDiff);\n    // Slightly prefer the existing preview over a new preview.\n    return (\n        newCandidate.radius < curDistance - config.currentConnectionPreference);\n  }\n\n  /**\n   * Find the nearest valid connection, which may be the same as the current\n   * closest connection.\n   *\n   * @param dxy Position relative to drag start, in workspace units.\n   * @returns An object containing a local connection, a closest connection, and\n   *     a radius.\n   */\n  private getCandidate(dxy: Coordinate): CandidateConnection|null {\n    // It's possible that a block has added or removed connections during a\n    // drag, (e.g. in a drag/move event handler), so let's update the available\n    // connections. Note that this will be called on every move while dragging,\n    // so it might cause slowness, especially if the block stack is large.  If\n    // so, maybe it could be made more efficient. Also note that we won't update\n    // the connections if we've already connected the insertion marker to a\n    // block.\n    if (!this.markerConnection || !this.markerConnection.isConnected()) {\n      this.updateAvailableConnections();\n    }\n\n    let radius = this.getStartRadius();\n    let candidate = null;\n    for (let i = 0; i < this.availableConnections.length; i++) {\n      const myConnection = this.availableConnections[i];\n      const neighbour = myConnection.closest(radius, dxy);\n      if (neighbour.connection) {\n        candidate = {\n          closest: neighbour.connection,\n          local: myConnection,\n          radius: neighbour.radius,\n        };\n        radius = neighbour.radius;\n      }\n    }\n    return candidate;\n  }\n\n  /**\n   * Decide the radius at which to start searching for the closest connection.\n   *\n   * @returns The radius at which to start the search for the closest\n   *     connection.\n   */\n  private getStartRadius(): number {\n    // If there is already a connection highlighted,\n    // increase the radius we check for making new connections.\n    // When a connection is highlighted, blocks move around when the\n    // insertion marker is created, which could cause the connection became out\n    // of range. By increasing radiusConnection when a connection already\n    // exists, we never \"lose\" the connection from the offset.\n    return this.activeCandidate ? config.connectingSnapRadius :\n                                  config.snapRadius;\n  }\n\n  /**\n   * Whether ending the drag would delete the block.\n   *\n   * @param newCandidate Whether there is a candidate connection that the\n   *     block could connect to if the drag ended immediately.\n   * @param dragTarget The drag target that the block is currently over.\n   * @returns Whether dropping the block immediately would delete the block.\n   */\n  private shouldDelete(newCandidate: boolean, dragTarget: IDragTarget|null):\n      boolean {\n    if (dragTarget) {\n      const componentManager = this.workspace.getComponentManager();\n      const isDeleteArea = componentManager.hasCapability(\n          dragTarget.id, ComponentManager.Capability.DELETE_AREA);\n      if (isDeleteArea) {\n        return (dragTarget as IDeleteArea)\n            .wouldDelete(this.topBlock, newCandidate);\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Show an insertion marker or replacement highlighting during a drag, if\n   * needed.\n   * At the beginning of this function, this.activeConnection should be null.\n   *\n   * @param newCandidate A new candidate connection that may replace the current\n   *     best candidate.\n   */\n  private maybeShowPreview(newCandidate: CandidateConnection|null) {\n    if (this.wouldDeleteBlock) return;  // Nope, don't add a marker.\n    if (!newCandidate) return;          // Nothing to connect to.\n\n    const closest = newCandidate.closest;\n\n    // Something went wrong and we're trying to connect to an invalid\n    // connection.\n    if (closest === this.activeCandidate?.closest ||\n        closest.getSourceBlock().isInsertionMarker()) {\n      console.log('Trying to connect to an insertion marker');\n      return;\n    }\n    this.activeCandidate = newCandidate;\n    // Add an insertion marker or replacement marker.\n    this.showPreview(this.activeCandidate);\n  }\n\n  /**\n   * A preview should be shown.  This function figures out if it should be a\n   * block highlight or an insertion marker, and shows the appropriate one.\n   *\n   * @param activeCandidate The connection that will be made if the drag ends\n   *     immediately.\n   */\n  private showPreview(activeCandidate: CandidateConnection) {\n    const renderer = this.workspace.getRenderer();\n    const method = renderer.getConnectionPreviewMethod(\n        activeCandidate.closest, activeCandidate.local, this.topBlock);\n\n    switch (method) {\n      case InsertionMarkerManager.PREVIEW_TYPE.INPUT_OUTLINE:\n        this.showInsertionInputOutline(activeCandidate);\n        break;\n      case InsertionMarkerManager.PREVIEW_TYPE.INSERTION_MARKER:\n        this.showInsertionMarker(activeCandidate);\n        break;\n      case InsertionMarkerManager.PREVIEW_TYPE.REPLACEMENT_FADE:\n        this.showReplacementFade(activeCandidate);\n        break;\n    }\n\n    // Optionally highlight the actual connection, as a nod to previous\n    // behaviour.\n    if (renderer.shouldHighlightConnection(activeCandidate.closest)) {\n      activeCandidate.closest.highlight();\n    }\n  }\n\n  /**\n   * Hide an insertion marker or replacement highlighting during a drag, if\n   * needed.\n   * At the end of this function, this.activeCandidate will be null.\n   *\n   * @param newCandidate A new candidate connection that may replace the current\n   *     best candidate.\n   */\n  private maybeHidePreview(newCandidate: CandidateConnection|null) {\n    // If there's no new preview, remove the old one but don't bother deleting\n    // it. We might need it later, and this saves disposing of it and recreating\n    // it.\n    if (!newCandidate) {\n      this.hidePreview();\n    } else {\n      if (this.activeCandidate) {\n        const closestChanged =\n            this.activeCandidate.closest !== newCandidate.closest;\n        const localChanged = this.activeCandidate.local !== newCandidate.local;\n\n        // If there's a new preview and there was a preview before, and either\n        // connection has changed, remove the old preview.\n        // Also hide if we had a preview before but now we're going to delete\n        // instead.\n        if ((closestChanged || localChanged || this.wouldDeleteBlock)) {\n          this.hidePreview();\n        }\n      }\n    }\n\n    // Either way, clear out old state.\n    this.markerConnection = null;\n    this.activeCandidate = null;\n  }\n\n  /**\n   * A preview should be hidden. Loop through all possible preview modes\n   * and hide everything.\n   */\n  private hidePreview() {\n    const closest = this.activeCandidate?.closest;\n    if (closest && closest.targetBlock() &&\n        this.workspace.getRenderer().shouldHighlightConnection(closest)) {\n      closest.unhighlight();\n    }\n    this.hideReplacementFade();\n    this.hideInsertionInputOutline();\n    this.hideInsertionMarker();\n  }\n\n  /**\n   * Shows an insertion marker connected to the appropriate blocks (based on\n   * manager state).\n   *\n   * @param activeCandidate The connection that will be made if the drag ends\n   *     immediately.\n   */\n  private showInsertionMarker(activeCandidate: CandidateConnection) {\n    const {local, closest} = activeCandidate;\n\n    const isLastInStack = this.lastOnStack && local === this.lastOnStack;\n    let insertionMarker = isLastInStack ? this.lastMarker : this.firstMarker;\n    if (!insertionMarker) {\n      throw new Error(\n          'Cannot show the insertion marker because there is no insertion ' +\n          'marker block');\n    }\n    let imConn;\n    try {\n      imConn =\n          insertionMarker.getMatchingConnection(local.getSourceBlock(), local);\n    } catch (e) {\n      // It's possible that the number of connections on the local block has\n      // changed since the insertion marker was originally created.  Let's\n      // recreate the insertion marker and try again. In theory we could\n      // probably recreate the marker block (e.g. in getCandidate_), which is\n      // called more often during the drag, but creating a block that often\n      // might be too slow, so we only do it if necessary.\n      this.firstMarker = this.createMarkerBlock(this.topBlock);\n      insertionMarker = isLastInStack ? this.lastMarker : this.firstMarker;\n      if (!insertionMarker) {\n        throw new Error(\n            'Cannot show the insertion marker because there is no insertion ' +\n            'marker block');\n      }\n      imConn =\n          insertionMarker.getMatchingConnection(local.getSourceBlock(), local);\n    }\n\n    if (!imConn) {\n      throw new Error(\n          'Cannot show the insertion marker because there is no ' +\n          'associated connection');\n    }\n\n    if (imConn === this.markerConnection) {\n      throw new Error(\n          'Made it to showInsertionMarker_ even though the marker isn\\'t ' +\n          'changing');\n    }\n\n    // Render disconnected from everything else so that we have a valid\n    // connection location.\n    insertionMarker.render();\n    insertionMarker.rendered = true;\n    insertionMarker.getSvgRoot().setAttribute('visibility', 'visible');\n\n    if (imConn && closest) {\n      // Position so that the existing block doesn't move.\n      insertionMarker.positionNearConnection(imConn, closest);\n    }\n    if (closest) {\n      // Connect() also renders the insertion marker.\n      imConn.connect(closest);\n    }\n\n    this.markerConnection = imConn;\n  }\n\n  /**\n   * Disconnects and hides the current insertion marker. Should return the\n   * blocks to their original state.\n   */\n  private hideInsertionMarker() {\n    if (!this.markerConnection) return;\n\n    const markerConn = this.markerConnection;\n    const imBlock = markerConn.getSourceBlock();\n    const markerNext = imBlock.nextConnection;\n    const markerPrev = imBlock.previousConnection;\n    const markerOutput = imBlock.outputConnection;\n\n    const isNext = markerConn === markerNext;\n\n    const isFirstInStatementStack =\n        isNext && !(markerPrev && markerPrev.targetConnection);\n\n    const isFirstInOutputStack =\n        markerConn.type === ConnectionType.INPUT_VALUE &&\n        !(markerOutput && markerOutput.targetConnection);\n    // The insertion marker is the first block in a stack.  Unplug won't do\n    // anything in that case.  Instead, unplug the following block.\n    if (isFirstInStatementStack || isFirstInOutputStack) {\n      markerConn.targetBlock()!.unplug(false);\n    } else if (markerConn.type === ConnectionType.NEXT_STATEMENT && !isNext) {\n      // Inside of a C-block, first statement connection.\n      const innerConnection = markerConn.targetConnection;\n      if (innerConnection) {\n        innerConnection.getSourceBlock().unplug(false);\n      }\n\n      const previousBlockNextConnection =\n          markerPrev ? markerPrev.targetConnection : null;\n\n      imBlock.unplug(true);\n      if (previousBlockNextConnection && innerConnection) {\n        previousBlockNextConnection.connect(innerConnection);\n      }\n    } else {\n      imBlock.unplug(/* healStack */ true);\n    }\n\n    if (markerConn.targetConnection) {\n      throw Error(\n          'markerConnection still connected at the end of ' +\n          'disconnectInsertionMarker');\n    }\n\n    this.markerConnection = null;\n    const svg = imBlock.getSvgRoot();\n    if (svg) {\n      svg.setAttribute('visibility', 'hidden');\n    }\n  }\n\n  /**\n   * Shows an outline around the input the closest connection belongs to.\n   *\n   * @param activeCandidate The connection that will be made if the drag ends\n   *     immediately.\n   */\n  private showInsertionInputOutline(activeCandidate: CandidateConnection) {\n    const closest = activeCandidate.closest;\n    this.highlightedBlock = closest.getSourceBlock();\n    this.highlightedBlock.highlightShapeForInput(closest, true);\n  }\n\n  /** Hides any visible input outlines. */\n  private hideInsertionInputOutline() {\n    if (!this.highlightedBlock) return;\n\n    if (!this.activeCandidate) {\n      throw new Error(\n          'Cannot hide the insertion marker outline because ' +\n          'there is no active candidate');\n    }\n    this.highlightedBlock.highlightShapeForInput(\n        this.activeCandidate.closest, false);\n    this.highlightedBlock = null;\n  }\n\n  /**\n   * Shows a replacement fade affect on the closest connection's target block\n   * (the block that is currently connected to it).\n   *\n   * @param activeCandidate The connection that will be made if the drag ends\n   *     immediately.\n   */\n  private showReplacementFade(activeCandidate: CandidateConnection) {\n    this.fadedBlock = activeCandidate.closest.targetBlock();\n    if (!this.fadedBlock) {\n      throw new Error(\n          'Cannot show the replacement fade because the ' +\n          'closest connection does not have a target block');\n    }\n    this.fadedBlock.fadeForReplacement(true);\n  }\n\n  /**\n   * Hides/Removes any visible fade affects.\n   */\n  private hideReplacementFade() {\n    if (!this.fadedBlock) return;\n\n    this.fadedBlock.fadeForReplacement(false);\n    this.fadedBlock = null;\n  }\n\n  /**\n   * Get a list of the insertion markers that currently exist.  Drags have 0, 1,\n   * or 2 insertion markers.\n   *\n   * @returns A possibly empty list of insertion marker blocks.\n   * @internal\n   */\n  getInsertionMarkers(): BlockSvg[] {\n    const result = [];\n    if (this.firstMarker) {\n      result.push(this.firstMarker);\n    }\n    if (this.lastMarker) {\n      result.push(this.lastMarker);\n    }\n    return result;\n  }\n}\n\nexport namespace InsertionMarkerManager {\n  /**\n   * An enum describing different kinds of previews the InsertionMarkerManager\n   * could display.\n   */\n  export enum PREVIEW_TYPE {\n    INSERTION_MARKER = 0,\n    INPUT_OUTLINE = 1,\n    REPLACEMENT_FADE = 2,\n  }\n}\n\nexport type PreviewType = InsertionMarkerManager.PREVIEW_TYPE;\nexport const PreviewType = InsertionMarkerManager.PREVIEW_TYPE;\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Base renderer.\n *\n * @class\n */\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.Renderer');\n\nimport type {Block} from '../../block.js';\nimport type {BlockSvg} from '../../block_svg.js';\nimport {Connection} from '../../connection.js';\nimport {ConnectionType} from '../../connection_type.js';\nimport {InsertionMarkerManager, PreviewType} from '../../insertion_marker_manager.js';\nimport type {IRegistrable} from '../../interfaces/i_registrable.js';\nimport type {Marker} from '../../keyboard_nav/marker.js';\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport type {BlockStyle, Theme} from '../../theme.js';\nimport type {WorkspaceSvg} from '../../workspace_svg.js';\n\nimport {ConstantProvider} from './constants.js';\nimport * as debug from './debug.js';\nimport {Debug} from './debugger.js';\nimport {Drawer} from './drawer.js';\nimport type {IPathObject} from './i_path_object.js';\nimport {RenderInfo} from './info.js';\nimport {MarkerSvg} from './marker_svg.js';\nimport {PathObject} from './path_object.js';\n\n\n/**\n * The base class for a block renderer.\n *\n * @alias Blockly.blockRendering.Renderer\n */\nexport class Renderer implements IRegistrable {\n  /** The renderer's constant provider. */\n  protected constants_!: ConstantProvider;\n\n  /** @internal */\n  name: string;\n\n  /**\n   * Rendering constant overrides, passed in through options.\n   *\n   * @internal\n   */\n  overrides: object|null = null;\n\n  /**\n   * @param name The renderer name.\n   * @internal\n   */\n  constructor(name: string) {\n    this.name = name;\n  }\n\n  /**\n   * Gets the class name that identifies this renderer.\n   *\n   * @returns The CSS class name.\n   * @internal\n   */\n  getClassName(): string {\n    return this.name + '-renderer';\n  }\n\n  /**\n   * Initialize the renderer.\n   *\n   * @param theme The workspace theme object.\n   * @param opt_rendererOverrides Rendering constant overrides.\n   * @internal\n   */\n  init(\n      theme: Theme, opt_rendererOverrides?: {[rendererConstant: string]: any}) {\n    this.constants_ = this.makeConstants_();\n    if (opt_rendererOverrides) {\n      this.overrides = opt_rendererOverrides;\n      Object.assign(this.constants_, opt_rendererOverrides);\n    }\n    this.constants_.setTheme(theme);\n    this.constants_.init();\n  }\n\n  /**\n   * Create any DOM elements that this renderer needs.\n   *\n   * @param svg The root of the workspace's SVG.\n   * @param theme The workspace theme object.\n   * @internal\n   */\n  createDom(svg: SVGElement, theme: Theme) {\n    this.constants_.createDom(\n        svg, this.name + '-' + theme.name,\n        '.' + this.getClassName() + '.' + theme.getClassName());\n  }\n\n  /**\n   * Refresh the renderer after a theme change.\n   *\n   * @param svg The root of the workspace's SVG.\n   * @param theme The workspace theme object.\n   * @internal\n   */\n  refreshDom(svg: SVGElement, theme: Theme) {\n    const previousConstants = this.getConstants();\n    previousConstants.dispose();\n    this.constants_ = this.makeConstants_();\n    if (this.overrides) {\n      Object.assign(this.constants_, this.overrides);\n    }\n    // Ensure the constant provider's random identifier does not change.\n    this.constants_.randomIdentifier = previousConstants.randomIdentifier;\n    this.constants_.setTheme(theme);\n    this.constants_.init();\n    this.createDom(svg, theme);\n  }\n\n  /**\n   * Dispose of this renderer.\n   * Delete all DOM elements that this renderer and its constants created.\n   *\n   * @internal\n   */\n  dispose() {\n    if (this.constants_) {\n      this.constants_.dispose();\n    }\n  }\n\n  /**\n   * Create a new instance of the renderer's constant provider.\n   *\n   * @returns The constant provider.\n   */\n  protected makeConstants_(): ConstantProvider {\n    return new ConstantProvider();\n  }\n\n  /**\n   * Create a new instance of the renderer's render info object.\n   *\n   * @param block The block to measure.\n   * @returns The render info object.\n   */\n  protected makeRenderInfo_(block: BlockSvg): RenderInfo {\n    return new RenderInfo(this, block);\n  }\n\n  /**\n   * Create a new instance of the renderer's drawer.\n   *\n   * @param block The block to render.\n   * @param info An object containing all information needed to render this\n   *     block.\n   * @returns The drawer.\n   */\n  protected makeDrawer_(block: BlockSvg, info: RenderInfo): Drawer {\n    return new Drawer(block, info);\n  }\n\n  /**\n   * Create a new instance of the renderer's debugger.\n   *\n   * @returns The renderer debugger.\n   * @suppress {strictModuleDepCheck} Debug renderer only included in\n   * playground.\n   */\n  protected makeDebugger_(): Debug {\n    return new Debug(this.getConstants());\n  }\n\n  /**\n   * Create a new instance of the renderer's marker drawer.\n   *\n   * @param workspace The workspace the marker belongs to.\n   * @param marker The marker.\n   * @returns The object in charge of drawing the marker.\n   * @internal\n   */\n  makeMarkerDrawer(workspace: WorkspaceSvg, marker: Marker): MarkerSvg {\n    return new MarkerSvg(workspace, this.getConstants(), marker);\n  }\n\n  /**\n   * Create a new instance of a renderer path object.\n   *\n   * @param root The root SVG element.\n   * @param style The style object to use for colouring.\n   * @returns The renderer path object.\n   * @internal\n   */\n  makePathObject(root: SVGElement, style: BlockStyle): IPathObject {\n    return new PathObject(root, style, (this.constants_));\n  }\n\n  /**\n   * Get the current renderer's constant provider.  We assume that when this is\n   * called, the renderer has already been initialized.\n   *\n   * @returns The constant provider.\n   * @internal\n   */\n  getConstants(): ConstantProvider {\n    return this.constants_;\n  }\n\n  /**\n   * Determine whether or not to highlight a connection.\n   *\n   * @param _conn The connection to determine whether or not to highlight.\n   * @returns True if we should highlight the connection.\n   * @internal\n   */\n  shouldHighlightConnection(_conn: Connection): boolean {\n    return true;\n  }\n\n  /**\n   * Checks if an orphaned block can connect to the \"end\" of the topBlock's\n   * block-clump. If the clump is a row the end is the last input. If the clump\n   * is a stack, the end is the last next connection. If the clump is neither,\n   * then this returns false.\n   *\n   * @param topBlock The top block of the block clump we want to try and connect\n   *     to.\n   * @param orphanBlock The orphan block that wants to find a home.\n   * @param localType The type of the connection being dragged.\n   * @returns Whether there is a home for the orphan or not.\n   * @internal\n   */\n  orphanCanConnectAtEnd(\n      topBlock: BlockSvg, orphanBlock: BlockSvg, localType: number): boolean {\n    const orphanConnection = localType === ConnectionType.OUTPUT_VALUE ?\n        orphanBlock.outputConnection :\n        orphanBlock.previousConnection;\n    return !!Connection.getConnectionForOrphanedConnection(\n        topBlock as Block, orphanConnection as Connection);\n  }\n\n  /**\n   * Chooses a connection preview method based on the available connection, the\n   * current dragged connection, and the block being dragged.\n   *\n   * @param closest The available connection.\n   * @param local The connection currently being dragged.\n   * @param topBlock The block currently being dragged.\n   * @returns The preview type to display.\n   * @internal\n   */\n  getConnectionPreviewMethod(\n      closest: RenderedConnection, local: RenderedConnection,\n      topBlock: BlockSvg): PreviewType {\n    if (local.type === ConnectionType.OUTPUT_VALUE ||\n        local.type === ConnectionType.PREVIOUS_STATEMENT) {\n      if (!closest.isConnected() ||\n          this.orphanCanConnectAtEnd(\n              topBlock, closest.targetBlock() as BlockSvg, local.type)) {\n        return InsertionMarkerManager.PREVIEW_TYPE.INSERTION_MARKER;\n      }\n      return InsertionMarkerManager.PREVIEW_TYPE.REPLACEMENT_FADE;\n    }\n\n    return InsertionMarkerManager.PREVIEW_TYPE.INSERTION_MARKER;\n  }\n\n  /**\n   * Render the block.\n   *\n   * @param block The block to render.\n   * @internal\n   */\n  render(block: BlockSvg) {\n    if (debug.isDebuggerEnabled() && !block.renderingDebugger) {\n      block.renderingDebugger = this.makeDebugger_();\n    }\n    const info = this.makeRenderInfo_(block);\n    info.measure();\n    this.makeDrawer_(block, info).draw();\n  }\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object in charge of storing and updating a workspace theme\n *     and UI components.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.ThemeManager');\n\nimport type {Theme} from './theme.js';\nimport * as arrayUtils from './utils/array.js';\nimport * as dom from './utils/dom.js';\nimport type {Workspace} from './workspace.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/**\n * Class for storing and updating a workspace's theme and UI components.\n *\n * @alias Blockly.ThemeManager\n */\nexport class ThemeManager {\n  /** A list of workspaces that are subscribed to this theme. */\n  private subscribedWorkspaces_: Workspace[] = [];\n  private componentDB = new Map<string, Component[]>();\n  owner_: AnyDuringMigration;\n\n  /**\n   * @param workspace The main workspace.\n   * @param theme The workspace theme.\n   * @internal\n   */\n  constructor(private readonly workspace: WorkspaceSvg, private theme: Theme) {}\n\n  /**\n   * Get the workspace theme.\n   *\n   * @returns The workspace theme.\n   * @internal\n   */\n  getTheme(): Theme {\n    return this.theme;\n  }\n\n  /**\n   * Set the workspace theme, and refresh the workspace and all components.\n   *\n   * @param theme The workspace theme.\n   * @internal\n   */\n  setTheme(theme: Theme) {\n    const prevTheme = this.theme;\n    this.theme = theme;\n    // Set the theme name onto the injection div.\n    const injectionDiv = this.workspace.getInjectionDiv();\n    if (injectionDiv) {\n      if (prevTheme) {\n        const oldClassName = prevTheme.getClassName();\n        if (oldClassName) {\n          dom.removeClass(injectionDiv, oldClassName);\n        }\n      }\n      const newClassName = this.theme.getClassName();\n      if (newClassName) {\n        dom.addClass(injectionDiv, newClassName);\n      }\n    }\n\n    // Refresh all subscribed workspaces.\n    for (let i = 0, workspace; workspace = this.subscribedWorkspaces_[i]; i++) {\n      (workspace as WorkspaceSvg).refreshTheme();\n    }\n\n    // Refresh all registered Blockly UI components.\n    for (const [key, componentList] of this.componentDB) {\n      for (const component of componentList) {\n        const element = component.element;\n        const propertyName = component.propertyName;\n        const style = this.theme && this.theme.getComponentStyle(key);\n        // AnyDuringMigration because:  Property 'style' does not exist on type\n        // 'Element'.\n        (element as AnyDuringMigration).style[propertyName] = style || '';\n      }\n    }\n\n    for (const workspace of this.subscribedWorkspaces_) {\n      (workspace as WorkspaceSvg).hideChaff();\n    }\n  }\n\n  /**\n   * Subscribe a workspace to changes to the selected theme.  If a new theme is\n   * set, the workspace is called to refresh its blocks.\n   *\n   * @param workspace The workspace to subscribe.\n   * @internal\n   */\n  subscribeWorkspace(workspace: Workspace) {\n    this.subscribedWorkspaces_.push(workspace);\n  }\n\n  /**\n   * Unsubscribe a workspace to changes to the selected theme.\n   *\n   * @param workspace The workspace to unsubscribe.\n   * @internal\n   */\n  unsubscribeWorkspace(workspace: Workspace) {\n    if (!arrayUtils.removeElem(this.subscribedWorkspaces_, workspace)) {\n      throw Error(\n          'Cannot unsubscribe a workspace that hasn\\'t been subscribed.');\n    }\n  }\n\n  /**\n   * Subscribe an element to changes to the selected theme.  If a new theme is\n   * selected, the element's style is refreshed with the new theme's style.\n   *\n   * @param element The element to subscribe.\n   * @param componentName The name used to identify the component. This must be\n   *     the same name used to configure the style in the Theme object.\n   * @param propertyName The inline style property name to update.\n   * @internal\n   */\n  subscribe(element: Element, componentName: string, propertyName: string) {\n    if (!this.componentDB.has(componentName)) {\n      this.componentDB.set(componentName, []);\n    }\n\n    // Add the element to our component map.\n    this.componentDB.get(componentName)!.push({element, propertyName});\n\n    // Initialize the element with its corresponding theme style.\n    const style = this.theme && this.theme.getComponentStyle(componentName);\n    // AnyDuringMigration because:  Property 'style' does not exist on type\n    // 'Element'.\n    (element as AnyDuringMigration).style[propertyName] = style || '';\n  }\n\n  /**\n   * Unsubscribe an element to changes to the selected theme.\n   *\n   * @param element The element to unsubscribe.\n   * @internal\n   */\n  unsubscribe(element: Element) {\n    if (!element) {\n      return;\n    }\n    // Go through all component, and remove any references to this element.\n    for (const [componentName, elements] of this.componentDB) {\n      for (let i = elements.length - 1; i >= 0; i--) {\n        if (elements[i].element === element) {\n          elements.splice(i, 1);\n        }\n      }\n      // Clean up the component map entry if the list is empty.\n      if (!elements.length) {\n        this.componentDB.delete(componentName);\n      }\n    }\n  }\n\n  /**\n   * Dispose of this theme manager.\n   *\n   * @suppress {checkTypes}\n   * @internal\n   */\n  dispose() {\n    this.owner_ = null;\n    // AnyDuringMigration because:  Type 'null' is not assignable to type\n    // 'Theme'.\n    this.theme = null as AnyDuringMigration;\n    // AnyDuringMigration because:  Type 'null' is not assignable to type\n    // 'Workspace[]'.\n    this.subscribedWorkspaces_ = null as AnyDuringMigration;\n    this.componentDB.clear();\n  }\n}\n\nexport namespace ThemeManager {\n  /** The type for a Blockly UI Component. */\n  export interface Component {\n    element: Element;\n    propertyName: string;\n  }\n}\n\nexport type Component = ThemeManager.Component;\n","/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * An object that encapsulates logic for checking whether a\n * potential connection is safe and valid.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.ConnectionChecker');\n\nimport * as common from './common.js';\nimport {Connection} from './connection.js';\nimport {ConnectionType} from './connection_type.js';\nimport type {IConnectionChecker} from './interfaces/i_connection_checker.js';\nimport * as internalConstants from './internal_constants.js';\nimport * as registry from './registry.js';\nimport type {RenderedConnection} from './rendered_connection.js';\n\n\n/**\n * Class for connection type checking logic.\n *\n * @alias Blockly.ConnectionChecker\n */\nexport class ConnectionChecker implements IConnectionChecker {\n  /**\n   * Check whether the current connection can connect with the target\n   * connection.\n   *\n   * @param a Connection to check compatibility with.\n   * @param b Connection to check compatibility with.\n   * @param isDragging True if the connection is being made by dragging a block.\n   * @param opt_distance The max allowable distance between the connections for\n   *     drag checks.\n   * @returns Whether the connection is legal.\n   */\n  canConnect(\n      a: Connection|null, b: Connection|null, isDragging: boolean,\n      opt_distance?: number): boolean {\n    return this.canConnectWithReason(a, b, isDragging, opt_distance) ===\n        Connection.CAN_CONNECT;\n  }\n\n  /**\n   * Checks whether the current connection can connect with the target\n   * connection, and return an error code if there are problems.\n   *\n   * @param a Connection to check compatibility with.\n   * @param b Connection to check compatibility with.\n   * @param isDragging True if the connection is being made by dragging a block.\n   * @param opt_distance The max allowable distance between the connections for\n   *     drag checks.\n   * @returns Connection.CAN_CONNECT if the connection is legal, an error code\n   *     otherwise.\n   */\n  canConnectWithReason(\n      a: Connection|null, b: Connection|null, isDragging: boolean,\n      opt_distance?: number): number {\n    const safety = this.doSafetyChecks(a, b);\n    if (safety !== Connection.CAN_CONNECT) {\n      return safety;\n    }\n\n    // If the safety checks passed, both connections are non-null.\n    const connOne = a!;\n    const connTwo = b!;\n    if (!this.doTypeChecks(connOne, connTwo)) {\n      return Connection.REASON_CHECKS_FAILED;\n    }\n\n    if (isDragging &&\n        !this.doDragChecks(\n            a as RenderedConnection, b as RenderedConnection,\n            opt_distance || 0)) {\n      return Connection.REASON_DRAG_CHECKS_FAILED;\n    }\n\n    return Connection.CAN_CONNECT;\n  }\n\n  /**\n   * Helper method that translates a connection error code into a string.\n   *\n   * @param errorCode The error code.\n   * @param a One of the two connections being checked.\n   * @param b The second of the two connections being checked.\n   * @returns A developer-readable error string.\n   */\n  getErrorMessage(errorCode: number, a: Connection|null, b: Connection|null):\n      string {\n    switch (errorCode) {\n      case Connection.REASON_SELF_CONNECTION:\n        return 'Attempted to connect a block to itself.';\n      case Connection.REASON_DIFFERENT_WORKSPACES:\n        // Usually this means one block has been deleted.\n        return 'Blocks not on same workspace.';\n      case Connection.REASON_WRONG_TYPE:\n        return 'Attempt to connect incompatible types.';\n      case Connection.REASON_TARGET_NULL:\n        return 'Target connection is null.';\n      case Connection.REASON_CHECKS_FAILED: {\n        const connOne = a!;\n        const connTwo = b!;\n        let msg = 'Connection checks failed. ';\n        msg += connOne + ' expected ' + connOne.getCheck() + ', found ' +\n            connTwo.getCheck();\n        return msg;\n      }\n      case Connection.REASON_SHADOW_PARENT:\n        return 'Connecting non-shadow to shadow block.';\n      case Connection.REASON_DRAG_CHECKS_FAILED:\n        return 'Drag checks failed.';\n      case Connection.REASON_PREVIOUS_AND_OUTPUT:\n        return 'Block would have an output and a previous connection.';\n      default:\n        return 'Unknown connection failure: this should never happen!';\n    }\n  }\n\n  /**\n   * Check that connecting the given connections is safe, meaning that it would\n   * not break any of Blockly's basic assumptions (e.g. no self connections).\n   *\n   * @param a The first of the connections to check.\n   * @param b The second of the connections to check.\n   * @returns An enum with the reason this connection is safe or unsafe.\n   */\n  doSafetyChecks(a: Connection|null, b: Connection|null): number {\n    if (!a || !b) {\n      return Connection.REASON_TARGET_NULL;\n    }\n    let superiorBlock;\n    let inferiorBlock;\n    let superiorConnection;\n    let inferiorConnection;\n    if (a.isSuperior()) {\n      superiorBlock = a.getSourceBlock();\n      inferiorBlock = b.getSourceBlock();\n      superiorConnection = a;\n      inferiorConnection = b;\n    } else {\n      inferiorBlock = a.getSourceBlock();\n      superiorBlock = b.getSourceBlock();\n      inferiorConnection = a;\n      superiorConnection = b;\n    }\n    if (superiorBlock === inferiorBlock) {\n      return Connection.REASON_SELF_CONNECTION;\n    } else if (\n        inferiorConnection.type !==\n        internalConstants.OPPOSITE_TYPE[superiorConnection.type]) {\n      return Connection.REASON_WRONG_TYPE;\n    } else if (superiorBlock.workspace !== inferiorBlock.workspace) {\n      return Connection.REASON_DIFFERENT_WORKSPACES;\n    } else if (superiorBlock.isShadow() && !inferiorBlock.isShadow()) {\n      return Connection.REASON_SHADOW_PARENT;\n    } else if (\n        inferiorConnection.type === ConnectionType.OUTPUT_VALUE &&\n        inferiorBlock.previousConnection &&\n        inferiorBlock.previousConnection.isConnected()) {\n      return Connection.REASON_PREVIOUS_AND_OUTPUT;\n    } else if (\n        inferiorConnection.type === ConnectionType.PREVIOUS_STATEMENT &&\n        inferiorBlock.outputConnection &&\n        inferiorBlock.outputConnection.isConnected()) {\n      return Connection.REASON_PREVIOUS_AND_OUTPUT;\n    }\n    return Connection.CAN_CONNECT;\n  }\n\n  /**\n   * Check whether this connection is compatible with another connection with\n   * respect to the value type system.  E.g. square_root(\"Hello\") is not\n   * compatible.\n   *\n   * @param a Connection to compare.\n   * @param b Connection to compare against.\n   * @returns True if the connections share a type.\n   */\n  doTypeChecks(a: Connection, b: Connection): boolean {\n    const checkArrayOne = a.getCheck();\n    const checkArrayTwo = b.getCheck();\n\n    if (!checkArrayOne || !checkArrayTwo) {\n      // One or both sides are promiscuous enough that anything will fit.\n      return true;\n    }\n    // Find any intersection in the check lists.\n    for (let i = 0; i < checkArrayOne.length; i++) {\n      if (checkArrayTwo.indexOf(checkArrayOne[i]) !== -1) {\n        return true;\n      }\n    }\n    // No intersection.\n    return false;\n  }\n\n  /**\n   * Check whether this connection can be made by dragging.\n   *\n   * @param a Connection to compare.\n   * @param b Connection to compare against.\n   * @param distance The maximum allowable distance between connections.\n   * @returns True if the connection is allowed during a drag.\n   */\n  doDragChecks(a: RenderedConnection, b: RenderedConnection, distance: number):\n      boolean {\n    if (a.distanceFrom(b) > distance) {\n      return false;\n    }\n\n    // Don't consider insertion markers.\n    if (b.getSourceBlock().isInsertionMarker()) {\n      return false;\n    }\n\n    switch (b.type) {\n      case ConnectionType.PREVIOUS_STATEMENT:\n        return this.canConnectToPrevious_(a, b);\n      case ConnectionType.OUTPUT_VALUE: {\n        // Don't offer to connect an already connected left (male) value plug to\n        // an available right (female) value plug.\n        if (b.isConnected() && !b.targetBlock()!.isInsertionMarker() ||\n            a.isConnected()) {\n          return false;\n        }\n        break;\n      }\n      case ConnectionType.INPUT_VALUE: {\n        // Offering to connect the left (male) of a value block to an already\n        // connected value pair is ok, we'll splice it in.\n        // However, don't offer to splice into an immovable block.\n        if (b.isConnected() && !b.targetBlock()!.isMovable() &&\n            !b.targetBlock()!.isShadow()) {\n          return false;\n        }\n        break;\n      }\n      case ConnectionType.NEXT_STATEMENT: {\n        // Don't let a block with no next connection bump other blocks out of\n        // the stack.  But covering up a shadow block or stack of shadow blocks\n        // is fine.  Similarly, replacing a terminal statement with another\n        // terminal statement is allowed.\n        if (b.isConnected() && !a.getSourceBlock().nextConnection &&\n            !b.targetBlock()!.isShadow() && b.targetBlock()!.nextConnection) {\n          return false;\n        }\n        break;\n      }\n      default:\n        // Unexpected connection type.\n        return false;\n    }\n\n    // Don't let blocks try to connect to themselves or ones they nest.\n    if (common.draggingConnections.indexOf(b) !== -1) {\n      return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * Helper function for drag checking.\n   *\n   * @param a The connection to check, which must be a statement input or next\n   *     connection.\n   * @param b A nearby connection to check, which must be a previous connection.\n   * @returns True if the connection is allowed, false otherwise.\n   */\n  protected canConnectToPrevious_(a: Connection, b: Connection): boolean {\n    if (a.targetConnection) {\n      // This connection is already occupied.\n      // A next connection will never disconnect itself mid-drag.\n      return false;\n    }\n\n    // Don't let blocks try to connect to themselves or ones they nest.\n    if (common.draggingConnections.indexOf(b) !== -1) {\n      return false;\n    }\n\n    if (!b.targetConnection) {\n      return true;\n    }\n\n    const targetBlock = b.targetBlock();\n    // If it is connected to a real block, game over.\n    if (!targetBlock!.isInsertionMarker()) {\n      return false;\n    }\n    // If it's connected to an insertion marker but that insertion marker\n    // is the first block in a stack, it's still fine.  If that insertion\n    // marker is in the middle of a stack, it won't work.\n    return !targetBlock!.getPreviousBlock();\n  }\n}\n\nregistry.register(\n    registry.Type.CONNECTION_CHECKER, registry.DEFAULT, ConnectionChecker);\n","/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Classes for all types of variable events.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events.VarDelete');\n\nimport * as deprecation from '../utils/deprecation.js';\nimport * as registry from '../registry.js';\nimport type {VariableModel} from '../variable_model.js';\n\nimport {VarBase, VarBaseJson} from './events_var_base.js';\nimport * as eventUtils from './utils.js';\nimport type {Workspace} from '../workspace.js';\n\n\n/**\n * Class for a variable deletion event.\n *\n * @alias Blockly.Events.VarDelete\n */\nexport class VarDelete extends VarBase {\n  override type = eventUtils.VAR_DELETE;\n  varType?: string;\n  varName?: string;\n\n  /**\n   * @param opt_variable The deleted variable. Undefined for a blank event.\n   */\n  constructor(opt_variable?: VariableModel) {\n    super(opt_variable);\n\n    if (!opt_variable) {\n      return;  // Blank event to be populated by fromJson.\n    }\n    this.varType = opt_variable.type;\n    this.varName = opt_variable.name;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): VarDeleteJson {\n    const json = super.toJson() as VarDeleteJson;\n    if (!this.varType) {\n      throw new Error(\n          'The var type is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson');\n    }\n    if (!this.varName) {\n      throw new Error(\n          'The var name is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson');\n    }\n    json['varType'] = this.varType;\n    json['varName'] = this.varName;\n    return json;\n  }\n\n  /**\n   * Decode the JSON event.\n   *\n   * @param json JSON representation.\n   */\n  override fromJson(json: VarDeleteJson) {\n    deprecation.warn(\n        'Blockly.Events.VarDelete.prototype.fromJson', 'version 9',\n        'version 10', 'Blockly.Events.fromJson');\n    super.fromJson(json);\n    this.varType = json['varType'];\n    this.varName = json['varName'];\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of VarDelete, but we can't specify that due to the fact that parameters\n   *     to static methods in subclasses must be supertypes of parameters to\n   *     static methods in superclasses.\n   * @internal\n   */\n  static fromJson(json: VarDeleteJson, workspace: Workspace, event?: any):\n      VarDelete {\n    const newEvent =\n        super.fromJson(json, workspace, event ?? new VarDelete()) as VarDelete;\n    newEvent.varType = json['varType'];\n    newEvent.varName = json['varName'];\n    return newEvent;\n  }\n\n  /**\n   * Run a variable deletion event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    const workspace = this.getEventWorkspace_();\n    if (!this.varId) {\n      throw new Error(\n          'The var ID is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson');\n    }\n    if (!this.varName) {\n      throw new Error(\n          'The var name is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson');\n    }\n    if (forward) {\n      workspace.deleteVariableById(this.varId);\n    } else {\n      workspace.createVariable(this.varName, this.varType, this.varId);\n    }\n  }\n}\n\nexport interface VarDeleteJson extends VarBaseJson {\n  varType: string;\n  varName: string;\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.VAR_DELETE, VarDelete);\n","/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for a variable rename event.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events.VarRename');\n\nimport * as deprecation from '../utils/deprecation.js';\nimport * as registry from '../registry.js';\nimport type {VariableModel} from '../variable_model.js';\n\nimport {VarBase, VarBaseJson} from './events_var_base.js';\nimport * as eventUtils from './utils.js';\nimport type {Workspace} from '../workspace.js';\n\n\n/**\n * Class for a variable rename event.\n *\n * @alias Blockly.Events.VarRename\n */\nexport class VarRename extends VarBase {\n  override type = eventUtils.VAR_RENAME;\n  oldName?: string;\n  newName?: string;\n\n  /**\n   * @param opt_variable The renamed variable. Undefined for a blank event.\n   * @param newName The new name the variable will be changed to.\n   */\n  constructor(opt_variable?: VariableModel, newName?: string) {\n    super(opt_variable);\n\n    if (!opt_variable) {\n      return;  // Blank event to be populated by fromJson.\n    }\n    this.oldName = opt_variable.name;\n    this.newName = typeof newName === 'undefined' ? '' : newName;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): VarRenameJson {\n    const json = super.toJson() as VarRenameJson;\n    if (!this.oldName) {\n      throw new Error(\n          'The old var name is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson');\n    }\n    if (!this.newName) {\n      throw new Error(\n          'The new var name is undefined. Either pass a value to ' +\n          'the constructor, or call fromJson');\n    }\n    json['oldName'] = this.oldName;\n    json['newName'] = this.newName;\n    return json;\n  }\n\n  /**\n   * Decode the JSON event.\n   *\n   * @param json JSON representation.\n   */\n  override fromJson(json: VarRenameJson) {\n    deprecation.warn(\n        'Blockly.Events.VarRename.prototype.fromJson', 'version 9',\n        'version 10', 'Blockly.Events.fromJson');\n    super.fromJson(json);\n    this.oldName = json['oldName'];\n    this.newName = json['newName'];\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of VarRename, but we can't specify that due to the fact that parameters\n   *     to static methods in subclasses must be supertypes of parameters to\n   *     static methods in superclasses.\n   * @internal\n   */\n  static fromJson(json: VarRenameJson, workspace: Workspace, event?: any):\n      VarRename {\n    const newEvent =\n        super.fromJson(json, workspace, event ?? new VarRename()) as VarRename;\n    newEvent.oldName = json['oldName'];\n    newEvent.newName = json['newName'];\n    return newEvent;\n  }\n\n  /**\n   * Run a variable rename event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    const workspace = this.getEventWorkspace_();\n    if (!this.varId) {\n      throw new Error(\n          'The var ID is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson');\n    }\n    if (!this.oldName) {\n      throw new Error(\n          'The old var name is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson');\n    }\n    if (!this.newName) {\n      throw new Error(\n          'The new var name is undefined. Either pass a value to ' +\n          'the constructor, or call fromJson');\n    }\n    if (forward) {\n      workspace.renameVariableById(this.varId, this.newName);\n    } else {\n      workspace.renameVariableById(this.varId, this.oldName);\n    }\n  }\n}\n\nexport interface VarRenameJson extends VarBaseJson {\n  oldName: string;\n  newName: string;\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.VAR_RENAME, VarRename);\n","/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing a map of variables and their types.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.VariableMap');\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_var_delete.js';\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_var_rename.js';\n\nimport type {Block} from './block.js';\nimport * as dialog from './dialog.js';\nimport * as eventUtils from './events/utils.js';\nimport {Msg} from './msg.js';\nimport {Names} from './names.js';\nimport * as arrayUtils from './utils/array.js';\nimport * as idGenerator from './utils/idgenerator.js';\nimport {VariableModel} from './variable_model.js';\nimport type {Workspace} from './workspace.js';\n\n\n/**\n * Class for a variable map.  This contains a dictionary data structure with\n * variable types as keys and lists of variables as values.  The list of\n * variables are the type indicated by the key.\n *\n * @alias Blockly.VariableMap\n */\nexport class VariableMap {\n  /**\n   * A map from variable type to list of variable names.  The lists contain\n   * all of the named variables in the workspace, including variables that are\n   * not currently in use.\n   */\n  private variableMap = new Map<string, VariableModel[]>();\n\n  /** @param workspace The workspace this map belongs to. */\n  constructor(public workspace: Workspace) {}\n\n  /** Clear the variable map. */\n  clear() {\n    this.variableMap.clear();\n  }\n  /* Begin functions for renaming variables. */\n  /**\n   * Rename the given variable by updating its name in the variable map.\n   *\n   * @param variable Variable to rename.\n   * @param newName New variable name.\n   * @internal\n   */\n  renameVariable(variable: VariableModel, newName: string) {\n    if (variable.name === newName) return;\n    const type = variable.type;\n    const conflictVar = this.getVariable(newName, type);\n    const blocks = this.workspace.getAllBlocks(false);\n    eventUtils.setGroup(true);\n    try {\n      // The IDs may match if the rename is a simple case change (name1 ->\n      // Name1).\n      if (!conflictVar || conflictVar.getId() === variable.getId()) {\n        this.renameVariableAndUses_(variable, newName, blocks);\n      } else {\n        this.renameVariableWithConflict_(\n            variable, newName, conflictVar, blocks);\n      }\n    } finally {\n      eventUtils.setGroup(false);\n    }\n  }\n\n  /**\n   * Rename a variable by updating its name in the variable map. Identify the\n   * variable to rename with the given ID.\n   *\n   * @param id ID of the variable to rename.\n   * @param newName New variable name.\n   */\n  renameVariableById(id: string, newName: string) {\n    const variable = this.getVariableById(id);\n    if (!variable) {\n      throw Error('Tried to rename a variable that didn\\'t exist. ID: ' + id);\n    }\n\n    this.renameVariable(variable, newName);\n  }\n\n  /**\n   * Update the name of the given variable and refresh all references to it.\n   * The new name must not conflict with any existing variable names.\n   *\n   * @param variable Variable to rename.\n   * @param newName New variable name.\n   * @param blocks The list of all blocks in the workspace.\n   */\n  private renameVariableAndUses_(\n      variable: VariableModel, newName: string, blocks: Block[]) {\n    eventUtils.fire(\n        new (eventUtils.get(eventUtils.VAR_RENAME))(variable, newName));\n    variable.name = newName;\n    for (let i = 0; i < blocks.length; i++) {\n      blocks[i].updateVarName(variable);\n    }\n  }\n\n  /**\n   * Update the name of the given variable to the same name as an existing\n   * variable.  The two variables are coalesced into a single variable with the\n   * ID of the existing variable that was already using newName. Refresh all\n   * references to the variable.\n   *\n   * @param variable Variable to rename.\n   * @param newName New variable name.\n   * @param conflictVar The variable that was already using newName.\n   * @param blocks The list of all blocks in the workspace.\n   */\n  private renameVariableWithConflict_(\n      variable: VariableModel, newName: string, conflictVar: VariableModel,\n      blocks: Block[]) {\n    const type = variable.type;\n    const oldCase = conflictVar.name;\n\n    if (newName !== oldCase) {\n      // Simple rename to change the case and update references.\n      this.renameVariableAndUses_(conflictVar, newName, blocks);\n    }\n\n    // These blocks now refer to a different variable.\n    // These will fire change events.\n    for (let i = 0; i < blocks.length; i++) {\n      blocks[i].renameVarById(variable.getId(), conflictVar.getId());\n    }\n    // Finally delete the original variable, which is now unreferenced.\n    eventUtils.fire(new (eventUtils.get(eventUtils.VAR_DELETE))(variable));\n    // And remove it from the list.\n    arrayUtils.removeElem(this.variableMap.get(type)!, variable);\n  }\n  /* End functions for renaming variables. */\n  /**\n   * Create a variable with a given name, optional type, and optional ID.\n   *\n   * @param name The name of the variable. This must be unique across variables\n   *     and procedures.\n   * @param opt_type The type of the variable like 'int' or 'string'.\n   *     Does not need to be unique. Field_variable can filter variables based\n   * on their type. This will default to '' which is a specific type.\n   * @param opt_id The unique ID of the variable. This will default to a UUID.\n   * @returns The newly created variable.\n   */\n  createVariable(name: string, opt_type?: string|null, opt_id?: string|null):\n      VariableModel {\n    let variable = this.getVariable(name, opt_type);\n    if (variable) {\n      if (opt_id && variable.getId() !== opt_id) {\n        throw Error(\n            'Variable \"' + name + '\" is already in use and its id is \"' +\n            variable.getId() + '\" which conflicts with the passed in ' +\n            'id, \"' + opt_id + '\".');\n      }\n      // The variable already exists and has the same ID.\n      return variable;\n    }\n    if (opt_id && this.getVariableById(opt_id)) {\n      throw Error('Variable id, \"' + opt_id + '\", is already in use.');\n    }\n    const id = opt_id || idGenerator.genUid();\n    const type = opt_type || '';\n    variable = new VariableModel(this.workspace, name, type, id);\n\n    const variables = this.variableMap.get(type) || [];\n    variables.push(variable);\n    // Delete the list of variables of this type, and re-add it so that\n    // the most recent addition is at the end.\n    // This is used so the toolbox's set block is set to the most recent\n    // variable.\n    this.variableMap.delete(type);\n    this.variableMap.set(type, variables);\n\n    eventUtils.fire(new (eventUtils.get(eventUtils.VAR_CREATE))(variable));\n\n    return variable;\n  }\n  /* Begin functions for variable deletion. */\n  /**\n   * Delete a variable.\n   *\n   * @param variable Variable to delete.\n   */\n  deleteVariable(variable: VariableModel) {\n    const variableId = variable.getId();\n    const variableList = this.variableMap.get(variable.type);\n    if (variableList) {\n      for (let i = 0; i < variableList.length; i++) {\n        const tempVar = variableList[i];\n        if (tempVar.getId() === variableId) {\n          variableList.splice(i, 1);\n          eventUtils.fire(\n              new (eventUtils.get(eventUtils.VAR_DELETE))(variable));\n          return;\n        }\n      }\n    }\n  }\n\n  /**\n   * Delete a variables by the passed in ID and all of its uses from this\n   * workspace. May prompt the user for confirmation.\n   *\n   * @param id ID of variable to delete.\n   */\n  deleteVariableById(id: string) {\n    const variable = this.getVariableById(id);\n    if (variable) {\n      // Check whether this variable is a function parameter before deleting.\n      const variableName = variable.name;\n      const uses = this.getVariableUsesById(id);\n      for (let i = 0, block; block = uses[i]; i++) {\n        if (block.type === 'procedures_defnoreturn' ||\n            block.type === 'procedures_defreturn') {\n          const procedureName = String(block.getFieldValue('NAME'));\n          const deleteText = Msg['CANNOT_DELETE_VARIABLE_PROCEDURE']\n                                 .replace('%1', variableName)\n                                 .replace('%2', procedureName);\n          dialog.alert(deleteText);\n          return;\n        }\n      }\n\n      if (uses.length > 1) {\n        // Confirm before deleting multiple blocks.\n        const confirmText = Msg['DELETE_VARIABLE_CONFIRMATION']\n                                .replace('%1', String(uses.length))\n                                .replace('%2', variableName);\n        dialog.confirm(confirmText, (ok) => {\n          if (ok && variable) {\n            this.deleteVariableInternal(variable, uses);\n          }\n        });\n      } else {\n        // No confirmation necessary for a single block.\n        this.deleteVariableInternal(variable, uses);\n      }\n    } else {\n      console.warn('Can\\'t delete non-existent variable: ' + id);\n    }\n  }\n\n  /**\n   * Deletes a variable and all of its uses from this workspace without asking\n   * the user for confirmation.\n   *\n   * @param variable Variable to delete.\n   * @param uses An array of uses of the variable.\n   * @internal\n   */\n  deleteVariableInternal(variable: VariableModel, uses: Block[]) {\n    const existingGroup = eventUtils.getGroup();\n    if (!existingGroup) {\n      eventUtils.setGroup(true);\n    }\n    try {\n      for (let i = 0; i < uses.length; i++) {\n        uses[i].dispose(true);\n      }\n      this.deleteVariable(variable);\n    } finally {\n      if (!existingGroup) {\n        eventUtils.setGroup(false);\n      }\n    }\n  }\n  /* End functions for variable deletion. */\n  /**\n   * Find the variable by the given name and type and return it.  Return null if\n   *     it is not found.\n   *\n   * @param name The name to check for.\n   * @param opt_type The type of the variable.  If not provided it defaults to\n   *     the empty string, which is a specific type.\n   * @returns The variable with the given name, or null if it was not found.\n   */\n  getVariable(name: string, opt_type?: string|null): VariableModel|null {\n    const type = opt_type || '';\n    const list = this.variableMap.get(type);\n    if (list) {\n      for (let j = 0, variable; variable = list[j]; j++) {\n        if (Names.equals(variable.name, name)) {\n          return variable;\n        }\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Find the variable by the given ID and return it.  Return null if not found.\n   *\n   * @param id The ID to check for.\n   * @returns The variable with the given ID.\n   */\n  getVariableById(id: string): VariableModel|null {\n    for (const [_key, variables] of this.variableMap) {\n      for (const variable of variables) {\n        if (variable.getId() === id) {\n          return variable;\n        }\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Get a list containing all of the variables of a specified type. If type is\n   *     null, return list of variables with empty string type.\n   *\n   * @param type Type of the variables to find.\n   * @returns The sought after variables of the passed in type. An empty array\n   *     if none are found.\n   */\n  getVariablesOfType(type: string|null): VariableModel[] {\n    type = type || '';\n    const variableList = this.variableMap.get(type);\n    if (variableList) {\n      return variableList.slice();\n    }\n    return [];\n  }\n\n  /**\n   * Return all variable and potential variable types.  This list always\n   * contains the empty string.\n   *\n   * @param ws The workspace used to look for potential variables. This can be\n   *     different than the workspace stored on this object if the passed in ws\n   *     is a flyout workspace.\n   * @returns List of variable types.\n   * @internal\n   */\n  getVariableTypes(ws: Workspace|null): string[] {\n    const variableTypes = new Set<string>(this.variableMap.keys());\n    if (ws && ws.getPotentialVariableMap()) {\n      for (const key of ws.getPotentialVariableMap()!.variableMap.keys()) {\n        variableTypes.add(key);\n      }\n    }\n    if (!variableTypes.has('')) {\n      variableTypes.add('');\n    }\n    return Array.from(variableTypes.values());\n  }\n\n  /**\n   * Return all variables of all types.\n   *\n   * @returns List of variable models.\n   */\n  getAllVariables(): VariableModel[] {\n    let allVariables: VariableModel[] = [];\n    for (const variables of this.variableMap.values()) {\n      allVariables = allVariables.concat(variables);\n    }\n    return allVariables;\n  }\n\n  /**\n   * Returns all of the variable names of all types.\n   *\n   * @returns All of the variable names of all types.\n   */\n  getAllVariableNames(): string[] {\n    return Array.from(this.variableMap.values())\n        .flat()\n        .map((variable) => variable.name);\n  }\n\n  /**\n   * Find all the uses of a named variable.\n   *\n   * @param id ID of the variable to find.\n   * @returns Array of block usages.\n   */\n  getVariableUsesById(id: string): Block[] {\n    const uses = [];\n    const blocks = this.workspace.getAllBlocks(false);\n    // Iterate through every block and check the name.\n    for (let i = 0; i < blocks.length; i++) {\n      const blockVariables = blocks[i].getVarModels();\n      if (blockVariables) {\n        for (let j = 0; j < blockVariables.length; j++) {\n          if (blockVariables[j].getId() === id) {\n            uses.push(blocks[i]);\n          }\n        }\n      }\n    }\n    return uses;\n  }\n}\n","/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing a workspace.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Workspace');\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './connection_checker.js';\n\nimport type {Block} from './block.js';\nimport type {BlocklyOptions} from './blockly_options.js';\nimport type {ConnectionDB} from './connection_db.js';\nimport type {Abstract} from './events/events_abstract.js';\nimport * as common from './common.js';\nimport * as eventUtils from './events/utils.js';\nimport type {IASTNodeLocation} from './interfaces/i_ast_node_location.js';\nimport type {IConnectionChecker} from './interfaces/i_connection_checker.js';\nimport {Options} from './options.js';\nimport * as registry from './registry.js';\nimport * as arrayUtils from './utils/array.js';\nimport * as idGenerator from './utils/idgenerator.js';\nimport * as math from './utils/math.js';\nimport type * as toolbox from './utils/toolbox.js';\nimport {VariableMap} from './variable_map.js';\nimport type {VariableModel} from './variable_model.js';\nimport type {WorkspaceComment} from './workspace_comment.js';\nimport {IProcedureMap} from './interfaces/i_procedure_map.js';\nimport {ObservableProcedureMap} from './procedures.js';\n\n\n/**\n * Class for a workspace.  This is a data structure that contains blocks.\n * There is no UI, and can be created headlessly.\n *\n * @alias Blockly.Workspace\n */\nexport class Workspace implements IASTNodeLocation {\n  /**\n   * Angle away from the horizontal to sweep for blocks.  Order of execution is\n   * generally top to bottom, but a small angle changes the scan to give a bit\n   * of a left to right bias (reversed in RTL).  Units are in degrees. See:\n   * https://tvtropes.org/pmwiki/pmwiki.php/Main/DiagonalBilling\n   */\n  static SCAN_ANGLE = 3;\n  id: string;\n  options: Options;\n  RTL: boolean;\n  horizontalLayout: boolean;\n  toolboxPosition: toolbox.Position;\n\n  /**\n   * Returns `true` if the workspace is visible and `false` if it's headless.\n   */\n  rendered = false;\n\n  /**\n   * Is this workspace the surface for a flyout?\n   *\n   * @internal\n   */\n  internalIsFlyout = false;\n\n  /** Is this workspace the surface for a flyout? */\n  get isFlyout(): boolean {\n    return this.internalIsFlyout;\n  }\n\n  /**\n   * Is this workspace the surface for a mutator?\n   *\n   * @internal\n   */\n  internalIsMutator = false;\n\n  /** Is this workspace the surface for a mutator? */\n  get isMutator(): boolean {\n    return this.internalIsMutator;\n  }\n\n  /**\n   * Returns `true` if the workspace is currently in the process of a bulk\n   * clear.\n   *\n   * @internal\n   */\n  isClearing = false;\n\n  /**\n   * Maximum number of undo events in stack. `0` turns off undo, `Infinity`\n   * sets it to unlimited.\n   */\n  MAX_UNDO = 1024;\n\n  /** Set of databases for rapid lookup of connection locations. */\n  connectionDBList: ConnectionDB[] = [];\n  connectionChecker: IConnectionChecker;\n\n  private readonly topBlocks: Block[] = [];\n  private readonly topComments: WorkspaceComment[] = [];\n  private readonly commentDB = new Map<string, WorkspaceComment>();\n  private readonly listeners: Function[] = [];\n  protected undoStack_: Abstract[] = [];\n  protected redoStack_: Abstract[] = [];\n  private readonly blockDB = new Map<string, Block>();\n  private readonly typedBlocksDB = new Map<string, Block[]>();\n  private variableMap: VariableMap;\n  private procedureMap: IProcedureMap = new ObservableProcedureMap(this);\n\n  /**\n   * Blocks in the flyout can refer to variables that don't exist in the main\n   * workspace.  For instance, the \"get item in list\" block refers to an\n   * \"item\" variable regardless of whether the variable has been created yet.\n   * A FieldVariable must always refer to a VariableModel.  We reconcile\n   * these by tracking \"potential\" variables in the flyout.  These variables\n   * become real when references to them are dragged into the main workspace.\n   */\n  private potentialVariableMap: VariableMap|null = null;\n\n  /** @param opt_options Dictionary of options. */\n  constructor(opt_options?: Options) {\n    this.id = idGenerator.genUid();\n    common.registerWorkspace(this);\n    this.options = opt_options || new Options(({} as BlocklyOptions));\n    this.RTL = !!this.options.RTL;\n    this.horizontalLayout = !!this.options.horizontalLayout;\n    this.toolboxPosition = this.options.toolboxPosition;\n\n    const connectionCheckerClass = registry.getClassFromOptions(\n        registry.Type.CONNECTION_CHECKER, this.options, true);\n    /**\n     * An object that encapsulates logic for safety, type, and dragging checks.\n     */\n    this.connectionChecker = new connectionCheckerClass!(this);\n\n    /**\n     * A map from variable type to list of variable names.  The lists contain\n     * all of the named variables in the workspace, including variables that are\n     * not currently in use.\n     */\n    this.variableMap = new VariableMap(this);\n  }\n\n  /**\n   * Dispose of this workspace.\n   * Unlink from all DOM elements to prevent memory leaks.\n   *\n   * @suppress {checkTypes}\n   */\n  dispose() {\n    this.listeners.length = 0;\n    this.clear();\n    // Remove from workspace database.\n    common.unregisterWorkpace(this);\n  }\n\n  /**\n   * Compare function for sorting objects (blocks, comments, etc) by position;\n   *    top to bottom (with slight LTR or RTL bias).\n   *\n   * @param a The first object to compare.\n   * @param b The second object to compare.\n   * @returns The comparison value. This tells Array.sort() how to change object\n   *     a's index.\n   */\n  private sortObjects_(a: Block|WorkspaceComment, b: Block|WorkspaceComment):\n      number {\n    // AnyDuringMigration because:  Property 'getRelativeToSurfaceXY' does not\n    // exist on type 'Block | WorkspaceComment'.\n    const aXY = (a as AnyDuringMigration).getRelativeToSurfaceXY();\n    // AnyDuringMigration because:  Property 'getRelativeToSurfaceXY' does not\n    // exist on type 'Block | WorkspaceComment'.\n    const bXY = (b as AnyDuringMigration).getRelativeToSurfaceXY();\n    // AnyDuringMigration because:  Property 'offset' does not exist on type\n    // '(a: Block | WorkspaceComment, b: Block | WorkspaceComment) => number'.\n    // AnyDuringMigration because:  Property 'offset' does not exist on type\n    // '(a: Block | WorkspaceComment, b: Block | WorkspaceComment) => number'.\n    return aXY.y +\n        (Workspace.prototype.sortObjects_ as AnyDuringMigration).offset *\n        aXY.x -\n        (bXY.y +\n         (Workspace.prototype.sortObjects_ as AnyDuringMigration).offset *\n             bXY.x);\n  }\n\n  /**\n   * Adds a block to the list of top blocks.\n   *\n   * @param block Block to add.\n   */\n  addTopBlock(block: Block) {\n    this.topBlocks.push(block);\n  }\n\n  /**\n   * Removes a block from the list of top blocks.\n   *\n   * @param block Block to remove.\n   */\n  removeTopBlock(block: Block) {\n    if (!arrayUtils.removeElem(this.topBlocks, block)) {\n      throw Error('Block not present in workspace\\'s list of top-most blocks.');\n    }\n  }\n\n  /**\n   * Finds the top-level blocks and returns them.  Blocks are optionally sorted\n   * by position; top to bottom (with slight LTR or RTL bias).\n   *\n   * @param ordered Sort the list if true.\n   * @returns The top-level block objects.\n   */\n  getTopBlocks(ordered: boolean): Block[] {\n    // Copy the topBlocks list.\n    const blocks = (new Array<Block>()).concat(this.topBlocks);\n    if (ordered && blocks.length > 1) {\n      // AnyDuringMigration because:  Property 'offset' does not exist on type\n      // '(a: Block | WorkspaceComment, b: Block | WorkspaceComment) => number'.\n      (this.sortObjects_ as AnyDuringMigration).offset =\n          Math.sin(math.toRadians(Workspace.SCAN_ANGLE));\n      if (this.RTL) {\n        // AnyDuringMigration because:  Property 'offset' does not exist on type\n        // '(a: Block | WorkspaceComment, b: Block | WorkspaceComment) =>\n        // number'.\n        (this.sortObjects_ as AnyDuringMigration).offset *= -1;\n      }\n      blocks.sort(this.sortObjects_);\n    }\n    return blocks;\n  }\n\n  /**\n   * Add a block to the list of blocks keyed by type.\n   *\n   * @param block Block to add.\n   */\n  addTypedBlock(block: Block) {\n    if (!this.typedBlocksDB.has(block.type)) {\n      this.typedBlocksDB.set(block.type, []);\n    }\n    this.typedBlocksDB.get(block.type)!.push(block);\n  }\n\n  /**\n   * Remove a block from the list of blocks keyed by type.\n   *\n   * @param block Block to remove.\n   */\n  removeTypedBlock(block: Block) {\n    arrayUtils.removeElem(this.typedBlocksDB.get(block.type)!, block);\n    if (!this.typedBlocksDB.get(block.type)!.length) {\n      this.typedBlocksDB.delete(block.type);\n    }\n  }\n\n  /**\n   * Finds the blocks with the associated type and returns them. Blocks are\n   * optionally sorted by position; top to bottom (with slight LTR or RTL bias).\n   *\n   * @param type The type of block to search for.\n   * @param ordered Sort the list if true.\n   * @returns The blocks of the given type.\n   */\n  getBlocksByType(type: string, ordered: boolean): Block[] {\n    if (!this.typedBlocksDB.has(type)) {\n      return [];\n    }\n    const blocks = this.typedBlocksDB.get(type)!.slice(0);\n    if (ordered && blocks && blocks.length > 1) {\n      // AnyDuringMigration because:  Property 'offset' does not exist on type\n      // '(a: Block | WorkspaceComment, b: Block | WorkspaceComment) => number'.\n      (this.sortObjects_ as AnyDuringMigration).offset =\n          Math.sin(math.toRadians(Workspace.SCAN_ANGLE));\n      if (this.RTL) {\n        // AnyDuringMigration because:  Property 'offset' does not exist on type\n        // '(a: Block | WorkspaceComment, b: Block | WorkspaceComment) =>\n        // number'.\n        (this.sortObjects_ as AnyDuringMigration).offset *= -1;\n      }\n      blocks.sort(this.sortObjects_);\n    }\n\n    return blocks.filter(function(block: AnyDuringMigration) {\n      return !block.isInsertionMarker();\n    });\n  }\n\n  /**\n   * Adds a comment to the list of top comments.\n   *\n   * @param comment comment to add.\n   * @internal\n   */\n  addTopComment(comment: WorkspaceComment) {\n    this.topComments.push(comment);\n\n    // Note: If the comment database starts to hold block comments, this may\n    // need to move to a separate function.\n    if (this.commentDB.has(comment.id)) {\n      console.warn(\n          'Overriding an existing comment on this workspace, with id \"' +\n          comment.id + '\"');\n    }\n    this.commentDB.set(comment.id, comment);\n  }\n\n  /**\n   * Removes a comment from the list of top comments.\n   *\n   * @param comment comment to remove.\n   * @internal\n   */\n  removeTopComment(comment: WorkspaceComment) {\n    if (!arrayUtils.removeElem(this.topComments, comment)) {\n      throw Error(\n          'Comment not present in workspace\\'s list of top-most ' +\n          'comments.');\n    }\n    // Note: If the comment database starts to hold block comments, this may\n    // need to move to a separate function.\n    this.commentDB.delete(comment.id);\n  }\n\n  /**\n   * Finds the top-level comments and returns them.  Comments are optionally\n   * sorted by position; top to bottom (with slight LTR or RTL bias).\n   *\n   * @param ordered Sort the list if true.\n   * @returns The top-level comment objects.\n   * @internal\n   */\n  getTopComments(ordered: boolean): WorkspaceComment[] {\n    // Copy the topComments list.\n    const comments = (new Array<WorkspaceComment>()).concat(this.topComments);\n    if (ordered && comments.length > 1) {\n      // AnyDuringMigration because:  Property 'offset' does not exist on type\n      // '(a: Block | WorkspaceComment, b: Block | WorkspaceComment) => number'.\n      (this.sortObjects_ as AnyDuringMigration).offset =\n          Math.sin(math.toRadians(Workspace.SCAN_ANGLE));\n      if (this.RTL) {\n        // AnyDuringMigration because:  Property 'offset' does not exist on type\n        // '(a: Block | WorkspaceComment, b: Block | WorkspaceComment) =>\n        // number'.\n        (this.sortObjects_ as AnyDuringMigration).offset *= -1;\n      }\n      comments.sort(this.sortObjects_);\n    }\n    return comments;\n  }\n\n  /**\n   * Find all blocks in workspace.  Blocks are optionally sorted\n   * by position; top to bottom (with slight LTR or RTL bias).\n   *\n   * @param ordered Sort the list if true.\n   * @returns Array of blocks.\n   */\n  getAllBlocks(ordered: boolean): Block[] {\n    let blocks: AnyDuringMigration[];\n    if (ordered) {\n      // Slow, but ordered.\n      const topBlocks = this.getTopBlocks(true);\n      blocks = [];\n      for (let i = 0; i < topBlocks.length; i++) {\n        blocks.push(...topBlocks[i].getDescendants(true));\n      }\n    } else {\n      // Fast, but in no particular order.\n      blocks = this.getTopBlocks(false);\n      for (let i = 0; i < blocks.length; i++) {\n        blocks.push(...blocks[i].getChildren(false));\n      }\n    }\n\n    // Insertion markers exist on the workspace for rendering reasons, but\n    // aren't \"real\" blocks from a developer perspective.\n    const filtered = blocks.filter(function(block) {\n      return !block.isInsertionMarker();\n    });\n\n    return filtered;\n  }\n\n  /** Dispose of all blocks and comments in workspace. */\n  clear() {\n    this.isClearing = true;\n    try {\n      const existingGroup = eventUtils.getGroup();\n      if (!existingGroup) {\n        eventUtils.setGroup(true);\n      }\n      while (this.topBlocks.length) {\n        this.topBlocks[0].dispose(false);\n      }\n      while (this.topComments.length) {\n        this.topComments[this.topComments.length - 1].dispose();\n      }\n      if (!existingGroup) {\n        eventUtils.setGroup(false);\n      }\n      this.variableMap.clear();\n      if (this.potentialVariableMap) {\n        this.potentialVariableMap.clear();\n      }\n    } finally {\n      this.isClearing = false;\n    }\n  }\n\n  /* Begin functions that are just pass-throughs to the variable map. */\n  /**\n   * Rename a variable by updating its name in the variable map. Identify the\n   * variable to rename with the given ID.\n   *\n   * @param id ID of the variable to rename.\n   * @param newName New variable name.\n   */\n  renameVariableById(id: string, newName: string) {\n    this.variableMap.renameVariableById(id, newName);\n  }\n\n  /**\n   * Create a variable with a given name, optional type, and optional ID.\n   *\n   * @param name The name of the variable. This must be unique across variables\n   *     and procedures.\n   * @param opt_type The type of the variable like 'int' or 'string'.\n   *     Does not need to be unique. Field_variable can filter variables based\n   * on their type. This will default to '' which is a specific type.\n   * @param opt_id The unique ID of the variable. This will default to a UUID.\n   * @returns The newly created variable.\n   */\n  createVariable(name: string, opt_type?: string|null, opt_id?: string|null):\n      VariableModel {\n    return this.variableMap.createVariable(name, opt_type, opt_id);\n  }\n\n  /**\n   * Find all the uses of the given variable, which is identified by ID.\n   *\n   * @param id ID of the variable to find.\n   * @returns Array of block usages.\n   */\n  getVariableUsesById(id: string): Block[] {\n    return this.variableMap.getVariableUsesById(id);\n  }\n\n  /**\n   * Delete a variables by the passed in ID and all of its uses from this\n   * workspace. May prompt the user for confirmation.\n   *\n   * @param id ID of variable to delete.\n   */\n  deleteVariableById(id: string) {\n    this.variableMap.deleteVariableById(id);\n  }\n\n  /**\n   * Find the variable by the given name and return it. Return null if not\n   * found.\n   *\n   * @param name The name to check for.\n   * @param opt_type The type of the variable.  If not provided it defaults to\n   *     the empty string, which is a specific type.\n   * @returns The variable with the given name.\n   */\n  getVariable(name: string, opt_type?: string): VariableModel|null {\n    // TODO (#1559): Possibly delete this function after resolving #1559.\n    return this.variableMap.getVariable(name, opt_type);\n  }\n\n  /**\n   * Find the variable by the given ID and return it. Return null if not found.\n   *\n   * @param id The ID to check for.\n   * @returns The variable with the given ID.\n   */\n  getVariableById(id: string): VariableModel|null {\n    return this.variableMap.getVariableById(id);\n  }\n\n  /**\n   * Find the variable with the specified type. If type is null, return list of\n   *     variables with empty string type.\n   *\n   * @param type Type of the variables to find.\n   * @returns The sought after variables of the passed in type. An empty array\n   *     if none are found.\n   */\n  getVariablesOfType(type: string|null): VariableModel[] {\n    return this.variableMap.getVariablesOfType(type);\n  }\n\n  /**\n   * Return all variable types.\n   *\n   * @returns List of variable types.\n   * @internal\n   */\n  getVariableTypes(): string[] {\n    return this.variableMap.getVariableTypes(this);\n  }\n\n  /**\n   * Return all variables of all types.\n   *\n   * @returns List of variable models.\n   */\n  getAllVariables(): VariableModel[] {\n    return this.variableMap.getAllVariables();\n  }\n\n  /**\n   * Returns all variable names of all types.\n   *\n   * @returns List of all variable names of all types.\n   */\n  getAllVariableNames(): string[] {\n    return this.variableMap.getAllVariableNames();\n  }\n  /* End functions that are just pass-throughs to the variable map. */\n  /**\n   * Returns the horizontal offset of the workspace.\n   * Intended for LTR/RTL compatibility in XML.\n   * Not relevant for a headless workspace.\n   *\n   * @returns Width.\n   */\n  getWidth(): number {\n    return 0;\n  }\n\n  /* eslint-disable jsdoc/require-returns-check */\n  /* eslint-disable @typescript-eslint/no-unused-vars */\n  /**\n   * Obtain a newly created block.\n   *\n   * @param prototypeName Name of the language object containing type-specific\n   *     functions for this block.\n   * @param opt_id Optional ID.  Use this ID if provided, otherwise create a new\n   *     ID.\n   * @returns The created block.\n   */\n  newBlock(prototypeName: string, opt_id?: string): Block {\n    throw new Error(\n        'The implementation of newBlock should be ' +\n        'monkey-patched in by blockly.ts');\n  }\n  /* eslint-enable */\n\n  /**\n   * The number of blocks that may be added to the workspace before reaching\n   *     the maxBlocks.\n   *\n   * @returns Number of blocks left.\n   */\n  remainingCapacity(): number {\n    if (isNaN(this.options.maxBlocks)) {\n      return Infinity;\n    }\n\n    return this.options.maxBlocks - this.getAllBlocks(false).length;\n  }\n\n  /**\n   * The number of blocks of the given type that may be added to the workspace\n   *    before reaching the maxInstances allowed for that type.\n   *\n   * @param type Type of block to return capacity for.\n   * @returns Number of blocks of type left.\n   */\n  remainingCapacityOfType(type: string): number {\n    if (!this.options.maxInstances) {\n      return Infinity;\n    }\n\n    const maxInstanceOfType = this.options.maxInstances[type] !== undefined ?\n        this.options.maxInstances[type] :\n        Infinity;\n\n    return maxInstanceOfType - this.getBlocksByType(type, false).length;\n  }\n\n  /**\n   * Check if there is remaining capacity for blocks of the given counts to be\n   *    created. If the total number of blocks represented by the map is more\n   * than the total remaining capacity, it returns false. If a type count is\n   * more than the remaining capacity for that type, it returns false.\n   *\n   * @param typeCountsMap A map of types to counts (usually representing blocks\n   *     to be created).\n   * @returns True if there is capacity for the given map, false otherwise.\n   */\n  isCapacityAvailable(typeCountsMap: AnyDuringMigration): boolean {\n    if (!this.hasBlockLimits()) {\n      return true;\n    }\n    let copyableBlocksCount = 0;\n    for (const type in typeCountsMap) {\n      if (typeCountsMap[type] > this.remainingCapacityOfType(type)) {\n        return false;\n      }\n      copyableBlocksCount += typeCountsMap[type];\n    }\n    if (copyableBlocksCount > this.remainingCapacity()) {\n      return false;\n    }\n    return true;\n  }\n\n  /**\n   * Checks if the workspace has any limits on the maximum number of blocks,\n   *    or the maximum number of blocks of specific types.\n   *\n   * @returns True if it has block limits, false otherwise.\n   */\n  hasBlockLimits(): boolean {\n    return this.options.maxBlocks !== Infinity || !!this.options.maxInstances;\n  }\n\n  /**\n   * Gets the undo stack for workplace.\n   *\n   * @returns undo stack\n   * @internal\n   */\n  getUndoStack(): Abstract[] {\n    return this.undoStack_;\n  }\n\n  /**\n   * Gets the redo stack for workplace.\n   *\n   * @returns redo stack\n   * @internal\n   */\n  getRedoStack(): Abstract[] {\n    return this.redoStack_;\n  }\n\n  /**\n   * Undo or redo the previous action.\n   *\n   * @param redo False if undo, true if redo.\n   */\n  undo(redo: boolean) {\n    const inputStack = redo ? this.redoStack_ : this.undoStack_;\n    const outputStack = redo ? this.undoStack_ : this.redoStack_;\n    const inputEvent = inputStack.pop();\n    if (!inputEvent) {\n      return;\n    }\n    let events = [inputEvent];\n    // Do another undo/redo if the next one is of the same group.\n    while (inputStack.length && inputEvent.group &&\n           inputEvent.group === inputStack[inputStack.length - 1].group) {\n      // AnyDuringMigration because:  Argument of type 'Abstract | undefined' is\n      // not assignable to parameter of type 'Abstract'.\n      events.push(inputStack.pop() as AnyDuringMigration);\n    }\n    // Push these popped events on the opposite stack.\n    for (let i = 0; i < events.length; i++) {\n      const event = events[i];\n      outputStack.push(event);\n    }\n    events = eventUtils.filter(events, redo);\n    eventUtils.setRecordUndo(false);\n    try {\n      for (let i = 0; i < events.length; i++) {\n        const event = events[i];\n        event.run(redo);\n      }\n    } finally {\n      eventUtils.setRecordUndo(true);\n    }\n  }\n\n  /** Clear the undo/redo stacks. */\n  clearUndo() {\n    this.undoStack_.length = 0;\n    this.redoStack_.length = 0;\n    // Stop any events already in the firing queue from being undoable.\n    eventUtils.clearPendingUndo();\n  }\n\n  /**\n   * When something in this workspace changes, call a function.\n   * Note that there may be a few recent events already on the stack.  Thus the\n   * new change listener might be called with events that occurred a few\n   * milliseconds before the change listener was added.\n   *\n   * @param func Function to call.\n   * @returns Obsolete return value, ignore.\n   */\n  addChangeListener(func: Function): Function {\n    this.listeners.push(func);\n    return func;\n  }\n\n  /**\n   * Stop listening for this workspace's changes.\n   *\n   * @param func Function to stop calling.\n   */\n  removeChangeListener(func: Function) {\n    arrayUtils.removeElem(this.listeners, func);\n  }\n\n  /**\n   * Fire a change event.\n   *\n   * @param event Event to fire.\n   */\n  fireChangeListener(event: Abstract) {\n    if (event.recordUndo) {\n      this.undoStack_.push(event);\n      this.redoStack_.length = 0;\n      while (this.undoStack_.length > this.MAX_UNDO && this.MAX_UNDO >= 0) {\n        this.undoStack_.shift();\n      }\n    }\n    for (let i = 0; i < this.listeners.length; i++) {\n      const func = this.listeners[i];\n      func(event);\n    }\n  }\n\n  /**\n   * Find the block on this workspace with the specified ID.\n   *\n   * @param id ID of block to find.\n   * @returns The sought after block, or null if not found.\n   */\n  getBlockById(id: string): Block|null {\n    return this.blockDB.get(id) || null;\n  }\n\n  /**\n   * Set a block on this workspace with the specified ID.\n   *\n   * @param id ID of block to set.\n   * @param block The block to set.\n   * @internal\n   */\n  setBlockById(id: string, block: Block) {\n    this.blockDB.set(id, block);\n  }\n\n  /**\n   * Delete a block off this workspace with the specified ID.\n   *\n   * @param id ID of block to delete.\n   * @internal\n   */\n  removeBlockById(id: string) {\n    this.blockDB.delete(id);\n  }\n\n  /**\n   * Find the comment on this workspace with the specified ID.\n   *\n   * @param id ID of comment to find.\n   * @returns The sought after comment, or null if not found.\n   * @internal\n   */\n  getCommentById(id: string): WorkspaceComment|null {\n    return this.commentDB.get(id) ?? null;\n  }\n\n  /**\n   * Checks whether all value and statement inputs in the workspace are filled\n   * with blocks.\n   *\n   * @param opt_shadowBlocksAreFilled An optional argument controlling whether\n   *     shadow blocks are counted as filled. Defaults to true.\n   * @returns True if all inputs are filled, false otherwise.\n   */\n  allInputsFilled(opt_shadowBlocksAreFilled?: boolean): boolean {\n    const blocks = this.getTopBlocks(false);\n    for (let i = 0; i < blocks.length; i++) {\n      const block = blocks[i];\n      if (!block.allInputsFilled(opt_shadowBlocksAreFilled)) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  /**\n   * Return the variable map that contains \"potential\" variables.\n   * These exist in the flyout but not in the workspace.\n   *\n   * @returns The potential variable map.\n   * @internal\n   */\n  getPotentialVariableMap(): VariableMap|null {\n    return this.potentialVariableMap;\n  }\n\n  /**\n   * Create and store the potential variable map for this workspace.\n   *\n   * @internal\n   */\n  createPotentialVariableMap() {\n    this.potentialVariableMap = new VariableMap(this);\n  }\n\n  /**\n   * Return the map of all variables on the workspace.\n   *\n   * @returns The variable map.\n   */\n  getVariableMap(): VariableMap {\n    return this.variableMap;\n  }\n\n  /**\n   * Set the map of all variables on the workspace.\n   *\n   * @param variableMap The variable map.\n   * @internal\n   */\n  setVariableMap(variableMap: VariableMap) {\n    this.variableMap = variableMap;\n  }\n\n  /** Returns the map of all procedures on the workpace. */\n  getProcedureMap(): IProcedureMap {\n    return this.procedureMap;\n  }\n\n  /**\n   * Find the workspace with the specified ID.\n   *\n   * @param id ID of workspace to find.\n   * @returns The sought after workspace or null if not found.\n   */\n  static getById(id: string): Workspace|null {\n    return common.getWorkspaceById(id);\n  }\n\n  /**\n   * Find all workspaces.\n   *\n   * @returns Array of workspaces.\n   */\n  static getAll(): Workspace[] {\n    return common.getAllWorkspaces();\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object in charge of loading, storing, and playing audio for a\n *     workspace.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.WorkspaceAudio');\n\nimport * as userAgent from './utils/useragent.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/**\n * Prevent a sound from playing if another sound preceded it within this many\n * milliseconds.\n */\nconst SOUND_LIMIT = 100;\n\n/**\n * Class for loading, storing, and playing audio for a workspace.\n *\n * @alias Blockly.WorkspaceAudio\n */\nexport class WorkspaceAudio {\n  /** Database of pre-loaded sounds. */\n  private sounds = new Map<string, HTMLAudioElement>();\n\n  /** Time that the last sound was played. */\n  private lastSound_: Date|null = null;\n\n  /**\n   * @param parentWorkspace The parent of the workspace this audio object\n   *     belongs to, or null.\n   */\n  constructor(private parentWorkspace: WorkspaceSvg) {}\n\n  /**\n   * Dispose of this audio manager.\n   *\n   * @internal\n   */\n  dispose() {\n    this.sounds.clear();\n  }\n\n  /**\n   * Load an audio file.  Cache it, ready for instantaneous playing.\n   *\n   * @param filenames List of file types in decreasing order of preference (i.e.\n   *     increasing size).  E.g. ['media/go.mp3', 'media/go.wav'] Filenames\n   *     include path from Blockly's root.  File extensions matter.\n   * @param name Name of sound.\n   */\n  load(filenames: string[], name: string) {\n    if (!filenames.length) {\n      return;\n    }\n    let audioTest;\n    try {\n      audioTest = new globalThis['Audio']();\n    } catch (e) {\n      // No browser support for Audio.\n      // IE can throw an error even if the Audio object exists.\n      return;\n    }\n    let sound;\n    for (let i = 0; i < filenames.length; i++) {\n      const filename = filenames[i];\n      const ext = filename.match(/\\.(\\w+)$/);\n      if (ext && audioTest.canPlayType('audio/' + ext[1])) {\n        // Found an audio format we can play.\n        sound = new globalThis['Audio'](filename);\n        break;\n      }\n    }\n    if (sound) {\n      this.sounds.set(name, sound);\n    }\n  }\n\n  /**\n   * Preload all the audio files so that they play quickly when asked for.\n   *\n   * @internal\n   */\n  preload() {\n    for (const sound of this.sounds.values()) {\n      sound.volume = 0.01;\n      const playPromise = sound.play();\n      // Edge does not return a promise, so we need to check.\n      if (playPromise !== undefined) {\n        // If we don't wait for the play request to complete before calling\n        // pause() we will get an exception: (DOMException: The play() request\n        // was interrupted) See more:\n        // https://developers.google.com/web/updates/2017/06/play-request-was-interrupted\n        playPromise.then(sound.pause)\n            .catch(\n                // Play without user interaction was prevented.\n                function() {});\n      } else {\n        sound.pause();\n      }\n\n      // iOS can only process one sound at a time.  Trying to load more than one\n      // corrupts the earlier ones.  Just load one and leave the others\n      // uncached.\n      if (userAgent.IPAD || userAgent.IPHONE) {\n        break;\n      }\n    }\n  }\n\n  /**\n   * Play a named sound at specified volume.  If volume is not specified,\n   * use full volume (1).\n   *\n   * @param name Name of sound.\n   * @param opt_volume Volume of sound (0-1).\n   */\n  play(name: string, opt_volume?: number) {\n    const sound = this.sounds.get(name);\n    if (sound) {\n      // Don't play one sound on top of another.\n      const now = new Date();\n      if (this.lastSound_ !== null &&\n          now.getTime() - this.lastSound_.getTime() < SOUND_LIMIT) {\n        return;\n      }\n      this.lastSound_ = now;\n      let mySound;\n      if (userAgent.IPAD || userAgent.ANDROID) {\n        // Creating a new audio node causes lag in Android and iPad.  Android\n        // refetches the file from the server, iPad uses a singleton audio\n        // node which must be deleted and recreated for each new audio tag.\n        mySound = sound;\n      } else {\n        mySound = sound.cloneNode() as HTMLAudioElement;\n      }\n      mySound.volume = opt_volume === undefined ? 1 : opt_volume;\n      mySound.play();\n    } else if (this.parentWorkspace) {\n      // Maybe a workspace on a lower level knows about this sound.\n      this.parentWorkspace.getAudioManager().play(name, opt_volume);\n    }\n  }\n}\n","/**\n * @license\n * Copyright 2015 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing a zoom icons.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.ZoomControls');\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_click.js';\n\nimport * as browserEvents from './browser_events.js';\nimport {ComponentManager} from './component_manager.js';\nimport * as Css from './css.js';\nimport * as eventUtils from './events/utils.js';\nimport type {IPositionable} from './interfaces/i_positionable.js';\nimport type {UiMetrics} from './metrics_manager.js';\nimport * as uiPosition from './positionable_helpers.js';\nimport {SPRITE} from './sprites.js';\nimport * as Touch from './touch.js';\nimport * as dom from './utils/dom.js';\nimport {Rect} from './utils/rect.js';\nimport {Size} from './utils/size.js';\nimport {Svg} from './utils/svg.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/**\n * Class for a zoom controls.\n *\n * @alias Blockly.ZoomControls\n */\nexport class ZoomControls implements IPositionable {\n  /**\n   * The unique ID for this component that is used to register with the\n   * ComponentManager.\n   */\n  id = 'zoomControls';\n\n  /**\n   * A handle to use to unbind the mouse down event handler for zoom reset\n   *    button. Opaque data returned from browserEvents.conditionalBind.\n   */\n  private onZoomResetWrapper: browserEvents.Data|null = null;\n\n  /**\n   * A handle to use to unbind the mouse down event handler for zoom in\n   * button. Opaque data returned from browserEvents.conditionalBind.\n   */\n  private onZoomInWrapper: browserEvents.Data|null = null;\n\n  /**\n   * A handle to use to unbind the mouse down event handler for zoom out\n   * button. Opaque data returned from browserEvents.conditionalBind.\n   */\n  private onZoomOutWrapper: browserEvents.Data|null = null;\n\n  /** The zoom in svg <g> element. */\n  private zoomInGroup: SVGGElement|null = null;\n\n  /** The zoom out svg <g> element. */\n  private zoomOutGroup: SVGGElement|null = null;\n\n  /** The zoom reset svg <g> element. */\n  private zoomResetGroup: SVGGElement|null = null;\n\n  /** Width of the zoom controls. */\n  private readonly WIDTH = 32;\n\n  /** Height of each zoom control. */\n  private readonly HEIGHT = 32;\n\n  /** Small spacing used between the zoom in and out control, in pixels. */\n  private readonly SMALL_SPACING = 2;\n\n  /**\n   * Large spacing used between the zoom in and reset control, in pixels.\n   */\n  private readonly LARGE_SPACING = 11;\n\n  /** Distance between zoom controls and bottom or top edge of workspace. */\n  private readonly MARGIN_VERTICAL = 20;\n\n  /** Distance between zoom controls and right or left edge of workspace. */\n  private readonly MARGIN_HORIZONTAL = 20;\n\n  /** The SVG group containing the zoom controls. */\n  private svgGroup: SVGElement|null = null;\n\n  /** Left coordinate of the zoom controls. */\n  private left = 0;\n\n  /** Top coordinate of the zoom controls. */\n  private top = 0;\n\n  /** Whether this has been initialized. */\n  private initialized = false;\n\n  /** @param workspace The workspace to sit in. */\n  constructor(private readonly workspace: WorkspaceSvg) {}\n\n  /**\n   * Create the zoom controls.\n   *\n   * @returns The zoom controls SVG group.\n   */\n  createDom(): SVGElement {\n    this.svgGroup = dom.createSvgElement(Svg.G, {});\n\n    // Each filter/pattern needs a unique ID for the case of multiple Blockly\n    // instances on a page.  Browser behaviour becomes undefined otherwise.\n    // https://neil.fraser.name/news/2015/11/01/\n    const rnd = String(Math.random()).substring(2);\n    this.createZoomOutSvg(rnd);\n    this.createZoomInSvg(rnd);\n    if (this.workspace.isMovable()) {\n      // If we zoom to the center and the workspace isn't movable we could\n      // loose blocks at the edges of the workspace.\n      this.createZoomResetSvg(rnd);\n    }\n    return this.svgGroup;\n  }\n\n  /** Initializes the zoom controls. */\n  init() {\n    this.workspace.getComponentManager().addComponent({\n      component: this,\n      weight: 2,\n      capabilities: [ComponentManager.Capability.POSITIONABLE],\n    });\n    this.initialized = true;\n  }\n\n  /**\n   * Disposes of this zoom controls.\n   * Unlink from all DOM elements to prevent memory leaks.\n   */\n  dispose() {\n    this.workspace.getComponentManager().removeComponent('zoomControls');\n    if (this.svgGroup) {\n      dom.removeNode(this.svgGroup);\n    }\n    if (this.onZoomResetWrapper) {\n      browserEvents.unbind(this.onZoomResetWrapper);\n    }\n    if (this.onZoomInWrapper) {\n      browserEvents.unbind(this.onZoomInWrapper);\n    }\n    if (this.onZoomOutWrapper) {\n      browserEvents.unbind(this.onZoomOutWrapper);\n    }\n  }\n\n  /**\n   * Returns the bounding rectangle of the UI element in pixel units relative to\n   * the Blockly injection div.\n   *\n   * @returns The UI elements's bounding box. Null if bounding box should be\n   *     ignored by other UI elements.\n   */\n  getBoundingRectangle(): Rect|null {\n    let height = this.SMALL_SPACING + 2 * this.HEIGHT;\n    if (this.zoomResetGroup) {\n      height += this.LARGE_SPACING + this.HEIGHT;\n    }\n    const bottom = this.top + height;\n    const right = this.left + this.WIDTH;\n    return new Rect(this.top, bottom, this.left, right);\n  }\n\n  /**\n   * Positions the zoom controls.\n   * It is positioned in the opposite corner to the corner the\n   * categories/toolbox starts at.\n   *\n   * @param metrics The workspace metrics.\n   * @param savedPositions List of rectangles that are already on the workspace.\n   */\n  position(metrics: UiMetrics, savedPositions: Rect[]) {\n    // Not yet initialized.\n    if (!this.initialized) {\n      return;\n    }\n\n    const cornerPosition =\n        uiPosition.getCornerOppositeToolbox(this.workspace, metrics);\n    let height = this.SMALL_SPACING + 2 * this.HEIGHT;\n    if (this.zoomResetGroup) {\n      height += this.LARGE_SPACING + this.HEIGHT;\n    }\n    const startRect = uiPosition.getStartPositionRect(\n        cornerPosition, new Size(this.WIDTH, height), this.MARGIN_HORIZONTAL,\n        this.MARGIN_VERTICAL, metrics, this.workspace);\n\n    const verticalPosition = cornerPosition.vertical;\n    const bumpDirection = verticalPosition === uiPosition.verticalPosition.TOP ?\n        uiPosition.bumpDirection.DOWN :\n        uiPosition.bumpDirection.UP;\n    const positionRect = uiPosition.bumpPositionRect(\n        startRect, this.MARGIN_VERTICAL, bumpDirection, savedPositions);\n\n    if (verticalPosition === uiPosition.verticalPosition.TOP) {\n      const zoomInTranslateY = this.SMALL_SPACING + this.HEIGHT;\n      this.zoomInGroup?.setAttribute(\n          'transform', 'translate(0, ' + zoomInTranslateY + ')');\n      if (this.zoomResetGroup) {\n        const zoomResetTranslateY =\n            zoomInTranslateY + this.LARGE_SPACING + this.HEIGHT;\n        this.zoomResetGroup.setAttribute(\n            'transform', 'translate(0, ' + zoomResetTranslateY + ')');\n      }\n    } else {\n      const zoomInTranslateY =\n          this.zoomResetGroup ? this.LARGE_SPACING + this.HEIGHT : 0;\n      this.zoomInGroup?.setAttribute(\n          'transform', 'translate(0, ' + zoomInTranslateY + ')');\n      const zoomOutTranslateY =\n          zoomInTranslateY + this.SMALL_SPACING + this.HEIGHT;\n      this.zoomOutGroup?.setAttribute(\n          'transform', 'translate(0, ' + zoomOutTranslateY + ')');\n    }\n\n    this.top = positionRect.top;\n    this.left = positionRect.left;\n    this.svgGroup?.setAttribute(\n        'transform', 'translate(' + this.left + ',' + this.top + ')');\n  }\n\n  /**\n   * Create the zoom in icon and its event handler.\n   *\n   * @param rnd The random string to use as a suffix in the clip path's ID.\n   *     These IDs must be unique in case there are multiple Blockly instances\n   *     on the same page.\n   */\n  private createZoomOutSvg(rnd: string) {\n    /* This markup will be generated and added to the .svgGroup:\n        <g class=\"blocklyZoom\">\n          <clipPath id=\"blocklyZoomoutClipPath837493\">\n            <rect width=\"32\" height=\"32></rect>\n          </clipPath>\n          <image width=\"96\" height=\"124\" x=\"-64\" y=\"-92\"\n        xlink:href=\"media/sprites.png\"\n              clip-path=\"url(#blocklyZoomoutClipPath837493)\"></image>\n        </g>\n        */\n    this.zoomOutGroup =\n        dom.createSvgElement(Svg.G, {'class': 'blocklyZoom'}, this.svgGroup);\n    const clip = dom.createSvgElement(\n        Svg.CLIPPATH, {'id': 'blocklyZoomoutClipPath' + rnd},\n        this.zoomOutGroup);\n    dom.createSvgElement(\n        Svg.RECT, {\n          'width': 32,\n          'height': 32,\n        },\n        clip);\n    const zoomoutSvg = dom.createSvgElement(\n        Svg.IMAGE, {\n          'width': SPRITE.width,\n          'height': SPRITE.height,\n          'x': -64,\n          'y': -92,\n          'clip-path': 'url(#blocklyZoomoutClipPath' + rnd + ')',\n        },\n        this.zoomOutGroup);\n    zoomoutSvg.setAttributeNS(\n        dom.XLINK_NS, 'xlink:href',\n        this.workspace.options.pathToMedia + SPRITE.url);\n\n    // Attach listener.\n    this.onZoomOutWrapper = browserEvents.conditionalBind(\n        this.zoomOutGroup, 'pointerdown', null, this.zoom.bind(this, -1));\n  }\n\n  /**\n   * Create the zoom out icon and its event handler.\n   *\n   * @param rnd The random string to use as a suffix in the clip path's ID.\n   *     These IDs must be unique in case there are multiple Blockly instances\n   *     on the same page.\n   */\n  private createZoomInSvg(rnd: string) {\n    /* This markup will be generated and added to the .svgGroup:\n        <g class=\"blocklyZoom\">\n          <clipPath id=\"blocklyZoominClipPath837493\">\n            <rect width=\"32\" height=\"32\"></rect>\n          </clipPath>\n          <image width=\"96\" height=\"124\" x=\"-32\" y=\"-92\"\n        xlink:href=\"media/sprites.png\"\n              clip-path=\"url(#blocklyZoominClipPath837493)\"></image>\n        </g>\n        */\n    this.zoomInGroup =\n        dom.createSvgElement(Svg.G, {'class': 'blocklyZoom'}, this.svgGroup);\n    const clip = dom.createSvgElement(\n        Svg.CLIPPATH, {'id': 'blocklyZoominClipPath' + rnd}, this.zoomInGroup);\n    dom.createSvgElement(\n        Svg.RECT, {\n          'width': 32,\n          'height': 32,\n        },\n        clip);\n    const zoominSvg = dom.createSvgElement(\n        Svg.IMAGE, {\n          'width': SPRITE.width,\n          'height': SPRITE.height,\n          'x': -32,\n          'y': -92,\n          'clip-path': 'url(#blocklyZoominClipPath' + rnd + ')',\n        },\n        this.zoomInGroup);\n    zoominSvg.setAttributeNS(\n        dom.XLINK_NS, 'xlink:href',\n        this.workspace.options.pathToMedia + SPRITE.url);\n\n    // Attach listener.\n    this.onZoomInWrapper = browserEvents.conditionalBind(\n        this.zoomInGroup, 'pointerdown', null, this.zoom.bind(this, 1));\n  }\n\n  /**\n   * Handles a mouse down event on the zoom in or zoom out buttons on the\n   *    workspace.\n   *\n   * @param amount Amount of zooming. Negative amount values zoom out, and\n   *     positive amount values zoom in.\n   * @param e A mouse down event.\n   */\n  private zoom(amount: number, e: PointerEvent) {\n    this.workspace.markFocused();\n    this.workspace.zoomCenter(amount);\n    this.fireZoomEvent();\n    Touch.clearTouchIdentifier();  // Don't block future drags.\n    e.stopPropagation();           // Don't start a workspace scroll.\n    e.preventDefault();            // Stop double-clicking from selecting text.\n  }\n\n  /**\n   * Create the zoom reset icon and its event handler.\n   *\n   * @param rnd The random string to use as a suffix in the clip path's ID.\n   *     These IDs must be unique in case there are multiple Blockly instances\n   *     on the same page.\n   */\n  private createZoomResetSvg(rnd: string) {\n    /* This markup will be generated and added to the .svgGroup:\n        <g class=\"blocklyZoom\">\n          <clipPath id=\"blocklyZoomresetClipPath837493\">\n            <rect width=\"32\" height=\"32\"></rect>\n          </clipPath>\n          <image width=\"96\" height=\"124\" x=\"-32\" y=\"-92\"\n        xlink:href=\"media/sprites.png\"\n              clip-path=\"url(#blocklyZoomresetClipPath837493)\"></image>\n        </g>\n        */\n    this.zoomResetGroup =\n        dom.createSvgElement(Svg.G, {'class': 'blocklyZoom'}, this.svgGroup);\n    const clip = dom.createSvgElement(\n        Svg.CLIPPATH, {'id': 'blocklyZoomresetClipPath' + rnd},\n        this.zoomResetGroup);\n    dom.createSvgElement(Svg.RECT, {'width': 32, 'height': 32}, clip);\n    const zoomresetSvg = dom.createSvgElement(\n        Svg.IMAGE, {\n          'width': SPRITE.width,\n          'height': SPRITE.height,\n          'y': -92,\n          'clip-path': 'url(#blocklyZoomresetClipPath' + rnd + ')',\n        },\n        this.zoomResetGroup);\n    zoomresetSvg.setAttributeNS(\n        dom.XLINK_NS, 'xlink:href',\n        this.workspace.options.pathToMedia + SPRITE.url);\n\n    // Attach event listeners.\n    this.onZoomResetWrapper = browserEvents.conditionalBind(\n        this.zoomResetGroup, 'pointerdown', null, this.resetZoom.bind(this));\n  }\n\n  /**\n   * Handles a mouse down event on the reset zoom button on the workspace.\n   *\n   * @param e A mouse down event.\n   */\n  private resetZoom(e: PointerEvent) {\n    this.workspace.markFocused();\n\n    // zoom is passed amount and computes the new scale using the formula:\n    // targetScale = currentScale * Math.pow(speed, amount)\n    const targetScale = this.workspace.options.zoomOptions.startScale;\n    const currentScale = this.workspace.scale;\n    const speed = this.workspace.options.zoomOptions.scaleSpeed;\n    // To compute amount:\n    // amount = log(speed, (targetScale / currentScale))\n    // Math.log computes natural logarithm (ln), to change the base, use\n    // formula: log(base, value) = ln(value) / ln(base)\n    const amount = Math.log(targetScale / currentScale) / Math.log(speed);\n    this.workspace.beginCanvasTransition();\n    this.workspace.zoomCenter(amount);\n    this.workspace.scrollCenter();\n\n    setTimeout(this.workspace.endCanvasTransition.bind(this.workspace), 500);\n    this.fireZoomEvent();\n    Touch.clearTouchIdentifier();  // Don't block future drags.\n    e.stopPropagation();           // Don't start a workspace scroll.\n    e.preventDefault();            // Stop double-clicking from selecting text.\n  }\n\n  /** Fires a zoom control UI event. */\n  private fireZoomEvent() {\n    const uiEvent = new (eventUtils.get(eventUtils.CLICK))(\n        null, this.workspace.id, 'zoom_controls');\n    eventUtils.fire(uiEvent);\n  }\n}\n\n/** CSS for zoom controls.  See css.js for use. */\nCss.register(`\n.blocklyZoom>image, .blocklyZoom>svg>image {\n  opacity: .4;\n}\n\n.blocklyZoom>image:hover, .blocklyZoom>svg>image:hover {\n  opacity: .6;\n}\n\n.blocklyZoom>image:active, .blocklyZoom>svg>image:active {\n  opacity: .8;\n}\n`);\n","/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Contains top-level functions for serializing workspaces to plain JavaScript\n * objects.\n *\n * @namespace Blockly.serialization.workspaces\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.serialization.workspaces');\n\nimport * as eventUtils from '../events/utils.js';\nimport type {ISerializer} from '../interfaces/i_serializer.js';\nimport * as registry from '../registry.js';\nimport * as dom from '../utils/dom.js';\n// eslint-disable-next-line no-unused-vars\nimport type {Workspace} from '../workspace.js';\nimport {WorkspaceSvg} from '../workspace_svg.js';\n\n\n/**\n * Returns the state of the workspace as a plain JavaScript object.\n *\n * @param workspace The workspace to serialize.\n * @returns The serialized state of the workspace.\n * @alias Blockly.serialization.workspaces.save\n */\nexport function save(workspace: Workspace):\n    {[key: string]: AnyDuringMigration} {\n  const state = Object.create(null);\n  const serializerMap = registry.getAllItems(registry.Type.SERIALIZER, true);\n  for (const key in serializerMap) {\n    const save = (serializerMap[key] as ISerializer)?.save(workspace);\n    if (save) {\n      state[key] = save;\n    }\n  }\n  return state;\n}\n\n/**\n * Loads the variable represented by the given state into the given workspace.\n *\n * @param state The state of the workspace to deserialize into the workspace.\n * @param workspace The workspace to add the new state to.\n * @param param1 recordUndo: If true, events triggered by this function will be\n *     undo-able by the user. False by default.\n * @alias Blockly.serialization.workspaces.load\n */\nexport function load(\n    state: {[key: string]: AnyDuringMigration}, workspace: Workspace,\n    {recordUndo = false}: {recordUndo?: boolean} = {}) {\n  const serializerMap = registry.getAllItems(registry.Type.SERIALIZER, true);\n  if (!serializerMap) {\n    return;\n  }\n\n  const deserializers = Object.entries(serializerMap)\n                            .sort(\n                                (a, b) => (b[1] as ISerializer)!.priority -\n                                    (a[1] as ISerializer)!.priority);\n\n  const prevRecordUndo = eventUtils.getRecordUndo();\n  eventUtils.setRecordUndo(recordUndo);\n  const existingGroup = eventUtils.getGroup();\n  if (!existingGroup) {\n    eventUtils.setGroup(true);\n  }\n\n  dom.startTextWidthCache();\n  if (workspace instanceof WorkspaceSvg) {\n    workspace.setResizesEnabled(false);\n  }\n\n  // We want to trigger clearing in reverse priority order so plugins don't end\n  // up missing dependencies.\n  for (const [, deserializer] of deserializers.reverse()) {\n    (deserializer as ISerializer)?.clear(workspace);\n  }\n\n  // reverse() is destructive, so we have to re-reverse to correct the order.\n  for (let [name, deserializer] of deserializers.reverse()) {\n    name = name;\n    const pluginState = state[name];\n    if (pluginState) {\n      (deserializer as ISerializer)?.load(state[name], workspace);\n    }\n  }\n\n  if (workspace instanceof WorkspaceSvg) {\n    workspace.setResizesEnabled(true);\n  }\n  dom.stopTextWidthCache();\n\n  eventUtils.fire(new (eventUtils.get(eventUtils.FINISHED_LOADING))(workspace));\n\n  eventUtils.setGroup(existingGroup);\n  eventUtils.setRecordUndo(prevRecordUndo);\n}\n","/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Handles serializing variables to plain JavaScript objects, only containing\n * state.\n *\n * @namespace Blockly.serialization.variables\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.serialization.variables');\n\nimport type {ISerializer} from '../interfaces/i_serializer.js';\nimport type {Workspace} from '../workspace.js';\n\nimport * as priorities from './priorities.js';\nimport * as serializationRegistry from './registry.js';\n\n\n/**\n * Represents the state of a given variable.\n *\n * @alias Blockly.serialization.variables.State\n */\nexport interface State {\n  name: string;\n  id: string;\n  type: string|undefined;\n}\n\n/**\n * Serializer for saving and loading variable state.\n *\n * @alias Blockly.serialization.variables.VariableSerializer\n */\nexport class VariableSerializer implements ISerializer {\n  priority: number;\n\n  /* eslint-disable-next-line require-jsdoc */\n  constructor() {\n    /** The priority for deserializing variables. */\n    this.priority = priorities.VARIABLES;\n  }\n\n  /**\n   * Serializes the variables of the given workspace.\n   *\n   * @param workspace The workspace to save the variables of.\n   * @returns The state of the workspace's variables, or null if there are no\n   *     variables.\n   */\n  save(workspace: Workspace): State[]|null {\n    const variableStates = [];\n    for (const variable of workspace.getAllVariables()) {\n      const state = {\n        'name': variable.name,\n        'id': variable.getId(),\n      };\n      if (variable.type) {\n        (state as AnyDuringMigration)['type'] = variable.type;\n      }\n      variableStates.push(state);\n    }\n    // AnyDuringMigration because:  Type '{ name: string; id: string; }[] |\n    // null' is not assignable to type 'State[] | null'.\n    return (variableStates.length ? variableStates : null) as\n        AnyDuringMigration;\n  }\n\n  /**\n   * Deserializes the variable defined by the given state into the given\n   * workspace.\n   *\n   * @param state The state of the variables to deserialize.\n   * @param workspace The workspace to deserialize into.\n   */\n  load(state: State[], workspace: Workspace) {\n    for (const varState of state) {\n      workspace.createVariable(\n          varState['name'], varState['type'], varState['id']);\n    }\n  }\n\n  /**\n   * Disposes of any variables that exist on the workspace.\n   *\n   * @param workspace The workspace to clear the variables of.\n   */\n  clear(workspace: Workspace) {\n    workspace.getVariableMap().clear();\n  }\n}\n\nserializationRegistry.register('variables', new VariableSerializer());\n","/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Serialization methods.\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.serialization');\n\nimport * as blocks from './serialization/blocks.js';\nimport * as exceptions from './serialization/exceptions.js';\nimport * as priorities from './serialization/priorities.js';\nimport * as procedures from './serialization/procedures.js';\nimport * as registry from './serialization/registry.js';\nimport * as variables from './serialization/variables.js';\nimport * as workspaces from './serialization/workspaces.js';\nimport {ISerializer} from './interfaces/i_serializer.js';\n\nexport {\n  blocks,\n  exceptions,\n  priorities,\n  procedures,\n  registry,\n  variables,\n  workspaces,\n  ISerializer,\n};\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * An object that provides constants for rendering blocks in Zelos\n * mode.\n *\n * @class\n */\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.zelos.ConstantProvider');\n\nimport {ConnectionType} from '../../connection_type.js';\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport type {Theme} from '../../theme.js';\nimport * as utilsColour from '../../utils/colour.js';\nimport * as dom from '../../utils/dom.js';\nimport {Svg} from '../../utils/svg.js';\nimport * as svgPaths from '../../utils/svg_paths.js';\nimport {ConstantProvider as BaseConstantProvider} from '../common/constants.js';\nimport type {Shape} from '../common/constants.js';\n\n\n/** An object containing sizing and path information about inside corners. */\nexport interface InsideCorners {\n  width: number;\n  height: number;\n  pathTop: string;\n  pathBottom: string;\n  rightWidth: number;\n  rightHeight: number;\n  pathTopRight: string;\n  pathBottomRight: string;\n}\n\n/**\n * An object that provides constants for rendering blocks in Zelos mode.\n *\n * @alias Blockly.zelos.ConstantProvider\n */\nexport class ConstantProvider extends BaseConstantProvider {\n  GRID_UNIT = 4;\n  STATEMENT_INPUT_SPACER_MIN_WIDTH: number;\n\n  override CURSOR_COLOUR = '#ffa200';\n\n  /**\n   * Radius of the cursor for input and output connections.\n   *\n   * @internal\n   */\n  CURSOR_RADIUS = 5;\n\n  override JAGGED_TEETH_HEIGHT = 0;\n\n  override JAGGED_TEETH_WIDTH = 0;\n  override START_HAT_HEIGHT = 22;\n\n  override START_HAT_WIDTH = 96;\n\n  override SHAPES = {HEXAGONAL: 1, ROUND: 2, SQUARE: 3, PUZZLE: 4, NOTCH: 5};\n\n  /**\n   * Map of output/input shapes and the amount they should cause a block to be\n   * padded. Outer key is the outer shape, inner key is the inner shape.\n   * When a block with the outer shape contains an input block with the inner\n   * shape on its left or right edge, the block elements are aligned such that\n   * the padding specified is reached.\n   *\n   * @internal\n   */\n  SHAPE_IN_SHAPE_PADDING: {[key: number]: {[key: number]: number}} = {\n    1: {\n      // Outer shape: hexagon.\n      0: 5 * this.GRID_UNIT,  // Field in hexagon.\n      1: 2 * this.GRID_UNIT,  // Hexagon in hexagon.\n      2: 5 * this.GRID_UNIT,  // Round in hexagon.\n      3: 5 * this.GRID_UNIT,  // Square in hexagon.\n    },\n    2: {\n      // Outer shape: round.\n      0: 3 * this.GRID_UNIT,  // Field in round.\n      1: 3 * this.GRID_UNIT,  // Hexagon in round.\n      2: 1 * this.GRID_UNIT,  // Round in round.\n      3: 2 * this.GRID_UNIT,  // Square in round.\n    },\n    3: {\n      // Outer shape: square.\n      0: 2 * this.GRID_UNIT,  // Field in square.\n      1: 2 * this.GRID_UNIT,  // Hexagon in square.\n      2: 2 * this.GRID_UNIT,  // Round in square.\n      3: 2 * this.GRID_UNIT,  // Square in square.\n    },\n  };\n\n  override FULL_BLOCK_FIELDS = true;\n\n  override FIELD_TEXT_FONTWEIGHT = 'bold';\n\n  override FIELD_TEXT_FONTFAMILY =\n      '\"Helvetica Neue\", \"Segoe UI\", Helvetica, sans-serif';\n\n  override FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW = true;\n\n  override FIELD_DROPDOWN_COLOURED_DIV = true;\n\n  override FIELD_DROPDOWN_SVG_ARROW = true;\n  override FIELD_TEXTINPUT_BOX_SHADOW = true;\n\n  override FIELD_COLOUR_FULL_BLOCK = true;\n  MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH: number;\n\n  /** The selected glow colour. */\n  SELECTED_GLOW_COLOUR = '#fff200';\n\n  /** The size of the selected glow. */\n  SELECTED_GLOW_SIZE = 0.5;\n\n  /** The replacement glow colour. */\n  REPLACEMENT_GLOW_COLOUR = '#fff200';\n\n  /** The size of the selected glow. */\n  REPLACEMENT_GLOW_SIZE = 2;\n\n  /**\n   * The ID of the selected glow filter, or the empty string if no filter is\n   * set.\n   *\n   * @internal\n   */\n  selectedGlowFilterId = '';\n\n  /**\n   * The <filter> element to use for a selected glow, or null if not set.\n   */\n  private selectedGlowFilter_: SVGElement|null = null;\n\n  /**\n   * The ID of the replacement glow filter, or the empty string if no filter\n   * is set.\n   *\n   * @internal\n   */\n  replacementGlowFilterId = '';\n\n  /**\n   * The <filter> element to use for a replacement glow, or null if not set.\n   */\n  private replacementGlowFilter_: SVGElement|null = null;\n\n  /**\n   * The object containing information about the hexagon used for a boolean\n   * reporter block. Null before init is called.\n   */\n  HEXAGONAL: Shape|null = null;\n\n  /**\n   * The object containing information about the hexagon used for a number or\n   * string reporter block. Null before init is called.\n   */\n  ROUNDED: Shape|null = null;\n\n  /**\n   * The object containing information about the hexagon used for a\n   * rectangular reporter block. Null before init is called.\n   */\n  SQUARED: Shape|null = null;\n\n  /** @internal */\n  constructor() {\n    super();\n\n    this.SMALL_PADDING = this.GRID_UNIT;\n\n    this.MEDIUM_PADDING = 2 * this.GRID_UNIT;\n\n    this.MEDIUM_LARGE_PADDING = 3 * this.GRID_UNIT;\n\n    this.LARGE_PADDING = 4 * this.GRID_UNIT;\n\n    this.CORNER_RADIUS = 1 * this.GRID_UNIT;\n\n    this.NOTCH_WIDTH = 9 * this.GRID_UNIT;\n\n    this.NOTCH_HEIGHT = 2 * this.GRID_UNIT;\n\n    this.NOTCH_OFFSET_LEFT = 3 * this.GRID_UNIT;\n\n    this.STATEMENT_INPUT_NOTCH_OFFSET = this.NOTCH_OFFSET_LEFT;\n\n    this.MIN_BLOCK_WIDTH = 2 * this.GRID_UNIT;\n\n    this.MIN_BLOCK_HEIGHT = 12 * this.GRID_UNIT;\n\n    this.EMPTY_STATEMENT_INPUT_HEIGHT = 6 * this.GRID_UNIT;\n\n    this.TOP_ROW_MIN_HEIGHT = this.CORNER_RADIUS;\n\n    this.TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT = this.LARGE_PADDING;\n\n    this.BOTTOM_ROW_MIN_HEIGHT = this.CORNER_RADIUS;\n\n    this.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT = 6 * this.GRID_UNIT;\n\n    this.STATEMENT_BOTTOM_SPACER = -this.NOTCH_HEIGHT;\n\n    /** Minimum statement input spacer width. */\n    this.STATEMENT_INPUT_SPACER_MIN_WIDTH = 40 * this.GRID_UNIT;\n\n    this.STATEMENT_INPUT_PADDING_LEFT = 4 * this.GRID_UNIT;\n\n    this.EMPTY_INLINE_INPUT_PADDING = 4 * this.GRID_UNIT;\n\n    this.EMPTY_INLINE_INPUT_HEIGHT = 8 * this.GRID_UNIT;\n\n    this.DUMMY_INPUT_MIN_HEIGHT = 8 * this.GRID_UNIT;\n\n    this.DUMMY_INPUT_SHADOW_MIN_HEIGHT = 6 * this.GRID_UNIT;\n\n    this.CURSOR_WS_WIDTH = 20 * this.GRID_UNIT;\n\n    this.FIELD_TEXT_FONTSIZE = 3 * this.GRID_UNIT;\n\n    this.FIELD_BORDER_RECT_RADIUS = this.CORNER_RADIUS;\n\n    this.FIELD_BORDER_RECT_X_PADDING = 2 * this.GRID_UNIT;\n\n    this.FIELD_BORDER_RECT_Y_PADDING = 1.625 * this.GRID_UNIT;\n\n    this.FIELD_BORDER_RECT_HEIGHT = 8 * this.GRID_UNIT;\n\n    this.FIELD_DROPDOWN_BORDER_RECT_HEIGHT = 8 * this.GRID_UNIT;\n\n    this.FIELD_DROPDOWN_SVG_ARROW_PADDING = this.FIELD_BORDER_RECT_X_PADDING;\n\n    this.FIELD_COLOUR_DEFAULT_WIDTH = 2 * this.GRID_UNIT;\n\n    this.FIELD_COLOUR_DEFAULT_HEIGHT = 4 * this.GRID_UNIT;\n\n    this.FIELD_CHECKBOX_X_OFFSET = 1 * this.GRID_UNIT;\n\n    /** The maximum width of a dynamic connection shape. */\n    this.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH = 12 * this.GRID_UNIT;\n  }\n\n  override setFontConstants_(theme: Theme) {\n    super.setFontConstants_(theme);\n\n    this.FIELD_BORDER_RECT_HEIGHT =\n        this.FIELD_TEXT_HEIGHT + this.FIELD_BORDER_RECT_Y_PADDING * 2;\n    this.FIELD_DROPDOWN_BORDER_RECT_HEIGHT = this.FIELD_BORDER_RECT_HEIGHT;\n  }\n\n  override init() {\n    super.init();\n    this.HEXAGONAL = this.makeHexagonal();\n    this.ROUNDED = this.makeRounded();\n    this.SQUARED = this.makeSquared();\n\n    this.STATEMENT_INPUT_NOTCH_OFFSET = this.NOTCH_OFFSET_LEFT +\n        (this.INSIDE_CORNERS as InsideCorners).rightWidth;\n  }\n\n  override setDynamicProperties_(theme: Theme) {\n    super.setDynamicProperties_(theme);\n\n    this.SELECTED_GLOW_COLOUR = theme.getComponentStyle('selectedGlowColour') ||\n        this.SELECTED_GLOW_COLOUR;\n    const selectedGlowSize =\n        Number(theme.getComponentStyle('selectedGlowSize'));\n    this.SELECTED_GLOW_SIZE = selectedGlowSize && !isNaN(selectedGlowSize) ?\n        selectedGlowSize :\n        this.SELECTED_GLOW_SIZE;\n    this.REPLACEMENT_GLOW_COLOUR =\n        theme.getComponentStyle('replacementGlowColour') ||\n        this.REPLACEMENT_GLOW_COLOUR;\n    const replacementGlowSize =\n        Number(theme.getComponentStyle('replacementGlowSize'));\n    this.REPLACEMENT_GLOW_SIZE =\n        replacementGlowSize && !isNaN(replacementGlowSize) ?\n        replacementGlowSize :\n        this.REPLACEMENT_GLOW_SIZE;\n  }\n\n  override dispose() {\n    super.dispose();\n    if (this.selectedGlowFilter_) {\n      dom.removeNode(this.selectedGlowFilter_);\n    }\n    if (this.replacementGlowFilter_) {\n      dom.removeNode(this.replacementGlowFilter_);\n    }\n  }\n\n  override makeStartHat() {\n    const height = this.START_HAT_HEIGHT;\n    const width = this.START_HAT_WIDTH;\n\n    const mainPath = svgPaths.curve('c', [\n      svgPaths.point(25, -height),\n      svgPaths.point(71, -height),\n      svgPaths.point(width, 0),\n    ]);\n    return {height, width, path: mainPath};\n  }\n\n  /**\n   * Create sizing and path information about a hexagonal shape.\n   *\n   * @returns An object containing sizing and path information about a hexagonal\n   *     shape for connections.\n   * @internal\n   */\n  makeHexagonal(): Shape {\n    const maxWidth = this.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH;\n\n    /**\n     * Make the main path for the hexagonal connection shape out of two lines.\n     * The lines are defined with relative positions and require the block\n     * height. The 'up' and 'down' versions of the paths are the same, but the Y\n     * sign flips.  The 'left' and 'right' versions of the path are also the\n     * same, but the X sign flips.\n     *\n     * @param height The height of the block the connection is on.\n     * @param up True if the path should be drawn from bottom to top, false\n     *     otherwise.\n     * @param right True if the path is for the right side of the block.\n     * @returns A path fragment describing a rounded connection.\n     */\n    function makeMainPath(height: number, up: boolean, right: boolean): string {\n      const halfHeight = height / 2;\n      const width = halfHeight > maxWidth ? maxWidth : halfHeight;\n      const forward = up ? -1 : 1;\n      const direction = right ? -1 : 1;\n      const dy = forward * height / 2;\n      return svgPaths.lineTo(-direction * width, dy) +\n          svgPaths.lineTo(direction * width, dy);\n    }\n\n    return {\n      type: this.SHAPES.HEXAGONAL,\n      isDynamic: true,\n      width(height: number): number {\n        const halfHeight = height / 2;\n        return halfHeight > maxWidth ? maxWidth : halfHeight;\n      },\n      height(height: number): number {\n        return height;\n      },\n      connectionOffsetY(connectionHeight: number): number {\n        return connectionHeight / 2;\n      },\n      connectionOffsetX(connectionWidth: number): number {\n        return -connectionWidth;\n      },\n      pathDown(height: number): string {\n        return makeMainPath(height, false, false);\n      },\n      pathUp(height: number): string {\n        return makeMainPath(height, true, false);\n      },\n      pathRightDown(height: number): string {\n        return makeMainPath(height, false, true);\n      },\n      pathRightUp(height: number): string {\n        return makeMainPath(height, false, true);\n      },\n    };\n  }\n\n  /**\n   * Create sizing and path information about a rounded shape.\n   *\n   * @returns An object containing sizing and path information about a rounded\n   *     shape for connections.\n   * @internal\n   */\n  makeRounded(): Shape {\n    const maxWidth = this.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH;\n    const maxHeight = maxWidth * 2;\n\n    /**\n     * Make the main path for the rounded connection shape out of two arcs and\n     * a line that joins them.  The arcs are defined with relative positions.\n     * Usually, the height of the block is split between the two arcs. In the\n     * case where the height of the block exceeds the maximum height, a line is\n     * drawn in between the two arcs. The 'up' and 'down' versions of the paths\n     * are the same, but the Y sign flips.  The 'up' and 'right' versions of the\n     * path flip the sweep-flag which moves the arc at negative angles.\n     *\n     * @param blockHeight The height of the block the connection is on.\n     * @param up True if the path should be drawn from bottom to top, false\n     *     otherwise.\n     * @param right True if the path is for the right side of the block.\n     * @returns A path fragment describing a rounded connection.\n     */\n    function makeMainPath(\n        blockHeight: number, up: boolean, right: boolean): string {\n      const remainingHeight =\n          blockHeight > maxHeight ? blockHeight - maxHeight : 0;\n      const height = blockHeight > maxHeight ? maxHeight : blockHeight;\n      const radius = height / 2;\n      return svgPaths.arc(\n                 'a', '0 0,1', radius,\n                 svgPaths.point(\n                     (up ? -1 : 1) * radius, (up ? -1 : 1) * radius)) +\n          svgPaths.lineOnAxis('v', (right ? 1 : -1) * remainingHeight) +\n          svgPaths.arc(\n              'a', '0 0,1', radius,\n              svgPaths.point((up ? 1 : -1) * radius, (up ? -1 : 1) * radius));\n    }\n\n    return {\n      type: this.SHAPES.ROUND,\n      isDynamic: true,\n      width(height: number): number {\n        const halfHeight = height / 2;\n        return halfHeight > maxWidth ? maxWidth : halfHeight;\n      },\n      height(height: number): number {\n        return height;\n      },\n      connectionOffsetY(connectionHeight: number): number {\n        return connectionHeight / 2;\n      },\n      connectionOffsetX(connectionWidth: number): number {\n        return -connectionWidth;\n      },\n      pathDown(height: number): string {\n        return makeMainPath(height, false, false);\n      },\n      pathUp(height: number): string {\n        return makeMainPath(height, true, false);\n      },\n      pathRightDown(height: number): string {\n        return makeMainPath(height, false, true);\n      },\n      pathRightUp(height: number): string {\n        return makeMainPath(height, false, true);\n      },\n    };\n  }\n\n  /**\n   * Create sizing and path information about a squared shape.\n   *\n   * @returns An object containing sizing and path information about a squared\n   *     shape for connections.\n   * @internal\n   */\n  makeSquared(): Shape {\n    const radius = this.CORNER_RADIUS;\n\n    /**\n     * Make the main path for the squared connection shape out of two corners\n     * and a single line in-between (a and v). These are defined in relative\n     * positions and require the height of the block.\n     * The 'left' and 'right' versions of the paths are the same, but the Y sign\n     * flips.  The 'up' and 'down' versions of the path determine where the\n     * corner point is placed and in turn the direction of the corners.\n     *\n     * @param height The height of the block the connection is on.\n     * @param up True if the path should be drawn from bottom to top, false\n     *     otherwise.\n     * @param right True if the path is for the right side of the block.\n     * @returns A path fragment describing a squared connection.\n     */\n    function makeMainPath(height: number, up: boolean, right: boolean): string {\n      const innerHeight = height - radius * 2;\n      return svgPaths.arc(\n                 'a', '0 0,1', radius,\n                 svgPaths.point(\n                     (up ? -1 : 1) * radius, (up ? -1 : 1) * radius)) +\n          svgPaths.lineOnAxis('v', (right ? 1 : -1) * innerHeight) +\n          svgPaths.arc(\n              'a', '0 0,1', radius,\n              svgPaths.point((up ? 1 : -1) * radius, (up ? -1 : 1) * radius));\n    }\n\n    return {\n      type: this.SHAPES.SQUARE,\n      isDynamic: true,\n      width(_height: number): number {\n        return radius;\n      },\n      height(height: number): number {\n        return height;\n      },\n      connectionOffsetY(connectionHeight: number): number {\n        return connectionHeight / 2;\n      },\n      connectionOffsetX(connectionWidth: number): number {\n        return -connectionWidth;\n      },\n      pathDown(height: number): string {\n        return makeMainPath(height, false, false);\n      },\n      pathUp(height: number): string {\n        return makeMainPath(height, true, false);\n      },\n      pathRightDown(height: number): string {\n        return makeMainPath(height, false, true);\n      },\n      pathRightUp(height: number): string {\n        return makeMainPath(height, false, true);\n      },\n    };\n  }\n\n  override shapeFor(connection: RenderedConnection): Shape {\n    let checks = connection.getCheck();\n    if (!checks && connection.targetConnection) {\n      checks = connection.targetConnection.getCheck();\n    }\n    let outputShape;\n    switch (connection.type) {\n      case ConnectionType.INPUT_VALUE:\n      case ConnectionType.OUTPUT_VALUE:\n        outputShape = connection.getSourceBlock().getOutputShape();\n        // If the block has an output shape set, use that instead.\n        if (outputShape !== null) {\n          switch (outputShape) {\n            case this.SHAPES.HEXAGONAL:\n              return this.HEXAGONAL!;\n            case this.SHAPES.ROUND:\n              return this.ROUNDED!;\n            case this.SHAPES.SQUARE:\n              return this.SQUARED!;\n          }\n        }\n        // Includes doesn't work in IE.\n        if (checks && checks.indexOf('Boolean') !== -1) {\n          return this.HEXAGONAL!;\n        }\n        if (checks && checks.indexOf('Number') !== -1) {\n          return this.ROUNDED!;\n        }\n        if (checks && checks.indexOf('String') !== -1) {\n          return this.ROUNDED!;\n        }\n        return this.ROUNDED!;\n      case ConnectionType.PREVIOUS_STATEMENT:\n      case ConnectionType.NEXT_STATEMENT:\n        return this.NOTCH!;\n      default:\n        throw Error('Unknown type');\n    }\n  }\n\n  override makeNotch() {\n    const width = this.NOTCH_WIDTH;\n    const height = this.NOTCH_HEIGHT;\n\n    const innerWidth = width / 3;\n    const curveWidth = innerWidth / 3;\n\n    const halfHeight = height / 2;\n    const quarterHeight = halfHeight / 2;\n\n    /**\n     * Make the main path for the notch.\n     *\n     * @param dir Direction multiplier to apply to horizontal offsets along the\n     *     path. Either 1 or -1.\n     * @returns A path fragment describing a notch.\n     */\n    function makeMainPath(dir: number): string {\n      return svgPaths.curve(\n                 'c',\n                 [\n                   svgPaths.point(dir * curveWidth / 2, 0),\n                   svgPaths.point(dir * curveWidth * 3 / 4, quarterHeight / 2),\n                   svgPaths.point(dir * curveWidth, quarterHeight),\n                 ]) +\n          svgPaths.line([svgPaths.point(dir * curveWidth, halfHeight)]) +\n          svgPaths.curve(\n              'c',\n              [\n                svgPaths.point(dir * curveWidth / 4, quarterHeight / 2),\n                svgPaths.point(dir * curveWidth / 2, quarterHeight),\n                svgPaths.point(dir * curveWidth, quarterHeight),\n              ]) +\n          svgPaths.lineOnAxis('h', dir * innerWidth) +\n          svgPaths.curve(\n              'c',\n              [\n                svgPaths.point(dir * curveWidth / 2, 0),\n                svgPaths.point(dir * curveWidth * 3 / 4, -(quarterHeight / 2)),\n                svgPaths.point(dir * curveWidth, -quarterHeight),\n              ]) +\n          svgPaths.line([svgPaths.point(dir * curveWidth, -halfHeight)]) +\n          svgPaths.curve('c', [\n            svgPaths.point(dir * curveWidth / 4, -(quarterHeight / 2)),\n            svgPaths.point(dir * curveWidth / 2, -quarterHeight),\n            svgPaths.point(dir * curveWidth, -quarterHeight),\n          ]);\n    }\n\n    const pathLeft = makeMainPath(1);\n    const pathRight = makeMainPath(-1);\n\n    return {\n      type: this.SHAPES.NOTCH,\n      width,\n      height,\n      pathLeft,\n      pathRight,\n    };\n  }\n\n  override makeInsideCorners() {\n    const radius = this.CORNER_RADIUS;\n\n    const innerTopLeftCorner =\n        svgPaths.arc('a', '0 0,0', radius, svgPaths.point(-radius, radius));\n\n    const innerTopRightCorner =\n        svgPaths.arc('a', '0 0,1', radius, svgPaths.point(-radius, radius));\n\n    const innerBottomLeftCorner =\n        svgPaths.arc('a', '0 0,0', radius, svgPaths.point(radius, radius));\n\n    const innerBottomRightCorner =\n        svgPaths.arc('a', '0 0,1', radius, svgPaths.point(radius, radius));\n\n    return {\n      width: radius,\n      height: radius,\n      pathTop: innerTopLeftCorner,\n      pathBottom: innerBottomLeftCorner,\n      rightWidth: radius,\n      rightHeight: radius,\n      pathTopRight: innerTopRightCorner,\n      pathBottomRight: innerBottomRightCorner,\n    };\n  }\n\n  override generateSecondaryColour_(colour: string) {\n    return utilsColour.blend('#000', colour, 0.15) || colour;\n  }\n\n  override generateTertiaryColour_(colour: string) {\n    return utilsColour.blend('#000', colour, 0.25) || colour;\n  }\n\n  override createDom(svg: SVGElement, tagName: string, selector: string) {\n    super.createDom(svg, tagName, selector);\n    /*\n        <defs>\n          ... filters go here ...\n        </defs>\n        */\n    const defs = dom.createSvgElement(Svg.DEFS, {}, svg);\n    // Using a dilate distorts the block shape.\n    // Instead use a gaussian blur, and then set all alpha to 1 with a transfer.\n    const selectedGlowFilter = dom.createSvgElement(\n        Svg.FILTER, {\n          'id': 'blocklySelectedGlowFilter' + this.randomIdentifier,\n          'height': '160%',\n          'width': '180%',\n          'y': '-30%',\n          'x': '-40%',\n        },\n        defs);\n    dom.createSvgElement(\n        Svg.FEGAUSSIANBLUR,\n        {'in': 'SourceGraphic', 'stdDeviation': this.SELECTED_GLOW_SIZE},\n        selectedGlowFilter);\n    // Set all gaussian blur pixels to 1 opacity before applying flood\n    const selectedComponentTransfer = dom.createSvgElement(\n        Svg.FECOMPONENTTRANSFER, {'result': 'outBlur'}, selectedGlowFilter);\n    dom.createSvgElement(\n        Svg.FEFUNCA,\n        {'type': 'table', 'tableValues': '0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1'},\n        selectedComponentTransfer);\n    // Color the highlight\n    dom.createSvgElement(\n        Svg.FEFLOOD, {\n          'flood-color': this.SELECTED_GLOW_COLOUR,\n          'flood-opacity': 1,\n          'result': 'outColor',\n        },\n        selectedGlowFilter);\n    dom.createSvgElement(\n        Svg.FECOMPOSITE, {\n          'in': 'outColor',\n          'in2': 'outBlur',\n          'operator': 'in',\n          'result': 'outGlow',\n        },\n        selectedGlowFilter);\n    this.selectedGlowFilterId = selectedGlowFilter.id;\n    this.selectedGlowFilter_ = selectedGlowFilter;\n\n    // Using a dilate distorts the block shape.\n    // Instead use a gaussian blur, and then set all alpha to 1 with a transfer.\n    const replacementGlowFilter = dom.createSvgElement(\n        Svg.FILTER, {\n          'id': 'blocklyReplacementGlowFilter' + this.randomIdentifier,\n          'height': '160%',\n          'width': '180%',\n          'y': '-30%',\n          'x': '-40%',\n        },\n        defs);\n    dom.createSvgElement(\n        Svg.FEGAUSSIANBLUR,\n        {'in': 'SourceGraphic', 'stdDeviation': this.REPLACEMENT_GLOW_SIZE},\n        replacementGlowFilter);\n    // Set all gaussian blur pixels to 1 opacity before applying flood\n    const replacementComponentTransfer = dom.createSvgElement(\n        Svg.FECOMPONENTTRANSFER, {'result': 'outBlur'}, replacementGlowFilter);\n    dom.createSvgElement(\n        Svg.FEFUNCA,\n        {'type': 'table', 'tableValues': '0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1'},\n        replacementComponentTransfer);\n    // Color the highlight\n    dom.createSvgElement(\n        Svg.FEFLOOD, {\n          'flood-color': this.REPLACEMENT_GLOW_COLOUR,\n          'flood-opacity': 1,\n          'result': 'outColor',\n        },\n        replacementGlowFilter);\n    dom.createSvgElement(\n        Svg.FECOMPOSITE, {\n          'in': 'outColor',\n          'in2': 'outBlur',\n          'operator': 'in',\n          'result': 'outGlow',\n        },\n        replacementGlowFilter);\n    dom.createSvgElement(\n        Svg.FECOMPOSITE, {\n          'in': 'SourceGraphic',\n          'in2': 'outGlow',\n          'operator': 'over',\n        },\n        replacementGlowFilter);\n    this.replacementGlowFilterId = replacementGlowFilter.id;\n    this.replacementGlowFilter_ = replacementGlowFilter;\n  }\n\n  override getCSS_(selector: string) {\n    return [\n      /* eslint-disable indent */\n      // Text.\n      `${selector} .blocklyText,`,\n      `${selector} .blocklyFlyoutLabelText {`,\n      `font: ${this.FIELD_TEXT_FONTWEIGHT} ${this.FIELD_TEXT_FONTSIZE}` +\n          `pt ${this.FIELD_TEXT_FONTFAMILY};`,\n      `}`,\n\n      // Fields.\n      `${selector} .blocklyText {`,\n      `fill: #fff;`,\n      `}`,\n      `${selector} .blocklyNonEditableText>rect:not(.blocklyDropdownRect),`,\n      `${selector} .blocklyEditableText>rect:not(.blocklyDropdownRect) {`,\n      `fill: ${this.FIELD_BORDER_RECT_COLOUR};`,\n      `}`,\n      `${selector} .blocklyNonEditableText>text,`,\n      `${selector} .blocklyEditableText>text,`,\n      `${selector} .blocklyNonEditableText>g>text,`,\n      `${selector} .blocklyEditableText>g>text {`,\n      `fill: #575E75;`,\n      `}`,\n\n      // Flyout labels.\n      `${selector} .blocklyFlyoutLabelText {`,\n      `fill: #575E75;`,\n      `}`,\n\n      // Bubbles.\n      `${selector} .blocklyText.blocklyBubbleText {`,\n      `fill: #575E75;`,\n      `}`,\n\n      // Editable field hover.\n      `${selector} .blocklyDraggable:not(.blocklyDisabled)`,\n      ` .blocklyEditableText:not(.editing):hover>rect,`,\n      `${selector} .blocklyDraggable:not(.blocklyDisabled)`,\n      ` .blocklyEditableText:not(.editing):hover>.blocklyPath {`,\n      `stroke: #fff;`,\n      `stroke-width: 2;`,\n      `}`,\n\n      // Text field input.\n      `${selector} .blocklyHtmlInput {`,\n      `font-family: ${this.FIELD_TEXT_FONTFAMILY};`,\n      `font-weight: ${this.FIELD_TEXT_FONTWEIGHT};`,\n      `color: #575E75;`,\n      `}`,\n\n      // Dropdown field.\n      `${selector} .blocklyDropdownText {`,\n      `fill: #fff !important;`,\n      `}`,\n\n      // Widget and Dropdown Div\n      `${selector}.blocklyWidgetDiv .goog-menuitem,`,\n      `${selector}.blocklyDropDownDiv .goog-menuitem {`,\n      `font-family: ${this.FIELD_TEXT_FONTFAMILY};`,\n      `}`,\n      `${selector}.blocklyDropDownDiv .goog-menuitem-content {`,\n      `color: #fff;`,\n      `}`,\n\n      // Connection highlight.\n      `${selector} .blocklyHighlightedConnectionPath {`,\n      `stroke: ${this.SELECTED_GLOW_COLOUR};`,\n      `}`,\n\n      // Disabled outline paths.\n      `${selector} .blocklyDisabled > .blocklyOutlinePath {`,\n      `fill: url(#blocklyDisabledPattern${this.randomIdentifier})`,\n      `}`,\n\n      // Insertion marker.\n      `${selector} .blocklyInsertionMarker>.blocklyPath {`,\n      `fill-opacity: ${this.INSERTION_MARKER_OPACITY};`,\n      `stroke: none;`,\n      `}`,\n    ];\n  }\n}\n/* eslint-enable indent */\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Zelos renderer.\n *\n * @class\n */\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.zelos.Drawer');\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport * as svgPaths from '../../utils/svg_paths.js';\nimport type {BaseShape, DynamicShape, Notch} from '../common/constants.js';\nimport * as debug from '../common/debug.js';\nimport {Drawer as BaseDrawer} from '../common/drawer.js';\nimport type {InlineInput} from '../measurables/inline_input.js';\nimport type {Row} from '../measurables/row.js';\nimport type {SpacerRow} from '../measurables/spacer_row.js';\nimport {Types} from '../measurables/types.js';\n\nimport type {InsideCorners} from './constants.js';\nimport type {RenderInfo} from './info.js';\nimport type {StatementInput} from './measurables/inputs.js';\nimport type {PathObject} from './path_object.js';\n\n\n/**\n * An object that draws a block based on the given rendering information.\n *\n * @alias Blockly.zelos.Drawer\n */\nexport class Drawer extends BaseDrawer {\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  override info_!: RenderInfo;\n\n  /**\n   * @param block The block to render.\n   * @param info An object containing all information needed to render this\n   *     block.\n   * @internal\n   */\n  constructor(block: BlockSvg, info: RenderInfo) {\n    super(block, info);\n  }\n\n  override draw() {\n    const pathObject = this.block_.pathObject as PathObject;\n    pathObject.beginDrawing();\n    this.hideHiddenIcons_();\n    this.drawOutline_();\n    this.drawInternals_();\n\n    pathObject.setPath(this.outlinePath_ + '\\n' + this.inlinePath_);\n    if (this.info_.RTL) {\n      pathObject.flipRTL();\n    }\n    if (debug.isDebuggerEnabled()) {\n      this.block_?.renderingDebugger?.drawDebug(this.block_, this.info_);\n    }\n    this.recordSizeOnBlock_();\n    if (this.info_.outputConnection) {\n      // Store the output connection shape type for parent blocks to use during\n      // rendering.\n      pathObject.outputShapeType = this.info_.outputConnection.shape.type;\n    }\n    pathObject.endDrawing();\n  }\n\n  override drawOutline_() {\n    if (this.info_.outputConnection &&\n        this.info_.outputConnection.isDynamicShape &&\n        !this.info_.hasStatementInput &&\n        !this.info_.bottomRow.hasNextConnection) {\n      this.drawFlatTop_();\n      this.drawRightDynamicConnection_();\n      this.drawFlatBottom_();\n      this.drawLeftDynamicConnection_();\n    } else {\n      super.drawOutline_();\n    }\n  }\n\n  override drawLeft_() {\n    if (this.info_.outputConnection &&\n        this.info_.outputConnection.isDynamicShape) {\n      this.drawLeftDynamicConnection_();\n    } else {\n      super.drawLeft_();\n    }\n  }\n\n  /**\n   * Add steps for the right side of a row that does not have value or\n   * statement input connections.\n   *\n   * @param row The row to draw the side of.\n   */\n  protected override drawRightSideRow_(row: Row) {\n    if (row.height <= 0) {\n      return;\n    }\n    if (Types.isSpacer(row)) {\n      const spacerRow = row as SpacerRow;\n      if (spacerRow.precedesStatement || spacerRow.followsStatement) {\n        const cornerHeight =\n            (this.constants_.INSIDE_CORNERS as InsideCorners).rightHeight;\n        const remainingHeight =\n            spacerRow.height - (spacerRow.precedesStatement ? cornerHeight : 0);\n        this.outlinePath_ +=\n            (spacerRow.followsStatement ?\n                 (this.constants_.INSIDE_CORNERS as InsideCorners)\n                     .pathBottomRight :\n                 '') +\n            (remainingHeight > 0 ?\n                 svgPaths.lineOnAxis('V', spacerRow.yPos + remainingHeight) :\n                 '') +\n            (spacerRow.precedesStatement ?\n                 (this.constants_.INSIDE_CORNERS as InsideCorners)\n                     .pathTopRight :\n                 '');\n        return;\n      }\n    }\n    this.outlinePath_ += svgPaths.lineOnAxis('V', row.yPos + row.height);\n  }\n\n  /**\n   * Add steps to draw the right side of an output with a dynamic connection.\n   */\n  protected drawRightDynamicConnection_() {\n    if (!this.info_.outputConnection) {\n      throw new Error(\n          `Cannot draw the output connection of a block that doesn't have one`);\n    }\n    this.outlinePath_ += (this.info_.outputConnection.shape as DynamicShape)\n                             .pathRightDown(this.info_.outputConnection.height);\n  }\n\n  /**\n   * Add steps to draw the left side of an output with a dynamic connection.\n   */\n  protected drawLeftDynamicConnection_() {\n    if (!this.info_.outputConnection) {\n      throw new Error(\n          `Cannot draw the output connection of a block that doesn't have one`);\n    }\n    this.positionOutputConnection_();\n\n    this.outlinePath_ += (this.info_.outputConnection.shape as DynamicShape)\n                             .pathUp(this.info_.outputConnection.height);\n\n    // Close off the path.  This draws a vertical line up to the start of the\n    // block's path, which may be either a rounded or a sharp corner.\n    this.outlinePath_ += 'z';\n  }\n\n  /** Add steps to draw a flat top row. */\n  protected drawFlatTop_() {\n    const topRow = this.info_.topRow;\n    this.positionPreviousConnection_();\n\n    this.outlinePath_ += svgPaths.moveBy(topRow.xPos, this.info_.startY);\n\n    this.outlinePath_ += svgPaths.lineOnAxis('h', topRow.width);\n  }\n\n  /** Add steps to draw a flat bottom row. */\n  protected drawFlatBottom_() {\n    const bottomRow = this.info_.bottomRow;\n    this.positionNextConnection_();\n\n    this.outlinePath_ += svgPaths.lineOnAxis('V', bottomRow.baseline);\n\n    this.outlinePath_ += svgPaths.lineOnAxis('h', -bottomRow.width);\n  }\n\n  override drawInlineInput_(input: InlineInput) {\n    this.positionInlineInputConnection_(input);\n\n    const inputName = input.input.name;\n    if (input.connectedBlock || this.info_.isInsertionMarker) {\n      return;\n    }\n\n    const width = input.width - input.connectionWidth * 2;\n    const height = input.height;\n    const yPos = input.centerline - height / 2;\n\n    const connectionRight = input.xPos + input.connectionWidth;\n\n    const outlinePath = svgPaths.moveTo(connectionRight, yPos) +\n        svgPaths.lineOnAxis('h', width) +\n        (input.shape as DynamicShape).pathRightDown(input.height) +\n        svgPaths.lineOnAxis('h', -width) +\n        (input.shape as DynamicShape).pathUp(input.height) + 'z';\n    const pathObject = this.block_.pathObject as PathObject;\n    pathObject.setOutlinePath(inputName, outlinePath);\n  }\n\n  override drawStatementInput_(row: Row) {\n    const input = row.getLastInput() as StatementInput;\n    // Where to start drawing the notch, which is on the right side in LTR.\n    const x = input.xPos + input.notchOffset + (input.shape as BaseShape).width;\n\n    const innerTopLeftCorner = (input.shape as Notch).pathRight +\n        svgPaths.lineOnAxis(\n            'h', -(input.notchOffset - this.constants_.INSIDE_CORNERS.width)) +\n        this.constants_.INSIDE_CORNERS.pathTop;\n\n    const innerHeight = row.height - 2 * this.constants_.INSIDE_CORNERS.height;\n\n    const innerBottomLeftCorner = this.constants_.INSIDE_CORNERS.pathBottom +\n        svgPaths.lineOnAxis(\n            'h', input.notchOffset - this.constants_.INSIDE_CORNERS.width) +\n        (input.connectedBottomNextConnection ? '' :\n                                               (input.shape as Notch).pathLeft);\n\n    this.outlinePath_ += svgPaths.lineOnAxis('H', x) + innerTopLeftCorner +\n        svgPaths.lineOnAxis('v', innerHeight) + innerBottomLeftCorner +\n        svgPaths.lineOnAxis('H', row.xPos + row.width);\n\n    this.positionStatementInputConnection_(row);\n  }\n}\n","/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Image field.  Used for pictures, icons, etc.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.FieldImage');\n\nimport {Field, FieldConfig} from './field.js';\nimport * as fieldRegistry from './field_registry.js';\nimport * as dom from './utils/dom.js';\nimport * as parsing from './utils/parsing.js';\nimport type {Sentinel} from './utils/sentinel.js';\nimport {Size} from './utils/size.js';\nimport {Svg} from './utils/svg.js';\n\n/**\n * Class for an image on a block.\n *\n * @alias Blockly.FieldImage\n */\nexport class FieldImage extends Field<string> {\n  /**\n   * Vertical padding below the image, which is included in the reported height\n   * of the field.\n   */\n  private static readonly Y_PADDING = 1;\n  protected override size_: Size;\n  private readonly imageHeight_: number;\n\n  /** The function to be called when this field is clicked. */\n  private clickHandler_: ((p1: FieldImage) => AnyDuringMigration)|null = null;\n\n  /** The rendered field's image element. */\n  // AnyDuringMigration because:  Type 'null' is not assignable to type\n  // 'SVGImageElement'.\n  private imageElement_: SVGImageElement = null as AnyDuringMigration;\n\n  /**\n   * Editable fields usually show some sort of UI indicating they are\n   * editable. This field should not.\n   */\n  override readonly EDITABLE = false;\n\n  /**\n   * Used to tell if the field needs to be rendered the next time the block is\n   * rendered. Image fields are statically sized, and only need to be\n   * rendered at initialization.\n   */\n  protected override isDirty_ = false;\n\n  /** Whether to flip this image in RTL. */\n  private flipRtl_ = false;\n\n  /** Alt text of this image. */\n  private altText_ = '';\n  override value_: AnyDuringMigration;\n\n  /**\n   * @param src The URL of the image.\n   *     Also accepts Field.SKIP_SETUP if you wish to skip setup (only used by\n   * subclasses that want to handle configuration and setting the field value\n   * after their own constructors have run).\n   * @param width Width of the image.\n   * @param height Height of the image.\n   * @param opt_alt Optional alt text for when block is collapsed.\n   * @param opt_onClick Optional function to be called when the image is\n   *     clicked. If opt_onClick is defined, opt_alt must also be defined.\n   * @param opt_flipRtl Whether to flip the icon in RTL.\n   * @param opt_config A map of options used to configure the field.\n   *     See the [field creation documentation]{@link\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/image#creation}\n   * for a list of properties this parameter supports.\n   */\n  constructor(\n      src: string|Sentinel, width: string|number, height: string|number,\n      opt_alt?: string, opt_onClick?: (p1: FieldImage) => AnyDuringMigration,\n      opt_flipRtl?: boolean, opt_config?: FieldImageConfig) {\n    super(Field.SKIP_SETUP);\n\n    const imageHeight = Number(parsing.replaceMessageReferences(height));\n    const imageWidth = Number(parsing.replaceMessageReferences(width));\n    if (isNaN(imageHeight) || isNaN(imageWidth)) {\n      throw Error(\n          'Height and width values of an image field must cast to' +\n          ' numbers.');\n    }\n    if (imageHeight <= 0 || imageWidth <= 0) {\n      throw Error(\n          'Height and width values of an image field must be greater' +\n          ' than 0.');\n    }\n\n    /** The size of the area rendered by the field. */\n    this.size_ = new Size(imageWidth, imageHeight + FieldImage.Y_PADDING);\n\n    /**\n     * Store the image height, since it is different from the field height.\n     */\n    this.imageHeight_ = imageHeight;\n\n    if (typeof opt_onClick === 'function') {\n      this.clickHandler_ = opt_onClick;\n    }\n\n    if (src === Field.SKIP_SETUP) {\n      return;\n    }\n\n    if (opt_config) {\n      this.configure_(opt_config);\n    } else {\n      this.flipRtl_ = !!opt_flipRtl;\n      this.altText_ = parsing.replaceMessageReferences(opt_alt) || '';\n    }\n    this.setValue(parsing.replaceMessageReferences(src));\n  }\n\n  /**\n   * Configure the field based on the given map of options.\n   *\n   * @param config A map of options to configure the field based on.\n   */\n  protected override configure_(config: FieldImageConfig) {\n    super.configure_(config);\n    if (config.flipRtl) this.flipRtl_ = config.flipRtl;\n    if (config.alt) {\n      this.altText_ = parsing.replaceMessageReferences(config.alt);\n    }\n  }\n\n  /**\n   * Create the block UI for this image.\n   *\n   * @internal\n   */\n  override initView() {\n    this.imageElement_ = dom.createSvgElement(\n        Svg.IMAGE, {\n          'height': this.imageHeight_ + 'px',\n          'width': this.size_.width + 'px',\n          'alt': this.altText_,\n        },\n        this.fieldGroup_);\n    this.imageElement_.setAttributeNS(\n        dom.XLINK_NS, 'xlink:href', this.value_ as string);\n\n    if (this.clickHandler_) {\n      this.imageElement_.style.cursor = 'pointer';\n    }\n  }\n\n  override updateSize_() {}\n  // NOP\n\n  /**\n   * Ensure that the input value (the source URL) is a string.\n   *\n   * @param opt_newValue The input value.\n   * @returns A string, or null if invalid.\n   */\n  protected override doClassValidation_(opt_newValue?: AnyDuringMigration):\n      string|null {\n    if (typeof opt_newValue !== 'string') {\n      return null;\n    }\n    return opt_newValue;\n  }\n\n  /**\n   * Update the value of this image field, and update the displayed image.\n   *\n   * @param newValue The value to be saved. The default validator guarantees\n   *     that this is a string.\n   */\n  protected override doValueUpdate_(newValue: AnyDuringMigration) {\n    this.value_ = newValue;\n    if (this.imageElement_) {\n      this.imageElement_.setAttributeNS(\n          dom.XLINK_NS, 'xlink:href', String(this.value_));\n    }\n  }\n\n  /**\n   * Get whether to flip this image in RTL\n   *\n   * @returns True if we should flip in RTL.\n   */\n  override getFlipRtl(): boolean {\n    return this.flipRtl_;\n  }\n\n  /**\n   * Set the alt text of this image.\n   *\n   * @param alt New alt text.\n   */\n  setAlt(alt: string|null) {\n    if (alt === this.altText_) {\n      return;\n    }\n    this.altText_ = alt || '';\n    if (this.imageElement_) {\n      this.imageElement_.setAttribute('alt', this.altText_);\n    }\n  }\n\n  /**\n   * If field click is called, and click handler defined,\n   * call the handler.\n   */\n  protected override showEditor_() {\n    if (this.clickHandler_) {\n      this.clickHandler_(this);\n    }\n  }\n\n  /**\n   * Set the function that is called when this image  is clicked.\n   *\n   * @param func The function that is called when the image is clicked, or null\n   *     to remove.\n   */\n  setOnClickHandler(func: ((p1: FieldImage) => AnyDuringMigration)|null) {\n    this.clickHandler_ = func;\n  }\n\n  /**\n   * Use the `getText_` developer hook to override the field's text\n   * representation.\n   * Return the image alt text instead.\n   *\n   * @returns The image alt text.\n   */\n  protected override getText_(): string|null {\n    return this.altText_;\n  }\n\n  /**\n   * Construct a FieldImage from a JSON arg object,\n   * dereferencing any string table references.\n   *\n   * @param options A JSON object with options (src, width, height, alt, and\n   *     flipRtl).\n   * @returns The new field instance.\n   * @nocollapse\n   * @internal\n   */\n  static fromJson(options: FieldImageFromJsonConfig): FieldImage {\n    if (!options.src || !options.width || !options.height) {\n      throw new Error(\n          'src, width, and height values for an image field are' +\n          'required. The width and height must be non-zero.');\n    }\n    // `this` might be a subclass of FieldImage if that class doesn't override\n    // the static fromJson method.\n    return new this(\n        options.src, options.width, options.height, undefined, undefined,\n        undefined, options);\n  }\n}\n\nfieldRegistry.register('field_image', FieldImage);\n\nFieldImage.prototype.DEFAULT_VALUE = '';\n\n/**\n * Config options for the image field.\n */\nexport interface FieldImageConfig extends FieldConfig {\n  flipRtl?: boolean;\n  alt?: string;\n}\n\n/**\n * fromJson config options for the colour field.\n */\nexport interface FieldImageFromJsonConfig extends FieldImageConfig {\n  src?: string;\n  width?: number;\n  height?: number;\n}\n","/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Text input field.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.FieldInput');\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_change.js';\n\nimport type {BlockSvg} from './block_svg.js';\nimport * as browserEvents from './browser_events.js';\nimport * as dialog from './dialog.js';\nimport * as dom from './utils/dom.js';\nimport * as dropDownDiv from './dropdowndiv.js';\nimport * as eventUtils from './events/utils.js';\nimport {Field, FieldConfig, FieldValidator, UnattachedFieldError} from './field.js';\nimport {Msg} from './msg.js';\nimport * as aria from './utils/aria.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport {KeyCodes} from './utils/keycodes.js';\nimport type {Sentinel} from './utils/sentinel.js';\nimport * as userAgent from './utils/useragent.js';\nimport * as WidgetDiv from './widgetdiv.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\nexport type InputTypes = string|number;\nexport type FieldInputValidator<T extends InputTypes> = FieldValidator<T>;\n\n/**\n * Class for an editable text field.\n *\n * @alias Blockly.FieldInput\n */\nexport abstract class FieldInput<T extends InputTypes> extends Field<T> {\n  /**\n   * Pixel size of input border radius.\n   * Should match blocklyText's border-radius in CSS.\n   */\n  static BORDERRADIUS = 4;\n\n  /** Allow browser to spellcheck this field. */\n  protected spellcheck_ = true;\n\n  /** The HTML input element. */\n  protected htmlInput_: HTMLInputElement|null = null;\n\n  /** True if the field's value is currently being edited via the UI. */\n  protected isBeingEdited_ = false;\n\n  /**\n   * True if the value currently displayed in the field's editory UI is valid.\n   */\n  protected isTextValid_ = false;\n\n  /** Key down event data. */\n  private onKeyDownWrapper_: browserEvents.Data|null = null;\n\n  /** Key input event data. */\n  private onKeyInputWrapper_: browserEvents.Data|null = null;\n\n  /**\n   * Whether the field should consider the whole parent block to be its click\n   * target.\n   */\n  fullBlockClickTarget_: boolean|null = false;\n\n  /** The workspace that this field belongs to. */\n  protected workspace_: WorkspaceSvg|null = null;\n\n  /**\n   * Serializable fields are saved by the serializer, non-serializable fields\n   * are not. Editable fields should also be serializable.\n   */\n  override SERIALIZABLE = true;\n\n  /** Mouse cursor style when over the hotspot that initiates the editor. */\n  override CURSOR = 'text';\n  override clickTarget_: AnyDuringMigration;\n  override value_: AnyDuringMigration;\n  override isDirty_: AnyDuringMigration;\n\n  /**\n   * @param opt_value The initial value of the field. Should cast to a string.\n   *     Defaults to an empty string if null or undefined. Also accepts\n   *     Field.SKIP_SETUP if you wish to skip setup (only used by subclasses\n   *     that want to handle configuration and setting the field value after\n   *     their own constructors have run).\n   * @param opt_validator A function that is called to validate changes to the\n   *     field's value. Takes in a string & returns a validated string, or null\n   *     to abort the change.\n   * @param opt_config A map of options used to configure the field.\n   *     See the [field creation documentation]{@link\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/text-input#creation}\n   * for a list of properties this parameter supports.\n   */\n  constructor(\n      opt_value?: string|Sentinel, opt_validator?: FieldInputValidator<T>|null,\n      opt_config?: FieldInputConfig) {\n    super(Field.SKIP_SETUP);\n\n    if (opt_value === Field.SKIP_SETUP) {\n      return;\n    }\n    if (opt_config) {\n      this.configure_(opt_config);\n    }\n    this.setValue(opt_value);\n    if (opt_validator) {\n      this.setValidator(opt_validator);\n    }\n  }\n\n  protected override configure_(config: FieldInputConfig) {\n    super.configure_(config);\n    if (config.spellcheck !== undefined) {\n      this.spellcheck_ = config.spellcheck;\n    }\n  }\n\n  /** @internal */\n  override initView() {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    if (this.getConstants()!.FULL_BLOCK_FIELDS) {\n      // Step one: figure out if this is the only field on this block.\n      // Rendering is quite different in that case.\n      let nFields = 0;\n      let nConnections = 0;\n      // Count the number of fields, excluding text fields\n      for (let i = 0, input; input = block.inputList[i]; i++) {\n        for (let j = 0; input.fieldRow[j]; j++) {\n          nFields++;\n        }\n        if (input.connection) {\n          nConnections++;\n        }\n      }\n      // The special case is when this is the only non-label field on the block\n      // and it has an output but no inputs.\n      this.fullBlockClickTarget_ =\n          nFields <= 1 && block.outputConnection && !nConnections;\n    } else {\n      this.fullBlockClickTarget_ = false;\n    }\n\n    if (this.fullBlockClickTarget_) {\n      this.clickTarget_ = (this.sourceBlock_ as BlockSvg).getSvgRoot();\n    } else {\n      this.createBorderRect_();\n    }\n    this.createTextElement_();\n  }\n\n  /**\n   * Ensure that the input value casts to a valid string.\n   *\n   * @param opt_newValue The input value.\n   * @returns A valid string, or null if invalid.\n   */\n  protected override doClassValidation_(opt_newValue?: AnyDuringMigration):\n      AnyDuringMigration {\n    if (opt_newValue === null || opt_newValue === undefined) {\n      return null;\n    }\n    return String(opt_newValue);\n  }\n\n  /**\n   * Called by setValue if the text input is not valid. If the field is\n   * currently being edited it reverts value of the field to the previous\n   * value while allowing the display text to be handled by the htmlInput_.\n   *\n   * @param _invalidValue The input value that was determined to be invalid.\n   *    This is not used by the text input because its display value is stored\n   * on the htmlInput_.\n   */\n  protected override doValueInvalid_(_invalidValue: AnyDuringMigration) {\n    if (this.isBeingEdited_) {\n      this.isDirty_ = true;\n      this.isTextValid_ = false;\n      const oldValue = this.value_;\n      // Revert value when the text becomes invalid.\n      this.value_ = this.htmlInput_!.getAttribute('data-untyped-default-value');\n      if (this.sourceBlock_ && eventUtils.isEnabled()) {\n        eventUtils.fire(new (eventUtils.get(eventUtils.BLOCK_CHANGE))(\n            this.sourceBlock_, 'field', this.name || null, oldValue,\n            this.value_));\n      }\n    }\n  }\n\n  /**\n   * Called by setValue if the text input is valid. Updates the value of the\n   * field, and updates the text of the field if it is not currently being\n   * edited (i.e. handled by the htmlInput_).\n   *\n   * @param newValue The value to be saved. The default validator guarantees\n   *     that this is a string.\n   */\n  protected override doValueUpdate_(newValue: AnyDuringMigration) {\n    this.isDirty_ = true;\n    this.isTextValid_ = true;\n    this.value_ = newValue;\n  }\n\n  /**\n   * Updates text field to match the colour/style of the block.\n   *\n   * @internal\n   */\n  override applyColour() {\n    if (!this.sourceBlock_ || !this.getConstants()!.FULL_BLOCK_FIELDS) return;\n\n    const source = this.sourceBlock_ as BlockSvg;\n\n    if (this.borderRect_) {\n      this.borderRect_.setAttribute('stroke', source.style.colourTertiary);\n    } else {\n      source.pathObject.svgPath.setAttribute(\n          'fill', this.getConstants()!.FIELD_BORDER_RECT_COLOUR);\n    }\n  }\n\n  /**\n   * Updates the colour of the htmlInput given the current validity of the\n   * field's value.\n   */\n  protected override render_() {\n    super.render_();\n    // This logic is done in render_ rather than doValueInvalid_ or\n    // doValueUpdate_ so that the code is more centralized.\n    if (this.isBeingEdited_) {\n      this.resizeEditor_();\n      const htmlInput = this.htmlInput_ as HTMLElement;\n      if (!this.isTextValid_) {\n        dom.addClass(htmlInput, 'blocklyInvalidInput');\n        aria.setState(htmlInput, aria.State.INVALID, true);\n      } else {\n        dom.removeClass(htmlInput, 'blocklyInvalidInput');\n        aria.setState(htmlInput, aria.State.INVALID, false);\n      }\n    }\n  }\n\n  /**\n   * Set whether this field is spellchecked by the browser.\n   *\n   * @param check True if checked.\n   */\n  setSpellcheck(check: boolean) {\n    if (check === this.spellcheck_) {\n      return;\n    }\n    this.spellcheck_ = check;\n    if (this.htmlInput_) {\n      // AnyDuringMigration because:  Argument of type 'boolean' is not\n      // assignable to parameter of type 'string'.\n      this.htmlInput_.setAttribute(\n          'spellcheck', this.spellcheck_ as AnyDuringMigration);\n    }\n  }\n\n  /**\n   * Show an editor for the field.\n   * Shows the inline free-text editor on top of the text by default.\n   * Shows a prompt editor for mobile browsers if the modalInputs option is\n   * enabled.\n   *\n   * @param _opt_e Optional mouse event that triggered the field to open, or\n   *     undefined if triggered programmatically.\n   * @param opt_quietInput True if editor should be created without focus.\n   *     Defaults to false.\n   */\n  protected override showEditor_(_opt_e?: Event, opt_quietInput?: boolean) {\n    this.workspace_ = (this.sourceBlock_ as BlockSvg).workspace;\n    const quietInput = opt_quietInput || false;\n    if (!quietInput && this.workspace_.options.modalInputs &&\n        (userAgent.MOBILE || userAgent.ANDROID || userAgent.IPAD)) {\n      this.showPromptEditor_();\n    } else {\n      this.showInlineEditor_(quietInput);\n    }\n  }\n\n  /**\n   * Create and show a text input editor that is a prompt (usually a popup).\n   * Mobile browsers may have issues with in-line textareas (focus and\n   * keyboards).\n   */\n  private showPromptEditor_() {\n    dialog.prompt(\n        Msg['CHANGE_VALUE_TITLE'], this.getText(), (text: string|null) => {\n          // Text is null if user pressed cancel button.\n          if (text !== null) {\n            this.setValue(this.getValueFromEditorText_(text));\n          }\n        });\n  }\n\n  /**\n   * Create and show a text input editor that sits directly over the text input.\n   *\n   * @param quietInput True if editor should be created without focus.\n   */\n  private showInlineEditor_(quietInput: boolean) {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    WidgetDiv.show(this, block.RTL, this.widgetDispose_.bind(this));\n    this.htmlInput_ = this.widgetCreate_() as HTMLInputElement;\n    this.isBeingEdited_ = true;\n\n    if (!quietInput) {\n      (this.htmlInput_ as HTMLElement).focus({\n        preventScroll: true,\n      });\n      this.htmlInput_.select();\n    }\n  }\n\n  /**\n   * Create the text input editor widget.\n   *\n   * @returns The newly created text input editor.\n   */\n  protected widgetCreate_(): HTMLElement {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    eventUtils.setGroup(true);\n    const div = WidgetDiv.getDiv();\n\n    const clickTarget = this.getClickTarget_();\n    if (!clickTarget) throw new Error('A click target has not been set.');\n    dom.addClass(clickTarget, 'editing');\n\n    const htmlInput = (document.createElement('input'));\n    htmlInput.className = 'blocklyHtmlInput';\n    // AnyDuringMigration because:  Argument of type 'boolean' is not assignable\n    // to parameter of type 'string'.\n    htmlInput.setAttribute(\n        'spellcheck', this.spellcheck_ as AnyDuringMigration);\n    const scale = this.workspace_!.getScale();\n    const fontSize = this.getConstants()!.FIELD_TEXT_FONTSIZE * scale + 'pt';\n    div!.style.fontSize = fontSize;\n    htmlInput.style.fontSize = fontSize;\n    let borderRadius = FieldInput.BORDERRADIUS * scale + 'px';\n\n    if (this.fullBlockClickTarget_) {\n      const bBox = this.getScaledBBox();\n\n      // Override border radius.\n      borderRadius = (bBox.bottom - bBox.top) / 2 + 'px';\n      // Pull stroke colour from the existing shadow block\n      const strokeColour = block.getParent() ?\n          (block.getParent() as BlockSvg).style.colourTertiary :\n          (this.sourceBlock_ as BlockSvg).style.colourTertiary;\n      htmlInput.style.border = 1 * scale + 'px solid ' + strokeColour;\n      div!.style.borderRadius = borderRadius;\n      div!.style.transition = 'box-shadow 0.25s ease 0s';\n      if (this.getConstants()!.FIELD_TEXTINPUT_BOX_SHADOW) {\n        div!.style.boxShadow =\n            'rgba(255, 255, 255, 0.3) 0 0 0 ' + 4 * scale + 'px';\n      }\n    }\n    htmlInput.style.borderRadius = borderRadius;\n\n    div!.appendChild(htmlInput);\n\n    htmlInput.value = htmlInput.defaultValue = this.getEditorText_(this.value_);\n    htmlInput.setAttribute('data-untyped-default-value', this.value_);\n\n    this.resizeEditor_();\n\n    this.bindInputEvents_(htmlInput);\n\n    return htmlInput;\n  }\n\n  /**\n   * Closes the editor, saves the results, and disposes of any events or\n   * DOM-references belonging to the editor.\n   */\n  protected widgetDispose_() {\n    // Non-disposal related things that we do when the editor closes.\n    this.isBeingEdited_ = false;\n    this.isTextValid_ = true;\n    // Make sure the field's node matches the field's internal value.\n    this.forceRerender();\n    this.onFinishEditing_(this.value_);\n    eventUtils.setGroup(false);\n\n    // Actual disposal.\n    this.unbindInputEvents_();\n    const style = WidgetDiv.getDiv()!.style;\n    style.width = 'auto';\n    style.height = 'auto';\n    style.fontSize = '';\n    style.transition = '';\n    style.boxShadow = '';\n    this.htmlInput_ = null;\n\n    const clickTarget = this.getClickTarget_();\n    if (!clickTarget) throw new Error('A click target has not been set.');\n    dom.removeClass(clickTarget, 'editing');\n  }\n\n  /**\n   * A callback triggered when the user is done editing the field via the UI.\n   *\n   * @param _value The new value of the field.\n   */\n  onFinishEditing_(_value: AnyDuringMigration) {}\n  // NOP by default.\n  // TODO(#2496): Support people passing a func into the field.\n\n  /**\n   * Bind handlers for user input on the text input field's editor.\n   *\n   * @param htmlInput The htmlInput to which event handlers will be bound.\n   */\n  protected bindInputEvents_(htmlInput: HTMLElement) {\n    // Trap Enter without IME and Esc to hide.\n    this.onKeyDownWrapper_ = browserEvents.conditionalBind(\n        htmlInput, 'keydown', this, this.onHtmlInputKeyDown_);\n    // Resize after every input change.\n    this.onKeyInputWrapper_ = browserEvents.conditionalBind(\n        htmlInput, 'input', this, this.onHtmlInputChange_);\n  }\n\n  /** Unbind handlers for user input and workspace size changes. */\n  protected unbindInputEvents_() {\n    if (this.onKeyDownWrapper_) {\n      browserEvents.unbind(this.onKeyDownWrapper_);\n      this.onKeyDownWrapper_ = null;\n    }\n    if (this.onKeyInputWrapper_) {\n      browserEvents.unbind(this.onKeyInputWrapper_);\n      this.onKeyInputWrapper_ = null;\n    }\n  }\n\n  /**\n   * Handle key down to the editor.\n   *\n   * @param e Keyboard event.\n   */\n  protected onHtmlInputKeyDown_(e: Event) {\n    // AnyDuringMigration because:  Property 'keyCode' does not exist on type\n    // 'Event'.\n    if ((e as AnyDuringMigration).keyCode === KeyCodes.ENTER) {\n      WidgetDiv.hide();\n      dropDownDiv.hideWithoutAnimation();\n      // AnyDuringMigration because:  Property 'keyCode' does not exist on type\n      // 'Event'.\n    } else if ((e as AnyDuringMigration).keyCode === KeyCodes.ESC) {\n      this.setValue(\n          this.htmlInput_!.getAttribute('data-untyped-default-value'));\n      WidgetDiv.hide();\n      dropDownDiv.hideWithoutAnimation();\n      // AnyDuringMigration because:  Property 'keyCode' does not exist on type\n      // 'Event'.\n    } else if ((e as AnyDuringMigration).keyCode === KeyCodes.TAB) {\n      WidgetDiv.hide();\n      dropDownDiv.hideWithoutAnimation();\n      // AnyDuringMigration because:  Property 'shiftKey' does not exist on type\n      // 'Event'. AnyDuringMigration because:  Argument of type 'this' is not\n      // assignable to parameter of type 'Field'.\n      (this.sourceBlock_ as BlockSvg)\n          .tab(this as AnyDuringMigration, !(e as AnyDuringMigration).shiftKey);\n      e.preventDefault();\n    }\n  }\n\n  /**\n   * Handle a change to the editor.\n   *\n   * @param _e Keyboard event.\n   */\n  private onHtmlInputChange_(_e: Event) {\n    this.setValue(this.getValueFromEditorText_(this.htmlInput_!.value));\n  }\n\n  /**\n   * Set the HTML input value and the field's internal value. The difference\n   * between this and `setValue` is that this also updates the HTML input\n   * value whilst editing.\n   *\n   * @param newValue New value.\n   */\n  protected setEditorValue_(newValue: AnyDuringMigration) {\n    this.isDirty_ = true;\n    if (this.isBeingEdited_) {\n      // In the case this method is passed an invalid value, we still\n      // pass it through the transformation method `getEditorText` to deal\n      // with. Otherwise, the internal field's state will be inconsistent\n      // with what's shown to the user.\n      this.htmlInput_!.value = this.getEditorText_(newValue);\n    }\n    this.setValue(newValue);\n  }\n\n  /** Resize the editor to fit the text. */\n  protected resizeEditor_() {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    const div = WidgetDiv.getDiv();\n    const bBox = this.getScaledBBox();\n    div!.style.width = bBox.right - bBox.left + 'px';\n    div!.style.height = bBox.bottom - bBox.top + 'px';\n\n    // In RTL mode block fields and LTR input fields the left edge moves,\n    // whereas the right edge is fixed.  Reposition the editor.\n    const x = block.RTL ? bBox.right - div!.offsetWidth : bBox.left;\n    const xy = new Coordinate(x, bBox.top);\n\n    div!.style.left = xy.x + 'px';\n    div!.style.top = xy.y + 'px';\n  }\n\n  /**\n   * Returns whether or not the field is tab navigable.\n   *\n   * @returns True if the field is tab navigable.\n   */\n  override isTabNavigable(): boolean {\n    return true;\n  }\n\n  /**\n   * Use the `getText_` developer hook to override the field's text\n   * representation. When we're currently editing, return the current HTML value\n   * instead. Otherwise, return null which tells the field to use the default\n   * behaviour (which is a string cast of the field's value).\n   *\n   * @returns The HTML value if we're editing, otherwise null.\n   */\n  protected override getText_(): string|null {\n    if (this.isBeingEdited_ && this.htmlInput_) {\n      // We are currently editing, return the HTML input value instead.\n      return this.htmlInput_.value;\n    }\n    return null;\n  }\n\n  /**\n   * Transform the provided value into a text to show in the HTML input.\n   * Override this method if the field's HTML input representation is different\n   * than the field's value. This should be coupled with an override of\n   * `getValueFromEditorText_`.\n   *\n   * @param value The value stored in this field.\n   * @returns The text to show on the HTML input.\n   */\n  protected getEditorText_(value: AnyDuringMigration): string {\n    return String(value);\n  }\n\n  /**\n   * Transform the text received from the HTML input into a value to store\n   * in this field.\n   * Override this method if the field's HTML input representation is different\n   * than the field's value. This should be coupled with an override of\n   * `getEditorText_`.\n   *\n   * @param text Text received from the HTML input.\n   * @returns The value to store.\n   */\n  protected getValueFromEditorText_(text: string): AnyDuringMigration {\n    return text;\n  }\n}\n\n/**\n * Config options for the input field.\n */\nexport interface FieldInputConfig extends FieldConfig {\n  spellcheck?: boolean;\n}\n","/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Text input field.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.FieldTextInput');\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_change.js';\n\nimport {FieldInput, FieldInputConfig, FieldInputValidator} from './field_input.js';\nimport * as fieldRegistry from './field_registry.js';\nimport * as parsing from './utils/parsing.js';\nimport type {Sentinel} from './utils/sentinel.js';\n\nexport type FieldTextInputValidator = FieldInputValidator<string>;\n\nexport class FieldTextInput extends FieldInput<string> {\n  /**\n   * @param opt_value The initial value of the field. Should cast to a string.\n   *     Defaults to an empty string if null or undefined. Also accepts\n   *     Field.SKIP_SETUP if you wish to skip setup (only used by subclasses\n   *     that want to handle configuration and setting the field value after\n   *     their own constructors have run).\n   * @param opt_validator A function that is called to validate changes to the\n   *     field's value. Takes in a string & returns a validated string, or null\n   *     to abort the change.\n   * @param opt_config A map of options used to configure the field.\n   *     See the [field creation documentation]{@link\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/text-input#creation}\n   * for a list of properties this parameter supports.\n   */\n  constructor(\n      opt_value?: string|Sentinel, opt_validator?: FieldTextInputValidator|null,\n      opt_config?: FieldInputConfig) {\n    super(opt_value, opt_validator, opt_config);\n  }\n\n  /**\n   * Construct a FieldTextInput from a JSON arg object,\n   * dereferencing any string table references.\n   *\n   * @param options A JSON object with options (text, and spellcheck).\n   * @returns The new field instance.\n   * @nocollapse\n   * @internal\n   */\n  static fromJson(options: FieldTextInputFromJsonConfig): FieldTextInput {\n    const text = parsing.replaceMessageReferences(options.text);\n    // `this` might be a subclass of FieldTextInput if that class doesn't\n    // override the static fromJson method.\n    return new this(text, undefined, options);\n  }\n}\n\nfieldRegistry.register('field_input', FieldTextInput);\n\nFieldTextInput.prototype.DEFAULT_VALUE = '';\n\n/**\n * fromJson config options for the text input field.\n */\nexport interface FieldTextInputFromJsonConfig extends FieldInputConfig {\n  text?: string;\n}\n\nexport {FieldInputConfig as FieldTextInputConfig};\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * An object representing the bottom row of a rendered block.\n *\n * @class\n */\nimport * as goog from '../../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.zelos.BottomRow');\n\nimport type {BlockSvg} from '../../../block_svg.js';\nimport type {ConstantProvider} from '../../../renderers/common/constants.js';\nimport {BottomRow as BaseBottomRow} from '../../../renderers/measurables/bottom_row.js';\n\n\n/**\n * An object containing information about what elements are in the bottom row of\n * a block as well as spacing information for the top row.\n * Elements in a bottom row can consist of corners, spacers and next\n * connections.\n *\n * @alias Blockly.zelos.BottomRow\n */\nexport class BottomRow extends BaseBottomRow {\n  /**\n   * @param constants The rendering constants provider.\n   * @internal\n   */\n  constructor(constants: ConstantProvider) {\n    super(constants);\n  }\n\n  override endsWithElemSpacer() {\n    return false;\n  }\n\n  /** Render a round corner unless the block has an output connection. */\n  override hasLeftSquareCorner(block: BlockSvg) {\n    return !!block.outputConnection;\n  }\n\n  /** Render a round corner unless the block has an output connection. */\n  override hasRightSquareCorner(block: BlockSvg) {\n    return !!block.outputConnection && !block.statementInputCount &&\n        !block.nextConnection;\n  }\n}\n","/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Zelos specific objects representing inputs with connections on\n * a rendered block.\n *\n * @class\n */\nimport * as goog from '../../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.zelos.StatementInput');\n\n/* eslint-disable-next-line no-unused-vars */\nimport type {Input} from '../../../input.js';\nimport type {ConstantProvider} from '../../../renderers/common/constants.js';\nimport {StatementInput as BaseStatementInput} from '../../../renderers/measurables/statement_input.js';\n\n\n/**\n * An object containing information about the space a statement input takes up\n * during rendering.\n *\n * @alias Blockly.zelos.StatementInput\n */\nexport class StatementInput extends BaseStatementInput {\n  connectedBottomNextConnection = false;\n\n  /**\n   * @param constants The rendering constants provider.\n   * @param input The statement input to measure and store information for.\n   * @internal\n   */\n  constructor(constants: ConstantProvider, input: Input) {\n    super(constants, input);\n\n    if (this.connectedBlock) {\n      // Find the bottom-most connected block in the stack.\n      let block = this.connectedBlock;\n      let nextBlock;\n      while (nextBlock = block.getNextBlock()) {\n        block = nextBlock;\n      }\n      if (!block.nextConnection) {\n        this.height = this.connectedBlockHeight;\n        this.connectedBottomNextConnection = true;\n      }\n    }\n  }\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Zelos specific objects representing elements in a row of a\n * rendered block.\n *\n * @class\n */\nimport * as goog from '../../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.zelos.RightConnectionShape');\n\nimport type {ConstantProvider} from '../../../renderers/common/constants.js';\nimport {Measurable} from '../../../renderers/measurables/base.js';\nimport {Types} from '../../../renderers/measurables/types.js';\n\n\n/**\n * An object containing information about the space a right connection shape\n * takes up during rendering.\n *\n * @alias Blockly.zelos.RightConnectionShape\n */\nexport class RightConnectionShape extends Measurable {\n  // Size is dynamic\n  override height = 0;\n  override width = 0;\n\n  /**\n   * @param constants The rendering constants provider.\n   * @internal\n   */\n  constructor(constants: ConstantProvider) {\n    super(constants);\n    this.type |= Types.getType('RIGHT_CONNECTION');\n  }\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * An object representing the top row of a rendered block.\n *\n * @class\n */\nimport * as goog from '../../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.zelos.TopRow');\n\nimport type {BlockSvg} from '../../../block_svg.js';\nimport type {ConstantProvider} from '../../../renderers/common/constants.js';\nimport {TopRow as BaseTopRow} from '../../../renderers/measurables/top_row.js';\n\n\n/**\n * An object containing information about what elements are in the top row of a\n * block as well as sizing information for the top row.\n * Elements in a top row can consist of corners, hats, spacers, and previous\n * connections.\n * After this constructor is called, the row will contain all non-spacer\n * elements it needs.\n *\n * @alias Blockly.zelos.TopRow\n */\nexport class TopRow extends BaseTopRow {\n  /**\n   * @param constants The rendering constants provider.\n   * @internal\n   */\n  constructor(constants: ConstantProvider) {\n    super(constants);\n  }\n\n  override endsWithElemSpacer() {\n    return false;\n  }\n\n  /** Render a round corner unless the block has an output connection. */\n  override hasLeftSquareCorner(block: BlockSvg) {\n    const hasHat =\n        (block.hat ? block.hat === 'cap' : this.constants_.ADD_START_HATS) &&\n        !block.outputConnection && !block.previousConnection;\n    return !!block.outputConnection || hasHat;\n  }\n\n  /** Render a round corner unless the block has an output connection. */\n  override hasRightSquareCorner(block: BlockSvg) {\n    return !!block.outputConnection && !block.statementInputCount &&\n        !block.nextConnection;\n  }\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Makecode/scratch-style renderer.\n *\n * @class\n */\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.zelos.RenderInfo');\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport {FieldImage} from '../../field_image.js';\nimport {FieldLabel} from '../../field_label.js';\nimport {FieldTextInput} from '../../field_textinput.js';\nimport {Align, Input} from '../../input.js';\nimport {inputTypes} from '../../input_types.js';\nimport {RenderInfo as BaseRenderInfo} from '../common/info.js';\nimport type {Measurable} from '../measurables/base.js';\nimport {Field} from '../measurables/field.js';\nimport {InRowSpacer} from '../measurables/in_row_spacer.js';\nimport {InputConnection} from '../measurables/input_connection.js';\nimport type {Row} from '../measurables/row.js';\nimport type {SpacerRow} from '../measurables/spacer_row.js';\nimport {Types} from '../measurables/types.js';\n\nimport type {ConstantProvider, InsideCorners} from './constants.js';\nimport {BottomRow} from './measurables/bottom_row.js';\nimport {StatementInput} from './measurables/inputs.js';\nimport {RightConnectionShape} from './measurables/row_elements.js';\nimport {TopRow} from './measurables/top_row.js';\nimport type {PathObject} from './path_object.js';\nimport type {Renderer} from './renderer.js';\n\n\n/**\n * An object containing all sizing information needed to draw this block.\n *\n * This measure pass does not propagate changes to the block (although fields\n * may choose to rerender when getSize() is called).  However, calling it\n * repeatedly may be expensive.\n *\n * @alias Blockly.zelos.RenderInfo\n */\nexport class RenderInfo extends BaseRenderInfo {\n  override topRow: TopRow;\n  override bottomRow: BottomRow;\n  override constants_: ConstantProvider;\n  override renderer_: Renderer;\n\n  override isInline = true;\n  isMultiRow: boolean;\n  hasStatementInput: boolean;\n  rightSide: RightConnectionShape|null;\n  private readonly rightAlignedDummyInputs_: WeakMap<Row, Input>;\n\n  /**\n   * @param renderer The renderer in use.\n   * @param block The block to measure.\n   * @internal\n   */\n  constructor(renderer: Renderer, block: BlockSvg) {\n    super(renderer, block);\n\n    this.renderer_ = renderer;\n\n    this.constants_ = this.renderer_.getConstants();\n\n    /**\n     * An object with rendering information about the top row of the block.\n     */\n    this.topRow = new TopRow(this.constants_);\n\n    /**\n     * An object with rendering information about the bottom row of the block.\n     */\n    this.bottomRow = new BottomRow(this.constants_);\n\n    /**\n     * Whether the block should be rendered as a multi-line block, either\n     * because it's not inline or because it has been collapsed.\n     */\n    this.isMultiRow = !block.getInputsInline() || block.isCollapsed();\n\n    /**\n     * Whether or not the block has a statement input in one of its rows.\n     */\n    this.hasStatementInput = block.statementInputCount > 0;\n\n    /**\n     * An object with rendering information about the right connection shape.\n     */\n    this.rightSide = this.outputConnection ?\n        new RightConnectionShape(this.constants_) :\n        null;\n\n    /**\n     * A map of rows to right aligned dummy inputs within those rows. Used to\n     * add padding between left and right aligned inputs.\n     */\n    this.rightAlignedDummyInputs_ = new WeakMap();\n  }\n\n  /**\n   * Get the block renderer in use.\n   *\n   * @returns The block renderer in use.\n   * @internal\n   */\n  override getRenderer(): Renderer {\n    return this.renderer_ as Renderer;\n  }\n\n  override measure() {\n    // Modifying parent measure method to add `adjustXPosition_`.\n    this.createRows_();\n    this.addElemSpacing_();\n    this.addRowSpacing_();\n    this.adjustXPosition_();\n    this.computeBounds_();\n    this.alignRowElements_();\n    this.finalize_();\n  }\n\n  override shouldStartNewRow_(input: Input, lastInput: Input): boolean {\n    // If this is the first input, just add to the existing row.\n    // That row is either empty or has some icons in it.\n    if (!lastInput) {\n      return false;\n    }\n    // A statement input or an input following one always gets a new row.\n    if (input.type === inputTypes.STATEMENT ||\n        lastInput.type === inputTypes.STATEMENT) {\n      return true;\n    }\n    // Value and dummy inputs get new row if inputs are not inlined.\n    if (input.type === inputTypes.VALUE || input.type === inputTypes.DUMMY) {\n      return !this.isInline || this.isMultiRow;\n    }\n    return false;\n  }\n\n  override getDesiredRowWidth_(row: Row): number {\n    if (row.hasStatement) {\n      const rightCornerWidth =\n          (this.constants_.INSIDE_CORNERS as InsideCorners).rightWidth || 0;\n      return this.width - this.startX - rightCornerWidth;\n    }\n    return super.getDesiredRowWidth_(row);\n  }\n\n  override getInRowSpacing_(prev: Measurable|null, next: Measurable|null):\n      number {\n    if (!prev || !next) {\n      // No need for padding at the beginning or end of the row if the\n      // output shape is dynamic.\n      if (this.outputConnection && this.outputConnection.isDynamicShape &&\n          !this.hasStatementInput && !this.bottomRow.hasNextConnection) {\n        return this.constants_.NO_PADDING;\n      }\n    }\n    if (!prev) {\n      // Statement input padding.\n      if (next && Types.isStatementInput(next)) {\n        return this.constants_.STATEMENT_INPUT_PADDING_LEFT;\n      }\n    }\n    // Spacing between a rounded corner and a previous or next connection.\n    if (prev && Types.isLeftRoundedCorner(prev) && next) {\n      if (Types.isPreviousConnection(next) || Types.isNextConnection(next)) {\n        return next.notchOffset - this.constants_.CORNER_RADIUS;\n      }\n    }\n    // Spacing between a square corner and a hat.\n    if (prev && Types.isLeftSquareCorner(prev) && next && Types.isHat(next)) {\n      return this.constants_.NO_PADDING;\n    }\n    return this.constants_.MEDIUM_PADDING;\n  }\n\n  override getSpacerRowHeight_(prev: Row, next: Row): number {\n    // If we have an empty block add a spacer to increase the height.\n    if (Types.isTopRow(prev) && Types.isBottomRow(next)) {\n      return this.constants_.EMPTY_BLOCK_SPACER_HEIGHT;\n    }\n    const followsStatement = Types.isInputRow(prev) && prev.hasStatement;\n    const precedesStatement = Types.isInputRow(next) && next.hasStatement;\n    if (precedesStatement || followsStatement) {\n      const cornerHeight =\n          (this.constants_.INSIDE_CORNERS as InsideCorners).rightHeight || 0;\n      const height = Math.max(this.constants_.NOTCH_HEIGHT, cornerHeight);\n      return precedesStatement && followsStatement ?\n          Math.max(height, this.constants_.DUMMY_INPUT_MIN_HEIGHT) :\n          height;\n    }\n    // Top and bottom rows act as a spacer so we don't need any extra padding.\n    if (Types.isTopRow(prev)) {\n      const topRow = prev as TopRow;\n      if (!topRow.hasPreviousConnection &&\n          (!this.outputConnection || this.hasStatementInput)) {\n        return Math.abs(\n            this.constants_.NOTCH_HEIGHT - this.constants_.CORNER_RADIUS);\n      }\n      return this.constants_.NO_PADDING;\n    }\n    if (Types.isBottomRow(next)) {\n      const bottomRow = next as BottomRow;\n      if (!this.outputConnection) {\n        const topHeight = Math.max(\n                              this.topRow.minHeight,\n                              Math.max(\n                                  this.constants_.NOTCH_HEIGHT,\n                                  this.constants_.CORNER_RADIUS)) -\n            this.constants_.CORNER_RADIUS;\n        return topHeight;\n      } else if (!bottomRow.hasNextConnection && this.hasStatementInput) {\n        return Math.abs(\n            this.constants_.NOTCH_HEIGHT - this.constants_.CORNER_RADIUS);\n      }\n      return this.constants_.NO_PADDING;\n    }\n    return this.constants_.MEDIUM_PADDING;\n  }\n\n  override getSpacerRowWidth_(prev: Row, next: Row): number {\n    const width = this.width - this.startX;\n    if (Types.isInputRow(prev) && prev.hasStatement ||\n        Types.isInputRow(next) && next.hasStatement) {\n      return Math.max(width, this.constants_.STATEMENT_INPUT_SPACER_MIN_WIDTH);\n    }\n    return width;\n  }\n\n  override getElemCenterline_(row: Row, elem: Measurable): number {\n    if (row.hasStatement && !Types.isSpacer(elem) &&\n        !Types.isStatementInput(elem)) {\n      return row.yPos + this.constants_.EMPTY_STATEMENT_INPUT_HEIGHT / 2;\n    }\n    if (Types.isInlineInput(elem) && elem instanceof InputConnection) {\n      const connectedBlock = elem.connectedBlock;\n      if (connectedBlock && connectedBlock.outputConnection &&\n          connectedBlock.nextConnection) {\n        return row.yPos + connectedBlock.height / 2;\n      }\n    }\n    return super.getElemCenterline_(row, elem);\n  }\n\n  override addInput_(input: Input, activeRow: Row) {\n    // If we have two dummy inputs on the same row, one aligned left and the\n    // other right, keep track of the right aligned dummy input so we can add\n    // padding later.\n    if (input.type === inputTypes.DUMMY && activeRow.hasDummyInput &&\n        activeRow.align === Align.LEFT && input.align === Align.RIGHT) {\n      this.rightAlignedDummyInputs_.set(activeRow, input);\n    } else if (input.type === inputTypes.STATEMENT) {\n      // Handle statements without next connections correctly.\n      activeRow.elements.push(new StatementInput(this.constants_, input));\n      activeRow.hasStatement = true;\n\n      if (activeRow.align === null) {\n        activeRow.align = input.align;\n      }\n      return;\n    }\n    super.addInput_(input, activeRow);\n  }\n\n  override addAlignmentPadding_(row: Row, missingSpace: number) {\n    if (this.rightAlignedDummyInputs_.get(row)) {\n      let alignmentDivider;\n      for (let i = 0; i < row.elements.length; i++) {\n        const elem = row.elements[i];\n        if (Types.isSpacer(elem)) {\n          alignmentDivider = elem;\n        }\n        if (Types.isField(elem) && elem instanceof Field &&\n            elem.parentInput === this.rightAlignedDummyInputs_.get(row)) {\n          break;\n        }\n      }\n      if (alignmentDivider) {\n        alignmentDivider.width += missingSpace;\n        row.width += missingSpace;\n        return;\n      }\n    }\n    super.addAlignmentPadding_(row, missingSpace);\n  }\n\n  /**\n   * Adjust the x position of fields to bump all non-label fields in the first\n   * row past the notch position.  This must be called before `computeBounds`\n   * is called.\n   */\n  protected adjustXPosition_() {\n    const notchTotalWidth =\n        this.constants_.NOTCH_OFFSET_LEFT + this.constants_.NOTCH_WIDTH;\n    let minXPos = notchTotalWidth;\n    // Run through every input row on the block and only apply bump logic to the\n    // first input row (if the block has prev connection) and every input row\n    // that has a prev and next notch.\n    for (let i = 2; i < this.rows.length - 1; i += 2) {\n      const prevSpacer = this.rows[i - 1] as SpacerRow;\n      const row = this.rows[i];\n      const nextSpacer = this.rows[i + 1] as SpacerRow;\n\n      const hasPrevNotch = i === 2 ? !!this.topRow.hasPreviousConnection :\n                                     !!prevSpacer.followsStatement;\n      const hasNextNotch = i + 2 >= this.rows.length - 1 ?\n          !!this.bottomRow.hasNextConnection :\n          !!nextSpacer.precedesStatement;\n\n      if (Types.isInputRow(row) && row.hasStatement) {\n        row.measure();\n        minXPos =\n            row.width - (row.getLastInput()?.width ?? 0) + notchTotalWidth;\n      } else if (\n          hasPrevNotch && (i === 2 || hasNextNotch) && Types.isInputRow(row) &&\n          !row.hasStatement) {\n        let xCursor = row.xPos;\n        let prevInRowSpacer = null;\n        for (let j = 0; j < row.elements.length; j++) {\n          const elem = row.elements[j];\n          if (Types.isSpacer(elem)) {\n            prevInRowSpacer = elem;\n          }\n          if (prevInRowSpacer && (Types.isField(elem) || Types.isInput(elem))) {\n            if (xCursor < minXPos &&\n                !(Types.isField(elem) && elem instanceof Field &&\n                  (elem.field instanceof FieldLabel ||\n                   elem.field instanceof FieldImage))) {\n              const difference = minXPos - xCursor;\n              prevInRowSpacer.width += difference;\n            }\n          }\n          xCursor += elem.width;\n        }\n      }\n    }\n  }\n\n  /**\n   * Finalize the output connection info.  In particular, set the height of the\n   * output connection to match that of the block.  For the right side, add a\n   * right connection shape element and have it match the dimensions of the\n   * output connection.\n   */\n  protected finalizeOutputConnection_() {\n    // Dynamic output connections depend on the height of the block.\n    if (!this.outputConnection || !this.outputConnection.isDynamicShape) {\n      return;\n    }\n    const outputConnectionShape = this.outputConnection.shape;\n    if (!('isDynamic' in outputConnectionShape &&\n          outputConnectionShape.isDynamic)) {\n      return;\n    }\n\n    let yCursor = 0;\n    // Determine the block height.\n    for (let i = 0; i < this.rows.length; i++) {\n      const row = this.rows[i];\n      row.yPos = yCursor;\n      yCursor += row.height;\n    }\n    this.height = yCursor;\n\n    // Adjust the height of the output connection.\n    const blockHeight = this.bottomRow.hasNextConnection ?\n        this.height - this.bottomRow.descenderHeight :\n        this.height;\n    const connectionHeight = outputConnectionShape.height(blockHeight);\n    const connectionWidth = outputConnectionShape.width(blockHeight);\n\n    this.outputConnection.height = connectionHeight;\n    this.outputConnection.width = connectionWidth;\n    this.outputConnection.startX = connectionWidth;\n    this.outputConnection.connectionOffsetY =\n        outputConnectionShape.connectionOffsetY(connectionHeight);\n    this.outputConnection.connectionOffsetX =\n        outputConnectionShape.connectionOffsetX(connectionWidth);\n\n    // Add the right connection measurable.\n    // Don't add it if we have a value-to-statement or a value-to-stack block.\n    let rightConnectionWidth = 0;\n    if (!this.hasStatementInput && !this.bottomRow.hasNextConnection) {\n      rightConnectionWidth = connectionWidth;\n      this.rightSide!.height = connectionHeight;\n      this.rightSide!.width = rightConnectionWidth;\n      this.rightSide!.centerline = connectionHeight / 2;\n      this.rightSide!.xPos = this.width + rightConnectionWidth;\n    }\n    this.startX = connectionWidth;\n    this.width += connectionWidth + rightConnectionWidth;\n    this.widthWithChildren += connectionWidth + rightConnectionWidth;\n  }\n\n  /**\n   * Finalize horizontal alignment of elements on the block.  In particular,\n   * reduce the implicit spacing created by the left and right output connection\n   * shapes by adding setting negative spacing onto the leftmost and rightmost\n   * spacers.\n   */\n  protected finalizeHorizontalAlignment_() {\n    if (!this.outputConnection || this.hasStatementInput ||\n        this.bottomRow.hasNextConnection) {\n      return;\n    }\n    let totalNegativeSpacing = 0;\n    for (let i = 0; i < this.rows.length; i++) {\n      const row = this.rows[i];\n      if (!Types.isInputRow(row)) {\n        continue;\n      }\n      const firstElem = row.elements[1];\n      const lastElem = row.elements[row.elements.length - 2];\n      let leftNegPadding = this.getNegativeSpacing_(firstElem);\n      let rightNegPadding = this.getNegativeSpacing_(lastElem);\n      totalNegativeSpacing = leftNegPadding + rightNegPadding;\n      const minBlockWidth =\n          this.constants_.MIN_BLOCK_WIDTH + this.outputConnection.width * 2;\n      if (this.width - totalNegativeSpacing < minBlockWidth) {\n        // Maintain a minimum block width, split negative spacing between left\n        // and right edge.\n        totalNegativeSpacing = this.width - minBlockWidth;\n        leftNegPadding = totalNegativeSpacing / 2;\n        rightNegPadding = totalNegativeSpacing / 2;\n      }\n      // Add a negative spacer on the start and end of the block.\n      row.elements.unshift(new InRowSpacer(this.constants_, -leftNegPadding));\n      row.elements.push(new InRowSpacer(this.constants_, -rightNegPadding));\n    }\n    if (totalNegativeSpacing) {\n      this.width -= totalNegativeSpacing;\n      this.widthWithChildren -= totalNegativeSpacing;\n      this.rightSide!.xPos -= totalNegativeSpacing;\n      for (let i = 0; i < this.rows.length; i++) {\n        const row = this.rows[i];\n        if (Types.isTopOrBottomRow(row)) {\n          row.elements[1].width -= totalNegativeSpacing;\n        }\n        row.width -= totalNegativeSpacing;\n        row.widthWithConnectedBlocks -= totalNegativeSpacing;\n      }\n    }\n  }\n\n  /**\n   * Calculate the spacing to reduce the left and right edges by based on the\n   * outer and inner connection shape.\n   *\n   * @param elem The first or last element on a block.\n   * @returns The amount of spacing to reduce the first or last spacer.\n   */\n  protected getNegativeSpacing_(elem: Measurable): number {\n    if (!elem || !this.outputConnection) {\n      return 0;\n    }\n    const connectionWidth = this.outputConnection.width;\n    const outerShape = this.outputConnection.shape.type;\n    const constants = (this.constants_);\n    if (this.isMultiRow && this.inputRows.length > 1) {\n      switch (outerShape) {\n        case constants.SHAPES.ROUND: {\n          // Special case for multi-row round reporter blocks.\n          const maxWidth = this.constants_.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH;\n          const width = this.height / 2 > maxWidth ? maxWidth : this.height / 2;\n          const topPadding = this.constants_.SMALL_PADDING;\n          const roundPadding =\n              width * (1 - Math.sin(Math.acos((width - topPadding) / width)));\n          return connectionWidth - roundPadding;\n        }\n        default:\n          return 0;\n      }\n    }\n    if (Types.isInlineInput(elem) && elem instanceof InputConnection) {\n      const connectedBlock = elem.connectedBlock;\n      const innerShape = connectedBlock ?\n          (connectedBlock.pathObject as PathObject).outputShapeType :\n          elem.shape.type;\n      if (innerShape == null) {\n        return 0;\n      }\n      // Special case for value to stack / value to statement blocks.\n      if (connectedBlock && connectedBlock.outputConnection &&\n          (connectedBlock.statementInputCount ||\n           connectedBlock.nextConnection)) {\n        return 0;\n      }\n      // Special case for hexagonal output.\n      if (outerShape === constants.SHAPES.HEXAGONAL &&\n          outerShape !== innerShape) {\n        return 0;\n      }\n      return connectionWidth -\n          this.constants_.SHAPE_IN_SHAPE_PADDING[outerShape][innerShape];\n    } else if (Types.isField(elem) && elem instanceof Field) {\n      // Special case for text inputs.\n      if (outerShape === constants.SHAPES.ROUND &&\n          elem.field instanceof FieldTextInput) {\n        return connectionWidth - 2.75 * constants.GRID_UNIT;\n      }\n      return connectionWidth -\n          this.constants_.SHAPE_IN_SHAPE_PADDING[outerShape][0];\n    } else if (Types.isIcon(elem)) {\n      return this.constants_.SMALL_PADDING;\n    }\n    return 0;\n  }\n\n  /**\n   * Finalize vertical alignment of rows on a block.  In particular, reduce the\n   * implicit spacing when a non-shadow block is connected to any of an input\n   * row's inline inputs.\n   */\n  protected finalizeVerticalAlignment_() {\n    if (this.outputConnection) {\n      return;\n    }\n    // Run through every input row on the block and only apply tight nesting\n    // logic to input rows that have a prev and next notch.\n    for (let i = 2; i < this.rows.length - 1; i += 2) {\n      const prevSpacer = this.rows[i - 1] as SpacerRow;\n      const row = this.rows[i];\n      const nextSpacer = this.rows[i + 1] as SpacerRow;\n\n      const firstRow = i === 2;\n      const hasPrevNotch = firstRow ? !!this.topRow.hasPreviousConnection :\n                                      !!prevSpacer.followsStatement;\n      const hasNextNotch = i + 2 >= this.rows.length - 1 ?\n          !!this.bottomRow.hasNextConnection :\n          !!nextSpacer.precedesStatement;\n\n      if (hasPrevNotch) {\n        const elem = row.elements[1];\n        const hasSingleTextOrImageField = row.elements.length === 3 &&\n            elem instanceof Field &&\n            (elem.field instanceof FieldLabel ||\n             elem.field instanceof FieldImage);\n        if (!firstRow && hasSingleTextOrImageField) {\n          // Remove some padding if we have a single image or text field.\n          prevSpacer.height -= this.constants_.SMALL_PADDING;\n          nextSpacer.height -= this.constants_.SMALL_PADDING;\n          row.height -= this.constants_.MEDIUM_PADDING;\n        } else if (!firstRow && !hasNextNotch) {\n          // Add a small padding so the notch doesn't clash with inputs/fields.\n          prevSpacer.height += this.constants_.SMALL_PADDING;\n        } else if (hasNextNotch) {\n          // Determine if the input row has non-shadow connected blocks.\n          let hasNonShadowConnectedBlocks = false;\n          const minVerticalTightNestingHeight = 40;\n          for (let j = 0; j < row.elements.length; j++) {\n            const elem = row.elements[j];\n            if (elem instanceof InputConnection && Types.isInlineInput(elem) &&\n                elem.connectedBlock && !elem.connectedBlock.isShadow() &&\n                elem.connectedBlock.getHeightWidth().height >=\n                    minVerticalTightNestingHeight) {\n              hasNonShadowConnectedBlocks = true;\n              break;\n            }\n          }\n          // Apply tight-nesting if we have both a prev and next notch and the\n          // block has non-shadow connected blocks.\n          if (hasNonShadowConnectedBlocks) {\n            prevSpacer.height -= this.constants_.SMALL_PADDING;\n            nextSpacer.height -= this.constants_.SMALL_PADDING;\n          }\n        }\n      }\n    }\n  }\n\n  override finalize_() {\n    this.finalizeOutputConnection_();\n    this.finalizeHorizontalAlignment_();\n    this.finalizeVerticalAlignment_();\n    super.finalize_();\n\n    if (this.rightSide) {\n      this.widthWithChildren += this.rightSide.width;\n    }\n  }\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Methods for graphically rendering a marker as SVG.\n *\n * @class\n */\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.zelos.MarkerSvg');\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport type {ASTNode} from '../../keyboard_nav/ast_node.js';\nimport type {Marker} from '../../keyboard_nav/marker.js';\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport * as dom from '../../utils/dom.js';\nimport {Svg} from '../../utils/svg.js';\nimport type {WorkspaceSvg} from '../../workspace_svg.js';\nimport type {ConstantProvider as BaseConstantProvider} from '../common/constants.js';\nimport {MarkerSvg as BaseMarkerSvg} from '../common/marker_svg.js';\n\nimport type {ConstantProvider as ZelosConstantProvider} from './constants.js';\n\n\n/**\n * Class to draw a marker.\n *\n * @alias Blockly.zelos.MarkerSvg\n */\nexport class MarkerSvg extends BaseMarkerSvg {\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  constants_!: ZelosConstantProvider;\n\n  private markerCircle_: SVGCircleElement|null = null;\n\n  /**\n   * @param workspace The workspace the marker belongs to.\n   * @param constants The constants for the renderer.\n   * @param marker The marker to draw.\n   */\n  constructor(\n      workspace: WorkspaceSvg, constants: BaseConstantProvider,\n      marker: Marker) {\n    super(workspace, constants, marker);\n  }\n\n  /**\n   * Position and display the marker for an input or an output connection.\n   *\n   * @param curNode The node to draw the marker for.\n   */\n  private showWithInputOutput_(curNode: ASTNode) {\n    const block = curNode.getSourceBlock() as BlockSvg;\n    const connection = curNode.getLocation() as RenderedConnection;\n    const offsetInBlock = connection.getOffsetInBlock();\n\n    this.positionCircle_(offsetInBlock.x, offsetInBlock.y);\n    this.setParent_(block);\n    this.showCurrent_();\n  }\n\n  override showWithOutput_(curNode: ASTNode) {\n    this.showWithInputOutput_(curNode);\n  }\n\n  override showWithInput_(curNode: ASTNode) {\n    this.showWithInputOutput_(curNode);\n  }\n\n  /**\n   * Draw a rectangle around the block.\n   *\n   * @param curNode The current node of the marker.\n   */\n  override showWithBlock_(curNode: ASTNode) {\n    const block = curNode.getLocation() as BlockSvg;\n\n    // Gets the height and width of entire stack.\n    const heightWidth = block.getHeightWidth();\n    // Add padding so that being on a stack looks different than being on a\n    // block.\n    this.positionRect_(0, 0, heightWidth.width, heightWidth.height);\n    this.setParent_(block);\n    this.showCurrent_();\n  }\n\n  /**\n   * Position the circle we use for input and output connections.\n   *\n   * @param x The x position of the circle.\n   * @param y The y position of the circle.\n   */\n  private positionCircle_(x: number, y: number) {\n    this.markerCircle_?.setAttribute('cx', x.toString());\n    this.markerCircle_?.setAttribute('cy', y.toString());\n    this.currentMarkerSvg = this.markerCircle_;\n  }\n\n  override hide() {\n    super.hide();\n    if (this.markerCircle_) {\n      this.markerCircle_.style.display = 'none';\n    }\n  }\n\n  override createDomInternal_() {\n    /* clang-format off */\n    /* This markup will be generated and added to the .svgGroup_:\n        <g>\n          <rect width=\"100\" height=\"5\">\n            <animate attributeType=\"XML\" attributeName=\"fill\" dur=\"1s\"\n              values=\"transparent;transparent;#fff;transparent\" repeatCount=\"indefinite\" />\n          </rect>\n        </g>\n        */\n    /* clang-format on */\n    super.createDomInternal_();\n\n    this.markerCircle_ = dom.createSvgElement(\n        Svg.CIRCLE, {\n          'r': this.constants_.CURSOR_RADIUS,\n          'style': 'display: none',\n          'stroke-width': this.constants_.CURSOR_STROKE_WIDTH,\n        },\n        this.markerSvg_);\n\n    // Markers and stack cursors don't blink.\n    if (this.isCursor()) {\n      const blinkProperties = this.getBlinkProperties_();\n      dom.createSvgElement(Svg.ANIMATE, blinkProperties, this.markerCircle_!);\n    }\n\n    return this.markerSvg_!;\n  }\n\n  override applyColour_(curNode: ASTNode) {\n    super.applyColour_(curNode);\n\n    this.markerCircle_?.setAttribute('fill', this.colour_);\n    this.markerCircle_?.setAttribute('stroke', this.colour_);\n\n    if (this.isCursor()) {\n      const values = this.colour_ + ';transparent;transparent;';\n      this.markerCircle_?.firstElementChild!.setAttribute('values', values);\n    }\n  }\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * An object that owns a block's rendering SVG elements.\n *\n * @class\n */\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.zelos.PathObject');\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport type {Connection} from '../../connection.js';\nimport type {BlockStyle} from '../../theme.js';\nimport * as dom from '../../utils/dom.js';\nimport {Svg} from '../../utils/svg.js';\nimport {PathObject as BasePathObject} from '../common/path_object.js';\n\nimport type {ConstantProvider} from './constants.js';\n\n\n/**\n * An object that handles creating and setting each of the SVG elements\n * used by the renderer.\n *\n * @alias Blockly.zelos.PathObject\n */\nexport class PathObject extends BasePathObject {\n  /** The selected path of the block. */\n  private svgPathSelected_: SVGElement|null = null;\n\n  /** The outline paths on the block. */\n  private readonly outlines = new Map<string, SVGElement>();\n\n  /**\n   * A set used to determine which outlines were used during a draw pass.  The\n   * set is initialized with a reference to all the outlines in\n   * `this.outlines`. Every time we use an outline during the draw pass, the\n   * reference is removed from this set.\n   */\n  private remainingOutlines = new Set<string>();\n\n  /**\n   * The type of block's output connection shape.  This is set when a block\n   * with an output connection is drawn.\n   */\n  outputShapeType: number|null = null;\n\n  /** @internal */\n  public override constants: ConstantProvider;\n\n  /**\n   * @param root The root SVG element.\n   * @param style The style object to use for colouring.\n   * @param constants The renderer's constants.\n   * @internal\n   */\n  constructor(\n      root: SVGElement, style: BlockStyle, constants: ConstantProvider) {\n    super(root, style, constants);\n\n    this.constants = constants;\n  }\n\n  override setPath(pathString: string) {\n    super.setPath(pathString);\n    if (this.svgPathSelected_) {\n      this.svgPathSelected_.setAttribute('d', pathString);\n    }\n  }\n\n  override applyColour(block: BlockSvg) {\n    super.applyColour(block);\n    // Set shadow stroke colour.\n    const parent = block.getParent();\n    if (block.isShadow() && parent) {\n      this.svgPath.setAttribute('stroke', parent.style.colourTertiary);\n    }\n\n    // Apply colour to outlines.\n    for (const outline of this.outlines.values()) {\n      outline.setAttribute('fill', this.style.colourTertiary);\n    }\n  }\n\n  override flipRTL() {\n    super.flipRTL();\n    // Mirror each input outline path.\n    for (const outline of this.outlines.values()) {\n      outline.setAttribute('transform', 'scale(-1 1)');\n    }\n  }\n\n  override updateSelected(enable: boolean) {\n    this.setClass_('blocklySelected', enable);\n    if (enable) {\n      if (!this.svgPathSelected_) {\n        this.svgPathSelected_ = this.svgPath.cloneNode(true) as SVGElement;\n        this.svgPathSelected_.setAttribute('fill', 'none');\n        this.svgPathSelected_.setAttribute(\n            'filter', 'url(#' + this.constants.selectedGlowFilterId + ')');\n        this.svgRoot.appendChild(this.svgPathSelected_);\n      }\n    } else {\n      if (this.svgPathSelected_) {\n        this.svgRoot.removeChild(this.svgPathSelected_);\n        this.svgPathSelected_ = null;\n      }\n    }\n  }\n\n  override updateReplacementFade(enable: boolean) {\n    this.setClass_('blocklyReplaceable', enable);\n    if (enable) {\n      this.svgPath.setAttribute(\n          'filter', 'url(#' + this.constants.replacementGlowFilterId + ')');\n    } else {\n      this.svgPath.removeAttribute('filter');\n    }\n  }\n\n  override updateShapeForInputHighlight(conn: Connection, enable: boolean) {\n    const name = conn.getParentInput()!.name;\n    const outlinePath = this.getOutlinePath_(name);\n    if (!outlinePath) {\n      return;\n    }\n    if (enable) {\n      outlinePath.setAttribute(\n          'filter', 'url(#' + this.constants.replacementGlowFilterId + ')');\n    } else {\n      outlinePath.removeAttribute('filter');\n    }\n  }\n\n  /**\n   * Method that's called when the drawer is about to draw the block.\n   *\n   * @internal\n   */\n  beginDrawing() {\n    this.remainingOutlines.clear();\n    for (const key of this.outlines.keys()) {\n      this.remainingOutlines.add(key);\n    }\n  }\n\n  /**\n   * Method that's called when the drawer is done drawing.\n   *\n   * @internal\n   */\n  endDrawing() {\n    // Go through all remaining outlines that were not used this draw pass, and\n    // remove them.\n    if (this.remainingOutlines.size) {\n      for (const key of this.remainingOutlines) {\n        this.removeOutlinePath_(key);\n      }\n    }\n    this.remainingOutlines.clear();\n  }\n\n  /**\n   * Set the path generated by the renderer for an outline path on the\n   * respective outline path SVG element.\n   *\n   * @param name The input name.\n   * @param pathString The path.\n   * @internal\n   */\n  setOutlinePath(name: string, pathString: string) {\n    const outline = this.getOutlinePath_(name);\n    outline.setAttribute('d', pathString);\n    outline.setAttribute('fill', this.style.colourTertiary);\n  }\n\n  /**\n   * Create's an outline path for the specified input.\n   *\n   * @param name The input name.\n   * @returns The SVG outline path.\n   */\n  private getOutlinePath_(name: string): SVGElement {\n    if (!this.outlines.has(name)) {\n      this.outlines.set(\n          name,\n          dom.createSvgElement(\n              Svg.PATH, {\n                'class':\n                    'blocklyOutlinePath',  // IE doesn't like paths without the\n                // data definition, set empty\n                // default\n                'd': '',\n              },\n              this.svgRoot));\n    }\n    this.remainingOutlines.delete(name);\n    return this.outlines.get(name)!;\n  }\n\n  /**\n   * Remove an outline path that is associated with the specified input.\n   *\n   * @param name The input name.\n   */\n  private removeOutlinePath_(name: string) {\n    this.outlines.get(name)?.parentNode?.removeChild(this.outlines.get(name)!);\n    this.outlines.delete(name);\n  }\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Zelos renderer.\n *\n * @class\n */\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.zelos.Renderer');\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport type {Connection} from '../../connection.js';\nimport {ConnectionType} from '../../connection_type.js';\nimport {InsertionMarkerManager} from '../../insertion_marker_manager.js';\nimport type {Marker} from '../../keyboard_nav/marker.js';\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport type {BlockStyle} from '../../theme.js';\nimport type {WorkspaceSvg} from '../../workspace_svg.js';\nimport * as blockRendering from '../common/block_rendering.js';\nimport type {RenderInfo as BaseRenderInfo} from '../common/info.js';\nimport {Renderer as BaseRenderer} from '../common/renderer.js';\n\nimport {ConstantProvider} from './constants.js';\nimport {Drawer} from './drawer.js';\nimport {RenderInfo} from './info.js';\nimport {MarkerSvg} from './marker_svg.js';\nimport {PathObject} from './path_object.js';\n\n\n/**\n * The zelos renderer.\n *\n * @alias Blockly.zelos.Renderer\n */\nexport class Renderer extends BaseRenderer {\n  protected override constants_!: ConstantProvider;\n\n  /**\n   * @param name The renderer name.\n   * @internal\n   */\n  constructor(name: string) {\n    super(name);\n  }\n\n  /**\n   * Create a new instance of the renderer's constant provider.\n   *\n   * @returns The constant provider.\n   */\n  protected override makeConstants_(): ConstantProvider {\n    return new ConstantProvider();\n  }\n\n  /**\n   * Create a new instance of the renderer's render info object.\n   *\n   * @param block The block to measure.\n   * @returns The render info object.\n   */\n  protected override makeRenderInfo_(block: BlockSvg): RenderInfo {\n    return new RenderInfo(this, block);\n  }\n\n  /**\n   * Create a new instance of the renderer's drawer.\n   *\n   * @param block The block to render.\n   * @param info An object containing all information needed to render this\n   *     block.\n   * @returns The drawer.\n   */\n  protected override makeDrawer_(block: BlockSvg, info: BaseRenderInfo):\n      Drawer {\n    return new Drawer(block, (info as RenderInfo));\n  }\n\n  /**\n   * Create a new instance of the renderer's cursor drawer.\n   *\n   * @param workspace The workspace the cursor belongs to.\n   * @param marker The marker.\n   * @returns The object in charge of drawing the marker.\n   * @internal\n   */\n  override makeMarkerDrawer(workspace: WorkspaceSvg, marker: Marker):\n      MarkerSvg {\n    return new MarkerSvg(workspace, this.getConstants(), marker);\n  }\n\n  /**\n   * Create a new instance of a renderer path object.\n   *\n   * @param root The root SVG element.\n   * @param style The style object to use for colouring.\n   * @returns The renderer path object.\n   * @internal\n   */\n  override makePathObject(root: SVGElement, style: BlockStyle): PathObject {\n    return new PathObject(\n        root, style, (this.getConstants() as ConstantProvider));\n  }\n\n  /**\n   * Get the current renderer's constant provider.  We assume that when this is\n   * called, the renderer has already been initialized.\n   *\n   * @returns The constant provider.\n   */\n  override getConstants(): ConstantProvider {\n    return this.constants_;\n  }\n\n  override shouldHighlightConnection(conn: Connection) {\n    return conn.type !== ConnectionType.INPUT_VALUE &&\n        conn.type !== ConnectionType.OUTPUT_VALUE;\n  }\n\n  override getConnectionPreviewMethod(\n      closest: RenderedConnection, local: RenderedConnection,\n      topBlock: BlockSvg) {\n    if (local.type === ConnectionType.OUTPUT_VALUE) {\n      if (!closest.isConnected()) {\n        return InsertionMarkerManager.PREVIEW_TYPE.INPUT_OUTLINE;\n      }\n      // TODO: Returning this is a total hack, because we don't want to show\n      //   a replacement fade, we want to show an outline affect.\n      //   Sadly zelos does not support showing an outline around filled\n      //   inputs, so we have to pretend like the connected block is getting\n      //   replaced.\n      return InsertionMarkerManager.PREVIEW_TYPE.REPLACEMENT_FADE;\n    }\n\n    return super.getConnectionPreviewMethod(closest, local, topBlock);\n  }\n}\n\nblockRendering.register('zelos', Renderer);\n","/** @file Re-exports of Blockly.zelos.* modules. */\n\n/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Re-exports of Blockly.zelos.* modules.\n *\n * @namespace Blockly.zelos\n */\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.zelos');\n\nimport {ConstantProvider} from './constants.js';\nimport {Drawer} from './drawer.js';\nimport {RenderInfo} from './info.js';\nimport {MarkerSvg} from './marker_svg.js';\nimport {BottomRow} from './measurables/bottom_row.js';\nimport {StatementInput} from './measurables/inputs.js';\nimport {RightConnectionShape} from './measurables/row_elements.js';\nimport {TopRow} from './measurables/top_row.js';\nimport {PathObject} from './path_object.js';\nimport {Renderer} from './renderer.js';\n\n\nexport {\n  BottomRow,\n  ConstantProvider,\n  Drawer,\n  MarkerSvg,\n  PathObject,\n  Renderer,\n  RenderInfo,\n  RightConnectionShape,\n  StatementInput,\n  TopRow,\n};\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * New (evolving) renderer.\n * Thrasos: spirit of boldness.\n *\n * @class\n */\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.thrasos.RenderInfo');\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport {RenderInfo as BaseRenderInfo} from '../common/info.js';\nimport type {Measurable} from '../measurables/base.js';\nimport type {BottomRow} from '../measurables/bottom_row.js';\nimport type {Field} from '../measurables/field.js';\nimport {InRowSpacer} from '../measurables/in_row_spacer.js';\nimport type {Row} from '../measurables/row.js';\nimport type {TopRow} from '../measurables/top_row.js';\nimport {Types} from '../measurables/types.js';\n\nimport type {Renderer} from './renderer.js';\n\n\n/**\n * An object containing all sizing information needed to draw this block.\n *\n * This measure pass does not propagate changes to the block (although fields\n * may choose to rerender when getSize() is called).  However, calling it\n * repeatedly may be expensive.\n *\n * @alias Blockly.thrasos.RenderInfo\n */\nexport class RenderInfo extends BaseRenderInfo {\n  // Exclamation is fine b/c this is assigned by the super constructor.\n  protected override renderer_!: Renderer;\n\n  /**\n   * @param renderer The renderer in use.\n   * @param block The block to measure.\n   * @internal\n   */\n  constructor(renderer: Renderer, block: BlockSvg) {\n    super(renderer, block);\n  }\n\n  /**\n   * Get the block renderer in use.\n   *\n   * @returns The block renderer in use.\n   * @internal\n   */\n  override getRenderer(): Renderer {\n    return this.renderer_;\n  }\n\n  override addElemSpacing_() {\n    let hasExternalInputs = false;\n    for (let i = 0; i < this.rows.length; i++) {\n      const row = this.rows[i];\n      if (row.hasExternalInput) {\n        hasExternalInputs = true;\n        break;\n      }\n    }\n    for (let i = 0; i < this.rows.length; i++) {\n      const row = this.rows[i];\n      const oldElems = row.elements;\n      row.elements = [];\n      // No spacing needed before the corner on the top row or the bottom row.\n      if (row.startsWithElemSpacer()) {\n        // There's a spacer before the first element in the row.\n        row.elements.push(new InRowSpacer(\n            this.constants_, this.getInRowSpacing_(null, oldElems[0])));\n      }\n      if (!oldElems.length) {\n        continue;\n      }\n      for (let e = 0; e < oldElems.length - 1; e++) {\n        row.elements.push(oldElems[e]);\n        const spacing = this.getInRowSpacing_(oldElems[e], oldElems[e + 1]);\n        row.elements.push(new InRowSpacer(this.constants_, spacing));\n      }\n      row.elements.push(oldElems[oldElems.length - 1]);\n      if (row.endsWithElemSpacer()) {\n        let spacing =\n            this.getInRowSpacing_(oldElems[oldElems.length - 1], null);\n        if (hasExternalInputs && row.hasDummyInput) {\n          spacing += this.constants_.TAB_WIDTH;\n        }\n        // There's a spacer after the last element in the row.\n        row.elements.push(new InRowSpacer(this.constants_, spacing));\n      }\n    }\n  }\n\n  override getInRowSpacing_(prev: Measurable|null, next: Measurable|null) {\n    if (!prev) {\n      // Between an editable field and the beginning of the row.\n      if (next && Types.isField(next) && (next as Field).isEditable) {\n        return this.constants_.MEDIUM_PADDING;\n      }\n      // Inline input at the beginning of the row.\n      if (next && Types.isInlineInput(next)) {\n        return this.constants_.MEDIUM_LARGE_PADDING;\n      }\n      if (next && Types.isStatementInput(next)) {\n        return this.constants_.STATEMENT_INPUT_PADDING_LEFT;\n      }\n      // Anything else at the beginning of the row.\n      return this.constants_.LARGE_PADDING;\n    }\n\n    // Spacing between a non-input and the end of the row.\n    if (!Types.isInput(prev) && !next) {\n      // Between an editable field and the end of the row.\n      if (Types.isField(prev) && (prev as Field).isEditable) {\n        return this.constants_.MEDIUM_PADDING;\n      }\n      // Padding at the end of an icon-only row to make the block shape clearer.\n      if (Types.isIcon(prev)) {\n        return this.constants_.LARGE_PADDING * 2 + 1;\n      }\n      if (Types.isHat(prev)) {\n        return this.constants_.NO_PADDING;\n      }\n      // Establish a minimum width for a block with a previous or next\n      // connection.\n      if (Types.isPreviousOrNextConnection(prev)) {\n        return this.constants_.LARGE_PADDING;\n      }\n      // Between rounded corner and the end of the row.\n      if (Types.isLeftRoundedCorner(prev)) {\n        return this.constants_.MIN_BLOCK_WIDTH;\n      }\n      // Between a jagged edge and the end of the row.\n      if (Types.isJaggedEdge(prev)) {\n        return this.constants_.NO_PADDING;\n      }\n      // Between noneditable fields and icons and the end of the row.\n      return this.constants_.LARGE_PADDING;\n    }\n    // Between inputs and the end of the row.\n    if (Types.isInput(prev) && !next) {\n      if (Types.isExternalInput(prev)) {\n        return this.constants_.NO_PADDING;\n      } else if (Types.isInlineInput(prev)) {\n        return this.constants_.LARGE_PADDING;\n      } else if (Types.isStatementInput(prev)) {\n        return this.constants_.NO_PADDING;\n      }\n    }\n\n    // Spacing between a non-input and an input.\n    if (!Types.isInput(prev) && next && Types.isInput(next)) {\n      // Between an editable field and an input.\n      if (Types.isField(prev) && (prev as Field).isEditable) {\n        if (Types.isInlineInput(next)) {\n          return this.constants_.SMALL_PADDING;\n        } else if (Types.isExternalInput(next)) {\n          return this.constants_.SMALL_PADDING;\n        }\n      } else {\n        if (Types.isInlineInput(next)) {\n          return this.constants_.MEDIUM_LARGE_PADDING;\n        } else if (Types.isExternalInput(next)) {\n          return this.constants_.MEDIUM_LARGE_PADDING;\n        } else if (Types.isStatementInput(next)) {\n          return this.constants_.LARGE_PADDING;\n        }\n      }\n      return this.constants_.LARGE_PADDING - 1;\n    }\n\n    // Spacing between an icon and an icon or field.\n    if (Types.isIcon(prev) && next && !Types.isInput(next)) {\n      return this.constants_.LARGE_PADDING;\n    }\n\n    // Spacing between an inline input and a field.\n    if (Types.isInlineInput(prev) && next && Types.isField(next)) {\n      // Editable field after inline input.\n      if ((next as Field).isEditable) {\n        return this.constants_.MEDIUM_PADDING;\n      } else {\n        // Noneditable field after inline input.\n        return this.constants_.LARGE_PADDING;\n      }\n    }\n\n    if (Types.isLeftSquareCorner(prev) && next) {\n      // Spacing between a hat and a corner\n      if (Types.isHat(next)) {\n        return this.constants_.NO_PADDING;\n      }\n      // Spacing between a square corner and a previous or next connection\n      if (Types.isPreviousConnection(next) || Types.isNextConnection(next)) {\n        return next.notchOffset;\n      }\n    }\n    // Spacing between a rounded corner and a previous or next connection.\n    if (Types.isLeftRoundedCorner(prev) && next) {\n      return next.notchOffset - this.constants_.CORNER_RADIUS;\n    }\n\n    // Spacing between two fields of the same editability.\n    if (Types.isField(prev) && next && Types.isField(next) &&\n        (prev as Field).isEditable === (next as Field).isEditable) {\n      return this.constants_.LARGE_PADDING;\n    }\n\n    // Spacing between anything and a jagged edge.\n    if (next && Types.isJaggedEdge(next)) {\n      return this.constants_.LARGE_PADDING;\n    }\n\n    return this.constants_.MEDIUM_PADDING;\n  }\n\n  override getSpacerRowHeight_(prev: Row, next: Row) {\n    // If we have an empty block add a spacer to increase the height.\n    if (Types.isTopRow(prev) && Types.isBottomRow(next)) {\n      return this.constants_.EMPTY_BLOCK_SPACER_HEIGHT;\n    }\n    // Top and bottom rows act as a spacer so we don't need any extra padding.\n    if (Types.isTopRow(prev) || Types.isBottomRow(next)) {\n      return this.constants_.NO_PADDING;\n    }\n    if (prev.hasExternalInput && next.hasExternalInput) {\n      return this.constants_.LARGE_PADDING;\n    }\n    if (!prev.hasStatement && next.hasStatement) {\n      return this.constants_.BETWEEN_STATEMENT_PADDING_Y;\n    }\n    if (prev.hasStatement && next.hasStatement) {\n      return this.constants_.LARGE_PADDING;\n    }\n    if (prev.hasDummyInput || next.hasDummyInput) {\n      return this.constants_.LARGE_PADDING;\n    }\n    return this.constants_.MEDIUM_PADDING;\n  }\n\n  override getElemCenterline_(row: Row, elem: Measurable) {\n    if (Types.isSpacer(elem)) {\n      return row.yPos + elem.height / 2;\n    }\n    if (Types.isBottomRow(row)) {\n      const bottomRow = row as BottomRow;\n      const baseline =\n          bottomRow.yPos + bottomRow.height - bottomRow.descenderHeight;\n      if (Types.isNextConnection(elem)) {\n        return baseline + elem.height / 2;\n      }\n      return baseline - elem.height / 2;\n    }\n    if (Types.isTopRow(row)) {\n      const topRow = row as TopRow;\n      if (Types.isHat(elem)) {\n        return topRow.capline - elem.height / 2;\n      }\n      return topRow.capline + elem.height / 2;\n    }\n\n    let result = row.yPos;\n    if (Types.isField(elem) && row.hasStatement) {\n      const offset =\n          this.constants_.TALL_INPUT_FIELD_OFFSET_Y + elem.height / 2;\n      result += offset;\n    } else {\n      result += row.height / 2;\n    }\n    return result;\n  }\n\n  override finalize_() {\n    // Performance note: this could be combined with the draw pass, if the time\n    // that this takes is excessive.  But it shouldn't be, because it only\n    // accesses and sets properties that already exist on the objects.\n    let widestRowWithConnectedBlocks = 0;\n    let yCursor = 0;\n    for (let i = 0; i < this.rows.length; i++) {\n      const row = this.rows[i];\n      row.yPos = yCursor;\n      row.xPos = this.startX;\n      yCursor += row.height;\n\n      widestRowWithConnectedBlocks =\n          Math.max(widestRowWithConnectedBlocks, row.widthWithConnectedBlocks);\n      // Add padding to the bottom row if block height is less than minimum\n      const heightWithoutHat = yCursor - this.topRow.ascenderHeight;\n      if (row === this.bottomRow &&\n          heightWithoutHat < this.constants_.MIN_BLOCK_HEIGHT) {\n        // But the hat height shouldn't be part of this.\n        const diff = this.constants_.MIN_BLOCK_HEIGHT - heightWithoutHat;\n        this.bottomRow.height += diff;\n        yCursor += diff;\n      }\n      this.recordElemPositions_(row);\n    }\n    if (this.outputConnection && this.block_.nextConnection &&\n        this.block_.nextConnection.isConnected()) {\n      const target = this.block_.nextConnection.targetBlock();\n      if (target) {\n        // Include width of connected block in value to stack width measurement.\n        widestRowWithConnectedBlocks = Math.max(\n            widestRowWithConnectedBlocks, target.getHeightWidth().width);\n      }\n    }\n\n    this.bottomRow.baseline = yCursor - this.bottomRow.descenderHeight;\n    this.widthWithChildren = widestRowWithConnectedBlocks + this.startX;\n\n    this.height = yCursor;\n    this.startY = this.topRow.capline;\n  }\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Thrasos renderer.\n *\n * @class\n */\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.thrasos.Renderer');\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport * as blockRendering from '../common/block_rendering.js';\nimport {Renderer as BaseRenderer} from '../common/renderer.js';\n\nimport {RenderInfo} from './info.js';\n\n\n/**\n * The thrasos renderer.\n *\n * @alias Blockly.thrasos.Renderer\n */\nexport class Renderer extends BaseRenderer {\n  /**\n   * @param name The renderer name.\n   * @internal\n   */\n  constructor(name: string) {\n    super(name);\n  }\n\n  /**\n   * Create a new instance of the renderer's render info object.\n   *\n   * @param block The block to measure.\n   * @returns The render info object.\n   */\n  protected override makeRenderInfo_(block: BlockSvg): RenderInfo {\n    return new RenderInfo(this, block);\n  }\n}\n\nblockRendering.register('thrasos', Renderer);\n","/** @file Re-exports of Blockly.thrasos.* modules. */\n\n/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Re-exports of Blockly.thrasos.* modules.\n *\n * @namespace Blockly.thrasos\n */\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.thrasos');\n\nimport {RenderInfo} from './info.js';\nimport {Renderer} from './renderer.js';\n\n\nexport {Renderer, RenderInfo};\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * An object that provides constants for rendering blocks in the\n * minimalist renderer.\n *\n * @class\n */\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.minimalist.ConstantProvider');\n\nimport {ConstantProvider as BaseConstantProvider} from '../common/constants.js';\n\n\n/**\n * An object that provides constants for rendering blocks in the sample.\n *\n * @alias Blockly.minimalist.ConstantProvider\n */\nexport class ConstantProvider extends BaseConstantProvider {\n  /** @internal */\n  constructor() {\n    super();\n  }\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Minimalist rendering drawer.\n *\n * @class\n */\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.minimalist.Drawer');\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport {Drawer as BaseDrawer} from '../common/drawer.js';\n\nimport type {RenderInfo} from './info.js';\n\n\n/**\n * An object that draws a block based on the given rendering information.\n *\n * @alias Blockly.minimalist.Drawer\n */\nexport class Drawer extends BaseDrawer {\n  /**\n   * @param block The block to render.\n   * @param info An object containing all information needed to render this\n   *     block.\n   * @internal\n   */\n  constructor(block: BlockSvg, info: RenderInfo) {\n    super(block, info);\n  }\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Minimalist render info object.\n *\n * @class\n */\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.minimalist.RenderInfo');\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport {RenderInfo as BaseRenderInfo} from '../common/info.js';\n\nimport type {Renderer} from './renderer.js';\n\n\n/**\n * An object containing all sizing information needed to draw this block.\n *\n * This measure pass does not propagate changes to the block (although fields\n * may choose to rerender when getSize() is called).  However, calling it\n * repeatedly may be expensive.\n *\n * @alias Blockly.minimalist.RenderInfo\n */\nexport class RenderInfo extends BaseRenderInfo {\n  // Exclamation is fine b/c this is assigned by the super constructor.\n  protected override renderer_!: Renderer;\n\n  /**\n   * @param renderer The renderer in use.\n   * @param block The block to measure.\n   * @internal\n   */\n  constructor(renderer: Renderer, block: BlockSvg) {\n    super(renderer, block);\n  }\n\n  /**\n   * Get the block renderer in use.\n   *\n   * @returns The block renderer in use.\n   * @internal\n   */\n  override getRenderer(): Renderer {\n    return this.renderer_;\n  }\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Minimalist renderer.\n *\n * @class\n */\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.minimalist.Renderer');\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport * as blockRendering from '../common/block_rendering.js';\nimport type {RenderInfo as BaseRenderInfo} from '../common/info.js';\nimport {Renderer as BaseRenderer} from '../common/renderer.js';\n\nimport {ConstantProvider} from './constants.js';\nimport {Drawer} from './drawer.js';\nimport {RenderInfo} from './info.js';\n\n\n/**\n * The minimalist renderer.\n *\n * @alias Blockly.minimalist.Renderer\n */\nexport class Renderer extends BaseRenderer {\n  /**\n   * @param name The renderer name.\n   * @internal\n   */\n  constructor(name: string) {\n    super(name);\n  }\n\n  /**\n   * Create a new instance of the renderer's constant provider.\n   *\n   * @returns The constant provider.\n   */\n  protected override makeConstants_(): ConstantProvider {\n    return new ConstantProvider();\n  }\n\n  /**\n   * Create a new instance of the renderer's render info object.\n   *\n   * @param block The block to measure.\n   * @returns The render info object.\n   */\n  protected override makeRenderInfo_(block: BlockSvg): RenderInfo {\n    return new RenderInfo(this, block);\n  }\n\n  /**\n   * Create a new instance of the renderer's drawer.\n   *\n   * @param block The block to render.\n   * @param info An object containing all information needed to render this\n   *     block.\n   * @returns The drawer.\n   */\n  protected override makeDrawer_(block: BlockSvg, info: BaseRenderInfo):\n      Drawer {\n    return new Drawer(block, (info as RenderInfo));\n  }\n}\n\nblockRendering.register('minimalist', Renderer);\n","/** @file Re-exports of Blockly.minimalist.* modules. */\n\n/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Re-exports of Blockly.minimalist.* modules.\n *\n * @namespace Blockly.minimalist\n */\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.minimalist');\n\nimport {ConstantProvider} from './constants.js';\nimport {Drawer} from './drawer.js';\nimport {RenderInfo} from './info.js';\nimport {Renderer} from './renderer.js';\n\n\nexport {ConstantProvider, Drawer, Renderer, RenderInfo};\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * An object that provides constants for rendering blocks in Geras\n * mode.\n *\n * @class\n */\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.geras.ConstantProvider');\n\nimport {ConstantProvider as BaseConstantProvider} from '../common/constants.js';\n\n\n/**\n * An object that provides constants for rendering blocks in Geras mode.\n *\n * @alias Blockly.geras.ConstantProvider\n */\nexport class ConstantProvider extends BaseConstantProvider {\n  override FIELD_TEXT_BASELINE_CENTER = false;\n\n  // The dark/shadow path in classic rendering is the same as the normal block\n  // path, but translated down one and right one.\n  DARK_PATH_OFFSET = 1;\n\n  /**\n   * The maximum width of a bottom row that follows a statement input and has\n   * inputs inline.\n   */\n  MAX_BOTTOM_WIDTH = 30;\n  override STATEMENT_BOTTOM_SPACER = -this.NOTCH_HEIGHT / 2;\n\n  /**\n   * @internal\n   */\n  constructor() {\n    super();\n  }\n\n  override getCSS_(selector: string) {\n    return super.getCSS_(selector).concat([\n      /* eslint-disable indent */\n      /* clang-format off */\n      // Insertion marker.\n      `${selector} .blocklyInsertionMarker>.blocklyPathLight,`,\n      `${selector} .blocklyInsertionMarker>.blocklyPathDark {`,\n      `fill-opacity: ${this.INSERTION_MARKER_OPACITY};`,\n      `stroke: none;`,\n      '}',\n      /* clang-format on */\n      /* eslint-enable indent */\n    ]);\n  }\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Methods for adding highlights on block, for rendering in\n * compatibility mode.\n *\n * @class\n */\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.geras.Highlighter');\n\nimport * as svgPaths from '../../utils/svg_paths.js';\nimport type {ConstantProvider} from '../common/constants.js';\nimport type {BottomRow} from '../measurables/bottom_row.js';\nimport type {Row} from '../measurables/row.js';\nimport {SpacerRow} from '../measurables/spacer_row.js';\nimport type {TopRow} from '../measurables/top_row.js';\nimport {Types} from '../measurables/types.js';\n\nimport type {HighlightConstantProvider, InsideCorner, JaggedTeeth, Notch, OutsideCorner, PuzzleTab, StartHat} from './highlight_constants.js';\nimport type {RenderInfo} from './info.js';\nimport type {InlineInput} from './measurables/inline_input.js';\n\n\n/**\n * An object that adds highlights to a block based on the given rendering\n * information.\n *\n * Highlighting is interesting because the highlights do not fully enclose the\n * block.  Instead, they are positioned based on a light source in the top left.\n * This means that rendering highlights requires exact information about the\n * position of each part of the block.  The resulting paths are not continuous\n * or closed paths.  The highlights for tabs and notches are loosely based on\n * tab and notch shapes, but are not exactly the same.\n *\n * @alias Blockly.geras.Highlighter\n */\nexport class Highlighter {\n  info_: RenderInfo;\n  steps_ = '';\n  inlineSteps_ = '';\n  RTL_: boolean;\n  constants_: ConstantProvider;\n  highlightConstants_: HighlightConstantProvider;\n  private readonly highlightOffset_: number;\n  outsideCornerPaths_: OutsideCorner;\n  insideCornerPaths_: InsideCorner;\n  puzzleTabPaths_: PuzzleTab;\n  notchPaths_: Notch;\n  startPaths_: StartHat;\n  jaggedTeethPaths_: JaggedTeeth;\n\n  /**\n   * @param info An object containing all information needed to render this\n   *     block.\n   * @internal\n   */\n  constructor(info: RenderInfo) {\n    this.info_ = info;\n\n    this.RTL_ = this.info_.RTL;\n\n    const renderer = (info.getRenderer());\n\n    /** The renderer's constant provider. */\n    this.constants_ = renderer.getConstants();\n\n    this.highlightConstants_ = renderer.getHighlightConstants();\n    /** The offset between the block's main path and highlight path. */\n    this.highlightOffset_ = this.highlightConstants_.OFFSET;\n\n    this.outsideCornerPaths_ = this.highlightConstants_.OUTSIDE_CORNER;\n    this.insideCornerPaths_ = this.highlightConstants_.INSIDE_CORNER;\n    this.puzzleTabPaths_ = this.highlightConstants_.PUZZLE_TAB;\n    this.notchPaths_ = this.highlightConstants_.NOTCH;\n    this.startPaths_ = this.highlightConstants_.START_HAT;\n    this.jaggedTeethPaths_ = this.highlightConstants_.JAGGED_TEETH;\n  }\n\n  /**\n   * Get the steps for the highlight path.\n   *\n   * @returns The steps for the highlight path.\n   * @internal\n   */\n  getPath(): string {\n    return this.steps_ + '\\n' + this.inlineSteps_;\n  }\n\n  /**\n   * Add a highlight to the top corner of a block.\n   *\n   * @param row The top row of the block.\n   * @internal\n   */\n  drawTopCorner(row: TopRow) {\n    this.steps_ += svgPaths.moveBy(row.xPos, this.info_.startY);\n    for (let i = 0, elem; elem = row.elements[i]; i++) {\n      if (Types.isLeftSquareCorner(elem)) {\n        this.steps_ += this.highlightConstants_.START_POINT;\n      } else if (Types.isLeftRoundedCorner(elem)) {\n        this.steps_ += this.outsideCornerPaths_.topLeft(this.RTL_);\n      } else if (Types.isPreviousConnection(elem)) {\n        this.steps_ += this.notchPaths_.pathLeft;\n      } else if (Types.isHat(elem)) {\n        this.steps_ += this.startPaths_.path(this.RTL_);\n      } else if (Types.isSpacer(elem) && elem.width !== 0) {\n        // The end point of the spacer needs to be offset by the highlight\n        // amount. So instead of using the spacer's width for a relative\n        // horizontal, use its width and position for an absolute horizontal\n        // move.\n        this.steps_ += svgPaths.lineOnAxis(\n            'H', elem.xPos + elem.width - this.highlightOffset_);\n      }\n    }\n\n    const right = row.xPos + row.width - this.highlightOffset_;\n    this.steps_ += svgPaths.lineOnAxis('H', right);\n  }\n\n  /**\n   * Add a highlight on a jagged edge for a collapsed block.\n   *\n   * @param row  The row to highlight.\n   * @internal\n   */\n  drawJaggedEdge_(row: Row) {\n    if (this.info_.RTL) {\n      const remainder =\n          row.height - this.jaggedTeethPaths_.height - this.highlightOffset_;\n      this.steps_ +=\n          this.jaggedTeethPaths_.pathLeft + svgPaths.lineOnAxis('v', remainder);\n    }\n  }\n\n  /**\n   * Add a highlight on a value input.\n   *\n   * @param row The row the input belongs to.\n   * @internal\n   */\n  drawValueInput(row: Row) {\n    const input = row.getLastInput() as InlineInput;\n    if (this.RTL_) {\n      const belowTabHeight = row.height - input.connectionHeight;\n\n      this.steps_ +=\n          svgPaths.moveTo(\n              input.xPos + input.width - this.highlightOffset_, row.yPos) +\n          this.puzzleTabPaths_.pathDown(this.RTL_) +\n          svgPaths.lineOnAxis('v', belowTabHeight);\n    } else {\n      this.steps_ += svgPaths.moveTo(input.xPos + input.width, row.yPos) +\n          this.puzzleTabPaths_.pathDown(this.RTL_);\n    }\n  }\n\n  /**\n   * Add a highlight on a statement input.\n   *\n   * @param row The row to highlight.\n   * @internal\n   */\n  drawStatementInput(row: Row) {\n    const input = row.getLastInput();\n    if (!input) return;\n    if (this.RTL_) {\n      const innerHeight = row.height - 2 * this.insideCornerPaths_.height;\n      this.steps_ += svgPaths.moveTo(input.xPos, row.yPos) +\n          this.insideCornerPaths_.pathTop(this.RTL_) +\n          svgPaths.lineOnAxis('v', innerHeight) +\n          this.insideCornerPaths_.pathBottom(this.RTL_) +\n          svgPaths.lineTo(\n              row.width - input.xPos - this.insideCornerPaths_.width, 0);\n    } else {\n      this.steps_ += svgPaths.moveTo(input.xPos, row.yPos + row.height) +\n          this.insideCornerPaths_.pathBottom(this.RTL_) +\n          svgPaths.lineTo(\n              row.width - input.xPos - this.insideCornerPaths_.width, 0);\n    }\n  }\n\n  /**\n   * Add a highlight on the right side of a row.\n   *\n   * @param row The row to highlight.\n   * @internal\n   */\n  drawRightSideRow(row: Row) {\n    const rightEdge = row.xPos + row.width - this.highlightOffset_;\n    if (row instanceof SpacerRow && row.followsStatement) {\n      this.steps_ += svgPaths.lineOnAxis('H', rightEdge);\n    }\n    if (this.RTL_) {\n      this.steps_ += svgPaths.lineOnAxis('H', rightEdge);\n      if (row.height > this.highlightOffset_) {\n        this.steps_ += svgPaths.lineOnAxis(\n            'V', row.yPos + row.height - this.highlightOffset_);\n      }\n    }\n  }\n\n  /**\n   * Add a highlight to the bottom row.\n   *\n   * @param row The row to highlight.\n   * @internal\n   */\n  drawBottomRow(row: BottomRow) {\n    // Highlight the vertical edge of the bottom row on the input side.\n    // Highlighting is always from the top left, both in LTR and RTL.\n    if (this.RTL_) {\n      this.steps_ +=\n          svgPaths.lineOnAxis('V', row.baseline - this.highlightOffset_);\n    } else {\n      const cornerElem = this.info_.bottomRow.elements[0];\n      if (Types.isLeftSquareCorner(cornerElem)) {\n        this.steps_ += svgPaths.moveTo(\n            row.xPos + this.highlightOffset_,\n            row.baseline - this.highlightOffset_);\n      } else if (Types.isLeftRoundedCorner(cornerElem)) {\n        this.steps_ += svgPaths.moveTo(row.xPos, row.baseline);\n        this.steps_ += this.outsideCornerPaths_.bottomLeft();\n      }\n    }\n  }\n\n  /**\n   * Draw the highlight on the left side of the block.\n   *\n   * @internal\n   */\n  drawLeft() {\n    const outputConnection = this.info_.outputConnection;\n    if (outputConnection) {\n      const tabBottom =\n          outputConnection.connectionOffsetY + outputConnection.height;\n      // Draw a line up to the bottom of the tab.\n      if (this.RTL_) {\n        this.steps_ += svgPaths.moveTo(this.info_.startX, tabBottom);\n      } else {\n        const left = this.info_.startX + this.highlightOffset_;\n        const bottom = this.info_.bottomRow.baseline - this.highlightOffset_;\n        this.steps_ += svgPaths.moveTo(left, bottom);\n        this.steps_ += svgPaths.lineOnAxis('V', tabBottom);\n      }\n      this.steps_ += this.puzzleTabPaths_.pathUp(this.RTL_);\n    }\n\n    if (!this.RTL_) {\n      const topRow = this.info_.topRow;\n      if (Types.isLeftRoundedCorner(topRow.elements[0])) {\n        this.steps_ +=\n            svgPaths.lineOnAxis('V', this.outsideCornerPaths_.height);\n      } else {\n        this.steps_ +=\n            svgPaths.lineOnAxis('V', topRow.capline + this.highlightOffset_);\n      }\n    }\n  }\n\n  /**\n   * Add a highlight to an inline input.\n   *\n   * @param input The input to highlight.\n   * @internal\n   */\n  drawInlineInput(input: InlineInput) {\n    const offset = this.highlightOffset_;\n\n    // Relative to the block's left.\n    const connectionRight = input.xPos + input.connectionWidth;\n    const yPos = input.centerline - input.height / 2;\n    const bottomHighlightWidth = input.width - input.connectionWidth;\n    const startY = yPos + offset;\n\n    if (this.RTL_) {\n      const aboveTabHeight = input.connectionOffsetY - offset;\n      const belowTabHeight = input.height -\n          (input.connectionOffsetY + input.connectionHeight) + offset;\n\n      const startX = connectionRight - offset;\n\n      this.inlineSteps_ +=\n          svgPaths.moveTo(startX, startY) +           // Right edge above tab.\n          svgPaths.lineOnAxis('v', aboveTabHeight) +  // Back of tab.\n          this.puzzleTabPaths_.pathDown(this.RTL_) +  // Right edge below tab.\n          svgPaths.lineOnAxis('v', belowTabHeight) +  // Bottom.\n          svgPaths.lineOnAxis('h', bottomHighlightWidth);\n    } else {\n      this.inlineSteps_ +=  // Go to top right corner.\n          svgPaths.moveTo(\n              input.xPos + input.width + offset,\n              startY) +  // Highlight right edge, bottom.\n          svgPaths.lineOnAxis('v', input.height) +\n          svgPaths.lineOnAxis(\n              'h', -bottomHighlightWidth) +  // Go to top of tab.\n          svgPaths.moveTo(\n              connectionRight,\n              yPos + input.connectionOffsetY) +  // Short highlight glint at\n          // bottom of tab.\n          this.puzzleTabPaths_.pathDown(this.RTL_);\n    }\n  }\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Renderer that preserves the look and feel of Blockly pre-2019.\n *\n * @class\n */\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.geras.Drawer');\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport * as svgPaths from '../../utils/svg_paths.js';\nimport * as debug from '../common/debug.js';\nimport {Drawer as BaseDrawer} from '../common/drawer.js';\nimport type {Row} from '../measurables/row.js';\n\nimport type {ConstantProvider} from './constants.js';\nimport {Highlighter} from './highlighter.js';\nimport type {RenderInfo} from './info.js';\nimport type {InlineInput} from './measurables/inline_input.js';\nimport type {PathObject} from './path_object.js';\n\n\n/**\n * An object that draws a block based on the given rendering information.\n *\n * @alias Blockly.geras.Drawer\n */\nexport class Drawer extends BaseDrawer {\n  highlighter_: Highlighter;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  override constants_!: ConstantProvider;\n\n  /**\n   * @param block The block to render.\n   * @param info An object containing all information needed to render this\n   *     block.\n   * @internal\n   */\n  constructor(block: BlockSvg, info: RenderInfo) {\n    super(block, info);\n    // Unlike Thrasos, Geras has highlights and drop shadows.\n    this.highlighter_ = new Highlighter(info);\n  }\n\n  override draw() {\n    this.hideHiddenIcons_();\n    this.drawOutline_();\n    this.drawInternals_();\n\n    const pathObject = this.block_.pathObject as PathObject;\n    pathObject.setPath(this.outlinePath_ + '\\n' + this.inlinePath_);\n    pathObject.setHighlightPath(this.highlighter_.getPath());\n    if (this.info_.RTL) {\n      pathObject.flipRTL();\n    }\n    if (debug.isDebuggerEnabled()) {\n      this.block_?.renderingDebugger?.drawDebug(this.block_, this.info_);\n    }\n    this.recordSizeOnBlock_();\n  }\n\n  override drawTop_() {\n    this.highlighter_.drawTopCorner(this.info_.topRow);\n    this.highlighter_.drawRightSideRow(this.info_.topRow);\n\n    super.drawTop_();\n  }\n\n  override drawJaggedEdge_(row: Row) {\n    this.highlighter_.drawJaggedEdge_(row);\n\n    super.drawJaggedEdge_(row);\n  }\n\n  override drawValueInput_(row: Row) {\n    this.highlighter_.drawValueInput(row);\n\n    super.drawValueInput_(row);\n  }\n\n  override drawStatementInput_(row: Row) {\n    this.highlighter_.drawStatementInput(row);\n\n    super.drawStatementInput_(row);\n  }\n\n  override drawRightSideRow_(row: Row) {\n    this.highlighter_.drawRightSideRow(row);\n\n    this.outlinePath_ += svgPaths.lineOnAxis('H', row.xPos + row.width) +\n        svgPaths.lineOnAxis('V', row.yPos + row.height);\n  }\n\n  override drawBottom_() {\n    this.highlighter_.drawBottomRow(this.info_.bottomRow);\n\n    super.drawBottom_();\n  }\n\n  /**\n   * Add steps for the left side of the block, which may include an output\n   * connection\n   */\n  protected override drawLeft_() {\n    this.highlighter_.drawLeft();\n\n    super.drawLeft_();\n  }\n\n  override drawInlineInput_(input: InlineInput) {\n    this.highlighter_.drawInlineInput(input as InlineInput);\n\n    super.drawInlineInput_(input);\n  }\n\n  override positionInlineInputConnection_(input: InlineInput) {\n    const yPos = input.centerline - input.height / 2;\n    // Move the connection.\n    if (input.connectionModel) {\n      // xPos already contains info about startX\n      let connX =\n          input.xPos + input.connectionWidth + this.constants_.DARK_PATH_OFFSET;\n      if (this.info_.RTL) {\n        connX *= -1;\n      }\n      input.connectionModel.setOffsetInBlock(\n          connX,\n          yPos + input.connectionOffsetY + this.constants_.DARK_PATH_OFFSET);\n    }\n  }\n\n  override positionStatementInputConnection_(row: Row) {\n    const input = row.getLastInput();\n    if (input?.connectionModel) {\n      let connX = row.xPos + row.statementEdge + input.notchOffset;\n      if (this.info_.RTL) {\n        connX *= -1;\n      } else {\n        connX += this.constants_.DARK_PATH_OFFSET;\n      }\n      input.connectionModel.setOffsetInBlock(\n          connX, row.yPos + this.constants_.DARK_PATH_OFFSET);\n    }\n  }\n\n  override positionExternalValueConnection_(row: Row) {\n    const input = row.getLastInput();\n    if (input && input.connectionModel) {\n      let connX = row.xPos + row.width + this.constants_.DARK_PATH_OFFSET;\n      if (this.info_.RTL) {\n        connX *= -1;\n      }\n      input.connectionModel.setOffsetInBlock(connX, row.yPos);\n    }\n  }\n\n  override positionNextConnection_() {\n    const bottomRow = this.info_.bottomRow;\n\n    if (bottomRow.connection) {\n      const connInfo = bottomRow.connection;\n      const x = connInfo.xPos;  // Already contains info about startX.\n      const connX =\n          (this.info_.RTL ? -x : x) + this.constants_.DARK_PATH_OFFSET / 2;\n      connInfo.connectionModel.setOffsetInBlock(\n          connX, bottomRow.baseline + this.constants_.DARK_PATH_OFFSET);\n    }\n  }\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Objects for rendering highlights on blocks.\n *\n * @class\n */\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.geras.HighlightConstantProvider');\n\nimport * as svgPaths from '../../utils/svg_paths.js';\nimport type {ConstantProvider} from '../common/constants.js';\n\n\n/** An object containing sizing and path information about an outside corner. */\nexport interface OutsideCorner {\n  height: number;\n  topLeft: (p1: boolean) => string;\n  bottomLeft: () => string;\n}\n\n/** An object containing sizing and path information about an inside corner. */\nexport interface InsideCorner {\n  width: number;\n  height: number;\n  pathTop: (p1: boolean) => string;\n  pathBottom: (p1: boolean) => string;\n}\n\n/** An object containing sizing and path information about a start hat. */\nexport interface StartHat {\n  path: (p1: boolean) => string;\n}\n\n/** An object containing sizing and path information about a notch. */\nexport interface Notch {\n  pathLeft: string;\n}\n\n/** An object containing sizing and path information about a puzzle tab. */\nexport interface PuzzleTab {\n  width: number;\n  height: number;\n  pathDown: (p1: boolean) => string;\n  pathUp: (p1: boolean) => string;\n}\n\n/**\n * An object containing sizing and path information about collapsed block\n * indicators.\n */\nexport interface JaggedTeeth {\n  height: number;\n  width: number;\n  pathLeft: string;\n}\n\n/**\n * An object that provides constants for rendering highlights on blocks.\n * Some highlights are simple offsets of the parent paths and can be generated\n * programmatically.  Others, especially on curves, are just made out of piles\n * of constants and are hard to tweak.\n *\n * @alias Blockly.geras.HighlightConstantProvider\n */\nexport class HighlightConstantProvider {\n  constantProvider: ConstantProvider;\n\n  /** The offset between the block's main path and highlight path. */\n  OFFSET = 0.5;\n  START_POINT: string;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  INSIDE_CORNER!: InsideCorner;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  OUTSIDE_CORNER!: OutsideCorner;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  PUZZLE_TAB!: PuzzleTab;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  NOTCH!: Notch;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  JAGGED_TEETH!: JaggedTeeth;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  START_HAT!: StartHat;\n\n  /**\n   * @param constants The rendering constants provider.\n   * @internal\n   */\n  constructor(constants: ConstantProvider) {\n    /** The renderer's constant provider. */\n    this.constantProvider = constants;\n\n    /**\n     * The start point, which is offset in both X and Y, as an SVG path chunk.\n     *\n     * @internal\n     */\n    this.START_POINT = svgPaths.moveBy(this.OFFSET, this.OFFSET);\n  }\n\n  /**\n   * Initialize shape objects based on the constants set in the constructor.\n   *\n   * @internal\n   */\n  init() {\n    /**\n     * An object containing sizing and path information about inside corner\n     * highlights.\n     */\n    this.INSIDE_CORNER = this.makeInsideCorner();\n\n    /**\n     * An object containing sizing and path information about outside corner\n     * highlights.\n     */\n    this.OUTSIDE_CORNER = this.makeOutsideCorner();\n\n    /**\n     * An object containing sizing and path information about puzzle tab\n     * highlights.\n     */\n    this.PUZZLE_TAB = this.makePuzzleTab();\n\n    /**\n     * An object containing sizing and path information about notch highlights.\n     */\n    this.NOTCH = this.makeNotch();\n\n    /**\n     * An object containing sizing and path information about highlights for\n     * collapsed block indicators.\n     */\n    this.JAGGED_TEETH = this.makeJaggedTeeth();\n\n    /**\n     * An object containing sizing and path information about start hat\n     * highlights.\n     */\n    this.START_HAT = this.makeStartHat();\n  }\n\n  /**\n   * @returns An object containing sizing and path information about inside\n   *     corner highlights.\n   * @internal\n   */\n  makeInsideCorner(): InsideCorner {\n    const radius = this.constantProvider.CORNER_RADIUS;\n    const offset = this.OFFSET;\n\n    /**\n     * Distance from shape edge to intersect with a curved corner at 45 degrees.\n     * Applies to highlighting on around the outside of a curve.\n     */\n    const distance45outside = (1 - Math.SQRT1_2) * (radius + offset) - offset;\n\n    const pathTopRtl = svgPaths.moveBy(distance45outside, distance45outside) +\n        svgPaths.arc(\n            'a', '0 0,0', radius,\n            svgPaths.point(\n                -distance45outside - offset, radius - distance45outside));\n\n    const pathBottomRtl = svgPaths.arc(\n        'a', '0 0,0', radius + offset,\n        svgPaths.point(radius + offset, radius + offset));\n\n    const pathBottomLtr =\n        svgPaths.moveBy(distance45outside, -distance45outside) +\n        svgPaths.arc(\n            'a', '0 0,0', radius + offset,\n            svgPaths.point(\n                radius - distance45outside, distance45outside + offset));\n\n    return {\n      width: radius + offset,\n      height: radius,\n      pathTop(rtl) {\n        return rtl ? pathTopRtl : '';\n      },\n      pathBottom(rtl) {\n        return rtl ? pathBottomRtl : pathBottomLtr;\n      },\n    };\n  }\n\n  /**\n   * @returns An object containing sizing and path information about outside\n   *     corner highlights.\n   * @internal\n   */\n  makeOutsideCorner(): OutsideCorner {\n    const radius = this.constantProvider.CORNER_RADIUS;\n    const offset = this.OFFSET;\n\n    /**\n     * Distance from shape edge to intersect with a curved corner at 45 degrees.\n     * Applies to highlighting on around the inside of a curve.\n     */\n    const distance45inside = (1 - Math.SQRT1_2) * (radius - offset) + offset;\n\n    const topLeftStartX = distance45inside;\n    const topLeftStartY = distance45inside;\n    const topLeftCornerHighlightRtl =\n        svgPaths.moveBy(topLeftStartX, topLeftStartY) +\n        svgPaths.arc(\n            'a', '0 0,1', radius - offset,\n            svgPaths.point(radius - topLeftStartX, -topLeftStartY + offset));\n    /**\n     * SVG path for drawing the highlight on the rounded top-left corner.\n     */\n    const topLeftCornerHighlightLtr = svgPaths.moveBy(offset, radius) +\n        svgPaths.arc(\n            'a', '0 0,1', radius - offset,\n            svgPaths.point(radius, -radius + offset));\n\n    const bottomLeftStartX = distance45inside;\n    const bottomLeftStartY = -distance45inside;\n    const bottomLeftPath = svgPaths.moveBy(bottomLeftStartX, bottomLeftStartY) +\n        svgPaths.arc(\n            'a', '0 0,1', radius - offset,\n            svgPaths.point(\n                -bottomLeftStartX + offset, -bottomLeftStartY - radius));\n\n    return {\n      height: radius,\n      topLeft(rtl) {\n        return rtl ? topLeftCornerHighlightRtl : topLeftCornerHighlightLtr;\n      },\n      bottomLeft() {\n        return bottomLeftPath;\n      },\n    };\n  }\n\n  /**\n   * @returns An object containing sizing and path information about puzzle tab\n   *     highlights.\n   * @internal\n   */\n  makePuzzleTab(): PuzzleTab {\n    const width = this.constantProvider.TAB_WIDTH;\n    const height = this.constantProvider.TAB_HEIGHT;\n\n    // This is how much of the vertical block edge is actually drawn by the\n    // puzzle tab.\n    const verticalOverlap = 2.5;\n\n    const highlightRtlUp =\n        svgPaths.moveBy(-2, -height + verticalOverlap + 0.9) +\n        svgPaths.lineTo(width * -0.45, -2.1);\n\n    const highlightRtlDown = svgPaths.lineOnAxis('v', verticalOverlap) +\n        svgPaths.moveBy(-width * 0.97, 2.5) +\n        svgPaths.curve(\n            'q',\n            [\n              svgPaths.point(-width * 0.05, 10),\n              svgPaths.point(width * 0.3, 9.5),\n            ]) +\n        svgPaths.moveBy(width * 0.67, -1.9) +\n        svgPaths.lineOnAxis('v', verticalOverlap);\n\n    const highlightLtrUp = svgPaths.lineOnAxis('v', -1.5) +\n        svgPaths.moveBy(width * -0.92, -0.5) +\n        svgPaths.curve(\n            'q',\n            [svgPaths.point(width * -0.19, -5.5), svgPaths.point(0, -11)]) +\n        svgPaths.moveBy(width * 0.92, 1);\n\n    const highlightLtrDown =\n        svgPaths.moveBy(-5, height - 0.7) + svgPaths.lineTo(width * 0.46, -2.1);\n\n    return {\n      width,\n      height,\n      pathUp(rtl) {\n        return rtl ? highlightRtlUp : highlightLtrUp;\n      },\n      pathDown(rtl) {\n        return rtl ? highlightRtlDown : highlightLtrDown;\n      },\n    };\n  }\n\n  /**\n   * @returns An object containing sizing and path information about notch\n   *     highlights.\n   * @internal\n   */\n  makeNotch(): Notch {\n    // This is only for the previous connection.\n    const pathLeft = svgPaths.lineOnAxis('h', this.OFFSET) +\n        this.constantProvider.NOTCH.pathLeft;\n    return {pathLeft};\n  }\n\n  /**\n   * @returns An object containing sizing and path information about collapsed\n   *     block edge highlights.\n   * @internal\n   */\n  makeJaggedTeeth(): JaggedTeeth {\n    const pathLeft = svgPaths.lineTo(5.1, 2.6) + svgPaths.moveBy(-10.2, 6.8) +\n        svgPaths.lineTo(5.1, 2.6);\n    return {pathLeft, height: 12, width: 10.2};\n  }\n\n  /**\n   * @returns An object containing sizing and path information about start\n   *     highlights.\n   * @internal\n   */\n  makeStartHat(): StartHat {\n    const hatHeight = this.constantProvider.START_HAT.height;\n    const pathRtl = svgPaths.moveBy(25, -8.7) + svgPaths.curve('c', [\n      svgPaths.point(29.7, -6.2),\n      svgPaths.point(57.2, -0.5),\n      svgPaths.point(75, 8.7),\n    ]);\n\n    const pathLtr = svgPaths.curve('c', [\n      svgPaths.point(17.8, -9.2),\n      svgPaths.point(45.3, -14.9),\n      svgPaths.point(75, -8.7),\n    ]) + svgPaths.moveTo(100.5, hatHeight + 0.5);\n    return {\n      path(rtl) {\n        return rtl ? pathRtl : pathLtr;\n      },\n    };\n  }\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Objects representing inline inputs with connections on a\n * rendered block.\n *\n * @class\n */\nimport * as goog from '../../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.geras.InlineInput');\n\n/* eslint-disable-next-line no-unused-vars */\nimport type {Input} from '../../../input.js';\nimport type {ConstantProvider as BaseConstantProvider} from '../../../renderers/common/constants.js';\nimport {InlineInput as BaseInlineInput} from '../../../renderers/measurables/inline_input.js';\nimport type {ConstantProvider as GerasConstantProvider} from '../constants.js';\n\n\n/**\n * An object containing information about the space an inline input takes up\n * during rendering.\n *\n * @alias Blockly.geras.InlineInput\n */\nexport class InlineInput extends BaseInlineInput {\n  override constants_: GerasConstantProvider;\n\n  /**\n   * @param constants The rendering constants provider.\n   * @param input The inline input to measure and store information for.\n   * @internal\n   */\n  constructor(constants: BaseConstantProvider, input: Input) {\n    super(constants, input);\n    this.constants_ = constants as GerasConstantProvider;\n\n    if (this.connectedBlock) {\n      // We allow the dark path to show on the parent block so that the child\n      // block looks embossed.  This takes up an extra pixel in both x and y.\n      this.width += this.constants_.DARK_PATH_OFFSET;\n      this.height += this.constants_.DARK_PATH_OFFSET;\n    }\n  }\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Objects representing statement inputs with connections on a\n * rendered block.\n *\n * @class\n */\nimport * as goog from '../../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.geras.StatementInput');\n\n/* eslint-disable-next-line no-unused-vars */\nimport type {Input} from '../../../input.js';\nimport type {ConstantProvider as BaseConstantProvider} from '../../../renderers/common/constants.js';\nimport {StatementInput as BaseStatementInput} from '../../../renderers/measurables/statement_input.js';\nimport type {ConstantProvider as GerasConstantProvider} from '../constants.js';\n\n\n/**\n * An object containing information about the space a statement input takes up\n * during rendering.\n *\n * @alias Blockly.geras.StatementInput\n */\nexport class StatementInput extends BaseStatementInput {\n  override constants_: GerasConstantProvider;\n\n  /**\n   * @param constants The rendering constants provider.\n   * @param input The statement input to measure and store information for.\n   * @internal\n   */\n  constructor(constants: BaseConstantProvider, input: Input) {\n    super(constants, input);\n    this.constants_ = constants as GerasConstantProvider;\n\n    if (this.connectedBlock) {\n      // We allow the dark path to show on the parent block so that the child\n      // block looks embossed.  This takes up an extra pixel in both x and y.\n      this.height += this.constants_.DARK_PATH_OFFSET;\n    }\n  }\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Old (compatibility) renderer.\n * Geras: spirit of old age.\n *\n * @class\n */\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.geras.RenderInfo');\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport type {Input} from '../../input.js';\nimport {inputTypes} from '../../input_types.js';\nimport {RenderInfo as BaseRenderInfo} from '../common/info.js';\nimport type {Measurable} from '../measurables/base.js';\nimport type {BottomRow} from '../measurables/bottom_row.js';\nimport {ExternalValueInput} from '../measurables/external_value_input.js';\nimport type {Field} from '../measurables/field.js';\nimport {InRowSpacer} from '../measurables/in_row_spacer.js';\nimport type {InputRow} from '../measurables/input_row.js';\nimport type {Row} from '../measurables/row.js';\nimport type {TopRow} from '../measurables/top_row.js';\nimport {Types} from '../measurables/types.js';\n\nimport type {ConstantProvider} from './constants.js';\nimport {InlineInput} from './measurables/inline_input.js';\nimport {StatementInput} from './measurables/statement_input.js';\nimport type {Renderer} from './renderer.js';\n\n\n/**\n * An object containing all sizing information needed to draw this block.\n *\n * This measure pass does not propagate changes to the block (although fields\n * may choose to rerender when getSize() is called).  However, calling it\n * repeatedly may be expensive.\n *\n * @alias Blockly.geras.RenderInfo\n */\nexport class RenderInfo extends BaseRenderInfo {\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  override constants_!: ConstantProvider;\n\n  protected override readonly renderer_: Renderer;\n\n  /**\n   * @param renderer The renderer in use.\n   * @param block The block to measure.\n   * @internal\n   */\n  constructor(renderer: Renderer, block: BlockSvg) {\n    super(renderer, block);\n    this.renderer_ = renderer;\n  }\n\n  /**\n   * Get the block renderer in use.\n   *\n   * @returns The block renderer in use.\n   * @internal\n   */\n  override getRenderer(): Renderer {\n    return this.renderer_;\n  }\n\n  override populateBottomRow_() {\n    super.populateBottomRow_();\n\n    const followsStatement = this.block_.inputList.length &&\n        this.block_.inputList[this.block_.inputList.length - 1].type ===\n            inputTypes.STATEMENT;\n    // The minimum height of the bottom row is smaller in Geras than in other\n    // renderers, because the dark path adds a pixel.\n    // If one of the row's elements has a greater height this will be\n    // overwritten in the compute pass.\n    if (!followsStatement) {\n      this.bottomRow.minHeight =\n          this.constants_.MEDIUM_PADDING - this.constants_.DARK_PATH_OFFSET;\n    }\n  }\n\n  override addInput_(input: Input, activeRow: Row) {\n    // Non-dummy inputs have visual representations onscreen.\n    if (this.isInline && input.type === inputTypes.VALUE) {\n      activeRow.elements.push(new InlineInput(this.constants_, input));\n      activeRow.hasInlineInput = true;\n    } else if (input.type === inputTypes.STATEMENT) {\n      activeRow.elements.push(new StatementInput(this.constants_, input));\n      activeRow.hasStatement = true;\n    } else if (input.type === inputTypes.VALUE) {\n      activeRow.elements.push(new ExternalValueInput(this.constants_, input));\n      activeRow.hasExternalInput = true;\n    } else if (input.type === inputTypes.DUMMY) {\n      // Dummy inputs have no visual representation, but the information is\n      // still important.\n      activeRow.minHeight =\n          Math.max(activeRow.minHeight, this.constants_.DUMMY_INPUT_MIN_HEIGHT);\n      activeRow.hasDummyInput = true;\n    }\n    // Ignore row alignment if inline.\n    if (!this.isInline && activeRow.align === null) {\n      activeRow.align = input.align;\n    }\n  }\n\n  override addElemSpacing_() {\n    let hasExternalInputs = false;\n    for (let i = 0, row; row = this.rows[i]; i++) {\n      if (row.hasExternalInput) {\n        hasExternalInputs = true;\n      }\n    }\n    for (let i = 0, row; row = this.rows[i]; i++) {\n      const oldElems = row.elements;\n      row.elements = [];\n      // No spacing needed before the corner on the top row or the bottom row.\n      if (row.startsWithElemSpacer()) {\n        // There's a spacer before the first element in the row.\n        row.elements.push(new InRowSpacer(\n            this.constants_, this.getInRowSpacing_(null, oldElems[0])));\n      }\n      if (!oldElems.length) {\n        continue;\n      }\n      for (let e = 0; e < oldElems.length - 1; e++) {\n        row.elements.push(oldElems[e]);\n        const spacing = this.getInRowSpacing_(oldElems[e], oldElems[e + 1]);\n        row.elements.push(new InRowSpacer(this.constants_, spacing));\n      }\n      row.elements.push(oldElems[oldElems.length - 1]);\n      if (row.endsWithElemSpacer()) {\n        let spacing =\n            this.getInRowSpacing_(oldElems[oldElems.length - 1], null);\n        if (hasExternalInputs && row.hasDummyInput) {\n          spacing += this.constants_.TAB_WIDTH;\n        }\n        // There's a spacer after the last element in the row.\n        row.elements.push(new InRowSpacer(this.constants_, spacing));\n      }\n    }\n  }\n\n  override getInRowSpacing_(prev: Measurable|null, next: Measurable|null) {\n    if (!prev) {\n      // Between an editable field and the beginning of the row.\n      if (next && Types.isField(next) && (next as Field).isEditable) {\n        return this.constants_.MEDIUM_PADDING;\n      }\n      // Inline input at the beginning of the row.\n      if (next && Types.isInlineInput(next)) {\n        return this.constants_.MEDIUM_LARGE_PADDING;\n      }\n      if (next && Types.isStatementInput(next)) {\n        return this.constants_.STATEMENT_INPUT_PADDING_LEFT;\n      }\n      // Anything else at the beginning of the row.\n      return this.constants_.LARGE_PADDING;\n    }\n\n    // Spacing between a non-input and the end of the row or a statement input.\n    if (!Types.isInput(prev) && (!next || Types.isStatementInput(next))) {\n      // Between an editable field and the end of the row.\n      if (Types.isField(prev) && (prev as Field).isEditable) {\n        return this.constants_.MEDIUM_PADDING;\n      }\n      // Padding at the end of an icon-only row to make the block shape clearer.\n      if (Types.isIcon(prev)) {\n        return this.constants_.LARGE_PADDING * 2 + 1;\n      }\n      if (Types.isHat(prev)) {\n        return this.constants_.NO_PADDING;\n      }\n      // Establish a minimum width for a block with a previous or next\n      // connection.\n      if (Types.isPreviousOrNextConnection(prev)) {\n        return this.constants_.LARGE_PADDING;\n      }\n      // Between rounded corner and the end of the row.\n      if (Types.isLeftRoundedCorner(prev)) {\n        return this.constants_.MIN_BLOCK_WIDTH;\n      }\n      // Between a jagged edge and the end of the row.\n      if (Types.isJaggedEdge(prev)) {\n        return this.constants_.NO_PADDING;\n      }\n      // Between noneditable fields and icons and the end of the row.\n      return this.constants_.LARGE_PADDING;\n    }\n\n    // Between inputs and the end of the row.\n    if (Types.isInput(prev) && !next) {\n      if (Types.isExternalInput(prev)) {\n        return this.constants_.NO_PADDING;\n      } else if (Types.isInlineInput(prev)) {\n        return this.constants_.LARGE_PADDING;\n      } else if (Types.isStatementInput(prev)) {\n        return this.constants_.NO_PADDING;\n      }\n    }\n\n    // Spacing between a non-input and an input.\n    if (!Types.isInput(prev) && next && Types.isInput(next)) {\n      // Between an editable field and an input.\n      if (Types.isField(prev) && (prev as Field).isEditable) {\n        if (Types.isInlineInput(next)) {\n          return this.constants_.SMALL_PADDING;\n        } else if (Types.isExternalInput(next)) {\n          return this.constants_.SMALL_PADDING;\n        }\n      } else {\n        if (Types.isInlineInput(next)) {\n          return this.constants_.MEDIUM_LARGE_PADDING;\n        } else if (Types.isExternalInput(next)) {\n          return this.constants_.MEDIUM_LARGE_PADDING;\n        } else if (Types.isStatementInput(next)) {\n          return this.constants_.LARGE_PADDING;\n        }\n      }\n      return this.constants_.LARGE_PADDING - 1;\n    }\n\n    // Spacing between an icon and an icon or field.\n    if (Types.isIcon(prev) && next && !Types.isInput(next)) {\n      return this.constants_.LARGE_PADDING;\n    }\n    // Spacing between an inline input and a field.\n    if (Types.isInlineInput(prev) && next && Types.isField(next)) {\n      // Editable field after inline input.\n      if ((next as Field).isEditable) {\n        return this.constants_.MEDIUM_PADDING;\n      } else {\n        // Noneditable field after inline input.\n        return this.constants_.LARGE_PADDING;\n      }\n    }\n\n    if (Types.isLeftSquareCorner(prev) && next) {\n      // Spacing between a hat and a corner\n      if (Types.isHat(next)) {\n        return this.constants_.NO_PADDING;\n      }\n      // Spacing between a square corner and a previous or next connection\n      if (Types.isPreviousConnection(next)) {\n        return next.notchOffset;\n      } else if (Types.isNextConnection(next)) {\n        // Next connections are shifted slightly to the left (in both LTR and\n        // RTL) to make the dark path under the previous connection show\n        // through.\n        const offset =\n            (this.RTL ? 1 : -1) * this.constants_.DARK_PATH_OFFSET / 2;\n        return next.notchOffset + offset;\n      }\n    }\n\n    // Spacing between a rounded corner and a previous or next connection.\n    if (Types.isLeftRoundedCorner(prev) && next) {\n      if (Types.isPreviousConnection(next)) {\n        return next.notchOffset - this.constants_.CORNER_RADIUS;\n      } else if (Types.isNextConnection(next)) {\n        // Next connections are shifted slightly to the left (in both LTR and\n        // RTL) to make the dark path under the previous connection show\n        // through.\n        const offset =\n            (this.RTL ? 1 : -1) * this.constants_.DARK_PATH_OFFSET / 2;\n        return next.notchOffset - this.constants_.CORNER_RADIUS + offset;\n      }\n    }\n\n    // Spacing between two fields of the same editability.\n    if (Types.isField(prev) && next && Types.isField(next) &&\n        (prev as Field).isEditable === (next as Field).isEditable) {\n      return this.constants_.LARGE_PADDING;\n    }\n\n    // Spacing between anything and a jagged edge.\n    if (next && Types.isJaggedEdge(next)) {\n      return this.constants_.LARGE_PADDING;\n    }\n\n    return this.constants_.MEDIUM_PADDING;\n  }\n\n  override getSpacerRowHeight_(prev: Row, next: Row) {\n    // If we have an empty block add a spacer to increase the height.\n    if (Types.isTopRow(prev) && Types.isBottomRow(next)) {\n      return this.constants_.EMPTY_BLOCK_SPACER_HEIGHT;\n    }\n    // Top and bottom rows act as a spacer so we don't need any extra padding.\n    if (Types.isTopRow(prev) || Types.isBottomRow(next)) {\n      return this.constants_.NO_PADDING;\n    }\n    if (prev.hasExternalInput && next.hasExternalInput) {\n      return this.constants_.LARGE_PADDING;\n    }\n    if (!prev.hasStatement && next.hasStatement) {\n      return this.constants_.BETWEEN_STATEMENT_PADDING_Y;\n    }\n    if (prev.hasStatement && next.hasStatement) {\n      return this.constants_.LARGE_PADDING;\n    }\n    if (!prev.hasStatement && next.hasDummyInput) {\n      return this.constants_.LARGE_PADDING;\n    }\n    if (prev.hasDummyInput) {\n      return this.constants_.LARGE_PADDING;\n    }\n    return this.constants_.MEDIUM_PADDING;\n  }\n\n  override getElemCenterline_(row: Row, elem: Measurable) {\n    if (Types.isSpacer(elem)) {\n      return row.yPos + elem.height / 2;\n    }\n    if (Types.isBottomRow(row)) {\n      const bottomRow = row as BottomRow;\n      const baseline =\n          bottomRow.yPos + bottomRow.height - bottomRow.descenderHeight;\n      if (Types.isNextConnection(elem)) {\n        return baseline + elem.height / 2;\n      }\n      return baseline - elem.height / 2;\n    }\n    if (Types.isTopRow(row)) {\n      const topRow = row as TopRow;\n      if (Types.isHat(elem)) {\n        return topRow.capline - elem.height / 2;\n      }\n      return topRow.capline + elem.height / 2;\n    }\n\n    let result = row.yPos;\n    if (Types.isField(elem) || Types.isIcon(elem)) {\n      result += elem.height / 2;\n      if ((row.hasInlineInput || row.hasStatement) &&\n          elem.height + this.constants_.TALL_INPUT_FIELD_OFFSET_Y <=\n              row.height) {\n        result += this.constants_.TALL_INPUT_FIELD_OFFSET_Y;\n      }\n    } else if (Types.isInlineInput(elem)) {\n      result += elem.height / 2;\n    } else {\n      result += row.height / 2;\n    }\n    return result;\n  }\n\n  override alignRowElements_() {\n    if (!this.isInline) {\n      super.alignRowElements_();\n      return;\n    }\n    // Walk backgrounds through rows on the block, keeping track of the right\n    // input edge.\n    let nextRightEdge = 0;\n    const rowNextRightEdges = new WeakMap();\n    let prevInput = null;\n    for (let i = this.rows.length - 1, row; row = this.rows[i]; i--) {\n      rowNextRightEdges.set(row, nextRightEdge);\n      if (Types.isInputRow(row)) {\n        if (row.hasStatement) {\n          this.alignStatementRow_(row as InputRow);\n        }\n        if (prevInput && prevInput.hasStatement &&\n            row.width < prevInput.width) {\n          rowNextRightEdges.set(row, prevInput.width);\n        } else {\n          nextRightEdge = row.width;\n        }\n        prevInput = row;\n      }\n    }\n    // Walk down each row from the top, comparing the prev and next right input\n    // edges and setting the desired width to the max of the two.\n    let prevRightEdge = 0;\n    for (let i = 0, row; row = this.rows[i]; i++) {\n      if (row.hasStatement) {\n        prevRightEdge = this.getDesiredRowWidth_(row);\n      } else if (Types.isSpacer(row)) {\n        // Set the spacer row to the max of the prev or next input width.\n        row.width = Math.max(prevRightEdge, rowNextRightEdges.get(row));\n      } else {\n        const currentWidth = row.width;\n        const desiredWidth =\n            Math.max(prevRightEdge, rowNextRightEdges.get(row));\n        const missingSpace = desiredWidth - currentWidth;\n        if (missingSpace > 0) {\n          this.addAlignmentPadding_(row, missingSpace);\n        }\n        prevRightEdge = row.width;\n      }\n    }\n  }\n\n  override getDesiredRowWidth_(row: Row) {\n    // Limit the width of a statement row when a block is inline.\n    if (this.isInline && row.hasStatement) {\n      return this.statementEdge + this.constants_.MAX_BOTTOM_WIDTH +\n          this.startX;\n    }\n    return super.getDesiredRowWidth_(row);\n  }\n\n  override finalize_() {\n    // Performance note: this could be combined with the draw pass, if the time\n    // that this takes is excessive.  But it shouldn't be, because it only\n    // accesses and sets properties that already exist on the objects.\n    let widestRowWithConnectedBlocks = 0;\n    let yCursor = 0;\n    for (let i = 0, row; row = this.rows[i]; i++) {\n      row.yPos = yCursor;\n      row.xPos = this.startX;\n      yCursor += row.height;\n\n      widestRowWithConnectedBlocks =\n          Math.max(widestRowWithConnectedBlocks, row.widthWithConnectedBlocks);\n      // Add padding to the bottom row if block height is less than minimum\n      const heightWithoutHat = yCursor - this.topRow.ascenderHeight;\n      if (row === this.bottomRow &&\n          heightWithoutHat < this.constants_.MIN_BLOCK_HEIGHT) {\n        // But the hat height shouldn't be part of this.\n        const diff = this.constants_.MIN_BLOCK_HEIGHT - heightWithoutHat;\n        this.bottomRow.height += diff;\n        yCursor += diff;\n      }\n      this.recordElemPositions_(row);\n    }\n    if (this.outputConnection && this.block_.nextConnection &&\n        this.block_.nextConnection.isConnected()) {\n      const target = this.block_.nextConnection.targetBlock();\n      if (target) {\n        // Include width of connected block in value to stack width measurement.\n        widestRowWithConnectedBlocks = Math.max(\n            widestRowWithConnectedBlocks,\n            target.getHeightWidth().width - this.constants_.DARK_PATH_OFFSET);\n      }\n    }\n\n    this.bottomRow.baseline = yCursor - this.bottomRow.descenderHeight;\n    this.widthWithChildren = widestRowWithConnectedBlocks + this.startX +\n        this.constants_.DARK_PATH_OFFSET;\n    this.width += this.constants_.DARK_PATH_OFFSET;\n    this.height = yCursor + this.constants_.DARK_PATH_OFFSET;\n    this.startY = this.topRow.capline;\n  }\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * An object that owns a block's rendering SVG elements.\n *\n * @class\n */\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.geras.PathObject');\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport type {BlockStyle} from '../../theme.js';\nimport * as colour from '../../utils/colour.js';\nimport * as dom from '../../utils/dom.js';\nimport {Svg} from '../../utils/svg.js';\nimport {PathObject as BasePathObject} from '../common/path_object.js';\n\nimport type {ConstantProvider} from './constants.js';\n\n\n/**\n * An object that handles creating and setting each of the SVG elements\n * used by the renderer.\n *\n * @alias Blockly.geras.PathObject\n */\nexport class PathObject extends BasePathObject {\n  /** @internal */\n  svgPathDark: SVGElement;\n  /** @internal */\n  svgPathLight: SVGElement;\n\n  /**\n   * The colour of the dark path on the block in '#RRGGBB' format.\n   *\n   * @internal\n   */\n  colourDark = '#000000';\n\n  /**\n   * @param root The root SVG element.\n   * @param style The style object to use for colouring.\n   * @param constants The renderer's constants.\n   * @internal\n   */\n  constructor(\n      root: SVGElement, style: BlockStyle,\n      public override constants: ConstantProvider) {\n    super(root, style, constants);\n\n    /** The dark path of the block. */\n    this.svgPathDark = dom.createSvgElement(\n        Svg.PATH, {'class': 'blocklyPathDark', 'transform': 'translate(1,1)'});\n    // SVG draw order is based on the order of elements (top most = back most)\n    // So we need to insert the dark path before the base path to make sure it\n    // gets drawn first.\n    this.svgRoot.insertBefore(this.svgPathDark, this.svgPath);\n\n    /** The light path of the block. */\n    this.svgPathLight = dom.createSvgElement(\n        Svg.PATH, {'class': 'blocklyPathLight'}, this.svgRoot);\n  }\n\n  override setPath(mainPath: string) {\n    this.svgPath.setAttribute('d', mainPath);\n    this.svgPathDark.setAttribute('d', mainPath);\n  }\n\n  /**\n   * Set the highlight path generated by the renderer onto the SVG element.\n   *\n   * @param highlightPath The highlight path.\n   * @internal\n   */\n  setHighlightPath(highlightPath: string) {\n    this.svgPathLight.setAttribute('d', highlightPath);\n  }\n\n  override flipRTL() {\n    // Mirror the block's path.\n    this.svgPath.setAttribute('transform', 'scale(-1 1)');\n    this.svgPathLight.setAttribute('transform', 'scale(-1 1)');\n    this.svgPathDark.setAttribute('transform', 'translate(1,1) scale(-1 1)');\n  }\n\n  override applyColour(block: BlockSvg) {\n    this.svgPathLight.style.display = '';\n    this.svgPathDark.style.display = '';\n    if (!this.style.colourTertiary) {\n      throw new Error(\n          'The renderer did not properly initialize the tertiary colour of ' +\n          'the block style');\n    }\n    this.svgPathLight.setAttribute('stroke', this.style.colourTertiary);\n    this.svgPathDark.setAttribute('fill', this.colourDark);\n\n    super.applyColour(block);\n\n    this.svgPath.setAttribute('stroke', 'none');\n  }\n\n  override setStyle(blockStyle: BlockStyle) {\n    this.style = blockStyle;\n    this.colourDark =\n        colour.blend('#000', this.style.colourPrimary, 0.2) || this.colourDark;\n  }\n\n  override updateHighlighted(highlighted: boolean) {\n    if (highlighted) {\n      this.svgPath.setAttribute(\n          'filter', 'url(#' + this.constants.embossFilterId + ')');\n      this.svgPathLight.style.display = 'none';\n    } else {\n      this.svgPath.setAttribute('filter', 'none');\n      this.svgPathLight.style.display = 'inline';\n    }\n  }\n\n  override updateShadow_(shadow: boolean) {\n    if (shadow) {\n      this.svgPathLight.style.display = 'none';\n      if (!this.style.colourSecondary) {\n        throw new Error(\n            'The renderer did not properly initialize the secondary colour ' +\n            'of the block style block style');\n      }\n      this.svgPathDark.setAttribute('fill', this.style.colourSecondary);\n      this.svgPath.setAttribute('stroke', 'none');\n      this.svgPath.setAttribute('fill', this.style.colourSecondary);\n    }\n  }\n\n  override updateDisabled_(disabled: boolean) {\n    super.updateDisabled_(disabled);\n    if (disabled) {\n      this.svgPath.setAttribute('stroke', 'none');\n    }\n  }\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Geras renderer.\n *\n * @class\n */\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.geras.Renderer');\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport type {BlockStyle, Theme} from '../../theme.js';\nimport * as blockRendering from '../common/block_rendering.js';\nimport type {RenderInfo as BaseRenderInfo} from '../common/info.js';\nimport {Renderer as BaseRenderer} from '../common/renderer.js';\n\nimport {ConstantProvider} from './constants.js';\nimport {Drawer} from './drawer.js';\nimport {HighlightConstantProvider} from './highlight_constants.js';\nimport {RenderInfo} from './info.js';\nimport {PathObject} from './path_object.js';\n\n\n/**\n * The geras renderer.\n *\n * @alias Blockly.geras.Renderer\n */\nexport class Renderer extends BaseRenderer {\n  /** The renderer's highlight constant provider. */\n  private highlightConstants_: HighlightConstantProvider|null = null;\n\n  /**\n   * @param name The renderer name.\n   * @internal\n   */\n  constructor(name: string) {\n    super(name);\n  }\n\n  /**\n   * Initialize the renderer.  Geras has a highlight provider in addition to\n   * the normal constant provider.\n   *\n   * @internal\n   */\n  override init(\n      theme: Theme, opt_rendererOverrides?: {[rendererConstant: string]: any}) {\n    super.init(theme, opt_rendererOverrides);\n    this.highlightConstants_ = this.makeHighlightConstants_();\n    this.highlightConstants_.init();\n  }\n\n  override refreshDom(svg: SVGElement, theme: Theme) {\n    super.refreshDom(svg, theme);\n    this.getHighlightConstants().init();\n  }\n\n  override makeConstants_() {\n    return new ConstantProvider();\n  }\n\n  /**\n   * Create a new instance of the renderer's render info object.\n   *\n   * @param block The block to measure.\n   * @returns The render info object.\n   */\n  protected override makeRenderInfo_(block: BlockSvg): RenderInfo {\n    return new RenderInfo(this, block);\n  }\n\n  /**\n   * Create a new instance of the renderer's drawer.\n   *\n   * @param block The block to render.\n   * @param info An object containing all information needed to render this\n   *     block.\n   * @returns The drawer.\n   */\n  protected override makeDrawer_(block: BlockSvg, info: BaseRenderInfo):\n      Drawer {\n    return new Drawer(block, (info as RenderInfo));\n  }\n\n  /**\n   * Create a new instance of a renderer path object.\n   *\n   * @param root The root SVG element.\n   * @param style The style object to use for colouring.\n   * @returns The renderer path object.\n   * @internal\n   */\n  override makePathObject(root: SVGElement, style: BlockStyle): PathObject {\n    return new PathObject(\n        root, style, (this.getConstants() as ConstantProvider));\n  }\n\n  /**\n   * Create a new instance of the renderer's highlight constant provider.\n   *\n   * @returns The highlight constant provider.\n   */\n  protected makeHighlightConstants_(): HighlightConstantProvider {\n    return new HighlightConstantProvider((this.getConstants()));\n  }\n\n  /**\n   * Get the renderer's highlight constant provider.  We assume that when this\n   * is called, the renderer has already been initialized.\n   *\n   * @returns The highlight constant provider.\n   * @internal\n   */\n  getHighlightConstants(): HighlightConstantProvider {\n    if (!this.highlightConstants_) {\n      throw new Error(\n          'Cannot access the highlight constants because init has not ' +\n          'been called');\n    }\n    return this.highlightConstants_;\n  }\n}\n\nblockRendering.register('geras', Renderer);\n","/** @file Re-exports of Blockly.geras.* modules. */\n\n/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Re-exports of Blockly.geras.* modules.\n *\n * @namespace Blockly.geras\n */\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.geras');\n\nimport {ConstantProvider} from './constants.js';\nimport {Drawer} from './drawer.js';\nimport {HighlightConstantProvider} from './highlight_constants.js';\nimport {Highlighter} from './highlighter.js';\nimport {RenderInfo} from './info.js';\nimport {InlineInput} from './measurables/inline_input.js';\nimport {StatementInput} from './measurables/statement_input.js';\nimport {PathObject} from './path_object.js';\nimport {Renderer} from './renderer.js';\n\n\nexport {\n  ConstantProvider,\n  Drawer,\n  HighlightConstantProvider,\n  Highlighter,\n  InlineInput,\n  PathObject,\n  Renderer,\n  RenderInfo,\n  StatementInput,\n};\n","/**\n * @license\n * Copyright 2016 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * An SVG that floats on top of the workspace.\n * Blocks are moved into this SVG during a drag, improving performance.\n * The entire SVG is translated using CSS translation instead of SVG so the\n * blocks are never repainted during drag improving performance.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.WorkspaceDragSurfaceSvg');\n\nimport type {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport {Svg} from './utils/svg.js';\nimport * as svgMath from './utils/svg_math.js';\n\n\n/**\n * Blocks are moved into this SVG during a drag, improving performance.\n * The entire SVG is translated using CSS transforms instead of SVG so the\n * blocks are never repainted during drag improving performance.\n *\n * @alias Blockly.WorkspaceDragSurfaceSvg\n */\nexport class WorkspaceDragSurfaceSvg {\n  /**\n   * The SVG drag surface. Set once by WorkspaceDragSurfaceSvg.createDom.\n   */\n  private SVG!: SVGElement;\n\n  /**\n   * The element to insert the block canvas and bubble canvas after when it\n   * goes back in the DOM at the end of a drag.\n   */\n  private previousSibling: Element|null = null;\n\n  /** @param container Containing element. */\n  constructor(private readonly container: Element) {\n    this.createDom();\n  }\n\n  /** Create the drag surface and inject it into the container. */\n  createDom() {\n    if (this.SVG) {\n      return;  // Already created.\n    }\n    /**\n     * Dom structure when the workspace is being dragged. If there is no drag in\n     * progress, the SVG is empty and display: none.\n     * <svg class=\"blocklyWsDragSurface\" style=transform:translate3d(...)>\n     *   <g class=\"blocklyBlockCanvas\"></g>\n     *   <g class=\"blocklyBubbleCanvas\">/g>\n     * </svg>\n     */\n    this.SVG = dom.createSvgElement(Svg.SVG, {\n      'xmlns': dom.SVG_NS,\n      'xmlns:html': dom.HTML_NS,\n      'xmlns:xlink': dom.XLINK_NS,\n      'version': '1.1',\n      'class': 'blocklyWsDragSurface blocklyOverflowVisible',\n    });\n    this.container.appendChild(this.SVG);\n  }\n\n  /**\n   * Translate the entire drag surface during a drag.\n   * We translate the drag surface instead of the blocks inside the surface\n   * so that the browser avoids repainting the SVG.\n   * Because of this, the drag coordinates must be adjusted by scale.\n   *\n   * @param x X translation for the entire surface\n   * @param y Y translation for the entire surface\n   * @internal\n   */\n  translateSurface(x: number, y: number) {\n    // Make sure the svg exists on a pixel boundary so that it is not fuzzy.\n    const fixedX = Math.round(x);\n    const fixedY = Math.round(y);\n\n    this.SVG.style.display = 'block';\n    dom.setCssTransform(\n        this.SVG, 'translate3d(' + fixedX + 'px, ' + fixedY + 'px, 0)');\n  }\n\n  /**\n   * Reports the surface translation in scaled workspace coordinates.\n   * Use this when finishing a drag to return blocks to the correct position.\n   *\n   * @returns Current translation of the surface\n   * @internal\n   */\n  getSurfaceTranslation(): Coordinate {\n    return svgMath.getRelativeXY((this.SVG));\n  }\n\n  /**\n   * Move the blockCanvas and bubbleCanvas out of the surface SVG and on to\n   * newSurface.\n   *\n   * @param newSurface The element to put the drag surface contents into.\n   * @internal\n   */\n  clearAndHide(newSurface: SVGElement) {\n    if (!newSurface) {\n      throw Error(\n          'Couldn\\'t clear and hide the drag surface: missing new surface.');\n    }\n    const blockCanvas = this.SVG.childNodes[0] as Element;\n    const bubbleCanvas = this.SVG.childNodes[1] as Element;\n    if (!blockCanvas || !bubbleCanvas ||\n        !(blockCanvas.classList.contains('blocklyBlockCanvas') ||\n          !bubbleCanvas.classList.contains('blocklyBubbleCanvas'))) {\n      throw Error(\n          'Couldn\\'t clear and hide the drag surface. A node was missing.');\n    }\n\n    // If there is a previous sibling, put the blockCanvas back right\n    // afterwards, otherwise insert it as the first child node in newSurface.\n    if (this.previousSibling !== null) {\n      dom.insertAfter(blockCanvas, this.previousSibling);\n    } else {\n      newSurface.insertBefore(blockCanvas, newSurface.firstChild);\n    }\n\n    // Reattach the bubble canvas after the blockCanvas.\n    dom.insertAfter(bubbleCanvas, blockCanvas);\n    // Hide the drag surface.\n    this.SVG.style.display = 'none';\n    if (this.SVG.childNodes.length) {\n      throw Error('Drag surface was not cleared.');\n    }\n    dom.setCssTransform(this.SVG, '');\n    this.previousSibling = null;\n  }\n\n  /**\n   * Set the SVG to have the block canvas and bubble canvas in it and then\n   * show the surface.\n   *\n   * @param blockCanvas The block canvas <g> element from the\n   *     workspace.\n   * @param bubbleCanvas The <g> element that contains the\n     bubbles.\n   * @param previousSibling The element to insert the block canvas and\n           bubble canvas after when it goes back in the DOM at the end of a\n     drag.\n   * @param width The width of the workspace SVG element.\n   * @param height The height of the workspace SVG element.\n   * @param scale The scale of the workspace being dragged.\n   * @internal\n   */\n  setContentsAndShow(\n      blockCanvas: SVGElement, bubbleCanvas: SVGElement,\n      previousSibling: Element, width: number, height: number, scale: number) {\n    if (this.SVG.childNodes.length) {\n      throw Error('Already dragging a block.');\n    }\n    this.previousSibling = previousSibling;\n    // Make sure the blocks and bubble canvas are scaled appropriately.\n    blockCanvas.setAttribute(\n        'transform', 'translate(0, 0) scale(' + scale + ')');\n    bubbleCanvas.setAttribute(\n        'transform', 'translate(0, 0) scale(' + scale + ')');\n    this.SVG.setAttribute('width', String(width));\n    this.SVG.setAttribute('height', String(height));\n    this.SVG.appendChild(blockCanvas);\n    this.SVG.appendChild(bubbleCanvas);\n    this.SVG.style.display = 'block';\n  }\n}\n","/**\n * @license\n * Copyright 2016 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * A class that manages a surface for dragging blocks.  When a\n * block drag is started, we move the block (and children) to a separate DOM\n * element that we move around using translate3d. At the end of the drag, the\n * blocks are put back in into the SVG they came from. This helps\n * performance by avoiding repainting the entire SVG on every mouse move\n * while dragging blocks.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.BlockDragSurfaceSvg');\n\nimport {Coordinate} from './utils/coordinate.js';\nimport * as deprecation from './utils/deprecation.js';\nimport * as dom from './utils/dom.js';\nimport {Svg} from './utils/svg.js';\nimport * as svgMath from './utils/svg_math.js';\n\n\n/**\n * Class for a drag surface for the currently dragged block. This is a separate\n * SVG that contains only the currently moving block, or nothing.\n *\n * @alias Blockly.BlockDragSurfaceSvg\n */\nexport class BlockDragSurfaceSvg {\n  /**\n   * The root element of the drag surface.\n   */\n  private svg: SVGElement;\n\n  /**\n   * This is where blocks live while they are being dragged if the drag\n   * surface is enabled.\n   */\n  private dragGroup: SVGElement;\n\n  /**\n   * Cached value for the scale of the drag surface.\n   * Used to set/get the correct translation during and after a drag.\n   */\n  private scale = 1;\n\n  /**\n   * Cached value for the translation of the drag surface.\n   * This translation is in pixel units, because the scale is applied to the\n   * drag group rather than the top-level SVG.\n   */\n  private surfaceXY = new Coordinate(0, 0);\n\n  /**\n   * Cached value for the translation of the child drag surface in pixel\n   * units. Since the child drag surface tracks the translation of the\n   * workspace this is ultimately the translation of the workspace.\n   */\n  private readonly childSurfaceXY = new Coordinate(0, 0);\n\n  /** @param container Containing element. */\n  constructor(private readonly container: Element) {\n    this.svg = dom.createSvgElement(\n        Svg.SVG, {\n          'xmlns': dom.SVG_NS,\n          'xmlns:html': dom.HTML_NS,\n          'xmlns:xlink': dom.XLINK_NS,\n          'version': '1.1',\n          'class': 'blocklyBlockDragSurface',\n        },\n        this.container);\n\n    this.dragGroup = dom.createSvgElement(Svg.G, {}, this.svg);\n  }\n\n  /**\n   * Create the drag surface and inject it into the container.\n   *\n   * @deprecated The DOM is automatically created by the constructor.\n   */\n  createDom() {\n    // No alternative provided, because now the dom is just automatically\n    // created in the constructor now.\n    deprecation.warn('BlockDragSurfaceSvg createDom', 'June 2022', 'June 2023');\n  }\n\n  /**\n   * Set the SVG blocks on the drag surface's group and show the surface.\n   * Only one block group should be on the drag surface at a time.\n   *\n   * @param blocks Block or group of blocks to place on the drag surface.\n   */\n  setBlocksAndShow(blocks: SVGElement) {\n    if (this.dragGroup.childNodes.length) {\n      throw Error('Already dragging a block.');\n    }\n    // appendChild removes the blocks from the previous parent\n    this.dragGroup.appendChild(blocks);\n    this.svg.style.display = 'block';\n    this.surfaceXY = new Coordinate(0, 0);\n  }\n\n  /**\n   * Translate and scale the entire drag surface group to the given position, to\n   * keep in sync with the workspace.\n   *\n   * @param x X translation in pixel coordinates.\n   * @param y Y translation in pixel coordinates.\n   * @param scale Scale of the group.\n   */\n  translateAndScaleGroup(x: number, y: number, scale: number) {\n    this.scale = scale;\n    // Make sure the svg exists on a pixel boundary so that it is not fuzzy.\n    const roundX = Math.round(x);\n    const roundY = Math.round(y);\n    this.childSurfaceXY.x = roundX;\n    this.childSurfaceXY.y = roundY;\n    this.dragGroup.setAttribute(\n        'transform',\n        'translate(' + roundX + ',' + roundY + ') scale(' + scale + ')');\n  }\n\n  /**\n   * Translate the drag surface's SVG based on its internal state.\n   *\n   * @internal\n   */\n  translateSurfaceInternal_() {\n    // Make sure the svg exists on a pixel boundary so that it is not fuzzy.\n    const x = Math.round(this.surfaceXY.x);\n    const y = Math.round(this.surfaceXY.y);\n    this.svg.style.display = 'block';\n    dom.setCssTransform(this.svg, 'translate3d(' + x + 'px, ' + y + 'px, 0)');\n  }\n\n  /**\n   * Translates the entire surface by a relative offset.\n   *\n   * @param deltaX Horizontal offset in pixel units.\n   * @param deltaY Vertical offset in pixel units.\n   */\n  translateBy(deltaX: number, deltaY: number) {\n    const x = this.surfaceXY.x + deltaX;\n    const y = this.surfaceXY.y + deltaY;\n    this.surfaceXY = new Coordinate(x, y);\n    this.translateSurfaceInternal_();\n  }\n\n  /**\n   * Translate the entire drag surface during a drag.\n   * We translate the drag surface instead of the blocks inside the surface\n   * so that the browser avoids repainting the SVG.\n   * Because of this, the drag coordinates must be adjusted by scale.\n   *\n   * @param x X translation for the entire surface.\n   * @param y Y translation for the entire surface.\n   */\n  translateSurface(x: number, y: number) {\n    this.surfaceXY = new Coordinate(x * this.scale, y * this.scale);\n    this.translateSurfaceInternal_();\n  }\n\n  /**\n   * Reports the surface translation in scaled workspace coordinates.\n   * Use this when finishing a drag to return blocks to the correct position.\n   *\n   * @returns Current translation of the surface.\n   */\n  getSurfaceTranslation(): Coordinate {\n    const xy = svgMath.getRelativeXY(this.svg);\n    return new Coordinate(xy.x / this.scale, xy.y / this.scale);\n  }\n\n  /**\n   * Provide a reference to the drag group (primarily for\n   * BlockSvg.getRelativeToSurfaceXY).\n   *\n   * @returns Drag surface group element.\n   */\n  getGroup(): SVGElement {\n    return this.dragGroup;\n  }\n\n  /**\n   * Returns the SVG drag surface.\n   *\n   * @returns The SVG drag surface.\n   */\n  getSvgRoot(): SVGElement {\n    return this.svg;\n  }\n\n  /**\n   * Get the current blocks on the drag surface, if any (primarily\n   * for BlockSvg.getRelativeToSurfaceXY).\n   *\n   * @returns Drag surface block DOM element, or null if no blocks exist.\n   */\n  getCurrentBlock(): Element|null {\n    return this.dragGroup.firstChild as Element;\n  }\n\n  /**\n   * Gets the translation of the child block surface\n   * This surface is in charge of keeping track of how much the workspace has\n   * moved.\n   *\n   * @returns The amount the workspace has been moved.\n   */\n  getWsTranslation(): Coordinate {\n    // Returning a copy so the coordinate can not be changed outside this class.\n    return this.childSurfaceXY.clone();\n  }\n\n  /**\n   * Clear the group and hide the surface; move the blocks off onto the provided\n   * element.\n   * If the block is being deleted it doesn't need to go back to the original\n   * surface, since it would be removed immediately during dispose.\n   *\n   * @param opt_newSurface Surface the dragging blocks should be moved to, or\n   *     null if the blocks should be removed from this surface without being\n   *     moved to a different surface.\n   */\n  clearAndHide(opt_newSurface?: Element) {\n    const currentBlockElement = this.getCurrentBlock();\n    if (currentBlockElement) {\n      if (opt_newSurface) {\n        // appendChild removes the node from this.dragGroup\n        opt_newSurface.appendChild(currentBlockElement);\n      } else {\n        this.dragGroup.removeChild(currentBlockElement);\n      }\n    }\n    this.svg.style.display = 'none';\n    if (this.dragGroup.childNodes.length) {\n      throw Error('Drag group was not cleared.');\n    }\n    this.surfaceXY = new Coordinate(0, 0);\n  }\n}\n","/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing a pair of scrollbars.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.ScrollbarPair');\n\nimport * as eventUtils from './events/utils.js';\nimport {Scrollbar} from './scrollbar.js';\nimport * as dom from './utils/dom.js';\nimport type {Metrics} from './utils/metrics.js';\nimport {Svg} from './utils/svg.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/**\n * Class for a pair of scrollbars.  Horizontal and vertical.\n *\n * @alias Blockly.ScrollbarPair\n */\nexport class ScrollbarPair {\n  hScroll: Scrollbar|null = null;\n  vScroll: Scrollbar|null = null;\n  corner_: SVGRectElement|null = null;\n\n  /** Previously recorded metrics from the workspace. */\n  private oldHostMetrics_: Metrics|null = null;\n\n  /**\n   * @param workspace Workspace to bind the scrollbars to.\n   * @param addHorizontal Whether to add a horizontal scrollbar.\n   *    Defaults to true.\n   * @param addVertical Whether to add a vertical scrollbar. Defaults to true.\n   * @param opt_class A class to be applied to these scrollbars.\n   * @param opt_margin The margin to apply to these scrollbars.\n   */\n  constructor(\n      private workspace: WorkspaceSvg, addHorizontal?: boolean,\n      addVertical?: boolean, opt_class?: string, opt_margin?: number) {\n    addHorizontal = addHorizontal === undefined ? true : addHorizontal;\n    addVertical = addVertical === undefined ? true : addVertical;\n    const isPair = addHorizontal && addVertical;\n\n    if (addHorizontal) {\n      this.hScroll =\n          new Scrollbar(workspace, true, isPair, opt_class, opt_margin);\n    }\n    if (addVertical) {\n      this.vScroll =\n          new Scrollbar(workspace, false, isPair, opt_class, opt_margin);\n    }\n\n    if (isPair) {\n      this.corner_ = dom.createSvgElement(Svg.RECT, {\n        'height': Scrollbar.scrollbarThickness,\n        'width': Scrollbar.scrollbarThickness,\n        'class': 'blocklyScrollbarBackground',\n      });\n      dom.insertAfter(this.corner_, workspace.getBubbleCanvas());\n    }\n  }\n\n  /**\n   * Dispose of this pair of scrollbars.\n   * Unlink from all DOM elements to prevent memory leaks.\n   *\n   * @suppress {checkTypes}\n   */\n  dispose() {\n    dom.removeNode(this.corner_);\n    this.corner_ = null;\n    this.oldHostMetrics_ = null;\n    if (this.hScroll) {\n      this.hScroll.dispose();\n      this.hScroll = null;\n    }\n    if (this.vScroll) {\n      this.vScroll.dispose();\n      this.vScroll = null;\n    }\n  }\n\n  /**\n   * Recalculate both of the scrollbars' locations and lengths.\n   * Also reposition the corner rectangle.\n   */\n  resize() {\n    // Look up the host metrics once, and use for both scrollbars.\n    const hostMetrics = this.workspace.getMetrics();\n    if (!hostMetrics) {\n      // Host element is likely not visible.\n      return;\n    }\n\n    // Only change the scrollbars if there has been a change in metrics.\n    let resizeH = false;\n    let resizeV = false;\n    if (!this.oldHostMetrics_ ||\n        this.oldHostMetrics_.viewWidth !== hostMetrics.viewWidth ||\n        this.oldHostMetrics_.viewHeight !== hostMetrics.viewHeight ||\n        this.oldHostMetrics_.absoluteTop !== hostMetrics.absoluteTop ||\n        this.oldHostMetrics_.absoluteLeft !== hostMetrics.absoluteLeft) {\n      // The window has been resized or repositioned.\n      resizeH = true;\n      resizeV = true;\n    } else {\n      // Has the content been resized or moved?\n      if (!this.oldHostMetrics_ ||\n          this.oldHostMetrics_.scrollWidth !== hostMetrics.scrollWidth ||\n          this.oldHostMetrics_.viewLeft !== hostMetrics.viewLeft ||\n          this.oldHostMetrics_.scrollLeft !== hostMetrics.scrollLeft) {\n        resizeH = true;\n      }\n      if (!this.oldHostMetrics_ ||\n          this.oldHostMetrics_.scrollHeight !== hostMetrics.scrollHeight ||\n          this.oldHostMetrics_.viewTop !== hostMetrics.viewTop ||\n          this.oldHostMetrics_.scrollTop !== hostMetrics.scrollTop) {\n        resizeV = true;\n      }\n    }\n\n    if (resizeH || resizeV) {\n      try {\n        eventUtils.disable();\n        if (this.hScroll && resizeH) {\n          this.hScroll.resize(hostMetrics);\n        }\n        if (this.vScroll && resizeV) {\n          this.vScroll.resize(hostMetrics);\n        }\n      } finally {\n        eventUtils.enable();\n      }\n      this.workspace.maybeFireViewportChangeEvent();\n    }\n\n    if (this.hScroll && this.vScroll) {\n      // Reposition the corner square.\n      if (!this.oldHostMetrics_ ||\n          this.oldHostMetrics_.viewWidth !== hostMetrics.viewWidth ||\n          this.oldHostMetrics_.absoluteLeft !== hostMetrics.absoluteLeft) {\n        this.corner_?.setAttribute('x', String(this.vScroll.position.x));\n      }\n      if (!this.oldHostMetrics_ ||\n          this.oldHostMetrics_.viewHeight !== hostMetrics.viewHeight ||\n          this.oldHostMetrics_.absoluteTop !== hostMetrics.absoluteTop) {\n        this.corner_?.setAttribute('y', String(this.hScroll.position.y));\n      }\n    }\n\n    // Cache the current metrics to potentially short-cut the next resize event.\n    this.oldHostMetrics_ = hostMetrics;\n  }\n\n  /**\n   * Returns whether scrolling horizontally is enabled.\n   *\n   * @returns True if horizontal scroll is enabled.\n   */\n  canScrollHorizontally(): boolean {\n    return !!this.hScroll;\n  }\n\n  /**\n   * Returns whether scrolling vertically is enabled.\n   *\n   * @returns True if vertical scroll is enabled.\n   */\n  canScrollVertically(): boolean {\n    return !!this.vScroll;\n  }\n\n  /**\n   * Record the origin of the workspace that the scrollbar is in, in pixels\n   * relative to the injection div origin. This is for times when the scrollbar\n   * is used in an object whose origin isn't the same as the main workspace\n   * (e.g. in a flyout.)\n   *\n   * @param x The x coordinate of the scrollbar's origin, in CSS pixels.\n   * @param y The y coordinate of the scrollbar's origin, in CSS pixels.\n   * @internal\n   */\n  setOrigin(x: number, y: number) {\n    if (this.hScroll) {\n      this.hScroll.setOrigin(x, y);\n    }\n    if (this.vScroll) {\n      this.vScroll.setOrigin(x, y);\n    }\n  }\n\n  /**\n   * Set the handles of both scrollbars.\n   *\n   * @param x The horizontal content displacement, relative to the view in\n   *     pixels.\n   * @param y The vertical content displacement, relative to the view in pixels.\n   * @param updateMetrics Whether to update metrics on this set call.\n   *    Defaults to true.\n   */\n  set(x: number, y: number, updateMetrics: boolean) {\n    // This function is equivalent to:\n    //   this.hScroll.set(x);\n    //   this.vScroll.set(y);\n    // However, that calls setMetrics twice which causes a chain of\n    // getAttribute->setAttribute->getAttribute resulting in an extra layout\n    // pass. Combining them speeds up rendering.\n    if (this.hScroll) {\n      this.hScroll.set(x, false);\n    }\n    if (this.vScroll) {\n      this.vScroll.set(y, false);\n    }\n\n    if (updateMetrics || updateMetrics === undefined) {\n      // Update metrics.\n      const xyRatio: {x?: number, y?: number} = {};\n      if (this.hScroll) {\n        xyRatio.x = this.hScroll.getRatio_();\n      }\n      if (this.vScroll) {\n        xyRatio.y = this.vScroll.getRatio_();\n      }\n      this.workspace.setMetrics(xyRatio);\n    }\n  }\n\n  /**\n   * Set the handle of the horizontal scrollbar to be at a certain position in\n   *    CSS pixels relative to its parents.\n   *\n   * @param x Horizontal scroll value.\n   */\n  setX(x: number) {\n    if (this.hScroll) {\n      this.hScroll.set(x, true);\n    }\n  }\n\n  /**\n   * Set the handle of the vertical scrollbar to be at a certain position in\n   *    CSS pixels relative to its parents.\n   *\n   * @param y Vertical scroll value.\n   */\n  setY(y: number) {\n    if (this.vScroll) {\n      this.vScroll.set(y, true);\n    }\n  }\n\n  /**\n   * Set whether this scrollbar's container is visible.\n   *\n   * @param visible Whether the container is visible.\n   */\n  setContainerVisible(visible: boolean) {\n    if (this.hScroll) {\n      this.hScroll.setContainerVisible(visible);\n    }\n    if (this.vScroll) {\n      this.vScroll.setContainerVisible(visible);\n    }\n  }\n\n  /**\n   * If any of the scrollbars are visible. Non-paired scrollbars may disappear\n   * when they aren't needed.\n   *\n   * @returns True if visible.\n   */\n  isVisible(): boolean {\n    let isVisible = false;\n    if (this.hScroll) {\n      isVisible = this.hScroll.isVisible();\n    }\n    if (this.vScroll) {\n      isVisible = isVisible || this.vScroll.isVisible();\n    }\n    return isVisible;\n  }\n\n  /**\n   * Recalculates the scrollbars' locations within their path and length.\n   * This should be called when the contents of the workspace have changed.\n   *\n   * @param hostMetrics A data structure describing all the required dimensions,\n   *     possibly fetched from the host object.\n   */\n  resizeContent(hostMetrics: Metrics) {\n    if (this.hScroll) {\n      this.hScroll.resizeContentHorizontal(hostMetrics);\n    }\n    if (this.vScroll) {\n      this.vScroll.resizeContentVertical(hostMetrics);\n    }\n  }\n\n  /**\n   * Recalculates the scrollbars' locations on the screen and path length.\n   * This should be called when the layout or size of the window has changed.\n   *\n   * @param hostMetrics A data structure describing all the required dimensions,\n   *     possibly fetched from the host object.\n   */\n  resizeView(hostMetrics: Metrics) {\n    if (this.hScroll) {\n      this.hScroll.resizeViewHorizontal(hostMetrics);\n    }\n    if (this.vScroll) {\n      this.vScroll.resizeViewVertical(hostMetrics);\n    }\n  }\n}\n","/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Utility functions for generating executable code from\n * Blockly code.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.CodeGenerator');\n\nimport type {Block} from './block.js';\nimport * as common from './common.js';\nimport {Names, NameType} from './names.js';\nimport * as deprecation from './utils/deprecation.js';\nimport type {Workspace} from './workspace.js';\n\n\n/**\n * Class for a code generator that translates the blocks into a language.\n *\n * @unrestricted\n * @alias Blockly.CodeGenerator\n */\nexport class CodeGenerator {\n  name_: string;\n\n  /**\n   * This is used as a placeholder in functions defined using\n   * CodeGenerator.provideFunction_.  It must not be legal code that could\n   * legitimately appear in a function definition (or comment), and it must\n   * not confuse the regular expression parser.\n   */\n  protected FUNCTION_NAME_PLACEHOLDER_ = '{leCUI8hutHZI4480Dc}';\n  FUNCTION_NAME_PLACEHOLDER_REGEXP_: RegExp;\n\n  /**\n   * Arbitrary code to inject into locations that risk causing infinite loops.\n   * Any instances of '%1' will be replaced by the block ID that failed.\n   * E.g. `  checkTimeout(%1);\\n`\n   */\n  INFINITE_LOOP_TRAP: string|null = null;\n\n  /**\n   * Arbitrary code to inject before every statement.\n   * Any instances of '%1' will be replaced by the block ID of the statement.\n   * E.g. `highlight(%1);\\n`\n   */\n  STATEMENT_PREFIX: string|null = null;\n\n  /**\n   * Arbitrary code to inject after every statement.\n   * Any instances of '%1' will be replaced by the block ID of the statement.\n   * E.g. `highlight(%1);\\n`\n   */\n  STATEMENT_SUFFIX: string|null = null;\n\n  /**\n   * The method of indenting.  Defaults to two spaces, but language generators\n   * may override this to increase indent or change to tabs.\n   */\n  INDENT = '  ';\n\n  /**\n   * Maximum length for a comment before wrapping.  Does not account for\n   * indenting level.\n   */\n  COMMENT_WRAP = 60;\n\n  /** List of outer-inner pairings that do NOT require parentheses. */\n  ORDER_OVERRIDES: number[][] = [];\n\n  /**\n   * Whether the init method has been called.\n   * Generators that set this flag to false after creation and true in init\n   * will cause blockToCode to emit a warning if the generator has not been\n   * initialized. If this flag is untouched, it will have no effect.\n   */\n  isInitialized: boolean|null = null;\n\n  /** Comma-separated list of reserved words. */\n  protected RESERVED_WORDS_ = '';\n\n  /** A dictionary of definitions to be printed before the code. */\n  protected definitions_: {[key: string]: string} = Object.create(null);\n\n  /**\n   * A dictionary mapping desired function names in definitions_ to actual\n   * function names (to avoid collisions with user functions).\n   */\n  protected functionNames_: {[key: string]: string} = Object.create(null);\n\n  /** A database of variable and procedure names. */\n  protected nameDB_?: Names = undefined;\n\n  /** @param name Language name of this generator. */\n  constructor(name: string) {\n    this.name_ = name;\n\n    this.FUNCTION_NAME_PLACEHOLDER_REGEXP_ =\n        new RegExp(this.FUNCTION_NAME_PLACEHOLDER_, 'g');\n  }\n\n  /**\n   * Generate code for all blocks in the workspace to the specified language.\n   *\n   * @param workspace Workspace to generate code from.\n   * @returns Generated code.\n   */\n  workspaceToCode(workspace?: Workspace): string {\n    if (!workspace) {\n      // Backwards compatibility from before there could be multiple workspaces.\n      console.warn(\n          'No workspace specified in workspaceToCode call.  Guessing.');\n      workspace = common.getMainWorkspace();\n    }\n    const code = [];\n    this.init(workspace);\n    const blocks = workspace.getTopBlocks(true);\n    for (let i = 0, block; block = blocks[i]; i++) {\n      let line = this.blockToCode(block);\n      if (Array.isArray(line)) {\n        // Value blocks return tuples of code and operator order.\n        // Top-level blocks don't care about operator order.\n        line = line[0];\n      }\n      if (line) {\n        if (block.outputConnection) {\n          // This block is a naked value.  Ask the language's code generator if\n          // it wants to append a semicolon, or something.\n          line = this.scrubNakedValue(line);\n          if (this.STATEMENT_PREFIX && !block.suppressPrefixSuffix) {\n            line = this.injectId(this.STATEMENT_PREFIX, block) + line;\n          }\n          if (this.STATEMENT_SUFFIX && !block.suppressPrefixSuffix) {\n            line = line + this.injectId(this.STATEMENT_SUFFIX, block);\n          }\n        }\n        code.push(line);\n      }\n    }\n    // Blank line between each section.\n    let codeString = code.join('\\n');\n    codeString = this.finish(codeString);\n    // Final scrubbing of whitespace.\n    codeString = codeString.replace(/^\\s+\\n/, '');\n    codeString = codeString.replace(/\\n\\s+$/, '\\n');\n    codeString = codeString.replace(/[ \\t]+\\n/g, '\\n');\n    return codeString;\n  }\n\n  // The following are some helpful functions which can be used by multiple\n\n  // languages.\n\n  /**\n   * Prepend a common prefix onto each line of code.\n   * Intended for indenting code or adding comment markers.\n   *\n   * @param text The lines of code.\n   * @param prefix The common prefix.\n   * @returns The prefixed lines of code.\n   */\n  prefixLines(text: string, prefix: string): string {\n    return prefix + text.replace(/(?!\\n$)\\n/g, '\\n' + prefix);\n  }\n\n  /**\n   * Recursively spider a tree of blocks, returning all their comments.\n   *\n   * @param block The block from which to start spidering.\n   * @returns Concatenated list of comments.\n   */\n  allNestedComments(block: Block): string {\n    const comments = [];\n    const blocks = block.getDescendants(true);\n    for (let i = 0; i < blocks.length; i++) {\n      const comment = blocks[i].getCommentText();\n      if (comment) {\n        comments.push(comment);\n      }\n    }\n    // Append an empty string to create a trailing line break when joined.\n    if (comments.length) {\n      comments.push('');\n    }\n    return comments.join('\\n');\n  }\n\n  /**\n   * Generate code for the specified block (and attached blocks).\n   * The generator must be initialized before calling this function.\n   *\n   * @param block The block to generate code for.\n   * @param opt_thisOnly True to generate code for only this statement.\n   * @returns For statement blocks, the generated code.\n   *     For value blocks, an array containing the generated code and an\n   * operator order value.  Returns '' if block is null.\n   */\n  blockToCode(block: Block|null, opt_thisOnly?: boolean): string\n      |[string, number] {\n    if (this.isInitialized === false) {\n      console.warn(\n          'CodeGenerator init was not called before blockToCode was called.');\n    }\n    if (!block) {\n      return '';\n    }\n    if (!block.isEnabled()) {\n      // Skip past this block if it is disabled.\n      return opt_thisOnly ? '' : this.blockToCode(block.getNextBlock());\n    }\n    if (block.isInsertionMarker()) {\n      // Skip past insertion markers.\n      return opt_thisOnly ? '' : this.blockToCode(block.getChildren(false)[0]);\n    }\n\n    const func = (this as any)[block.type];\n    if (typeof func !== 'function') {\n      throw Error(\n          'Language \"' + this.name_ + '\" does not know how to generate ' +\n          'code for block type \"' + block.type + '\".');\n    }\n    // First argument to func.call is the value of 'this' in the generator.\n    // Prior to 24 September 2013 'this' was the only way to access the block.\n    // The current preferred method of accessing the block is through the second\n    // argument to func.call, which becomes the first parameter to the\n    // generator.\n    let code = func.call(block, block);\n    if (Array.isArray(code)) {\n      // Value blocks return tuples of code and operator order.\n      if (!block.outputConnection) {\n        throw TypeError('Expecting string from statement block: ' + block.type);\n      }\n      return [this.scrub_(block, code[0], opt_thisOnly), code[1]];\n    } else if (typeof code === 'string') {\n      if (this.STATEMENT_PREFIX && !block.suppressPrefixSuffix) {\n        code = this.injectId(this.STATEMENT_PREFIX, block) + code;\n      }\n      if (this.STATEMENT_SUFFIX && !block.suppressPrefixSuffix) {\n        code = code + this.injectId(this.STATEMENT_SUFFIX, block);\n      }\n      return this.scrub_(block, code, opt_thisOnly);\n    } else if (code === null) {\n      // Block has handled code generation itself.\n      return '';\n    }\n    throw SyntaxError('Invalid code generated: ' + code);\n  }\n\n  /**\n   * Generate code representing the specified value input.\n   *\n   * @param block The block containing the input.\n   * @param name The name of the input.\n   * @param outerOrder The maximum binding strength (minimum order value) of any\n   *     operators adjacent to \"block\".\n   * @returns Generated code or '' if no blocks are connected or the specified\n   *     input does not exist.\n   */\n  valueToCode(block: Block, name: string, outerOrder: number): string {\n    if (isNaN(outerOrder)) {\n      throw TypeError('Expecting valid order from block: ' + block.type);\n    }\n    const targetBlock = block.getInputTargetBlock(name);\n    if (!targetBlock) {\n      return '';\n    }\n    const tuple = this.blockToCode(targetBlock);\n    if (tuple === '') {\n      // Disabled block.\n      return '';\n    }\n    // Value blocks must return code and order of operations info.\n    // Statement blocks must only return code.\n    if (!Array.isArray(tuple)) {\n      throw TypeError('Expecting tuple from value block: ' + targetBlock.type);\n    }\n    let code = tuple[0];\n    const innerOrder = tuple[1];\n    if (isNaN(innerOrder)) {\n      throw TypeError(\n          'Expecting valid order from value block: ' + targetBlock.type);\n    }\n    if (!code) {\n      return '';\n    }\n\n    // Add parentheses if needed.\n    let parensNeeded = false;\n    const outerOrderClass = Math.floor(outerOrder);\n    const innerOrderClass = Math.floor(innerOrder);\n    if (outerOrderClass <= innerOrderClass) {\n      if (outerOrderClass === innerOrderClass &&\n          (outerOrderClass === 0 || outerOrderClass === 99)) {\n        // Don't generate parens around NONE-NONE and ATOMIC-ATOMIC pairs.\n        // 0 is the atomic order, 99 is the none order.  No parentheses needed.\n        // In all known languages multiple such code blocks are not order\n        // sensitive.  In fact in Python ('a' 'b') 'c' would fail.\n      } else {\n        // The operators outside this code are stronger than the operators\n        // inside this code.  To prevent the code from being pulled apart,\n        // wrap the code in parentheses.\n        parensNeeded = true;\n        // Check for special exceptions.\n        for (let i = 0; i < this.ORDER_OVERRIDES.length; i++) {\n          if (this.ORDER_OVERRIDES[i][0] === outerOrder &&\n              this.ORDER_OVERRIDES[i][1] === innerOrder) {\n            parensNeeded = false;\n            break;\n          }\n        }\n      }\n    }\n    if (parensNeeded) {\n      // Technically, this should be handled on a language-by-language basis.\n      // However all known (sane) languages use parentheses for grouping.\n      code = '(' + code + ')';\n    }\n    return code;\n  }\n\n  /**\n   * Generate a code string representing the blocks attached to the named\n   * statement input. Indent the code.\n   * This is mainly used in generators. When trying to generate code to evaluate\n   * look at using workspaceToCode or blockToCode.\n   *\n   * @param block The block containing the input.\n   * @param name The name of the input.\n   * @returns Generated code or '' if no blocks are connected.\n   */\n  statementToCode(block: Block, name: string): string {\n    const targetBlock = block.getInputTargetBlock(name);\n    let code = this.blockToCode(targetBlock);\n    // Value blocks must return code and order of operations info.\n    // Statement blocks must only return code.\n    if (typeof code !== 'string') {\n      throw TypeError(\n          'Expecting code from statement block: ' +\n          (targetBlock && targetBlock.type));\n    }\n    if (code) {\n      code = this.prefixLines((code), this.INDENT);\n    }\n    return code;\n  }\n\n  /**\n   * Add an infinite loop trap to the contents of a loop.\n   * Add statement suffix at the start of the loop block (right after the loop\n   * statement executes), and a statement prefix to the end of the loop block\n   * (right before the loop statement executes).\n   *\n   * @param branch Code for loop contents.\n   * @param block Enclosing block.\n   * @returns Loop contents, with infinite loop trap added.\n   */\n  addLoopTrap(branch: string, block: Block): string {\n    if (this.INFINITE_LOOP_TRAP) {\n      branch = this.prefixLines(\n                   this.injectId(this.INFINITE_LOOP_TRAP, block), this.INDENT) +\n          branch;\n    }\n    if (this.STATEMENT_SUFFIX && !block.suppressPrefixSuffix) {\n      branch = this.prefixLines(\n                   this.injectId(this.STATEMENT_SUFFIX, block), this.INDENT) +\n          branch;\n    }\n    if (this.STATEMENT_PREFIX && !block.suppressPrefixSuffix) {\n      branch = branch +\n          this.prefixLines(\n              this.injectId(this.STATEMENT_PREFIX, block), this.INDENT);\n    }\n    return branch;\n  }\n\n  /**\n   * Inject a block ID into a message to replace '%1'.\n   * Used for STATEMENT_PREFIX, STATEMENT_SUFFIX, and INFINITE_LOOP_TRAP.\n   *\n   * @param msg Code snippet with '%1'.\n   * @param block Block which has an ID.\n   * @returns Code snippet with ID.\n   */\n  injectId(msg: string, block: Block): string {\n    const id = block.id.replace(/\\$/g, '$$$$');  // Issue 251.\n    return msg.replace(/%1/g, '\\'' + id + '\\'');\n  }\n\n  /**\n   * Add one or more words to the list of reserved words for this language.\n   *\n   * @param words Comma-separated list of words to add to the list.\n   *     No spaces.  Duplicates are ok.\n   */\n  addReservedWords(words: string) {\n    this.RESERVED_WORDS_ += words + ',';\n  }\n\n  /**\n   * Define a developer-defined function (not a user-defined procedure) to be\n   * included in the generated code.  Used for creating private helper\n   * functions. The first time this is called with a given desiredName, the code\n   * is saved and an actual name is generated.  Subsequent calls with the same\n   * desiredName have no effect but have the same return value.\n   *\n   * It is up to the caller to make sure the same desiredName is not\n   * used for different helper functions (e.g. use \"colourRandom\" and\n   * \"listRandom\", not \"random\").  There is no danger of colliding with reserved\n   * words, or user-defined variable or procedure names.\n   *\n   * The code gets output when CodeGenerator.finish() is called.\n   *\n   * @param desiredName The desired name of the function (e.g. mathIsPrime).\n   * @param code A list of statements or one multi-line code string.  Use '  '\n   *     for indents (they will be replaced).\n   * @returns The actual name of the new function.  This may differ from\n   *     desiredName if the former has already been taken by the user.\n   */\n  protected provideFunction_(desiredName: string, code: string[]|string):\n      string {\n    if (!this.definitions_[desiredName]) {\n      const functionName =\n          this.nameDB_!.getDistinctName(desiredName, NameType.PROCEDURE);\n      this.functionNames_[desiredName] = functionName;\n      if (Array.isArray(code)) {\n        code = code.join('\\n');\n      }\n      let codeText = code.trim().replace(\n          this.FUNCTION_NAME_PLACEHOLDER_REGEXP_, functionName);\n      // Change all '  ' indents into the desired indent.\n      // To avoid an infinite loop of replacements, change all indents to '\\0'\n      // character first, then replace them all with the indent.\n      // We are assuming that no provided functions contain a literal null char.\n      let oldCodeText;\n      while (oldCodeText !== codeText) {\n        oldCodeText = codeText;\n        codeText = codeText.replace(/^(( {2})*) {2}/gm, '$1\\0');\n      }\n      codeText = codeText.replace(/\\0/g, this.INDENT);\n      this.definitions_[desiredName] = codeText;\n    }\n    return this.functionNames_[desiredName];\n  }\n\n  /**\n   * Hook for code to run before code generation starts.\n   * Subclasses may override this, e.g. to initialise the database of variable\n   * names.\n   *\n   * @param _workspace Workspace to generate code from.\n   */\n  init(_workspace: Workspace) {\n    // Optionally override\n    // Create a dictionary of definitions to be printed before the code.\n    this.definitions_ = Object.create(null);\n    // Create a dictionary mapping desired developer-defined function names in\n    // definitions_ to actual function names (to avoid collisions with\n    // user-defined procedures).\n    this.functionNames_ = Object.create(null);\n  }\n\n  /**\n   * Common tasks for generating code from blocks.  This is called from\n   * blockToCode and is called on every block, not just top level blocks.\n   * Subclasses may override this, e.g. to generate code for statements\n   * following the block, or to handle comments for the specified block and any\n   * connected value blocks.\n   *\n   * @param _block The current block.\n   * @param code The code created for this block.\n   * @param _opt_thisOnly True to generate code for only this statement.\n   * @returns Code with comments and subsequent blocks added.\n   */\n  protected scrub_(_block: Block, code: string, _opt_thisOnly?: boolean):\n      string {\n    // Optionally override\n    return code;\n  }\n\n  /**\n   * Hook for code to run at end of code generation.\n   * Subclasses may override this, e.g. to prepend the generated code with\n   * import statements or variable definitions.\n   *\n   * @param code Generated code.\n   * @returns Completed code.\n   */\n  finish(code: string): string {\n    // Optionally override\n    // Clean up temporary data.\n    this.definitions_ = Object.create(null);\n    this.functionNames_ = Object.create(null);\n    return code;\n  }\n\n  /**\n   * Naked values are top-level blocks with outputs that aren't plugged into\n   * anything.\n   * Subclasses may override this, e.g. if their language does not allow\n   * naked values.\n   *\n   * @param line Line of generated code.\n   * @returns Legal line of code.\n   */\n  scrubNakedValue(line: string): string {\n    // Optionally override\n    return line;\n  }\n}\n\nObject.defineProperties(CodeGenerator.prototype, {\n  /**\n   * A database of variable names.\n   *\n   * @name Blockly.CodeGenerator.prototype.variableDB_\n   * @deprecated 'variableDB_' was renamed to 'nameDB_' (May 2021).\n   * @suppress {checkTypes}\n   */\n  variableDB_: ({\n    /** @returns Name database. */\n    get(this: CodeGenerator): Names |\n        undefined {\n          deprecation.warn('variableDB_', 'version 9', 'version 10', 'nameDB_');\n          return this.nameDB_;\n        },\n    /** @param nameDb New name database. */\n    set(this: CodeGenerator, nameDb: Names|undefined) {\n      deprecation.warn('variableDB_', 'version 9', 'version 10', 'nameDB_');\n      this.nameDB_ = nameDb;\n    },\n  }),\n});\n","/**\n * @license\n * Copyright 2016 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for a button in the flyout.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.FlyoutButton');\n\nimport * as browserEvents from './browser_events.js';\nimport * as Css from './css.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport * as parsing from './utils/parsing.js';\nimport * as style from './utils/style.js';\nimport {Svg} from './utils/svg.js';\nimport type * as toolbox from './utils/toolbox.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/**\n * Class for a button or label in the flyout.\n *\n * @alias Blockly.FlyoutButton\n */\nexport class FlyoutButton {\n  /** The horizontal margin around the text in the button. */\n  static TEXT_MARGIN_X = 5;\n\n  /** The vertical margin around the text in the button. */\n  static TEXT_MARGIN_Y = 2;\n  private readonly text_: string;\n  private readonly position_: Coordinate;\n  private readonly callbackKey_: string;\n  private readonly cssClass_: string|null;\n\n  /** Mouse up event data. */\n  private onMouseUpWrapper_: browserEvents.Data|null = null;\n  info: toolbox.ButtonOrLabelInfo;\n\n  /** The width of the button's rect. */\n  width = 0;\n\n  /** The height of the button's rect. */\n  height = 0;\n\n  /** The root SVG group for the button or label. */\n  private svgGroup_: SVGGElement|null = null;\n\n  /** The SVG element with the text of the label or button. */\n  private svgText_: SVGTextElement|null = null;\n\n  /**\n   * @param workspace The workspace in which to place this button.\n   * @param targetWorkspace The flyout's target workspace.\n   * @param json The JSON specifying the label/button.\n   * @param isLabel_ Whether this button should be styled as a label.\n   * @internal\n   */\n  constructor(\n      private readonly workspace: WorkspaceSvg,\n      private readonly targetWorkspace: WorkspaceSvg,\n      json: toolbox.ButtonOrLabelInfo, private readonly isLabel_: boolean) {\n    this.text_ = json['text'];\n\n    this.position_ = new Coordinate(0, 0);\n\n    /** The key to the function called when this button is clicked. */\n    this.callbackKey_ =\n        (json as\n         AnyDuringMigration)['callbackKey'] || /* Check the lower case version\n                                                   too to satisfy IE */\n        (json as AnyDuringMigration)['callbackkey'];\n\n    /** If specified, a CSS class to add to this button. */\n    this.cssClass_ = (json as AnyDuringMigration)['web-class'] || null;\n\n    /** The JSON specifying the label / button. */\n    this.info = json;\n  }\n\n  /**\n   * Create the button elements.\n   *\n   * @returns The button's SVG group.\n   */\n  createDom(): SVGElement {\n    let cssClass = this.isLabel_ ? 'blocklyFlyoutLabel' : 'blocklyFlyoutButton';\n    if (this.cssClass_) {\n      cssClass += ' ' + this.cssClass_;\n    }\n\n    this.svgGroup_ = dom.createSvgElement(\n        Svg.G, {'class': cssClass}, this.workspace.getCanvas());\n\n    let shadow;\n    if (!this.isLabel_) {\n      // Shadow rectangle (light source does not mirror in RTL).\n      shadow = dom.createSvgElement(\n          Svg.RECT, {\n            'class': 'blocklyFlyoutButtonShadow',\n            'rx': 4,\n            'ry': 4,\n            'x': 1,\n            'y': 1,\n          },\n          this.svgGroup_!);\n    }\n    // Background rectangle.\n    const rect = dom.createSvgElement(\n        Svg.RECT, {\n          'class': this.isLabel_ ? 'blocklyFlyoutLabelBackground' :\n                                   'blocklyFlyoutButtonBackground',\n          'rx': 4,\n          'ry': 4,\n        },\n        this.svgGroup_!);\n\n    const svgText = dom.createSvgElement(\n        Svg.TEXT, {\n          'class': this.isLabel_ ? 'blocklyFlyoutLabelText' : 'blocklyText',\n          'x': 0,\n          'y': 0,\n          'text-anchor': 'middle',\n        },\n        this.svgGroup_!);\n    let text = parsing.replaceMessageReferences(this.text_);\n    if (this.workspace.RTL) {\n      // Force text to be RTL by adding an RLM.\n      text += '\\u200F';\n    }\n    svgText.textContent = text;\n    if (this.isLabel_) {\n      this.svgText_ = svgText;\n      this.workspace.getThemeManager().subscribe(\n          this.svgText_, 'flyoutForegroundColour', 'fill');\n    }\n\n    const fontSize = style.getComputedStyle(svgText, 'fontSize');\n    const fontWeight = style.getComputedStyle(svgText, 'fontWeight');\n    const fontFamily = style.getComputedStyle(svgText, 'fontFamily');\n    this.width = dom.getFastTextWidthWithSizeString(\n        svgText, fontSize, fontWeight, fontFamily);\n    const fontMetrics =\n        dom.measureFontMetrics(text, fontSize, fontWeight, fontFamily);\n    this.height = fontMetrics.height;\n\n    if (!this.isLabel_) {\n      this.width += 2 * FlyoutButton.TEXT_MARGIN_X;\n      this.height += 2 * FlyoutButton.TEXT_MARGIN_Y;\n      shadow?.setAttribute('width', this.width.toString());\n      shadow?.setAttribute('height', this.height.toString());\n    }\n    rect.setAttribute('width', this.width.toString());\n    rect.setAttribute('height', this.height.toString());\n\n    svgText.setAttribute('x', (this.width / 2).toString());\n    svgText.setAttribute(\n        'y',\n        (this.height / 2 - fontMetrics.height / 2 + fontMetrics.baseline)\n            .toString());\n\n    this.updateTransform_();\n\n    // AnyDuringMigration because:  Argument of type 'SVGGElement | null' is not\n    // assignable to parameter of type 'EventTarget'.\n    this.onMouseUpWrapper_ = browserEvents.conditionalBind(\n        this.svgGroup_ as AnyDuringMigration, 'pointerup', this,\n        this.onMouseUp_);\n    return this.svgGroup_!;\n  }\n\n  /** Correctly position the flyout button and make it visible. */\n  show() {\n    this.updateTransform_();\n    this.svgGroup_!.setAttribute('display', 'block');\n  }\n\n  /** Update SVG attributes to match internal state. */\n  private updateTransform_() {\n    this.svgGroup_!.setAttribute(\n        'transform',\n        'translate(' + this.position_.x + ',' + this.position_.y + ')');\n  }\n\n  /**\n   * Move the button to the given x, y coordinates.\n   *\n   * @param x The new x coordinate.\n   * @param y The new y coordinate.\n   */\n  moveTo(x: number, y: number) {\n    this.position_.x = x;\n    this.position_.y = y;\n    this.updateTransform_();\n  }\n\n  /** @returns Whether or not the button is a label. */\n  isLabel(): boolean {\n    return this.isLabel_;\n  }\n\n  /**\n   * Location of the button.\n   *\n   * @returns x, y coordinates.\n   * @internal\n   */\n  getPosition(): Coordinate {\n    return this.position_;\n  }\n\n  /** @returns Text of the button. */\n  getButtonText(): string {\n    return this.text_;\n  }\n\n  /**\n   * Get the button's target workspace.\n   *\n   * @returns The target workspace of the flyout where this button resides.\n   */\n  getTargetWorkspace(): WorkspaceSvg {\n    return this.targetWorkspace;\n  }\n\n  /** Dispose of this button. */\n  dispose() {\n    if (this.onMouseUpWrapper_) {\n      browserEvents.unbind(this.onMouseUpWrapper_);\n    }\n    if (this.svgGroup_) {\n      dom.removeNode(this.svgGroup_);\n    }\n    if (this.svgText_) {\n      this.workspace.getThemeManager().unsubscribe(this.svgText_);\n    }\n  }\n\n  /**\n   * Do something when the button is clicked.\n   *\n   * @param e Pointer up event.\n   */\n  private onMouseUp_(e: PointerEvent) {\n    const gesture = this.targetWorkspace.getGesture(e);\n    if (gesture) {\n      gesture.cancel();\n    }\n\n    if (this.isLabel_ && this.callbackKey_) {\n      console.warn(\n          'Labels should not have callbacks. Label text: ' + this.text_);\n    } else if (\n        !this.isLabel_ &&\n        !(this.callbackKey_ &&\n          this.targetWorkspace.getButtonCallback(this.callbackKey_))) {\n      console.warn('Buttons should have callbacks. Button text: ' + this.text_);\n    } else if (!this.isLabel_) {\n      const callback =\n          this.targetWorkspace.getButtonCallback(this.callbackKey_);\n      if (callback) {\n        callback(this);\n      }\n    }\n  }\n}\n\n/** CSS for buttons and labels. See css.js for use. */\nCss.register(`\n.blocklyFlyoutButton {\n  fill: #888;\n  cursor: default;\n}\n\n.blocklyFlyoutButtonShadow {\n  fill: #666;\n}\n\n.blocklyFlyoutButton:hover {\n  fill: #aaa;\n}\n\n.blocklyFlyoutLabel {\n  cursor: default;\n}\n\n.blocklyFlyoutLabelBackground {\n  opacity: 0;\n}\n`);\n","/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Calculates and reports workspace metrics.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.MetricsManager');\n\nimport type {IFlyout} from './interfaces/i_flyout.js';\nimport type {IMetricsManager} from './interfaces/i_metrics_manager.js';\nimport type {IToolbox} from './interfaces/i_toolbox.js';\nimport * as registry from './registry.js';\nimport type {Metrics} from './utils/metrics.js';\nimport {Size} from './utils/size.js';\nimport * as toolboxUtils from './utils/toolbox.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/**\n * The manager for all workspace metrics calculations.\n *\n * @alias Blockly.MetricsManager\n */\nexport class MetricsManager implements IMetricsManager {\n  /** The workspace to calculate metrics for. */\n  protected readonly workspace_: WorkspaceSvg;\n\n  /** @param workspace The workspace to calculate metrics for. */\n  constructor(workspace: WorkspaceSvg) {\n    this.workspace_ = workspace;\n  }\n\n  /**\n   * Gets the dimensions of the given workspace component, in pixel coordinates.\n   *\n   * @param elem The element to get the dimensions of, or null.  It should be a\n   *     toolbox or flyout, and should implement getWidth() and getHeight().\n   * @returns An object containing width and height attributes, which will both\n   *     be zero if elem did not exist.\n   */\n  protected getDimensionsPx_(elem: IToolbox|null|IFlyout): Size {\n    let width = 0;\n    let height = 0;\n    if (elem) {\n      width = elem.getWidth();\n      height = elem.getHeight();\n    }\n    return new Size(width, height);\n  }\n\n  /**\n   * Gets the width and the height of the flyout on the workspace in pixel\n   * coordinates. Returns 0 for the width and height if the workspace has a\n   * category toolbox instead of a simple toolbox.\n   *\n   * @param opt_own Whether to only return the workspace's own flyout.\n   * @returns The width and height of the flyout.\n   */\n  getFlyoutMetrics(opt_own?: boolean): ToolboxMetrics {\n    const flyoutDimensions =\n        this.getDimensionsPx_(this.workspace_.getFlyout(opt_own));\n    return {\n      width: flyoutDimensions.width,\n      height: flyoutDimensions.height,\n      position: this.workspace_.toolboxPosition,\n    };\n  }\n\n  /**\n   * Gets the width, height and position of the toolbox on the workspace in\n   * pixel coordinates. Returns 0 for the width and height if the workspace has\n   * a simple toolbox instead of a category toolbox. To get the width and height\n   * of a\n   * simple toolbox @see {@link MetricsManager#getFlyoutMetrics}.\n   *\n   * @returns The object with the width, height and position of the toolbox.\n   */\n  getToolboxMetrics(): ToolboxMetrics {\n    const toolboxDimensions =\n        this.getDimensionsPx_(this.workspace_.getToolbox());\n\n    return {\n      width: toolboxDimensions.width,\n      height: toolboxDimensions.height,\n      position: this.workspace_.toolboxPosition,\n    };\n  }\n\n  /**\n   * Gets the width and height of the workspace's parent SVG element in pixel\n   * coordinates. This area includes the toolbox and the visible workspace area.\n   *\n   * @returns The width and height of the workspace's parent SVG element.\n   */\n  getSvgMetrics(): Size {\n    return this.workspace_.getCachedParentSvgSize();\n  }\n\n  /**\n   * Gets the absolute left and absolute top in pixel coordinates.\n   * This is where the visible workspace starts in relation to the SVG\n   * container.\n   *\n   * @returns The absolute metrics for the workspace.\n   */\n  getAbsoluteMetrics(): AbsoluteMetrics {\n    let absoluteLeft = 0;\n    const toolboxMetrics = this.getToolboxMetrics();\n    const flyoutMetrics = this.getFlyoutMetrics(true);\n    const doesToolboxExist = !!this.workspace_.getToolbox();\n    const doesFlyoutExist = !!this.workspace_.getFlyout(true);\n    const toolboxPosition =\n        doesToolboxExist ? toolboxMetrics.position : flyoutMetrics.position;\n\n    const atLeft = toolboxPosition === toolboxUtils.Position.LEFT;\n    const atTop = toolboxPosition === toolboxUtils.Position.TOP;\n    if (doesToolboxExist && atLeft) {\n      absoluteLeft = toolboxMetrics.width;\n    } else if (doesFlyoutExist && atLeft) {\n      absoluteLeft = flyoutMetrics.width;\n    }\n    let absoluteTop = 0;\n    if (doesToolboxExist && atTop) {\n      absoluteTop = toolboxMetrics.height;\n    } else if (doesFlyoutExist && atTop) {\n      absoluteTop = flyoutMetrics.height;\n    }\n\n    return {\n      top: absoluteTop,\n      left: absoluteLeft,\n    };\n  }\n\n  /**\n   * Gets the metrics for the visible workspace in either pixel or workspace\n   * coordinates. The visible workspace does not include the toolbox or flyout.\n   *\n   * @param opt_getWorkspaceCoordinates True to get the view metrics in\n   *     workspace coordinates, false to get them in pixel coordinates.\n   * @returns The width, height, top and left of the viewport in either\n   *     workspace coordinates or pixel coordinates.\n   */\n  getViewMetrics(opt_getWorkspaceCoordinates?: boolean): ContainerRegion {\n    const scale = opt_getWorkspaceCoordinates ? this.workspace_.scale : 1;\n    const svgMetrics = this.getSvgMetrics();\n    const toolboxMetrics = this.getToolboxMetrics();\n    const flyoutMetrics = this.getFlyoutMetrics(true);\n    const doesToolboxExist = !!this.workspace_.getToolbox();\n    const toolboxPosition =\n        doesToolboxExist ? toolboxMetrics.position : flyoutMetrics.position;\n\n    if (this.workspace_.getToolbox()) {\n      if (toolboxPosition === toolboxUtils.Position.TOP ||\n          toolboxPosition === toolboxUtils.Position.BOTTOM) {\n        svgMetrics.height -= toolboxMetrics.height;\n      } else if (\n          toolboxPosition === toolboxUtils.Position.LEFT ||\n          toolboxPosition === toolboxUtils.Position.RIGHT) {\n        svgMetrics.width -= toolboxMetrics.width;\n      }\n    } else if (this.workspace_.getFlyout(true)) {\n      if (toolboxPosition === toolboxUtils.Position.TOP ||\n          toolboxPosition === toolboxUtils.Position.BOTTOM) {\n        svgMetrics.height -= flyoutMetrics.height;\n      } else if (\n          toolboxPosition === toolboxUtils.Position.LEFT ||\n          toolboxPosition === toolboxUtils.Position.RIGHT) {\n        svgMetrics.width -= flyoutMetrics.width;\n      }\n    }\n    return {\n      height: svgMetrics.height / scale,\n      width: svgMetrics.width / scale,\n      top: -this.workspace_.scrollY / scale,\n      left: -this.workspace_.scrollX / scale,\n    };\n  }\n\n  /**\n   * Gets content metrics in either pixel or workspace coordinates.\n   * The content area is a rectangle around all the top bounded elements on the\n   * workspace (workspace comments and blocks).\n   *\n   * @param opt_getWorkspaceCoordinates True to get the content metrics in\n   *     workspace coordinates, false to get them in pixel coordinates.\n   * @returns The metrics for the content container.\n   */\n  getContentMetrics(opt_getWorkspaceCoordinates?: boolean): ContainerRegion {\n    const scale = opt_getWorkspaceCoordinates ? 1 : this.workspace_.scale;\n    // Block bounding box is in workspace coordinates.\n    const blockBox = this.workspace_.getBlocksBoundingBox();\n\n    return {\n      height: (blockBox.bottom - blockBox.top) * scale,\n      width: (blockBox.right - blockBox.left) * scale,\n      top: blockBox.top * scale,\n      left: blockBox.left * scale,\n    };\n  }\n\n  /**\n   * Returns whether the scroll area has fixed edges.\n   *\n   * @returns Whether the scroll area has fixed edges.\n   * @internal\n   */\n  hasFixedEdges(): boolean {\n    // This exists for optimization of bump logic.\n    return !this.workspace_.isMovableHorizontally() ||\n        !this.workspace_.isMovableVertically();\n  }\n\n  /**\n   * Computes the fixed edges of the scroll area.\n   *\n   * @param opt_viewMetrics The view metrics if they have been previously\n   *     computed. Passing in null may cause the view metrics to be computed\n   *     again, if it is needed.\n   * @returns The fixed edges of the scroll area.\n   */\n  protected getComputedFixedEdges_(opt_viewMetrics?: ContainerRegion):\n      FixedEdges {\n    if (!this.hasFixedEdges()) {\n      // Return early if there are no edges.\n      return {};\n    }\n\n    const hScrollEnabled = this.workspace_.isMovableHorizontally();\n    const vScrollEnabled = this.workspace_.isMovableVertically();\n\n    const viewMetrics = opt_viewMetrics || this.getViewMetrics(false);\n\n    const edges = {} as FixedEdges;\n    if (!vScrollEnabled) {\n      edges.top = viewMetrics.top;\n      edges.bottom = viewMetrics.top + viewMetrics.height;\n    }\n    if (!hScrollEnabled) {\n      edges.left = viewMetrics.left;\n      edges.right = viewMetrics.left + viewMetrics.width;\n    }\n    return edges;\n  }\n\n  /**\n   * Returns the content area with added padding.\n   *\n   * @param viewMetrics The view metrics.\n   * @param contentMetrics The content metrics.\n   * @returns The padded content area.\n   */\n  protected getPaddedContent_(\n      viewMetrics: ContainerRegion, contentMetrics: ContainerRegion):\n      {top: number, bottom: number, left: number, right: number} {\n    const contentBottom = contentMetrics.top + contentMetrics.height;\n    const contentRight = contentMetrics.left + contentMetrics.width;\n\n    const viewWidth = viewMetrics.width;\n    const viewHeight = viewMetrics.height;\n    const halfWidth = viewWidth / 2;\n    const halfHeight = viewHeight / 2;\n\n    // Add a padding around the content that is at least half a screen wide.\n    // Ensure padding is wide enough that blocks can scroll over entire screen.\n    const top =\n        Math.min(contentMetrics.top - halfHeight, contentBottom - viewHeight);\n    const left =\n        Math.min(contentMetrics.left - halfWidth, contentRight - viewWidth);\n    const bottom =\n        Math.max(contentBottom + halfHeight, contentMetrics.top + viewHeight);\n    const right =\n        Math.max(contentRight + halfWidth, contentMetrics.left + viewWidth);\n\n    return {top, bottom, left, right};\n  }\n\n  /**\n   * Returns the metrics for the scroll area of the workspace.\n   *\n   * @param opt_getWorkspaceCoordinates True to get the scroll metrics in\n   *     workspace coordinates, false to get them in pixel coordinates.\n   * @param opt_viewMetrics The view metrics if they have been previously\n   *     computed. Passing in null may cause the view metrics to be computed\n   *     again, if it is needed.\n   * @param opt_contentMetrics The content metrics if they have been previously\n   *     computed. Passing in null may cause the content metrics to be computed\n   *     again, if it is needed.\n   * @returns The metrics for the scroll container.\n   */\n  getScrollMetrics(\n      opt_getWorkspaceCoordinates?: boolean, opt_viewMetrics?: ContainerRegion,\n      opt_contentMetrics?: ContainerRegion): ContainerRegion {\n    const scale = opt_getWorkspaceCoordinates ? this.workspace_.scale : 1;\n    const viewMetrics = opt_viewMetrics || this.getViewMetrics(false);\n    const contentMetrics = opt_contentMetrics || this.getContentMetrics();\n    const fixedEdges = this.getComputedFixedEdges_(viewMetrics);\n\n    // Add padding around content.\n    const paddedContent = this.getPaddedContent_(viewMetrics, contentMetrics);\n\n    // Use combination of fixed bounds and padded content to make scroll area.\n    const top =\n        fixedEdges.top !== undefined ? fixedEdges.top : paddedContent.top;\n    const left =\n        fixedEdges.left !== undefined ? fixedEdges.left : paddedContent.left;\n    const bottom = fixedEdges.bottom !== undefined ? fixedEdges.bottom :\n                                                     paddedContent.bottom;\n    const right =\n        fixedEdges.right !== undefined ? fixedEdges.right : paddedContent.right;\n\n    return {\n      top: top / scale,\n      left: left / scale,\n      width: (right - left) / scale,\n      height: (bottom - top) / scale,\n    };\n  }\n\n  /**\n   * Returns common metrics used by UI elements.\n   *\n   * @returns The UI metrics.\n   */\n  getUiMetrics(): UiMetrics {\n    return {\n      viewMetrics: this.getViewMetrics(),\n      absoluteMetrics: this.getAbsoluteMetrics(),\n      toolboxMetrics: this.getToolboxMetrics(),\n    };\n  }\n\n  /**\n   * Returns an object with all the metrics required to size scrollbars for a\n   * top level workspace.  The following properties are computed:\n   * Coordinate system: pixel coordinates, -left, -up, +right, +down\n   * .viewHeight: Height of the visible portion of the workspace.\n   * .viewWidth: Width of the visible portion of the workspace.\n   * .contentHeight: Height of the content.\n   * .contentWidth: Width of the content.\n   * .scrollHeight: Height of the scroll area.\n   * .scrollWidth: Width of the scroll area.\n   * .svgHeight: Height of the Blockly div (the view + the toolbox,\n   *    simple or otherwise),\n   * .svgWidth: Width of the Blockly div (the view + the toolbox,\n   *    simple or otherwise),\n   * .viewTop: Top-edge of the visible portion of the workspace, relative to\n   *     the workspace origin.\n   * .viewLeft: Left-edge of the visible portion of the workspace, relative to\n   *     the workspace origin.\n   * .contentTop: Top-edge of the content, relative to the workspace origin.\n   * .contentLeft: Left-edge of the content relative to the workspace origin.\n   * .scrollTop: Top-edge of the scroll area, relative to the workspace origin.\n   * .scrollLeft: Left-edge of the scroll area relative to the workspace origin.\n   * .absoluteTop: Top-edge of the visible portion of the workspace, relative\n   *     to the blocklyDiv.\n   * .absoluteLeft: Left-edge of the visible portion of the workspace, relative\n   *     to the blocklyDiv.\n   * .toolboxWidth: Width of the toolbox, if it exists.  Otherwise zero.\n   * .toolboxHeight: Height of the toolbox, if it exists.  Otherwise zero.\n   * .flyoutWidth: Width of the flyout if it is always open.  Otherwise zero.\n   * .flyoutHeight: Height of the flyout if it is always open.  Otherwise zero.\n   * .toolboxPosition: Top, bottom, left or right. Use TOOLBOX_AT constants to\n   *     compare.\n   *\n   * @returns Contains size and position metrics of a top level workspace.\n   */\n  getMetrics(): Metrics {\n    const toolboxMetrics = this.getToolboxMetrics();\n    const flyoutMetrics = this.getFlyoutMetrics(true);\n    const svgMetrics = this.getSvgMetrics();\n    const absoluteMetrics = this.getAbsoluteMetrics();\n    const viewMetrics = this.getViewMetrics();\n    const contentMetrics = this.getContentMetrics();\n    const scrollMetrics =\n        this.getScrollMetrics(false, viewMetrics, contentMetrics);\n\n    return {\n      contentHeight: contentMetrics.height,\n      contentWidth: contentMetrics.width,\n      contentTop: contentMetrics.top,\n      contentLeft: contentMetrics.left,\n\n      scrollHeight: scrollMetrics.height,\n      scrollWidth: scrollMetrics.width,\n      scrollTop: scrollMetrics.top,\n      scrollLeft: scrollMetrics.left,\n\n      viewHeight: viewMetrics.height,\n      viewWidth: viewMetrics.width,\n      viewTop: viewMetrics.top,\n      viewLeft: viewMetrics.left,\n\n      absoluteTop: absoluteMetrics.top,\n      absoluteLeft: absoluteMetrics.left,\n\n      svgHeight: svgMetrics.height,\n      svgWidth: svgMetrics.width,\n\n      toolboxWidth: toolboxMetrics.width,\n      toolboxHeight: toolboxMetrics.height,\n      toolboxPosition: toolboxMetrics.position,\n\n      flyoutWidth: flyoutMetrics.width,\n      flyoutHeight: flyoutMetrics.height,\n    };\n  }\n}\n\nexport namespace MetricsManager {\n  /**\n   * Describes the width, height and location of the toolbox on the main\n   * workspace.\n   */\n  export interface ToolboxMetrics {\n    width: number;\n    height: number;\n    position: toolboxUtils.Position;\n  }\n\n  /** Describes where the viewport starts in relation to the workspace SVG. */\n  export interface AbsoluteMetrics {\n    left: number;\n    top: number;\n  }\n\n  /**\n   * All the measurements needed to describe the size and location of a\n   * container.\n   */\n  export interface ContainerRegion {\n    height: number;\n    width: number;\n    top: number;\n    left: number;\n  }\n\n  /** Describes fixed edges of the workspace. */\n  export interface FixedEdges {\n    top?: number;\n    bottom?: number;\n    left?: number;\n    right?: number;\n  }\n\n  /** Common metrics used for UI elements. */\n  export interface UiMetrics {\n    viewMetrics: ContainerRegion;\n    absoluteMetrics: AbsoluteMetrics;\n    toolboxMetrics: ToolboxMetrics;\n  }\n}\n\nexport type ToolboxMetrics = MetricsManager.ToolboxMetrics;\nexport type AbsoluteMetrics = MetricsManager.AbsoluteMetrics;\nexport type ContainerRegion = MetricsManager.ContainerRegion;\nexport type FixedEdges = MetricsManager.FixedEdges;\nexport type UiMetrics = MetricsManager.UiMetrics;\n\nregistry.register(\n    registry.Type.METRICS_MANAGER, registry.DEFAULT, MetricsManager);\n","/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Flyout tray containing blocks which may be created.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Flyout');\n\nimport type {Block} from './block.js';\nimport type {BlockSvg} from './block_svg.js';\nimport * as browserEvents from './browser_events.js';\nimport * as common from './common.js';\nimport {ComponentManager} from './component_manager.js';\nimport {DeleteArea} from './delete_area.js';\nimport * as eventUtils from './events/utils.js';\nimport {FlyoutButton} from './flyout_button.js';\nimport {FlyoutMetricsManager} from './flyout_metrics_manager.js';\nimport type {IFlyout} from './interfaces/i_flyout.js';\nimport type {Options} from './options.js';\nimport {ScrollbarPair} from './scrollbar_pair.js';\nimport * as blocks from './serialization/blocks.js';\nimport * as Tooltip from './tooltip.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport * as idGenerator from './utils/idgenerator.js';\nimport {Svg} from './utils/svg.js';\nimport * as toolbox from './utils/toolbox.js';\nimport * as Variables from './variables.js';\nimport {WorkspaceSvg} from './workspace_svg.js';\nimport * as Xml from './xml.js';\n\n\nenum FlyoutItemType {\n  BLOCK = 'block',\n  BUTTON = 'button',\n}\n\n/**\n * Class for a flyout.\n *\n * @alias Blockly.Flyout\n */\nexport abstract class Flyout extends DeleteArea implements IFlyout {\n  /**\n   * Position the flyout.\n   */\n  abstract position(): void;\n\n  /**\n   * Determine if a drag delta is toward the workspace, based on the position\n   * and orientation of the flyout. This is used in determineDragIntention_ to\n   * determine if a new block should be created or if the flyout should scroll.\n   *\n   * @param currentDragDeltaXY How far the pointer has\n   *     moved from the position at mouse down, in pixel units.\n   * @returns True if the drag is toward the workspace.\n   */\n  abstract isDragTowardWorkspace(currentDragDeltaXY: Coordinate): boolean;\n\n  /**\n   * Sets the translation of the flyout to match the scrollbars.\n   *\n   * @param xyRatio Contains a y property which is a float\n   *     between 0 and 1 specifying the degree of scrolling and a\n   *     similar x property.\n   */\n  protected abstract setMetrics_(xyRatio: {x?: number, y?: number}): void;\n\n  /**\n   * Lay out the blocks in the flyout.\n   *\n   * @param contents The blocks and buttons to lay\n   *     out.\n   * @param gaps The visible gaps between blocks.\n   */\n  protected abstract layout_(contents: FlyoutItem[], gaps: number[]): void;\n\n  /**\n   * Scroll the flyout.\n   *\n   * @param e Mouse wheel scroll event.\n   */\n  protected abstract wheel_(e: WheelEvent): void;\n\n  /**\n   * Compute height of flyout.  Position mat under each block.\n   * For RTL: Lay out the blocks right-aligned.\n   */\n  protected abstract reflowInternal_(): void;\n\n  /**\n   * Calculates the x coordinate for the flyout position.\n   *\n   * @returns X coordinate.\n   */\n  abstract getX(): number;\n\n  /**\n   * Calculates the y coordinate for the flyout position.\n   *\n   * @returns Y coordinate.\n   */\n  abstract getY(): number;\n\n  /**\n   * Scroll the flyout to the beginning of its contents.\n   */\n  abstract scrollToStart(): void;\n\n  /**\n   * The type of a flyout content item.\n   */\n  static FlyoutItemType = FlyoutItemType;\n\n  protected workspace_: WorkspaceSvg;\n  RTL: boolean;\n  /**\n   * Whether the flyout should be laid out horizontally or not.\n   *\n   * @internal\n   */\n  horizontalLayout = false;\n  protected toolboxPosition_: number;\n\n  /**\n   * Opaque data that can be passed to Blockly.unbindEvent_.\n   */\n  private eventWrappers_: browserEvents.Data = [];\n\n  /**\n   * Function that will be registered as a change listener on the workspace\n   * to reflow when blocks in the flyout workspace change.\n   */\n  private reflowWrapper_: Function|null = null;\n\n  /**\n   * Function that disables blocks in the flyout based on max block counts\n   * allowed in the target workspace. Registered as a change listener on the\n   * target workspace.\n   */\n  private filterWrapper_: Function|null = null;\n\n  /**\n   * List of background mats that lurk behind each block to catch clicks\n   * landing in the blocks' lakes and bays.\n   */\n  private mats_: SVGElement[] = [];\n  /**\n   * List of visible buttons.\n   */\n  protected buttons_: FlyoutButton[] = [];\n  /**\n   * List of event listeners.\n   */\n  private listeners_: browserEvents.Data[] = [];\n\n  /**\n   * List of blocks that should always be disabled.\n   */\n  private permanentlyDisabled_: Block[] = [];\n  protected readonly tabWidth_: number;\n\n  /**\n   * The target workspace.\n   *\n   * @internal\n   */\n  targetWorkspace!: WorkspaceSvg;\n  /**\n   * A list of blocks that can be reused.\n   */\n  private recycledBlocks_: BlockSvg[] = [];\n  /**\n   * Does the flyout automatically close when a block is created?\n   */\n  autoClose = true;\n\n  /**\n   * Whether the flyout is visible.\n   */\n  private isVisible_ = false;\n\n  /**\n   * Whether the workspace containing this flyout is visible.\n   */\n  private containerVisible_ = true;\n  protected rectMap_: WeakMap<BlockSvg, SVGElement>;\n\n  /**\n   * Corner radius of the flyout background.\n   */\n  readonly CORNER_RADIUS: number = 8;\n  readonly MARGIN: number;\n  readonly GAP_X: number;\n  readonly GAP_Y: number;\n\n  /**\n   * Top/bottom padding between scrollbar and edge of flyout background.\n   */\n  readonly SCROLLBAR_MARGIN: number = 2.5;\n\n  /**\n   * Width of flyout.\n   */\n  protected width_ = 0;\n\n  /**\n   * Height of flyout.\n   */\n  protected height_ = 0;\n  // clang-format off\n  /**\n   * Range of a drag angle from a flyout considered \"dragging toward\n   * workspace\". Drags that are within the bounds of this many degrees from\n   * the orthogonal line to the flyout edge are considered to be \"drags toward\n   * the workspace\".\n   *\n   * @example\n   *\n   * ```\n   * Flyout                                                 Edge   Workspace\n   * [block] /  <-within this angle, drags \"toward workspace\" |\n   * [block] ---- orthogonal to flyout boundary ----          |\n   * [block] \\                                                |\n   * ```\n   *\n   * The angle is given in degrees from the orthogonal.\n   *\n   * This is used to know when to create a new block and when to scroll the\n   * flyout. Setting it to 360 means that all drags create a new block.\n   */\n  // clang-format on\n  protected dragAngleRange_ = 70;\n\n  /**\n   * The path around the background of the flyout, which will be filled with a\n   * background colour.\n   */\n  protected svgBackground_: SVGPathElement|null = null;\n\n  /**\n   * The root SVG group for the button or label.\n   */\n  protected svgGroup_: SVGGElement|null = null;\n  /**\n   * @param workspaceOptions Dictionary of options for the\n   *     workspace.\n   */\n  constructor(workspaceOptions: Options) {\n    super();\n    workspaceOptions.setMetrics = this.setMetrics_.bind(this);\n\n    this.workspace_ = new WorkspaceSvg(workspaceOptions);\n    this.workspace_.setMetricsManager(\n        new FlyoutMetricsManager(this.workspace_, this));\n\n    this.workspace_.internalIsFlyout = true;\n    // Keep the workspace visibility consistent with the flyout's visibility.\n    this.workspace_.setVisible(this.isVisible_);\n\n    /**\n     * The unique id for this component that is used to register with the\n     * ComponentManager.\n     */\n    this.id = idGenerator.genUid();\n\n    /**\n     * Is RTL vs LTR.\n     */\n    this.RTL = !!workspaceOptions.RTL;\n\n    /**\n     * Position of the toolbox and flyout relative to the workspace.\n     */\n    this.toolboxPosition_ = workspaceOptions.toolboxPosition;\n\n    /**\n     * Width of output tab.\n     */\n    this.tabWidth_ = this.workspace_.getRenderer().getConstants().TAB_WIDTH;\n\n    /**\n     * A map from blocks to the rects which are beneath them to act as input\n     * targets.\n     *\n     * @internal\n     */\n    this.rectMap_ = new WeakMap();\n\n    /**\n     * Margin around the edges of the blocks in the flyout.\n     */\n    this.MARGIN = this.CORNER_RADIUS;\n\n    // TODO: Move GAP_X and GAP_Y to their appropriate files.\n    /**\n     * Gap between items in horizontal flyouts. Can be overridden with the \"sep\"\n     * element.\n     */\n    this.GAP_X = this.MARGIN * 3;\n\n    /**\n     * Gap between items in vertical flyouts. Can be overridden with the \"sep\"\n     * element.\n     */\n    this.GAP_Y = this.MARGIN * 3;\n  }\n\n  /**\n   * Creates the flyout's DOM.  Only needs to be called once.  The flyout can\n   * either exist as its own SVG element or be a g element nested inside a\n   * separate SVG element.\n   *\n   * @param tagName The type of tag to\n   *     put the flyout in. This should be <svg> or <g>.\n   * @returns The flyout's SVG group.\n   */\n  createDom(tagName: string|Svg<SVGSVGElement>|Svg<SVGGElement>): SVGElement {\n    /*\n        <svg | g>\n          <path class=\"blocklyFlyoutBackground\"/>\n          <g class=\"blocklyFlyout\"></g>\n        </ svg | g>\n        */\n    // Setting style to display:none to start. The toolbox and flyout\n    // hide/show code will set up proper visibility and size later.\n    this.svgGroup_ = dom.createSvgElement(\n        tagName, {'class': 'blocklyFlyout', 'style': 'display: none'});\n    this.svgBackground_ = dom.createSvgElement(\n        Svg.PATH, {'class': 'blocklyFlyoutBackground'}, this.svgGroup_);\n    this.svgGroup_.appendChild(this.workspace_.createDom());\n    this.workspace_.getThemeManager().subscribe(\n        this.svgBackground_, 'flyoutBackgroundColour', 'fill');\n    this.workspace_.getThemeManager().subscribe(\n        this.svgBackground_, 'flyoutOpacity', 'fill-opacity');\n    return this.svgGroup_;\n  }\n\n  /**\n   * Initializes the flyout.\n   *\n   * @param targetWorkspace The workspace in which to\n   *     create new blocks.\n   */\n  init(targetWorkspace: WorkspaceSvg) {\n    this.targetWorkspace = targetWorkspace;\n    this.workspace_.targetWorkspace = targetWorkspace;\n\n    this.workspace_.scrollbar = new ScrollbarPair(\n        this.workspace_, this.horizontalLayout, !this.horizontalLayout,\n        'blocklyFlyoutScrollbar', this.SCROLLBAR_MARGIN);\n\n    this.hide();\n\n    Array.prototype.push.apply(\n        this.eventWrappers_,\n        browserEvents.conditionalBind(\n            (this.svgGroup_ as SVGGElement), 'wheel', this, this.wheel_));\n    if (!this.autoClose) {\n      this.filterWrapper_ = this.filterForCapacity_.bind(this);\n      this.targetWorkspace.addChangeListener(this.filterWrapper_);\n    }\n\n    // Dragging the flyout up and down.\n    Array.prototype.push.apply(\n        this.eventWrappers_,\n        browserEvents.conditionalBind(\n            (this.svgBackground_ as SVGPathElement), 'pointerdown', this,\n            this.onMouseDown_));\n\n    // A flyout connected to a workspace doesn't have its own current gesture.\n    this.workspace_.getGesture =\n        this.targetWorkspace.getGesture.bind(this.targetWorkspace);\n\n    // Get variables from the main workspace rather than the target workspace.\n    this.workspace_.setVariableMap(this.targetWorkspace.getVariableMap());\n\n    this.workspace_.createPotentialVariableMap();\n\n    targetWorkspace.getComponentManager().addComponent({\n      component: this,\n      weight: 1,\n      capabilities: [\n        ComponentManager.Capability.DELETE_AREA,\n        ComponentManager.Capability.DRAG_TARGET,\n      ],\n    });\n  }\n\n  /**\n   * Dispose of this flyout.\n   * Unlink from all DOM elements to prevent memory leaks.\n   *\n   * @suppress {checkTypes}\n   */\n  dispose() {\n    this.hide();\n    this.workspace_.getComponentManager().removeComponent(this.id);\n    browserEvents.unbind(this.eventWrappers_);\n    if (this.filterWrapper_) {\n      this.targetWorkspace.removeChangeListener(this.filterWrapper_);\n      this.filterWrapper_ = null;\n    }\n    if (this.workspace_) {\n      this.workspace_.getThemeManager().unsubscribe(this.svgBackground_!);\n      this.workspace_.dispose();\n    }\n    if (this.svgGroup_) {\n      dom.removeNode(this.svgGroup_);\n      this.svgGroup_ = null;\n    }\n    this.svgBackground_ = null;\n  }\n\n  /**\n   * Get the width of the flyout.\n   *\n   * @returns The width of the flyout.\n   */\n  getWidth(): number {\n    return this.width_;\n  }\n\n  /**\n   * Get the height of the flyout.\n   *\n   * @returns The width of the flyout.\n   */\n  getHeight(): number {\n    return this.height_;\n  }\n\n  /**\n   * Get the scale (zoom level) of the flyout. By default,\n   * this matches the target workspace scale, but this can be overridden.\n   *\n   * @returns Flyout workspace scale.\n   */\n  getFlyoutScale(): number {\n    return this.targetWorkspace.scale;\n  }\n\n  /**\n   * Get the workspace inside the flyout.\n   *\n   * @returns The workspace inside the flyout.\n   */\n  getWorkspace(): WorkspaceSvg {\n    return this.workspace_;\n  }\n\n  /**\n   * Is the flyout visible?\n   *\n   * @returns True if visible.\n   */\n  isVisible(): boolean {\n    return this.isVisible_;\n  }\n\n  /**\n   * Set whether the flyout is visible. A value of true does not necessarily\n   * mean that the flyout is shown. It could be hidden because its container is\n   * hidden.\n   *\n   * @param visible True if visible.\n   */\n  setVisible(visible: boolean) {\n    const visibilityChanged = visible !== this.isVisible();\n\n    this.isVisible_ = visible;\n    if (visibilityChanged) {\n      if (!this.autoClose) {\n        // Auto-close flyouts are ignored as drag targets, so only non\n        // auto-close flyouts need to have their drag target updated.\n        this.workspace_.recordDragTargets();\n      }\n      this.updateDisplay_();\n    }\n  }\n\n  /**\n   * Set whether this flyout's container is visible.\n   *\n   * @param visible Whether the container is visible.\n   */\n  setContainerVisible(visible: boolean) {\n    const visibilityChanged = visible !== this.containerVisible_;\n    this.containerVisible_ = visible;\n    if (visibilityChanged) {\n      this.updateDisplay_();\n    }\n  }\n\n  /**\n   * Update the display property of the flyout based whether it thinks it should\n   * be visible and whether its containing workspace is visible.\n   */\n  private updateDisplay_() {\n    let show = true;\n    if (!this.containerVisible_) {\n      show = false;\n    } else {\n      show = this.isVisible();\n    }\n    if (this.svgGroup_) {\n      this.svgGroup_.style.display = show ? 'block' : 'none';\n    }\n    // Update the scrollbar's visibility too since it should mimic the\n    // flyout's visibility.\n    this.workspace_.scrollbar?.setContainerVisible(show);\n  }\n\n  /**\n   * Update the view based on coordinates calculated in position().\n   *\n   * @param width The computed width of the flyout's SVG group\n   * @param height The computed height of the flyout's SVG group.\n   * @param x The computed x origin of the flyout's SVG group.\n   * @param y The computed y origin of the flyout's SVG group.\n   */\n  protected positionAt_(width: number, height: number, x: number, y: number) {\n    this.svgGroup_?.setAttribute('width', width.toString());\n    this.svgGroup_?.setAttribute('height', height.toString());\n    this.workspace_.setCachedParentSvgSize(width, height);\n\n    if (this.svgGroup_?.tagName === 'svg') {\n      const transform = 'translate(' + x + 'px,' + y + 'px)';\n      dom.setCssTransform(this.svgGroup_, transform);\n    } else {\n      // IE and Edge don't support CSS transforms on SVG elements so\n      // it's important to set the transform on the SVG element itself\n      const transform = 'translate(' + x + ',' + y + ')';\n      this.svgGroup_?.setAttribute('transform', transform);\n    }\n\n    // Update the scrollbar (if one exists).\n    const scrollbar = this.workspace_.scrollbar;\n    if (scrollbar) {\n      // Set the scrollbars origin to be the top left of the flyout.\n      scrollbar.setOrigin(x, y);\n      scrollbar.resize();\n      // If origin changed and metrics haven't changed enough to trigger\n      // reposition in resize, we need to call setPosition. See issue #4692.\n      if (scrollbar.hScroll) {\n        scrollbar.hScroll.setPosition(\n            scrollbar.hScroll.position.x, scrollbar.hScroll.position.y);\n      }\n      if (scrollbar.vScroll) {\n        scrollbar.vScroll.setPosition(\n            scrollbar.vScroll.position.x, scrollbar.vScroll.position.y);\n      }\n    }\n  }\n\n  /**\n   * Hide and empty the flyout.\n   */\n  hide() {\n    if (!this.isVisible()) {\n      return;\n    }\n    this.setVisible(false);\n    // Delete all the event listeners.\n    for (let i = 0, listen; listen = this.listeners_[i]; i++) {\n      browserEvents.unbind(listen);\n    }\n    this.listeners_.length = 0;\n    if (this.reflowWrapper_) {\n      this.workspace_.removeChangeListener(this.reflowWrapper_);\n      this.reflowWrapper_ = null;\n    }\n  }\n  // Do NOT delete the blocks here.  Wait until Flyout.show.\n  // https://neil.fraser.name/news/2014/08/09/\n\n  /**\n   * Show and populate the flyout.\n   *\n   * @param flyoutDef Contents to display\n   *     in the flyout. This is either an array of Nodes, a NodeList, a\n   *     toolbox definition, or a string with the name of the dynamic category.\n   */\n  show(flyoutDef: toolbox.FlyoutDefinition|string) {\n    this.workspace_.setResizesEnabled(false);\n    this.hide();\n    this.clearOldBlocks_();\n\n    // Handle dynamic categories, represented by a name instead of a list.\n    if (typeof flyoutDef === 'string') {\n      flyoutDef = this.getDynamicCategoryContents_(flyoutDef);\n    }\n    this.setVisible(true);\n\n    // Parse the Array, Node or NodeList into a a list of flyout items.\n    const parsedContent = toolbox.convertFlyoutDefToJsonArray(flyoutDef);\n    const flyoutInfo = this.createFlyoutInfo_(parsedContent);\n\n    this.layout_(flyoutInfo.contents, flyoutInfo.gaps);\n\n    // IE 11 is an incompetent browser that fails to fire mouseout events.\n    // When the mouse is over the background, deselect all blocks.\n    function deselectAll(this: Flyout) {\n      const topBlocks = this.workspace_.getTopBlocks(false);\n      for (let i = 0, block; block = topBlocks[i]; i++) {\n        block.removeSelect();\n      }\n    }\n\n    this.listeners_.push(browserEvents.conditionalBind(\n        (this.svgBackground_ as SVGPathElement), 'pointerover', this,\n        deselectAll));\n\n    if (this.horizontalLayout) {\n      this.height_ = 0;\n    } else {\n      this.width_ = 0;\n    }\n    this.workspace_.setResizesEnabled(true);\n    this.reflow();\n\n    this.filterForCapacity_();\n\n    // Correctly position the flyout's scrollbar when it opens.\n    this.position();\n\n    this.reflowWrapper_ = this.reflow.bind(this);\n    this.workspace_.addChangeListener(this.reflowWrapper_);\n    this.emptyRecycledBlocks_();\n  }\n\n  /**\n   * Create the contents array and gaps array necessary to create the layout for\n   * the flyout.\n   *\n   * @param parsedContent The array\n   *     of objects to show in the flyout.\n   * @returns The list of contents and gaps needed to lay out the flyout.\n   */\n  private createFlyoutInfo_(parsedContent: toolbox.FlyoutItemInfoArray):\n      {contents: FlyoutItem[], gaps: number[]} {\n    const contents: FlyoutItem[] = [];\n    const gaps: number[] = [];\n    this.permanentlyDisabled_.length = 0;\n    const defaultGap = this.horizontalLayout ? this.GAP_X : this.GAP_Y;\n    for (let i = 0, contentInfo; contentInfo = parsedContent[i]; i++) {\n      if ('custom' in contentInfo) {\n        const customInfo = (contentInfo as toolbox.DynamicCategoryInfo);\n        const categoryName = customInfo['custom'];\n        const flyoutDef = this.getDynamicCategoryContents_(categoryName);\n        const parsedDynamicContent =\n            toolbox.convertFlyoutDefToJsonArray(flyoutDef);\n        // Replace the element at i with the dynamic content it represents.\n        parsedContent.splice.apply(\n            parsedContent, [i, 1, ...parsedDynamicContent]);\n        contentInfo = parsedContent[i];\n      }\n\n      switch (contentInfo['kind'].toUpperCase()) {\n        case 'BLOCK': {\n          const blockInfo = (contentInfo as toolbox.BlockInfo);\n          const block = this.createFlyoutBlock_(blockInfo);\n          contents.push({type: FlyoutItemType.BLOCK, block: block});\n          this.addBlockGap_(blockInfo, gaps, defaultGap);\n          break;\n        }\n        case 'SEP': {\n          const sepInfo = (contentInfo as toolbox.SeparatorInfo);\n          this.addSeparatorGap_(sepInfo, gaps, defaultGap);\n          break;\n        }\n        case 'LABEL': {\n          const labelInfo = (contentInfo as toolbox.LabelInfo);\n          // A label is a button with different styling.\n          const label = this.createButton_(labelInfo, /** isLabel */ true);\n          contents.push({type: FlyoutItemType.BUTTON, button: label});\n          gaps.push(defaultGap);\n          break;\n        }\n        case 'BUTTON': {\n          const buttonInfo = (contentInfo as toolbox.ButtonInfo);\n          const button = this.createButton_(buttonInfo, /** isLabel */ false);\n          contents.push({type: FlyoutItemType.BUTTON, button: button});\n          gaps.push(defaultGap);\n          break;\n        }\n      }\n    }\n    return {contents: contents, gaps: gaps};\n  }\n\n  /**\n   * Gets the flyout definition for the dynamic category.\n   *\n   * @param categoryName The name of the dynamic category.\n   * @returns The definition of the\n   *     flyout in one of its many forms.\n   */\n  private getDynamicCategoryContents_(categoryName: string):\n      toolbox.FlyoutDefinition {\n    // Look up the correct category generation function and call that to get a\n    // valid XML list.\n    const fnToApply =\n        this.workspace_.targetWorkspace!.getToolboxCategoryCallback(\n            categoryName);\n    if (typeof fnToApply !== 'function') {\n      throw TypeError(\n          'Couldn\\'t find a callback function when opening' +\n          ' a toolbox category.');\n    }\n    return fnToApply(this.workspace_.targetWorkspace!);\n  }\n\n  /**\n   * Creates a flyout button or a flyout label.\n   *\n   * @param btnInfo The object holding information about a button or a label.\n   * @param isLabel True if the button is a label, false otherwise.\n   * @returns The object used to display the button in the\n   *    flyout.\n   */\n  private createButton_(btnInfo: toolbox.ButtonOrLabelInfo, isLabel: boolean):\n      FlyoutButton {\n    const curButton = new FlyoutButton(\n        this.workspace_, (this.targetWorkspace as WorkspaceSvg), btnInfo,\n        isLabel);\n    return curButton;\n  }\n\n  /**\n   * Create a block from the xml and permanently disable any blocks that were\n   * defined as disabled.\n   *\n   * @param blockInfo The info of the block.\n   * @returns The block created from the blockInfo.\n   */\n  private createFlyoutBlock_(blockInfo: toolbox.BlockInfo): BlockSvg {\n    let block;\n    if (blockInfo['blockxml']) {\n      const xml = (typeof blockInfo['blockxml'] === 'string' ?\n                       Xml.textToDom(blockInfo['blockxml']) :\n                       blockInfo['blockxml']) as Element;\n      block = this.getRecycledBlock_(xml.getAttribute('type')!);\n      if (!block) {\n        block = Xml.domToBlock(xml, this.workspace_);\n      }\n    } else {\n      block = this.getRecycledBlock_(blockInfo['type']!);\n      if (!block) {\n        if (blockInfo['enabled'] === undefined) {\n          blockInfo['enabled'] = blockInfo['disabled'] !== 'true' &&\n              blockInfo['disabled'] !== true;\n        }\n        block = blocks.append((blockInfo as blocks.State), this.workspace_);\n      }\n    }\n\n    if (!block.isEnabled()) {\n      // Record blocks that were initially disabled.\n      // Do not enable these blocks as a result of capacity filtering.\n      this.permanentlyDisabled_.push(block);\n    }\n    return (block as BlockSvg);\n  }\n\n  /**\n   * Returns a block from the array of recycled blocks with the given type, or\n   * undefined if one cannot be found.\n   *\n   * @param blockType The type of the block to try to recycle.\n   * @returns The recycled block, or undefined if\n   *     one could not be recycled.\n   */\n  private getRecycledBlock_(blockType: string): BlockSvg|undefined {\n    let index = -1;\n    for (let i = 0; i < this.recycledBlocks_.length; i++) {\n      if (this.recycledBlocks_[i].type === blockType) {\n        index = i;\n        break;\n      }\n    }\n    return index === -1 ? undefined : this.recycledBlocks_.splice(index, 1)[0];\n  }\n\n  /**\n   * Adds a gap in the flyout based on block info.\n   *\n   * @param blockInfo Information about a block.\n   * @param gaps The list of gaps between items in the flyout.\n   * @param defaultGap The default gap between one element and the\n   *     next.\n   */\n  private addBlockGap_(\n      blockInfo: toolbox.BlockInfo, gaps: number[], defaultGap: number) {\n    let gap;\n    if (blockInfo['gap']) {\n      gap = parseInt(blockInfo['gap'].toString());\n    } else if (blockInfo['blockxml']) {\n      const xml = (typeof blockInfo['blockxml'] === 'string' ?\n                       Xml.textToDom(blockInfo['blockxml']) :\n                       blockInfo['blockxml']) as Element;\n      gap = parseInt(xml.getAttribute('gap')!);\n    }\n    gaps.push(!gap || isNaN(gap) ? defaultGap : gap);\n  }\n\n  /**\n   * Add the necessary gap in the flyout for a separator.\n   *\n   * @param sepInfo The object holding\n   *    information about a separator.\n   * @param gaps The list gaps between items in the flyout.\n   * @param defaultGap The default gap between the button and next\n   *     element.\n   */\n  private addSeparatorGap_(\n      sepInfo: toolbox.SeparatorInfo, gaps: number[], defaultGap: number) {\n    // Change the gap between two toolbox elements.\n    // <sep gap=\"36\"></sep>\n    // The default gap is 24, can be set larger or smaller.\n    // This overwrites the gap attribute on the previous element.\n    const newGap = parseInt(sepInfo['gap']!.toString());\n    // Ignore gaps before the first block.\n    if (!isNaN(newGap) && gaps.length > 0) {\n      gaps[gaps.length - 1] = newGap;\n    } else {\n      gaps.push(defaultGap);\n    }\n  }\n\n  /**\n   * Delete blocks, mats and buttons from a previous showing of the flyout.\n   */\n  private clearOldBlocks_() {\n    // Delete any blocks from a previous showing.\n    const oldBlocks = this.workspace_.getTopBlocks(false);\n    for (let i = 0, block; block = oldBlocks[i]; i++) {\n      if (this.blockIsRecyclable_(block)) {\n        this.recycleBlock_(block);\n      } else {\n        block.dispose(false, false);\n      }\n    }\n    // Delete any mats from a previous showing.\n    for (let j = 0; j < this.mats_.length; j++) {\n      const rect = this.mats_[j];\n      if (rect) {\n        Tooltip.unbindMouseEvents(rect);\n        dom.removeNode(rect);\n      }\n    }\n    this.mats_.length = 0;\n    // Delete any buttons from a previous showing.\n    for (let i = 0, button; button = this.buttons_[i]; i++) {\n      button.dispose();\n    }\n    this.buttons_.length = 0;\n\n    // Clear potential variables from the previous showing.\n    this.workspace_.getPotentialVariableMap()?.clear();\n  }\n\n  /**\n   * Empties all of the recycled blocks, properly disposing of them.\n   */\n  private emptyRecycledBlocks_() {\n    for (let i = 0; i < this.recycledBlocks_.length; i++) {\n      this.recycledBlocks_[i].dispose();\n    }\n    this.recycledBlocks_ = [];\n  }\n\n  /**\n   * Returns whether the given block can be recycled or not.\n   *\n   * @param _block The block to check for recyclability.\n   * @returns True if the block can be recycled. False otherwise.\n   */\n  protected blockIsRecyclable_(_block: BlockSvg): boolean {\n    // By default, recycling is disabled.\n    return false;\n  }\n\n  /**\n   * Puts a previously created block into the recycle bin and moves it to the\n   * top of the workspace. Used during large workspace swaps to limit the number\n   * of new DOM elements we need to create.\n   *\n   * @param block The block to recycle.\n   */\n  private recycleBlock_(block: BlockSvg) {\n    const xy = block.getRelativeToSurfaceXY();\n    block.moveBy(-xy.x, -xy.y);\n    this.recycledBlocks_.push(block);\n  }\n\n  /**\n   * Add listeners to a block that has been added to the flyout.\n   *\n   * @param root The root node of the SVG group the block is in.\n   * @param block The block to add listeners for.\n   * @param rect The invisible rectangle under the block that acts\n   *     as a mat for that block.\n   */\n  protected addBlockListeners_(\n      root: SVGElement, block: BlockSvg, rect: SVGElement) {\n    this.listeners_.push(browserEvents.conditionalBind(\n        root, 'pointerdown', null, this.blockMouseDown_(block)));\n    this.listeners_.push(browserEvents.conditionalBind(\n        rect, 'pointerdown', null, this.blockMouseDown_(block)));\n    this.listeners_.push(\n        browserEvents.bind(root, 'pointerenter', block, block.addSelect));\n    this.listeners_.push(\n        browserEvents.bind(root, 'pointerleave', block, block.removeSelect));\n    this.listeners_.push(\n        browserEvents.bind(rect, 'pointerenter', block, block.addSelect));\n    this.listeners_.push(\n        browserEvents.bind(rect, 'pointerleave', block, block.removeSelect));\n  }\n\n  /**\n   * Handle a pointerdown on an SVG block in a non-closing flyout.\n   *\n   * @param block The flyout block to copy.\n   * @returns Function to call when block is clicked.\n   */\n  private blockMouseDown_(block: BlockSvg): Function {\n    return (e: PointerEvent) => {\n      const gesture = this.targetWorkspace.getGesture(e);\n      if (gesture) {\n        gesture.setStartBlock(block);\n        gesture.handleFlyoutStart(e, this);\n      }\n    };\n  }\n\n  /**\n   * Pointer down on the flyout background.  Start a vertical scroll drag.\n   *\n   * @param e Pointer down event.\n   */\n  private onMouseDown_(e: PointerEvent) {\n    const gesture = this.targetWorkspace.getGesture(e);\n    if (gesture) {\n      gesture.handleFlyoutStart(e, this);\n    }\n  }\n\n  /**\n   * Does this flyout allow you to create a new instance of the given block?\n   * Used for deciding if a block can be \"dragged out of\" the flyout.\n   *\n   * @param block The block to copy from the flyout.\n   * @returns True if you can create a new instance of the block, false\n   *    otherwise.\n   * @internal\n   */\n  isBlockCreatable(block: BlockSvg): boolean {\n    return block.isEnabled();\n  }\n\n  /**\n   * Create a copy of this block on the workspace.\n   *\n   * @param originalBlock The block to copy from the flyout.\n   * @returns The newly created block.\n   * @throws {Error} if something went wrong with deserialization.\n   * @internal\n   */\n  createBlock(originalBlock: BlockSvg): BlockSvg {\n    let newBlock = null;\n    eventUtils.disable();\n    const variablesBeforeCreation = this.targetWorkspace.getAllVariables();\n    this.targetWorkspace.setResizesEnabled(false);\n    try {\n      newBlock = this.placeNewBlock_(originalBlock);\n    } finally {\n      eventUtils.enable();\n    }\n\n    // Close the flyout.\n    this.targetWorkspace.hideChaff();\n\n    const newVariables = Variables.getAddedVariables(\n        this.targetWorkspace, variablesBeforeCreation);\n\n    if (eventUtils.isEnabled()) {\n      eventUtils.setGroup(true);\n      // Fire a VarCreate event for each (if any) new variable created.\n      for (let i = 0; i < newVariables.length; i++) {\n        const thisVariable = newVariables[i];\n        eventUtils.fire(\n            new (eventUtils.get(eventUtils.VAR_CREATE))(thisVariable));\n      }\n\n      // Block events come after var events, in case they refer to newly created\n      // variables.\n      eventUtils.fire(new (eventUtils.get(eventUtils.BLOCK_CREATE))(newBlock));\n    }\n    if (this.autoClose) {\n      this.hide();\n    } else {\n      this.filterForCapacity_();\n    }\n    return newBlock;\n  }\n\n  /**\n   * Initialize the given button: move it to the correct location,\n   * add listeners, etc.\n   *\n   * @param button The button to initialize and place.\n   * @param x The x position of the cursor during this layout pass.\n   * @param y The y position of the cursor during this layout pass.\n   */\n  protected initFlyoutButton_(button: FlyoutButton, x: number, y: number) {\n    const buttonSvg = button.createDom();\n    button.moveTo(x, y);\n    button.show();\n    // Clicking on a flyout button or label is a lot like clicking on the\n    // flyout background.\n    this.listeners_.push(browserEvents.conditionalBind(\n        buttonSvg, 'pointerdown', this, this.onMouseDown_));\n\n    this.buttons_.push(button);\n  }\n\n  /**\n   * Create and place a rectangle corresponding to the given block.\n   *\n   * @param block The block to associate the rect to.\n   * @param x The x position of the cursor during this layout pass.\n   * @param y The y position of the cursor during this layout pass.\n   * @param blockHW The height and width of\n   *     the block.\n   * @param index The index into the mats list where this rect should\n   *     be placed.\n   * @returns Newly created SVG element for the rectangle behind\n   *     the block.\n   */\n  protected createRect_(\n      block: BlockSvg, x: number, y: number,\n      blockHW: {height: number, width: number}, index: number): SVGElement {\n    // Create an invisible rectangle under the block to act as a button.  Just\n    // using the block as a button is poor, since blocks have holes in them.\n    const rect = dom.createSvgElement(Svg.RECT, {\n      'fill-opacity': 0,\n      'x': x,\n      'y': y,\n      'height': blockHW.height,\n      'width': blockHW.width,\n    });\n    (rect as AnyDuringMigration).tooltip = block;\n    Tooltip.bindMouseEvents(rect);\n    // Add the rectangles under the blocks, so that the blocks' tooltips work.\n    this.workspace_.getCanvas().insertBefore(rect, block.getSvgRoot());\n\n    this.rectMap_.set(block, rect);\n    this.mats_[index] = rect;\n    return rect;\n  }\n\n  /**\n   * Move a rectangle to sit exactly behind a block, taking into account tabs,\n   * hats, and any other protrusions we invent.\n   *\n   * @param rect The rectangle to move directly behind the block.\n   * @param block The block the rectangle should be behind.\n   */\n  protected moveRectToBlock_(rect: SVGElement, block: BlockSvg) {\n    const blockHW = block.getHeightWidth();\n    rect.setAttribute('width', blockHW.width.toString());\n    rect.setAttribute('height', blockHW.height.toString());\n\n    const blockXY = block.getRelativeToSurfaceXY();\n    rect.setAttribute('y', blockXY.y.toString());\n    rect.setAttribute(\n        'x', (this.RTL ? blockXY.x - blockHW.width : blockXY.x).toString());\n  }\n\n  /**\n   * Filter the blocks on the flyout to disable the ones that are above the\n   * capacity limit.  For instance, if the user may only place two more blocks\n   * on the workspace, an \"a + b\" block that has two shadow blocks would be\n   * disabled.\n   */\n  private filterForCapacity_() {\n    const blocks = this.workspace_.getTopBlocks(false);\n    for (let i = 0, block; block = blocks[i]; i++) {\n      if (this.permanentlyDisabled_.indexOf(block) === -1) {\n        const enable = this.targetWorkspace.isCapacityAvailable(\n            common.getBlockTypeCounts(block));\n        while (block) {\n          block.setEnabled(enable);\n          block = block.getNextBlock();\n        }\n      }\n    }\n  }\n\n  /**\n   * Reflow blocks and their mats.\n   */\n  reflow() {\n    if (this.reflowWrapper_) {\n      this.workspace_.removeChangeListener(this.reflowWrapper_);\n    }\n    this.reflowInternal_();\n    if (this.reflowWrapper_) {\n      this.workspace_.addChangeListener(this.reflowWrapper_);\n    }\n  }\n\n  /**\n   * @returns True if this flyout may be scrolled with a scrollbar or\n   *     by dragging.\n   * @internal\n   */\n  isScrollable(): boolean {\n    return this.workspace_.scrollbar ? this.workspace_.scrollbar.isVisible() :\n                                       false;\n  }\n\n  /**\n   * Copy a block from the flyout to the workspace and position it correctly.\n   *\n   * @param oldBlock The flyout block to copy.\n   * @returns The new block in the main workspace.\n   */\n  private placeNewBlock_(oldBlock: BlockSvg): BlockSvg {\n    const targetWorkspace = this.targetWorkspace;\n    const svgRootOld = oldBlock.getSvgRoot();\n    if (!svgRootOld) {\n      throw Error('oldBlock is not rendered.');\n    }\n\n    // Clone the block.\n    const json = (blocks.save(oldBlock) as blocks.State);\n    // Normallly this resizes leading to weird jumps. Save it for terminateDrag.\n    targetWorkspace.setResizesEnabled(false);\n    const block = (blocks.append(json, targetWorkspace) as BlockSvg);\n\n    this.positionNewBlock_(oldBlock, block);\n\n    return block;\n  }\n\n  /**\n   * Positions a block on the target workspace.\n   *\n   * @param oldBlock The flyout block being copied.\n   * @param block The block to posiiton.\n   */\n  private positionNewBlock_(oldBlock: BlockSvg, block: BlockSvg) {\n    const targetWorkspace = this.targetWorkspace;\n\n    // The offset in pixels between the main workspace's origin and the upper\n    // left corner of the injection div.\n    const mainOffsetPixels = targetWorkspace.getOriginOffsetInPixels();\n\n    // The offset in pixels between the flyout workspace's origin and the upper\n    // left corner of the injection div.\n    const flyoutOffsetPixels = this.workspace_.getOriginOffsetInPixels();\n\n    // The position of the old block in flyout workspace coordinates.\n    const oldBlockPos = oldBlock.getRelativeToSurfaceXY();\n    // The position of the old block in pixels relative to the flyout\n    // workspace's origin.\n    oldBlockPos.scale(this.workspace_.scale);\n\n    // The position of the old block in pixels relative to the upper left corner\n    // of the injection div.\n    const oldBlockOffsetPixels =\n        Coordinate.sum(flyoutOffsetPixels, oldBlockPos);\n\n    // The position of the old block in pixels relative to the origin of the\n    // main workspace.\n    const finalOffset =\n        Coordinate.difference(oldBlockOffsetPixels, mainOffsetPixels);\n    // The position of the old block in main workspace coordinates.\n    finalOffset.scale(1 / targetWorkspace.scale);\n\n    block.moveTo(new Coordinate(finalOffset.x, finalOffset.y));\n  }\n}\n\n/**\n * A flyout content item.\n */\nexport interface FlyoutItem {\n  type: FlyoutItemType;\n  button?: FlyoutButton|undefined;\n  block?: BlockSvg|undefined;\n}\n","/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Calculates and reports flyout workspace metrics.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.FlyoutMetricsManager');\n\nimport type {IFlyout} from './interfaces/i_flyout.js';\nimport {ContainerRegion, MetricsManager} from './metrics_manager.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/**\n * Calculates metrics for a flyout's workspace.\n * The metrics are mainly used to size scrollbars for the flyout.\n *\n * @alias Blockly.FlyoutMetricsManager\n */\nexport class FlyoutMetricsManager extends MetricsManager {\n  /** The flyout that owns the workspace to calculate metrics for. */\n  protected flyout_: IFlyout;\n\n  /**\n   * @param workspace The flyout's workspace.\n   * @param flyout The flyout.\n   */\n  constructor(workspace: WorkspaceSvg, flyout: IFlyout) {\n    super(workspace);\n    this.flyout_ = flyout;\n  }\n\n  /**\n   * Gets the bounding box of the blocks on the flyout's workspace.\n   * This is in workspace coordinates.\n   *\n   * @returns The bounding box of the blocks on the workspace.\n   */\n  private getBoundingBox_(): SVGRect|\n      {height: number, y: number, width: number, x: number} {\n    let blockBoundingBox;\n    try {\n      blockBoundingBox = this.workspace_.getCanvas().getBBox();\n    } catch (e) {\n      // Firefox has trouble with hidden elements (Bug 528969).\n      // 2021 Update: It looks like this was fixed around Firefox 77 released in\n      // 2020.\n      blockBoundingBox = {height: 0, y: 0, width: 0, x: 0};\n    }\n    return blockBoundingBox;\n  }\n\n  override getContentMetrics(opt_getWorkspaceCoordinates?: boolean) {\n    // The bounding box is in workspace coordinates.\n    const blockBoundingBox = this.getBoundingBox_();\n    const scale = opt_getWorkspaceCoordinates ? 1 : this.workspace_.scale;\n\n    return {\n      height: blockBoundingBox.height * scale,\n      width: blockBoundingBox.width * scale,\n      top: blockBoundingBox.y * scale,\n      left: blockBoundingBox.x * scale,\n    };\n  }\n\n  override getScrollMetrics(\n      opt_getWorkspaceCoordinates?: boolean, opt_viewMetrics?: ContainerRegion,\n      opt_contentMetrics?: ContainerRegion) {\n    const contentMetrics = opt_contentMetrics || this.getContentMetrics();\n    const margin = this.flyout_.MARGIN * this.workspace_.scale;\n    const scale = opt_getWorkspaceCoordinates ? this.workspace_.scale : 1;\n\n    // The left padding isn't just the margin. Some blocks are also offset by\n    // tabWidth so that value and statement blocks line up.\n    // The contentMetrics.left value is equivalent to the variable left padding.\n    const leftPadding = contentMetrics.left;\n\n    return {\n      height: (contentMetrics.height + 2 * margin) / scale,\n      width: (contentMetrics.width + leftPadding + margin) / scale,\n      top: 0,\n      left: 0,\n    };\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Layout code for a vertical variant of the flyout.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.VerticalFlyout');\n\nimport * as browserEvents from './browser_events.js';\nimport * as dropDownDiv from './dropdowndiv.js';\nimport {Flyout, FlyoutItem} from './flyout_base.js';\nimport type {FlyoutButton} from './flyout_button.js';\nimport type {Options} from './options.js';\nimport * as registry from './registry.js';\nimport {Scrollbar} from './scrollbar.js';\nimport type {Coordinate} from './utils/coordinate.js';\nimport {Rect} from './utils/rect.js';\nimport * as toolbox from './utils/toolbox.js';\nimport * as WidgetDiv from './widgetdiv.js';\n\n\n/**\n * Class for a flyout.\n *\n * @alias Blockly.VerticalFlyout\n */\nexport class VerticalFlyout extends Flyout {\n  /** The name of the vertical flyout in the registry. */\n  static registryName = 'verticalFlyout';\n\n  /** @param workspaceOptions Dictionary of options for the workspace. */\n  constructor(workspaceOptions: Options) {\n    super(workspaceOptions);\n  }\n\n  /**\n   * Sets the translation of the flyout to match the scrollbars.\n   *\n   * @param xyRatio Contains a y property which is a float between 0 and 1\n   *     specifying the degree of scrolling and a similar x property.\n   */\n  protected override setMetrics_(xyRatio: {x: number, y: number}) {\n    if (!this.isVisible()) {\n      return;\n    }\n    const metricsManager = this.workspace_.getMetricsManager();\n    const scrollMetrics = metricsManager.getScrollMetrics();\n    const viewMetrics = metricsManager.getViewMetrics();\n    const absoluteMetrics = metricsManager.getAbsoluteMetrics();\n\n    if (typeof xyRatio.y === 'number') {\n      this.workspace_.scrollY =\n          -(scrollMetrics.top +\n            (scrollMetrics.height - viewMetrics.height) * xyRatio.y);\n    }\n    this.workspace_.translate(\n        this.workspace_.scrollX + absoluteMetrics.left,\n        this.workspace_.scrollY + absoluteMetrics.top);\n  }\n\n  /**\n   * Calculates the x coordinate for the flyout position.\n   *\n   * @returns X coordinate.\n   */\n  override getX(): number {\n    if (!this.isVisible()) {\n      return 0;\n    }\n    const metricsManager = this.targetWorkspace!.getMetricsManager();\n    const absoluteMetrics = metricsManager.getAbsoluteMetrics();\n    const viewMetrics = metricsManager.getViewMetrics();\n    const toolboxMetrics = metricsManager.getToolboxMetrics();\n    let x = 0;\n\n    // If this flyout is not the trashcan flyout (e.g. toolbox or mutator).\n    // Trashcan flyout is opposite the main flyout.\n    if (this.targetWorkspace!.toolboxPosition === this.toolboxPosition_) {\n      // If there is a category toolbox.\n      // Simple (flyout-only) toolbox.\n      if (this.targetWorkspace!.getToolbox()) {\n        if (this.toolboxPosition_ === toolbox.Position.LEFT) {\n          x = toolboxMetrics.width;\n        } else {\n          x = viewMetrics.width - this.width_;\n        }\n      } else {\n        if (this.toolboxPosition_ === toolbox.Position.LEFT) {\n          x = 0;\n        } else {\n          // The simple flyout does not cover the workspace.\n          x = viewMetrics.width;\n        }\n      }\n    } else {\n      if (this.toolboxPosition_ === toolbox.Position.LEFT) {\n        x = 0;\n      } else {\n        // Because the anchor point of the flyout is on the left, but we want\n        // to align the right edge of the flyout with the right edge of the\n        // blocklyDiv, we calculate the full width of the div minus the width\n        // of the flyout.\n        x = viewMetrics.width + absoluteMetrics.left - this.width_;\n      }\n    }\n\n    return x;\n  }\n\n  /**\n   * Calculates the y coordinate for the flyout position.\n   *\n   * @returns Y coordinate.\n   */\n  override getY(): number {\n    // Y is always 0 since this is a vertical flyout.\n    return 0;\n  }\n\n  /** Move the flyout to the edge of the workspace. */\n  override position() {\n    if (!this.isVisible() || !this.targetWorkspace!.isVisible()) {\n      return;\n    }\n    const metricsManager = this.targetWorkspace!.getMetricsManager();\n    const targetWorkspaceViewMetrics = metricsManager.getViewMetrics();\n    this.height_ = targetWorkspaceViewMetrics.height;\n\n    const edgeWidth = this.width_ - this.CORNER_RADIUS;\n    const edgeHeight =\n        targetWorkspaceViewMetrics.height - 2 * this.CORNER_RADIUS;\n    this.setBackgroundPath_(edgeWidth, edgeHeight);\n\n    const x = this.getX();\n    const y = this.getY();\n\n    this.positionAt_(this.width_, this.height_, x, y);\n  }\n\n  /**\n   * Create and set the path for the visible boundaries of the flyout.\n   *\n   * @param width The width of the flyout, not including the rounded corners.\n   * @param height The height of the flyout, not including rounded corners.\n   */\n  private setBackgroundPath_(width: number, height: number) {\n    const atRight = this.toolboxPosition_ === toolbox.Position.RIGHT;\n    const totalWidth = width + this.CORNER_RADIUS;\n\n    // Decide whether to start on the left or right.\n    const path: Array<string|number> =\n        ['M ' + (atRight ? totalWidth : 0) + ',0'];\n    // Top.\n    path.push('h', (atRight ? -width : width));\n    // Rounded corner.\n    path.push(\n        'a', this.CORNER_RADIUS, this.CORNER_RADIUS, 0, 0, atRight ? 0 : 1,\n        atRight ? -this.CORNER_RADIUS : this.CORNER_RADIUS, this.CORNER_RADIUS);\n    // Side closest to workspace.\n    path.push('v', Math.max(0, height));\n    // Rounded corner.\n    path.push(\n        'a', this.CORNER_RADIUS, this.CORNER_RADIUS, 0, 0, atRight ? 0 : 1,\n        atRight ? this.CORNER_RADIUS : -this.CORNER_RADIUS, this.CORNER_RADIUS);\n    // Bottom.\n    path.push('h', (atRight ? width : -width));\n    path.push('z');\n    this.svgBackground_!.setAttribute('d', path.join(' '));\n  }\n\n  /** Scroll the flyout to the top. */\n  override scrollToStart() {\n    this.workspace_.scrollbar?.setY(0);\n  }\n\n  /**\n   * Scroll the flyout.\n   *\n   * @param e Mouse wheel scroll event.\n   */\n  protected override wheel_(e: WheelEvent) {\n    const scrollDelta = browserEvents.getScrollDeltaPixels(e);\n\n    if (scrollDelta.y) {\n      const metricsManager = this.workspace_.getMetricsManager();\n      const scrollMetrics = metricsManager.getScrollMetrics();\n      const viewMetrics = metricsManager.getViewMetrics();\n      const pos = viewMetrics.top - scrollMetrics.top + scrollDelta.y;\n\n      this.workspace_.scrollbar?.setY(pos);\n      // When the flyout moves from a wheel event, hide WidgetDiv and\n      // dropDownDiv.\n      WidgetDiv.hide();\n      dropDownDiv.hideWithoutAnimation();\n    }\n    // Don't scroll the page.\n    e.preventDefault();\n    // Don't propagate mousewheel event (zooming).\n    e.stopPropagation();\n  }\n\n  /**\n   * Lay out the blocks in the flyout.\n   *\n   * @param contents The blocks and buttons to lay out.\n   * @param gaps The visible gaps between blocks.\n   */\n  protected override layout_(contents: FlyoutItem[], gaps: number[]) {\n    this.workspace_.scale = this.targetWorkspace!.scale;\n    const margin = this.MARGIN;\n    const cursorX = this.RTL ? margin : margin + this.tabWidth_;\n    let cursorY = margin;\n\n    for (let i = 0, item; item = contents[i]; i++) {\n      if (item.type === 'block') {\n        const block = item.block;\n        const allBlocks = block!.getDescendants(false);\n        for (let j = 0, child; child = allBlocks[j]; j++) {\n          // Mark blocks as being inside a flyout.  This is used to detect and\n          // prevent the closure of the flyout if the user right-clicks on such\n          // a block.\n          child.isInFlyout = true;\n        }\n        block!.render();\n        const root = block!.getSvgRoot();\n        const blockHW = block!.getHeightWidth();\n        const moveX =\n            block!.outputConnection ? cursorX - this.tabWidth_ : cursorX;\n        block!.moveBy(moveX, cursorY);\n\n        const rect = this.createRect_(\n            block!, this.RTL ? moveX - blockHW.width : moveX, cursorY, blockHW,\n            i);\n\n        this.addBlockListeners_(root, block!, rect);\n\n        cursorY += blockHW.height + gaps[i];\n      } else if (item.type === 'button') {\n        const button = item.button as FlyoutButton;\n        this.initFlyoutButton_(button, cursorX, cursorY);\n        cursorY += button.height + gaps[i];\n      }\n    }\n  }\n\n  /**\n   * Determine if a drag delta is toward the workspace, based on the position\n   * and orientation of the flyout. This is used in determineDragIntention_ to\n   * determine if a new block should be created or if the flyout should scroll.\n   *\n   * @param currentDragDeltaXY How far the pointer has moved from the position\n   *     at mouse down, in pixel units.\n   * @returns True if the drag is toward the workspace.\n   * @internal\n   */\n  override isDragTowardWorkspace(currentDragDeltaXY: Coordinate): boolean {\n    const dx = currentDragDeltaXY.x;\n    const dy = currentDragDeltaXY.y;\n    // Direction goes from -180 to 180, with 0 toward the right and 90 on top.\n    const dragDirection = Math.atan2(dy, dx) / Math.PI * 180;\n\n    const range = this.dragAngleRange_;\n    // Check for left or right dragging.\n    if (dragDirection < range && dragDirection > -range ||\n        (dragDirection < -180 + range || dragDirection > 180 - range)) {\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Returns the bounding rectangle of the drag target area in pixel units\n   * relative to viewport.\n   *\n   * @returns The component's bounding box. Null if drag target area should be\n   *     ignored.\n   */\n  override getClientRect(): Rect|null {\n    if (!this.svgGroup_ || this.autoClose || !this.isVisible()) {\n      // The bounding rectangle won't compute correctly if the flyout is closed\n      // and auto-close flyouts aren't valid drag targets (or delete areas).\n      return null;\n    }\n\n    const flyoutRect = this.svgGroup_.getBoundingClientRect();\n    // BIG_NUM is offscreen padding so that blocks dragged beyond the shown\n    // flyout area are still deleted.  Must be larger than the largest screen\n    // size, but be smaller than half Number.MAX_SAFE_INTEGER (not available on\n    // IE).\n    const BIG_NUM = 1000000000;\n    const left = flyoutRect.left;\n\n    if (this.toolboxPosition_ === toolbox.Position.LEFT) {\n      const width = flyoutRect.width;\n      return new Rect(-BIG_NUM, BIG_NUM, -BIG_NUM, left + width);\n    } else {  // Right\n      return new Rect(-BIG_NUM, BIG_NUM, left, BIG_NUM);\n    }\n  }\n\n  /**\n   * Compute width of flyout.  toolbox.Position mat under each block.\n   * For RTL: Lay out the blocks and buttons to be right-aligned.\n   */\n  protected override reflowInternal_() {\n    this.workspace_.scale = this.getFlyoutScale();\n    let flyoutWidth = 0;\n    const blocks = this.workspace_.getTopBlocks(false);\n    for (let i = 0, block; block = blocks[i]; i++) {\n      let width = block.getHeightWidth().width;\n      if (block.outputConnection) {\n        width -= this.tabWidth_;\n      }\n      flyoutWidth = Math.max(flyoutWidth, width);\n    }\n    for (let i = 0, button; button = this.buttons_[i]; i++) {\n      flyoutWidth = Math.max(flyoutWidth, button.width);\n    }\n    flyoutWidth += this.MARGIN * 1.5 + this.tabWidth_;\n    flyoutWidth *= this.workspace_.scale;\n    flyoutWidth += Scrollbar.scrollbarThickness;\n\n    if (this.width_ !== flyoutWidth) {\n      for (let i = 0, block; block = blocks[i]; i++) {\n        if (this.RTL) {\n          // With the flyoutWidth known, right-align the blocks.\n          const oldX = block.getRelativeToSurfaceXY().x;\n          let newX = flyoutWidth / this.workspace_.scale - this.MARGIN;\n          if (!block.outputConnection) {\n            newX -= this.tabWidth_;\n          }\n          block.moveBy(newX - oldX, 0);\n        }\n        if (this.rectMap_.has(block)) {\n          this.moveRectToBlock_(this.rectMap_.get(block)!, block);\n        }\n      }\n      if (this.RTL) {\n        // With the flyoutWidth known, right-align the buttons.\n        for (let i = 0, button; button = this.buttons_[i]; i++) {\n          const y = button.getPosition().y;\n          const x = flyoutWidth / this.workspace_.scale - button.width -\n              this.MARGIN - this.tabWidth_;\n          button.moveTo(x, y);\n        }\n      }\n\n      if (this.targetWorkspace!.toolboxPosition === this.toolboxPosition_ &&\n          this.toolboxPosition_ === toolbox.Position.LEFT &&\n          !this.targetWorkspace!.getToolbox()) {\n        // This flyout is a simple toolbox. Reposition the workspace so that\n        // (0,0) is in the correct position relative to the new absolute edge\n        // (ie toolbox edge).\n        this.targetWorkspace!.translate(\n            this.targetWorkspace!.scrollX + flyoutWidth,\n            this.targetWorkspace!.scrollY);\n      }\n      this.width_ = flyoutWidth;\n      this.position();\n      this.targetWorkspace!.recordDragTargets();\n    }\n  }\n}\n\nregistry.register(\n    registry.Type.FLYOUTS_VERTICAL_TOOLBOX, registry.DEFAULT, VerticalFlyout);\n","/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Horizontal flyout tray containing blocks which may be created.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.HorizontalFlyout');\n\nimport * as browserEvents from './browser_events.js';\nimport * as dropDownDiv from './dropdowndiv.js';\nimport {Flyout, FlyoutItem} from './flyout_base.js';\nimport type {FlyoutButton} from './flyout_button.js';\nimport type {Options} from './options.js';\nimport * as registry from './registry.js';\nimport {Scrollbar} from './scrollbar.js';\nimport type {Coordinate} from './utils/coordinate.js';\nimport {Rect} from './utils/rect.js';\nimport * as toolbox from './utils/toolbox.js';\nimport * as WidgetDiv from './widgetdiv.js';\n\n\n/**\n * Class for a flyout.\n *\n * @alias Blockly.HorizontalFlyout\n */\nexport class HorizontalFlyout extends Flyout {\n  override horizontalLayout = true;\n\n  /** @param workspaceOptions Dictionary of options for the workspace. */\n  constructor(workspaceOptions: Options) {\n    super(workspaceOptions);\n  }\n\n  /**\n   * Sets the translation of the flyout to match the scrollbars.\n   *\n   * @param xyRatio Contains a y property which is a float between 0 and 1\n   *     specifying the degree of scrolling and a similar x property.\n   */\n  protected override setMetrics_(xyRatio: {x: number, y: number}) {\n    if (!this.isVisible()) {\n      return;\n    }\n\n    const metricsManager = this.workspace_.getMetricsManager();\n    const scrollMetrics = metricsManager.getScrollMetrics();\n    const viewMetrics = metricsManager.getViewMetrics();\n    const absoluteMetrics = metricsManager.getAbsoluteMetrics();\n\n    if (typeof xyRatio.x === 'number') {\n      this.workspace_.scrollX =\n          -(scrollMetrics.left +\n            (scrollMetrics.width - viewMetrics.width) * xyRatio.x);\n    }\n\n    this.workspace_.translate(\n        this.workspace_.scrollX + absoluteMetrics.left,\n        this.workspace_.scrollY + absoluteMetrics.top);\n  }\n\n  /**\n   * Calculates the x coordinate for the flyout position.\n   *\n   * @returns X coordinate.\n   */\n  override getX(): number {\n    // X is always 0 since this is a horizontal flyout.\n    return 0;\n  }\n\n  /**\n   * Calculates the y coordinate for the flyout position.\n   *\n   * @returns Y coordinate.\n   */\n  override getY(): number {\n    if (!this.isVisible()) {\n      return 0;\n    }\n    const metricsManager = this.targetWorkspace!.getMetricsManager();\n    const absoluteMetrics = metricsManager.getAbsoluteMetrics();\n    const viewMetrics = metricsManager.getViewMetrics();\n    const toolboxMetrics = metricsManager.getToolboxMetrics();\n\n    let y = 0;\n    const atTop = this.toolboxPosition_ === toolbox.Position.TOP;\n    // If this flyout is not the trashcan flyout (e.g. toolbox or mutator).\n    // Trashcan flyout is opposite the main flyout.\n    if (this.targetWorkspace!.toolboxPosition === this.toolboxPosition_) {\n      // If there is a category toolbox.\n      // Simple (flyout-only) toolbox.\n      if (this.targetWorkspace!.getToolbox()) {\n        if (atTop) {\n          y = toolboxMetrics.height;\n        } else {\n          y = viewMetrics.height - this.height_;\n        }\n      } else {\n        if (atTop) {\n          y = 0;\n        } else {\n          // The simple flyout does not cover the workspace.\n          y = viewMetrics.height;\n        }\n      }\n    } else {\n      if (atTop) {\n        y = 0;\n      } else {\n        // Because the anchor point of the flyout is on the top, but we want\n        // to align the bottom edge of the flyout with the bottom edge of the\n        // blocklyDiv, we calculate the full height of the div minus the height\n        // of the flyout.\n        y = viewMetrics.height + absoluteMetrics.top - this.height_;\n      }\n    }\n\n    return y;\n  }\n\n  /** Move the flyout to the edge of the workspace. */\n  override position() {\n    if (!this.isVisible() || !this.targetWorkspace!.isVisible()) {\n      return;\n    }\n    const metricsManager = this.targetWorkspace!.getMetricsManager();\n    const targetWorkspaceViewMetrics = metricsManager.getViewMetrics();\n    this.width_ = targetWorkspaceViewMetrics.width;\n\n    const edgeWidth = targetWorkspaceViewMetrics.width - 2 * this.CORNER_RADIUS;\n    const edgeHeight = this.height_ - this.CORNER_RADIUS;\n    this.setBackgroundPath_(edgeWidth, edgeHeight);\n\n    const x = this.getX();\n    const y = this.getY();\n\n    this.positionAt_(this.width_, this.height_, x, y);\n  }\n\n  /**\n   * Create and set the path for the visible boundaries of the flyout.\n   *\n   * @param width The width of the flyout, not including the rounded corners.\n   * @param height The height of the flyout, not including rounded corners.\n   */\n  private setBackgroundPath_(width: number, height: number) {\n    const atTop = this.toolboxPosition_ === toolbox.Position.TOP;\n    // Start at top left.\n    const path: (string|number)[] = ['M 0,' + (atTop ? 0 : this.CORNER_RADIUS)];\n\n    if (atTop) {\n      // Top.\n      path.push('h', width + 2 * this.CORNER_RADIUS);\n      // Right.\n      path.push('v', height);\n      // Bottom.\n      path.push(\n          'a', this.CORNER_RADIUS, this.CORNER_RADIUS, 0, 0, 1,\n          -this.CORNER_RADIUS, this.CORNER_RADIUS);\n      path.push('h', -width);\n      // Left.\n      path.push(\n          'a', this.CORNER_RADIUS, this.CORNER_RADIUS, 0, 0, 1,\n          -this.CORNER_RADIUS, -this.CORNER_RADIUS);\n      path.push('z');\n    } else {\n      // Top.\n      path.push(\n          'a', this.CORNER_RADIUS, this.CORNER_RADIUS, 0, 0, 1,\n          this.CORNER_RADIUS, -this.CORNER_RADIUS);\n      path.push('h', width);\n      // Right.\n      path.push(\n          'a', this.CORNER_RADIUS, this.CORNER_RADIUS, 0, 0, 1,\n          this.CORNER_RADIUS, this.CORNER_RADIUS);\n      path.push('v', height);\n      // Bottom.\n      path.push('h', -width - 2 * this.CORNER_RADIUS);\n      // Left.\n      path.push('z');\n    }\n    this.svgBackground_!.setAttribute('d', path.join(' '));\n  }\n\n  /** Scroll the flyout to the top. */\n  override scrollToStart() {\n    this.workspace_.scrollbar?.setX(this.RTL ? Infinity : 0);\n  }\n\n  /**\n   * Scroll the flyout.\n   *\n   * @param e Mouse wheel scroll event.\n   */\n  protected override wheel_(e: WheelEvent) {\n    const scrollDelta = browserEvents.getScrollDeltaPixels(e);\n    const delta = scrollDelta.x || scrollDelta.y;\n\n    if (delta) {\n      const metricsManager = this.workspace_.getMetricsManager();\n      const scrollMetrics = metricsManager.getScrollMetrics();\n      const viewMetrics = metricsManager.getViewMetrics();\n\n      const pos = viewMetrics.left - scrollMetrics.left + delta;\n      this.workspace_.scrollbar?.setX(pos);\n      // When the flyout moves from a wheel event, hide WidgetDiv and\n      // dropDownDiv.\n      WidgetDiv.hide();\n      dropDownDiv.hideWithoutAnimation();\n    }\n    // Don't scroll the page.\n    e.preventDefault();\n    // Don't propagate mousewheel event (zooming).\n    e.stopPropagation();\n  }\n\n  /**\n   * Lay out the blocks in the flyout.\n   *\n   * @param contents The blocks and buttons to lay out.\n   * @param gaps The visible gaps between blocks.\n   */\n  protected override layout_(contents: FlyoutItem[], gaps: number[]) {\n    this.workspace_.scale = this.targetWorkspace!.scale;\n    const margin = this.MARGIN;\n    let cursorX = margin + this.tabWidth_;\n    const cursorY = margin;\n    if (this.RTL) {\n      contents = contents.reverse();\n    }\n\n    for (let i = 0, item; item = contents[i]; i++) {\n      if (item.type === 'block') {\n        const block = item.block;\n        const allBlocks = block!.getDescendants(false);\n        for (let j = 0, child; child = allBlocks[j]; j++) {\n          // Mark blocks as being inside a flyout.  This is used to detect and\n          // prevent the closure of the flyout if the user right-clicks on such\n          // a block.\n          child.isInFlyout = true;\n        }\n        block!.render();\n        const root = block!.getSvgRoot();\n        const blockHW = block!.getHeightWidth();\n        // Figure out where to place the block.\n        const tab = block!.outputConnection ? this.tabWidth_ : 0;\n        let moveX;\n        if (this.RTL) {\n          moveX = cursorX + blockHW.width;\n        } else {\n          moveX = cursorX - tab;\n        }\n        block!.moveBy(moveX, cursorY);\n\n        const rect = this.createRect_(block!, moveX, cursorY, blockHW, i);\n        cursorX += blockHW.width + gaps[i];\n\n        this.addBlockListeners_(root, block!, rect);\n      } else if (item.type === 'button') {\n        const button = item.button as FlyoutButton;\n        this.initFlyoutButton_(button, cursorX, cursorY);\n        cursorX += button.width + gaps[i];\n      }\n    }\n  }\n\n  /**\n   * Determine if a drag delta is toward the workspace, based on the position\n   * and orientation of the flyout. This is used in determineDragIntention_ to\n   * determine if a new block should be created or if the flyout should scroll.\n   *\n   * @param currentDragDeltaXY How far the pointer has moved from the position\n   *     at mouse down, in pixel units.\n   * @returns True if the drag is toward the workspace.\n   * @internal\n   */\n  override isDragTowardWorkspace(currentDragDeltaXY: Coordinate): boolean {\n    const dx = currentDragDeltaXY.x;\n    const dy = currentDragDeltaXY.y;\n    // Direction goes from -180 to 180, with 0 toward the right and 90 on top.\n    const dragDirection = Math.atan2(dy, dx) / Math.PI * 180;\n\n    const range = this.dragAngleRange_;\n    // Check for up or down dragging.\n    if (dragDirection < 90 + range && dragDirection > 90 - range ||\n        dragDirection > -90 - range && dragDirection < -90 + range) {\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Returns the bounding rectangle of the drag target area in pixel units\n   * relative to viewport.\n   *\n   * @returns The component's bounding box. Null if drag target area should be\n   *     ignored.\n   */\n  override getClientRect(): Rect|null {\n    if (!this.svgGroup_ || this.autoClose || !this.isVisible()) {\n      // The bounding rectangle won't compute correctly if the flyout is closed\n      // and auto-close flyouts aren't valid drag targets (or delete areas).\n      return null;\n    }\n\n    const flyoutRect = this.svgGroup_.getBoundingClientRect();\n    // BIG_NUM is offscreen padding so that blocks dragged beyond the shown\n    // flyout area are still deleted.  Must be larger than the largest screen\n    // size, but be smaller than half Number.MAX_SAFE_INTEGER (not available on\n    // IE).\n    const BIG_NUM = 1000000000;\n    const top = flyoutRect.top;\n\n    if (this.toolboxPosition_ === toolbox.Position.TOP) {\n      const height = flyoutRect.height;\n      return new Rect(-BIG_NUM, top + height, -BIG_NUM, BIG_NUM);\n    } else {  // Bottom.\n      return new Rect(top, BIG_NUM, -BIG_NUM, BIG_NUM);\n    }\n  }\n\n  /**\n   * Compute height of flyout.  toolbox.Position mat under each block.\n   * For RTL: Lay out the blocks right-aligned.\n   */\n  protected override reflowInternal_() {\n    this.workspace_.scale = this.getFlyoutScale();\n    let flyoutHeight = 0;\n    const blocks = this.workspace_.getTopBlocks(false);\n    for (let i = 0, block; block = blocks[i]; i++) {\n      flyoutHeight = Math.max(flyoutHeight, block.getHeightWidth().height);\n    }\n    const buttons = this.buttons_;\n    for (let i = 0, button; button = buttons[i]; i++) {\n      flyoutHeight = Math.max(flyoutHeight, button.height);\n    }\n    flyoutHeight += this.MARGIN * 1.5;\n    flyoutHeight *= this.workspace_.scale;\n    flyoutHeight += Scrollbar.scrollbarThickness;\n\n    if (this.height_ !== flyoutHeight) {\n      for (let i = 0, block; block = blocks[i]; i++) {\n        if (this.rectMap_.has(block)) {\n          this.moveRectToBlock_(this.rectMap_.get(block)!, block);\n        }\n      }\n\n      if (this.targetWorkspace!.toolboxPosition === this.toolboxPosition_ &&\n          this.toolboxPosition_ === toolbox.Position.TOP &&\n          !this.targetWorkspace!.getToolbox()) {\n        // This flyout is a simple toolbox. Reposition the workspace so that\n        // (0,0) is in the correct position relative to the new absolute edge\n        // (ie toolbox edge).\n        this.targetWorkspace!.translate(\n            this.targetWorkspace!.scrollX,\n            this.targetWorkspace!.scrollY + flyoutHeight);\n      }\n      this.height_ = flyoutHeight;\n      this.position();\n      this.targetWorkspace!.recordDragTargets();\n    }\n  }\n}\n\nregistry.register(\n    registry.Type.FLYOUTS_HORIZONTAL_TOOLBOX, registry.DEFAULT,\n    HorizontalFlyout);\n","/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Variable input field.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.FieldVariable');\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_change.js';\n\nimport type {Block} from './block.js';\nimport {Field, FieldConfig, UnattachedFieldError} from './field.js';\nimport {FieldDropdown, FieldDropdownValidator, MenuGenerator, MenuOption} from './field_dropdown.js';\nimport * as fieldRegistry from './field_registry.js';\nimport * as internalConstants from './internal_constants.js';\nimport type {Menu} from './menu.js';\nimport type {MenuItem} from './menuitem.js';\nimport {Msg} from './msg.js';\nimport * as parsing from './utils/parsing.js';\nimport type {Sentinel} from './utils/sentinel.js';\nimport {Size} from './utils/size.js';\nimport {VariableModel} from './variable_model.js';\nimport * as Variables from './variables.js';\nimport * as Xml from './xml.js';\n\nexport type FieldVariableValidator = FieldDropdownValidator;\n\n/**\n * Class for a variable's dropdown field.\n *\n * @alias Blockly.FieldVariable\n */\nexport class FieldVariable extends FieldDropdown {\n  protected override menuGenerator_: MenuGenerator|undefined;\n  defaultVariableName: string;\n\n  /** The type of the default variable for this field. */\n  private defaultType_ = '';\n\n  /**\n   * All of the types of variables that will be available in this field's\n   * dropdown.\n   */\n  variableTypes: string[]|null = [];\n  protected override size_: Size;\n\n  /** The variable model associated with this field. */\n  private variable_: VariableModel|null = null;\n\n  /**\n   * Serializable fields are saved by the serializer, non-serializable fields\n   * are not. Editable fields should also be serializable.\n   */\n  override SERIALIZABLE = true;\n\n  /**\n   * @param varName The default name for the variable.\n   *     If null, a unique variable name will be generated.\n   *     Also accepts Field.SKIP_SETUP if you wish to skip setup (only used by\n   * subclasses that want to handle configuration and setting the field value\n   * after their own constructors have run).\n   * @param opt_validator A function that is called to validate changes to the\n   *     field's value. Takes in a variable ID  & returns a validated variable\n   *     ID, or null to abort the change.\n   * @param opt_variableTypes A list of the types of variables to include in the\n   *     dropdown. Will only be used if opt_config is not provided.\n   * @param opt_defaultType The type of variable to create if this field's value\n   *     is not explicitly set.  Defaults to ''. Will only be used if opt_config\n   *     is not provided.\n   * @param opt_config A map of options used to configure the field.\n   *    See the [field creation documentation]{@link\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/variable#creation}\n   * for a list of properties this parameter supports.\n   */\n  constructor(\n      varName: string|null|Sentinel, opt_validator?: FieldVariableValidator,\n      opt_variableTypes?: string[], opt_defaultType?: string,\n      opt_config?: FieldVariableConfig) {\n    super(Field.SKIP_SETUP);\n\n    /**\n     * An array of options for a dropdown list,\n     * or a function which generates these options.\n     */\n    this.menuGenerator_ = FieldVariable.dropdownCreate as MenuGenerator;\n\n    /**\n     * The initial variable name passed to this field's constructor, or an\n     * empty string if a name wasn't provided. Used to create the initial\n     * variable.\n     */\n    this.defaultVariableName = typeof varName === 'string' ? varName : '';\n\n    /** The size of the area rendered by the field. */\n    this.size_ = new Size(0, 0);\n\n    if (varName === Field.SKIP_SETUP) {\n      return;\n    }\n\n    if (opt_config) {\n      this.configure_(opt_config);\n    } else {\n      this.setTypes_(opt_variableTypes, opt_defaultType);\n    }\n    if (opt_validator) {\n      this.setValidator(opt_validator);\n    }\n  }\n\n  /**\n   * Configure the field based on the given map of options.\n   *\n   * @param config A map of options to configure the field based on.\n   */\n  protected override configure_(config: FieldVariableConfig) {\n    super.configure_(config);\n    this.setTypes_(config.variableTypes, config.defaultType);\n  }\n\n  /**\n   * Initialize the model for this field if it has not already been initialized.\n   * If the value has not been set to a variable by the first render, we make up\n   * a variable rather than let the value be invalid.\n   *\n   * @internal\n   */\n  override initModel() {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    if (this.variable_) {\n      return;  // Initialization already happened.\n    }\n    const variable = Variables.getOrCreateVariablePackage(\n        block.workspace, null, this.defaultVariableName, this.defaultType_);\n    // Don't call setValue because we don't want to cause a rerender.\n    this.doValueUpdate_(variable.getId());\n  }\n\n  override shouldAddBorderRect_() {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    return super.shouldAddBorderRect_() &&\n        (!this.getConstants()!.FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW ||\n         block.type !== 'variables_get');\n  }\n\n  /**\n   * Initialize this field based on the given XML.\n   *\n   * @param fieldElement The element containing information about the variable\n   *     field's state.\n   */\n  override fromXml(fieldElement: Element) {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    const id = fieldElement.getAttribute('id');\n    const variableName = fieldElement.textContent;\n    // 'variabletype' should be lowercase, but until July 2019 it was sometimes\n    // recorded as 'variableType'.  Thus we need to check for both.\n    const variableType = fieldElement.getAttribute('variabletype') ||\n        fieldElement.getAttribute('variableType') || '';\n\n    // AnyDuringMigration because:  Argument of type 'string | null' is not\n    // assignable to parameter of type 'string | undefined'.\n    const variable = Variables.getOrCreateVariablePackage(\n        block.workspace, id, variableName as AnyDuringMigration, variableType);\n\n    // This should never happen :)\n    if (variableType !== null && variableType !== variable.type) {\n      throw Error(\n          'Serialized variable type with id \\'' + variable.getId() +\n          '\\' had type ' + variable.type + ', and ' +\n          'does not match variable field that references it: ' +\n          Xml.domToText(fieldElement) + '.');\n    }\n\n    this.setValue(variable.getId());\n  }\n\n  /**\n   * Serialize this field to XML.\n   *\n   * @param fieldElement The element to populate with info about the field's\n   *     state.\n   * @returns The element containing info about the field's state.\n   */\n  override toXml(fieldElement: Element): Element {\n    // Make sure the variable is initialized.\n    this.initModel();\n\n    fieldElement.id = this.variable_!.getId();\n    fieldElement.textContent = this.variable_!.name;\n    if (this.variable_!.type) {\n      fieldElement.setAttribute('variabletype', this.variable_!.type);\n    }\n    return fieldElement;\n  }\n\n  /**\n   * Saves this field's value.\n   *\n   * @param doFullSerialization If true, the variable field will serialize the\n   *     full state of the field being referenced (ie ID, name, and type) rather\n   *     than just a reference to it (ie ID).\n   * @returns The state of the variable field.\n   * @internal\n   */\n  override saveState(doFullSerialization?: boolean): AnyDuringMigration {\n    const legacyState = this.saveLegacyState(FieldVariable);\n    if (legacyState !== null) {\n      return legacyState;\n    }\n    // Make sure the variable is initialized.\n    this.initModel();\n    const state = {'id': this.variable_!.getId()};\n    if (doFullSerialization) {\n      (state as AnyDuringMigration)['name'] = this.variable_!.name;\n      (state as AnyDuringMigration)['type'] = this.variable_!.type;\n    }\n    return state;\n  }\n\n  /**\n   * Sets the field's value based on the given state.\n   *\n   * @param state The state of the variable to assign to this variable field.\n   * @internal\n   */\n  override loadState(state: AnyDuringMigration) {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    if (this.loadLegacyState(FieldVariable, state)) {\n      return;\n    }\n    // This is necessary so that blocks in the flyout can have custom var names.\n    const variable = Variables.getOrCreateVariablePackage(\n        block.workspace, state['id'] || null, state['name'],\n        state['type'] || '');\n    this.setValue(variable.getId());\n  }\n\n  /**\n   * Attach this field to a block.\n   *\n   * @param block The block containing this field.\n   */\n  override setSourceBlock(block: Block) {\n    if (block.isShadow()) {\n      throw Error('Variable fields are not allowed to exist on shadow blocks.');\n    }\n    super.setSourceBlock(block);\n  }\n\n  /**\n   * Get the variable's ID.\n   *\n   * @returns Current variable's ID.\n   */\n  override getValue(): string|null {\n    return this.variable_ ? this.variable_.getId() : null;\n  }\n\n  /**\n   * Get the text from this field, which is the selected variable's name.\n   *\n   * @returns The selected variable's name, or the empty string if no variable\n   *     is selected.\n   */\n  override getText(): string {\n    return this.variable_ ? this.variable_.name : '';\n  }\n\n  /**\n   * Get the variable model for the selected variable.\n   * Not guaranteed to be in the variable map on the workspace (e.g. if accessed\n   * after the variable has been deleted).\n   *\n   * @returns The selected variable, or null if none was selected.\n   * @internal\n   */\n  getVariable(): VariableModel|null {\n    return this.variable_;\n  }\n\n  /**\n   * Gets the validation function for this field, or null if not set.\n   * Returns null if the variable is not set, because validators should not\n   * run on the initial setValue call, because the field won't be attached to\n   * a block and workspace at that point.\n   *\n   * @returns Validation function, or null.\n   */\n  override getValidator(): Function|null {\n    // Validators shouldn't operate on the initial setValue call.\n    // Normally this is achieved by calling setValidator after setValue, but\n    // this is not a possibility with variable fields.\n    if (this.variable_) {\n      return this.validator_;\n    }\n    return null;\n  }\n\n  /**\n   * Ensure that the ID belongs to a valid variable of an allowed type.\n   *\n   * @param opt_newValue The ID of the new variable to set.\n   * @returns The validated ID, or null if invalid.\n   */\n  protected override doClassValidation_(opt_newValue?: AnyDuringMigration):\n      string|null {\n    if (opt_newValue === null) {\n      return null;\n    }\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    const newId = opt_newValue as string;\n    const variable = Variables.getVariable(block.workspace, newId);\n    if (!variable) {\n      console.warn(\n          'Variable id doesn\\'t point to a real variable! ' +\n          'ID was ' + newId);\n      return null;\n    }\n    // Type Checks.\n    const type = variable.type;\n    if (!this.typeIsAllowed_(type)) {\n      console.warn(\n          'Variable type doesn\\'t match this field!  Type was ' + type);\n      return null;\n    }\n    return newId;\n  }\n\n  /**\n   * Update the value of this variable field, as well as its variable and text.\n   *\n   * The variable ID should be valid at this point, but if a variable field\n   * validator returns a bad ID, this could break.\n   *\n   * @param newId The value to be saved.\n   */\n  protected override doValueUpdate_(newId: AnyDuringMigration) {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    this.variable_ = Variables.getVariable(block.workspace, newId as string);\n    super.doValueUpdate_(newId);\n  }\n\n  /**\n   * Check whether the given variable type is allowed on this field.\n   *\n   * @param type The type to check.\n   * @returns True if the type is in the list of allowed types.\n   */\n  private typeIsAllowed_(type: string): boolean {\n    const typeList = this.getVariableTypes_();\n    if (!typeList) {\n      return true;  // If it's null, all types are valid.\n    }\n    for (let i = 0; i < typeList.length; i++) {\n      if (type === typeList[i]) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Return a list of variable types to include in the dropdown.\n   *\n   * @returns Array of variable types.\n   * @throws {Error} if variableTypes is an empty array.\n   */\n  private getVariableTypes_(): string[] {\n    // TODO (#1513): Try to avoid calling this every time the field is edited.\n    let variableTypes = this.variableTypes;\n    if (variableTypes === null) {\n      // If variableTypes is null, return all variable types.\n      if (this.sourceBlock_ && !this.sourceBlock_.isDeadOrDying()) {\n        return this.sourceBlock_.workspace.getVariableTypes();\n      }\n    }\n    variableTypes = variableTypes || [''];\n    if (variableTypes.length === 0) {\n      // Throw an error if variableTypes is an empty list.\n      const name = this.getText();\n      throw Error(\n          '\\'variableTypes\\' of field variable ' + name + ' was an empty list');\n    }\n    return variableTypes;\n  }\n\n  /**\n   * Parse the optional arguments representing the allowed variable types and\n   * the default variable type.\n   *\n   * @param opt_variableTypes A list of the types of variables to include in the\n   *     dropdown.  If null or undefined, variables of all types will be\n   *     displayed in the dropdown.\n   * @param opt_defaultType The type of the variable to create if this field's\n   *     value is not explicitly set.  Defaults to ''.\n   */\n  private setTypes_(opt_variableTypes?: string[], opt_defaultType?: string) {\n    // If you expected that the default type would be the same as the only entry\n    // in the variable types array, tell the Blockly team by commenting on\n    // #1499.\n    const defaultType = opt_defaultType || '';\n    let variableTypes;\n    // Set the allowable variable types.  Null means all types on the workspace.\n    if (opt_variableTypes === null || opt_variableTypes === undefined) {\n      variableTypes = null;\n    } else if (Array.isArray(opt_variableTypes)) {\n      variableTypes = opt_variableTypes;\n      // Make sure the default type is valid.\n      let isInArray = false;\n      for (let i = 0; i < variableTypes.length; i++) {\n        if (variableTypes[i] === defaultType) {\n          isInArray = true;\n        }\n      }\n      if (!isInArray) {\n        throw Error(\n            'Invalid default type \\'' + defaultType + '\\' in ' +\n            'the definition of a FieldVariable');\n      }\n    } else {\n      throw Error(\n          '\\'variableTypes\\' was not an array in the definition of ' +\n          'a FieldVariable');\n    }\n    // Only update the field once all checks pass.\n    this.defaultType_ = defaultType;\n    this.variableTypes = variableTypes;\n  }\n\n  /**\n   * Refreshes the name of the variable by grabbing the name of the model.\n   * Used when a variable gets renamed, but the ID stays the same. Should only\n   * be called by the block.\n   *\n   * @internal\n   */\n  override refreshVariableName() {\n    this.forceRerender();\n  }\n\n  /**\n   * Handle the selection of an item in the variable dropdown menu.\n   * Special case the 'Rename variable...' and 'Delete variable...' options.\n   * In the rename case, prompt the user for a new name.\n   *\n   * @param menu The Menu component clicked.\n   * @param menuItem The MenuItem selected within menu.\n   */\n  protected override onItemSelected_(menu: Menu, menuItem: MenuItem) {\n    const id = menuItem.getValue();\n    // Handle special cases.\n    if (this.sourceBlock_ && !this.sourceBlock_.isDeadOrDying()) {\n      if (id === internalConstants.RENAME_VARIABLE_ID) {\n        // Rename variable.\n        Variables.renameVariable(\n            this.sourceBlock_.workspace, this.variable_ as VariableModel);\n        return;\n      } else if (id === internalConstants.DELETE_VARIABLE_ID) {\n        // Delete variable.\n        this.sourceBlock_.workspace.deleteVariableById(this.variable_!.getId());\n        return;\n      }\n    }\n    // Handle unspecial case.\n    this.setValue(id);\n  }\n\n  /**\n   * Overrides referencesVariables(), indicating this field refers to a\n   * variable.\n   *\n   * @returns True.\n   * @internal\n   */\n  override referencesVariables(): boolean {\n    return true;\n  }\n\n  /**\n   * Construct a FieldVariable from a JSON arg object,\n   * dereferencing any string table references.\n   *\n   * @param options A JSON object with options (variable, variableTypes, and\n   *     defaultType).\n   * @returns The new field instance.\n   * @nocollapse\n   * @internal\n   */\n  static override fromJson(options: FieldVariableFromJsonConfig):\n      FieldVariable {\n    const varName = parsing.replaceMessageReferences(options.variable);\n    // `this` might be a subclass of FieldVariable if that class doesn't\n    // override the static fromJson method.\n    return new this(varName, undefined, undefined, undefined, options);\n  }\n\n  /**\n   * Return a sorted list of variable names for variable dropdown menus.\n   * Include a special option at the end for creating a new variable name.\n   *\n   * @returns Array of variable names/id tuples.\n   */\n  static dropdownCreate(this: FieldVariable): MenuOption[] {\n    if (!this.variable_) {\n      throw Error(\n          'Tried to call dropdownCreate on a variable field with no' +\n          ' variable selected.');\n    }\n    const name = this.getText();\n    let variableModelList: VariableModel[] = [];\n    if (this.sourceBlock_ && !this.sourceBlock_.isDeadOrDying()) {\n      const variableTypes = this.getVariableTypes_();\n      // Get a copy of the list, so that adding rename and new variable options\n      // doesn't modify the workspace's list.\n      for (let i = 0; i < variableTypes.length; i++) {\n        const variableType = variableTypes[i];\n        const variables =\n            this.sourceBlock_.workspace.getVariablesOfType(variableType);\n        variableModelList = variableModelList.concat(variables);\n      }\n    }\n    variableModelList.sort(VariableModel.compareByName);\n\n    const options: [string, string][] = [];\n    for (let i = 0; i < variableModelList.length; i++) {\n      // Set the UUID as the internal representation of the variable.\n      options[i] = [variableModelList[i].name, variableModelList[i].getId()];\n    }\n    options.push(\n        [Msg['RENAME_VARIABLE'], internalConstants.RENAME_VARIABLE_ID]);\n    if (Msg['DELETE_VARIABLE']) {\n      options.push([\n        Msg['DELETE_VARIABLE'].replace('%1', name),\n        internalConstants.DELETE_VARIABLE_ID,\n      ]);\n    }\n\n    return options;\n  }\n}\n\nfieldRegistry.register('field_variable', FieldVariable);\n\n/**\n * Config options for the variable field.\n */\nexport interface FieldVariableConfig extends FieldConfig {\n  variableTypes?: string[];\n  defaultType?: string;\n}\n\n/**\n * fromJson config options for the variable field.\n */\nexport interface FieldVariableFromJsonConfig extends FieldVariableConfig {\n  variable?: string;\n}\n","/**\n * @license\n * Copyright 2016 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Number input field\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.FieldNumber');\n\nimport {Field} from './field.js';\nimport * as fieldRegistry from './field_registry.js';\nimport {FieldInput, FieldInputConfig, FieldInputValidator} from './field_input.js';\nimport * as aria from './utils/aria.js';\nimport type {Sentinel} from './utils/sentinel.js';\n\nexport type FieldNumberValidator = FieldInputValidator<number>;\n\n/**\n * Class for an editable number field.\n *\n * @alias Blockly.FieldNumber\n */\nexport class FieldNumber extends FieldInput<number> {\n  /** The minimum value this number field can contain. */\n  protected min_ = -Infinity;\n\n  /** The maximum value this number field can contain. */\n  protected max_ = Infinity;\n\n  /** The multiple to which this fields value is rounded. */\n  protected precision_ = 0;\n\n  /**\n   * The number of decimal places to allow, or null to allow any number of\n   * decimal digits.\n   */\n  private decimalPlaces_: number|null = null;\n\n  /**\n   * Serializable fields are saved by the serializer, non-serializable fields\n   * are not. Editable fields should also be serializable.\n   */\n  override SERIALIZABLE = true;\n\n  /** Don't spellcheck numbers.  Our validator does a better job. */\n  protected override spellcheck_ = false;\n\n  /**\n   * @param opt_value The initial value of the field. Should cast to a number.\n   *     Defaults to 0. Also accepts Field.SKIP_SETUP if you wish to skip setup\n   *     (only used by subclasses that want to handle configuration and setting\n   *     the field value after their own constructors have run).\n   * @param opt_min Minimum value. Will only be used if opt_config is not\n   *     provided.\n   * @param opt_max Maximum value. Will only be used if opt_config is not\n   *     provided.\n   * @param opt_precision Precision for value. Will only be used if opt_config\n   *     is not provided.\n   * @param opt_validator A function that is called to validate changes to the\n   *     field's value. Takes in a number & returns a validated number, or null\n   *     to abort the change.\n   * @param opt_config A map of options used to configure the field.\n   *     See the [field creation documentation]{@link\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/number#creation}\n   * for a list of properties this parameter supports.\n   */\n  constructor(\n      opt_value?: string|number|Sentinel, opt_min?: string|number|null,\n      opt_max?: string|number|null, opt_precision?: string|number|null,\n      opt_validator?: FieldNumberValidator|null,\n      opt_config?: FieldNumberConfig) {\n    // Pass SENTINEL so that we can define properties before value validation.\n    super(Field.SKIP_SETUP);\n\n    if (opt_value === Field.SKIP_SETUP) {\n      return;\n    }\n    if (opt_config) {\n      this.configure_(opt_config);\n    } else {\n      this.setConstraints(opt_min, opt_max, opt_precision);\n    }\n    this.setValue(opt_value);\n    if (opt_validator) {\n      this.setValidator(opt_validator);\n    }\n  }\n\n  /**\n   * Configure the field based on the given map of options.\n   *\n   * @param config A map of options to configure the field based on.\n   */\n  protected override configure_(config: FieldNumberConfig) {\n    super.configure_(config);\n    this.setMinInternal_(config.min);\n    this.setMaxInternal_(config.max);\n    this.setPrecisionInternal_(config.precision);\n  }\n\n  /**\n   * Set the maximum, minimum and precision constraints on this field.\n   * Any of these properties may be undefined or NaN to be disabled.\n   * Setting precision (usually a power of 10) enforces a minimum step between\n   * values. That is, the user's value will rounded to the closest multiple of\n   * precision. The least significant digit place is inferred from the\n   * precision. Integers values can be enforces by choosing an integer\n   * precision.\n   *\n   * @param min Minimum value.\n   * @param max Maximum value.\n   * @param precision Precision for value.\n   */\n  setConstraints(\n      min: number|string|undefined|null, max: number|string|undefined|null,\n      precision: number|string|undefined|null) {\n    this.setMinInternal_(min);\n    this.setMaxInternal_(max);\n    this.setPrecisionInternal_(precision);\n    this.setValue(this.getValue());\n  }\n\n  /**\n   * Sets the minimum value this field can contain. Updates the value to\n   * reflect.\n   *\n   * @param min Minimum value.\n   */\n  setMin(min: number|string|undefined|null) {\n    this.setMinInternal_(min);\n    this.setValue(this.getValue());\n  }\n\n  /**\n   * Sets the minimum value this field can contain. Called internally to avoid\n   * value updates.\n   *\n   * @param min Minimum value.\n   */\n  private setMinInternal_(min: number|string|undefined|null) {\n    if (min == null) {\n      this.min_ = -Infinity;\n    } else {\n      min = Number(min);\n      if (!isNaN(min)) {\n        this.min_ = min;\n      }\n    }\n  }\n\n  /**\n   * Returns the current minimum value this field can contain. Default is\n   * -Infinity.\n   *\n   * @returns The current minimum value this field can contain.\n   */\n  getMin(): number {\n    return this.min_;\n  }\n\n  /**\n   * Sets the maximum value this field can contain. Updates the value to\n   * reflect.\n   *\n   * @param max Maximum value.\n   */\n  setMax(max: number|string|undefined|null) {\n    this.setMaxInternal_(max);\n    this.setValue(this.getValue());\n  }\n\n  /**\n   * Sets the maximum value this field can contain. Called internally to avoid\n   * value updates.\n   *\n   * @param max Maximum value.\n   */\n  private setMaxInternal_(max: number|string|undefined|null) {\n    if (max == null) {\n      this.max_ = Infinity;\n    } else {\n      max = Number(max);\n      if (!isNaN(max)) {\n        this.max_ = max;\n      }\n    }\n  }\n\n  /**\n   * Returns the current maximum value this field can contain. Default is\n   * Infinity.\n   *\n   * @returns The current maximum value this field can contain.\n   */\n  getMax(): number {\n    return this.max_;\n  }\n\n  /**\n   * Sets the precision of this field's value, i.e. the number to which the\n   * value is rounded. Updates the field to reflect.\n   *\n   * @param precision The number to which the field's value is rounded.\n   */\n  setPrecision(precision: number|string|undefined|null) {\n    this.setPrecisionInternal_(precision);\n    this.setValue(this.getValue());\n  }\n\n  /**\n   * Sets the precision of this field's value. Called internally to avoid\n   * value updates.\n   *\n   * @param precision The number to which the field's value is rounded.\n   */\n  private setPrecisionInternal_(precision: number|string|undefined|null) {\n    this.precision_ = Number(precision) || 0;\n    let precisionString = String(this.precision_);\n    if (precisionString.indexOf('e') !== -1) {\n      // String() is fast.  But it turns .0000001 into '1e-7'.\n      // Use the much slower toLocaleString to access all the digits.\n      precisionString =\n          this.precision_.toLocaleString('en-US', {maximumFractionDigits: 20});\n    }\n    const decimalIndex = precisionString.indexOf('.');\n    if (decimalIndex === -1) {\n      // If the precision is 0 (float) allow any number of decimals,\n      // otherwise allow none.\n      this.decimalPlaces_ = precision ? 0 : null;\n    } else {\n      this.decimalPlaces_ = precisionString.length - decimalIndex - 1;\n    }\n  }\n\n  /**\n   * Returns the current precision of this field. The precision being the\n   * number to which the field's value is rounded. A precision of 0 means that\n   * the value is not rounded.\n   *\n   * @returns The number to which this field's value is rounded.\n   */\n  getPrecision(): number {\n    return this.precision_;\n  }\n\n  /**\n   * Ensure that the input value is a valid number (must fulfill the\n   * constraints placed on the field).\n   *\n   * @param opt_newValue The input value.\n   * @returns A valid number, or null if invalid.\n   */\n  protected override doClassValidation_(opt_newValue?: AnyDuringMigration):\n      number|null {\n    if (opt_newValue === null) {\n      return null;\n    }\n    // Clean up text.\n    let newValue = String(opt_newValue);\n    // TODO: Handle cases like 'ten', '1.203,14', etc.\n    // 'O' is sometimes mistaken for '0' by inexperienced users.\n    newValue = newValue.replace(/O/ig, '0');\n    // Strip out thousands separators.\n    newValue = newValue.replace(/,/g, '');\n    // Ignore case of 'Infinity'.\n    newValue = newValue.replace(/infinity/i, 'Infinity');\n\n    // Clean up number.\n    let n = Number(newValue || 0);\n    if (isNaN(n)) {\n      // Invalid number.\n      return null;\n    }\n    // Get the value in range.\n    n = Math.min(Math.max(n, this.min_), this.max_);\n    // Round to nearest multiple of precision.\n    if (this.precision_ && isFinite(n)) {\n      n = Math.round(n / this.precision_) * this.precision_;\n    }\n    // Clean up floating point errors.\n    if (this.decimalPlaces_ !== null) {\n      n = Number(n.toFixed(this.decimalPlaces_));\n    }\n    return n;\n  }\n\n  /**\n   * Create the number input editor widget.\n   *\n   * @returns The newly created number input editor.\n   */\n  protected override widgetCreate_(): HTMLElement {\n    const htmlInput = super.widgetCreate_();\n\n    // Set the accessibility state\n    if (this.min_ > -Infinity) {\n      aria.setState(htmlInput, aria.State.VALUEMIN, this.min_);\n    }\n    if (this.max_ < Infinity) {\n      aria.setState(htmlInput, aria.State.VALUEMAX, this.max_);\n    }\n    return htmlInput;\n  }\n\n  /**\n   * Construct a FieldNumber from a JSON arg object.\n   *\n   * @param options A JSON object with options (value, min, max, and precision).\n   * @returns The new field instance.\n   * @nocollapse\n   * @internal\n   */\n  static fromJson(options: FieldNumberFromJsonConfig): FieldNumber {\n    // `this` might be a subclass of FieldNumber if that class doesn't override\n    // the static fromJson method.\n    return new this(\n        options.value, undefined, undefined, undefined, undefined, options);\n  }\n}\n\nfieldRegistry.register('field_number', FieldNumber);\n\nFieldNumber.prototype.DEFAULT_VALUE = 0;\n\n/**\n * Config options for the number field.\n */\nexport interface FieldNumberConfig extends FieldInputConfig {\n  min?: number;\n  max?: number;\n  precision?: number;\n}\n\n/**\n * fromJson config options for the number field.\n */\nexport interface FieldNumberFromJsonConfig extends FieldNumberConfig {\n  value?: number;\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Text Area field.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.FieldMultilineInput');\n\nimport * as Css from './css.js';\nimport {Field, UnattachedFieldError} from './field.js';\nimport * as fieldRegistry from './field_registry.js';\nimport {FieldTextInput, FieldTextInputConfig, FieldTextInputValidator} from './field_textinput.js';\nimport * as aria from './utils/aria.js';\nimport * as dom from './utils/dom.js';\nimport {KeyCodes} from './utils/keycodes.js';\nimport * as parsing from './utils/parsing.js';\nimport type {Sentinel} from './utils/sentinel.js';\nimport {Svg} from './utils/svg.js';\nimport * as userAgent from './utils/useragent.js';\nimport * as WidgetDiv from './widgetdiv.js';\n\nexport type FieldMultilineInputValidator = FieldTextInputValidator;\n\n/**\n * Class for an editable text area field.\n *\n * @alias Blockly.FieldMultilineInput\n */\nexport class FieldMultilineInput extends FieldTextInput {\n  /**\n   * The SVG group element that will contain a text element for each text row\n   *     when initialized.\n   */\n  // AnyDuringMigration because:  Type 'null' is not assignable to type\n  // 'SVGGElement'.\n  textGroup_: SVGGElement = null as AnyDuringMigration;\n\n  /**\n   * Defines the maximum number of lines of field.\n   * If exceeded, scrolling functionality is enabled.\n   */\n  protected maxLines_ = Infinity;\n\n  /** Whether Y overflow is currently occurring. */\n  protected isOverflowedY_ = false;\n\n  /**\n   * @param opt_value The initial content of the field. Should cast to a string.\n   *     Defaults to an empty string if null or undefined. Also accepts\n   *     Field.SKIP_SETUP if you wish to skip setup (only used by subclasses\n   *     that want to handle configuration and setting the field value after\n   *     their own constructors have run).\n   * @param opt_validator An optional function that is called to validate any\n   *     constraints on what the user entered.  Takes the new text as an\n   *     argument and returns either the accepted text, a replacement text, or\n   *     null to abort the change.\n   * @param opt_config A map of options used to configure the field.\n   *     See the [field creation documentation]{@link\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/multiline-text-input#creation}\n   * for a list of properties this parameter supports.\n   */\n  constructor(\n      opt_value?: string|Sentinel, opt_validator?: FieldMultilineInputValidator,\n      opt_config?: FieldMultilineInputConfig) {\n    super(Field.SKIP_SETUP);\n\n    if (opt_value === Field.SKIP_SETUP) {\n      return;\n    }\n    if (opt_config) {\n      this.configure_(opt_config);\n    }\n    this.setValue(opt_value);\n    if (opt_validator) {\n      this.setValidator(opt_validator);\n    }\n  }\n\n  protected override configure_(config: FieldMultilineInputConfig) {\n    super.configure_(config);\n    if (config.maxLines) this.setMaxLines(config.maxLines);\n  }\n\n  /**\n   * Serializes this field's value to XML. Should only be called by Blockly.Xml.\n   *\n   * @param fieldElement The element to populate with info about the field's\n   *     state.\n   * @returns The element containing info about the field's state.\n   * @internal\n   */\n  override toXml(fieldElement: Element): Element {\n    // Replace '\\n' characters with HTML-escaped equivalent '&#10'. This is\n    // needed so the plain-text representation of the XML produced by\n    // `Blockly.Xml.domToText` will appear on a single line (this is a\n    // limitation of the plain-text format).\n    fieldElement.textContent =\n        (this.getValue() as string).replace(/\\n/g, '&#10;');\n    return fieldElement;\n  }\n\n  /**\n   * Sets the field's value based on the given XML element. Should only be\n   * called by Blockly.Xml.\n   *\n   * @param fieldElement The element containing info about the field's state.\n   * @internal\n   */\n  override fromXml(fieldElement: Element) {\n    this.setValue(fieldElement.textContent!.replace(/&#10;/g, '\\n'));\n  }\n\n  /**\n   * Saves this field's value.\n   *\n   * @returns The state of this field.\n   * @internal\n   */\n  override saveState(): AnyDuringMigration {\n    const legacyState = this.saveLegacyState(FieldMultilineInput);\n    if (legacyState !== null) {\n      return legacyState;\n    }\n    return this.getValue();\n  }\n\n  /**\n   * Sets the field's value based on the given state.\n   *\n   * @param state The state of the variable to assign to this variable field.\n   * @internal\n   */\n  override loadState(state: AnyDuringMigration) {\n    if (this.loadLegacyState(Field, state)) {\n      return;\n    }\n    this.setValue(state);\n  }\n\n  /**\n   * Create the block UI for this field.\n   *\n   * @internal\n   */\n  override initView() {\n    this.createBorderRect_();\n    this.textGroup_ = dom.createSvgElement(\n        Svg.G, {\n          'class': 'blocklyEditableText',\n        },\n        this.fieldGroup_);\n  }\n\n  /**\n   * Get the text from this field as displayed on screen.  May differ from\n   * getText due to ellipsis, and other formatting.\n   *\n   * @returns Currently displayed text.\n   */\n  protected override getDisplayText_(): string {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    let textLines = this.getText();\n    if (!textLines) {\n      // Prevent the field from disappearing if empty.\n      return Field.NBSP;\n    }\n    const lines = textLines.split('\\n');\n    textLines = '';\n    const displayLinesNumber =\n        this.isOverflowedY_ ? this.maxLines_ : lines.length;\n    for (let i = 0; i < displayLinesNumber; i++) {\n      let text = lines[i];\n      if (text.length > this.maxDisplayLength) {\n        // Truncate displayed string and add an ellipsis ('...').\n        text = text.substring(0, this.maxDisplayLength - 4) + '...';\n      } else if (this.isOverflowedY_ && i === displayLinesNumber - 1) {\n        text = text.substring(0, text.length - 3) + '...';\n      }\n      // Replace whitespace with non-breaking spaces so the text doesn't\n      // collapse.\n      text = text.replace(/\\s/g, Field.NBSP);\n\n      textLines += text;\n      if (i !== displayLinesNumber - 1) {\n        textLines += '\\n';\n      }\n    }\n    if (block.RTL) {\n      // The SVG is LTR, force value to be RTL.\n      textLines += '\\u200F';\n    }\n    return textLines;\n  }\n\n  /**\n   * Called by setValue if the text input is valid. Updates the value of the\n   * field, and updates the text of the field if it is not currently being\n   * edited (i.e. handled by the htmlInput_). Is being redefined here to update\n   * overflow state of the field.\n   *\n   * @param newValue The value to be saved. The default validator guarantees\n   *     that this is a string.\n   */\n  protected override doValueUpdate_(newValue: AnyDuringMigration) {\n    super.doValueUpdate_(newValue);\n    this.isOverflowedY_ = this.value_.split('\\n').length > this.maxLines_;\n  }\n\n  /** Updates the text of the textElement. */\n  protected override render_() {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    // Remove all text group children.\n    let currentChild;\n    while (currentChild = this.textGroup_.firstChild) {\n      this.textGroup_.removeChild(currentChild);\n    }\n\n    // Add in text elements into the group.\n    const lines = this.getDisplayText_().split('\\n');\n    let y = 0;\n    for (let i = 0; i < lines.length; i++) {\n      const lineHeight = this.getConstants()!.FIELD_TEXT_HEIGHT +\n          this.getConstants()!.FIELD_BORDER_RECT_Y_PADDING;\n      const span = dom.createSvgElement(\n          Svg.TEXT, {\n            'class': 'blocklyText blocklyMultilineText',\n            'x': this.getConstants()!.FIELD_BORDER_RECT_X_PADDING,\n            'y': y + this.getConstants()!.FIELD_BORDER_RECT_Y_PADDING,\n            'dy': this.getConstants()!.FIELD_TEXT_BASELINE,\n          },\n          this.textGroup_);\n      span.appendChild(document.createTextNode(lines[i]));\n      y += lineHeight;\n    }\n\n    if (this.isBeingEdited_) {\n      const htmlInput = this.htmlInput_ as HTMLElement;\n      if (this.isOverflowedY_) {\n        dom.addClass(htmlInput, 'blocklyHtmlTextAreaInputOverflowedY');\n      } else {\n        dom.removeClass(htmlInput, 'blocklyHtmlTextAreaInputOverflowedY');\n      }\n    }\n\n    this.updateSize_();\n\n    if (this.isBeingEdited_) {\n      if (block.RTL) {\n        // in RTL, we need to let the browser reflow before resizing\n        // in order to get the correct bounding box of the borderRect\n        // avoiding issue #2777.\n        setTimeout(this.resizeEditor_.bind(this), 0);\n      } else {\n        this.resizeEditor_();\n      }\n      const htmlInput = this.htmlInput_ as HTMLElement;\n      if (!this.isTextValid_) {\n        dom.addClass(htmlInput, 'blocklyInvalidInput');\n        aria.setState(htmlInput, aria.State.INVALID, true);\n      } else {\n        dom.removeClass(htmlInput, 'blocklyInvalidInput');\n        aria.setState(htmlInput, aria.State.INVALID, false);\n      }\n    }\n  }\n\n  /** Updates the size of the field based on the text. */\n  protected override updateSize_() {\n    const nodes = this.textGroup_.childNodes;\n    const fontSize = this.getConstants()!.FIELD_TEXT_FONTSIZE;\n    const fontWeight = this.getConstants()!.FIELD_TEXT_FONTWEIGHT;\n    const fontFamily = this.getConstants()!.FIELD_TEXT_FONTFAMILY;\n    let totalWidth = 0;\n    let totalHeight = 0;\n    for (let i = 0; i < nodes.length; i++) {\n      const tspan = nodes[i] as SVGTextElement;\n      const textWidth =\n          dom.getFastTextWidth(tspan, fontSize, fontWeight, fontFamily);\n      if (textWidth > totalWidth) {\n        totalWidth = textWidth;\n      }\n      totalHeight += this.getConstants()!.FIELD_TEXT_HEIGHT +\n          (i > 0 ? this.getConstants()!.FIELD_BORDER_RECT_Y_PADDING : 0);\n    }\n    if (this.isBeingEdited_) {\n      // The default width is based on the longest line in the display text,\n      // but when it's being edited, width should be calculated based on the\n      // absolute longest line, even if it would be truncated after editing.\n      // Otherwise we would get wrong editor width when there are more\n      // lines than this.maxLines_.\n      const actualEditorLines = this.value_.split('\\n');\n      const dummyTextElement = dom.createSvgElement(\n          Svg.TEXT, {'class': 'blocklyText blocklyMultilineText'});\n\n      for (let i = 0; i < actualEditorLines.length; i++) {\n        if (actualEditorLines[i].length > this.maxDisplayLength) {\n          actualEditorLines[i] =\n              actualEditorLines[i].substring(0, this.maxDisplayLength);\n        }\n        dummyTextElement.textContent = actualEditorLines[i];\n        const lineWidth = dom.getFastTextWidth(\n            dummyTextElement, fontSize, fontWeight, fontFamily);\n        if (lineWidth > totalWidth) {\n          totalWidth = lineWidth;\n        }\n      }\n\n      const scrollbarWidth =\n          this.htmlInput_!.offsetWidth - this.htmlInput_!.clientWidth;\n      totalWidth += scrollbarWidth;\n    }\n    if (this.borderRect_) {\n      totalHeight += this.getConstants()!.FIELD_BORDER_RECT_Y_PADDING * 2;\n      totalWidth += this.getConstants()!.FIELD_BORDER_RECT_X_PADDING * 2;\n      // AnyDuringMigration because:  Argument of type 'number' is not\n      // assignable to parameter of type 'string'.\n      this.borderRect_.setAttribute('width', totalWidth as AnyDuringMigration);\n      // AnyDuringMigration because:  Argument of type 'number' is not\n      // assignable to parameter of type 'string'.\n      this.borderRect_.setAttribute(\n          'height', totalHeight as AnyDuringMigration);\n    }\n    this.size_.width = totalWidth;\n    this.size_.height = totalHeight;\n\n    this.positionBorderRect_();\n  }\n\n  /**\n   * Show the inline free-text editor on top of the text.\n   * Overrides the default behaviour to force rerender in order to\n   * correct block size, based on editor text.\n   *\n   * @param _opt_e Optional mouse event that triggered the field to open, or\n   *     undefined if triggered programmatically.\n   * @param opt_quietInput True if editor should be created without focus.\n   *     Defaults to false.\n   */\n  override showEditor_(_opt_e?: Event, opt_quietInput?: boolean) {\n    super.showEditor_(_opt_e, opt_quietInput);\n    this.forceRerender();\n  }\n\n  /**\n   * Create the text input editor widget.\n   *\n   * @returns The newly created text input editor.\n   */\n  protected override widgetCreate_(): HTMLTextAreaElement {\n    const div = WidgetDiv.getDiv();\n    const scale = this.workspace_!.getScale();\n\n    const htmlInput = (document.createElement('textarea'));\n    htmlInput.className = 'blocklyHtmlInput blocklyHtmlTextAreaInput';\n    // AnyDuringMigration because:  Argument of type 'boolean' is not assignable\n    // to parameter of type 'string'.\n    htmlInput.setAttribute(\n        'spellcheck', this.spellcheck_ as AnyDuringMigration);\n    const fontSize = this.getConstants()!.FIELD_TEXT_FONTSIZE * scale + 'pt';\n    div!.style.fontSize = fontSize;\n    htmlInput.style.fontSize = fontSize;\n    const borderRadius = FieldTextInput.BORDERRADIUS * scale + 'px';\n    htmlInput.style.borderRadius = borderRadius;\n    const paddingX = this.getConstants()!.FIELD_BORDER_RECT_X_PADDING * scale;\n    const paddingY =\n        this.getConstants()!.FIELD_BORDER_RECT_Y_PADDING * scale / 2;\n    htmlInput.style.padding = paddingY + 'px ' + paddingX + 'px ' + paddingY +\n        'px ' + paddingX + 'px';\n    const lineHeight = this.getConstants()!.FIELD_TEXT_HEIGHT +\n        this.getConstants()!.FIELD_BORDER_RECT_Y_PADDING;\n    htmlInput.style.lineHeight = lineHeight * scale + 'px';\n\n    div!.appendChild(htmlInput);\n\n    htmlInput.value = htmlInput.defaultValue = this.getEditorText_(this.value_);\n    htmlInput.setAttribute('data-untyped-default-value', this.value_);\n    htmlInput.setAttribute('data-old-value', '');\n    if (userAgent.GECKO) {\n      // In FF, ensure the browser reflows before resizing to avoid issue #2777.\n      setTimeout(this.resizeEditor_.bind(this), 0);\n    } else {\n      this.resizeEditor_();\n    }\n\n    this.bindInputEvents_(htmlInput);\n\n    return htmlInput;\n  }\n\n  /**\n   * Sets the maxLines config for this field.\n   *\n   * @param maxLines Defines the maximum number of lines allowed, before\n   *     scrolling functionality is enabled.\n   */\n  setMaxLines(maxLines: number) {\n    if (typeof maxLines === 'number' && maxLines > 0 &&\n        maxLines !== this.maxLines_) {\n      this.maxLines_ = maxLines;\n      this.forceRerender();\n    }\n  }\n\n  /**\n   * Returns the maxLines config of this field.\n   *\n   * @returns The maxLines config value.\n   */\n  getMaxLines(): number {\n    return this.maxLines_;\n  }\n\n  /**\n   * Handle key down to the editor. Override the text input definition of this\n   * so as to not close the editor when enter is typed in.\n   *\n   * @param e Keyboard event.\n   */\n  protected override onHtmlInputKeyDown_(e: Event) {\n    // AnyDuringMigration because:  Property 'keyCode' does not exist on type\n    // 'Event'.\n    if ((e as AnyDuringMigration).keyCode !== KeyCodes.ENTER) {\n      super.onHtmlInputKeyDown_(e);\n    }\n  }\n\n  /**\n   * Construct a FieldMultilineInput from a JSON arg object,\n   * dereferencing any string table references.\n   *\n   * @param options A JSON object with options (text, and spellcheck).\n   * @returns The new field instance.\n   * @nocollapse\n   * @internal\n   */\n  static override fromJson(options: FieldMultilineInputFromJsonConfig):\n      FieldMultilineInput {\n    const text = parsing.replaceMessageReferences(options.text);\n    // `this` might be a subclass of FieldMultilineInput if that class doesn't\n    // override the static fromJson method.\n    return new this(text, undefined, options);\n  }\n}\n\n/** CSS for multiline field.  See css.js for use. */\nCss.register(`\n.blocklyHtmlTextAreaInput {\n  font-family: monospace;\n  resize: none;\n  overflow: hidden;\n  height: 100%;\n  text-align: left;\n}\n\n.blocklyHtmlTextAreaInputOverflowedY {\n  overflow-y: scroll;\n}\n`);\n\nfieldRegistry.register('field_multilinetext', FieldMultilineInput);\n\n/**\n * Config options for the multiline input field.\n */\nexport interface FieldMultilineInputConfig extends FieldTextInputConfig {\n  maxLines?: number;\n}\n\n/**\n * fromJson config options for the multiline input field.\n */\nexport interface FieldMultilineInputFromJsonConfig extends\n    FieldMultilineInputConfig {\n  text?: string;\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Non-editable, serializable text field. Behaves like a\n *    normal label but is serialized to XML. It may only be\n *    edited programmatically.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.FieldLabelSerializable');\n\nimport {FieldLabel, FieldLabelConfig, FieldLabelFromJsonConfig} from './field_label.js';\nimport * as fieldRegistry from './field_registry.js';\nimport * as parsing from './utils/parsing.js';\n\n/**\n * Class for a non-editable, serializable text field.\n *\n * @alias Blockly.FieldLabelSerializable\n */\nexport class FieldLabelSerializable extends FieldLabel {\n  /**\n   * Editable fields usually show some sort of UI indicating they are\n   * editable. This field should not.\n   */\n  override EDITABLE = false;\n\n  /**\n   * Serializable fields are saved by the XML renderer, non-serializable\n   * fields are not.  This field should be serialized, but only edited\n   * programmatically.\n   */\n  override SERIALIZABLE = true;\n\n  /**\n   * @param opt_value The initial value of the field. Should cast to a string.\n   *     Defaults to an empty string if null or undefined.\n   * @param opt_class Optional CSS class for the field's text.\n   * @param opt_config A map of options used to configure the field.\n   *    See the [field creation documentation]{@link\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/label-serializable#creation}\n   * for a list of properties this parameter supports.\n   */\n  constructor(\n      opt_value?: string, opt_class?: string, opt_config?: FieldLabelConfig) {\n    super(String(opt_value ?? ''), opt_class, opt_config);\n  }\n\n  /**\n   * Construct a FieldLabelSerializable from a JSON arg object,\n   * dereferencing any string table references.\n   *\n   * @param options A JSON object with options (text, and class).\n   * @returns The new field instance.\n   * @nocollapse\n   * @internal\n   */\n  static override fromJson(options: FieldLabelFromJsonConfig):\n      FieldLabelSerializable {\n    const text = parsing.replaceMessageReferences(options.text);\n    // `this` might be a subclass of FieldLabelSerializable if that class\n    // doesn't override the static fromJson method.\n    return new this(text, undefined, options);\n  }\n}\n\nfieldRegistry.register('field_label_serializable', FieldLabelSerializable);\n","/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Colour input field.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.FieldColour');\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_change.js';\n\nimport {BlockSvg} from './block_svg.js';\nimport * as browserEvents from './browser_events.js';\nimport * as Css from './css.js';\nimport * as dom from './utils/dom.js';\nimport * as dropDownDiv from './dropdowndiv.js';\nimport {Field, FieldConfig, FieldValidator} from './field.js';\nimport * as fieldRegistry from './field_registry.js';\nimport * as aria from './utils/aria.js';\nimport * as colour from './utils/colour.js';\nimport * as idGenerator from './utils/idgenerator.js';\nimport {KeyCodes} from './utils/keycodes.js';\nimport type {Sentinel} from './utils/sentinel.js';\nimport {Size} from './utils/size.js';\n\nexport type FieldColourValidator = FieldValidator<string>;\n\n/**\n * Class for a colour input field.\n *\n * @alias Blockly.FieldColour\n */\nexport class FieldColour extends Field<string> {\n  /**\n   * An array of colour strings for the palette.\n   * Copied from goog.ui.ColorPicker.SIMPLE_GRID_COLORS\n   * All colour pickers use this unless overridden with setColours.\n   */\n  static COLOURS: string[] = [\n    // grays\n    '#ffffff', '#cccccc', '#c0c0c0', '#999999',\n    '#666666', '#333333', '#000000',  // reds\n    '#ffcccc', '#ff6666', '#ff0000', '#cc0000',\n    '#990000', '#660000', '#330000',  // oranges\n    '#ffcc99', '#ff9966', '#ff9900', '#ff6600',\n    '#cc6600', '#993300', '#663300',  // yellows\n    '#ffff99', '#ffff66', '#ffcc66', '#ffcc33',\n    '#cc9933', '#996633', '#663333',  // olives\n    '#ffffcc', '#ffff33', '#ffff00', '#ffcc00',\n    '#999900', '#666600', '#333300',  // greens\n    '#99ff99', '#66ff99', '#33ff33', '#33cc00',\n    '#009900', '#006600', '#003300',  // turquoises\n    '#99ffff', '#33ffff', '#66cccc', '#00cccc',\n    '#339999', '#336666', '#003333',  // blues\n    '#ccffff', '#66ffff', '#33ccff', '#3366ff',\n    '#3333ff', '#000099', '#000066',  // purples\n    '#ccccff', '#9999ff', '#6666cc', '#6633ff',\n    '#6600cc', '#333399', '#330099',  // violets\n    '#ffccff', '#ff99ff', '#cc66cc', '#cc33cc',\n    '#993399', '#663366', '#330033',\n  ];\n\n  /**\n   * An array of tooltip strings for the palette.  If not the same length as\n   * COLOURS, the colour's hex code will be used for any missing titles.\n   * All colour pickers use this unless overridden with setColours.\n   */\n  static TITLES: string[] = [];\n\n  /**\n   * Number of columns in the palette.\n   * All colour pickers use this unless overridden with setColumns.\n   */\n  static COLUMNS = 7;\n\n  /** The field's colour picker element. */\n  private picker_: Element|null = null;\n\n  /** Index of the currently highlighted element. */\n  private highlightedIndex_: number|null = null;\n\n  /** Mouse click event data. */\n  private onClickWrapper_: browserEvents.Data|null = null;\n\n  /** Mouse move event data. */\n  private onMouseMoveWrapper_: browserEvents.Data|null = null;\n\n  /** Mouse enter event data. */\n  private onMouseEnterWrapper_: browserEvents.Data|null = null;\n\n  /** Mouse leave event data. */\n  private onMouseLeaveWrapper_: browserEvents.Data|null = null;\n\n  /** Key down event data. */\n  private onKeyDownWrapper_: browserEvents.Data|null = null;\n\n  /**\n   * Serializable fields are saved by the serializer, non-serializable fields\n   * are not. Editable fields should also be serializable.\n   */\n  override SERIALIZABLE = true;\n\n  /** Mouse cursor style when over the hotspot that initiates the editor. */\n  override CURSOR = 'default';\n\n  /**\n   * Used to tell if the field needs to be rendered the next time the block is\n   * rendered. Colour fields are statically sized, and only need to be\n   * rendered at initialization.\n   */\n  protected override isDirty_ = false;\n\n  /** Array of colours used by this field.  If null, use the global list. */\n  // AnyDuringMigration because:  Type 'null' is not assignable to type\n  // 'string[]'.\n  private colours_: string[] = null as AnyDuringMigration;\n\n  /**\n   * Array of colour tooltips used by this field.  If null, use the global\n   * list.\n   */\n  // AnyDuringMigration because:  Type 'null' is not assignable to type\n  // 'string[]'.\n  private titles_: string[] = null as AnyDuringMigration;\n\n  /**\n   * Number of colour columns used by this field.  If 0, use the global\n   * setting. By default use the global constants for columns.\n   */\n  private columns_ = 0;\n  override size_: AnyDuringMigration;\n  override clickTarget_: AnyDuringMigration;\n  override value_: AnyDuringMigration;\n\n  /**\n   * @param opt_value The initial value of the field. Should be in '#rrggbb'\n   *     format. Defaults to the first value in the default colour array. Also\n   *     accepts Field.SKIP_SETUP if you wish to skip setup (only used by\n   *     subclasses that want to handle configuration and setting the field\n   *     value after their own constructors have run).\n   * @param opt_validator A function that is called to validate changes to the\n   *     field's value. Takes in a colour string & returns a validated colour\n   *     string ('#rrggbb' format), or null to abort the change.Blockly.\n   * @param opt_config A map of options used to configure the field.\n   *     See the [field creation documentation]{@link\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/colour}\n   * for a list of properties this parameter supports.\n   */\n  constructor(\n      opt_value?: string|Sentinel, opt_validator?: FieldColourValidator,\n      opt_config?: FieldColourConfig) {\n    super(Field.SKIP_SETUP);\n\n    if (opt_value === Field.SKIP_SETUP) {\n      return;\n    }\n    if (opt_config) {\n      this.configure_(opt_config);\n    }\n    this.setValue(opt_value);\n    if (opt_validator) {\n      this.setValidator(opt_validator);\n    }\n  }\n\n  /**\n   * Configure the field based on the given map of options.\n   *\n   * @param config A map of options to configure the field based on.\n   */\n  protected override configure_(config: FieldColourConfig) {\n    super.configure_(config);\n    if (config.colourOptions) this.colours_ = config.colourOptions;\n    if (config.colourTitles) this.titles_ = config.colourTitles;\n    if (config.columns) this.columns_ = config.columns;\n  }\n\n  /**\n   * Create the block UI for this colour field.\n   *\n   * @internal\n   */\n  override initView() {\n    this.size_ = new Size(\n        this.getConstants()!.FIELD_COLOUR_DEFAULT_WIDTH,\n        this.getConstants()!.FIELD_COLOUR_DEFAULT_HEIGHT);\n    if (!this.getConstants()!.FIELD_COLOUR_FULL_BLOCK) {\n      this.createBorderRect_();\n      this.getBorderRect().style['fillOpacity'] = '1';\n    } else if (this.sourceBlock_ instanceof BlockSvg) {\n      this.clickTarget_ = this.sourceBlock_.getSvgRoot();\n    }\n  }\n\n  override applyColour() {\n    if (!this.getConstants()!.FIELD_COLOUR_FULL_BLOCK) {\n      if (this.borderRect_) {\n        this.borderRect_.style.fill = this.getValue() as string;\n      }\n    } else if (this.sourceBlock_ instanceof BlockSvg) {\n      this.sourceBlock_.pathObject.svgPath.setAttribute(\n          'fill', this.getValue() as string);\n      this.sourceBlock_.pathObject.svgPath.setAttribute('stroke', '#fff');\n    }\n  }\n\n  /**\n   * Ensure that the input value is a valid colour.\n   *\n   * @param opt_newValue The input value.\n   * @returns A valid colour, or null if invalid.\n   */\n  protected override doClassValidation_(opt_newValue?: AnyDuringMigration):\n      string|null {\n    if (typeof opt_newValue !== 'string') {\n      return null;\n    }\n    return colour.parse(opt_newValue);\n  }\n\n  /**\n   * Update the value of this colour field, and update the displayed colour.\n   *\n   * @param newValue The value to be saved. The default validator guarantees\n   *     that this is a colour in '#rrggbb' format.\n   */\n  protected override doValueUpdate_(newValue: AnyDuringMigration) {\n    this.value_ = newValue;\n    if (this.borderRect_) {\n      this.borderRect_.style.fill = newValue as string;\n    } else if (\n        this.sourceBlock_ && this.sourceBlock_.rendered &&\n        this.sourceBlock_ instanceof BlockSvg) {\n      this.sourceBlock_.pathObject.svgPath.setAttribute(\n          'fill', newValue as string);\n      this.sourceBlock_.pathObject.svgPath.setAttribute('stroke', '#fff');\n    }\n  }\n\n  /**\n   * Get the text for this field.  Used when the block is collapsed.\n   *\n   * @returns Text representing the value of this field.\n   */\n  override getText(): string {\n    let colour = this.value_ as string;\n    // Try to use #rgb format if possible, rather than #rrggbb.\n    if (/^#(.)\\1(.)\\2(.)\\3$/.test(colour)) {\n      colour = '#' + colour[1] + colour[3] + colour[5];\n    }\n    return colour;\n  }\n\n  /**\n   * Set a custom colour grid for this field.\n   *\n   * @param colours Array of colours for this block, or null to use default\n   *     (FieldColour.COLOURS).\n   * @param opt_titles Optional array of colour tooltips, or null to use default\n   *     (FieldColour.TITLES).\n   * @returns Returns itself (for method chaining).\n   */\n  setColours(colours: string[], opt_titles?: string[]): FieldColour {\n    this.colours_ = colours;\n    if (opt_titles) {\n      this.titles_ = opt_titles;\n    }\n    return this;\n  }\n\n  /**\n   * Set a custom grid size for this field.\n   *\n   * @param columns Number of columns for this block, or 0 to use default\n   *     (FieldColour.COLUMNS).\n   * @returns Returns itself (for method chaining).\n   */\n  setColumns(columns: number): FieldColour {\n    this.columns_ = columns;\n    return this;\n  }\n\n  /** Create and show the colour field's editor. */\n  protected override showEditor_() {\n    this.dropdownCreate_();\n    // AnyDuringMigration because:  Argument of type 'Element | null' is not\n    // assignable to parameter of type 'Node'.\n    dropDownDiv.getContentDiv().appendChild(this.picker_ as AnyDuringMigration);\n\n    dropDownDiv.showPositionedByField(this, this.dropdownDispose_.bind(this));\n\n    // Focus so we can start receiving keyboard events.\n    // AnyDuringMigration because:  Property 'focus' does not exist on type\n    // 'Element'.\n    (this.picker_ as AnyDuringMigration)!.focus({preventScroll: true});\n  }\n\n  /**\n   * Handle a click on a colour cell.\n   *\n   * @param e Mouse event.\n   */\n  private onClick_(e: PointerEvent) {\n    const cell = e.target as Element;\n    const colour = cell && cell.getAttribute('data-colour');\n    if (colour !== null) {\n      this.setValue(colour);\n      dropDownDiv.hideIfOwner(this);\n    }\n  }\n\n  /**\n   * Handle a key down event. Navigate around the grid with the\n   * arrow keys. Enter selects the highlighted colour.\n   *\n   * @param e Keyboard event.\n   */\n  private onKeyDown_(e: KeyboardEvent) {\n    let handled = false;\n    if (e.keyCode === KeyCodes.UP) {\n      this.moveHighlightBy_(0, -1);\n      handled = true;\n    } else if (e.keyCode === KeyCodes.DOWN) {\n      this.moveHighlightBy_(0, 1);\n      handled = true;\n    } else if (e.keyCode === KeyCodes.LEFT) {\n      this.moveHighlightBy_(-1, 0);\n      handled = true;\n    } else if (e.keyCode === KeyCodes.RIGHT) {\n      this.moveHighlightBy_(1, 0);\n      handled = true;\n    } else if (e.keyCode === KeyCodes.ENTER) {\n      // Select the highlighted colour.\n      const highlighted = this.getHighlighted_();\n      if (highlighted) {\n        const colour = highlighted && highlighted.getAttribute('data-colour');\n        if (colour !== null) {\n          this.setValue(colour);\n        }\n      }\n      dropDownDiv.hideWithoutAnimation();\n      handled = true;\n    }\n    if (handled) {\n      e.stopPropagation();\n    }\n  }\n\n  /**\n   * Move the currently highlighted position by dx and dy.\n   *\n   * @param dx Change of x\n   * @param dy Change of y\n   */\n  private moveHighlightBy_(dx: number, dy: number) {\n    if (!this.highlightedIndex_) {\n      return;\n    }\n\n    const colours = this.colours_ || FieldColour.COLOURS;\n    const columns = this.columns_ || FieldColour.COLUMNS;\n\n    // Get the current x and y coordinates\n    let x = this.highlightedIndex_ % columns;\n    let y = Math.floor(this.highlightedIndex_ / columns);\n\n    // Add the offset\n    x += dx;\n    y += dy;\n\n    if (dx < 0) {\n      // Move left one grid cell, even in RTL.\n      // Loop back to the end of the previous row if we have room.\n      if (x < 0 && y > 0) {\n        x = columns - 1;\n        y--;\n      } else if (x < 0) {\n        x = 0;\n      }\n    } else if (dx > 0) {\n      // Move right one grid cell, even in RTL.\n      // Loop to the start of the next row, if there's room.\n      if (x > columns - 1 && y < Math.floor(colours.length / columns) - 1) {\n        x = 0;\n        y++;\n      } else if (x > columns - 1) {\n        x--;\n      }\n    } else if (dy < 0) {\n      // Move up one grid cell, stop at the top.\n      if (y < 0) {\n        y = 0;\n      }\n    } else if (dy > 0) {\n      // Move down one grid cell, stop at the bottom.\n      if (y > Math.floor(colours.length / columns) - 1) {\n        y = Math.floor(colours.length / columns) - 1;\n      }\n    }\n\n    // Move the highlight to the new coordinates.\n    const cell = this.picker_!.childNodes[y].childNodes[x] as Element;\n    const index = y * columns + x;\n    this.setHighlightedCell_(cell, index);\n  }\n\n  /**\n   * Handle a mouse move event. Highlight the hovered colour.\n   *\n   * @param e Mouse event.\n   */\n  private onMouseMove_(e: PointerEvent) {\n    const cell = e.target as Element;\n    const index = cell && Number(cell.getAttribute('data-index'));\n    if (index !== null && index !== this.highlightedIndex_) {\n      this.setHighlightedCell_(cell, index);\n    }\n  }\n\n  /** Handle a mouse enter event. Focus the picker. */\n  private onMouseEnter_() {\n    // AnyDuringMigration because:  Property 'focus' does not exist on type\n    // 'Element'.\n    (this.picker_ as AnyDuringMigration)!.focus({preventScroll: true});\n  }\n\n  /**\n   * Handle a mouse leave event. Blur the picker and unhighlight\n   * the currently highlighted colour.\n   */\n  private onMouseLeave_() {\n    // AnyDuringMigration because:  Property 'blur' does not exist on type\n    // 'Element'.\n    (this.picker_ as AnyDuringMigration)!.blur();\n    const highlighted = this.getHighlighted_();\n    if (highlighted) {\n      dom.removeClass(highlighted, 'blocklyColourHighlighted');\n    }\n  }\n\n  /**\n   * Returns the currently highlighted item (if any).\n   *\n   * @returns Highlighted item (null if none).\n   */\n  private getHighlighted_(): HTMLElement|null {\n    if (!this.highlightedIndex_) {\n      return null;\n    }\n\n    const columns = this.columns_ || FieldColour.COLUMNS;\n    const x = this.highlightedIndex_ % columns;\n    const y = Math.floor(this.highlightedIndex_ / columns);\n    const row = this.picker_!.childNodes[y];\n    if (!row) {\n      return null;\n    }\n    const col = row.childNodes[x] as HTMLElement;\n    return col;\n  }\n\n  /**\n   * Update the currently highlighted cell.\n   *\n   * @param cell the new cell to highlight\n   * @param index the index of the new cell\n   */\n  private setHighlightedCell_(cell: Element, index: number) {\n    // Unhighlight the current item.\n    const highlighted = this.getHighlighted_();\n    if (highlighted) {\n      dom.removeClass(highlighted, 'blocklyColourHighlighted');\n    }\n    // Highlight new item.\n    dom.addClass(cell, 'blocklyColourHighlighted');\n    // Set new highlighted index.\n    this.highlightedIndex_ = index;\n\n    // Update accessibility roles.\n    // AnyDuringMigration because:  Argument of type 'string | null' is not\n    // assignable to parameter of type 'string | number | boolean | string[]'.\n    aria.setState(\n        this.picker_ as Element, aria.State.ACTIVEDESCENDANT,\n        cell.getAttribute('id') as AnyDuringMigration);\n  }\n\n  /** Create a colour picker dropdown editor. */\n  private dropdownCreate_() {\n    const columns = this.columns_ || FieldColour.COLUMNS;\n    const colours = this.colours_ || FieldColour.COLOURS;\n    const titles = this.titles_ || FieldColour.TITLES;\n    const selectedColour = this.getValue();\n    // Create the palette.\n    const table = (document.createElement('table'));\n    table.className = 'blocklyColourTable';\n    table.tabIndex = 0;\n    table.dir = 'ltr';\n    aria.setRole(table, aria.Role.GRID);\n    aria.setState(table, aria.State.EXPANDED, true);\n    aria.setState(\n        table, aria.State.ROWCOUNT, Math.floor(colours.length / columns));\n    aria.setState(table, aria.State.COLCOUNT, columns);\n    let row: Element;\n    for (let i = 0; i < colours.length; i++) {\n      if (i % columns === 0) {\n        row = document.createElement('tr');\n        aria.setRole(row, aria.Role.ROW);\n        table.appendChild(row);\n      }\n      const cell = (document.createElement('td'));\n      row!.appendChild(cell);\n      // This becomes the value, if clicked.\n      cell.setAttribute('data-colour', colours[i]);\n      cell.title = titles[i] || colours[i];\n      cell.id = idGenerator.getNextUniqueId();\n      // AnyDuringMigration because:  Argument of type 'number' is not\n      // assignable to parameter of type 'string'.\n      cell.setAttribute('data-index', i as AnyDuringMigration);\n      aria.setRole(cell, aria.Role.GRIDCELL);\n      aria.setState(cell, aria.State.LABEL, colours[i]);\n      aria.setState(cell, aria.State.SELECTED, colours[i] === selectedColour);\n      cell.style.backgroundColor = colours[i];\n      if (colours[i] === selectedColour) {\n        cell.className = 'blocklyColourSelected';\n        this.highlightedIndex_ = i;\n      }\n    }\n\n    // Configure event handler on the table to listen for any event in a cell.\n    this.onClickWrapper_ = browserEvents.conditionalBind(\n        table, 'pointerdown', this, this.onClick_, true);\n    this.onMouseMoveWrapper_ = browserEvents.conditionalBind(\n        table, 'pointermove', this, this.onMouseMove_, true);\n    this.onMouseEnterWrapper_ = browserEvents.conditionalBind(\n        table, 'pointerenter', this, this.onMouseEnter_, true);\n    this.onMouseLeaveWrapper_ = browserEvents.conditionalBind(\n        table, 'pointerleave', this, this.onMouseLeave_, true);\n    this.onKeyDownWrapper_ =\n        browserEvents.conditionalBind(table, 'keydown', this, this.onKeyDown_);\n\n    this.picker_ = table;\n  }\n\n  /** Disposes of events and DOM-references belonging to the colour editor. */\n  private dropdownDispose_() {\n    if (this.onClickWrapper_) {\n      browserEvents.unbind(this.onClickWrapper_);\n      this.onClickWrapper_ = null;\n    }\n    if (this.onMouseMoveWrapper_) {\n      browserEvents.unbind(this.onMouseMoveWrapper_);\n      this.onMouseMoveWrapper_ = null;\n    }\n    if (this.onMouseEnterWrapper_) {\n      browserEvents.unbind(this.onMouseEnterWrapper_);\n      this.onMouseEnterWrapper_ = null;\n    }\n    if (this.onMouseLeaveWrapper_) {\n      browserEvents.unbind(this.onMouseLeaveWrapper_);\n      this.onMouseLeaveWrapper_ = null;\n    }\n    if (this.onKeyDownWrapper_) {\n      browserEvents.unbind(this.onKeyDownWrapper_);\n      this.onKeyDownWrapper_ = null;\n    }\n    this.picker_ = null;\n    this.highlightedIndex_ = null;\n  }\n\n  /**\n   * Construct a FieldColour from a JSON arg object.\n   *\n   * @param options A JSON object with options (colour).\n   * @returns The new field instance.\n   * @nocollapse\n   * @internal\n   */\n  static fromJson(options: FieldColourFromJsonConfig): FieldColour {\n    // `this` might be a subclass of FieldColour if that class doesn't override\n    // the static fromJson method.\n    return new this(options['colour'], undefined, options);\n  }\n}\n\n/** The default value for this field. */\nFieldColour.prototype.DEFAULT_VALUE = FieldColour.COLOURS[0];\n\n/** CSS for colour picker.  See css.js for use. */\nCss.register(`\n.blocklyColourTable {\n  border-collapse: collapse;\n  display: block;\n  outline: none;\n  padding: 1px;\n}\n\n.blocklyColourTable>tr>td {\n  border: .5px solid #888;\n  box-sizing: border-box;\n  cursor: pointer;\n  display: inline-block;\n  height: 20px;\n  padding: 0;\n  width: 20px;\n}\n\n.blocklyColourTable>tr>td.blocklyColourHighlighted {\n  border-color: #eee;\n  box-shadow: 2px 2px 7px 2px rgba(0,0,0,.3);\n  position: relative;\n}\n\n.blocklyColourSelected, .blocklyColourSelected:hover {\n  border-color: #eee !important;\n  outline: 1px solid #333;\n  position: relative;\n}\n`);\n\nfieldRegistry.register('field_colour', FieldColour);\n\n/**\n * Config options for the colour field.\n */\nexport interface FieldColourConfig extends FieldConfig {\n  colourOptions?: string[];\n  colourTitles?: string[];\n  columns?: number;\n}\n\n/**\n * fromJson config options for the colour field.\n */\nexport interface FieldColourFromJsonConfig extends FieldColourConfig {\n  colour?: string;\n}\n","/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Checkbox field.  Checked or not checked.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.FieldCheckbox');\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_change.js';\n\nimport * as dom from './utils/dom.js';\nimport {Field, FieldConfig, FieldValidator} from './field.js';\nimport * as fieldRegistry from './field_registry.js';\nimport type {Sentinel} from './utils/sentinel.js';\n\nexport type FieldCheckboxValidator = FieldValidator<boolean>;\n\n/**\n * Class for a checkbox field.\n *\n * @alias Blockly.FieldCheckbox\n */\nexport class FieldCheckbox extends Field<boolean> {\n  /** Default character for the checkmark. */\n  static readonly CHECK_CHAR = '';\n  private checkChar_: string;\n\n  /**\n   * Serializable fields are saved by the serializer, non-serializable fields\n   * are not. Editable fields should also be serializable.\n   */\n  override SERIALIZABLE = true;\n\n  /**\n   * Mouse cursor style when over the hotspot that initiates editability.\n   */\n  override CURSOR = 'default';\n  override value_: AnyDuringMigration;\n\n  /**\n   * @param opt_value The initial value of the field. Should either be 'TRUE',\n   *     'FALSE' or a boolean. Defaults to 'FALSE'. Also accepts\n   *     Field.SKIP_SETUP if you wish to skip setup (only used by subclasses\n   *     that want to handle configuration and setting the field value after\n   *     their own constructors have run).\n   * @param opt_validator  A function that is called to validate changes to the\n   *     field's value. Takes in a value ('TRUE' or 'FALSE') & returns a\n   *     validated value ('TRUE' or 'FALSE'), or null to abort the change.\n   * @param opt_config A map of options used to configure the field.\n   *     See the [field creation documentation]{@link\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/checkbox#creation}\n   * for a list of properties this parameter supports.\n   */\n  constructor(\n      opt_value?: string|boolean|Sentinel,\n      opt_validator?: FieldCheckboxValidator,\n      opt_config?: FieldCheckboxConfig) {\n    super(Field.SKIP_SETUP);\n\n    /**\n     * Character for the check mark. Used to apply a different check mark\n     * character to individual fields.\n     */\n    this.checkChar_ = FieldCheckbox.CHECK_CHAR;\n\n    if (opt_value === Field.SKIP_SETUP) {\n      return;\n    }\n    if (opt_config) {\n      this.configure_(opt_config);\n    }\n    this.setValue(opt_value);\n    if (opt_validator) {\n      this.setValidator(opt_validator);\n    }\n  }\n\n  /**\n   * Configure the field based on the given map of options.\n   *\n   * @param config A map of options to configure the field based on.\n   */\n  protected override configure_(config: FieldCheckboxConfig) {\n    super.configure_(config);\n    if (config.checkCharacter) this.checkChar_ = config.checkCharacter;\n  }\n\n  /**\n   * Saves this field's value.\n   *\n   * @returns The boolean value held by this field.\n   * @internal\n   */\n  override saveState(): AnyDuringMigration {\n    const legacyState = this.saveLegacyState(FieldCheckbox);\n    if (legacyState !== null) {\n      return legacyState;\n    }\n    return this.getValueBoolean();\n  }\n\n  /**\n   * Create the block UI for this checkbox.\n   *\n   * @internal\n   */\n  override initView() {\n    super.initView();\n\n    const textElement = this.getTextElement();\n    dom.addClass(textElement, 'blocklyCheckbox');\n    textElement.style.display = this.value_ ? 'block' : 'none';\n  }\n\n  override render_() {\n    if (this.textContent_) {\n      this.textContent_.nodeValue = this.getDisplayText_();\n    }\n    this.updateSize_(this.getConstants()!.FIELD_CHECKBOX_X_OFFSET);\n  }\n\n  override getDisplayText_() {\n    return this.checkChar_;\n  }\n\n  /**\n   * Set the character used for the check mark.\n   *\n   * @param character The character to use for the check mark, or null to use\n   *     the default.\n   */\n  setCheckCharacter(character: string|null) {\n    this.checkChar_ = character || FieldCheckbox.CHECK_CHAR;\n    this.forceRerender();\n  }\n\n  /** Toggle the state of the checkbox on click. */\n  protected override showEditor_() {\n    this.setValue(!this.value_);\n  }\n\n  /**\n   * Ensure that the input value is valid ('TRUE' or 'FALSE').\n   *\n   * @param opt_newValue The input value.\n   * @returns A valid value ('TRUE' or 'FALSE), or null if invalid.\n   */\n  protected override doClassValidation_(opt_newValue?: AnyDuringMigration):\n      string|null {\n    if (opt_newValue === true || opt_newValue === 'TRUE') {\n      return 'TRUE';\n    }\n    if (opt_newValue === false || opt_newValue === 'FALSE') {\n      return 'FALSE';\n    }\n    return null;\n  }\n\n  /**\n   * Update the value of the field, and update the checkElement.\n   *\n   * @param newValue The value to be saved. The default validator guarantees\n   *     that this is a either 'TRUE' or 'FALSE'.\n   */\n  protected override doValueUpdate_(newValue: AnyDuringMigration) {\n    this.value_ = this.convertValueToBool_(newValue);\n    // Update visual.\n    if (this.textElement_) {\n      this.textElement_.style.display = this.value_ ? 'block' : 'none';\n    }\n  }\n\n  /**\n   * Get the value of this field, either 'TRUE' or 'FALSE'.\n   *\n   * @returns The value of this field.\n   */\n  override getValue(): string {\n    return this.value_ ? 'TRUE' : 'FALSE';\n  }\n\n  /**\n   * Get the boolean value of this field.\n   *\n   * @returns The boolean value of this field.\n   */\n  getValueBoolean(): boolean {\n    return this.value_ as boolean;\n  }\n\n  /**\n   * Get the text of this field. Used when the block is collapsed.\n   *\n   * @returns Text representing the value of this field ('true' or 'false').\n   */\n  override getText(): string {\n    return String(this.convertValueToBool_(this.value_));\n  }\n\n  /**\n   * Convert a value into a pure boolean.\n   *\n   * Converts 'TRUE' to true and 'FALSE' to false correctly, everything else\n   * is cast to a boolean.\n   *\n   * @param value The value to convert.\n   * @returns The converted value.\n   */\n  private convertValueToBool_(value: AnyDuringMigration): boolean {\n    if (typeof value === 'string') {\n      return value === 'TRUE';\n    } else {\n      return !!value;\n    }\n  }\n\n  /**\n   * Construct a FieldCheckbox from a JSON arg object.\n   *\n   * @param options A JSON object with options (checked).\n   * @returns The new field instance.\n   * @nocollapse\n   * @internal\n   */\n  static fromJson(options: FieldCheckboxFromJsonConfig): FieldCheckbox {\n    // `this` might be a subclass of FieldCheckbox if that class doesn't\n    // 'override' the static fromJson method.\n    return new this(options.checked, undefined, options);\n  }\n}\n\nfieldRegistry.register('field_checkbox', FieldCheckbox);\n\nFieldCheckbox.prototype.DEFAULT_VALUE = false;\n\n/**\n * Config options for the checkbox field.\n */\nexport interface FieldCheckboxConfig extends FieldConfig {\n  checkCharacter?: string;\n}\n\n/**\n * fromJson config options for the checkbox field.\n */\nexport interface FieldCheckboxFromJsonConfig extends FieldCheckboxConfig {\n  checked?: boolean;\n}\n","/**\n * @license\n * Copyright 2013 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Angle input field.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.FieldAngle');\n\nimport {BlockSvg} from './block_svg.js';\nimport * as browserEvents from './browser_events.js';\nimport * as Css from './css.js';\nimport * as dropDownDiv from './dropdowndiv.js';\nimport {Field, UnattachedFieldError} from './field.js';\nimport * as fieldRegistry from './field_registry.js';\nimport {FieldInput, FieldInputConfig, FieldInputValidator} from './field_input.js';\nimport * as dom from './utils/dom.js';\nimport {KeyCodes} from './utils/keycodes.js';\nimport * as math from './utils/math.js';\nimport type {Sentinel} from './utils/sentinel.js';\nimport {Svg} from './utils/svg.js';\nimport * as userAgent from './utils/useragent.js';\nimport * as WidgetDiv from './widgetdiv.js';\n\nexport type FieldAngleValidator = FieldInputValidator<number>;\n\n/**\n * Class for an editable angle field.\n *\n * @alias Blockly.FieldAngle\n */\nexport class FieldAngle extends FieldInput<number> {\n  /**\n   * The default amount to round angles to when using a mouse or keyboard nav\n   * input. Must be a positive integer to support keyboard navigation.\n   */\n  static readonly ROUND = 15;\n\n  /** Half the width of protractor image. */\n  static readonly HALF = 100 / 2;\n\n  /**\n   * Default property describing which direction makes an angle field's value\n   * increase. Angle increases clockwise (true) or counterclockwise (false).\n   */\n  static readonly CLOCKWISE = false;\n\n  /**\n   * The default offset of 0 degrees (and all angles). Always offsets in the\n   * counterclockwise direction, regardless of the field's clockwise property.\n   * Usually either 0 (0 = right) or 90 (0 = up).\n   */\n  static readonly OFFSET = 0;\n\n  /**\n   * The default maximum angle to allow before wrapping.\n   * Usually either 360 (for 0 to 359.9) or 180 (for -179.9 to 180).\n   */\n  static readonly WRAP = 360;\n\n  /**\n   * Radius of protractor circle.  Slightly smaller than protractor size since\n   * otherwise SVG crops off half the border at the edges.\n   */\n  static readonly RADIUS: number = FieldAngle.HALF - 1;\n\n  /**\n   * Whether the angle should increase as the angle picker is moved clockwise\n   * (true) or counterclockwise (false).\n   */\n  private clockwise_ = FieldAngle.CLOCKWISE;\n\n  /**\n   * The offset of zero degrees (and all other angles).\n   */\n  private offset_ = FieldAngle.OFFSET;\n\n  /**\n   * The maximum angle to allow before wrapping.\n   */\n  private wrap_ = FieldAngle.WRAP;\n\n  /**\n   * The amount to round angles to when using a mouse or keyboard nav input.\n   */\n  private round_ = FieldAngle.ROUND;\n\n  /** The angle picker's SVG element. */\n  private editor_: SVGSVGElement|null = null;\n\n  /** The angle picker's gauge path depending on the value. */\n  gauge_: SVGPathElement|null = null;\n\n  /** The angle picker's line drawn representing the value's angle. */\n  line_: SVGLineElement|null = null;\n\n  /** The degree symbol for this field. */\n  // AnyDuringMigration because:  Type 'null' is not assignable to type\n  // 'SVGTSpanElement'.\n  protected symbol_: SVGTSpanElement = null as AnyDuringMigration;\n\n  /** Wrapper click event data. */\n  private clickWrapper_: browserEvents.Data|null = null;\n\n  /** Surface click event data. */\n  private clickSurfaceWrapper_: browserEvents.Data|null = null;\n\n  /** Surface mouse move event data. */\n  private moveSurfaceWrapper_: browserEvents.Data|null = null;\n\n  /**\n   * Serializable fields are saved by the serializer, non-serializable fields\n   * are not. Editable fields should also be serializable.\n   */\n  override SERIALIZABLE = true;\n\n  /**\n   * @param opt_value The initial value of the field. Should cast to a number.\n   *     Defaults to 0. Also accepts Field.SKIP_SETUP if you wish to skip setup\n   *     (only used by subclasses that want to handle configuration and setting\n   *     the field value after their own constructors have run).\n   * @param opt_validator A function that is called to validate changes to the\n   *     field's value. Takes in a number & returns a validated number, or null\n   *     to abort the change.\n   * @param opt_config A map of options used to configure the field.\n   *     See the [field creation documentation]{@link\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/angle#creation}\n   * for a list of properties this parameter supports.\n   */\n  constructor(\n      opt_value?: string|number|Sentinel, opt_validator?: FieldAngleValidator,\n      opt_config?: FieldAngleConfig) {\n    super(Field.SKIP_SETUP);\n\n    if (opt_value === Field.SKIP_SETUP) {\n      return;\n    }\n    if (opt_config) {\n      this.configure_(opt_config);\n    }\n    this.setValue(opt_value);\n    if (opt_validator) {\n      this.setValidator(opt_validator);\n    }\n  }\n\n  /**\n   * Configure the field based on the given map of options.\n   *\n   * @param config A map of options to configure the field based on.\n   */\n  protected override configure_(config: FieldAngleConfig) {\n    super.configure_(config);\n\n    switch (config.mode) {\n      case Mode.COMPASS:\n        this.clockwise_ = true;\n        this.offset_ = 90;\n        break;\n      case Mode.PROTRACTOR:\n        // This is the default mode, so we could do nothing. But just to\n        // future-proof, we'll set it anyway.\n        this.clockwise_ = false;\n        this.offset_ = 0;\n        break;\n    }\n\n    // Allow individual settings to override the mode setting.\n    if (config.clockwise) this.clockwise_ = config.clockwise;\n    if (config.offset) this.offset_ = config.offset;\n    if (config.wrap) this.wrap_ = config.wrap;\n    if (config.round) this.round_ = config.round;\n  }\n\n  /**\n   * Create the block UI for this field.\n   *\n   * @internal\n   */\n  override initView() {\n    super.initView();\n    // Add the degree symbol to the left of the number, even in RTL (issue\n    // #2380)\n    this.symbol_ = dom.createSvgElement(Svg.TSPAN, {});\n    this.symbol_.appendChild(document.createTextNode(''));\n    this.getTextElement().appendChild(this.symbol_);\n  }\n\n  /** Updates the graph when the field rerenders. */\n  protected override render_() {\n    super.render_();\n    this.updateGraph_();\n  }\n\n  /**\n   * Create and show the angle field's editor.\n   *\n   * @param opt_e Optional mouse event that triggered the field to open, or\n   *     undefined if triggered programmatically.\n   */\n  protected override showEditor_(opt_e?: Event) {\n    // Mobile browsers have issues with in-line textareas (focus & keyboards).\n    const noFocus = userAgent.MOBILE || userAgent.ANDROID || userAgent.IPAD;\n    super.showEditor_(opt_e, noFocus);\n\n    this.dropdownCreate_();\n    dropDownDiv.getContentDiv().appendChild(this.editor_!);\n\n    if (this.sourceBlock_ instanceof BlockSvg) {\n      dropDownDiv.setColour(\n          this.sourceBlock_.style.colourPrimary,\n          this.sourceBlock_.style.colourTertiary);\n    }\n\n    // AnyDuringMigration because:  Argument of type 'this' is not assignable to\n    // parameter of type 'Field'.\n    dropDownDiv.showPositionedByField(\n        this as AnyDuringMigration, this.dropdownDispose_.bind(this));\n\n    this.updateGraph_();\n  }\n\n  /** Create the angle dropdown editor. */\n  private dropdownCreate_() {\n    const svg = dom.createSvgElement(Svg.SVG, {\n      'xmlns': dom.SVG_NS,\n      'xmlns:html': dom.HTML_NS,\n      'xmlns:xlink': dom.XLINK_NS,\n      'version': '1.1',\n      'height': FieldAngle.HALF * 2 + 'px',\n      'width': FieldAngle.HALF * 2 + 'px',\n      'style': 'touch-action: none',\n    });\n    const circle = dom.createSvgElement(\n        Svg.CIRCLE, {\n          'cx': FieldAngle.HALF,\n          'cy': FieldAngle.HALF,\n          'r': FieldAngle.RADIUS,\n          'class': 'blocklyAngleCircle',\n        },\n        svg);\n    this.gauge_ =\n        dom.createSvgElement(Svg.PATH, {'class': 'blocklyAngleGauge'}, svg);\n    this.line_ = dom.createSvgElement(\n        Svg.LINE, {\n          'x1': FieldAngle.HALF,\n          'y1': FieldAngle.HALF,\n          'class': 'blocklyAngleLine',\n        },\n        svg);\n    // Draw markers around the edge.\n    for (let angle = 0; angle < 360; angle += 15) {\n      dom.createSvgElement(\n          Svg.LINE, {\n            'x1': FieldAngle.HALF + FieldAngle.RADIUS,\n            'y1': FieldAngle.HALF,\n            'x2': FieldAngle.HALF + FieldAngle.RADIUS -\n                (angle % 45 === 0 ? 10 : 5),\n            'y2': FieldAngle.HALF,\n            'class': 'blocklyAngleMarks',\n            'transform': 'rotate(' + angle + ',' + FieldAngle.HALF + ',' +\n                FieldAngle.HALF + ')',\n          },\n          svg);\n    }\n\n    // The angle picker is different from other fields in that it updates on\n    // mousemove even if it's not in the middle of a drag.  In future we may\n    // change this behaviour.\n    this.clickWrapper_ =\n        browserEvents.conditionalBind(svg, 'click', this, this.hide_);\n    // On touch devices, the picker's value is only updated with a drag. Add\n    // a click handler on the drag surface to update the value if the surface\n    // is clicked.\n    this.clickSurfaceWrapper_ = browserEvents.conditionalBind(\n        circle, 'pointerdown', this, this.onMouseMove_, true);\n    this.moveSurfaceWrapper_ = browserEvents.conditionalBind(\n        circle, 'pointermove', this, this.onMouseMove_, true);\n    this.editor_ = svg;\n  }\n\n  /** Disposes of events and DOM-references belonging to the angle editor. */\n  private dropdownDispose_() {\n    if (this.clickWrapper_) {\n      browserEvents.unbind(this.clickWrapper_);\n      this.clickWrapper_ = null;\n    }\n    if (this.clickSurfaceWrapper_) {\n      browserEvents.unbind(this.clickSurfaceWrapper_);\n      this.clickSurfaceWrapper_ = null;\n    }\n    if (this.moveSurfaceWrapper_) {\n      browserEvents.unbind(this.moveSurfaceWrapper_);\n      this.moveSurfaceWrapper_ = null;\n    }\n    this.gauge_ = null;\n    this.line_ = null;\n  }\n\n  /** Hide the editor. */\n  private hide_() {\n    dropDownDiv.hideIfOwner(this);\n    WidgetDiv.hide();\n  }\n\n  /**\n   * Set the angle to match the mouse's position.\n   *\n   * @param e Mouse move event.\n   */\n  protected onMouseMove_(e: PointerEvent) {\n    // Calculate angle.\n    const bBox = this.gauge_!.ownerSVGElement!.getBoundingClientRect();\n    const dx = e.clientX - bBox.left - FieldAngle.HALF;\n    const dy = e.clientY - bBox.top - FieldAngle.HALF;\n    let angle = Math.atan(-dy / dx);\n    if (isNaN(angle)) {\n      // This shouldn't happen, but let's not let this error propagate further.\n      return;\n    }\n    angle = math.toDegrees(angle);\n    // 0: East, 90: North, 180: West, 270: South.\n    if (dx < 0) {\n      angle += 180;\n    } else if (dy > 0) {\n      angle += 360;\n    }\n\n    // Do offsetting.\n    if (this.clockwise_) {\n      angle = this.offset_ + 360 - angle;\n    } else {\n      angle = 360 - (this.offset_ - angle);\n    }\n\n    this.displayMouseOrKeyboardValue_(angle);\n  }\n\n  /**\n   * Handles and displays values that are input via mouse or arrow key input.\n   * These values need to be rounded and wrapped before being displayed so\n   * that the text input's value is appropriate.\n   *\n   * @param angle New angle.\n   */\n  private displayMouseOrKeyboardValue_(angle: number) {\n    if (this.round_) {\n      angle = Math.round(angle / this.round_) * this.round_;\n    }\n    angle = this.wrapValue_(angle);\n    if (angle !== this.value_) {\n      this.setEditorValue_(angle);\n    }\n  }\n\n  /** Redraw the graph with the current angle. */\n  private updateGraph_() {\n    if (!this.gauge_) {\n      return;\n    }\n    // Always display the input (i.e. getText) even if it is invalid.\n    let angleDegrees = Number(this.getText()) + this.offset_;\n    angleDegrees %= 360;\n    let angleRadians = math.toRadians(angleDegrees);\n    const path = ['M ', FieldAngle.HALF, ',', FieldAngle.HALF];\n    let x2 = FieldAngle.HALF;\n    let y2 = FieldAngle.HALF;\n    if (!isNaN(angleRadians)) {\n      const clockwiseFlag = Number(this.clockwise_);\n      const angle1 = math.toRadians(this.offset_);\n      const x1 = Math.cos(angle1) * FieldAngle.RADIUS;\n      const y1 = Math.sin(angle1) * -FieldAngle.RADIUS;\n      if (clockwiseFlag) {\n        angleRadians = 2 * angle1 - angleRadians;\n      }\n      x2 += Math.cos(angleRadians) * FieldAngle.RADIUS;\n      y2 -= Math.sin(angleRadians) * FieldAngle.RADIUS;\n      // Don't ask how the flag calculations work.  They just do.\n      let largeFlag =\n          Math.abs(Math.floor((angleRadians - angle1) / Math.PI) % 2);\n      if (clockwiseFlag) {\n        largeFlag = 1 - largeFlag;\n      }\n      path.push(\n          ' l ', x1, ',', y1, ' A ', FieldAngle.RADIUS, ',', FieldAngle.RADIUS,\n          ' 0 ', largeFlag, ' ', clockwiseFlag, ' ', x2, ',', y2, ' z');\n    }\n    this.gauge_.setAttribute('d', path.join(''));\n    // AnyDuringMigration because:  Argument of type 'number' is not assignable\n    // to parameter of type 'string'.\n    this.line_!.setAttribute('x2', x2 as AnyDuringMigration);\n    // AnyDuringMigration because:  Argument of type 'number' is not assignable\n    // to parameter of type 'string'.\n    this.line_!.setAttribute('y2', y2 as AnyDuringMigration);\n  }\n\n  /**\n   * Handle key down to the editor.\n   *\n   * @param e Keyboard event.\n   */\n  protected override onHtmlInputKeyDown_(e: Event) {\n    super.onHtmlInputKeyDown_(e);\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n\n    const keyboardEvent = e as KeyboardEvent;\n    let multiplier;\n    if (keyboardEvent.keyCode === KeyCodes.LEFT) {\n      // decrement (increment in RTL)\n      multiplier = block.RTL ? 1 : -1;\n    } else if (keyboardEvent.keyCode === KeyCodes.RIGHT) {\n      // increment (decrement in RTL)\n      multiplier = block.RTL ? -1 : 1;\n    } else if (keyboardEvent.keyCode === KeyCodes.DOWN) {\n      // decrement\n      multiplier = -1;\n    } else if (keyboardEvent.keyCode === KeyCodes.UP) {\n      // increment\n      multiplier = 1;\n    }\n    if (multiplier) {\n      const value = this.getValue() as number;\n      this.displayMouseOrKeyboardValue_(value + multiplier * this.round_);\n      e.preventDefault();\n      e.stopPropagation();\n    }\n  }\n\n  /**\n   * Ensure that the input value is a valid angle.\n   *\n   * @param opt_newValue The input value.\n   * @returns A valid angle, or null if invalid.\n   */\n  protected override doClassValidation_(opt_newValue?: AnyDuringMigration):\n      number|null {\n    const value = Number(opt_newValue);\n    if (isNaN(value) || !isFinite(value)) {\n      return null;\n    }\n    return this.wrapValue_(value);\n  }\n\n  /**\n   * Wraps the value so that it is in the range (-360 + wrap, wrap).\n   *\n   * @param value The value to wrap.\n   * @returns The wrapped value.\n   */\n  private wrapValue_(value: number): number {\n    value %= 360;\n    if (value < 0) {\n      value += 360;\n    }\n    if (value > this.wrap_) {\n      value -= 360;\n    }\n    return value;\n  }\n\n  /**\n   * Construct a FieldAngle from a JSON arg object.\n   *\n   * @param options A JSON object with options (angle).\n   * @returns The new field instance.\n   * @nocollapse\n   * @internal\n   */\n  static fromJson(options: FieldAngleFromJsonConfig): FieldAngle {\n    // `this` might be a subclass of FieldAngle if that class doesn't override\n    // the static fromJson method.\n    return new this(options.angle, undefined, options);\n  }\n}\n\n/** CSS for angle field.  See css.js for use. */\nCss.register(`\n.blocklyAngleCircle {\n  stroke: #444;\n  stroke-width: 1;\n  fill: #ddd;\n  fill-opacity: .8;\n}\n\n.blocklyAngleMarks {\n  stroke: #444;\n  stroke-width: 1;\n}\n\n.blocklyAngleGauge {\n  fill: #f88;\n  fill-opacity: .8;\n  pointer-events: none;\n}\n\n.blocklyAngleLine {\n  stroke: #f00;\n  stroke-width: 2;\n  stroke-linecap: round;\n  pointer-events: none;\n}\n`);\n\nfieldRegistry.register('field_angle', FieldAngle);\n\nFieldAngle.prototype.DEFAULT_VALUE = 0;\n\n/**\n * The two main modes of the angle field.\n * Compass specifies:\n *   - clockwise: true\n *   - offset: 90\n *   - wrap: 0\n *   - round: 15\n *\n * Protractor specifies:\n *   - clockwise: false\n *   - offset: 0\n *   - wrap: 0\n *   - round: 15\n */\nexport enum Mode {\n  COMPASS = 'compass',\n  PROTRACTOR = 'protractor',\n}\n\n/**\n * Extra configuration options for the angle field.\n */\nexport interface FieldAngleConfig extends FieldInputConfig {\n  mode?: Mode;\n  clockwise?: boolean;\n  offset?: number;\n  wrap?: number;\n  round?: number;\n}\n\n/**\n * fromJson configuration options for the angle field.\n */\nexport interface FieldAngleFromJsonConfig extends FieldAngleConfig {\n  angle?: number;\n}\n","/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for a block move event.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events.BlockMove');\n\nimport type {Block} from '../block.js';\nimport {ConnectionType} from '../connection_type.js';\nimport * as deprecation from '../utils/deprecation.js';\nimport * as registry from '../registry.js';\nimport {Coordinate} from '../utils/coordinate.js';\n\nimport {BlockBase, BlockBaseJson} from './events_block_base.js';\nimport * as eventUtils from './utils.js';\nimport type {Workspace} from '../workspace.js';\n\n\ninterface BlockLocation {\n  parentId?: string;\n  inputName?: string;\n  coordinate?: Coordinate;\n}\n\n/**\n * Class for a block move event.  Created before the move.\n *\n * @alias Blockly.Events.BlockMove\n */\nexport class BlockMove extends BlockBase {\n  override type = eventUtils.BLOCK_MOVE;\n  oldParentId?: string;\n  oldInputName?: string;\n  oldCoordinate?: Coordinate;\n\n  newParentId?: string;\n  newInputName?: string;\n  newCoordinate?: Coordinate;\n\n  /** @param opt_block The moved block.  Undefined for a blank event. */\n  constructor(opt_block?: Block) {\n    super(opt_block);\n\n    if (!opt_block) {\n      return;\n    }\n    // Blank event to be populated by fromJson.\n    if (opt_block.isShadow()) {\n      // Moving shadow blocks is handled via disconnection.\n      this.recordUndo = false;\n    }\n\n    const location = this.currentLocation_();\n    this.oldParentId = location.parentId;\n    this.oldInputName = location.inputName;\n    this.oldCoordinate = location.coordinate;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): BlockMoveJson {\n    const json = super.toJson() as BlockMoveJson;\n    json['oldParentId'] = this.oldParentId;\n    json['oldInputName'] = this.oldInputName;\n    if (this.oldCoordinate) {\n      json['oldCoordinate'] = `${Math.round(this.oldCoordinate.x)}, ` +\n          `${Math.round(this.oldCoordinate.y)}`;\n    }\n    json['newParentId'] = this.newParentId;\n    json['newInputName'] = this.newInputName;\n    if (this.newCoordinate) {\n      json['newCoordinate'] = `${Math.round(this.newCoordinate.x)}, ` +\n          `${Math.round(this.newCoordinate.y)}`;\n    }\n    if (!this.recordUndo) {\n      json['recordUndo'] = this.recordUndo;\n    }\n    return json;\n  }\n\n  /**\n   * Decode the JSON event.\n   *\n   * @param json JSON representation.\n   */\n  override fromJson(json: BlockMoveJson) {\n    deprecation.warn(\n        'Blockly.Events.BlockMove.prototype.fromJson', 'version 9',\n        'version 10', 'Blockly.Events.fromJson');\n    super.fromJson(json);\n    this.oldParentId = json['oldParentId'];\n    this.oldInputName = json['oldInputName'];\n    if (json['oldCoordinate']) {\n      const xy = json['oldCoordinate'].split(',');\n      this.oldCoordinate = new Coordinate(Number(xy[0]), Number(xy[1]));\n    }\n    this.newParentId = json['newParentId'];\n    this.newInputName = json['newInputName'];\n    if (json['newCoordinate']) {\n      const xy = json['newCoordinate'].split(',');\n      this.newCoordinate = new Coordinate(Number(xy[0]), Number(xy[1]));\n    }\n    if (json['recordUndo'] !== undefined) {\n      this.recordUndo = json['recordUndo'];\n    }\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of BlockMove, but we can't specify that due to the fact that parameters\n   *     to static methods in subclasses must be supertypes of parameters to\n   *     static methods in superclasses.\n   * @internal\n   */\n  static fromJson(json: BlockMoveJson, workspace: Workspace, event?: any):\n      BlockMove {\n    const newEvent =\n        super.fromJson(json, workspace, event ?? new BlockMove()) as BlockMove;\n    newEvent.oldParentId = json['oldParentId'];\n    newEvent.oldInputName = json['oldInputName'];\n    if (json['oldCoordinate']) {\n      const xy = json['oldCoordinate'].split(',');\n      newEvent.oldCoordinate = new Coordinate(Number(xy[0]), Number(xy[1]));\n    }\n    newEvent.newParentId = json['newParentId'];\n    newEvent.newInputName = json['newInputName'];\n    if (json['newCoordinate']) {\n      const xy = json['newCoordinate'].split(',');\n      newEvent.newCoordinate = new Coordinate(Number(xy[0]), Number(xy[1]));\n    }\n    if (json['recordUndo'] !== undefined) {\n      newEvent.recordUndo = json['recordUndo'];\n    }\n    return newEvent;\n  }\n\n  /** Record the block's new location.  Called after the move. */\n  recordNew() {\n    const location = this.currentLocation_();\n    this.newParentId = location.parentId;\n    this.newInputName = location.inputName;\n    this.newCoordinate = location.coordinate;\n  }\n\n  /**\n   * Returns the parentId and input if the block is connected,\n   *   or the XY location if disconnected.\n   *\n   * @returns Collection of location info.\n   */\n  private currentLocation_(): BlockLocation {\n    const workspace = this.getEventWorkspace_();\n    if (!this.blockId) {\n      throw new Error(\n          'The block ID is undefined. Either pass a block to ' +\n          'the constructor, or call fromJson');\n    }\n    const block = workspace.getBlockById(this.blockId);\n    if (!block) {\n      throw new Error(\n          'The block associated with the block move event ' +\n          'could not be found');\n    }\n    const location = {} as BlockLocation;\n    const parent = block.getParent();\n    if (parent) {\n      location.parentId = parent.id;\n      const input = parent.getInputWithBlock(block);\n      if (input) {\n        location.inputName = input.name;\n      }\n    } else {\n      location.coordinate = block.getRelativeToSurfaceXY();\n    }\n    return location;\n  }\n\n  /**\n   * Does this event record any change of state?\n   *\n   * @returns False if something changed.\n   */\n  override isNull(): boolean {\n    return this.oldParentId === this.newParentId &&\n        this.oldInputName === this.newInputName &&\n        Coordinate.equals(this.oldCoordinate, this.newCoordinate);\n  }\n\n  /**\n   * Run a move event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    const workspace = this.getEventWorkspace_();\n    if (!this.blockId) {\n      throw new Error(\n          'The block ID is undefined. Either pass a block to ' +\n          'the constructor, or call fromJson');\n    }\n    const block = workspace.getBlockById(this.blockId);\n    if (!block) {\n      console.warn('Can\\'t move non-existent block: ' + this.blockId);\n      return;\n    }\n    const parentId = forward ? this.newParentId : this.oldParentId;\n    const inputName = forward ? this.newInputName : this.oldInputName;\n    const coordinate = forward ? this.newCoordinate : this.oldCoordinate;\n    let parentBlock: Block|null;\n    if (parentId) {\n      parentBlock = workspace.getBlockById(parentId);\n      if (!parentBlock) {\n        console.warn('Can\\'t connect to non-existent block: ' + parentId);\n        return;\n      }\n    }\n    if (block.getParent()) {\n      block.unplug();\n    }\n    if (coordinate) {\n      const xy = block.getRelativeToSurfaceXY();\n      block.moveBy(coordinate.x - xy.x, coordinate.y - xy.y);\n    } else {\n      let blockConnection = block.outputConnection;\n      if (!blockConnection ||\n          block.previousConnection && block.previousConnection.isConnected()) {\n        blockConnection = block.previousConnection;\n      }\n      let parentConnection;\n      const connectionType = blockConnection.type;\n      if (inputName) {\n        const input = parentBlock!.getInput(inputName);\n        if (input) {\n          parentConnection = input.connection;\n        }\n      } else if (connectionType === ConnectionType.PREVIOUS_STATEMENT) {\n        parentConnection = parentBlock!.nextConnection;\n      }\n      if (parentConnection) {\n        blockConnection.connect(parentConnection);\n      } else {\n        console.warn('Can\\'t connect to non-existent input: ' + inputName);\n      }\n    }\n  }\n}\n\nexport interface BlockMoveJson extends BlockBaseJson {\n  oldParentId?: string;\n  oldInputName?: string;\n  oldCoordinate?: string;\n  newParentId?: string;\n  newInputName?: string;\n  newCoordinate?: string;\n  recordUndo?: boolean;\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.MOVE, BlockMove);\n","/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Base class for comment events.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events.CommentBase');\n\nimport * as deprecation from '../utils/deprecation.js';\nimport * as utilsXml from '../utils/xml.js';\nimport type {WorkspaceComment} from '../workspace_comment.js';\nimport * as Xml from '../xml.js';\n\nimport {Abstract as AbstractEvent, AbstractEventJson} from './events_abstract.js';\nimport type {CommentCreate} from './events_comment_create.js';\nimport type {CommentDelete} from './events_comment_delete.js';\nimport * as eventUtils from './utils.js';\nimport type {Workspace} from '../workspace.js';\n\n\n/**\n * Abstract class for a comment event.\n *\n * @alias Blockly.Events.CommentBase\n */\nexport class CommentBase extends AbstractEvent {\n  override isBlank = true;\n  commentId?: string;\n\n  /**\n   * @param opt_comment The comment this event corresponds to.  Undefined for a\n   *     blank event.\n   */\n  constructor(opt_comment?: WorkspaceComment) {\n    super();\n    /** Whether or not an event is blank. */\n    this.isBlank = !opt_comment;\n\n    if (!opt_comment) return;\n\n    /** The ID of the comment this event pertains to. */\n    this.commentId = opt_comment.id;\n\n    /** The workspace identifier for this event. */\n    this.workspaceId = opt_comment.workspace.id;\n\n    /**\n     * The event group ID for the group this event belongs to. Groups define\n     * events that should be treated as an single action from the user's\n     * perspective, and should be undone together.\n     */\n    this.group = eventUtils.getGroup();\n\n    /** Sets whether the event should be added to the undo stack. */\n    this.recordUndo = eventUtils.getRecordUndo();\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): CommentBaseJson {\n    const json = super.toJson() as CommentBaseJson;\n    if (!this.commentId) {\n      throw new Error(\n          'The comment ID is undefined. Either pass a comment to ' +\n          'the constructor, or call fromJson');\n    }\n    json['commentId'] = this.commentId;\n    return json;\n  }\n\n  /**\n   * Decode the JSON event.\n   *\n   * @param json JSON representation.\n   */\n  override fromJson(json: CommentBaseJson) {\n    deprecation.warn(\n        'Blockly.Events.CommentBase.prototype.fromJson', 'version 9',\n        'version 10', 'Blockly.Events.fromJson');\n    super.fromJson(json);\n    this.commentId = json['commentId'];\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of CommentBase, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(json: CommentBaseJson, workspace: Workspace, event?: any):\n      CommentBase {\n    const newEvent =\n        super.fromJson(json, workspace, event ?? new CommentBase()) as\n        CommentBase;\n    newEvent.commentId = json['commentId'];\n    return newEvent;\n  }\n\n  /**\n   * Helper function for Comment[Create|Delete]\n   *\n   * @param event The event to run.\n   * @param create if True then Create, if False then Delete\n   */\n  static CommentCreateDeleteHelper(\n      event: CommentCreate|CommentDelete, create: boolean) {\n    const workspace = event.getEventWorkspace_();\n    if (create) {\n      const xmlElement = utilsXml.createElement('xml');\n      if (!event.xml) {\n        throw new Error('Ecountered a comment event without proper xml');\n      }\n      xmlElement.appendChild(event.xml);\n      Xml.domToWorkspace(xmlElement, workspace);\n    } else {\n      if (!event.commentId) {\n        throw new Error(\n            'The comment ID is undefined. Either pass a comment to ' +\n            'the constructor, or call fromJson');\n      }\n      const comment = workspace.getCommentById(event.commentId);\n      if (comment) {\n        comment.dispose();\n      } else {\n        // Only complain about root-level block.\n        console.warn(\n            'Can\\'t uncreate non-existent comment: ' + event.commentId);\n      }\n    }\n  }\n}\n\nexport interface CommentBaseJson extends AbstractEventJson {\n  commentId: string;\n}\n","/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for comment change event.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events.CommentChange');\n\nimport * as deprecation from '../utils/deprecation.js';\nimport * as registry from '../registry.js';\nimport type {WorkspaceComment} from '../workspace_comment.js';\n\nimport {CommentBase, CommentBaseJson} from './events_comment_base.js';\nimport * as eventUtils from './utils.js';\nimport type {Workspace} from '../workspace.js';\n\n\n/**\n * Class for a comment change event.\n *\n * @alias Blockly.Events.CommentChange\n */\nexport class CommentChange extends CommentBase {\n  override type = eventUtils.COMMENT_CHANGE;\n  oldContents_?: string;\n  newContents_?: string;\n\n  /**\n   * @param opt_comment The comment that is being changed.  Undefined for a\n   *     blank event.\n   * @param opt_oldContents Previous contents of the comment.\n   * @param opt_newContents New contents of the comment.\n   */\n  constructor(\n      opt_comment?: WorkspaceComment, opt_oldContents?: string,\n      opt_newContents?: string) {\n    super(opt_comment);\n\n    if (!opt_comment) {\n      return;  // Blank event to be populated by fromJson.\n    }\n\n    this.oldContents_ =\n        typeof opt_oldContents === 'undefined' ? '' : opt_oldContents;\n    this.newContents_ =\n        typeof opt_newContents === 'undefined' ? '' : opt_newContents;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): CommentChangeJson {\n    const json = super.toJson() as CommentChangeJson;\n    if (!this.oldContents_) {\n      throw new Error(\n          'The old contents is undefined. Either pass a value to ' +\n          'the constructor, or call fromJson');\n    }\n    if (!this.newContents_) {\n      throw new Error(\n          'The new contents is undefined. Either pass a value to ' +\n          'the constructor, or call fromJson');\n    }\n    json['oldContents'] = this.oldContents_;\n    json['newContents'] = this.newContents_;\n    return json;\n  }\n\n  /**\n   * Decode the JSON event.\n   *\n   * @param json JSON representation.\n   */\n  override fromJson(json: CommentChangeJson) {\n    deprecation.warn(\n        'Blockly.Events.CommentChange.prototype.fromJson', 'version 9',\n        'version 10', 'Blockly.Events.fromJson');\n    super.fromJson(json);\n    this.oldContents_ = json['oldContents'];\n    this.newContents_ = json['newContents'];\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of CommentChange, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(json: CommentChangeJson, workspace: Workspace, event?: any):\n      CommentChange {\n    const newEvent =\n        super.fromJson(json, workspace, event ?? new CommentChange()) as\n        CommentChange;\n    newEvent.oldContents_ = json['oldContents'];\n    newEvent.newContents_ = json['newContents'];\n    return newEvent;\n  }\n\n  /**\n   * Does this event record any change of state?\n   *\n   * @returns False if something changed.\n   */\n  override isNull(): boolean {\n    return this.oldContents_ === this.newContents_;\n  }\n\n  /**\n   * Run a change event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    const workspace = this.getEventWorkspace_();\n    if (!this.commentId) {\n      throw new Error(\n          'The comment ID is undefined. Either pass a comment to ' +\n          'the constructor, or call fromJson');\n    }\n    const comment = workspace.getCommentById(this.commentId);\n    if (!comment) {\n      console.warn('Can\\'t change non-existent comment: ' + this.commentId);\n      return;\n    }\n    const contents = forward ? this.newContents_ : this.oldContents_;\n    if (!contents) {\n      if (forward) {\n        throw new Error(\n            'The new contents is undefined. Either pass a value to ' +\n            'the constructor, or call fromJson');\n      }\n      throw new Error(\n          'The old contents is undefined. Either pass a value to ' +\n          'the constructor, or call fromJson');\n    }\n    comment.setContent(contents);\n  }\n}\n\nexport interface CommentChangeJson extends CommentBaseJson {\n  oldContents: string;\n  newContents: string;\n}\n\nregistry.register(\n    registry.Type.EVENT, eventUtils.COMMENT_CHANGE, CommentChange);\n","/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for comment creation event.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events.CommentCreate');\n\nimport * as deprecation from '../utils/deprecation.js';\nimport * as registry from '../registry.js';\nimport type {WorkspaceComment} from '../workspace_comment.js';\nimport * as Xml from '../xml.js';\n\nimport {CommentBase, CommentBaseJson} from './events_comment_base.js';\nimport * as eventUtils from './utils.js';\nimport type {Workspace} from '../workspace.js';\n\n\n/**\n * Class for a comment creation event.\n *\n * @alias Blockly.Events.CommentCreate\n */\nexport class CommentCreate extends CommentBase {\n  override type = eventUtils.COMMENT_CREATE;\n\n  xml?: Element|DocumentFragment;\n\n  /**\n   * @param opt_comment The created comment.\n   *     Undefined for a blank event.\n   */\n  constructor(opt_comment?: WorkspaceComment) {\n    super(opt_comment);\n\n    if (!opt_comment) {\n      return;\n    }\n    // Blank event to be populated by fromJson.\n    this.xml = opt_comment.toXmlWithXY();\n  }\n\n  // TODO (#1266): \"Full\" and \"minimal\" serialization.\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): CommentCreateJson {\n    const json = super.toJson() as CommentCreateJson;\n    if (!this.xml) {\n      throw new Error(\n          'The comment XML is undefined. Either pass a comment to ' +\n          'the constructor, or call fromJson');\n    }\n    json['xml'] = Xml.domToText(this.xml);\n    return json;\n  }\n\n  /**\n   * Decode the JSON event.\n   *\n   * @param json JSON representation.\n   */\n  override fromJson(json: CommentCreateJson) {\n    deprecation.warn(\n        'Blockly.Events.CommentCreate.prototype.fromJson', 'version 9',\n        'version 10', 'Blockly.Events.fromJson');\n    super.fromJson(json);\n    this.xml = Xml.textToDom(json['xml']);\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of CommentCreate, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(json: CommentCreateJson, workspace: Workspace, event?: any):\n      CommentCreate {\n    const newEvent =\n        super.fromJson(json, workspace, event ?? new CommentCreate()) as\n        CommentCreate;\n    newEvent.xml = Xml.textToDom(json['xml']);\n    return newEvent;\n  }\n\n  /**\n   * Run a creation event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    CommentBase.CommentCreateDeleteHelper(this, forward);\n  }\n}\n\nexport interface CommentCreateJson extends CommentBaseJson {\n  xml: string;\n}\n\nregistry.register(\n    registry.Type.EVENT, eventUtils.COMMENT_CREATE, CommentCreate);\n","/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for comment deletion event.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events.CommentDelete');\n\nimport * as registry from '../registry.js';\nimport type {WorkspaceComment} from '../workspace_comment.js';\n\nimport {CommentBase, CommentBaseJson} from './events_comment_base.js';\nimport * as eventUtils from './utils.js';\nimport * as Xml from '../xml.js';\nimport type {Workspace} from '../workspace.js';\n\n\n/**\n * Class for a comment deletion event.\n *\n * @alias Blockly.Events.CommentDelete\n */\nexport class CommentDelete extends CommentBase {\n  override type = eventUtils.COMMENT_DELETE;\n  xml?: Element;\n\n  /**\n   * @param opt_comment The deleted comment.\n   *     Undefined for a blank event.\n   */\n  constructor(opt_comment?: WorkspaceComment) {\n    super(opt_comment);\n\n    if (!opt_comment) {\n      return;  // Blank event to be populated by fromJson.\n    }\n\n    this.xml = opt_comment.toXmlWithXY();\n  }\n\n  /**\n   * Run a creation event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    CommentBase.CommentCreateDeleteHelper(this, !forward);\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): CommentDeleteJson {\n    const json = super.toJson() as CommentDeleteJson;\n    if (!this.xml) {\n      throw new Error(\n          'The comment XML is undefined. Either pass a comment to ' +\n          'the constructor, or call fromJson');\n    }\n    json['xml'] = Xml.domToText(this.xml);\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of CommentDelete, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(json: CommentDeleteJson, workspace: Workspace, event?: any):\n      CommentDelete {\n    const newEvent =\n        super.fromJson(json, workspace, event ?? new CommentDelete()) as\n        CommentDelete;\n    newEvent.xml = Xml.textToDom(json['xml']);\n    return newEvent;\n  }\n}\n\nexport interface CommentDeleteJson extends CommentBaseJson {\n  xml: string;\n}\n\nregistry.register(\n    registry.Type.EVENT, eventUtils.COMMENT_DELETE, CommentDelete);\n","/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for comment move event.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events.CommentMove');\n\nimport * as deprecation from '../utils/deprecation.js';\nimport * as registry from '../registry.js';\nimport {Coordinate} from '../utils/coordinate.js';\nimport type {WorkspaceComment} from '../workspace_comment.js';\n\nimport {CommentBase, CommentBaseJson} from './events_comment_base.js';\nimport * as eventUtils from './utils.js';\nimport type {Workspace} from '../workspace.js';\n\n\n/**\n * Class for a comment move event.  Created before the move.\n *\n * @alias Blockly.Events.CommentMove\n */\nexport class CommentMove extends CommentBase {\n  override type = eventUtils.COMMENT_MOVE;\n  comment_?: WorkspaceComment;\n  oldCoordinate_?: Coordinate;\n  /** The location after the move, in workspace coordinates. */\n  newCoordinate_?: Coordinate;\n\n  /**\n   * @param opt_comment The comment that is being moved.  Undefined for a blank\n   *     event.\n   */\n  constructor(opt_comment?: WorkspaceComment) {\n    super(opt_comment);\n\n    if (!opt_comment) {\n      return;  // Blank event to be populated by fromJson.\n    }\n\n    /**\n     * The comment that is being moved.\n     */\n    this.comment_ = opt_comment;\n\n    /** The location before the move, in workspace coordinates. */\n    this.oldCoordinate_ = opt_comment.getXY();\n  }\n\n  /**\n   * Record the comment's new location.  Called after the move.  Can only be\n   * called once.\n   */\n  recordNew() {\n    if (this.newCoordinate_) {\n      throw Error(\n          'Tried to record the new position of a comment on the ' +\n          'same event twice.');\n    }\n    if (!this.comment_) {\n      throw new Error(\n          'The comment is undefined. Pass a comment to ' +\n          'the constructor if you want to use the record functionality');\n    }\n    this.newCoordinate_ = this.comment_.getXY();\n  }\n\n  /**\n   * Override the location before the move.  Use this if you don't create the\n   * event until the end of the move, but you know the original location.\n   *\n   * @param xy The location before the move, in workspace coordinates.\n   */\n  setOldCoordinate(xy: Coordinate) {\n    this.oldCoordinate_ = xy;\n  }\n\n  // TODO (#1266): \"Full\" and \"minimal\" serialization.\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): CommentMoveJson {\n    const json = super.toJson() as CommentMoveJson;\n    if (!this.oldCoordinate_) {\n      throw new Error(\n          'The old comment position is undefined. Either pass a comment to ' +\n          'the constructor, or call fromJson');\n    }\n    if (!this.newCoordinate_) {\n      throw new Error(\n          'The new comment position is undefined. Either call recordNew, or ' +\n          'call fromJson');\n    }\n    json['oldCoordinate'] = `${Math.round(this.oldCoordinate_.x)}, ` +\n        `${Math.round(this.oldCoordinate_.y)}`;\n    json['newCoordinate'] = Math.round(this.newCoordinate_.x) + ',' +\n        Math.round(this.newCoordinate_.y);\n    return json;\n  }\n\n  /**\n   * Decode the JSON event.\n   *\n   * @param json JSON representation.\n   */\n  override fromJson(json: CommentMoveJson) {\n    deprecation.warn(\n        'Blockly.Events.CommentMove.prototype.fromJson', 'version 9',\n        'version 10', 'Blockly.Events.fromJson');\n    super.fromJson(json);\n    let xy = json['oldCoordinate'].split(',');\n    this.oldCoordinate_ = new Coordinate(Number(xy[0]), Number(xy[1]));\n    xy = json['newCoordinate'].split(',');\n    this.newCoordinate_ = new Coordinate(Number(xy[0]), Number(xy[1]));\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of CommentMove, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(json: CommentMoveJson, workspace: Workspace, event?: any):\n      CommentMove {\n    const newEvent =\n        super.fromJson(json, workspace, event ?? new CommentMove()) as\n        CommentMove;\n    let xy = json['oldCoordinate'].split(',');\n    newEvent.oldCoordinate_ = new Coordinate(Number(xy[0]), Number(xy[1]));\n    xy = json['newCoordinate'].split(',');\n    newEvent.newCoordinate_ = new Coordinate(Number(xy[0]), Number(xy[1]));\n    return newEvent;\n  }\n\n  /**\n   * Does this event record any change of state?\n   *\n   * @returns False if something changed.\n   */\n  override isNull(): boolean {\n    return Coordinate.equals(this.oldCoordinate_, this.newCoordinate_);\n  }\n\n  /**\n   * Run a move event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    const workspace = this.getEventWorkspace_();\n    if (!this.commentId) {\n      throw new Error(\n          'The comment ID is undefined. Either pass a comment to ' +\n          'the constructor, or call fromJson');\n    }\n    const comment = workspace.getCommentById(this.commentId);\n    if (!comment) {\n      console.warn('Can\\'t move non-existent comment: ' + this.commentId);\n      return;\n    }\n\n    const target = forward ? this.newCoordinate_ : this.oldCoordinate_;\n    if (!target) {\n      throw new Error(\n          'Either oldCoordinate_ or newCoordinate_ is undefined. ' +\n          'Either pass a comment to the constructor and call recordNew, ' +\n          'or call fromJson');\n    }\n    // TODO: Check if the comment is being dragged, and give up if so.\n    const current = comment.getXY();\n    comment.moveBy(target.x - current.x, target.y - current.y);\n  }\n}\n\nexport interface CommentMoveJson extends CommentBaseJson {\n  oldCoordinate: string;\n  newCoordinate: string;\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.COMMENT_MOVE, CommentMove);\n","/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {Abstract as AbstractEvent, AbstractEventJson} from './events_abstract.js';\nimport type {IProcedureModel} from '../interfaces/i_procedure_model.js';\nimport type {Workspace} from '../workspace.js';\n\n\n/**\n * The base event for an event associated with a procedure.\n */\nexport abstract class ProcedureBase extends AbstractEvent {\n  isBlank = false;\n\n  constructor(workspace: Workspace, public readonly model: IProcedureModel) {\n    super();\n    this.workspaceId = workspace.id;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  toJson(): ProcedureBaseJson {\n    const json = super.toJson() as ProcedureBaseJson;\n    json['procedureId'] = this.model.getId();\n    return json;\n  }\n}\n\nexport interface ProcedureBaseJson extends AbstractEventJson {\n  procedureId: string;\n}\n","\n/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {IProcedureModel} from '../interfaces/i_procedure_model.js';\nimport * as registry from '../registry.js';\nimport type {Workspace} from '../workspace.js';\n\nimport {ProcedureBase, ProcedureBaseJson} from './events_procedure_base.js';\nimport * as eventUtils from './utils.js';\n\n\n/**\n * Represents a procedure's return type/status changing.\n */\nexport class ProcedureChangeReturn extends ProcedureBase {\n  /** A string used to check the type of the event. */\n  type = eventUtils.PROCEDURE_CHANGE_RETURN;\n\n  /** The new type(s) the procedure's return has been set to. */\n  private newTypes: string[]|null;\n\n  /**\n   * @param oldTypes The type(s) the procedure's return was set to before it\n   *     changed.\n   */\n  constructor(\n      workpace: Workspace, model: IProcedureModel,\n      public readonly oldTypes: string[]|null) {\n    super(workpace, model);\n\n    this.newTypes = model.getReturnTypes();\n  }\n\n  run(forward: boolean) {\n    const procedureModel =\n        this.getEventWorkspace_().getProcedureMap().get(this.model.getId());\n    if (!procedureModel) {\n      throw new Error(\n          'Cannot change the type of a procedure that does not exist ' +\n          'in the procedure map');\n    }\n    if (forward) {\n      procedureModel.setReturnTypes(this.newTypes);\n    } else {\n      procedureModel.setReturnTypes(this.oldTypes);\n    }\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  toJson(): ProcedureChangeReturnJson {\n    const json = super.toJson() as ProcedureChangeReturnJson;\n    json['oldTypes'] = this.oldTypes;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @internal\n   */\n  static fromJson(json: ProcedureChangeReturnJson, workspace: Workspace):\n      ProcedureChangeReturn {\n    const model = workspace.getProcedureMap().get(json['procedureId']);\n    if (!model) {\n      throw new Error(\n          'Cannot deserialize procedure change return event because the ' +\n          'target procedure does not exist');\n    }\n    return new ProcedureChangeReturn(workspace, model, json['oldTypes']);\n  }\n}\n\nexport interface ProcedureChangeReturnJson extends ProcedureBaseJson {\n  oldTypes: string[]|null;\n}\n\nregistry.register(\n    registry.Type.EVENT, eventUtils.PROCEDURE_CHANGE_RETURN,\n    ProcedureChangeReturn);\n","/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {IProcedureModel} from '../interfaces/i_procedure_model.js';\nimport {ObservableParameterModel, ObservableProcedureModel} from '../procedures.js';\nimport * as registry from '../registry.js';\nimport {loadProcedure, saveProcedure, State as ProcedureState} from '../serialization/procedures.js';\nimport type {Workspace} from '../workspace.js';\n\nimport {ProcedureBase, ProcedureBaseJson} from './events_procedure_base.js';\nimport * as eventUtils from './utils.js';\n\n\n/**\n * Represents a procedure data model being created.\n */\nexport class ProcedureCreate extends ProcedureBase {\n  /** A string used to check the type of the event. */\n  type = eventUtils.PROCEDURE_CREATE;\n\n  constructor(workspace: Workspace, model: IProcedureModel) {\n    super(workspace, model);\n  }\n\n  run(forward: boolean) {\n    const workspace = this.getEventWorkspace_();\n    const procedureMap = workspace.getProcedureMap();\n    const procedureModel = procedureMap.get(this.model.getId());\n    if (forward) {\n      if (procedureModel) return;\n      // TODO: This should add the model to the map instead of creating a dupe.\n      procedureMap.add(new ObservableProcedureModel(\n          workspace, this.model.getName(), this.model.getId()));\n    } else {\n      if (!procedureModel) return;\n      procedureMap.delete(this.model.getId());\n    }\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  toJson(): ProcedureCreateJson {\n    const json = super.toJson() as ProcedureCreateJson;\n    json['model'] = saveProcedure(this.model);\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @internal\n   */\n  static fromJson(json: ProcedureCreateJson, workspace: Workspace):\n      ProcedureCreate {\n    return new ProcedureCreate(\n        workspace,\n        loadProcedure(\n            ObservableProcedureModel, ObservableParameterModel, json['model'],\n            workspace));\n  }\n}\n\nexport interface ProcedureCreateJson extends ProcedureBaseJson {\n  model: ProcedureState,\n}\n\nregistry.register(\n    registry.Type.EVENT, eventUtils.PROCEDURE_CREATE, ProcedureCreate);\n","\n/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {IProcedureModel} from '../interfaces/i_procedure_model.js';\nimport {ObservableProcedureModel} from '../procedures.js';\nimport * as registry from '../registry.js';\nimport type {Workspace} from '../workspace.js';\n\nimport {ProcedureBase, ProcedureBaseJson} from './events_procedure_base.js';\nimport * as eventUtils from './utils.js';\n\n\n/**\n * Represents a procedure data model being deleted.\n */\nexport class ProcedureDelete extends ProcedureBase {\n  /** A string used to check the type of the event. */\n  type = eventUtils.PROCEDURE_DELETE;\n\n  constructor(workspace: Workspace, model: IProcedureModel) {\n    super(workspace, model);\n  }\n\n  run(forward: boolean) {\n    const workspace = this.getEventWorkspace_();\n    const procedureMap = workspace.getProcedureMap();\n    const procedureModel = procedureMap.get(this.model.getId());\n    if (forward) {\n      if (!procedureModel) return;\n      procedureMap.delete(this.model.getId());\n    } else {\n      if (procedureModel) return;\n      procedureMap.add(new ObservableProcedureModel(\n          workspace, this.model.getName(), this.model.getId()));\n    }\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  toJson(): ProcedureDeleteJson {\n    return super.toJson() as ProcedureDeleteJson;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @internal\n   */\n  static fromJson(json: ProcedureDeleteJson, workspace: Workspace):\n      ProcedureDelete {\n    const model = workspace.getProcedureMap().get(json['procedureId']);\n    if (!model) {\n      throw new Error(\n          'Cannot deserialize procedure delete event because the ' +\n          'target procedure does not exist');\n    }\n    return new ProcedureDelete(workspace, model);\n  }\n}\n\nexport interface ProcedureDeleteJson extends ProcedureBaseJson {}\n\nregistry.register(\n    registry.Type.EVENT, eventUtils.PROCEDURE_DELETE, ProcedureDelete);\n","\n/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {IProcedureModel} from '../interfaces/i_procedure_model.js';\nimport * as registry from '../registry.js';\nimport type {Workspace} from '../workspace.js';\n\nimport {ProcedureBase, ProcedureBaseJson} from './events_procedure_base.js';\nimport * as eventUtils from './utils.js';\n\n/**\n * Represents a procedure data model being enabled or disabled.\n */\nexport class ProcedureEnable extends ProcedureBase {\n  /** A string used to check the type of the event. */\n  type = eventUtils.PROCEDURE_ENABLE;\n\n  private oldState: boolean;\n  private newState: boolean;\n\n  constructor(workspace: Workspace, model: IProcedureModel) {\n    super(workspace, model);\n\n    this.oldState = !model.getEnabled();\n    this.newState = model.getEnabled();\n  }\n\n  run(forward: boolean) {\n    const procedureModel =\n        this.getEventWorkspace_().getProcedureMap().get(this.model.getId());\n    if (!procedureModel) {\n      throw new Error(\n          'Cannot change the enabled state of a procedure that does not ' +\n          'exist in the procedure map');\n    }\n    if (forward) {\n      procedureModel.setEnabled(this.newState);\n    } else {\n      procedureModel.setEnabled(this.oldState);\n    }\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  toJson(): ProcedureEnableJson {\n    return super.toJson() as ProcedureEnableJson;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @internal\n   */\n  static fromJson(json: ProcedureEnableJson, workspace: Workspace):\n      ProcedureEnable {\n    const model = workspace.getProcedureMap().get(json['procedureId']);\n    if (!model) {\n      throw new Error(\n          'Cannot deserialize procedure enable event because the ' +\n          'target procedure does not exist');\n    }\n    return new ProcedureEnable(workspace, model);\n  }\n}\n\nexport interface ProcedureEnableJson extends ProcedureBaseJson {}\n\nregistry.register(\n    registry.Type.EVENT, eventUtils.PROCEDURE_ENABLE, ProcedureEnable);\n","/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {IProcedureModel} from '../interfaces/i_procedure_model.js';\nimport * as registry from '../registry.js';\nimport type {Workspace} from '../workspace.js';\n\nimport {ProcedureBase, ProcedureBaseJson} from './events_procedure_base.js';\nimport * as eventUtils from './utils.js';\n\n/**\n * Represents a procedure being renamed.\n */\nexport class ProcedureRename extends ProcedureBase {\n  /** A string used to check the type of the event. */\n  type = eventUtils.PROCEDURE_RENAME;\n  private newName: string;\n\n  constructor(\n      workspace: Workspace, model: IProcedureModel,\n      public readonly oldName: string) {\n    super(workspace, model);\n\n    this.newName = model.getName();\n  }\n\n  run(forward: boolean) {\n    const procedureModel =\n        this.getEventWorkspace_().getProcedureMap().get(this.model.getId());\n    if (!procedureModel) {\n      throw new Error(\n          'Cannot change the type of a procedure that does not exist ' +\n          'in the procedure map');\n    }\n    if (forward) {\n      procedureModel.setName(this.newName);\n    } else {\n      procedureModel.setName(this.oldName);\n    }\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  toJson(): ProcedureRenameJson {\n    const json = super.toJson() as ProcedureRenameJson;\n    json['oldName'] = this.oldName;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @internal\n   */\n  static fromJson(json: ProcedureRenameJson, workspace: Workspace):\n      ProcedureRename {\n    const model = workspace.getProcedureMap().get(json['procedureId']);\n    if (!model) {\n      throw new Error(\n          'Cannot deserialize procedure rename event because the ' +\n          'target procedure does not exist');\n    }\n    return new ProcedureRename(workspace, model, json['oldName']);\n  }\n}\n\nexport interface ProcedureRenameJson extends ProcedureBaseJson {\n  oldName: string;\n}\n\nregistry.register(\n    registry.Type.EVENT, eventUtils.PROCEDURE_RENAME, ProcedureRename);\n","\n/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {IParameterModel} from '../interfaces/i_parameter_model.js';\nimport {IProcedureModel} from '../interfaces/i_procedure_model.js';\n\nimport {ProcedureBase, ProcedureBaseJson} from './events_procedure_base.js';\n\nimport type {Workspace} from '../workspace.js';\n\n/**\n * The base event for an event associated with a procedure parameter.\n */\nexport abstract class ProcedureParameterBase extends ProcedureBase {\n  constructor(\n      workspace: Workspace, model: IProcedureModel,\n      public readonly parameter: IParameterModel) {\n    super(workspace, model);\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  toJson(): ProcedureParameterBaseJson {\n    const json = super.toJson() as ProcedureParameterBaseJson;\n    json['parameterId'] = this.model.getId();\n    return json;\n  }\n}\n\nexport interface ProcedureParameterBaseJson extends ProcedureBaseJson {\n  parameterId: string,\n}\n","/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {IParameterModel} from '../interfaces/i_parameter_model.js';\nimport type {IProcedureModel} from '../interfaces/i_procedure_model.js';\nimport {ObservableParameterModel} from '../procedures/observable_parameter_model.js';\nimport * as registry from '../registry.js';\nimport {loadParameter, ParameterState, saveParameter} from '../serialization/procedures.js';\nimport type {Workspace} from '../workspace.js';\n\nimport {ProcedureParameterBase, ProcedureParameterBaseJson} from './events_procedure_parameter_base.js';\nimport * as eventUtils from './utils.js';\n\n\n/**\n * Represents a parameter being added to a procedure.\n */\nexport class ProcedureParameterCreate extends ProcedureParameterBase {\n  /** A string used to check the type of the event. */\n  type = eventUtils.PROCEDURE_PARAMETER_CREATE;\n\n  /**\n   * @param parameter The parameter model that was just added to the procedure.\n   * @param index The index the parameter was inserted at.\n   */\n  constructor(\n      workspace: Workspace, procedure: IProcedureModel,\n      parameter: IParameterModel, public readonly index: number) {\n    super(workspace, procedure, parameter);\n  }\n\n  run(forward: boolean) {\n    const workspace = this.getEventWorkspace_();\n    const procedureMap = workspace.getProcedureMap();\n    const procedureModel = procedureMap.get(this.model.getId());\n    if (!procedureModel) {\n      throw new Error(\n          'Cannot add a parameter to a procedure that does not exist ' +\n          'in the procedure map');\n    }\n    const parameterModel = procedureModel.getParameter(this.index);\n    if (forward) {\n      if (this.parameterMatches(parameterModel)) return;\n      // TODO: This should just add the parameter instead of creating a dupe.\n      procedureModel.insertParameter(\n          new ObservableParameterModel(\n              workspace, this.parameter.getName(), this.parameter.getId()),\n          this.index);\n    } else {\n      if (!this.parameterMatches(parameterModel)) return;\n      procedureModel.deleteParameter(this.index);\n    }\n  }\n\n  parameterMatches(param: IParameterModel) {\n    return param && param.getId() === this.parameter.getId();\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  toJson(): ProcedureParameterCreateJson {\n    const json = super.toJson() as ProcedureParameterCreateJson;\n    json['parameter'] = saveParameter(this.parameter);\n    json['index'] = this.index;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @internal\n   */\n  static fromJson(json: ProcedureParameterCreateJson, workspace: Workspace):\n      ProcedureParameterCreate {\n    const procedure = workspace.getProcedureMap().get(json['procedureId']);\n    if (!procedure) {\n      throw new Error(\n          'Cannot deserialize parameter create event because the ' +\n          'target procedure does not exist');\n    }\n    return new ProcedureParameterCreate(\n        workspace, procedure,\n        loadParameter(ObservableParameterModel, json['parameter'], workspace),\n        json['index']);\n  }\n}\n\nexport interface ProcedureParameterCreateJson extends\n    ProcedureParameterBaseJson {\n  parameter: ParameterState, index: number,\n}\n\nregistry.register(\n    registry.Type.EVENT, eventUtils.PROCEDURE_PARAMETER_CREATE,\n    ProcedureParameterCreate);\n","/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {IParameterModel} from '../interfaces/i_parameter_model.js';\nimport type {IProcedureModel} from '../interfaces/i_procedure_model.js';\nimport {ObservableParameterModel} from '../procedures/observable_parameter_model.js';\nimport * as registry from '../registry.js';\nimport type {Workspace} from '../workspace.js';\n\nimport {ProcedureParameterBase, ProcedureParameterBaseJson} from './events_procedure_parameter_base.js';\nimport * as eventUtils from './utils.js';\n\n/**\n * Represents a parameter being removed from a procedure.\n */\nexport class ProcedureParameterDelete extends ProcedureParameterBase {\n  /** A string used to check the type of the event. */\n  type = eventUtils.PROCEDURE_PARAMETER_DELETE;\n\n  /**\n   * @param parameter The parameter model that was just removed from the\n   *     procedure.\n   * @param index The index the parameter was at before it was removed.\n   */\n  constructor(\n      workspace: Workspace, procedure: IProcedureModel,\n      parameter: IParameterModel, public readonly index: number) {\n    super(workspace, procedure, parameter);\n  }\n\n  run(forward: boolean) {\n    const workspace = this.getEventWorkspace_();\n    const procedureMap = workspace.getProcedureMap();\n    const procedureModel = procedureMap.get(this.model.getId());\n    if (!procedureModel) {\n      throw new Error(\n          'Cannot add a parameter to a procedure that does not exist ' +\n          'in the procedure map');\n    }\n    const parameterModel = procedureModel.getParameter(this.index);\n    if (forward) {\n      if (!this.parameterMatches(parameterModel)) return;\n      procedureModel.deleteParameter(this.index);\n    } else {\n      if (this.parameterMatches(parameterModel)) return;\n      // TODO: this should just insert the model instead of creating a dupe.\n      procedureModel.insertParameter(\n          new ObservableParameterModel(\n              workspace, this.parameter.getName(), this.parameter.getId()),\n          this.index);\n    }\n  }\n\n  parameterMatches(param: IParameterModel) {\n    return param && param.getId() === this.parameter.getId();\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  toJson(): ProcedureParameterDeleteJson {\n    const json = super.toJson() as ProcedureParameterDeleteJson;\n    json['index'] = this.index;\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @internal\n   */\n  static fromJson(json: ProcedureParameterDeleteJson, workspace: Workspace):\n      ProcedureParameterDelete {\n    const model = workspace.getProcedureMap().get(json['procedureId']);\n    if (!model) {\n      throw new Error(\n          'Cannot deserialize procedure delete event because the ' +\n          'target procedure does not exist');\n    }\n    const param = model.getParameter(json['index']);\n    return new ProcedureParameterDelete(workspace, model, param, json['index']);\n  }\n}\n\nexport interface ProcedureParameterDeleteJson extends\n    ProcedureParameterBaseJson {\n  index: number;\n}\n\nregistry.register(\n    registry.Type.EVENT, eventUtils.PROCEDURE_PARAMETER_DELETE,\n    ProcedureParameterDelete);\n","/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Events fired as a block drag.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events.BlockDrag');\n\nimport type {Block} from '../block.js';\nimport * as deprecation from '../utils/deprecation.js';\nimport * as registry from '../registry.js';\nimport {AbstractEventJson} from './events_abstract.js';\nimport {UiBase} from './events_ui_base.js';\nimport * as eventUtils from './utils.js';\nimport {Workspace} from '../workspace.js';\n\n\n/**\n * Class for a block drag event.\n *\n * @alias Blockly.Events.BlockDrag\n */\nexport class BlockDrag extends UiBase {\n  blockId?: string;\n  isStart?: boolean;\n  blocks?: Block[];\n  override type = eventUtils.BLOCK_DRAG;\n\n  /**\n   * @param opt_block The top block in the stack that is being dragged.\n   *     Undefined for a blank event.\n   * @param opt_isStart Whether this is the start of a block drag.\n   *    Undefined for a blank event.\n   * @param opt_blocks The blocks affected by this drag. Undefined for a blank\n   *     event.\n   */\n  constructor(opt_block?: Block, opt_isStart?: boolean, opt_blocks?: Block[]) {\n    const workspaceId = opt_block ? opt_block.workspace.id : undefined;\n    super(workspaceId);\n    if (!opt_block) return;\n\n    this.blockId = opt_block.id;\n\n    /** Whether this is the start of a block drag. */\n    this.isStart = opt_isStart;\n\n    /** The blocks affected by this drag event. */\n    this.blocks = opt_blocks;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): BlockDragJson {\n    const json = super.toJson() as BlockDragJson;\n    if (this.isStart === undefined) {\n      throw new Error(\n          'Whether this event is the start of a drag is undefined. ' +\n          'Either pass the value to the constructor, or call fromJson');\n    }\n    if (this.blockId === undefined) {\n      throw new Error(\n          'The block ID is undefined. Either pass a block to ' +\n          'the constructor, or call fromJson');\n    }\n    json['isStart'] = this.isStart;\n    json['blockId'] = this.blockId;\n    // TODO: I don't think we should actually apply the blocks array to the JSON\n    //   object b/c they have functions and aren't actually serializable.\n    json['blocks'] = this.blocks;\n    return json;\n  }\n\n  /**\n   * Decode the JSON event.\n   *\n   * @param json JSON representation.\n   */\n  override fromJson(json: BlockDragJson) {\n    deprecation.warn(\n        'Blockly.Events.BlockDrag.prototype.fromJson', 'version 9',\n        'version 10', 'Blockly.Events.fromJson');\n    super.fromJson(json);\n    this.isStart = json['isStart'];\n    this.blockId = json['blockId'];\n    this.blocks = json['blocks'];\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of BlockDrag, but we can't specify that due to the fact that parameters\n   *     to static methods in subclasses must be supertypes of parameters to\n   *     static methods in superclasses..\n   * @internal\n   */\n  static fromJson(json: BlockDragJson, workspace: Workspace, event?: any):\n      BlockDrag {\n    const newEvent =\n        super.fromJson(json, workspace, event ?? new BlockDrag()) as BlockDrag;\n    newEvent.isStart = json['isStart'];\n    newEvent.blockId = json['blockId'];\n    newEvent.blocks = json['blocks'];\n    return newEvent;\n  }\n}\n\nexport interface BlockDragJson extends AbstractEventJson {\n  isStart: boolean;\n  blockId: string;\n  blocks?: Block[];\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.BLOCK_DRAG, BlockDrag);\n","/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * (Deprecated) Events fired as a result of UI actions in\n * Blockly's editor.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events.Ui');\n\nimport type {Block} from '../block.js';\nimport * as registry from '../registry.js';\nimport {UiBase} from './events_ui_base.js';\nimport * as eventUtils from './utils.js';\n\n\n/**\n * Class for a UI event.\n *\n * @deprecated December 2020. Instead use a more specific UI event.\n * @alias Blockly.Events.Ui\n */\nexport class Ui extends UiBase {\n  blockId: AnyDuringMigration;\n  element: AnyDuringMigration;\n  oldValue: AnyDuringMigration;\n  newValue: AnyDuringMigration;\n  override type = eventUtils.UI;\n\n  /**\n   * @param opt_block The affected block.  Null for UI events that do not have\n   *     an associated block.  Undefined for a blank event.\n   * @param opt_element One of 'selected', 'comment', 'mutatorOpen', etc.\n   * @param opt_oldValue Previous value of element.\n   * @param opt_newValue New value of element.\n   */\n  constructor(\n      opt_block?: Block|null, opt_element?: string,\n      opt_oldValue?: AnyDuringMigration, opt_newValue?: AnyDuringMigration) {\n    const workspaceId = opt_block ? opt_block.workspace.id : undefined;\n    super(workspaceId);\n\n    this.blockId = opt_block ? opt_block.id : null;\n    this.element = typeof opt_element === 'undefined' ? '' : opt_element;\n    this.oldValue = typeof opt_oldValue === 'undefined' ? '' : opt_oldValue;\n    this.newValue = typeof opt_newValue === 'undefined' ? '' : opt_newValue;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): AnyDuringMigration {\n    const json = super.toJson() as AnyDuringMigration;\n    json['element'] = this.element;\n    if (this.newValue !== undefined) {\n      json['newValue'] = this.newValue;\n    }\n    if (this.blockId) {\n      json['blockId'] = this.blockId;\n    }\n    return json;\n  }\n\n  /**\n   * Decode the JSON event.\n   *\n   * @param json JSON representation.\n   */\n  override fromJson(json: AnyDuringMigration) {\n    super.fromJson(json);\n    this.element = json['element'];\n    this.newValue = json['newValue'];\n    this.blockId = json['blockId'];\n  }\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.UI, Ui);\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for a finished loading workspace event.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events.FinishedLoading');\n\nimport * as registry from '../registry.js';\nimport type {Workspace} from '../workspace.js';\nimport {Abstract as AbstractEvent, AbstractEventJson} from './events_abstract.js';\nimport * as eventUtils from './utils.js';\n\n\n/**\n * Class for a finished loading event.\n * Used to notify the developer when the workspace has finished loading (i.e\n * domToWorkspace).\n * Finished loading events do not record undo or redo.\n *\n * @alias Blockly.Events.FinishedLoading\n */\nexport class FinishedLoading extends AbstractEvent {\n  override isBlank = true;\n  override recordUndo = false;\n  override type = eventUtils.FINISHED_LOADING;\n\n  /**\n   * @param opt_workspace The workspace that has finished loading.  Undefined\n   *     for a blank event.\n   */\n  constructor(opt_workspace?: Workspace) {\n    super();\n    /** Whether or not the event is blank (to be populated by fromJson). */\n    this.isBlank = !!opt_workspace;\n\n    if (!opt_workspace) return;\n\n    /** The workspace identifier for this event. */\n    this.workspaceId = opt_workspace.id;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): FinishedLoadingJson {\n    const json = super.toJson() as FinishedLoadingJson;\n    if (!this.workspaceId) {\n      throw new Error(\n          'The workspace ID is undefined. Either pass a workspace to ' +\n          'the constructor, or call fromJson');\n    }\n    json['workspaceId'] = this.workspaceId;\n    return json;\n  }\n\n  /**\n   * Decode the JSON event.\n   *\n   * @param json JSON representation.\n   */\n  override fromJson(json: FinishedLoadingJson) {\n    super.fromJson(json);\n    this.workspaceId = json['workspaceId'];\n  }\n}\n\nexport interface FinishedLoadingJson extends AbstractEventJson {\n  workspaceId: string;\n}\n\nregistry.register(\n    registry.Type.EVENT, eventUtils.FINISHED_LOADING, FinishedLoading);\n","/**\n * @license\n * Copyright 2016 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Events fired as a result of actions in Blockly's editor.\n *\n * @namespace Blockly.Events\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events');\n\n\nimport {Abstract as AbstractEvent, AbstractEventJson} from './events_abstract.js';\nimport {BlockBase, BlockBaseJson} from './events_block_base.js';\nimport {BlockChange, BlockChangeJson} from './events_block_change.js';\nimport {BlockCreate, BlockCreateJson} from './events_block_create.js';\nimport {BlockDelete, BlockDeleteJson} from './events_block_delete.js';\nimport {BlockDrag, BlockDragJson} from './events_block_drag.js';\nimport {BlockMove, BlockMoveJson} from './events_block_move.js';\nimport {BubbleOpen, BubbleOpenJson, BubbleType} from './events_bubble_open.js';\nimport {Click, ClickJson, ClickTarget} from './events_click.js';\nimport {CommentBase, CommentBaseJson} from './events_comment_base.js';\nimport {CommentChange, CommentChangeJson} from './events_comment_change.js';\nimport {CommentCreate, CommentCreateJson} from './events_comment_create.js';\nimport {CommentDelete} from './events_comment_delete.js';\nimport {CommentMove, CommentMoveJson} from './events_comment_move.js';\nimport {MarkerMove, MarkerMoveJson} from './events_marker_move.js';\nimport {ProcedureBase} from './events_procedure_base.js';\nimport {ProcedureChangeReturn} from './events_procedure_change_return.js';\nimport {ProcedureCreate} from './events_procedure_create.js';\nimport {ProcedureDelete} from './events_procedure_delete.js';\nimport {ProcedureEnable} from './events_procedure_enable.js';\nimport {ProcedureRename} from './events_procedure_rename.js';\nimport {ProcedureParameterBase} from './events_procedure_parameter_base.js';\nimport {ProcedureParameterCreate} from './events_procedure_parameter_create.js';\nimport {ProcedureParameterDelete} from './events_procedure_parameter_delete.js';\nimport {ProcedureParameterRename} from './events_procedure_parameter_rename.js';\nimport {Selected, SelectedJson} from './events_selected.js';\nimport {ThemeChange, ThemeChangeJson} from './events_theme_change.js';\nimport {ToolboxItemSelect, ToolboxItemSelectJson} from './events_toolbox_item_select.js';\nimport {TrashcanOpen, TrashcanOpenJson} from './events_trashcan_open.js';\nimport {Ui} from './events_ui.js';\nimport {UiBase} from './events_ui_base.js';\nimport {VarBase, VarBaseJson} from './events_var_base.js';\nimport {VarCreate, VarCreateJson} from './events_var_create.js';\nimport {VarDelete, VarDeleteJson} from './events_var_delete.js';\nimport {VarRename, VarRenameJson} from './events_var_rename.js';\nimport {ViewportChange, ViewportChangeJson} from './events_viewport.js';\nimport * as eventUtils from './utils.js';\nimport {FinishedLoading, FinishedLoadingJson} from './workspace_events.js';\n\n\n// Events.\nexport const Abstract = AbstractEvent;\nexport {AbstractEventJson};\nexport {BubbleOpen};\nexport {BubbleOpenJson};\nexport {BubbleType};\nexport {BlockBase};\nexport {BlockBaseJson};\nexport {BlockChange};\nexport {BlockChangeJson};\nexport {BlockCreate};\nexport {BlockCreateJson};\nexport {BlockDelete};\nexport {BlockDeleteJson};\nexport {BlockDrag};\nexport {BlockDragJson};\nexport {BlockMove};\nexport {BlockMoveJson};\nexport {Click};\nexport {ClickJson};\nexport {ClickTarget};\nexport {CommentBase};\nexport {CommentBaseJson};\nexport {CommentChange};\nexport {CommentChangeJson};\nexport {CommentCreate};\nexport {CommentCreateJson};\nexport {CommentDelete};\nexport {CommentMove};\nexport {CommentMoveJson};\nexport {FinishedLoading};\nexport {FinishedLoadingJson};\nexport {MarkerMove};\nexport {MarkerMoveJson};\nexport {ProcedureBase};\nexport {ProcedureChangeReturn};\nexport {ProcedureCreate};\nexport {ProcedureDelete};\nexport {ProcedureEnable};\nexport {ProcedureRename};\nexport {ProcedureParameterBase};\nexport {ProcedureParameterCreate};\nexport {ProcedureParameterDelete};\nexport {ProcedureParameterRename};\nexport {Selected};\nexport {SelectedJson};\nexport {ThemeChange};\nexport {ThemeChangeJson};\nexport {ToolboxItemSelect};\nexport {ToolboxItemSelectJson};\nexport {TrashcanOpen};\nexport {TrashcanOpenJson};\nexport {Ui};\nexport {UiBase};\nexport {VarBase};\nexport {VarBaseJson};\nexport {VarCreate};\nexport {VarCreateJson};\nexport {VarDelete};\nexport {VarDeleteJson};\nexport {VarRename};\nexport {VarRenameJson};\nexport {ViewportChange};\nexport {ViewportChangeJson};\n\n// Event types.\nexport const BLOCK_CHANGE = eventUtils.BLOCK_CHANGE;\nexport const BLOCK_CREATE = eventUtils.BLOCK_CREATE;\nexport const BLOCK_DELETE = eventUtils.BLOCK_DELETE;\nexport const BLOCK_DRAG = eventUtils.BLOCK_DRAG;\nexport const BLOCK_MOVE = eventUtils.BLOCK_MOVE;\nexport const BUBBLE_OPEN = eventUtils.BUBBLE_OPEN;\nexport type BumpEvent = eventUtils.BumpEvent;\nexport const BUMP_EVENTS = eventUtils.BUMP_EVENTS;\nexport const CHANGE = eventUtils.CHANGE;\nexport const CLICK = eventUtils.CLICK;\nexport const COMMENT_CHANGE = eventUtils.COMMENT_CHANGE;\nexport const COMMENT_CREATE = eventUtils.COMMENT_CREATE;\nexport const COMMENT_DELETE = eventUtils.COMMENT_DELETE;\nexport const COMMENT_MOVE = eventUtils.COMMENT_MOVE;\nexport const CREATE = eventUtils.CREATE;\nexport const DELETE = eventUtils.DELETE;\nexport const FINISHED_LOADING = eventUtils.FINISHED_LOADING;\nexport const MARKER_MOVE = eventUtils.MARKER_MOVE;\nexport const MOVE = eventUtils.MOVE;\nexport const SELECTED = eventUtils.SELECTED;\nexport const THEME_CHANGE = eventUtils.THEME_CHANGE;\nexport const TOOLBOX_ITEM_SELECT = eventUtils.TOOLBOX_ITEM_SELECT;\nexport const TRASHCAN_OPEN = eventUtils.TRASHCAN_OPEN;\nexport const UI = eventUtils.UI;\nexport const VAR_CREATE = eventUtils.VAR_CREATE;\nexport const VAR_DELETE = eventUtils.VAR_DELETE;\nexport const VAR_RENAME = eventUtils.VAR_RENAME;\nexport const VIEWPORT_CHANGE = eventUtils.VIEWPORT_CHANGE;\n\n// Event utils.\nexport const clearPendingUndo = eventUtils.clearPendingUndo;\nexport const disable = eventUtils.disable;\nexport const enable = eventUtils.enable;\nexport const filter = eventUtils.filter;\nexport const fire = eventUtils.fire;\nexport const fromJson = eventUtils.fromJson;\nexport const getDescendantIds = eventUtils.getDescendantIds;\nexport const get = eventUtils.get;\nexport const getGroup = eventUtils.getGroup;\nexport const getRecordUndo = eventUtils.getRecordUndo;\nexport const isEnabled = eventUtils.isEnabled;\nexport const setGroup = eventUtils.setGroup;\nexport const setRecordUndo = eventUtils.setRecordUndo;\nexport const disableOrphans = eventUtils.disableOrphans;\n","/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Methods for dragging a block visually.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.BlockDragger');\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_drag.js';\n\nimport * as blockAnimation from './block_animations.js';\nimport type {BlockSvg} from './block_svg.js';\nimport * as bumpObjects from './bump_objects.js';\nimport * as common from './common.js';\nimport type {BlockMove} from './events/events_block_move.js';\nimport * as eventUtils from './events/utils.js';\nimport type {Icon} from './icon.js';\nimport {InsertionMarkerManager} from './insertion_marker_manager.js';\nimport type {IBlockDragger} from './interfaces/i_block_dragger.js';\nimport type {IDragTarget} from './interfaces/i_drag_target.js';\nimport * as registry from './registry.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/**\n * Class for a block dragger.  It moves blocks around the workspace when they\n * are being dragged by a mouse or touch.\n *\n * @alias Blockly.BlockDragger\n */\nexport class BlockDragger implements IBlockDragger {\n  /** The top block in the stack that is being dragged. */\n  protected draggingBlock_: BlockSvg;\n  protected draggedConnectionManager_: InsertionMarkerManager;\n\n  /** The workspace on which the block is being dragged. */\n  protected workspace_: WorkspaceSvg;\n\n  /** Which drag area the mouse pointer is over, if any. */\n  private dragTarget_: IDragTarget|null = null;\n\n  /** Whether the block would be deleted if dropped immediately. */\n  protected wouldDeleteBlock_ = false;\n  protected startXY_: Coordinate;\n  protected dragIconData_: IconPositionData[];\n\n  /**\n   * @param block The block to drag.\n   * @param workspace The workspace to drag on.\n   */\n  constructor(block: BlockSvg, workspace: WorkspaceSvg) {\n    this.draggingBlock_ = block;\n\n    /** Object that keeps track of connections on dragged blocks. */\n    this.draggedConnectionManager_ =\n        new InsertionMarkerManager(this.draggingBlock_);\n\n    this.workspace_ = workspace;\n\n    /**\n     * The location of the top left corner of the dragging block at the\n     * beginning of the drag in workspace coordinates.\n     */\n    this.startXY_ = this.draggingBlock_.getRelativeToSurfaceXY();\n\n    /**\n     * A list of all of the icons (comment, warning, and mutator) that are\n     * on this block and its descendants.  Moving an icon moves the bubble that\n     * extends from it if that bubble is open.\n     */\n    this.dragIconData_ = initIconData(block);\n  }\n\n  /**\n   * Sever all links from this object.\n   *\n   * @internal\n   */\n  dispose() {\n    this.dragIconData_.length = 0;\n\n    if (this.draggedConnectionManager_) {\n      this.draggedConnectionManager_.dispose();\n    }\n  }\n\n  /**\n   * Start dragging a block.  This includes moving it to the drag surface.\n   *\n   * @param currentDragDeltaXY How far the pointer has moved from the position\n   *     at mouse down, in pixel units.\n   * @param healStack Whether or not to heal the stack after disconnecting.\n   */\n  startDrag(currentDragDeltaXY: Coordinate, healStack: boolean) {\n    if (!eventUtils.getGroup()) {\n      eventUtils.setGroup(true);\n    }\n    this.fireDragStartEvent_();\n\n    // Mutators don't have the same type of z-ordering as the normal workspace\n    // during a drag.  They have to rely on the order of the blocks in the SVG.\n    // For performance reasons that usually happens at the end of a drag,\n    // but do it at the beginning for mutators.\n    if (this.workspace_.isMutator) {\n      this.draggingBlock_.bringToFront();\n    }\n\n    // During a drag there may be a lot of rerenders, but not field changes.\n    // Turn the cache on so we don't do spurious remeasures during the drag.\n    dom.startTextWidthCache();\n    this.workspace_.setResizesEnabled(false);\n    blockAnimation.disconnectUiStop();\n\n    if (this.shouldDisconnect_(healStack)) {\n      this.disconnectBlock_(healStack, currentDragDeltaXY);\n    }\n    this.draggingBlock_.setDragging(true);\n    // For future consideration: we may be able to put moveToDragSurface inside\n    // the block dragger, which would also let the block not track the block\n    // drag surface.\n    this.draggingBlock_.moveToDragSurface();\n  }\n\n  /**\n   * Whether or not we should disconnect the block when a drag is started.\n   *\n   * @param healStack Whether or not to heal the stack after disconnecting.\n   * @returns True to disconnect the block, false otherwise.\n   */\n  protected shouldDisconnect_(healStack: boolean): boolean {\n    return !!(\n        this.draggingBlock_.getParent() ||\n        healStack && this.draggingBlock_.nextConnection &&\n            this.draggingBlock_.nextConnection.targetBlock());\n  }\n\n  /**\n   * Disconnects the block and moves it to a new location.\n   *\n   * @param healStack Whether or not to heal the stack after disconnecting.\n   * @param currentDragDeltaXY How far the pointer has moved from the position\n   *     at mouse down, in pixel units.\n   */\n  protected disconnectBlock_(\n      healStack: boolean, currentDragDeltaXY: Coordinate) {\n    this.draggingBlock_.unplug(healStack);\n    const delta = this.pixelsToWorkspaceUnits_(currentDragDeltaXY);\n    const newLoc = Coordinate.sum(this.startXY_, delta);\n\n    this.draggingBlock_.translate(newLoc.x, newLoc.y);\n    blockAnimation.disconnectUiEffect(this.draggingBlock_);\n    this.draggedConnectionManager_.updateAvailableConnections();\n  }\n\n  /** Fire a UI event at the start of a block drag. */\n  protected fireDragStartEvent_() {\n    const event = new (eventUtils.get(eventUtils.BLOCK_DRAG))(\n        this.draggingBlock_, true, this.draggingBlock_.getDescendants(false));\n    eventUtils.fire(event);\n  }\n\n  /**\n   * Execute a step of block dragging, based on the given event.  Update the\n   * display accordingly.\n   *\n   * @param e The most recent move event.\n   * @param currentDragDeltaXY How far the pointer has moved from the position\n   *     at the start of the drag, in pixel units.\n   */\n  drag(e: PointerEvent, currentDragDeltaXY: Coordinate) {\n    const delta = this.pixelsToWorkspaceUnits_(currentDragDeltaXY);\n    const newLoc = Coordinate.sum(this.startXY_, delta);\n    this.draggingBlock_.moveDuringDrag(newLoc);\n    this.dragIcons_(delta);\n\n    const oldDragTarget = this.dragTarget_;\n    this.dragTarget_ = this.workspace_.getDragTarget(e);\n\n    this.draggedConnectionManager_.update(delta, this.dragTarget_);\n    const oldWouldDeleteBlock = this.wouldDeleteBlock_;\n    this.wouldDeleteBlock_ = this.draggedConnectionManager_.wouldDeleteBlock;\n    if (oldWouldDeleteBlock !== this.wouldDeleteBlock_) {\n      // Prevent unnecessary add/remove class calls.\n      this.updateCursorDuringBlockDrag_();\n    }\n\n    // Call drag enter/exit/over after wouldDeleteBlock is called in\n    // InsertionMarkerManager.update.\n    if (this.dragTarget_ !== oldDragTarget) {\n      oldDragTarget && oldDragTarget.onDragExit(this.draggingBlock_);\n      this.dragTarget_ && this.dragTarget_.onDragEnter(this.draggingBlock_);\n    }\n    this.dragTarget_ && this.dragTarget_.onDragOver(this.draggingBlock_);\n  }\n\n  /**\n   * Finish a block drag and put the block back on the workspace.\n   *\n   * @param e The pointerup event.\n   * @param currentDragDeltaXY How far the pointer has moved from the position\n   *     at the start of the drag, in pixel units.\n   */\n  endDrag(e: PointerEvent, currentDragDeltaXY: Coordinate) {\n    // Make sure internal state is fresh.\n    this.drag(e, currentDragDeltaXY);\n    this.dragIconData_ = [];\n    this.fireDragEndEvent_();\n\n    dom.stopTextWidthCache();\n\n    blockAnimation.disconnectUiStop();\n\n    const preventMove = !!this.dragTarget_ &&\n        this.dragTarget_.shouldPreventMove(this.draggingBlock_);\n    let newLoc: Coordinate;\n    let delta: Coordinate|null = null;\n    if (preventMove) {\n      newLoc = this.startXY_;\n    } else {\n      const newValues = this.getNewLocationAfterDrag_(currentDragDeltaXY);\n      delta = newValues.delta;\n      newLoc = newValues.newLocation;\n    }\n    this.draggingBlock_.moveOffDragSurface(newLoc);\n\n    if (this.dragTarget_) {\n      this.dragTarget_.onDrop(this.draggingBlock_);\n    }\n\n    const deleted = this.maybeDeleteBlock_();\n    if (!deleted) {\n      // These are expensive and don't need to be done if we're deleting.\n      this.draggingBlock_.setDragging(false);\n      if (delta) {  // !preventMove\n        this.updateBlockAfterMove_(delta);\n      } else {\n        // Blocks dragged directly from a flyout may need to be bumped into\n        // bounds.\n        bumpObjects.bumpIntoBounds(\n            this.draggingBlock_.workspace,\n            this.workspace_.getMetricsManager().getScrollMetrics(true),\n            this.draggingBlock_);\n      }\n    }\n    this.workspace_.setResizesEnabled(true);\n\n    eventUtils.setGroup(false);\n  }\n\n  /**\n   * Calculates the drag delta and new location values after a block is dragged.\n   *\n   * @param currentDragDeltaXY How far the pointer has moved from the start of\n   *     the drag, in pixel units.\n   * @returns New location after drag. delta is in workspace units. newLocation\n   *     is the new coordinate where the block should end up.\n   */\n  protected getNewLocationAfterDrag_(currentDragDeltaXY: Coordinate):\n      {delta: Coordinate, newLocation: Coordinate} {\n    const delta = this.pixelsToWorkspaceUnits_(currentDragDeltaXY);\n    const newLocation = Coordinate.sum(this.startXY_, delta);\n    return {\n      delta,\n      newLocation,\n    };\n  }\n\n  /**\n   * May delete the dragging block, if allowed. If `this.wouldDeleteBlock_` is\n   * not true, the block will not be deleted. This should be called at the end\n   * of a block drag.\n   *\n   * @returns True if the block was deleted.\n   */\n  protected maybeDeleteBlock_(): boolean {\n    if (this.wouldDeleteBlock_) {\n      // Fire a move event, so we know where to go back to for an undo.\n      this.fireMoveEvent_();\n      this.draggingBlock_.dispose(false, true);\n      common.draggingConnections.length = 0;\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Updates the necessary information to place a block at a certain location.\n   *\n   * @param delta The change in location from where the block started the drag\n   *     to where it ended the drag.\n   */\n  protected updateBlockAfterMove_(delta: Coordinate) {\n    this.draggingBlock_.moveConnections(delta.x, delta.y);\n    this.fireMoveEvent_();\n    if (this.draggedConnectionManager_.wouldConnectBlock()) {\n      // Applying connections also rerenders the relevant blocks.\n      this.draggedConnectionManager_.applyConnections();\n    } else {\n      this.draggingBlock_.render();\n    }\n    this.draggingBlock_.scheduleSnapAndBump();\n  }\n\n  /** Fire a UI event at the end of a block drag. */\n  protected fireDragEndEvent_() {\n    const event = new (eventUtils.get(eventUtils.BLOCK_DRAG))(\n        this.draggingBlock_, false, this.draggingBlock_.getDescendants(false));\n    eventUtils.fire(event);\n  }\n\n  /**\n   * Adds or removes the style of the cursor for the toolbox.\n   * This is what changes the cursor to display an x when a deletable block is\n   * held over the toolbox.\n   *\n   * @param isEnd True if we are at the end of a drag, false otherwise.\n   */\n  protected updateToolboxStyle_(isEnd: boolean) {\n    const toolbox = this.workspace_.getToolbox();\n\n    if (toolbox) {\n      const style = this.draggingBlock_.isDeletable() ? 'blocklyToolboxDelete' :\n                                                        'blocklyToolboxGrab';\n\n      // AnyDuringMigration because:  Property 'removeStyle' does not exist on\n      // type 'IToolbox'.\n      if (isEnd &&\n          typeof (toolbox as AnyDuringMigration).removeStyle === 'function') {\n        // AnyDuringMigration because:  Property 'removeStyle' does not exist on\n        // type 'IToolbox'.\n        (toolbox as AnyDuringMigration).removeStyle(style);\n        // AnyDuringMigration because:  Property 'addStyle' does not exist on\n        // type 'IToolbox'.\n      } else if (\n          !isEnd &&\n          typeof (toolbox as AnyDuringMigration).addStyle === 'function') {\n        // AnyDuringMigration because:  Property 'addStyle' does not exist on\n        // type 'IToolbox'.\n        (toolbox as AnyDuringMigration).addStyle(style);\n      }\n    }\n  }\n\n  /** Fire a move event at the end of a block drag. */\n  protected fireMoveEvent_() {\n    const event = new (eventUtils.get(eventUtils.BLOCK_MOVE))(\n                      this.draggingBlock_) as BlockMove;\n    event.oldCoordinate = this.startXY_;\n    event.recordNew();\n    eventUtils.fire(event);\n  }\n\n  /**\n   * Update the cursor (and possibly the trash can lid) to reflect whether the\n   * dragging block would be deleted if released immediately.\n   */\n  protected updateCursorDuringBlockDrag_() {\n    this.draggingBlock_.setDeleteStyle(this.wouldDeleteBlock_);\n  }\n\n  /**\n   * Convert a coordinate object from pixels to workspace units, including a\n   * correction for mutator workspaces.\n   * This function does not consider differing origins.  It simply scales the\n   * input's x and y values.\n   *\n   * @param pixelCoord A coordinate with x and y values in CSS pixel units.\n   * @returns The input coordinate divided by the workspace scale.\n   */\n  protected pixelsToWorkspaceUnits_(pixelCoord: Coordinate): Coordinate {\n    const result = new Coordinate(\n        pixelCoord.x / this.workspace_.scale,\n        pixelCoord.y / this.workspace_.scale);\n    if (this.workspace_.isMutator) {\n      // If we're in a mutator, its scale is always 1, purely because of some\n      // oddities in our rendering optimizations.  The actual scale is the same\n      // as the scale on the parent workspace. Fix that for dragging.\n      const mainScale = this.workspace_.options.parentWorkspace!.scale;\n      result.scale(1 / mainScale);\n    }\n    return result;\n  }\n\n  /**\n   * Move all of the icons connected to this drag.\n   *\n   * @param dxy How far to move the icons from their original positions, in\n   *     workspace units.\n   */\n  protected dragIcons_(dxy: Coordinate) {\n    // Moving icons moves their associated bubbles.\n    for (let i = 0; i < this.dragIconData_.length; i++) {\n      const data = this.dragIconData_[i];\n      data.icon.setIconLocation(Coordinate.sum(data.location, dxy));\n    }\n  }\n\n  /**\n   * Get a list of the insertion markers that currently exist.  Drags have 0, 1,\n   * or 2 insertion markers.\n   *\n   * @returns A possibly empty list of insertion marker blocks.\n   */\n  getInsertionMarkers(): BlockSvg[] {\n    // No insertion markers with the old style of dragged connection managers.\n    if (this.draggedConnectionManager_ &&\n        this.draggedConnectionManager_.getInsertionMarkers) {\n      return this.draggedConnectionManager_.getInsertionMarkers();\n    }\n    return [];\n  }\n}\n\n/** Data about the position of a given icon. */\nexport interface IconPositionData {\n  location: Coordinate;\n  icon: Icon;\n}\n\n/**\n * Make a list of all of the icons (comment, warning, and mutator) that are\n * on this block and its descendants.  Moving an icon moves the bubble that\n * extends from it if that bubble is open.\n *\n * @param block The root block that is being dragged.\n * @returns The list of all icons and their locations.\n */\nfunction initIconData(block: BlockSvg): IconPositionData[] {\n  // Build a list of icons that need to be moved and where they started.\n  const dragIconData = [];\n  const descendants = (block.getDescendants(false));\n\n  for (let i = 0, descendant; descendant = descendants[i]; i++) {\n    const icons = descendant.getIcons();\n    for (let j = 0; j < icons.length; j++) {\n      const data = {\n        // Coordinate with x and y properties (workspace\n        // coordinates).\n        location: icons[j].getIconLocation(),  // Blockly.Icon\n        icon: icons[j],\n      };\n      dragIconData.push(data);\n    }\n  }\n  // AnyDuringMigration because:  Type '{ location: Coordinate | null; icon:\n  // Icon; }[]' is not assignable to type 'IconPositionData[]'.\n  return dragIconData as AnyDuringMigration;\n}\n\nregistry.register(registry.Type.BLOCK_DRAGGER, registry.DEFAULT, BlockDragger);\n","/* eslint-disable */\n;(function(root, factory) {\n  if (typeof define === 'function' && define.amd) { // AMD\n    define(['./blockly_compressed'], factory);\n  } else if (typeof exports === 'object') { // Node.js\n    module.exports = factory(require('./blockly_compressed'));\n  } else { // Browser\n    root.Blockly = factory(root.Blockly);\n  }\n}(this, function(Blockly) {\n/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview Blockly module; just a wrapper for blockly_compressed.js.\n */\n\nreturn Blockly;\n}));\n","/* eslint-disable */\n;(function(root, factory) {\n  if (typeof define === 'function' && define.amd) { // AMD\n    define(['./blockly'], factory);\n  } else if (typeof exports === 'object') { // Node.js\n    module.exports = factory(require('./blockly'));\n  } else { // Browser\n    root.Blockly = factory(root.Blockly);\n  }\n}(this, function(Blockly) {\n/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview Blockly core module for the browser. It includes blockly.js\n *               and adds a helper method for setting the locale.\n */\n\n/* eslint-disable */\n'use strict';\n\n\nreturn Blockly;\n}));\n","/* eslint-disable */\n;(function(root, factory) {\n  if (typeof define === 'function' && define.amd) { // AMD\n    define([], factory);\n  } else if (typeof exports === 'object') { // Node.js\n    module.exports = factory();\n  } else { // Browser\n    var messages = factory();\n    for (var key in messages) {\n      root.Blockly.Msg[key] = messages[key];\n    }\n  }\n}(this, function() {\n// This file was automatically generated.  Do not modify.\n\n'use strict';\n\nvar Blockly = Blockly || { Msg: Object.create(null) };\n\nBlockly.Msg[\"ADD_COMMENT\"] = \"Add Comment\";\nBlockly.Msg[\"CANNOT_DELETE_VARIABLE_PROCEDURE\"] = \"Can't delete the variable '%1' because it's part of the definition of the function '%2'\";\nBlockly.Msg[\"CHANGE_VALUE_TITLE\"] = \"Change value:\";\nBlockly.Msg[\"CLEAN_UP\"] = \"Clean up Blocks\";\nBlockly.Msg[\"COLLAPSED_WARNINGS_WARNING\"] = \"Collapsed blocks contain warnings.\";\nBlockly.Msg[\"COLLAPSE_ALL\"] = \"Collapse Blocks\";\nBlockly.Msg[\"COLLAPSE_BLOCK\"] = \"Collapse Block\";\nBlockly.Msg[\"COLOUR_BLEND_COLOUR1\"] = \"colour 1\";\nBlockly.Msg[\"COLOUR_BLEND_COLOUR2\"] = \"colour 2\";\nBlockly.Msg[\"COLOUR_BLEND_HELPURL\"] = \"https://meyerweb.com/eric/tools/color-blend/#:::rgbp\";\nBlockly.Msg[\"COLOUR_BLEND_RATIO\"] = \"ratio\";\nBlockly.Msg[\"COLOUR_BLEND_TITLE\"] = \"blend\";\nBlockly.Msg[\"COLOUR_BLEND_TOOLTIP\"] = \"Blends two colours together with a given ratio (0.0 - 1.0).\";\nBlockly.Msg[\"COLOUR_PICKER_HELPURL\"] = \"https://en.wikipedia.org/wiki/Color\";\nBlockly.Msg[\"COLOUR_PICKER_TOOLTIP\"] = \"Choose a colour from the palette.\";\nBlockly.Msg[\"COLOUR_RANDOM_HELPURL\"] = \"http://randomcolour.com\";\nBlockly.Msg[\"COLOUR_RANDOM_TITLE\"] = \"random colour\";\nBlockly.Msg[\"COLOUR_RANDOM_TOOLTIP\"] = \"Choose a colour at random.\";\nBlockly.Msg[\"COLOUR_RGB_BLUE\"] = \"blue\";\nBlockly.Msg[\"COLOUR_RGB_GREEN\"] = \"green\";\nBlockly.Msg[\"COLOUR_RGB_HELPURL\"] = \"https://www.december.com/html/spec/colorpercompact.html\";\nBlockly.Msg[\"COLOUR_RGB_RED\"] = \"red\";\nBlockly.Msg[\"COLOUR_RGB_TITLE\"] = \"colour with\";\nBlockly.Msg[\"COLOUR_RGB_TOOLTIP\"] = \"Create a colour with the specified amount of red, green, and blue. All values must be between 0 and 100.\";\nBlockly.Msg[\"CONTROLS_FLOW_STATEMENTS_HELPURL\"] = \"https://github.com/google/blockly/wiki/Loops#loop-termination-blocks\";\nBlockly.Msg[\"CONTROLS_FLOW_STATEMENTS_OPERATOR_BREAK\"] = \"break out of loop\";\nBlockly.Msg[\"CONTROLS_FLOW_STATEMENTS_OPERATOR_CONTINUE\"] = \"continue with next iteration of loop\";\nBlockly.Msg[\"CONTROLS_FLOW_STATEMENTS_TOOLTIP_BREAK\"] = \"Break out of the containing loop.\";\nBlockly.Msg[\"CONTROLS_FLOW_STATEMENTS_TOOLTIP_CONTINUE\"] = \"Skip the rest of this loop, and continue with the next iteration.\";\nBlockly.Msg[\"CONTROLS_FLOW_STATEMENTS_WARNING\"] = \"Warning: This block may only be used within a loop.\";\nBlockly.Msg[\"CONTROLS_FOREACH_HELPURL\"] = \"https://github.com/google/blockly/wiki/Loops#for-each\";\nBlockly.Msg[\"CONTROLS_FOREACH_TITLE\"] = \"for each item %1 in list %2\";\nBlockly.Msg[\"CONTROLS_FOREACH_TOOLTIP\"] = \"For each item in a list, set the variable '%1' to the item, and then do some statements.\";\nBlockly.Msg[\"CONTROLS_FOR_HELPURL\"] = \"https://github.com/google/blockly/wiki/Loops#count-with\";\nBlockly.Msg[\"CONTROLS_FOR_TITLE\"] = \"count with %1 from %2 to %3 by %4\";\nBlockly.Msg[\"CONTROLS_FOR_TOOLTIP\"] = \"Have the variable '%1' take on the values from the start number to the end number, counting by the specified interval, and do the specified blocks.\";\nBlockly.Msg[\"CONTROLS_IF_ELSEIF_TOOLTIP\"] = \"Add a condition to the if block.\";\nBlockly.Msg[\"CONTROLS_IF_ELSE_TOOLTIP\"] = \"Add a final, catch-all condition to the if block.\";\nBlockly.Msg[\"CONTROLS_IF_HELPURL\"] = \"https://github.com/google/blockly/wiki/IfElse\";\nBlockly.Msg[\"CONTROLS_IF_IF_TOOLTIP\"] = \"Add, remove, or reorder sections to reconfigure this if block.\";\nBlockly.Msg[\"CONTROLS_IF_MSG_ELSE\"] = \"else\";\nBlockly.Msg[\"CONTROLS_IF_MSG_ELSEIF\"] = \"else if\";\nBlockly.Msg[\"CONTROLS_IF_MSG_IF\"] = \"if\";\nBlockly.Msg[\"CONTROLS_IF_TOOLTIP_1\"] = \"If a value is true, then do some statements.\";\nBlockly.Msg[\"CONTROLS_IF_TOOLTIP_2\"] = \"If a value is true, then do the first block of statements. Otherwise, do the second block of statements.\";\nBlockly.Msg[\"CONTROLS_IF_TOOLTIP_3\"] = \"If the first value is true, then do the first block of statements. Otherwise, if the second value is true, do the second block of statements.\";\nBlockly.Msg[\"CONTROLS_IF_TOOLTIP_4\"] = \"If the first value is true, then do the first block of statements. Otherwise, if the second value is true, do the second block of statements. If none of the values are true, do the last block of statements.\";\nBlockly.Msg[\"CONTROLS_REPEAT_HELPURL\"] = \"https://en.wikipedia.org/wiki/For_loop\";\nBlockly.Msg[\"CONTROLS_REPEAT_INPUT_DO\"] = \"do\";\nBlockly.Msg[\"CONTROLS_REPEAT_TITLE\"] = \"repeat %1 times\";\nBlockly.Msg[\"CONTROLS_REPEAT_TOOLTIP\"] = \"Do some statements several times.\";\nBlockly.Msg[\"CONTROLS_WHILEUNTIL_HELPURL\"] = \"https://github.com/google/blockly/wiki/Loops#repeat\";\nBlockly.Msg[\"CONTROLS_WHILEUNTIL_OPERATOR_UNTIL\"] = \"repeat until\";\nBlockly.Msg[\"CONTROLS_WHILEUNTIL_OPERATOR_WHILE\"] = \"repeat while\";\nBlockly.Msg[\"CONTROLS_WHILEUNTIL_TOOLTIP_UNTIL\"] = \"While a value is false, then do some statements.\";\nBlockly.Msg[\"CONTROLS_WHILEUNTIL_TOOLTIP_WHILE\"] = \"While a value is true, then do some statements.\";\nBlockly.Msg[\"DELETE_ALL_BLOCKS\"] = \"Delete all %1 blocks?\";\nBlockly.Msg[\"DELETE_BLOCK\"] = \"Delete Block\";\nBlockly.Msg[\"DELETE_VARIABLE\"] = \"Delete the '%1' variable\";\nBlockly.Msg[\"DELETE_VARIABLE_CONFIRMATION\"] = \"Delete %1 uses of the '%2' variable?\";\nBlockly.Msg[\"DELETE_X_BLOCKS\"] = \"Delete %1 Blocks\";\nBlockly.Msg[\"DIALOG_CANCEL\"] = \"Cancel\";\nBlockly.Msg[\"DIALOG_OK\"] = \"OK\";\nBlockly.Msg[\"DISABLE_BLOCK\"] = \"Disable Block\";\nBlockly.Msg[\"DUPLICATE_BLOCK\"] = \"Duplicate\";\nBlockly.Msg[\"DUPLICATE_COMMENT\"] = \"Duplicate Comment\";\nBlockly.Msg[\"ENABLE_BLOCK\"] = \"Enable Block\";\nBlockly.Msg[\"EXPAND_ALL\"] = \"Expand Blocks\";\nBlockly.Msg[\"EXPAND_BLOCK\"] = \"Expand Block\";\nBlockly.Msg[\"EXTERNAL_INPUTS\"] = \"External Inputs\";\nBlockly.Msg[\"HELP\"] = \"Help\";\nBlockly.Msg[\"INLINE_INPUTS\"] = \"Inline Inputs\";\nBlockly.Msg[\"LISTS_CREATE_EMPTY_HELPURL\"] = \"https://github.com/google/blockly/wiki/Lists#create-empty-list\";\nBlockly.Msg[\"LISTS_CREATE_EMPTY_TITLE\"] = \"create empty list\";\nBlockly.Msg[\"LISTS_CREATE_EMPTY_TOOLTIP\"] = \"Returns a list, of length 0, containing no data records\";\nBlockly.Msg[\"LISTS_CREATE_WITH_CONTAINER_TITLE_ADD\"] = \"list\";\nBlockly.Msg[\"LISTS_CREATE_WITH_CONTAINER_TOOLTIP\"] = \"Add, remove, or reorder sections to reconfigure this list block.\";\nBlockly.Msg[\"LISTS_CREATE_WITH_HELPURL\"] = \"https://github.com/google/blockly/wiki/Lists#create-list-with\";\nBlockly.Msg[\"LISTS_CREATE_WITH_INPUT_WITH\"] = \"create list with\";\nBlockly.Msg[\"LISTS_CREATE_WITH_ITEM_TOOLTIP\"] = \"Add an item to the list.\";\nBlockly.Msg[\"LISTS_CREATE_WITH_TOOLTIP\"] = \"Create a list with any number of items.\";\nBlockly.Msg[\"LISTS_GET_INDEX_FIRST\"] = \"first\";\nBlockly.Msg[\"LISTS_GET_INDEX_FROM_END\"] = \"# from end\";\nBlockly.Msg[\"LISTS_GET_INDEX_FROM_START\"] = \"#\";\nBlockly.Msg[\"LISTS_GET_INDEX_GET\"] = \"get\";\nBlockly.Msg[\"LISTS_GET_INDEX_GET_REMOVE\"] = \"get and remove\";\nBlockly.Msg[\"LISTS_GET_INDEX_LAST\"] = \"last\";\nBlockly.Msg[\"LISTS_GET_INDEX_RANDOM\"] = \"random\";\nBlockly.Msg[\"LISTS_GET_INDEX_REMOVE\"] = \"remove\";\nBlockly.Msg[\"LISTS_GET_INDEX_TAIL\"] = \"\";\nBlockly.Msg[\"LISTS_GET_INDEX_TOOLTIP_GET_FIRST\"] = \"Returns the first item in a list.\";\nBlockly.Msg[\"LISTS_GET_INDEX_TOOLTIP_GET_FROM\"] = \"Returns the item at the specified position in a list.\";\nBlockly.Msg[\"LISTS_GET_INDEX_TOOLTIP_GET_LAST\"] = \"Returns the last item in a list.\";\nBlockly.Msg[\"LISTS_GET_INDEX_TOOLTIP_GET_RANDOM\"] = \"Returns a random item in a list.\";\nBlockly.Msg[\"LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_FIRST\"] = \"Removes and returns the first item in a list.\";\nBlockly.Msg[\"LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_FROM\"] = \"Removes and returns the item at the specified position in a list.\";\nBlockly.Msg[\"LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_LAST\"] = \"Removes and returns the last item in a list.\";\nBlockly.Msg[\"LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_RANDOM\"] = \"Removes and returns a random item in a list.\";\nBlockly.Msg[\"LISTS_GET_INDEX_TOOLTIP_REMOVE_FIRST\"] = \"Removes the first item in a list.\";\nBlockly.Msg[\"LISTS_GET_INDEX_TOOLTIP_REMOVE_FROM\"] = \"Removes the item at the specified position in a list.\";\nBlockly.Msg[\"LISTS_GET_INDEX_TOOLTIP_REMOVE_LAST\"] = \"Removes the last item in a list.\";\nBlockly.Msg[\"LISTS_GET_INDEX_TOOLTIP_REMOVE_RANDOM\"] = \"Removes a random item in a list.\";\nBlockly.Msg[\"LISTS_GET_SUBLIST_END_FROM_END\"] = \"to # from end\";\nBlockly.Msg[\"LISTS_GET_SUBLIST_END_FROM_START\"] = \"to #\";\nBlockly.Msg[\"LISTS_GET_SUBLIST_END_LAST\"] = \"to last\";\nBlockly.Msg[\"LISTS_GET_SUBLIST_HELPURL\"] = \"https://github.com/google/blockly/wiki/Lists#getting-a-sublist\";\nBlockly.Msg[\"LISTS_GET_SUBLIST_START_FIRST\"] = \"get sub-list from first\";\nBlockly.Msg[\"LISTS_GET_SUBLIST_START_FROM_END\"] = \"get sub-list from # from end\";\nBlockly.Msg[\"LISTS_GET_SUBLIST_START_FROM_START\"] = \"get sub-list from #\";\nBlockly.Msg[\"LISTS_GET_SUBLIST_TAIL\"] = \"\";\nBlockly.Msg[\"LISTS_GET_SUBLIST_TOOLTIP\"] = \"Creates a copy of the specified portion of a list.\";\nBlockly.Msg[\"LISTS_INDEX_FROM_END_TOOLTIP\"] = \"%1 is the last item.\";\nBlockly.Msg[\"LISTS_INDEX_FROM_START_TOOLTIP\"] = \"%1 is the first item.\";\nBlockly.Msg[\"LISTS_INDEX_OF_FIRST\"] = \"find first occurrence of item\";\nBlockly.Msg[\"LISTS_INDEX_OF_HELPURL\"] = \"https://github.com/google/blockly/wiki/Lists#getting-items-from-a-list\";\nBlockly.Msg[\"LISTS_INDEX_OF_LAST\"] = \"find last occurrence of item\";\nBlockly.Msg[\"LISTS_INDEX_OF_TOOLTIP\"] = \"Returns the index of the first/last occurrence of the item in the list. Returns %1 if item is not found.\";\nBlockly.Msg[\"LISTS_INLIST\"] = \"in list\";\nBlockly.Msg[\"LISTS_ISEMPTY_HELPURL\"] = \"https://github.com/google/blockly/wiki/Lists#is-empty\";\nBlockly.Msg[\"LISTS_ISEMPTY_TITLE\"] = \"%1 is empty\";\nBlockly.Msg[\"LISTS_ISEMPTY_TOOLTIP\"] = \"Returns true if the list is empty.\";\nBlockly.Msg[\"LISTS_LENGTH_HELPURL\"] = \"https://github.com/google/blockly/wiki/Lists#length-of\";\nBlockly.Msg[\"LISTS_LENGTH_TITLE\"] = \"length of %1\";\nBlockly.Msg[\"LISTS_LENGTH_TOOLTIP\"] = \"Returns the length of a list.\";\nBlockly.Msg[\"LISTS_REPEAT_HELPURL\"] = \"https://github.com/google/blockly/wiki/Lists#create-list-with\";\nBlockly.Msg[\"LISTS_REPEAT_TITLE\"] = \"create list with item %1 repeated %2 times\";\nBlockly.Msg[\"LISTS_REPEAT_TOOLTIP\"] = \"Creates a list consisting of the given value repeated the specified number of times.\";\nBlockly.Msg[\"LISTS_REVERSE_HELPURL\"] = \"https://github.com/google/blockly/wiki/Lists#reversing-a-list\";\nBlockly.Msg[\"LISTS_REVERSE_MESSAGE0\"] = \"reverse %1\";\nBlockly.Msg[\"LISTS_REVERSE_TOOLTIP\"] = \"Reverse a copy of a list.\";\nBlockly.Msg[\"LISTS_SET_INDEX_HELPURL\"] = \"https://github.com/google/blockly/wiki/Lists#in-list--set\";\nBlockly.Msg[\"LISTS_SET_INDEX_INPUT_TO\"] = \"as\";\nBlockly.Msg[\"LISTS_SET_INDEX_INSERT\"] = \"insert at\";\nBlockly.Msg[\"LISTS_SET_INDEX_SET\"] = \"set\";\nBlockly.Msg[\"LISTS_SET_INDEX_TOOLTIP_INSERT_FIRST\"] = \"Inserts the item at the start of a list.\";\nBlockly.Msg[\"LISTS_SET_INDEX_TOOLTIP_INSERT_FROM\"] = \"Inserts the item at the specified position in a list.\";\nBlockly.Msg[\"LISTS_SET_INDEX_TOOLTIP_INSERT_LAST\"] = \"Append the item to the end of a list.\";\nBlockly.Msg[\"LISTS_SET_INDEX_TOOLTIP_INSERT_RANDOM\"] = \"Inserts the item randomly in a list.\";\nBlockly.Msg[\"LISTS_SET_INDEX_TOOLTIP_SET_FIRST\"] = \"Sets the first item in a list.\";\nBlockly.Msg[\"LISTS_SET_INDEX_TOOLTIP_SET_FROM\"] = \"Sets the item at the specified position in a list.\";\nBlockly.Msg[\"LISTS_SET_INDEX_TOOLTIP_SET_LAST\"] = \"Sets the last item in a list.\";\nBlockly.Msg[\"LISTS_SET_INDEX_TOOLTIP_SET_RANDOM\"] = \"Sets a random item in a list.\";\nBlockly.Msg[\"LISTS_SORT_HELPURL\"] = \"https://github.com/google/blockly/wiki/Lists#sorting-a-list\";\nBlockly.Msg[\"LISTS_SORT_ORDER_ASCENDING\"] = \"ascending\";\nBlockly.Msg[\"LISTS_SORT_ORDER_DESCENDING\"] = \"descending\";\nBlockly.Msg[\"LISTS_SORT_TITLE\"] = \"sort %1 %2 %3\";\nBlockly.Msg[\"LISTS_SORT_TOOLTIP\"] = \"Sort a copy of a list.\";\nBlockly.Msg[\"LISTS_SORT_TYPE_IGNORECASE\"] = \"alphabetic, ignore case\";\nBlockly.Msg[\"LISTS_SORT_TYPE_NUMERIC\"] = \"numeric\";\nBlockly.Msg[\"LISTS_SORT_TYPE_TEXT\"] = \"alphabetic\";\nBlockly.Msg[\"LISTS_SPLIT_HELPURL\"] = \"https://github.com/google/blockly/wiki/Lists#splitting-strings-and-joining-lists\";\nBlockly.Msg[\"LISTS_SPLIT_LIST_FROM_TEXT\"] = \"make list from text\";\nBlockly.Msg[\"LISTS_SPLIT_TEXT_FROM_LIST\"] = \"make text from list\";\nBlockly.Msg[\"LISTS_SPLIT_TOOLTIP_JOIN\"] = \"Join a list of texts into one text, separated by a delimiter.\";\nBlockly.Msg[\"LISTS_SPLIT_TOOLTIP_SPLIT\"] = \"Split text into a list of texts, breaking at each delimiter.\";\nBlockly.Msg[\"LISTS_SPLIT_WITH_DELIMITER\"] = \"with delimiter\";\nBlockly.Msg[\"LOGIC_BOOLEAN_FALSE\"] = \"false\";\nBlockly.Msg[\"LOGIC_BOOLEAN_HELPURL\"] = \"https://github.com/google/blockly/wiki/Logic#values\";\nBlockly.Msg[\"LOGIC_BOOLEAN_TOOLTIP\"] = \"Returns either true or false.\";\nBlockly.Msg[\"LOGIC_BOOLEAN_TRUE\"] = \"true\";\nBlockly.Msg[\"LOGIC_COMPARE_HELPURL\"] = \"https://en.wikipedia.org/wiki/Inequality_(mathematics)\";\nBlockly.Msg[\"LOGIC_COMPARE_TOOLTIP_EQ\"] = \"Return true if both inputs equal each other.\";\nBlockly.Msg[\"LOGIC_COMPARE_TOOLTIP_GT\"] = \"Return true if the first input is greater than the second input.\";\nBlockly.Msg[\"LOGIC_COMPARE_TOOLTIP_GTE\"] = \"Return true if the first input is greater than or equal to the second input.\";\nBlockly.Msg[\"LOGIC_COMPARE_TOOLTIP_LT\"] = \"Return true if the first input is smaller than the second input.\";\nBlockly.Msg[\"LOGIC_COMPARE_TOOLTIP_LTE\"] = \"Return true if the first input is smaller than or equal to the second input.\";\nBlockly.Msg[\"LOGIC_COMPARE_TOOLTIP_NEQ\"] = \"Return true if both inputs are not equal to each other.\";\nBlockly.Msg[\"LOGIC_NEGATE_HELPURL\"] = \"https://github.com/google/blockly/wiki/Logic#not\";\nBlockly.Msg[\"LOGIC_NEGATE_TITLE\"] = \"not %1\";\nBlockly.Msg[\"LOGIC_NEGATE_TOOLTIP\"] = \"Returns true if the input is false. Returns false if the input is true.\";\nBlockly.Msg[\"LOGIC_NULL\"] = \"null\";\nBlockly.Msg[\"LOGIC_NULL_HELPURL\"] = \"https://en.wikipedia.org/wiki/Nullable_type\";\nBlockly.Msg[\"LOGIC_NULL_TOOLTIP\"] = \"Returns null.\";\nBlockly.Msg[\"LOGIC_OPERATION_AND\"] = \"and\";\nBlockly.Msg[\"LOGIC_OPERATION_HELPURL\"] = \"https://github.com/google/blockly/wiki/Logic#logical-operations\";\nBlockly.Msg[\"LOGIC_OPERATION_OR\"] = \"or\";\nBlockly.Msg[\"LOGIC_OPERATION_TOOLTIP_AND\"] = \"Return true if both inputs are true.\";\nBlockly.Msg[\"LOGIC_OPERATION_TOOLTIP_OR\"] = \"Return true if at least one of the inputs is true.\";\nBlockly.Msg[\"LOGIC_TERNARY_CONDITION\"] = \"test\";\nBlockly.Msg[\"LOGIC_TERNARY_HELPURL\"] = \"https://en.wikipedia.org/wiki/%3F:\";\nBlockly.Msg[\"LOGIC_TERNARY_IF_FALSE\"] = \"if false\";\nBlockly.Msg[\"LOGIC_TERNARY_IF_TRUE\"] = \"if true\";\nBlockly.Msg[\"LOGIC_TERNARY_TOOLTIP\"] = \"Check the condition in 'test'. If the condition is true, returns the 'if true' value; otherwise returns the 'if false' value.\";\nBlockly.Msg[\"MATH_ADDITION_SYMBOL\"] = \"+\";\nBlockly.Msg[\"MATH_ARITHMETIC_HELPURL\"] = \"https://en.wikipedia.org/wiki/Arithmetic\";\nBlockly.Msg[\"MATH_ARITHMETIC_TOOLTIP_ADD\"] = \"Return the sum of the two numbers.\";\nBlockly.Msg[\"MATH_ARITHMETIC_TOOLTIP_DIVIDE\"] = \"Return the quotient of the two numbers.\";\nBlockly.Msg[\"MATH_ARITHMETIC_TOOLTIP_MINUS\"] = \"Return the difference of the two numbers.\";\nBlockly.Msg[\"MATH_ARITHMETIC_TOOLTIP_MULTIPLY\"] = \"Return the product of the two numbers.\";\nBlockly.Msg[\"MATH_ARITHMETIC_TOOLTIP_POWER\"] = \"Return the first number raised to the power of the second number.\";\nBlockly.Msg[\"MATH_ATAN2_HELPURL\"] = \"https://en.wikipedia.org/wiki/Atan2\";\nBlockly.Msg[\"MATH_ATAN2_TITLE\"] = \"atan2 of X:%1 Y:%2\";\nBlockly.Msg[\"MATH_ATAN2_TOOLTIP\"] = \"Return the arctangent of point (X, Y) in degrees from -180 to 180.\";\nBlockly.Msg[\"MATH_CHANGE_HELPURL\"] = \"https://en.wikipedia.org/wiki/Programming_idiom#Incrementing_a_counter\";\nBlockly.Msg[\"MATH_CHANGE_TITLE\"] = \"change %1 by %2\";\nBlockly.Msg[\"MATH_CHANGE_TOOLTIP\"] = \"Add a number to variable '%1'.\";\nBlockly.Msg[\"MATH_CONSTANT_HELPURL\"] = \"https://en.wikipedia.org/wiki/Mathematical_constant\";\nBlockly.Msg[\"MATH_CONSTANT_TOOLTIP\"] = \"Return one of the common constants:  (3.141), e (2.718),  (1.618), sqrt(2) (1.414), sqrt() (0.707), or  (infinity).\";\nBlockly.Msg[\"MATH_CONSTRAIN_HELPURL\"] = \"https://en.wikipedia.org/wiki/Clamping_(graphics)\";\nBlockly.Msg[\"MATH_CONSTRAIN_TITLE\"] = \"constrain %1 low %2 high %3\";\nBlockly.Msg[\"MATH_CONSTRAIN_TOOLTIP\"] = \"Constrain a number to be between the specified limits (inclusive).\";\nBlockly.Msg[\"MATH_DIVISION_SYMBOL\"] = \"\";\nBlockly.Msg[\"MATH_IS_DIVISIBLE_BY\"] = \"is divisible by\";\nBlockly.Msg[\"MATH_IS_EVEN\"] = \"is even\";\nBlockly.Msg[\"MATH_IS_NEGATIVE\"] = \"is negative\";\nBlockly.Msg[\"MATH_IS_ODD\"] = \"is odd\";\nBlockly.Msg[\"MATH_IS_POSITIVE\"] = \"is positive\";\nBlockly.Msg[\"MATH_IS_PRIME\"] = \"is prime\";\nBlockly.Msg[\"MATH_IS_TOOLTIP\"] = \"Check if a number is an even, odd, prime, whole, positive, negative, or if it is divisible by certain number. Returns true or false.\";\nBlockly.Msg[\"MATH_IS_WHOLE\"] = \"is whole\";\nBlockly.Msg[\"MATH_MODULO_HELPURL\"] = \"https://en.wikipedia.org/wiki/Modulo_operation\";\nBlockly.Msg[\"MATH_MODULO_TITLE\"] = \"remainder of %1  %2\";\nBlockly.Msg[\"MATH_MODULO_TOOLTIP\"] = \"Return the remainder from dividing the two numbers.\";\nBlockly.Msg[\"MATH_MULTIPLICATION_SYMBOL\"] = \"\";\nBlockly.Msg[\"MATH_NUMBER_HELPURL\"] = \"https://en.wikipedia.org/wiki/Number\";\nBlockly.Msg[\"MATH_NUMBER_TOOLTIP\"] = \"A number.\";\nBlockly.Msg[\"MATH_ONLIST_HELPURL\"] = \"\";\nBlockly.Msg[\"MATH_ONLIST_OPERATOR_AVERAGE\"] = \"average of list\";\nBlockly.Msg[\"MATH_ONLIST_OPERATOR_MAX\"] = \"max of list\";\nBlockly.Msg[\"MATH_ONLIST_OPERATOR_MEDIAN\"] = \"median of list\";\nBlockly.Msg[\"MATH_ONLIST_OPERATOR_MIN\"] = \"min of list\";\nBlockly.Msg[\"MATH_ONLIST_OPERATOR_MODE\"] = \"modes of list\";\nBlockly.Msg[\"MATH_ONLIST_OPERATOR_RANDOM\"] = \"random item of list\";\nBlockly.Msg[\"MATH_ONLIST_OPERATOR_STD_DEV\"] = \"standard deviation of list\";\nBlockly.Msg[\"MATH_ONLIST_OPERATOR_SUM\"] = \"sum of list\";\nBlockly.Msg[\"MATH_ONLIST_TOOLTIP_AVERAGE\"] = \"Return the average (arithmetic mean) of the numeric values in the list.\";\nBlockly.Msg[\"MATH_ONLIST_TOOLTIP_MAX\"] = \"Return the largest number in the list.\";\nBlockly.Msg[\"MATH_ONLIST_TOOLTIP_MEDIAN\"] = \"Return the median number in the list.\";\nBlockly.Msg[\"MATH_ONLIST_TOOLTIP_MIN\"] = \"Return the smallest number in the list.\";\nBlockly.Msg[\"MATH_ONLIST_TOOLTIP_MODE\"] = \"Return a list of the most common item(s) in the list.\";\nBlockly.Msg[\"MATH_ONLIST_TOOLTIP_RANDOM\"] = \"Return a random element from the list.\";\nBlockly.Msg[\"MATH_ONLIST_TOOLTIP_STD_DEV\"] = \"Return the standard deviation of the list.\";\nBlockly.Msg[\"MATH_ONLIST_TOOLTIP_SUM\"] = \"Return the sum of all the numbers in the list.\";\nBlockly.Msg[\"MATH_POWER_SYMBOL\"] = \"^\";\nBlockly.Msg[\"MATH_RANDOM_FLOAT_HELPURL\"] = \"https://en.wikipedia.org/wiki/Random_number_generation\";\nBlockly.Msg[\"MATH_RANDOM_FLOAT_TITLE_RANDOM\"] = \"random fraction\";\nBlockly.Msg[\"MATH_RANDOM_FLOAT_TOOLTIP\"] = \"Return a random fraction between 0.0 (inclusive) and 1.0 (exclusive).\";\nBlockly.Msg[\"MATH_RANDOM_INT_HELPURL\"] = \"https://en.wikipedia.org/wiki/Random_number_generation\";\nBlockly.Msg[\"MATH_RANDOM_INT_TITLE\"] = \"random integer from %1 to %2\";\nBlockly.Msg[\"MATH_RANDOM_INT_TOOLTIP\"] = \"Return a random integer between the two specified limits, inclusive.\";\nBlockly.Msg[\"MATH_ROUND_HELPURL\"] = \"https://en.wikipedia.org/wiki/Rounding\";\nBlockly.Msg[\"MATH_ROUND_OPERATOR_ROUND\"] = \"round\";\nBlockly.Msg[\"MATH_ROUND_OPERATOR_ROUNDDOWN\"] = \"round down\";\nBlockly.Msg[\"MATH_ROUND_OPERATOR_ROUNDUP\"] = \"round up\";\nBlockly.Msg[\"MATH_ROUND_TOOLTIP\"] = \"Round a number up or down.\";\nBlockly.Msg[\"MATH_SINGLE_HELPURL\"] = \"https://en.wikipedia.org/wiki/Square_root\";\nBlockly.Msg[\"MATH_SINGLE_OP_ABSOLUTE\"] = \"absolute\";\nBlockly.Msg[\"MATH_SINGLE_OP_ROOT\"] = \"square root\";\nBlockly.Msg[\"MATH_SINGLE_TOOLTIP_ABS\"] = \"Return the absolute value of a number.\";\nBlockly.Msg[\"MATH_SINGLE_TOOLTIP_EXP\"] = \"Return e to the power of a number.\";\nBlockly.Msg[\"MATH_SINGLE_TOOLTIP_LN\"] = \"Return the natural logarithm of a number.\";\nBlockly.Msg[\"MATH_SINGLE_TOOLTIP_LOG10\"] = \"Return the base 10 logarithm of a number.\";\nBlockly.Msg[\"MATH_SINGLE_TOOLTIP_NEG\"] = \"Return the negation of a number.\";\nBlockly.Msg[\"MATH_SINGLE_TOOLTIP_POW10\"] = \"Return 10 to the power of a number.\";\nBlockly.Msg[\"MATH_SINGLE_TOOLTIP_ROOT\"] = \"Return the square root of a number.\";\nBlockly.Msg[\"MATH_SUBTRACTION_SYMBOL\"] = \"-\";\nBlockly.Msg[\"MATH_TRIG_ACOS\"] = \"acos\";\nBlockly.Msg[\"MATH_TRIG_ASIN\"] = \"asin\";\nBlockly.Msg[\"MATH_TRIG_ATAN\"] = \"atan\";\nBlockly.Msg[\"MATH_TRIG_COS\"] = \"cos\";\nBlockly.Msg[\"MATH_TRIG_HELPURL\"] = \"https://en.wikipedia.org/wiki/Trigonometric_functions\";\nBlockly.Msg[\"MATH_TRIG_SIN\"] = \"sin\";\nBlockly.Msg[\"MATH_TRIG_TAN\"] = \"tan\";\nBlockly.Msg[\"MATH_TRIG_TOOLTIP_ACOS\"] = \"Return the arccosine of a number.\";\nBlockly.Msg[\"MATH_TRIG_TOOLTIP_ASIN\"] = \"Return the arcsine of a number.\";\nBlockly.Msg[\"MATH_TRIG_TOOLTIP_ATAN\"] = \"Return the arctangent of a number.\";\nBlockly.Msg[\"MATH_TRIG_TOOLTIP_COS\"] = \"Return the cosine of a degree (not radian).\";\nBlockly.Msg[\"MATH_TRIG_TOOLTIP_SIN\"] = \"Return the sine of a degree (not radian).\";\nBlockly.Msg[\"MATH_TRIG_TOOLTIP_TAN\"] = \"Return the tangent of a degree (not radian).\";\nBlockly.Msg[\"NEW_COLOUR_VARIABLE\"] = \"Create colour variable...\";\nBlockly.Msg[\"NEW_NUMBER_VARIABLE\"] = \"Create number variable...\";\nBlockly.Msg[\"NEW_STRING_VARIABLE\"] = \"Create string variable...\";\nBlockly.Msg[\"NEW_VARIABLE\"] = \"Create variable...\";\nBlockly.Msg[\"NEW_VARIABLE_TITLE\"] = \"New variable name:\";\nBlockly.Msg[\"NEW_VARIABLE_TYPE_TITLE\"] = \"New variable type:\";\nBlockly.Msg[\"ORDINAL_NUMBER_SUFFIX\"] = \"\";\nBlockly.Msg[\"PROCEDURES_ALLOW_STATEMENTS\"] = \"allow statements\";\nBlockly.Msg[\"PROCEDURES_BEFORE_PARAMS\"] = \"with:\";\nBlockly.Msg[\"PROCEDURES_CALLNORETURN_HELPURL\"] = \"https://en.wikipedia.org/wiki/Subroutine\";\nBlockly.Msg[\"PROCEDURES_CALLNORETURN_TOOLTIP\"] = \"Run the user-defined function '%1'.\";\nBlockly.Msg[\"PROCEDURES_CALLRETURN_HELPURL\"] = \"https://en.wikipedia.org/wiki/Subroutine\";\nBlockly.Msg[\"PROCEDURES_CALLRETURN_TOOLTIP\"] = \"Run the user-defined function '%1' and use its output.\";\nBlockly.Msg[\"PROCEDURES_CALL_BEFORE_PARAMS\"] = \"with:\";\nBlockly.Msg[\"PROCEDURES_CREATE_DO\"] = \"Create '%1'\";\nBlockly.Msg[\"PROCEDURES_DEFNORETURN_COMMENT\"] = \"Describe this function...\";\nBlockly.Msg[\"PROCEDURES_DEFNORETURN_DO\"] = \"\";\nBlockly.Msg[\"PROCEDURES_DEFNORETURN_HELPURL\"] = \"https://en.wikipedia.org/wiki/Subroutine\";\nBlockly.Msg[\"PROCEDURES_DEFNORETURN_PROCEDURE\"] = \"do something\";\nBlockly.Msg[\"PROCEDURES_DEFNORETURN_TITLE\"] = \"to\";\nBlockly.Msg[\"PROCEDURES_DEFNORETURN_TOOLTIP\"] = \"Creates a function with no output.\";\nBlockly.Msg[\"PROCEDURES_DEFRETURN_HELPURL\"] = \"https://en.wikipedia.org/wiki/Subroutine\";\nBlockly.Msg[\"PROCEDURES_DEFRETURN_RETURN\"] = \"return\";\nBlockly.Msg[\"PROCEDURES_DEFRETURN_TOOLTIP\"] = \"Creates a function with an output.\";\nBlockly.Msg[\"PROCEDURES_DEF_DUPLICATE_WARNING\"] = \"Warning: This function has duplicate parameters.\";\nBlockly.Msg[\"PROCEDURES_HIGHLIGHT_DEF\"] = \"Highlight function definition\";\nBlockly.Msg[\"PROCEDURES_IFRETURN_HELPURL\"] = \"http://c2.com/cgi/wiki?GuardClause\";\nBlockly.Msg[\"PROCEDURES_IFRETURN_TOOLTIP\"] = \"If a value is true, then return a second value.\";\nBlockly.Msg[\"PROCEDURES_IFRETURN_WARNING\"] = \"Warning: This block may be used only within a function definition.\";\nBlockly.Msg[\"PROCEDURES_MUTATORARG_TITLE\"] = \"input name:\";\nBlockly.Msg[\"PROCEDURES_MUTATORARG_TOOLTIP\"] = \"Add an input to the function.\";\nBlockly.Msg[\"PROCEDURES_MUTATORCONTAINER_TITLE\"] = \"inputs\";\nBlockly.Msg[\"PROCEDURES_MUTATORCONTAINER_TOOLTIP\"] = \"Add, remove, or reorder inputs to this function.\";\nBlockly.Msg[\"REDO\"] = \"Redo\";\nBlockly.Msg[\"REMOVE_COMMENT\"] = \"Remove Comment\";\nBlockly.Msg[\"RENAME_VARIABLE\"] = \"Rename variable...\";\nBlockly.Msg[\"RENAME_VARIABLE_TITLE\"] = \"Rename all '%1' variables to:\";\nBlockly.Msg[\"TEXT_APPEND_HELPURL\"] = \"https://github.com/google/blockly/wiki/Text#text-modification\";\nBlockly.Msg[\"TEXT_APPEND_TITLE\"] = \"to %1 append text %2\";\nBlockly.Msg[\"TEXT_APPEND_TOOLTIP\"] = \"Append some text to variable '%1'.\";\nBlockly.Msg[\"TEXT_CHANGECASE_HELPURL\"] = \"https://github.com/google/blockly/wiki/Text#adjusting-text-case\";\nBlockly.Msg[\"TEXT_CHANGECASE_OPERATOR_LOWERCASE\"] = \"to lower case\";\nBlockly.Msg[\"TEXT_CHANGECASE_OPERATOR_TITLECASE\"] = \"to Title Case\";\nBlockly.Msg[\"TEXT_CHANGECASE_OPERATOR_UPPERCASE\"] = \"to UPPER CASE\";\nBlockly.Msg[\"TEXT_CHANGECASE_TOOLTIP\"] = \"Return a copy of the text in a different case.\";\nBlockly.Msg[\"TEXT_CHARAT_FIRST\"] = \"get first letter\";\nBlockly.Msg[\"TEXT_CHARAT_FROM_END\"] = \"get letter # from end\";\nBlockly.Msg[\"TEXT_CHARAT_FROM_START\"] = \"get letter #\";\nBlockly.Msg[\"TEXT_CHARAT_HELPURL\"] = \"https://github.com/google/blockly/wiki/Text#extracting-text\";\nBlockly.Msg[\"TEXT_CHARAT_LAST\"] = \"get last letter\";\nBlockly.Msg[\"TEXT_CHARAT_RANDOM\"] = \"get random letter\";\nBlockly.Msg[\"TEXT_CHARAT_TAIL\"] = \"\";\nBlockly.Msg[\"TEXT_CHARAT_TITLE\"] = \"in text %1 %2\";\nBlockly.Msg[\"TEXT_CHARAT_TOOLTIP\"] = \"Returns the letter at the specified position.\";\nBlockly.Msg[\"TEXT_COUNT_HELPURL\"] = \"https://github.com/google/blockly/wiki/Text#counting-substrings\";\nBlockly.Msg[\"TEXT_COUNT_MESSAGE0\"] = \"count %1 in %2\";\nBlockly.Msg[\"TEXT_COUNT_TOOLTIP\"] = \"Count how many times some text occurs within some other text.\";\nBlockly.Msg[\"TEXT_CREATE_JOIN_ITEM_TOOLTIP\"] = \"Add an item to the text.\";\nBlockly.Msg[\"TEXT_CREATE_JOIN_TITLE_JOIN\"] = \"join\";\nBlockly.Msg[\"TEXT_CREATE_JOIN_TOOLTIP\"] = \"Add, remove, or reorder sections to reconfigure this text block.\";\nBlockly.Msg[\"TEXT_GET_SUBSTRING_END_FROM_END\"] = \"to letter # from end\";\nBlockly.Msg[\"TEXT_GET_SUBSTRING_END_FROM_START\"] = \"to letter #\";\nBlockly.Msg[\"TEXT_GET_SUBSTRING_END_LAST\"] = \"to last letter\";\nBlockly.Msg[\"TEXT_GET_SUBSTRING_HELPURL\"] = \"https://github.com/google/blockly/wiki/Text#extracting-a-region-of-text\";\nBlockly.Msg[\"TEXT_GET_SUBSTRING_INPUT_IN_TEXT\"] = \"in text\";\nBlockly.Msg[\"TEXT_GET_SUBSTRING_START_FIRST\"] = \"get substring from first letter\";\nBlockly.Msg[\"TEXT_GET_SUBSTRING_START_FROM_END\"] = \"get substring from letter # from end\";\nBlockly.Msg[\"TEXT_GET_SUBSTRING_START_FROM_START\"] = \"get substring from letter #\";\nBlockly.Msg[\"TEXT_GET_SUBSTRING_TAIL\"] = \"\";\nBlockly.Msg[\"TEXT_GET_SUBSTRING_TOOLTIP\"] = \"Returns a specified portion of the text.\";\nBlockly.Msg[\"TEXT_INDEXOF_HELPURL\"] = \"https://github.com/google/blockly/wiki/Text#finding-text\";\nBlockly.Msg[\"TEXT_INDEXOF_OPERATOR_FIRST\"] = \"find first occurrence of text\";\nBlockly.Msg[\"TEXT_INDEXOF_OPERATOR_LAST\"] = \"find last occurrence of text\";\nBlockly.Msg[\"TEXT_INDEXOF_TITLE\"] = \"in text %1 %2 %3\";\nBlockly.Msg[\"TEXT_INDEXOF_TOOLTIP\"] = \"Returns the index of the first/last occurrence of the first text in the second text. Returns %1 if text is not found.\";\nBlockly.Msg[\"TEXT_ISEMPTY_HELPURL\"] = \"https://github.com/google/blockly/wiki/Text#checking-for-empty-text\";\nBlockly.Msg[\"TEXT_ISEMPTY_TITLE\"] = \"%1 is empty\";\nBlockly.Msg[\"TEXT_ISEMPTY_TOOLTIP\"] = \"Returns true if the provided text is empty.\";\nBlockly.Msg[\"TEXT_JOIN_HELPURL\"] = \"https://github.com/google/blockly/wiki/Text#text-creation\";\nBlockly.Msg[\"TEXT_JOIN_TITLE_CREATEWITH\"] = \"create text with\";\nBlockly.Msg[\"TEXT_JOIN_TOOLTIP\"] = \"Create a piece of text by joining together any number of items.\";\nBlockly.Msg[\"TEXT_LENGTH_HELPURL\"] = \"https://github.com/google/blockly/wiki/Text#text-modification\";\nBlockly.Msg[\"TEXT_LENGTH_TITLE\"] = \"length of %1\";\nBlockly.Msg[\"TEXT_LENGTH_TOOLTIP\"] = \"Returns the number of letters (including spaces) in the provided text.\";\nBlockly.Msg[\"TEXT_PRINT_HELPURL\"] = \"https://github.com/google/blockly/wiki/Text#printing-text\";\nBlockly.Msg[\"TEXT_PRINT_TITLE\"] = \"print %1\";\nBlockly.Msg[\"TEXT_PRINT_TOOLTIP\"] = \"Print the specified text, number or other value.\";\nBlockly.Msg[\"TEXT_PROMPT_HELPURL\"] = \"https://github.com/google/blockly/wiki/Text#getting-input-from-the-user\";\nBlockly.Msg[\"TEXT_PROMPT_TOOLTIP_NUMBER\"] = \"Prompt for user for a number.\";\nBlockly.Msg[\"TEXT_PROMPT_TOOLTIP_TEXT\"] = \"Prompt for user for some text.\";\nBlockly.Msg[\"TEXT_PROMPT_TYPE_NUMBER\"] = \"prompt for number with message\";\nBlockly.Msg[\"TEXT_PROMPT_TYPE_TEXT\"] = \"prompt for text with message\";\nBlockly.Msg[\"TEXT_REPLACE_HELPURL\"] = \"https://github.com/google/blockly/wiki/Text#replacing-substrings\";\nBlockly.Msg[\"TEXT_REPLACE_MESSAGE0\"] = \"replace %1 with %2 in %3\";\nBlockly.Msg[\"TEXT_REPLACE_TOOLTIP\"] = \"Replace all occurances of some text within some other text.\";\nBlockly.Msg[\"TEXT_REVERSE_HELPURL\"] = \"https://github.com/google/blockly/wiki/Text#reversing-text\";\nBlockly.Msg[\"TEXT_REVERSE_MESSAGE0\"] = \"reverse %1\";\nBlockly.Msg[\"TEXT_REVERSE_TOOLTIP\"] = \"Reverses the order of the characters in the text.\";\nBlockly.Msg[\"TEXT_TEXT_HELPURL\"] = \"https://en.wikipedia.org/wiki/String_(computer_science)\";\nBlockly.Msg[\"TEXT_TEXT_TOOLTIP\"] = \"A letter, word, or line of text.\";\nBlockly.Msg[\"TEXT_TRIM_HELPURL\"] = \"https://github.com/google/blockly/wiki/Text#trimming-removing-spaces\";\nBlockly.Msg[\"TEXT_TRIM_OPERATOR_BOTH\"] = \"trim spaces from both sides of\";\nBlockly.Msg[\"TEXT_TRIM_OPERATOR_LEFT\"] = \"trim spaces from left side of\";\nBlockly.Msg[\"TEXT_TRIM_OPERATOR_RIGHT\"] = \"trim spaces from right side of\";\nBlockly.Msg[\"TEXT_TRIM_TOOLTIP\"] = \"Return a copy of the text with spaces removed from one or both ends.\";\nBlockly.Msg[\"TODAY\"] = \"Today\";\nBlockly.Msg[\"UNDO\"] = \"Undo\";\nBlockly.Msg[\"UNNAMED_KEY\"] = \"unnamed\";\nBlockly.Msg[\"VARIABLES_DEFAULT_NAME\"] = \"item\";\nBlockly.Msg[\"VARIABLES_GET_CREATE_SET\"] = \"Create 'set %1'\";\nBlockly.Msg[\"VARIABLES_GET_HELPURL\"] = \"https://github.com/google/blockly/wiki/Variables#get\";\nBlockly.Msg[\"VARIABLES_GET_TOOLTIP\"] = \"Returns the value of this variable.\";\nBlockly.Msg[\"VARIABLES_SET\"] = \"set %1 to %2\";\nBlockly.Msg[\"VARIABLES_SET_CREATE_GET\"] = \"Create 'get %1'\";\nBlockly.Msg[\"VARIABLES_SET_HELPURL\"] = \"https://github.com/google/blockly/wiki/Variables#set\";\nBlockly.Msg[\"VARIABLES_SET_TOOLTIP\"] = \"Sets this variable to be equal to the input.\";\nBlockly.Msg[\"VARIABLE_ALREADY_EXISTS\"] = \"A variable named '%1' already exists.\";\nBlockly.Msg[\"VARIABLE_ALREADY_EXISTS_FOR_ANOTHER_TYPE\"] = \"A variable named '%1' already exists for another type: '%2'.\";\nBlockly.Msg[\"WORKSPACE_ARIA_LABEL\"] = \"Blockly Workspace\";\nBlockly.Msg[\"WORKSPACE_COMMENT_DEFAULT_TEXT\"] = \"Say something...\";\nBlockly.Msg[\"CONTROLS_FOREACH_INPUT_DO\"] = Blockly.Msg[\"CONTROLS_REPEAT_INPUT_DO\"];\nBlockly.Msg[\"CONTROLS_FOR_INPUT_DO\"] = Blockly.Msg[\"CONTROLS_REPEAT_INPUT_DO\"];\nBlockly.Msg[\"CONTROLS_IF_ELSEIF_TITLE_ELSEIF\"] = Blockly.Msg[\"CONTROLS_IF_MSG_ELSEIF\"];\nBlockly.Msg[\"CONTROLS_IF_ELSE_TITLE_ELSE\"] = Blockly.Msg[\"CONTROLS_IF_MSG_ELSE\"];\nBlockly.Msg[\"CONTROLS_IF_IF_TITLE_IF\"] = Blockly.Msg[\"CONTROLS_IF_MSG_IF\"];\nBlockly.Msg[\"CONTROLS_IF_MSG_THEN\"] = Blockly.Msg[\"CONTROLS_REPEAT_INPUT_DO\"];\nBlockly.Msg[\"CONTROLS_WHILEUNTIL_INPUT_DO\"] = Blockly.Msg[\"CONTROLS_REPEAT_INPUT_DO\"];\nBlockly.Msg[\"LISTS_CREATE_WITH_ITEM_TITLE\"] = Blockly.Msg[\"VARIABLES_DEFAULT_NAME\"];\nBlockly.Msg[\"LISTS_GET_INDEX_HELPURL\"] = Blockly.Msg[\"LISTS_INDEX_OF_HELPURL\"];\nBlockly.Msg[\"LISTS_GET_INDEX_INPUT_IN_LIST\"] = Blockly.Msg[\"LISTS_INLIST\"];\nBlockly.Msg[\"LISTS_GET_SUBLIST_INPUT_IN_LIST\"] = Blockly.Msg[\"LISTS_INLIST\"];\nBlockly.Msg[\"LISTS_INDEX_OF_INPUT_IN_LIST\"] = Blockly.Msg[\"LISTS_INLIST\"];\nBlockly.Msg[\"LISTS_SET_INDEX_INPUT_IN_LIST\"] = Blockly.Msg[\"LISTS_INLIST\"];\nBlockly.Msg[\"MATH_CHANGE_TITLE_ITEM\"] = Blockly.Msg[\"VARIABLES_DEFAULT_NAME\"];\nBlockly.Msg[\"PROCEDURES_DEFRETURN_COMMENT\"] = Blockly.Msg[\"PROCEDURES_DEFNORETURN_COMMENT\"];\nBlockly.Msg[\"PROCEDURES_DEFRETURN_DO\"] = Blockly.Msg[\"PROCEDURES_DEFNORETURN_DO\"];\nBlockly.Msg[\"PROCEDURES_DEFRETURN_PROCEDURE\"] = Blockly.Msg[\"PROCEDURES_DEFNORETURN_PROCEDURE\"];\nBlockly.Msg[\"PROCEDURES_DEFRETURN_TITLE\"] = Blockly.Msg[\"PROCEDURES_DEFNORETURN_TITLE\"];\nBlockly.Msg[\"TEXT_APPEND_VARIABLE\"] = Blockly.Msg[\"VARIABLES_DEFAULT_NAME\"];\nBlockly.Msg[\"TEXT_CREATE_JOIN_ITEM_TITLE_ITEM\"] = Blockly.Msg[\"VARIABLES_DEFAULT_NAME\"];\n\nBlockly.Msg[\"MATH_HUE\"] = \"230\";\nBlockly.Msg[\"LOOPS_HUE\"] = \"120\";\nBlockly.Msg[\"LISTS_HUE\"] = \"260\";\nBlockly.Msg[\"LOGIC_HUE\"] = \"210\";\nBlockly.Msg[\"VARIABLES_HUE\"] = \"330\";\nBlockly.Msg[\"TEXTS_HUE\"] = \"160\";\nBlockly.Msg[\"PROCEDURES_HUE\"] = \"290\";\nBlockly.Msg[\"COLOUR_HUE\"] = \"20\";\nBlockly.Msg[\"VARIABLES_DYNAMIC_HUE\"] = \"310\";\nreturn Blockly.Msg;\n}));\n","/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview All the blocks.  (Entry point for blocks_compressed.js.)\n * @suppress {extraRequire}\n */\n'use strict';\n\ngoog.module('Blockly.libraryBlocks');\n\nconst colour = goog.require('Blockly.libraryBlocks.colour');\nconst lists = goog.require('Blockly.libraryBlocks.lists');\nconst logic = goog.require('Blockly.libraryBlocks.logic');\nconst loops = goog.require('Blockly.libraryBlocks.loops');\nconst math = goog.require('Blockly.libraryBlocks.math');\nconst procedures = goog.require('Blockly.libraryBlocks.procedures');\nconst texts = goog.require('Blockly.libraryBlocks.texts');\nconst variables = goog.require('Blockly.libraryBlocks.variables');\nconst variablesDynamic = goog.require('Blockly.libraryBlocks.variablesDynamic');\n// const {BlockDefinition} = goog.requireType('Blockly.blocks');\n// TODO (6248): Properly import the BlockDefinition type.\n/* eslint-disable-next-line no-unused-vars */\nconst BlockDefinition = Object;\n\n\nexports.colour = colour;\nexports.lists = lists;\nexports.logic = logic;\nexports.loops = loops;\nexports.math = math;\nexports.procedures = procedures;\nexports.texts = texts;\nexports.variables = variables;\nexports.variablesDynamic = variablesDynamic;\n\n/**\n * A dictionary of the block definitions provided by all the\n * Blockly.libraryBlocks.* modules.\n * @type {!Object<string, !BlockDefinition>}\n */\nconst blocks = Object.assign(\n    {}, colour.blocks, lists.blocks, logic.blocks, loops.blocks, math.blocks,\n    procedures.blocks, variables.blocks, variablesDynamic.blocks);\nexports.blocks = blocks;\n","/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview Variable blocks for Blockly.\n * @suppress {checkTypes}\n */\n'use strict';\n\ngoog.module('Blockly.libraryBlocks.variablesDynamic');\n\n/* eslint-disable-next-line no-unused-vars */\nconst AbstractEvent = goog.requireType('Blockly.Events.Abstract');\nconst ContextMenu = goog.require('Blockly.ContextMenu');\nconst Extensions = goog.require('Blockly.Extensions');\nconst Variables = goog.require('Blockly.Variables');\nconst xml = goog.require('Blockly.utils.xml');\n/* eslint-disable-next-line no-unused-vars */\nconst {Block} = goog.requireType('Blockly.Block');\n// const {BlockDefinition} = goog.requireType('Blockly.blocks');\n// TODO (6248): Properly import the BlockDefinition type.\n/* eslint-disable-next-line no-unused-vars */\nconst BlockDefinition = Object;\nconst {Msg} = goog.require('Blockly.Msg');\nconst {createBlockDefinitionsFromJsonArray, defineBlocks} = goog.require('Blockly.common');\n/** @suppress {extraRequire} */\ngoog.require('Blockly.FieldLabel');\n/** @suppress {extraRequire} */\ngoog.require('Blockly.FieldVariable');\n\n\n/**\n * A dictionary of the block definitions provided by this module.\n * @type {!Object<string, !BlockDefinition>}\n */\nconst blocks = createBlockDefinitionsFromJsonArray([\n  // Block for variable getter.\n  {\n    'type': 'variables_get_dynamic',\n    'message0': '%1',\n    'args0': [{\n      'type': 'field_variable',\n      'name': 'VAR',\n      'variable': '%{BKY_VARIABLES_DEFAULT_NAME}',\n    }],\n    'output': null,\n    'style': 'variable_dynamic_blocks',\n    'helpUrl': '%{BKY_VARIABLES_GET_HELPURL}',\n    'tooltip': '%{BKY_VARIABLES_GET_TOOLTIP}',\n    'extensions': ['contextMenu_variableDynamicSetterGetter'],\n  },\n  // Block for variable setter.\n  {\n    'type': 'variables_set_dynamic',\n    'message0': '%{BKY_VARIABLES_SET}',\n    'args0': [\n      {\n        'type': 'field_variable',\n        'name': 'VAR',\n        'variable': '%{BKY_VARIABLES_DEFAULT_NAME}',\n      },\n      {\n        'type': 'input_value',\n        'name': 'VALUE',\n      },\n    ],\n    'previousStatement': null,\n    'nextStatement': null,\n    'style': 'variable_dynamic_blocks',\n    'tooltip': '%{BKY_VARIABLES_SET_TOOLTIP}',\n    'helpUrl': '%{BKY_VARIABLES_SET_HELPURL}',\n    'extensions': ['contextMenu_variableDynamicSetterGetter'],\n  },\n]);\nexports.blocks = blocks;\n\n/**\n * Mixin to add context menu items to create getter/setter blocks for this\n * setter/getter.\n * Used by blocks 'variables_set_dynamic' and 'variables_get_dynamic'.\n * @mixin\n * @augments Block\n * @readonly\n */\nconst CUSTOM_CONTEXT_MENU_VARIABLE_GETTER_SETTER_MIXIN = {\n  /**\n   * Add menu option to create getter/setter block for this setter/getter.\n   * @param {!Array} options List of menu options to add to.\n   * @this {Block}\n   */\n  customContextMenu: function(options) {\n    // Getter blocks have the option to create a setter block, and vice versa.\n    if (!this.isInFlyout) {\n      let oppositeType;\n      let contextMenuMsg;\n      const id = this.getFieldValue('VAR');\n      const variableModel = this.workspace.getVariableById(id);\n      const varType = variableModel.type;\n      if (this.type === 'variables_get_dynamic') {\n        oppositeType = 'variables_set_dynamic';\n        contextMenuMsg = Msg['VARIABLES_GET_CREATE_SET'];\n      } else {\n        oppositeType = 'variables_get_dynamic';\n        contextMenuMsg = Msg['VARIABLES_SET_CREATE_GET'];\n      }\n\n      const option = {enabled: this.workspace.remainingCapacity() > 0};\n      const name = this.getField('VAR').getText();\n      option.text = contextMenuMsg.replace('%1', name);\n      const xmlField = xml.createElement('field');\n      xmlField.setAttribute('name', 'VAR');\n      xmlField.setAttribute('variabletype', varType);\n      xmlField.appendChild(xml.createTextNode(name));\n      const xmlBlock = xml.createElement('block');\n      xmlBlock.setAttribute('type', oppositeType);\n      xmlBlock.appendChild(xmlField);\n      option.callback = ContextMenu.callbackFactory(this, xmlBlock);\n      options.push(option);\n    } else {\n      if (this.type === 'variables_get_dynamic' ||\n          this.type === 'variables_get_reporter_dynamic') {\n        const renameOption = {\n          text: Msg['RENAME_VARIABLE'],\n          enabled: true,\n          callback: renameOptionCallbackFactory(this),\n        };\n        const name = this.getField('VAR').getText();\n        const deleteOption = {\n          text: Msg['DELETE_VARIABLE'].replace('%1', name),\n          enabled: true,\n          callback: deleteOptionCallbackFactory(this),\n        };\n        options.unshift(renameOption);\n        options.unshift(deleteOption);\n      }\n    }\n  },\n  /**\n   * Called whenever anything on the workspace changes.\n   * Set the connection type for this block.\n   * @param {AbstractEvent} _e Change event.\n   * @this {Block}\n   */\n  onchange: function(_e) {\n    const id = this.getFieldValue('VAR');\n    const variableModel = Variables.getVariable(this.workspace, id);\n    if (this.type === 'variables_get_dynamic') {\n      this.outputConnection.setCheck(variableModel.type);\n    } else {\n      this.getInput('VALUE').connection.setCheck(variableModel.type);\n    }\n  },\n};\n\n/**\n * Factory for callbacks for rename variable dropdown menu option\n * associated with a variable getter block.\n * @param {!Block} block The block with the variable to rename.\n * @return {!function()} A function that renames the variable.\n */\nconst renameOptionCallbackFactory = function(block) {\n  return function() {\n    const workspace = block.workspace;\n    const variable = block.getField('VAR').getVariable();\n    Variables.renameVariable(workspace, variable);\n  };\n};\n\n/**\n * Factory for callbacks for delete variable dropdown menu option\n * associated with a variable getter block.\n * @param {!Block} block The block with the variable to delete.\n * @return {!function()} A function that deletes the variable.\n */\nconst deleteOptionCallbackFactory = function(block) {\n  return function() {\n    const workspace = block.workspace;\n    const variable = block.getField('VAR').getVariable();\n    workspace.deleteVariableById(variable.getId());\n    workspace.refreshToolboxSelection();\n  };\n};\n\nExtensions.registerMixin(\n    'contextMenu_variableDynamicSetterGetter',\n    CUSTOM_CONTEXT_MENU_VARIABLE_GETTER_SETTER_MIXIN);\n\n// Register provided blocks.\ndefineBlocks(blocks);\n","/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview Variable blocks for Blockly.\n * @suppress {checkTypes}\n */\n'use strict';\n\ngoog.module('Blockly.libraryBlocks.variables');\n\nconst ContextMenu = goog.require('Blockly.ContextMenu');\nconst Extensions = goog.require('Blockly.Extensions');\nconst Variables = goog.require('Blockly.Variables');\nconst xmlUtils = goog.require('Blockly.utils.xml');\n/* eslint-disable-next-line no-unused-vars */\nconst {Block} = goog.requireType('Blockly.Block');\n// const {BlockDefinition} = goog.requireType('Blockly.blocks');\n// TODO (6248): Properly import the BlockDefinition type.\n/* eslint-disable-next-line no-unused-vars */\nconst BlockDefinition = Object;\nconst {Msg} = goog.require('Blockly.Msg');\nconst {createBlockDefinitionsFromJsonArray, defineBlocks} = goog.require('Blockly.common');\n/** @suppress {extraRequire} */\ngoog.require('Blockly.FieldLabel');\n/** @suppress {extraRequire} */\ngoog.require('Blockly.FieldVariable');\n\n\n/**\n * A dictionary of the block definitions provided by this module.\n * @type {!Object<string, !BlockDefinition>}\n */\nconst blocks = createBlockDefinitionsFromJsonArray([\n  // Block for variable getter.\n  {\n    'type': 'variables_get',\n    'message0': '%1',\n    'args0': [\n      {\n        'type': 'field_variable',\n        'name': 'VAR',\n        'variable': '%{BKY_VARIABLES_DEFAULT_NAME}',\n      },\n    ],\n    'output': null,\n    'style': 'variable_blocks',\n    'helpUrl': '%{BKY_VARIABLES_GET_HELPURL}',\n    'tooltip': '%{BKY_VARIABLES_GET_TOOLTIP}',\n    'extensions': ['contextMenu_variableSetterGetter'],\n  },\n  // Block for variable setter.\n  {\n    'type': 'variables_set',\n    'message0': '%{BKY_VARIABLES_SET}',\n    'args0': [\n      {\n        'type': 'field_variable',\n        'name': 'VAR',\n        'variable': '%{BKY_VARIABLES_DEFAULT_NAME}',\n      },\n      {\n        'type': 'input_value',\n        'name': 'VALUE',\n      },\n    ],\n    'previousStatement': null,\n    'nextStatement': null,\n    'style': 'variable_blocks',\n    'tooltip': '%{BKY_VARIABLES_SET_TOOLTIP}',\n    'helpUrl': '%{BKY_VARIABLES_SET_HELPURL}',\n    'extensions': ['contextMenu_variableSetterGetter'],\n  },\n]);\nexports.blocks = blocks;\n\n\n/**\n * Mixin to add context menu items to create getter/setter blocks for this\n * setter/getter.\n * Used by blocks 'variables_set' and 'variables_get'.\n * @mixin\n * @augments Block\n * @package\n * @readonly\n */\nconst CUSTOM_CONTEXT_MENU_VARIABLE_GETTER_SETTER_MIXIN = {\n  /**\n   * Add menu option to create getter/setter block for this setter/getter.\n   * @param {!Array} options List of menu options to add to.\n   * @this {Block}\n   */\n  customContextMenu: function(options) {\n    if (!this.isInFlyout) {\n      let oppositeType;\n      let contextMenuMsg;\n      // Getter blocks have the option to create a setter block, and vice versa.\n      if (this.type === 'variables_get') {\n        oppositeType = 'variables_set';\n        contextMenuMsg = Msg['VARIABLES_GET_CREATE_SET'];\n      } else {\n        oppositeType = 'variables_get';\n        contextMenuMsg = Msg['VARIABLES_SET_CREATE_GET'];\n      }\n\n      const option = {enabled: this.workspace.remainingCapacity() > 0};\n      const name = this.getField('VAR').getText();\n      option.text = contextMenuMsg.replace('%1', name);\n      const xmlField = xmlUtils.createElement('field');\n      xmlField.setAttribute('name', 'VAR');\n      xmlField.appendChild(xmlUtils.createTextNode(name));\n      const xmlBlock = xmlUtils.createElement('block');\n      xmlBlock.setAttribute('type', oppositeType);\n      xmlBlock.appendChild(xmlField);\n      option.callback = ContextMenu.callbackFactory(this, xmlBlock);\n      options.push(option);\n      // Getter blocks have the option to rename or delete that variable.\n    } else {\n      if (this.type === 'variables_get' ||\n          this.type === 'variables_get_reporter') {\n        const renameOption = {\n          text: Msg['RENAME_VARIABLE'],\n          enabled: true,\n          callback: renameOptionCallbackFactory(this),\n        };\n        const name = this.getField('VAR').getText();\n        const deleteOption = {\n          text: Msg['DELETE_VARIABLE'].replace('%1', name),\n          enabled: true,\n          callback: deleteOptionCallbackFactory(this),\n        };\n        options.unshift(renameOption);\n        options.unshift(deleteOption);\n      }\n    }\n  },\n};\n\n/**\n * Factory for callbacks for rename variable dropdown menu option\n * associated with a variable getter block.\n * @param {!Block} block The block with the variable to rename.\n * @return {!function()} A function that renames the variable.\n */\nconst renameOptionCallbackFactory = function(block) {\n  return function() {\n    const workspace = block.workspace;\n    const variable = block.getField('VAR').getVariable();\n    Variables.renameVariable(workspace, variable);\n  };\n};\n\n/**\n * Factory for callbacks for delete variable dropdown menu option\n * associated with a variable getter block.\n * @param {!Block} block The block with the variable to delete.\n * @return {!function()} A function that deletes the variable.\n */\nconst deleteOptionCallbackFactory = function(block) {\n  return function() {\n    const workspace = block.workspace;\n    const variable = block.getField('VAR').getVariable();\n    workspace.deleteVariableById(variable.getId());\n    workspace.refreshToolboxSelection();\n  };\n};\n\nExtensions.registerMixin(\n    'contextMenu_variableSetterGetter',\n    CUSTOM_CONTEXT_MENU_VARIABLE_GETTER_SETTER_MIXIN);\n\n// Register provided blocks.\ndefineBlocks(blocks);\n","/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview Text blocks for Blockly.\n * @suppress {checkTypes}\n */\n'use strict';\n\ngoog.module('Blockly.libraryBlocks.texts');\n\nconst Extensions = goog.require('Blockly.Extensions');\nconst {Msg} = goog.require('Blockly.Msg');\n/* eslint-disable-next-line no-unused-vars */\nconst xmlUtils = goog.require('Blockly.utils.xml');\nconst {Align} = goog.require('Blockly.Input');\n/* eslint-disable-next-line no-unused-vars */\nconst {Block} = goog.requireType('Blockly.Block');\n// const {BlockDefinition} = goog.requireType('Blockly.blocks');\n// TODO (6248): Properly import the BlockDefinition type.\n/* eslint-disable-next-line no-unused-vars */\nconst BlockDefinition = Object;\nconst {ConnectionType} = goog.require('Blockly.ConnectionType');\nconst {FieldDropdown} = goog.require('Blockly.FieldDropdown');\nconst {FieldImage} = goog.require('Blockly.FieldImage');\nconst {FieldTextInput} = goog.require('Blockly.FieldTextInput');\nconst {Mutator} = goog.require('Blockly.Mutator');\n/* eslint-disable-next-line no-unused-vars */\nconst {Workspace} = goog.requireType('Blockly.Workspace');\nconst {createBlockDefinitionsFromJsonArray, defineBlocks} = goog.require('Blockly.common');\n/** @suppress {extraRequire} */\ngoog.require('Blockly.FieldMultilineInput');\n/** @suppress {extraRequire} */\ngoog.require('Blockly.FieldVariable');\n\n\n/**\n * A dictionary of the block definitions provided by this module.\n * @type {!Object<string, !BlockDefinition>}\n */\nconst blocks = createBlockDefinitionsFromJsonArray([\n  // Block for text value\n  {\n    'type': 'text',\n    'message0': '%1',\n    'args0': [{\n      'type': 'field_input',\n      'name': 'TEXT',\n      'text': '',\n    }],\n    'output': 'String',\n    'style': 'text_blocks',\n    'helpUrl': '%{BKY_TEXT_TEXT_HELPURL}',\n    'tooltip': '%{BKY_TEXT_TEXT_TOOLTIP}',\n    'extensions': [\n      'text_quotes',\n      'parent_tooltip_when_inline',\n    ],\n  },\n  {\n    'type': 'text_multiline',\n    'message0': '%1 %2',\n    'args0': [\n      {\n        'type': 'field_image',\n        'src':\n            'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAARCAYAAADpP' +\n            'U2iAAAABGdBTUEAALGPC/xhBQAAAAlwSFlzAAAdhgAAHYYBXaITgQAAABh0RVh0' +\n            'U29mdHdhcmUAcGFpbnQubmV0IDQuMS42/U4J6AAAAP1JREFUOE+Vks0KQUEYhjm' +\n            'RIja4ABtZ2dm5A3t3Ia6AUm7CylYuQRaUhZSlLZJiQbFAyRnPN33y01HOW08z88' +\n            '73zpwzM4F3GWOCruvGIE4/rLaV+Nq1hVGMBqzhqlxgCys4wJA65xnogMHsQ5luj' +\n            'nYHTejBBCK2mE4abjCgMGhNxHgDFWjDSG07kdfVa2pZMf4ZyMAdWmpZMfYOsLiD' +\n            'MYMjlMB+K613QISRhTnITnsYg5yUd0DETmEoMlkFOeIT/A58iyK5E18BuTBfgYX' +\n            'fwNJv4P9/oEBerLylOnRhygmGdPpTTBZAPkde61lbQe4moWUvYUZYLfUNftIY4z' +\n            'wA5X2Z9AYnQrEAAAAASUVORK5CYII=',\n        'width': 12,\n        'height': 17,\n        'alt': '\\u00B6',\n      },\n      {\n        'type': 'field_multilinetext',\n        'name': 'TEXT',\n        'text': '',\n      },\n    ],\n    'output': 'String',\n    'style': 'text_blocks',\n    'helpUrl': '%{BKY_TEXT_TEXT_HELPURL}',\n    'tooltip': '%{BKY_TEXT_TEXT_TOOLTIP}',\n    'extensions': [\n      'parent_tooltip_when_inline',\n    ],\n  },\n  {\n    'type': 'text_join',\n    'message0': '',\n    'output': 'String',\n    'style': 'text_blocks',\n    'helpUrl': '%{BKY_TEXT_JOIN_HELPURL}',\n    'tooltip': '%{BKY_TEXT_JOIN_TOOLTIP}',\n    'mutator': 'text_join_mutator',\n\n  },\n  {\n    'type': 'text_create_join_container',\n    'message0': '%{BKY_TEXT_CREATE_JOIN_TITLE_JOIN} %1 %2',\n    'args0': [\n      {\n        'type': 'input_dummy',\n      },\n      {\n        'type': 'input_statement',\n        'name': 'STACK',\n      },\n    ],\n    'style': 'text_blocks',\n    'tooltip': '%{BKY_TEXT_CREATE_JOIN_TOOLTIP}',\n    'enableContextMenu': false,\n  },\n  {\n    'type': 'text_create_join_item',\n    'message0': '%{BKY_TEXT_CREATE_JOIN_ITEM_TITLE_ITEM}',\n    'previousStatement': null,\n    'nextStatement': null,\n    'style': 'text_blocks',\n    'tooltip': '%{BKY_TEXT_CREATE_JOIN_ITEM_TOOLTIP}',\n    'enableContextMenu': false,\n  },\n  {\n    'type': 'text_append',\n    'message0': '%{BKY_TEXT_APPEND_TITLE}',\n    'args0': [\n      {\n        'type': 'field_variable',\n        'name': 'VAR',\n        'variable': '%{BKY_TEXT_APPEND_VARIABLE}',\n      },\n      {\n        'type': 'input_value',\n        'name': 'TEXT',\n      },\n    ],\n    'previousStatement': null,\n    'nextStatement': null,\n    'style': 'text_blocks',\n    'extensions': [\n      'text_append_tooltip',\n    ],\n  },\n  {\n    'type': 'text_length',\n    'message0': '%{BKY_TEXT_LENGTH_TITLE}',\n    'args0': [\n      {\n        'type': 'input_value',\n        'name': 'VALUE',\n        'check': ['String', 'Array'],\n      },\n    ],\n    'output': 'Number',\n    'style': 'text_blocks',\n    'tooltip': '%{BKY_TEXT_LENGTH_TOOLTIP}',\n    'helpUrl': '%{BKY_TEXT_LENGTH_HELPURL}',\n  },\n  {\n    'type': 'text_isEmpty',\n    'message0': '%{BKY_TEXT_ISEMPTY_TITLE}',\n    'args0': [\n      {\n        'type': 'input_value',\n        'name': 'VALUE',\n        'check': ['String', 'Array'],\n      },\n    ],\n    'output': 'Boolean',\n    'style': 'text_blocks',\n    'tooltip': '%{BKY_TEXT_ISEMPTY_TOOLTIP}',\n    'helpUrl': '%{BKY_TEXT_ISEMPTY_HELPURL}',\n  },\n  {\n    'type': 'text_indexOf',\n    'message0': '%{BKY_TEXT_INDEXOF_TITLE}',\n    'args0': [\n      {\n        'type': 'input_value',\n        'name': 'VALUE',\n        'check': 'String',\n      },\n      {\n        'type': 'field_dropdown',\n        'name': 'END',\n        'options': [\n          [\n            '%{BKY_TEXT_INDEXOF_OPERATOR_FIRST}',\n            'FIRST',\n          ],\n          [\n            '%{BKY_TEXT_INDEXOF_OPERATOR_LAST}',\n            'LAST',\n          ],\n        ],\n      },\n      {\n        'type': 'input_value',\n        'name': 'FIND',\n        'check': 'String',\n      },\n    ],\n    'output': 'Number',\n    'style': 'text_blocks',\n    'helpUrl': '%{BKY_TEXT_INDEXOF_HELPURL}',\n    'inputsInline': true,\n    'extensions': [\n      'text_indexOf_tooltip',\n    ],\n  },\n  {\n    'type': 'text_charAt',\n    'message0': '%{BKY_TEXT_CHARAT_TITLE}',  // \"in text %1 %2\"\n    'args0': [\n      {\n        'type': 'input_value',\n        'name': 'VALUE',\n        'check': 'String',\n      },\n      {\n        'type': 'field_dropdown',\n        'name': 'WHERE',\n        'options': [\n          ['%{BKY_TEXT_CHARAT_FROM_START}', 'FROM_START'],\n          ['%{BKY_TEXT_CHARAT_FROM_END}', 'FROM_END'],\n          ['%{BKY_TEXT_CHARAT_FIRST}', 'FIRST'],\n          ['%{BKY_TEXT_CHARAT_LAST}', 'LAST'],\n          ['%{BKY_TEXT_CHARAT_RANDOM}', 'RANDOM'],\n        ],\n      },\n    ],\n    'output': 'String',\n    'style': 'text_blocks',\n    'helpUrl': '%{BKY_TEXT_CHARAT_HELPURL}',\n    'inputsInline': true,\n    'mutator': 'text_charAt_mutator',\n  },\n]);\nexports.blocks = blocks;\n\nblocks['text_getSubstring'] = {\n  /**\n   * Block for getting substring.\n   * @this {Block}\n   */\n  init: function() {\n    this['WHERE_OPTIONS_1'] = [\n      [Msg['TEXT_GET_SUBSTRING_START_FROM_START'], 'FROM_START'],\n      [Msg['TEXT_GET_SUBSTRING_START_FROM_END'], 'FROM_END'],\n      [Msg['TEXT_GET_SUBSTRING_START_FIRST'], 'FIRST'],\n    ];\n    this['WHERE_OPTIONS_2'] = [\n      [Msg['TEXT_GET_SUBSTRING_END_FROM_START'], 'FROM_START'],\n      [Msg['TEXT_GET_SUBSTRING_END_FROM_END'], 'FROM_END'],\n      [Msg['TEXT_GET_SUBSTRING_END_LAST'], 'LAST'],\n    ];\n    this.setHelpUrl(Msg['TEXT_GET_SUBSTRING_HELPURL']);\n    this.setStyle('text_blocks');\n    this.appendValueInput('STRING').setCheck('String').appendField(\n        Msg['TEXT_GET_SUBSTRING_INPUT_IN_TEXT']);\n    this.appendDummyInput('AT1');\n    this.appendDummyInput('AT2');\n    if (Msg['TEXT_GET_SUBSTRING_TAIL']) {\n      this.appendDummyInput('TAIL').appendField(Msg['TEXT_GET_SUBSTRING_TAIL']);\n    }\n    this.setInputsInline(true);\n    this.setOutput(true, 'String');\n    this.updateAt_(1, true);\n    this.updateAt_(2, true);\n    this.setTooltip(Msg['TEXT_GET_SUBSTRING_TOOLTIP']);\n  },\n  /**\n   * Create XML to represent whether there are 'AT' inputs.\n   * Backwards compatible serialization implementation.\n   * @return {!Element} XML storage element.\n   * @this {Block}\n   */\n  mutationToDom: function() {\n    const container = xmlUtils.createElement('mutation');\n    const isAt1 = this.getInput('AT1').type === ConnectionType.INPUT_VALUE;\n    container.setAttribute('at1', isAt1);\n    const isAt2 = this.getInput('AT2').type === ConnectionType.INPUT_VALUE;\n    container.setAttribute('at2', isAt2);\n    return container;\n  },\n  /**\n   * Parse XML to restore the 'AT' inputs.\n   * Backwards compatible serialization implementation.\n   * @param {!Element} xmlElement XML storage element.\n   * @this {Block}\n   */\n  domToMutation: function(xmlElement) {\n    const isAt1 = (xmlElement.getAttribute('at1') === 'true');\n    const isAt2 = (xmlElement.getAttribute('at2') === 'true');\n    this.updateAt_(1, isAt1);\n    this.updateAt_(2, isAt2);\n  },\n\n  // This block does not need JSO serialization hooks (saveExtraState and\n  // loadExtraState) because the state of this object is already encoded in the\n  // dropdown values.\n  // XML hooks are kept for backwards compatibility.\n\n  /**\n   * Create or delete an input for a numeric index.\n   * This block has two such inputs, independent of each other.\n   * @param {number} n Specify first or second input (1 or 2).\n   * @param {boolean} isAt True if the input should exist.\n   * @private\n   * @this {Block}\n   */\n  updateAt_: function(n, isAt) {\n    // Create or delete an input for the numeric index.\n    // Destroy old 'AT' and 'ORDINAL' inputs.\n    this.removeInput('AT' + n);\n    this.removeInput('ORDINAL' + n, true);\n    // Create either a value 'AT' input or a dummy input.\n    if (isAt) {\n      this.appendValueInput('AT' + n).setCheck('Number');\n      if (Msg['ORDINAL_NUMBER_SUFFIX']) {\n        this.appendDummyInput('ORDINAL' + n)\n            .appendField(Msg['ORDINAL_NUMBER_SUFFIX']);\n      }\n    } else {\n      this.appendDummyInput('AT' + n);\n    }\n    // Move tail, if present, to end of block.\n    if (n === 2 && Msg['TEXT_GET_SUBSTRING_TAIL']) {\n      this.removeInput('TAIL', true);\n      this.appendDummyInput('TAIL').appendField(Msg['TEXT_GET_SUBSTRING_TAIL']);\n    }\n    const menu = new FieldDropdown(\n        this['WHERE_OPTIONS_' + n],\n        /**\n         * @param {*} value The input value.\n         * @this {FieldDropdown}\n         * @return {null|undefined} Null if the field has been replaced;\n         *     otherwise undefined.\n         */\n        function(value) {\n          const newAt = (value === 'FROM_START') || (value === 'FROM_END');\n          // The 'isAt' variable is available due to this function being a\n          // closure.\n          if (newAt !== isAt) {\n            const block = this.getSourceBlock();\n            block.updateAt_(n, newAt);\n            // This menu has been destroyed and replaced.\n            // Update the replacement.\n            block.setFieldValue(value, 'WHERE' + n);\n            return null;\n          }\n          return undefined;\n        });\n\n    this.getInput('AT' + n).appendField(menu, 'WHERE' + n);\n    if (n === 1) {\n      this.moveInputBefore('AT1', 'AT2');\n      if (this.getInput('ORDINAL1')) {\n        this.moveInputBefore('ORDINAL1', 'AT2');\n      }\n    }\n  },\n};\n\nblocks['text_changeCase'] = {\n  /**\n   * Block for changing capitalization.\n   * @this {Block}\n   */\n  init: function() {\n    const OPERATORS = [\n      [Msg['TEXT_CHANGECASE_OPERATOR_UPPERCASE'], 'UPPERCASE'],\n      [Msg['TEXT_CHANGECASE_OPERATOR_LOWERCASE'], 'LOWERCASE'],\n      [Msg['TEXT_CHANGECASE_OPERATOR_TITLECASE'], 'TITLECASE'],\n    ];\n    this.setHelpUrl(Msg['TEXT_CHANGECASE_HELPURL']);\n    this.setStyle('text_blocks');\n    this.appendValueInput('TEXT').setCheck('String').appendField(\n        new FieldDropdown(OPERATORS), 'CASE');\n    this.setOutput(true, 'String');\n    this.setTooltip(Msg['TEXT_CHANGECASE_TOOLTIP']);\n  },\n};\n\nblocks['text_trim'] = {\n  /**\n   * Block for trimming spaces.\n   * @this {Block}\n   */\n  init: function() {\n    const OPERATORS = [\n      [Msg['TEXT_TRIM_OPERATOR_BOTH'], 'BOTH'],\n      [Msg['TEXT_TRIM_OPERATOR_LEFT'], 'LEFT'],\n      [Msg['TEXT_TRIM_OPERATOR_RIGHT'], 'RIGHT'],\n    ];\n    this.setHelpUrl(Msg['TEXT_TRIM_HELPURL']);\n    this.setStyle('text_blocks');\n    this.appendValueInput('TEXT').setCheck('String').appendField(\n        new FieldDropdown(OPERATORS), 'MODE');\n    this.setOutput(true, 'String');\n    this.setTooltip(Msg['TEXT_TRIM_TOOLTIP']);\n  },\n};\n\nblocks['text_print'] = {\n  /**\n   * Block for print statement.\n   * @this {Block}\n   */\n  init: function() {\n    this.jsonInit({\n      'message0': Msg['TEXT_PRINT_TITLE'],\n      'args0': [\n        {\n          'type': 'input_value',\n          'name': 'TEXT',\n        },\n      ],\n      'previousStatement': null,\n      'nextStatement': null,\n      'style': 'text_blocks',\n      'tooltip': Msg['TEXT_PRINT_TOOLTIP'],\n      'helpUrl': Msg['TEXT_PRINT_HELPURL'],\n    });\n  },\n};\n\n\n/**\n * Common properties for the text_prompt_ext and text_prompt blocks\n * definitions.\n */\nconst TEXT_PROMPT_COMMON = {\n  /**\n   * Modify this block to have the correct output type.\n   * @param {string} newOp Either 'TEXT' or 'NUMBER'.\n   * @private\n   * @this {Block}\n   */\n  updateType_: function(newOp) {\n    this.outputConnection.setCheck(newOp === 'NUMBER' ? 'Number' : 'String');\n  },\n  /**\n   * Create XML to represent the output type.\n   * Backwards compatible serialization implementation.\n   * @return {!Element} XML storage element.\n   * @this {Block}\n   */\n  mutationToDom: function() {\n    const container = xmlUtils.createElement('mutation');\n    container.setAttribute('type', this.getFieldValue('TYPE'));\n    return container;\n  },\n  /**\n   * Parse XML to restore the output type.\n   * Backwards compatible serialization implementation.\n   * @param {!Element} xmlElement XML storage element.\n   * @this {Block}\n   */\n  domToMutation: function(xmlElement) {\n    this.updateType_(xmlElement.getAttribute('type'));\n  },\n};\n\nblocks['text_prompt_ext'] = {\n  ...TEXT_PROMPT_COMMON,\n  /**\n   * Block for prompt function (external message).\n   * @this {Block}\n   */\n  init: function() {\n    const TYPES = [\n      [Msg['TEXT_PROMPT_TYPE_TEXT'], 'TEXT'],\n      [Msg['TEXT_PROMPT_TYPE_NUMBER'], 'NUMBER'],\n    ];\n    this.setHelpUrl(Msg['TEXT_PROMPT_HELPURL']);\n    this.setStyle('text_blocks');\n    // Assign 'this' to a variable for use in the closures below.\n    const thisBlock = this;\n    const dropdown = new FieldDropdown(TYPES, function(newOp) {\n      thisBlock.updateType_(newOp);\n    });\n    this.appendValueInput('TEXT').appendField(dropdown, 'TYPE');\n    this.setOutput(true, 'String');\n    this.setTooltip(function() {\n      return (thisBlock.getFieldValue('TYPE') === 'TEXT') ?\n          Msg['TEXT_PROMPT_TOOLTIP_TEXT'] :\n          Msg['TEXT_PROMPT_TOOLTIP_NUMBER'];\n    });\n  },\n\n  // This block does not need JSO serialization hooks (saveExtraState and\n  // loadExtraState) because the state of this object is already encoded in the\n  // dropdown values.\n  // XML hooks are kept for backwards compatibility.\n};\n\nblocks['text_prompt'] = {\n  ...TEXT_PROMPT_COMMON,\n  /**\n   * Block for prompt function (internal message).\n   * The 'text_prompt_ext' block is preferred as it is more flexible.\n   * @this {Block}\n   */\n  init: function() {\n    this.mixin(QUOTE_IMAGE_MIXIN);\n    const TYPES = [\n      [Msg['TEXT_PROMPT_TYPE_TEXT'], 'TEXT'],\n      [Msg['TEXT_PROMPT_TYPE_NUMBER'], 'NUMBER'],\n    ];\n\n    // Assign 'this' to a variable for use in the closures below.\n    const thisBlock = this;\n    this.setHelpUrl(Msg['TEXT_PROMPT_HELPURL']);\n    this.setStyle('text_blocks');\n    const dropdown = new FieldDropdown(TYPES, function(newOp) {\n      thisBlock.updateType_(newOp);\n    });\n    this.appendDummyInput()\n        .appendField(dropdown, 'TYPE')\n        .appendField(this.newQuote_(true))\n        .appendField(new FieldTextInput(''), 'TEXT')\n        .appendField(this.newQuote_(false));\n    this.setOutput(true, 'String');\n    this.setTooltip(function() {\n      return (thisBlock.getFieldValue('TYPE') === 'TEXT') ?\n          Msg['TEXT_PROMPT_TOOLTIP_TEXT'] :\n          Msg['TEXT_PROMPT_TOOLTIP_NUMBER'];\n    });\n  },\n};\n\nblocks['text_count'] = {\n  /**\n   * Block for counting how many times one string appears within another string.\n   * @this {Block}\n   */\n  init: function() {\n    this.jsonInit({\n      'message0': Msg['TEXT_COUNT_MESSAGE0'],\n      'args0': [\n        {\n          'type': 'input_value',\n          'name': 'SUB',\n          'check': 'String',\n        },\n        {\n          'type': 'input_value',\n          'name': 'TEXT',\n          'check': 'String',\n        },\n      ],\n      'output': 'Number',\n      'inputsInline': true,\n      'style': 'text_blocks',\n      'tooltip': Msg['TEXT_COUNT_TOOLTIP'],\n      'helpUrl': Msg['TEXT_COUNT_HELPURL'],\n    });\n  },\n};\n\nblocks['text_replace'] = {\n  /**\n   * Block for replacing one string with another in the text.\n   * @this {Block}\n   */\n  init: function() {\n    this.jsonInit({\n      'message0': Msg['TEXT_REPLACE_MESSAGE0'],\n      'args0': [\n        {\n          'type': 'input_value',\n          'name': 'FROM',\n          'check': 'String',\n        },\n        {\n          'type': 'input_value',\n          'name': 'TO',\n          'check': 'String',\n        },\n        {\n          'type': 'input_value',\n          'name': 'TEXT',\n          'check': 'String',\n        },\n      ],\n      'output': 'String',\n      'inputsInline': true,\n      'style': 'text_blocks',\n      'tooltip': Msg['TEXT_REPLACE_TOOLTIP'],\n      'helpUrl': Msg['TEXT_REPLACE_HELPURL'],\n    });\n  },\n};\n\nblocks['text_reverse'] = {\n  /**\n   * Block for reversing a string.\n   * @this {Block}\n   */\n  init: function() {\n    this.jsonInit({\n      'message0': Msg['TEXT_REVERSE_MESSAGE0'],\n      'args0': [\n        {\n          'type': 'input_value',\n          'name': 'TEXT',\n          'check': 'String',\n        },\n      ],\n      'output': 'String',\n      'inputsInline': true,\n      'style': 'text_blocks',\n      'tooltip': Msg['TEXT_REVERSE_TOOLTIP'],\n      'helpUrl': Msg['TEXT_REVERSE_HELPURL'],\n    });\n  },\n};\n\n/**\n * @mixin\n * @package\n * @readonly\n */\nconst QUOTE_IMAGE_MIXIN = {\n  /**\n   * Image data URI of an LTR opening double quote (same as RTL closing double\n   * quote).\n   * @readonly\n   */\n  QUOTE_IMAGE_LEFT_DATAURI:\n      'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAKCAQAAAAqJXdxAAAA' +\n      'n0lEQVQI1z3OMa5BURSF4f/cQhAKjUQhuQmFNwGJEUi0RKN5rU7FHKhpjEH3TEMtkdBSCY' +\n      '1EIv8r7nFX9e29V7EBAOvu7RPjwmWGH/VuF8CyN9/OAdvqIXYLvtRaNjx9mMTDyo+NjAN1' +\n      'HNcl9ZQ5oQMM3dgDUqDo1l8DzvwmtZN7mnD+PkmLa+4mhrxVA9fRowBWmVBhFy5gYEjKMf' +\n      'z9AylsaRRgGzvZAAAAAElFTkSuQmCC',\n  /**\n   * Image data URI of an LTR closing double quote (same as RTL opening double\n   * quote).\n   * @readonly\n   */\n  QUOTE_IMAGE_RIGHT_DATAURI:\n      'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAKCAQAAAAqJXdxAAAA' +\n      'qUlEQVQI1z3KvUpCcRiA8ef9E4JNHhI0aFEacm1o0BsI0Slx8wa8gLauoDnoBhq7DcfWhg' +\n      'gONDmJJgqCPA7neJ7p934EOOKOnM8Q7PDElo/4x4lFb2DmuUjcUzS3URnGib9qaPNbuXvB' +\n      'O3sGPHJDRG6fGVdMSeWDP2q99FQdFrz26Gu5Tq7dFMzUvbXy8KXeAj57cOklgA+u1B5Aos' +\n      'lLtGIHQMaCVnwDnADZIFIrXsoXrgAAAABJRU5ErkJggg==',\n  /**\n   * Pixel width of QUOTE_IMAGE_LEFT_DATAURI and QUOTE_IMAGE_RIGHT_DATAURI.\n   * @readonly\n   */\n  QUOTE_IMAGE_WIDTH: 12,\n  /**\n   * Pixel height of QUOTE_IMAGE_LEFT_DATAURI and QUOTE_IMAGE_RIGHT_DATAURI.\n   * @readonly\n   */\n  QUOTE_IMAGE_HEIGHT: 12,\n\n  /**\n   * Inserts appropriate quote images before and after the named field.\n   * @param {string} fieldName The name of the field to wrap with quotes.\n   * @this {Block}\n   */\n  quoteField_: function(fieldName) {\n    for (let i = 0, input; (input = this.inputList[i]); i++) {\n      for (let j = 0, field; (field = input.fieldRow[j]); j++) {\n        if (fieldName === field.name) {\n          input.insertFieldAt(j, this.newQuote_(true));\n          input.insertFieldAt(j + 2, this.newQuote_(false));\n          return;\n        }\n      }\n    }\n    console.warn(\n        'field named \"' + fieldName + '\" not found in ' + this.toDevString());\n  },\n\n  /**\n   * A helper function that generates a FieldImage of an opening or\n   * closing double quote. The selected quote will be adapted for RTL blocks.\n   * @param {boolean} open If the image should be open quote ( in LTR).\n   *                       Otherwise, a closing quote is used ( in LTR).\n   * @return {!FieldImage} The new field.\n   * @this {Block}\n   */\n  newQuote_: function(open) {\n    const isLeft = this.RTL ? !open : open;\n    const dataUri =\n        isLeft ? this.QUOTE_IMAGE_LEFT_DATAURI : this.QUOTE_IMAGE_RIGHT_DATAURI;\n    return new FieldImage(\n        dataUri, this.QUOTE_IMAGE_WIDTH, this.QUOTE_IMAGE_HEIGHT,\n        isLeft ? '\\u201C' : '\\u201D');\n  },\n};\n\n/**\n * Wraps TEXT field with images of double quote characters.\n * @this {Block}\n */\nconst TEXT_QUOTES_EXTENSION = function() {\n  this.mixin(QUOTE_IMAGE_MIXIN);\n  this.quoteField_('TEXT');\n};\n\n/**\n * Mixin for mutator functions in the 'text_join_mutator' extension.\n * @mixin\n * @augments Block\n * @package\n */\nconst TEXT_JOIN_MUTATOR_MIXIN = {\n  /**\n   * Create XML to represent number of text inputs.\n   * Backwards compatible serialization implementation.\n   * @return {!Element} XML storage element.\n   * @this {Block}\n   */\n  mutationToDom: function() {\n    const container = xmlUtils.createElement('mutation');\n    container.setAttribute('items', this.itemCount_);\n    return container;\n  },\n  /**\n   * Parse XML to restore the text inputs.\n   * Backwards compatible serialization implementation.\n   * @param {!Element} xmlElement XML storage element.\n   * @this {Block}\n   */\n  domToMutation: function(xmlElement) {\n    this.itemCount_ = parseInt(xmlElement.getAttribute('items'), 10);\n    this.updateShape_();\n  },\n  /**\n   * Returns the state of this block as a JSON serializable object.\n   * @return {{itemCount: number}} The state of this block, ie the item count.\n   */\n  saveExtraState: function() {\n    return {\n      'itemCount': this.itemCount_,\n    };\n  },\n  /**\n   * Applies the given state to this block.\n   * @param {*} state The state to apply to this block, ie the item count.\n   */\n  loadExtraState: function(state) {\n    this.itemCount_ = state['itemCount'];\n    this.updateShape_();\n  },\n  /**\n   * Populate the mutator's dialog with this block's components.\n   * @param {!Workspace} workspace Mutator's workspace.\n   * @return {!Block} Root block in mutator.\n   * @this {Block}\n   */\n  decompose: function(workspace) {\n    const containerBlock = workspace.newBlock('text_create_join_container');\n    containerBlock.initSvg();\n    let connection = containerBlock.getInput('STACK').connection;\n    for (let i = 0; i < this.itemCount_; i++) {\n      const itemBlock = workspace.newBlock('text_create_join_item');\n      itemBlock.initSvg();\n      connection.connect(itemBlock.previousConnection);\n      connection = itemBlock.nextConnection;\n    }\n    return containerBlock;\n  },\n  /**\n   * Reconfigure this block based on the mutator dialog's components.\n   * @param {!Block} containerBlock Root block in mutator.\n   * @this {Block}\n   */\n  compose: function(containerBlock) {\n    let itemBlock = containerBlock.getInputTargetBlock('STACK');\n    // Count number of inputs.\n    const connections = [];\n    while (itemBlock) {\n      if (itemBlock.isInsertionMarker()) {\n        itemBlock = itemBlock.getNextBlock();\n        continue;\n      }\n      connections.push(itemBlock.valueConnection_);\n      itemBlock = itemBlock.getNextBlock();\n    }\n    // Disconnect any children that don't belong.\n    for (let i = 0; i < this.itemCount_; i++) {\n      const connection = this.getInput('ADD' + i).connection.targetConnection;\n      if (connection && connections.indexOf(connection) === -1) {\n        connection.disconnect();\n      }\n    }\n    this.itemCount_ = connections.length;\n    this.updateShape_();\n    // Reconnect any child blocks.\n    for (let i = 0; i < this.itemCount_; i++) {\n      Mutator.reconnect(connections[i], this, 'ADD' + i);\n    }\n  },\n  /**\n   * Store pointers to any connected child blocks.\n   * @param {!Block} containerBlock Root block in mutator.\n   * @this {Block}\n   */\n  saveConnections: function(containerBlock) {\n    let itemBlock = containerBlock.getInputTargetBlock('STACK');\n    let i = 0;\n    while (itemBlock) {\n      if (itemBlock.isInsertionMarker()) {\n        itemBlock = itemBlock.getNextBlock();\n        continue;\n      }\n      const input = this.getInput('ADD' + i);\n      itemBlock.valueConnection_ = input && input.connection.targetConnection;\n      itemBlock = itemBlock.getNextBlock();\n      i++;\n    }\n  },\n  /**\n   * Modify this block to have the correct number of inputs.\n   * @private\n   * @this {Block}\n   */\n  updateShape_: function() {\n    if (this.itemCount_ && this.getInput('EMPTY')) {\n      this.removeInput('EMPTY');\n    } else if (!this.itemCount_ && !this.getInput('EMPTY')) {\n      this.appendDummyInput('EMPTY')\n          .appendField(this.newQuote_(true))\n          .appendField(this.newQuote_(false));\n    }\n    // Add new inputs.\n    for (let i = 0; i < this.itemCount_; i++) {\n      if (!this.getInput('ADD' + i)) {\n        const input = this.appendValueInput('ADD' + i).setAlign(Align.RIGHT);\n        if (i === 0) {\n          input.appendField(Msg['TEXT_JOIN_TITLE_CREATEWITH']);\n        }\n      }\n    }\n    // Remove deleted inputs.\n    for (let i = this.itemCount_; this.getInput('ADD' + i); i++) {\n      this.removeInput('ADD' + i);\n    }\n  },\n};\n\n/**\n * Performs final setup of a text_join block.\n * @this {Block}\n */\nconst TEXT_JOIN_EXTENSION = function() {\n  // Add the quote mixin for the itemCount_ = 0 case.\n  this.mixin(QUOTE_IMAGE_MIXIN);\n  // Initialize the mutator values.\n  this.itemCount_ = 2;\n  this.updateShape_();\n  // Configure the mutator UI.\n  this.setMutator(new Mutator(['text_create_join_item'], this));\n};\n\n// Update the tooltip of 'text_append' block to reference the variable.\nExtensions.register(\n    'text_append_tooltip',\n    Extensions.buildTooltipWithFieldText('%{BKY_TEXT_APPEND_TOOLTIP}', 'VAR'));\n\n/**\n * Update the tooltip of 'text_append' block to reference the variable.\n * @this {Block}\n */\nconst TEXT_INDEXOF_TOOLTIP_EXTENSION = function() {\n  // Assign 'this' to a variable for use in the tooltip closure below.\n  const thisBlock = this;\n  this.setTooltip(function() {\n    return Msg['TEXT_INDEXOF_TOOLTIP'].replace(\n        '%1', thisBlock.workspace.options.oneBasedIndex ? '0' : '-1');\n  });\n};\n\n/**\n * Mixin for mutator functions in the 'text_charAt_mutator' extension.\n * @mixin\n * @augments Block\n * @package\n */\nconst TEXT_CHARAT_MUTATOR_MIXIN = {\n  /**\n   * Create XML to represent whether there is an 'AT' input.\n   * Backwards compatible serialization implementation.\n   * @return {!Element} XML storage element.\n   * @this {Block}\n   */\n  mutationToDom: function() {\n    const container = xmlUtils.createElement('mutation');\n    container.setAttribute('at', !!this.isAt_);\n    return container;\n  },\n  /**\n   * Parse XML to restore the 'AT' input.\n   * Backwards compatible serialization implementation.\n   * @param {!Element} xmlElement XML storage element.\n   * @this {Block}\n   */\n  domToMutation: function(xmlElement) {\n    // Note: Until January 2013 this block did not have mutations,\n    // so 'at' defaults to true.\n    const isAt = (xmlElement.getAttribute('at') !== 'false');\n    this.updateAt_(isAt);\n  },\n\n  // This block does not need JSO serialization hooks (saveExtraState and\n  // loadExtraState) because the state of this object is already encoded in the\n  // dropdown values.\n  // XML hooks are kept for backwards compatibility.\n\n  /**\n   * Create or delete an input for the numeric index.\n   * @param {boolean} isAt True if the input should exist.\n   * @private\n   * @this {Block}\n   */\n  updateAt_: function(isAt) {\n    // Destroy old 'AT' and 'ORDINAL' inputs.\n    this.removeInput('AT', true);\n    this.removeInput('ORDINAL', true);\n    // Create either a value 'AT' input or a dummy input.\n    if (isAt) {\n      this.appendValueInput('AT').setCheck('Number');\n      if (Msg['ORDINAL_NUMBER_SUFFIX']) {\n        this.appendDummyInput('ORDINAL').appendField(\n            Msg['ORDINAL_NUMBER_SUFFIX']);\n      }\n    }\n    if (Msg['TEXT_CHARAT_TAIL']) {\n      this.removeInput('TAIL', true);\n      this.appendDummyInput('TAIL').appendField(Msg['TEXT_CHARAT_TAIL']);\n    }\n\n    this.isAt_ = isAt;\n  },\n};\n\n/**\n * Does the initial mutator update of text_charAt and adds the tooltip\n * @this {Block}\n */\nconst TEXT_CHARAT_EXTENSION = function() {\n  const dropdown = this.getField('WHERE');\n  dropdown.setValidator(\n      /**\n       * @param {*} value The input value.\n       * @this {FieldDropdown}\n       */\n      function(value) {\n        const newAt = (value === 'FROM_START') || (value === 'FROM_END');\n        if (newAt !== this.isAt_) {\n          const block = this.getSourceBlock();\n          block.updateAt_(newAt);\n        }\n      });\n  this.updateAt_(true);\n  // Assign 'this' to a variable for use in the tooltip closure below.\n  const thisBlock = this;\n  this.setTooltip(function() {\n    const where = thisBlock.getFieldValue('WHERE');\n    let tooltip = Msg['TEXT_CHARAT_TOOLTIP'];\n    if (where === 'FROM_START' || where === 'FROM_END') {\n      const msg = (where === 'FROM_START') ?\n          Msg['LISTS_INDEX_FROM_START_TOOLTIP'] :\n          Msg['LISTS_INDEX_FROM_END_TOOLTIP'];\n      if (msg) {\n        tooltip += '  ' +\n            msg.replace(\n                '%1', thisBlock.workspace.options.oneBasedIndex ? '#1' : '#0');\n      }\n    }\n    return tooltip;\n  });\n};\n\nExtensions.register('text_indexOf_tooltip', TEXT_INDEXOF_TOOLTIP_EXTENSION);\n\nExtensions.register('text_quotes', TEXT_QUOTES_EXTENSION);\n\nExtensions.registerMutator(\n    'text_join_mutator', TEXT_JOIN_MUTATOR_MIXIN, TEXT_JOIN_EXTENSION);\n\nExtensions.registerMutator(\n    'text_charAt_mutator', TEXT_CHARAT_MUTATOR_MIXIN, TEXT_CHARAT_EXTENSION);\n\n// Register provided blocks.\ndefineBlocks(blocks);\n","/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview Procedure blocks for Blockly.\n * @suppress {checkTypes|visibility}\n */\n'use strict';\n\ngoog.module('Blockly.libraryBlocks.procedures');\n\n/* eslint-disable-next-line no-unused-vars */\nconst AbstractEvent = goog.requireType('Blockly.Events.Abstract');\nconst ContextMenu = goog.require('Blockly.ContextMenu');\nconst Events = goog.require('Blockly.Events');\nconst Procedures = goog.require('Blockly.Procedures');\nconst Variables = goog.require('Blockly.Variables');\nconst Xml = goog.require('Blockly.Xml');\nconst xmlUtils = goog.require('Blockly.utils.xml');\nconst {Align} = goog.require('Blockly.Input');\n/* eslint-disable-next-line no-unused-vars */\nconst {Block} = goog.requireType('Blockly.Block');\n// const {BlockDefinition} = goog.requireType('Blockly.blocks');\n// TODO (6248): Properly import the BlockDefinition type.\n/* eslint-disable-next-line no-unused-vars */\nconst BlockDefinition = Object;\nconst {config} = goog.require('Blockly.config');\n/* eslint-disable-next-line no-unused-vars */\nconst {FieldCheckbox} = goog.require('Blockly.FieldCheckbox');\nconst {FieldLabel} = goog.require('Blockly.FieldLabel');\nconst {FieldTextInput} = goog.require('Blockly.FieldTextInput');\nconst {Msg} = goog.require('Blockly.Msg');\nconst {Mutator} = goog.require('Blockly.Mutator');\nconst {Names} = goog.require('Blockly.Names');\n/* eslint-disable-next-line no-unused-vars */\nconst {VariableModel} = goog.requireType('Blockly.VariableModel');\n/* eslint-disable-next-line no-unused-vars */\nconst {Workspace} = goog.requireType('Blockly.Workspace');\nconst {defineBlocks} = goog.require('Blockly.common');\n/** @suppress {extraRequire} */\ngoog.require('Blockly.Comment');\n/** @suppress {extraRequire} */\ngoog.require('Blockly.Warning');\n\n\n/**\n * A dictionary of the block definitions provided by this module.\n * @type {!Object<string, !BlockDefinition>}\n */\nconst blocks = {};\nexports.blocks = blocks;\n\n/**\n * Common properties for the procedure_defnoreturn and\n * procedure_defreturn blocks.\n */\nconst PROCEDURE_DEF_COMMON = {\n  /**\n   * Add or remove the statement block from this function definition.\n   * @param {boolean} hasStatements True if a statement block is needed.\n   * @this {Block}\n   */\n  setStatements_: function(hasStatements) {\n    if (this.hasStatements_ === hasStatements) {\n      return;\n    }\n    if (hasStatements) {\n      this.appendStatementInput('STACK').appendField(\n          Msg['PROCEDURES_DEFNORETURN_DO']);\n      if (this.getInput('RETURN')) {\n        this.moveInputBefore('STACK', 'RETURN');\n      }\n    } else {\n      this.removeInput('STACK', true);\n    }\n    this.hasStatements_ = hasStatements;\n  },\n  /**\n   * Update the display of parameters for this procedure definition block.\n   * @private\n   * @this {Block}\n   */\n  updateParams_: function() {\n    // Merge the arguments into a human-readable list.\n    let paramString = '';\n    if (this.arguments_.length) {\n      paramString =\n          Msg['PROCEDURES_BEFORE_PARAMS'] + ' ' + this.arguments_.join(', ');\n    }\n    // The params field is deterministic based on the mutation,\n    // no need to fire a change event.\n    Events.disable();\n    try {\n      this.setFieldValue(paramString, 'PARAMS');\n    } finally {\n      Events.enable();\n    }\n  },\n  /**\n   * Create XML to represent the argument inputs.\n   * Backwards compatible serialization implementation.\n   * @param {boolean=} opt_paramIds If true include the IDs of the parameter\n   *     quarks.  Used by Procedures.mutateCallers for reconnection.\n   * @return {!Element} XML storage element.\n   * @this {Block}\n   */\n  mutationToDom: function(opt_paramIds) {\n    const container = xmlUtils.createElement('mutation');\n    if (opt_paramIds) {\n      container.setAttribute('name', this.getFieldValue('NAME'));\n    }\n    for (let i = 0; i < this.argumentVarModels_.length; i++) {\n      const parameter = xmlUtils.createElement('arg');\n      const argModel = this.argumentVarModels_[i];\n      parameter.setAttribute('name', argModel.name);\n      parameter.setAttribute('varid', argModel.getId());\n      if (opt_paramIds && this.paramIds_) {\n        parameter.setAttribute('paramId', this.paramIds_[i]);\n      }\n      container.appendChild(parameter);\n    }\n\n    // Save whether the statement input is visible.\n    if (!this.hasStatements_) {\n      container.setAttribute('statements', 'false');\n    }\n    return container;\n  },\n  /**\n   * Parse XML to restore the argument inputs.\n   * Backwards compatible serialization implementation.\n   * @param {!Element} xmlElement XML storage element.\n   * @this {Block}\n   */\n  domToMutation: function(xmlElement) {\n    this.arguments_ = [];\n    this.argumentVarModels_ = [];\n    for (let i = 0, childNode; (childNode = xmlElement.childNodes[i]); i++) {\n      if (childNode.nodeName.toLowerCase() === 'arg') {\n        const varName = childNode.getAttribute('name');\n        const varId =\n            childNode.getAttribute('varid') || childNode.getAttribute('varId');\n        this.arguments_.push(varName);\n        const variable = Variables.getOrCreateVariablePackage(\n            this.workspace, varId, varName, '');\n        if (variable !== null) {\n          this.argumentVarModels_.push(variable);\n        } else {\n          console.log(\n              `Failed to create a variable named \"${varName}\", ignoring.`);\n        }\n      }\n    }\n    this.updateParams_();\n    Procedures.mutateCallers(this);\n\n    // Show or hide the statement input.\n    this.setStatements_(xmlElement.getAttribute('statements') !== 'false');\n  },\n  /**\n   * Returns the state of this block as a JSON serializable object.\n   * @return {?{params: (!Array<{name: string, id: string}>|undefined),\n   *     hasStatements: (boolean|undefined)}} The state of this block, eg the\n   *     parameters and statements.\n   */\n  saveExtraState: function() {\n    if (!this.argumentVarModels_.length && this.hasStatements_) {\n      return null;\n    }\n    const state = Object.create(null);\n    if (this.argumentVarModels_.length) {\n      state['params'] = [];\n      for (let i = 0; i < this.argumentVarModels_.length; i++) {\n        state['params'].push({\n          // We don't need to serialize the name, but just in case we decide\n          // to separate params from variables.\n          'name': this.argumentVarModels_[i].name,\n          'id': this.argumentVarModels_[i].getId(),\n        });\n      }\n    }\n    if (!this.hasStatements_) {\n      state['hasStatements'] = false;\n    }\n    return state;\n  },\n  /**\n   * Applies the given state to this block.\n   * @param {*} state The state to apply to this block, eg the parameters and\n   *     statements.\n   */\n  loadExtraState: function(state) {\n    this.arguments_ = [];\n    this.argumentVarModels_ = [];\n    if (state['params']) {\n      for (let i = 0; i < state['params'].length; i++) {\n        const param = state['params'][i];\n        const variable = Variables.getOrCreateVariablePackage(\n            this.workspace, param['id'], param['name'], '');\n        this.arguments_.push(variable.name);\n        this.argumentVarModels_.push(variable);\n      }\n    }\n    this.updateParams_();\n    Procedures.mutateCallers(this);\n    this.setStatements_(state['hasStatements'] === false ? false : true);\n  },\n  /**\n   * Populate the mutator's dialog with this block's components.\n   * @param {!Workspace} workspace Mutator's workspace.\n   * @return {!Block} Root block in mutator.\n   * @this {Block}\n   */\n  decompose: function(workspace) {\n    /*\n     * Creates the following XML:\n     * <block type=\"procedures_mutatorcontainer\">\n     *   <statement name=\"STACK\">\n     *     <block type=\"procedures_mutatorarg\">\n     *       <field name=\"NAME\">arg1_name</field>\n     *       <next>etc...</next>\n     *     </block>\n     *   </statement>\n     * </block>\n     */\n\n    const containerBlockNode = xmlUtils.createElement('block');\n    containerBlockNode.setAttribute('type', 'procedures_mutatorcontainer');\n    const statementNode = xmlUtils.createElement('statement');\n    statementNode.setAttribute('name', 'STACK');\n    containerBlockNode.appendChild(statementNode);\n\n    let node = statementNode;\n    for (let i = 0; i < this.arguments_.length; i++) {\n      const argBlockNode = xmlUtils.createElement('block');\n      argBlockNode.setAttribute('type', 'procedures_mutatorarg');\n      const fieldNode = xmlUtils.createElement('field');\n      fieldNode.setAttribute('name', 'NAME');\n      const argumentName = xmlUtils.createTextNode(this.arguments_[i]);\n      fieldNode.appendChild(argumentName);\n      argBlockNode.appendChild(fieldNode);\n      const nextNode = xmlUtils.createElement('next');\n      argBlockNode.appendChild(nextNode);\n\n      node.appendChild(argBlockNode);\n      node = nextNode;\n    }\n\n    const containerBlock = Xml.domToBlock(containerBlockNode, workspace);\n\n    if (this.type === 'procedures_defreturn') {\n      containerBlock.setFieldValue(this.hasStatements_, 'STATEMENTS');\n    } else {\n      containerBlock.removeInput('STATEMENT_INPUT');\n    }\n\n    // Initialize procedure's callers with blank IDs.\n    Procedures.mutateCallers(this);\n    return containerBlock;\n  },\n  /**\n   * Reconfigure this block based on the mutator dialog's components.\n   * @param {!Block} containerBlock Root block in mutator.\n   * @this {Block}\n   */\n  compose: function(containerBlock) {\n    // Parameter list.\n    this.arguments_ = [];\n    this.paramIds_ = [];\n    this.argumentVarModels_ = [];\n    let paramBlock = containerBlock.getInputTargetBlock('STACK');\n    while (paramBlock && !paramBlock.isInsertionMarker()) {\n      const varName = paramBlock.getFieldValue('NAME');\n      this.arguments_.push(varName);\n      const variable = this.workspace.getVariable(varName, '');\n      this.argumentVarModels_.push(variable);\n\n      this.paramIds_.push(paramBlock.id);\n      paramBlock =\n          paramBlock.nextConnection && paramBlock.nextConnection.targetBlock();\n    }\n    this.updateParams_();\n    Procedures.mutateCallers(this);\n\n    // Show/hide the statement input.\n    let hasStatements = containerBlock.getFieldValue('STATEMENTS');\n    if (hasStatements !== null) {\n      hasStatements = hasStatements === 'TRUE';\n      if (this.hasStatements_ !== hasStatements) {\n        if (hasStatements) {\n          this.setStatements_(true);\n          // Restore the stack, if one was saved.\n          Mutator.reconnect(this.statementConnection_, this, 'STACK');\n          this.statementConnection_ = null;\n        } else {\n          // Save the stack, then disconnect it.\n          const stackConnection = this.getInput('STACK').connection;\n          this.statementConnection_ = stackConnection.targetConnection;\n          if (this.statementConnection_) {\n            const stackBlock = stackConnection.targetBlock();\n            stackBlock.unplug();\n            stackBlock.bumpNeighbours();\n          }\n          this.setStatements_(false);\n        }\n      }\n    }\n  },\n  /**\n   * Return all variables referenced by this block.\n   * @return {!Array<string>} List of variable names.\n   * @this {Block}\n   */\n  getVars: function() {\n    return this.arguments_;\n  },\n  /**\n   * Return all variables referenced by this block.\n   * @return {!Array<!VariableModel>} List of variable models.\n   * @this {Block}\n   */\n  getVarModels: function() {\n    return this.argumentVarModels_;\n  },\n  /**\n   * Notification that a variable is renaming.\n   * If the ID matches one of this block's variables, rename it.\n   * @param {string} oldId ID of variable to rename.\n   * @param {string} newId ID of new variable.  May be the same as oldId, but\n   *     with an updated name.  Guaranteed to be the same type as the old\n   *     variable.\n   * @override\n   * @this {Block}\n   */\n  renameVarById: function(oldId, newId) {\n    const oldVariable = this.workspace.getVariableById(oldId);\n    if (oldVariable.type !== '') {\n      // Procedure arguments always have the empty type.\n      return;\n    }\n    const oldName = oldVariable.name;\n    const newVar = this.workspace.getVariableById(newId);\n\n    let change = false;\n    for (let i = 0; i < this.argumentVarModels_.length; i++) {\n      if (this.argumentVarModels_[i].getId() === oldId) {\n        this.arguments_[i] = newVar.name;\n        this.argumentVarModels_[i] = newVar;\n        change = true;\n      }\n    }\n    if (change) {\n      this.displayRenamedVar_(oldName, newVar.name);\n      Procedures.mutateCallers(this);\n    }\n  },\n  /**\n   * Notification that a variable is renaming but keeping the same ID.  If the\n   * variable is in use on this block, rerender to show the new name.\n   * @param {!VariableModel} variable The variable being renamed.\n   * @package\n   * @override\n   * @this {Block}\n   */\n  updateVarName: function(variable) {\n    const newName = variable.name;\n    let change = false;\n    let oldName;\n    for (let i = 0; i < this.argumentVarModels_.length; i++) {\n      if (this.argumentVarModels_[i].getId() === variable.getId()) {\n        oldName = this.arguments_[i];\n        this.arguments_[i] = newName;\n        change = true;\n      }\n    }\n    if (change) {\n      this.displayRenamedVar_(oldName, newName);\n      Procedures.mutateCallers(this);\n    }\n  },\n  /**\n   * Update the display to reflect a newly renamed argument.\n   * @param {string} oldName The old display name of the argument.\n   * @param {string} newName The new display name of the argument.\n   * @private\n   * @this {Block}\n   */\n  displayRenamedVar_: function(oldName, newName) {\n    this.updateParams_();\n    // Update the mutator's variables if the mutator is open.\n    if (this.mutator && this.mutator.isVisible()) {\n      const blocks = this.mutator.workspace_.getAllBlocks(false);\n      for (let i = 0, block; (block = blocks[i]); i++) {\n        if (block.type === 'procedures_mutatorarg' &&\n            Names.equals(oldName, block.getFieldValue('NAME'))) {\n          block.setFieldValue(newName, 'NAME');\n        }\n      }\n    }\n  },\n  /**\n   * Add custom menu options to this block's context menu.\n   * @param {!Array} options List of menu options to add to.\n   * @this {Block}\n   */\n  customContextMenu: function(options) {\n    if (this.isInFlyout) {\n      return;\n    }\n    // Add option to create caller.\n    const option = {enabled: true};\n    const name = this.getFieldValue('NAME');\n    option.text = Msg['PROCEDURES_CREATE_DO'].replace('%1', name);\n    const xmlMutation = xmlUtils.createElement('mutation');\n    xmlMutation.setAttribute('name', name);\n    for (let i = 0; i < this.arguments_.length; i++) {\n      const xmlArg = xmlUtils.createElement('arg');\n      xmlArg.setAttribute('name', this.arguments_[i]);\n      xmlMutation.appendChild(xmlArg);\n    }\n    const xmlBlock = xmlUtils.createElement('block');\n    xmlBlock.setAttribute('type', this.callType_);\n    xmlBlock.appendChild(xmlMutation);\n    option.callback = ContextMenu.callbackFactory(this, xmlBlock);\n    options.push(option);\n\n    // Add options to create getters for each parameter.\n    if (!this.isCollapsed()) {\n      for (let i = 0; i < this.argumentVarModels_.length; i++) {\n        const argOption = {enabled: true};\n        const argVar = this.argumentVarModels_[i];\n        argOption.text =\n            Msg['VARIABLES_SET_CREATE_GET'].replace('%1', argVar.name);\n\n        const argXmlField = Variables.generateVariableFieldDom(argVar);\n        const argXmlBlock = xmlUtils.createElement('block');\n        argXmlBlock.setAttribute('type', 'variables_get');\n        argXmlBlock.appendChild(argXmlField);\n        argOption.callback = ContextMenu.callbackFactory(this, argXmlBlock);\n        options.push(argOption);\n      }\n    }\n  },\n};\n\nblocks['procedures_defnoreturn'] = {\n  ...PROCEDURE_DEF_COMMON,\n  /**\n   * Block for defining a procedure with no return value.\n   * @this {Block}\n   */\n  init: function() {\n    const initName = Procedures.findLegalName('', this);\n    const nameField = new FieldTextInput(initName, Procedures.rename);\n    nameField.setSpellcheck(false);\n    this.appendDummyInput()\n        .appendField(Msg['PROCEDURES_DEFNORETURN_TITLE'])\n        .appendField(nameField, 'NAME')\n        .appendField('', 'PARAMS');\n    this.setMutator(new Mutator(['procedures_mutatorarg'], this));\n    if ((this.workspace.options.comments ||\n         (this.workspace.options.parentWorkspace &&\n          this.workspace.options.parentWorkspace.options.comments)) &&\n        Msg['PROCEDURES_DEFNORETURN_COMMENT']) {\n      this.setCommentText(Msg['PROCEDURES_DEFNORETURN_COMMENT']);\n    }\n    this.setStyle('procedure_blocks');\n    this.setTooltip(Msg['PROCEDURES_DEFNORETURN_TOOLTIP']);\n    this.setHelpUrl(Msg['PROCEDURES_DEFNORETURN_HELPURL']);\n    this.arguments_ = [];\n    this.argumentVarModels_ = [];\n    this.setStatements_(true);\n    this.statementConnection_ = null;\n  },\n  /**\n   * Return the signature of this procedure definition.\n   * @return {!Array} Tuple containing three elements:\n   *     - the name of the defined procedure,\n   *     - a list of all its arguments,\n   *     - that it DOES NOT have a return value.\n   * @this {Block}\n   */\n  getProcedureDef: function() {\n    return [this.getFieldValue('NAME'), this.arguments_, false];\n  },\n  callType_: 'procedures_callnoreturn',\n};\n\nblocks['procedures_defreturn'] = {\n  ...PROCEDURE_DEF_COMMON,\n  /**\n   * Block for defining a procedure with a return value.\n   * @this {Block}\n   */\n  init: function() {\n    const initName = Procedures.findLegalName('', this);\n    const nameField = new FieldTextInput(initName, Procedures.rename);\n    nameField.setSpellcheck(false);\n    this.appendDummyInput()\n        .appendField(Msg['PROCEDURES_DEFRETURN_TITLE'])\n        .appendField(nameField, 'NAME')\n        .appendField('', 'PARAMS');\n    this.appendValueInput('RETURN')\n        .setAlign(Align.RIGHT)\n        .appendField(Msg['PROCEDURES_DEFRETURN_RETURN']);\n    this.setMutator(new Mutator(['procedures_mutatorarg'], this));\n    if ((this.workspace.options.comments ||\n         (this.workspace.options.parentWorkspace &&\n          this.workspace.options.parentWorkspace.options.comments)) &&\n        Msg['PROCEDURES_DEFRETURN_COMMENT']) {\n      this.setCommentText(Msg['PROCEDURES_DEFRETURN_COMMENT']);\n    }\n    this.setStyle('procedure_blocks');\n    this.setTooltip(Msg['PROCEDURES_DEFRETURN_TOOLTIP']);\n    this.setHelpUrl(Msg['PROCEDURES_DEFRETURN_HELPURL']);\n    this.arguments_ = [];\n    this.argumentVarModels_ = [];\n    this.setStatements_(true);\n    this.statementConnection_ = null;\n  },\n  /**\n   * Return the signature of this procedure definition.\n   * @return {!Array} Tuple containing three elements:\n   *     - the name of the defined procedure,\n   *     - a list of all its arguments,\n   *     - that it DOES have a return value.\n   * @this {Block}\n   */\n  getProcedureDef: function() {\n    return [this.getFieldValue('NAME'), this.arguments_, true];\n  },\n  callType_: 'procedures_callreturn',\n};\n\nblocks['procedures_mutatorcontainer'] = {\n  /**\n   * Mutator block for procedure container.\n   * @this {Block}\n   */\n  init: function() {\n    this.appendDummyInput().appendField(\n        Msg['PROCEDURES_MUTATORCONTAINER_TITLE']);\n    this.appendStatementInput('STACK');\n    this.appendDummyInput('STATEMENT_INPUT')\n        .appendField(Msg['PROCEDURES_ALLOW_STATEMENTS'])\n        .appendField(new FieldCheckbox('TRUE'), 'STATEMENTS');\n    this.setStyle('procedure_blocks');\n    this.setTooltip(Msg['PROCEDURES_MUTATORCONTAINER_TOOLTIP']);\n    this.contextMenu = false;\n  },\n};\n\nblocks['procedures_mutatorarg'] = {\n  /**\n   * Mutator block for procedure argument.\n   * @this {Block}\n   */\n  init: function() {\n    const field = new FieldTextInput(Procedures.DEFAULT_ARG, this.validator_);\n    // Hack: override showEditor to do just a little bit more work.\n    // We don't have a good place to hook into the start of a text edit.\n    field.oldShowEditorFn_ = field.showEditor_;\n    /**\n     * @this {FieldTextInput}\n     */\n    const newShowEditorFn = function() {\n      this.createdVariables_ = [];\n      this.oldShowEditorFn_();\n    };\n    field.showEditor_ = newShowEditorFn;\n\n    this.appendDummyInput()\n        .appendField(Msg['PROCEDURES_MUTATORARG_TITLE'])\n        .appendField(field, 'NAME');\n    this.setPreviousStatement(true);\n    this.setNextStatement(true);\n    this.setStyle('procedure_blocks');\n    this.setTooltip(Msg['PROCEDURES_MUTATORARG_TOOLTIP']);\n    this.contextMenu = false;\n\n    // Create the default variable when we drag the block in from the flyout.\n    // Have to do this after installing the field on the block.\n    field.onFinishEditing_ = this.deleteIntermediateVars_;\n    // Create an empty list so onFinishEditing_ has something to look at, even\n    // though the editor was never opened.\n    field.createdVariables_ = [];\n    field.onFinishEditing_('x');\n  },\n\n  /**\n   * Obtain a valid name for the procedure argument. Create a variable if\n   * necessary.\n   * Merge runs of whitespace.  Strip leading and trailing whitespace.\n   * Beyond this, all names are legal.\n   * @param {string} varName User-supplied name.\n   * @return {?string} Valid name, or null if a name was not specified.\n   * @private\n   * @this {FieldTextInput}\n   */\n  validator_: function(varName) {\n    const sourceBlock = this.getSourceBlock();\n    const outerWs = Mutator.findParentWs(sourceBlock.workspace);\n    varName = varName.replace(/[\\s\\xa0]+/g, ' ').replace(/^ | $/g, '');\n    if (!varName) {\n      return null;\n    }\n\n    // Prevents duplicate parameter names in functions\n    const workspace =\n        sourceBlock.workspace.targetWorkspace || sourceBlock.workspace;\n    const blocks = workspace.getAllBlocks(false);\n    const caselessName = varName.toLowerCase();\n    for (let i = 0; i < blocks.length; i++) {\n      if (blocks[i].id === this.getSourceBlock().id) {\n        continue;\n      }\n      // Other blocks values may not be set yet when this is loaded.\n      const otherVar = blocks[i].getFieldValue('NAME');\n      if (otherVar && otherVar.toLowerCase() === caselessName) {\n        return null;\n      }\n    }\n\n    // Don't create variables for arg blocks that\n    // only exist in the mutator's flyout.\n    if (sourceBlock.isInFlyout) {\n      return varName;\n    }\n\n    let model = outerWs.getVariable(varName, '');\n    if (model && model.name !== varName) {\n      // Rename the variable (case change)\n      outerWs.renameVariableById(model.getId(), varName);\n    }\n    if (!model) {\n      model = outerWs.createVariable(varName, '');\n      if (model && this.createdVariables_) {\n        this.createdVariables_.push(model);\n      }\n    }\n    return varName;\n  },\n\n  /**\n   * Called when focusing away from the text field.\n   * Deletes all variables that were created as the user typed their intended\n   * variable name.\n   * @param {string} newText The new variable name.\n   * @private\n   * @this {FieldTextInput}\n   */\n  deleteIntermediateVars_: function(newText) {\n    const outerWs = Mutator.findParentWs(this.getSourceBlock().workspace);\n    if (!outerWs) {\n      return;\n    }\n    for (let i = 0; i < this.createdVariables_.length; i++) {\n      const model = this.createdVariables_[i];\n      if (model.name !== newText) {\n        outerWs.deleteVariableById(model.getId());\n      }\n    }\n  },\n};\n\n/**\n * Common properties for the procedure_callnoreturn and\n * procedure_callreturn blocks.\n */\nconst PROCEDURE_CALL_COMMON = {\n  /**\n   * Returns the name of the procedure this block calls.\n   * @return {string} Procedure name.\n   * @this {Block}\n   */\n  getProcedureCall: function() {\n    // The NAME field is guaranteed to exist, null will never be returned.\n    return /** @type {string} */ (this.getFieldValue('NAME'));\n  },\n  /**\n   * Notification that a procedure is renaming.\n   * If the name matches this block's procedure, rename it.\n   * @param {string} oldName Previous name of procedure.\n   * @param {string} newName Renamed procedure.\n   * @this {Block}\n   */\n  renameProcedure: function(oldName, newName) {\n    if (Names.equals(oldName, this.getProcedureCall())) {\n      this.setFieldValue(newName, 'NAME');\n      const baseMsg = this.outputConnection ?\n          Msg['PROCEDURES_CALLRETURN_TOOLTIP'] :\n          Msg['PROCEDURES_CALLNORETURN_TOOLTIP'];\n      this.setTooltip(baseMsg.replace('%1', newName));\n    }\n  },\n  /**\n   * Notification that the procedure's parameters have changed.\n   * @param {!Array<string>} paramNames New param names, e.g. ['x', 'y', 'z'].\n   * @param {!Array<string>} paramIds IDs of params (consistent for each\n   *     parameter through the life of a mutator, regardless of param renaming),\n   *     e.g. ['piua', 'f8b_', 'oi.o'].\n   * @private\n   * @this {Block}\n   */\n  setProcedureParameters_: function(paramNames, paramIds) {\n    // Data structures:\n    // this.arguments = ['x', 'y']\n    //     Existing param names.\n    // this.quarkConnections_ {piua: null, f8b_: Connection}\n    //     Look-up of paramIds to connections plugged into the call block.\n    // this.quarkIds_ = ['piua', 'f8b_']\n    //     Existing param IDs.\n    // Note that quarkConnections_ may include IDs that no longer exist, but\n    // which might reappear if a param is reattached in the mutator.\n    const defBlock =\n        Procedures.getDefinition(this.getProcedureCall(), this.workspace);\n    const mutatorOpen =\n        defBlock && defBlock.mutator && defBlock.mutator.isVisible();\n    if (!mutatorOpen) {\n      this.quarkConnections_ = {};\n      this.quarkIds_ = null;\n    } else {\n      // fix #6091 - this call could cause an error when outside if-else\n      // expanding block while mutating prevents another error (ancient fix)\n      this.setCollapsed(false);\n    }\n    // Test arguments (arrays of strings) for changes. '\\n' is not a valid\n    // argument name character, so it is a valid delimiter here.\n    if (paramNames.join('\\n') === this.arguments_.join('\\n')) {\n      // No change.\n      this.quarkIds_ = paramIds;\n      return;\n    }\n    if (paramIds.length !== paramNames.length) {\n      throw RangeError('paramNames and paramIds must be the same length.');\n    }\n    if (!this.quarkIds_) {\n      // Initialize tracking for this block.\n      this.quarkConnections_ = {};\n      this.quarkIds_ = [];\n    }\n    // Switch off rendering while the block is rebuilt.\n    const savedRendered = this.rendered;\n    this.rendered = false;\n    // Update the quarkConnections_ with existing connections.\n    for (let i = 0; i < this.arguments_.length; i++) {\n      const input = this.getInput('ARG' + i);\n      if (input) {\n        const connection = input.connection.targetConnection;\n        this.quarkConnections_[this.quarkIds_[i]] = connection;\n        if (mutatorOpen && connection &&\n            paramIds.indexOf(this.quarkIds_[i]) === -1) {\n          // This connection should no longer be attached to this block.\n          connection.disconnect();\n          connection.getSourceBlock().bumpNeighbours();\n        }\n      }\n    }\n    // Rebuild the block's arguments.\n    this.arguments_ = [].concat(paramNames);\n    // And rebuild the argument model list.\n    this.argumentVarModels_ = [];\n    for (let i = 0; i < this.arguments_.length; i++) {\n      const variable = Variables.getOrCreateVariablePackage(\n          this.workspace, null, this.arguments_[i], '');\n      this.argumentVarModels_.push(variable);\n    }\n\n    this.updateShape_();\n    this.quarkIds_ = paramIds;\n    // Reconnect any child blocks.\n    if (this.quarkIds_) {\n      for (let i = 0; i < this.arguments_.length; i++) {\n        const quarkId = this.quarkIds_[i];\n        if (quarkId in this.quarkConnections_) {\n          const connection = this.quarkConnections_[quarkId];\n          if (!Mutator.reconnect(connection, this, 'ARG' + i)) {\n            // Block no longer exists or has been attached elsewhere.\n            delete this.quarkConnections_[quarkId];\n          }\n        }\n      }\n    }\n    // Restore rendering and show the changes.\n    this.rendered = savedRendered;\n    if (this.rendered) {\n      this.render();\n    }\n  },\n  /**\n   * Modify this block to have the correct number of arguments.\n   * @private\n   * @this {Block}\n   */\n  updateShape_: function() {\n    for (let i = 0; i < this.arguments_.length; i++) {\n      const argField = this.getField('ARGNAME' + i);\n      if (argField) {\n        // Ensure argument name is up to date.\n        // The argument name field is deterministic based on the mutation,\n        // no need to fire a change event.\n        Events.disable();\n        try {\n          argField.setValue(this.arguments_[i]);\n        } finally {\n          Events.enable();\n        }\n      } else {\n        // Add new input.\n        const newField = new FieldLabel(this.arguments_[i]);\n        const input = this.appendValueInput('ARG' + i)\n                          .setAlign(Align.RIGHT)\n                          .appendField(newField, 'ARGNAME' + i);\n        input.init();\n      }\n    }\n    // Remove deleted inputs.\n    for (let i = this.arguments_.length; this.getInput('ARG' + i); i++) {\n      this.removeInput('ARG' + i);\n    }\n    // Add 'with:' if there are parameters, remove otherwise.\n    const topRow = this.getInput('TOPROW');\n    if (topRow) {\n      if (this.arguments_.length) {\n        if (!this.getField('WITH')) {\n          topRow.appendField(Msg['PROCEDURES_CALL_BEFORE_PARAMS'], 'WITH');\n          topRow.init();\n        }\n      } else {\n        if (this.getField('WITH')) {\n          topRow.removeField('WITH');\n        }\n      }\n    }\n  },\n  /**\n   * Create XML to represent the (non-editable) name and arguments.\n   * Backwards compatible serialization implementation.\n   * @return {!Element} XML storage element.\n   * @this {Block}\n   */\n  mutationToDom: function() {\n    const container = xmlUtils.createElement('mutation');\n    container.setAttribute('name', this.getProcedureCall());\n    for (let i = 0; i < this.arguments_.length; i++) {\n      const parameter = xmlUtils.createElement('arg');\n      parameter.setAttribute('name', this.arguments_[i]);\n      container.appendChild(parameter);\n    }\n    return container;\n  },\n  /**\n   * Parse XML to restore the (non-editable) name and parameters.\n   * Backwards compatible serialization implementation.\n   * @param {!Element} xmlElement XML storage element.\n   * @this {Block}\n   */\n  domToMutation: function(xmlElement) {\n    const name = xmlElement.getAttribute('name');\n    this.renameProcedure(this.getProcedureCall(), name);\n    const args = [];\n    const paramIds = [];\n    for (let i = 0, childNode; (childNode = xmlElement.childNodes[i]); i++) {\n      if (childNode.nodeName.toLowerCase() === 'arg') {\n        args.push(childNode.getAttribute('name'));\n        paramIds.push(childNode.getAttribute('paramId'));\n      }\n    }\n    this.setProcedureParameters_(args, paramIds);\n  },\n  /**\n   * Returns the state of this block as a JSON serializable object.\n   * @return {{name: string, params:(!Array<string>|undefined)}} The state of\n   *     this block, ie the params and procedure name.\n   */\n  saveExtraState: function() {\n    const state = Object.create(null);\n    state['name'] = this.getProcedureCall();\n    if (this.arguments_.length) {\n      state['params'] = this.arguments_;\n    }\n    return state;\n  },\n  /**\n   * Applies the given state to this block.\n   * @param {*} state The state to apply to this block, ie the params and\n   *     procedure name.\n   */\n  loadExtraState: function(state) {\n    this.renameProcedure(this.getProcedureCall(), state['name']);\n    const params = state['params'];\n    if (params) {\n      const ids = [];\n      ids.length = params.length;\n      ids.fill(null);\n      this.setProcedureParameters_(params, ids);\n    }\n  },\n  /**\n   * Return all variables referenced by this block.\n   * @return {!Array<string>} List of variable names.\n   * @this {Block}\n   */\n  getVars: function() {\n    return this.arguments_;\n  },\n  /**\n   * Return all variables referenced by this block.\n   * @return {!Array<!VariableModel>} List of variable models.\n   * @this {Block}\n   */\n  getVarModels: function() {\n    return this.argumentVarModels_;\n  },\n  /**\n   * Procedure calls cannot exist without the corresponding procedure\n   * definition.  Enforce this link whenever an event is fired.\n   * @param {!AbstractEvent} event Change event.\n   * @this {Block}\n   */\n  onchange: function(event) {\n    if (!this.workspace || this.workspace.isFlyout) {\n      // Block is deleted or is in a flyout.\n      return;\n    }\n    if (!event.recordUndo) {\n      // Events not generated by user. Skip handling.\n      return;\n    }\n    if (event.type === Events.BLOCK_CREATE &&\n        event.ids.indexOf(this.id) !== -1) {\n      // Look for the case where a procedure call was created (usually through\n      // paste) and there is no matching definition.  In this case, create\n      // an empty definition block with the correct signature.\n      const name = this.getProcedureCall();\n      let def = Procedures.getDefinition(name, this.workspace);\n      if (def &&\n          (def.type !== this.defType_ ||\n           JSON.stringify(def.getVars()) !== JSON.stringify(this.arguments_))) {\n        // The signatures don't match.\n        def = null;\n      }\n      if (!def) {\n        Events.setGroup(event.group);\n        /**\n         * Create matching definition block.\n         * <xml xmlns=\"https://developers.google.com/blockly/xml\">\n         *   <block type=\"procedures_defreturn\" x=\"10\" y=\"20\">\n         *     <mutation name=\"test\">\n         *       <arg name=\"x\"></arg>\n         *     </mutation>\n         *     <field name=\"NAME\">test</field>\n         *   </block>\n         * </xml>\n         */\n        const xml = xmlUtils.createElement('xml');\n        const block = xmlUtils.createElement('block');\n        block.setAttribute('type', this.defType_);\n        const xy = this.getRelativeToSurfaceXY();\n        const x = xy.x + config.snapRadius * (this.RTL ? -1 : 1);\n        const y = xy.y + config.snapRadius * 2;\n        block.setAttribute('x', x);\n        block.setAttribute('y', y);\n        const mutation = this.mutationToDom();\n        block.appendChild(mutation);\n        const field = xmlUtils.createElement('field');\n        field.setAttribute('name', 'NAME');\n        const callName = this.getProcedureCall();\n        const newName = Procedures.findLegalName(callName, this);\n        if (callName !== newName) {\n          this.renameProcedure(callName, newName);\n        }\n        field.appendChild(xmlUtils.createTextNode(callName));\n        block.appendChild(field);\n        xml.appendChild(block);\n        Xml.domToWorkspace(xml, this.workspace);\n        Events.setGroup(false);\n      }\n    } else if (event.type === Events.BLOCK_DELETE) {\n      // Look for the case where a procedure definition has been deleted,\n      // leaving this block (a procedure call) orphaned.  In this case, delete\n      // the orphan.\n      const name = this.getProcedureCall();\n      const def = Procedures.getDefinition(name, this.workspace);\n      if (!def) {\n        Events.setGroup(event.group);\n        this.dispose(true);\n        Events.setGroup(false);\n      }\n    } else if (event.type === Events.CHANGE && event.element === 'disabled') {\n      const name = this.getProcedureCall();\n      const def = Procedures.getDefinition(name, this.workspace);\n      if (def && def.id === event.blockId) {\n        // in most cases the old group should be ''\n        const oldGroup = Events.getGroup();\n        if (oldGroup) {\n          // This should only be possible programmatically and may indicate a\n          // problem with event grouping. If you see this message please\n          // investigate. If the use ends up being valid we may need to reorder\n          // events in the undo stack.\n          console.log(\n              'Saw an existing group while responding to a definition change');\n        }\n        Events.setGroup(event.group);\n        if (event.newValue) {\n          this.previousEnabledState_ = this.isEnabled();\n          this.setEnabled(false);\n        } else {\n          this.setEnabled(this.previousEnabledState_);\n        }\n        Events.setGroup(oldGroup);\n      }\n    }\n  },\n  /**\n   * Add menu option to find the definition block for this call.\n   * @param {!Array} options List of menu options to add to.\n   * @this {Block}\n   */\n  customContextMenu: function(options) {\n    if (!this.workspace.isMovable()) {\n      // If we center on the block and the workspace isn't movable we could\n      // loose blocks at the edges of the workspace.\n      return;\n    }\n\n    const option = {enabled: true};\n    option.text = Msg['PROCEDURES_HIGHLIGHT_DEF'];\n    const name = this.getProcedureCall();\n    const workspace = this.workspace;\n    option.callback = function() {\n      const def = Procedures.getDefinition(name, workspace);\n      if (def) {\n        workspace.centerOnBlock(def.id);\n        def.select();\n      }\n    };\n    options.push(option);\n  },\n};\n\nblocks['procedures_callnoreturn'] = {\n  ...PROCEDURE_CALL_COMMON,\n  /**\n   * Block for calling a procedure with no return value.\n   * @this {Block}\n   */\n  init: function() {\n    this.appendDummyInput('TOPROW').appendField('', 'NAME');\n    this.setPreviousStatement(true);\n    this.setNextStatement(true);\n    this.setStyle('procedure_blocks');\n    // Tooltip is set in renameProcedure.\n    this.setHelpUrl(Msg['PROCEDURES_CALLNORETURN_HELPURL']);\n    this.arguments_ = [];\n    this.argumentVarModels_ = [];\n    this.quarkConnections_ = {};\n    this.quarkIds_ = null;\n    this.previousEnabledState_ = true;\n  },\n\n  defType_: 'procedures_defnoreturn',\n};\n\nblocks['procedures_callreturn'] = {\n  ...PROCEDURE_CALL_COMMON,\n  /**\n   * Block for calling a procedure with a return value.\n   * @this {Block}\n   */\n  init: function() {\n    this.appendDummyInput('TOPROW').appendField('', 'NAME');\n    this.setOutput(true);\n    this.setStyle('procedure_blocks');\n    // Tooltip is set in domToMutation.\n    this.setHelpUrl(Msg['PROCEDURES_CALLRETURN_HELPURL']);\n    this.arguments_ = [];\n    this.argumentVarModels_ = [];\n    this.quarkConnections_ = {};\n    this.quarkIds_ = null;\n    this.previousEnabledState_ = true;\n  },\n\n  defType_: 'procedures_defreturn',\n};\n\nblocks['procedures_ifreturn'] = {\n  /**\n   * Block for conditionally returning a value from a procedure.\n   * @this {Block}\n   */\n  init: function() {\n    this.appendValueInput('CONDITION')\n        .setCheck('Boolean')\n        .appendField(Msg['CONTROLS_IF_MSG_IF']);\n    this.appendValueInput('VALUE').appendField(\n        Msg['PROCEDURES_DEFRETURN_RETURN']);\n    this.setInputsInline(true);\n    this.setPreviousStatement(true);\n    this.setNextStatement(true);\n    this.setStyle('procedure_blocks');\n    this.setTooltip(Msg['PROCEDURES_IFRETURN_TOOLTIP']);\n    this.setHelpUrl(Msg['PROCEDURES_IFRETURN_HELPURL']);\n    this.hasReturnValue_ = true;\n  },\n  /**\n   * Create XML to represent whether this block has a return value.\n   * @return {!Element} XML storage element.\n   * @this {Block}\n   */\n  mutationToDom: function() {\n    const container = xmlUtils.createElement('mutation');\n    container.setAttribute('value', Number(this.hasReturnValue_));\n    return container;\n  },\n  /**\n   * Parse XML to restore whether this block has a return value.\n   * @param {!Element} xmlElement XML storage element.\n   * @this {Block}\n   */\n  domToMutation: function(xmlElement) {\n    const value = xmlElement.getAttribute('value');\n    this.hasReturnValue_ = (value === '1');\n    if (!this.hasReturnValue_) {\n      this.removeInput('VALUE');\n      this.appendDummyInput('VALUE').appendField(\n          Msg['PROCEDURES_DEFRETURN_RETURN']);\n    }\n  },\n\n  // This block does not need JSO serialization hooks (saveExtraState and\n  // loadExtraState) because the state of this block is already encoded in the\n  // block's position in the workspace.\n  // XML hooks are kept for backwards compatibility.\n\n  /**\n   * Called whenever anything on the workspace changes.\n   * Add warning if this flow block is not nested inside a loop.\n   * @param {!AbstractEvent} e Move event.\n   * @this {Block}\n   */\n  onchange: function(e) {\n    if (this.workspace.isDragging && this.workspace.isDragging() ||\n        e.type !== Events.BLOCK_MOVE) {\n      return;  // Don't change state at the start of a drag.\n    }\n    let legal = false;\n    // Is the block nested in a procedure?\n    let block = this;\n    do {\n      if (this.FUNCTION_TYPES.indexOf(block.type) !== -1) {\n        legal = true;\n        break;\n      }\n      block = block.getSurroundParent();\n    } while (block);\n    if (legal) {\n      // If needed, toggle whether this block has a return value.\n      if (block.type === 'procedures_defnoreturn' && this.hasReturnValue_) {\n        this.removeInput('VALUE');\n        this.appendDummyInput('VALUE').appendField(\n            Msg['PROCEDURES_DEFRETURN_RETURN']);\n        this.hasReturnValue_ = false;\n      } else if (\n          block.type === 'procedures_defreturn' && !this.hasReturnValue_) {\n        this.removeInput('VALUE');\n        this.appendValueInput('VALUE').appendField(\n            Msg['PROCEDURES_DEFRETURN_RETURN']);\n        this.hasReturnValue_ = true;\n      }\n      this.setWarningText(null);\n    } else {\n      this.setWarningText(Msg['PROCEDURES_IFRETURN_WARNING']);\n    }\n    if (!this.isInFlyout) {\n      const group = Events.getGroup();\n      // Makes it so the move and the disable event get undone together.\n      Events.setGroup(e.group);\n      this.setEnabled(legal);\n      Events.setGroup(group);\n    }\n  },\n  /**\n   * List of block types that are functions and thus do not need warnings.\n   * To add a new function type add this to your code:\n   * Blocks['procedures_ifreturn'].FUNCTION_TYPES.push('custom_func');\n   */\n  FUNCTION_TYPES: ['procedures_defnoreturn', 'procedures_defreturn'],\n};\n\n// Register provided blocks.\ndefineBlocks(blocks);\n","/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview Math blocks for Blockly.\n * @suppress {checkTypes}\n */\n'use strict';\n\ngoog.module('Blockly.libraryBlocks.math');\n\nconst Extensions = goog.require('Blockly.Extensions');\n// N.B.: Blockly.FieldDropdown needed for type AND side-effects.\n/* eslint-disable-next-line no-unused-vars */\nconst FieldDropdown = goog.require('Blockly.FieldDropdown');\nconst xmlUtils = goog.require('Blockly.utils.xml');\n/* eslint-disable-next-line no-unused-vars */\nconst {Block} = goog.requireType('Blockly.Block');\n// const {BlockDefinition} = goog.requireType('Blockly.blocks');\n// TODO (6248): Properly import the BlockDefinition type.\n/* eslint-disable-next-line no-unused-vars */\nconst BlockDefinition = Object;\nconst {createBlockDefinitionsFromJsonArray, defineBlocks} = goog.require('Blockly.common');\n/** @suppress {extraRequire} */\ngoog.require('Blockly.FieldLabel');\n/** @suppress {extraRequire} */\ngoog.require('Blockly.FieldNumber');\n/** @suppress {extraRequire} */\ngoog.require('Blockly.FieldVariable');\n\n\n/**\n * A dictionary of the block definitions provided by this module.\n * @type {!Object<string, !BlockDefinition>}\n */\nconst blocks = createBlockDefinitionsFromJsonArray([\n  // Block for numeric value.\n  {\n    'type': 'math_number',\n    'message0': '%1',\n    'args0': [{\n      'type': 'field_number',\n      'name': 'NUM',\n      'value': 0,\n    }],\n    'output': 'Number',\n    'helpUrl': '%{BKY_MATH_NUMBER_HELPURL}',\n    'style': 'math_blocks',\n    'tooltip': '%{BKY_MATH_NUMBER_TOOLTIP}',\n    'extensions': ['parent_tooltip_when_inline'],\n  },\n\n  // Block for basic arithmetic operator.\n  {\n    'type': 'math_arithmetic',\n    'message0': '%1 %2 %3',\n    'args0': [\n      {\n        'type': 'input_value',\n        'name': 'A',\n        'check': 'Number',\n      },\n      {\n        'type': 'field_dropdown',\n        'name': 'OP',\n        'options': [\n          ['%{BKY_MATH_ADDITION_SYMBOL}', 'ADD'],\n          ['%{BKY_MATH_SUBTRACTION_SYMBOL}', 'MINUS'],\n          ['%{BKY_MATH_MULTIPLICATION_SYMBOL}', 'MULTIPLY'],\n          ['%{BKY_MATH_DIVISION_SYMBOL}', 'DIVIDE'],\n          ['%{BKY_MATH_POWER_SYMBOL}', 'POWER'],\n        ],\n      },\n      {\n        'type': 'input_value',\n        'name': 'B',\n        'check': 'Number',\n      },\n    ],\n    'inputsInline': true,\n    'output': 'Number',\n    'style': 'math_blocks',\n    'helpUrl': '%{BKY_MATH_ARITHMETIC_HELPURL}',\n    'extensions': ['math_op_tooltip'],\n  },\n\n  // Block for advanced math operators with single operand.\n  {\n    'type': 'math_single',\n    'message0': '%1 %2',\n    'args0': [\n      {\n        'type': 'field_dropdown',\n        'name': 'OP',\n        'options': [\n          ['%{BKY_MATH_SINGLE_OP_ROOT}', 'ROOT'],\n          ['%{BKY_MATH_SINGLE_OP_ABSOLUTE}', 'ABS'],\n          ['-', 'NEG'],\n          ['ln', 'LN'],\n          ['log10', 'LOG10'],\n          ['e^', 'EXP'],\n          ['10^', 'POW10'],\n        ],\n      },\n      {\n        'type': 'input_value',\n        'name': 'NUM',\n        'check': 'Number',\n      },\n    ],\n    'output': 'Number',\n    'style': 'math_blocks',\n    'helpUrl': '%{BKY_MATH_SINGLE_HELPURL}',\n    'extensions': ['math_op_tooltip'],\n  },\n\n  // Block for trigonometry operators.\n  {\n    'type': 'math_trig',\n    'message0': '%1 %2',\n    'args0': [\n      {\n        'type': 'field_dropdown',\n        'name': 'OP',\n        'options': [\n          ['%{BKY_MATH_TRIG_SIN}', 'SIN'],\n          ['%{BKY_MATH_TRIG_COS}', 'COS'],\n          ['%{BKY_MATH_TRIG_TAN}', 'TAN'],\n          ['%{BKY_MATH_TRIG_ASIN}', 'ASIN'],\n          ['%{BKY_MATH_TRIG_ACOS}', 'ACOS'],\n          ['%{BKY_MATH_TRIG_ATAN}', 'ATAN'],\n        ],\n      },\n      {\n        'type': 'input_value',\n        'name': 'NUM',\n        'check': 'Number',\n      },\n    ],\n    'output': 'Number',\n    'style': 'math_blocks',\n    'helpUrl': '%{BKY_MATH_TRIG_HELPURL}',\n    'extensions': ['math_op_tooltip'],\n  },\n\n  // Block for constants: PI, E, the Golden Ratio, sqrt(2), 1/sqrt(2), INFINITY.\n  {\n    'type': 'math_constant',\n    'message0': '%1',\n    'args0': [\n      {\n        'type': 'field_dropdown',\n        'name': 'CONSTANT',\n        'options': [\n          ['\\u03c0', 'PI'],\n          ['e', 'E'],\n          ['\\u03c6', 'GOLDEN_RATIO'],\n          ['sqrt(2)', 'SQRT2'],\n          ['sqrt(\\u00bd)', 'SQRT1_2'],\n          ['\\u221e', 'INFINITY'],\n        ],\n      },\n    ],\n    'output': 'Number',\n    'style': 'math_blocks',\n    'tooltip': '%{BKY_MATH_CONSTANT_TOOLTIP}',\n    'helpUrl': '%{BKY_MATH_CONSTANT_HELPURL}',\n  },\n\n  // Block for checking if a number is even, odd, prime, whole, positive,\n  // negative or if it is divisible by certain number.\n  {\n    'type': 'math_number_property',\n    'message0': '%1 %2',\n    'args0': [\n      {\n        'type': 'input_value',\n        'name': 'NUMBER_TO_CHECK',\n        'check': 'Number',\n      },\n      {\n        'type': 'field_dropdown',\n        'name': 'PROPERTY',\n        'options': [\n          ['%{BKY_MATH_IS_EVEN}', 'EVEN'],\n          ['%{BKY_MATH_IS_ODD}', 'ODD'],\n          ['%{BKY_MATH_IS_PRIME}', 'PRIME'],\n          ['%{BKY_MATH_IS_WHOLE}', 'WHOLE'],\n          ['%{BKY_MATH_IS_POSITIVE}', 'POSITIVE'],\n          ['%{BKY_MATH_IS_NEGATIVE}', 'NEGATIVE'],\n          ['%{BKY_MATH_IS_DIVISIBLE_BY}', 'DIVISIBLE_BY'],\n        ],\n      },\n    ],\n    'inputsInline': true,\n    'output': 'Boolean',\n    'style': 'math_blocks',\n    'tooltip': '%{BKY_MATH_IS_TOOLTIP}',\n    'mutator': 'math_is_divisibleby_mutator',\n  },\n\n  // Block for adding to a variable in place.\n  {\n    'type': 'math_change',\n    'message0': '%{BKY_MATH_CHANGE_TITLE}',\n    'args0': [\n      {\n        'type': 'field_variable',\n        'name': 'VAR',\n        'variable': '%{BKY_MATH_CHANGE_TITLE_ITEM}',\n      },\n      {\n        'type': 'input_value',\n        'name': 'DELTA',\n        'check': 'Number',\n      },\n    ],\n    'previousStatement': null,\n    'nextStatement': null,\n    'style': 'variable_blocks',\n    'helpUrl': '%{BKY_MATH_CHANGE_HELPURL}',\n    'extensions': ['math_change_tooltip'],\n  },\n\n  // Block for rounding functions.\n  {\n    'type': 'math_round',\n    'message0': '%1 %2',\n    'args0': [\n      {\n        'type': 'field_dropdown',\n        'name': 'OP',\n        'options': [\n          ['%{BKY_MATH_ROUND_OPERATOR_ROUND}', 'ROUND'],\n          ['%{BKY_MATH_ROUND_OPERATOR_ROUNDUP}', 'ROUNDUP'],\n          ['%{BKY_MATH_ROUND_OPERATOR_ROUNDDOWN}', 'ROUNDDOWN'],\n        ],\n      },\n      {\n        'type': 'input_value',\n        'name': 'NUM',\n        'check': 'Number',\n      },\n    ],\n    'output': 'Number',\n    'style': 'math_blocks',\n    'helpUrl': '%{BKY_MATH_ROUND_HELPURL}',\n    'tooltip': '%{BKY_MATH_ROUND_TOOLTIP}',\n  },\n\n  // Block for evaluating a list of numbers to return sum, average, min, max,\n  // etc.  Some functions also work on text (min, max, mode, median).\n  {\n    'type': 'math_on_list',\n    'message0': '%1 %2',\n    'args0': [\n      {\n        'type': 'field_dropdown',\n        'name': 'OP',\n        'options': [\n          ['%{BKY_MATH_ONLIST_OPERATOR_SUM}', 'SUM'],\n          ['%{BKY_MATH_ONLIST_OPERATOR_MIN}', 'MIN'],\n          ['%{BKY_MATH_ONLIST_OPERATOR_MAX}', 'MAX'],\n          ['%{BKY_MATH_ONLIST_OPERATOR_AVERAGE}', 'AVERAGE'],\n          ['%{BKY_MATH_ONLIST_OPERATOR_MEDIAN}', 'MEDIAN'],\n          ['%{BKY_MATH_ONLIST_OPERATOR_MODE}', 'MODE'],\n          ['%{BKY_MATH_ONLIST_OPERATOR_STD_DEV}', 'STD_DEV'],\n          ['%{BKY_MATH_ONLIST_OPERATOR_RANDOM}', 'RANDOM'],\n        ],\n      },\n      {\n        'type': 'input_value',\n        'name': 'LIST',\n        'check': 'Array',\n      },\n    ],\n    'output': 'Number',\n    'style': 'math_blocks',\n    'helpUrl': '%{BKY_MATH_ONLIST_HELPURL}',\n    'mutator': 'math_modes_of_list_mutator',\n    'extensions': ['math_op_tooltip'],\n  },\n\n  // Block for remainder of a division.\n  {\n    'type': 'math_modulo',\n    'message0': '%{BKY_MATH_MODULO_TITLE}',\n    'args0': [\n      {\n        'type': 'input_value',\n        'name': 'DIVIDEND',\n        'check': 'Number',\n      },\n      {\n        'type': 'input_value',\n        'name': 'DIVISOR',\n        'check': 'Number',\n      },\n    ],\n    'inputsInline': true,\n    'output': 'Number',\n    'style': 'math_blocks',\n    'tooltip': '%{BKY_MATH_MODULO_TOOLTIP}',\n    'helpUrl': '%{BKY_MATH_MODULO_HELPURL}',\n  },\n\n  // Block for constraining a number between two limits.\n  {\n    'type': 'math_constrain',\n    'message0': '%{BKY_MATH_CONSTRAIN_TITLE}',\n    'args0': [\n      {\n        'type': 'input_value',\n        'name': 'VALUE',\n        'check': 'Number',\n      },\n      {\n        'type': 'input_value',\n        'name': 'LOW',\n        'check': 'Number',\n      },\n      {\n        'type': 'input_value',\n        'name': 'HIGH',\n        'check': 'Number',\n      },\n    ],\n    'inputsInline': true,\n    'output': 'Number',\n    'style': 'math_blocks',\n    'tooltip': '%{BKY_MATH_CONSTRAIN_TOOLTIP}',\n    'helpUrl': '%{BKY_MATH_CONSTRAIN_HELPURL}',\n  },\n\n  // Block for random integer between [X] and [Y].\n  {\n    'type': 'math_random_int',\n    'message0': '%{BKY_MATH_RANDOM_INT_TITLE}',\n    'args0': [\n      {\n        'type': 'input_value',\n        'name': 'FROM',\n        'check': 'Number',\n      },\n      {\n        'type': 'input_value',\n        'name': 'TO',\n        'check': 'Number',\n      },\n    ],\n    'inputsInline': true,\n    'output': 'Number',\n    'style': 'math_blocks',\n    'tooltip': '%{BKY_MATH_RANDOM_INT_TOOLTIP}',\n    'helpUrl': '%{BKY_MATH_RANDOM_INT_HELPURL}',\n  },\n\n  // Block for random integer between [X] and [Y].\n  {\n    'type': 'math_random_float',\n    'message0': '%{BKY_MATH_RANDOM_FLOAT_TITLE_RANDOM}',\n    'output': 'Number',\n    'style': 'math_blocks',\n    'tooltip': '%{BKY_MATH_RANDOM_FLOAT_TOOLTIP}',\n    'helpUrl': '%{BKY_MATH_RANDOM_FLOAT_HELPURL}',\n  },\n\n  // Block for calculating atan2 of [X] and [Y].\n  {\n    'type': 'math_atan2',\n    'message0': '%{BKY_MATH_ATAN2_TITLE}',\n    'args0': [\n      {\n        'type': 'input_value',\n        'name': 'X',\n        'check': 'Number',\n      },\n      {\n        'type': 'input_value',\n        'name': 'Y',\n        'check': 'Number',\n      },\n    ],\n    'inputsInline': true,\n    'output': 'Number',\n    'style': 'math_blocks',\n    'tooltip': '%{BKY_MATH_ATAN2_TOOLTIP}',\n    'helpUrl': '%{BKY_MATH_ATAN2_HELPURL}',\n  },\n]);\nexports.blocks = blocks;\n\n/**\n * Mapping of math block OP value to tooltip message for blocks\n * math_arithmetic, math_simple, math_trig, and math_on_lists.\n * @see {Extensions#buildTooltipForDropdown}\n * @package\n * @readonly\n */\nconst TOOLTIPS_BY_OP = {\n  // math_arithmetic\n  'ADD': '%{BKY_MATH_ARITHMETIC_TOOLTIP_ADD}',\n  'MINUS': '%{BKY_MATH_ARITHMETIC_TOOLTIP_MINUS}',\n  'MULTIPLY': '%{BKY_MATH_ARITHMETIC_TOOLTIP_MULTIPLY}',\n  'DIVIDE': '%{BKY_MATH_ARITHMETIC_TOOLTIP_DIVIDE}',\n  'POWER': '%{BKY_MATH_ARITHMETIC_TOOLTIP_POWER}',\n\n  // math_simple\n  'ROOT': '%{BKY_MATH_SINGLE_TOOLTIP_ROOT}',\n  'ABS': '%{BKY_MATH_SINGLE_TOOLTIP_ABS}',\n  'NEG': '%{BKY_MATH_SINGLE_TOOLTIP_NEG}',\n  'LN': '%{BKY_MATH_SINGLE_TOOLTIP_LN}',\n  'LOG10': '%{BKY_MATH_SINGLE_TOOLTIP_LOG10}',\n  'EXP': '%{BKY_MATH_SINGLE_TOOLTIP_EXP}',\n  'POW10': '%{BKY_MATH_SINGLE_TOOLTIP_POW10}',\n\n  // math_trig\n  'SIN': '%{BKY_MATH_TRIG_TOOLTIP_SIN}',\n  'COS': '%{BKY_MATH_TRIG_TOOLTIP_COS}',\n  'TAN': '%{BKY_MATH_TRIG_TOOLTIP_TAN}',\n  'ASIN': '%{BKY_MATH_TRIG_TOOLTIP_ASIN}',\n  'ACOS': '%{BKY_MATH_TRIG_TOOLTIP_ACOS}',\n  'ATAN': '%{BKY_MATH_TRIG_TOOLTIP_ATAN}',\n\n  // math_on_lists\n  'SUM': '%{BKY_MATH_ONLIST_TOOLTIP_SUM}',\n  'MIN': '%{BKY_MATH_ONLIST_TOOLTIP_MIN}',\n  'MAX': '%{BKY_MATH_ONLIST_TOOLTIP_MAX}',\n  'AVERAGE': '%{BKY_MATH_ONLIST_TOOLTIP_AVERAGE}',\n  'MEDIAN': '%{BKY_MATH_ONLIST_TOOLTIP_MEDIAN}',\n  'MODE': '%{BKY_MATH_ONLIST_TOOLTIP_MODE}',\n  'STD_DEV': '%{BKY_MATH_ONLIST_TOOLTIP_STD_DEV}',\n  'RANDOM': '%{BKY_MATH_ONLIST_TOOLTIP_RANDOM}',\n};\n\nExtensions.register(\n    'math_op_tooltip',\n    Extensions.buildTooltipForDropdown('OP', TOOLTIPS_BY_OP));\n\n\n/**\n * Mixin for mutator functions in the 'math_is_divisibleby_mutator'\n * extension.\n * @mixin\n * @augments Block\n * @package\n */\nconst IS_DIVISIBLEBY_MUTATOR_MIXIN = {\n  /**\n   * Create XML to represent whether the 'divisorInput' should be present.\n   * Backwards compatible serialization implementation.\n   * @return {!Element} XML storage element.\n   * @this {Block}\n   */\n  mutationToDom: function() {\n    const container = xmlUtils.createElement('mutation');\n    const divisorInput = (this.getFieldValue('PROPERTY') === 'DIVISIBLE_BY');\n    container.setAttribute('divisor_input', divisorInput);\n    return container;\n  },\n  /**\n   * Parse XML to restore the 'divisorInput'.\n   * Backwards compatible serialization implementation.\n   * @param {!Element} xmlElement XML storage element.\n   * @this {Block}\n   */\n  domToMutation: function(xmlElement) {\n    const divisorInput = (xmlElement.getAttribute('divisor_input') === 'true');\n    this.updateShape_(divisorInput);\n  },\n\n  // This block does not need JSO serialization hooks (saveExtraState and\n  // loadExtraState) because the state of this object is already encoded in the\n  // dropdown values.\n  // XML hooks are kept for backwards compatibility.\n\n  /**\n   * Modify this block to have (or not have) an input for 'is divisible by'.\n   * @param {boolean} divisorInput True if this block has a divisor input.\n   * @private\n   * @this {Block}\n   */\n  updateShape_: function(divisorInput) {\n    // Add or remove a Value Input.\n    const inputExists = this.getInput('DIVISOR');\n    if (divisorInput) {\n      if (!inputExists) {\n        this.appendValueInput('DIVISOR').setCheck('Number');\n      }\n    } else if (inputExists) {\n      this.removeInput('DIVISOR');\n    }\n  },\n};\n\n/**\n * 'math_is_divisibleby_mutator' extension to the 'math_property' block that\n * can update the block shape (add/remove divisor input) based on whether\n * property is \"divisible by\".\n * @this {Block}\n * @package\n */\nconst IS_DIVISIBLE_MUTATOR_EXTENSION = function() {\n  this.getField('PROPERTY')\n      .setValidator(\n          /**\n           * @this {FieldDropdown}\n           * @param {*} option The selected dropdown option.\n           */\n          function(option) {\n            const divisorInput = (option === 'DIVISIBLE_BY');\n            this.getSourceBlock().updateShape_(divisorInput);\n          });\n};\n\nExtensions.registerMutator(\n    'math_is_divisibleby_mutator', IS_DIVISIBLEBY_MUTATOR_MIXIN,\n    IS_DIVISIBLE_MUTATOR_EXTENSION);\n\n// Update the tooltip of 'math_change' block to reference the variable.\nExtensions.register(\n    'math_change_tooltip',\n    Extensions.buildTooltipWithFieldText('%{BKY_MATH_CHANGE_TOOLTIP}', 'VAR'));\n\n/**\n * Mixin with mutator methods to support alternate output based if the\n * 'math_on_list' block uses the 'MODE' operation.\n * @mixin\n * @augments Block\n * @package\n * @readonly\n */\nconst LIST_MODES_MUTATOR_MIXIN = {\n  /**\n   * Modify this block to have the correct output type.\n   * @param {string} newOp Either 'MODE' or some op than returns a number.\n   * @private\n   * @this {Block}\n   */\n  updateType_: function(newOp) {\n    if (newOp === 'MODE') {\n      this.outputConnection.setCheck('Array');\n    } else {\n      this.outputConnection.setCheck('Number');\n    }\n  },\n  /**\n   * Create XML to represent the output type.\n   * Backwards compatible serialization implementation.\n   * @return {!Element} XML storage element.\n   * @this {Block}\n   */\n  mutationToDom: function() {\n    const container = xmlUtils.createElement('mutation');\n    container.setAttribute('op', this.getFieldValue('OP'));\n    return container;\n  },\n  /**\n   * Parse XML to restore the output type.\n   * Backwards compatible serialization implementation.\n   * @param {!Element} xmlElement XML storage element.\n   * @this {Block}\n   */\n  domToMutation: function(xmlElement) {\n    this.updateType_(xmlElement.getAttribute('op'));\n  },\n\n  // This block does not need JSO serialization hooks (saveExtraState and\n  // loadExtraState) because the state of this object is already encoded in the\n  // dropdown values.\n  // XML hooks are kept for backwards compatibility.\n};\n\n/**\n * Extension to 'math_on_list' blocks that allows support of\n * modes operation (outputs a list of numbers).\n * @this {Block}\n * @package\n */\nconst LIST_MODES_MUTATOR_EXTENSION = function() {\n  this.getField('OP').setValidator(function(newOp) {\n    this.updateType_(newOp);\n  }.bind(this));\n};\n\nExtensions.registerMutator(\n    'math_modes_of_list_mutator', LIST_MODES_MUTATOR_MIXIN,\n    LIST_MODES_MUTATOR_EXTENSION);\n\n// Register provided blocks.\ndefineBlocks(blocks);\n","/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview Loop blocks for Blockly.\n * @suppress {checkTypes}\n */\n'use strict';\n\ngoog.module('Blockly.libraryBlocks.loops');\n\n/* eslint-disable-next-line no-unused-vars */\nconst AbstractEvent = goog.requireType('Blockly.Events.Abstract');\nconst ContextMenu = goog.require('Blockly.ContextMenu');\nconst Events = goog.require('Blockly.Events');\nconst Extensions = goog.require('Blockly.Extensions');\nconst Variables = goog.require('Blockly.Variables');\nconst xmlUtils = goog.require('Blockly.utils.xml');\n/* eslint-disable-next-line no-unused-vars */\nconst {Block} = goog.requireType('Blockly.Block');\n// const {BlockDefinition} = goog.requireType('Blockly.blocks');\n// TODO (6248): Properly import the BlockDefinition type.\n/* eslint-disable-next-line no-unused-vars */\nconst BlockDefinition = Object;\nconst {Msg} = goog.require('Blockly.Msg');\nconst {createBlockDefinitionsFromJsonArray, defineBlocks} = goog.require('Blockly.common');\n/** @suppress {extraRequire} */\ngoog.require('Blockly.FieldDropdown');\n/** @suppress {extraRequire} */\ngoog.require('Blockly.FieldLabel');\n/** @suppress {extraRequire} */\ngoog.require('Blockly.FieldNumber');\n/** @suppress {extraRequire} */\ngoog.require('Blockly.FieldVariable');\n/** @suppress {extraRequire} */\ngoog.require('Blockly.Warning');\n\n\n/**\n * A dictionary of the block definitions provided by this module.\n * @type {!Object<string, !BlockDefinition>}\n */\nconst blocks = createBlockDefinitionsFromJsonArray([\n  // Block for repeat n times (external number).\n  {\n    'type': 'controls_repeat_ext',\n    'message0': '%{BKY_CONTROLS_REPEAT_TITLE}',\n    'args0': [{\n      'type': 'input_value',\n      'name': 'TIMES',\n      'check': 'Number',\n    }],\n    'message1': '%{BKY_CONTROLS_REPEAT_INPUT_DO} %1',\n    'args1': [{\n      'type': 'input_statement',\n      'name': 'DO',\n    }],\n    'previousStatement': null,\n    'nextStatement': null,\n    'style': 'loop_blocks',\n    'tooltip': '%{BKY_CONTROLS_REPEAT_TOOLTIP}',\n    'helpUrl': '%{BKY_CONTROLS_REPEAT_HELPURL}',\n  },\n  // Block for repeat n times (internal number).\n  // The 'controls_repeat_ext' block is preferred as it is more flexible.\n  {\n    'type': 'controls_repeat',\n    'message0': '%{BKY_CONTROLS_REPEAT_TITLE}',\n    'args0': [{\n      'type': 'field_number',\n      'name': 'TIMES',\n      'value': 10,\n      'min': 0,\n      'precision': 1,\n    }],\n    'message1': '%{BKY_CONTROLS_REPEAT_INPUT_DO} %1',\n    'args1': [{\n      'type': 'input_statement',\n      'name': 'DO',\n    }],\n    'previousStatement': null,\n    'nextStatement': null,\n    'style': 'loop_blocks',\n    'tooltip': '%{BKY_CONTROLS_REPEAT_TOOLTIP}',\n    'helpUrl': '%{BKY_CONTROLS_REPEAT_HELPURL}',\n  },\n  // Block for 'do while/until' loop.\n  {\n    'type': 'controls_whileUntil',\n    'message0': '%1 %2',\n    'args0': [\n      {\n        'type': 'field_dropdown',\n        'name': 'MODE',\n        'options': [\n          ['%{BKY_CONTROLS_WHILEUNTIL_OPERATOR_WHILE}', 'WHILE'],\n          ['%{BKY_CONTROLS_WHILEUNTIL_OPERATOR_UNTIL}', 'UNTIL'],\n        ],\n      },\n      {\n        'type': 'input_value',\n        'name': 'BOOL',\n        'check': 'Boolean',\n      },\n    ],\n    'message1': '%{BKY_CONTROLS_REPEAT_INPUT_DO} %1',\n    'args1': [{\n      'type': 'input_statement',\n      'name': 'DO',\n    }],\n    'previousStatement': null,\n    'nextStatement': null,\n    'style': 'loop_blocks',\n    'helpUrl': '%{BKY_CONTROLS_WHILEUNTIL_HELPURL}',\n    'extensions': ['controls_whileUntil_tooltip'],\n  },\n  // Block for 'for' loop.\n  {\n    'type': 'controls_for',\n    'message0': '%{BKY_CONTROLS_FOR_TITLE}',\n    'args0': [\n      {\n        'type': 'field_variable',\n        'name': 'VAR',\n        'variable': null,\n      },\n      {\n        'type': 'input_value',\n        'name': 'FROM',\n        'check': 'Number',\n        'align': 'RIGHT',\n      },\n      {\n        'type': 'input_value',\n        'name': 'TO',\n        'check': 'Number',\n        'align': 'RIGHT',\n      },\n      {\n        'type': 'input_value',\n        'name': 'BY',\n        'check': 'Number',\n        'align': 'RIGHT',\n      },\n    ],\n    'message1': '%{BKY_CONTROLS_REPEAT_INPUT_DO} %1',\n    'args1': [{\n      'type': 'input_statement',\n      'name': 'DO',\n    }],\n    'inputsInline': true,\n    'previousStatement': null,\n    'nextStatement': null,\n    'style': 'loop_blocks',\n    'helpUrl': '%{BKY_CONTROLS_FOR_HELPURL}',\n    'extensions': [\n      'contextMenu_newGetVariableBlock',\n      'controls_for_tooltip',\n    ],\n  },\n  // Block for 'for each' loop.\n  {\n    'type': 'controls_forEach',\n    'message0': '%{BKY_CONTROLS_FOREACH_TITLE}',\n    'args0': [\n      {\n        'type': 'field_variable',\n        'name': 'VAR',\n        'variable': null,\n      },\n      {\n        'type': 'input_value',\n        'name': 'LIST',\n        'check': 'Array',\n      },\n    ],\n    'message1': '%{BKY_CONTROLS_REPEAT_INPUT_DO} %1',\n    'args1': [{\n      'type': 'input_statement',\n      'name': 'DO',\n    }],\n    'previousStatement': null,\n    'nextStatement': null,\n    'style': 'loop_blocks',\n    'helpUrl': '%{BKY_CONTROLS_FOREACH_HELPURL}',\n    'extensions': [\n      'contextMenu_newGetVariableBlock',\n      'controls_forEach_tooltip',\n    ],\n  },\n  // Block for flow statements: continue, break.\n  {\n    'type': 'controls_flow_statements',\n    'message0': '%1',\n    'args0': [{\n      'type': 'field_dropdown',\n      'name': 'FLOW',\n      'options': [\n        ['%{BKY_CONTROLS_FLOW_STATEMENTS_OPERATOR_BREAK}', 'BREAK'],\n        ['%{BKY_CONTROLS_FLOW_STATEMENTS_OPERATOR_CONTINUE}', 'CONTINUE'],\n      ],\n    }],\n    'previousStatement': null,\n    'style': 'loop_blocks',\n    'helpUrl': '%{BKY_CONTROLS_FLOW_STATEMENTS_HELPURL}',\n    'suppressPrefixSuffix': true,\n    'extensions': [\n      'controls_flow_tooltip',\n      'controls_flow_in_loop_check',\n    ],\n  },\n]);\nexports.blocks = blocks;\n\n/**\n * Tooltips for the 'controls_whileUntil' block, keyed by MODE value.\n * @see {Extensions#buildTooltipForDropdown}\n * @readonly\n */\nconst WHILE_UNTIL_TOOLTIPS = {\n  'WHILE': '%{BKY_CONTROLS_WHILEUNTIL_TOOLTIP_WHILE}',\n  'UNTIL': '%{BKY_CONTROLS_WHILEUNTIL_TOOLTIP_UNTIL}',\n};\n\nExtensions.register(\n    'controls_whileUntil_tooltip',\n    Extensions.buildTooltipForDropdown('MODE', WHILE_UNTIL_TOOLTIPS));\n\n/**\n * Tooltips for the 'controls_flow_statements' block, keyed by FLOW value.\n * @see {Extensions#buildTooltipForDropdown}\n * @readonly\n */\nconst BREAK_CONTINUE_TOOLTIPS = {\n  'BREAK': '%{BKY_CONTROLS_FLOW_STATEMENTS_TOOLTIP_BREAK}',\n  'CONTINUE': '%{BKY_CONTROLS_FLOW_STATEMENTS_TOOLTIP_CONTINUE}',\n};\n\nExtensions.register(\n    'controls_flow_tooltip',\n    Extensions.buildTooltipForDropdown('FLOW', BREAK_CONTINUE_TOOLTIPS));\n\n/**\n * Mixin to add a context menu item to create a 'variables_get' block.\n * Used by blocks 'controls_for' and 'controls_forEach'.\n * @mixin\n * @augments Block\n * @package\n * @readonly\n */\nconst CUSTOM_CONTEXT_MENU_CREATE_VARIABLES_GET_MIXIN = {\n  /**\n   * Add context menu option to create getter block for the loop's variable.\n   * (customContextMenu support limited to web BlockSvg.)\n   * @param {!Array} options List of menu options to add to.\n   * @this {Block}\n   */\n  customContextMenu: function(options) {\n    if (this.isInFlyout) {\n      return;\n    }\n    const variable = this.getField('VAR').getVariable();\n    const varName = variable.name;\n    if (!this.isCollapsed() && varName !== null) {\n      const option = {enabled: true};\n      option.text = Msg['VARIABLES_SET_CREATE_GET'].replace('%1', varName);\n      const xmlField = Variables.generateVariableFieldDom(variable);\n      const xmlBlock = xmlUtils.createElement('block');\n      xmlBlock.setAttribute('type', 'variables_get');\n      xmlBlock.appendChild(xmlField);\n      option.callback = ContextMenu.callbackFactory(this, xmlBlock);\n      options.push(option);\n    }\n  },\n};\n\nExtensions.registerMixin(\n    'contextMenu_newGetVariableBlock',\n    CUSTOM_CONTEXT_MENU_CREATE_VARIABLES_GET_MIXIN);\n\nExtensions.register(\n    'controls_for_tooltip',\n    Extensions.buildTooltipWithFieldText('%{BKY_CONTROLS_FOR_TOOLTIP}', 'VAR'));\n\nExtensions.register(\n    'controls_forEach_tooltip',\n    Extensions.buildTooltipWithFieldText(\n        '%{BKY_CONTROLS_FOREACH_TOOLTIP}', 'VAR'));\n\n/**\n * List of block types that are loops and thus do not need warnings.\n * To add a new loop type add this to your code:\n *\n * // If using the Blockly npm package and es6 import syntax:\n * import {loops} from 'blockly/blocks';\n * loops.loopTypes.add('custom_loop');\n *\n * // Else if using Closure Compiler and goog.modules:\n * const {loopTypes} = goog.require('Blockly.libraryBlocks.loops');\n * loopTypes.add('custom_loop');\n *\n * // Else if using blockly_compressed + blockss_compressed.js in browser:\n * Blockly.libraryBlocks.loopTypes.add('custom_loop');\n *\n * @type {!Set<string>}\n */\nconst loopTypes = new Set([\n  'controls_repeat',\n  'controls_repeat_ext',\n  'controls_forEach',\n  'controls_for',\n  'controls_whileUntil',\n]);\nexports.loopTypes = loopTypes;\n\n/**\n * This mixin adds a check to make sure the 'controls_flow_statements' block\n * is contained in a loop. Otherwise a warning is added to the block.\n * @mixin\n * @augments Block\n * @public\n * @readonly\n */\nconst CONTROL_FLOW_IN_LOOP_CHECK_MIXIN = {\n  /**\n   * Is this block enclosed (at any level) by a loop?\n   * @return {Block} The nearest surrounding loop, or null if none.\n   * @this {Block}\n   */\n  getSurroundLoop: function() {\n    let block = this;\n    do {\n      if (loopTypes.has(block.type)) {\n        return block;\n      }\n      block = block.getSurroundParent();\n    } while (block);\n    return null;\n  },\n\n  /**\n   * Called whenever anything on the workspace changes.\n   * Add warning if this flow block is not nested inside a loop.\n   * @param {!AbstractEvent} e Move event.\n   * @this {Block}\n   */\n  onchange: function(e) {\n    // Don't change state if:\n    //   * It's at the start of a drag.\n    //   * It's not a move event.\n    if (!this.workspace.isDragging || this.workspace.isDragging() ||\n        e.type !== Events.BLOCK_MOVE) {\n      return;\n    }\n    const enabled = this.getSurroundLoop(this);\n    this.setWarningText(\n        enabled ? null : Msg['CONTROLS_FLOW_STATEMENTS_WARNING']);\n    if (!this.isInFlyout) {\n      const group = Events.getGroup();\n      // Makes it so the move and the disable event get undone together.\n      Events.setGroup(e.group);\n      this.setEnabled(enabled);\n      Events.setGroup(group);\n    }\n  },\n};\n\nExtensions.registerMixin(\n    'controls_flow_in_loop_check', CONTROL_FLOW_IN_LOOP_CHECK_MIXIN);\n\n// Register provided blocks.\ndefineBlocks(blocks);\n","/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview Logic blocks for Blockly.\n * @suppress {checkTypes}\n */\n'use strict';\n\ngoog.module('Blockly.libraryBlocks.logic');\n\n/* eslint-disable-next-line no-unused-vars */\nconst AbstractEvent = goog.requireType('Blockly.Events.Abstract');\nconst Events = goog.require('Blockly.Events');\nconst Extensions = goog.require('Blockly.Extensions');\nconst xmlUtils = goog.require('Blockly.utils.xml');\n/* eslint-disable-next-line no-unused-vars */\nconst {Block} = goog.requireType('Blockly.Block');\n// const {BlockDefinition} = goog.requireType('Blockly.blocks');\n// TODO (6248): Properly import the BlockDefinition type.\n/* eslint-disable-next-line no-unused-vars */\nconst BlockDefinition = Object;\nconst {Msg} = goog.require('Blockly.Msg');\nconst {Mutator} = goog.require('Blockly.Mutator');\n/* eslint-disable-next-line no-unused-vars */\nconst {RenderedConnection} = goog.requireType('Blockly.RenderedConnection');\n/* eslint-disable-next-line no-unused-vars */\nconst {Workspace} = goog.requireType('Blockly.Workspace');\nconst {createBlockDefinitionsFromJsonArray, defineBlocks} = goog.require('Blockly.common');\n/** @suppress {extraRequire} */\ngoog.require('Blockly.FieldDropdown');\n/** @suppress {extraRequire} */\ngoog.require('Blockly.FieldLabel');\n\n\n/**\n * A dictionary of the block definitions provided by this module.\n * @type {!Object<string, !BlockDefinition>}\n */\nconst blocks = createBlockDefinitionsFromJsonArray([\n  // Block for boolean data type: true and false.\n  {\n    'type': 'logic_boolean',\n    'message0': '%1',\n    'args0': [\n      {\n        'type': 'field_dropdown',\n        'name': 'BOOL',\n        'options': [\n          ['%{BKY_LOGIC_BOOLEAN_TRUE}', 'TRUE'],\n          ['%{BKY_LOGIC_BOOLEAN_FALSE}', 'FALSE'],\n        ],\n      },\n    ],\n    'output': 'Boolean',\n    'style': 'logic_blocks',\n    'tooltip': '%{BKY_LOGIC_BOOLEAN_TOOLTIP}',\n    'helpUrl': '%{BKY_LOGIC_BOOLEAN_HELPURL}',\n  },\n  // Block for if/elseif/else condition.\n  {\n    'type': 'controls_if',\n    'message0': '%{BKY_CONTROLS_IF_MSG_IF} %1',\n    'args0': [\n      {\n        'type': 'input_value',\n        'name': 'IF0',\n        'check': 'Boolean',\n      },\n    ],\n    'message1': '%{BKY_CONTROLS_IF_MSG_THEN} %1',\n    'args1': [\n      {\n        'type': 'input_statement',\n        'name': 'DO0',\n      },\n    ],\n    'previousStatement': null,\n    'nextStatement': null,\n    'style': 'logic_blocks',\n    'helpUrl': '%{BKY_CONTROLS_IF_HELPURL}',\n    'suppressPrefixSuffix': true,\n    'mutator': 'controls_if_mutator',\n    'extensions': ['controls_if_tooltip'],\n  },\n  // If/else block that does not use a mutator.\n  {\n    'type': 'controls_ifelse',\n    'message0': '%{BKY_CONTROLS_IF_MSG_IF} %1',\n    'args0': [\n      {\n        'type': 'input_value',\n        'name': 'IF0',\n        'check': 'Boolean',\n      },\n    ],\n    'message1': '%{BKY_CONTROLS_IF_MSG_THEN} %1',\n    'args1': [\n      {\n        'type': 'input_statement',\n        'name': 'DO0',\n      },\n    ],\n    'message2': '%{BKY_CONTROLS_IF_MSG_ELSE} %1',\n    'args2': [\n      {\n        'type': 'input_statement',\n        'name': 'ELSE',\n      },\n    ],\n    'previousStatement': null,\n    'nextStatement': null,\n    'style': 'logic_blocks',\n    'tooltip': '%{BKYCONTROLS_IF_TOOLTIP_2}',\n    'helpUrl': '%{BKY_CONTROLS_IF_HELPURL}',\n    'suppressPrefixSuffix': true,\n    'extensions': ['controls_if_tooltip'],\n  },\n  // Block for comparison operator.\n  {\n    'type': 'logic_compare',\n    'message0': '%1 %2 %3',\n    'args0': [\n      {\n        'type': 'input_value',\n        'name': 'A',\n      },\n      {\n        'type': 'field_dropdown',\n        'name': 'OP',\n        'options': [\n          ['=', 'EQ'],\n          ['\\u2260', 'NEQ'],\n          ['\\u200F<', 'LT'],\n          ['\\u200F\\u2264', 'LTE'],\n          ['\\u200F>', 'GT'],\n          ['\\u200F\\u2265', 'GTE'],\n        ],\n      },\n      {\n        'type': 'input_value',\n        'name': 'B',\n      },\n    ],\n    'inputsInline': true,\n    'output': 'Boolean',\n    'style': 'logic_blocks',\n    'helpUrl': '%{BKY_LOGIC_COMPARE_HELPURL}',\n    'extensions': ['logic_compare', 'logic_op_tooltip'],\n  },\n  // Block for logical operations: 'and', 'or'.\n  {\n    'type': 'logic_operation',\n    'message0': '%1 %2 %3',\n    'args0': [\n      {\n        'type': 'input_value',\n        'name': 'A',\n        'check': 'Boolean',\n      },\n      {\n        'type': 'field_dropdown',\n        'name': 'OP',\n        'options': [\n          ['%{BKY_LOGIC_OPERATION_AND}', 'AND'],\n          ['%{BKY_LOGIC_OPERATION_OR}', 'OR'],\n        ],\n      },\n      {\n        'type': 'input_value',\n        'name': 'B',\n        'check': 'Boolean',\n      },\n    ],\n    'inputsInline': true,\n    'output': 'Boolean',\n    'style': 'logic_blocks',\n    'helpUrl': '%{BKY_LOGIC_OPERATION_HELPURL}',\n    'extensions': ['logic_op_tooltip'],\n  },\n  // Block for negation.\n  {\n    'type': 'logic_negate',\n    'message0': '%{BKY_LOGIC_NEGATE_TITLE}',\n    'args0': [\n      {\n        'type': 'input_value',\n        'name': 'BOOL',\n        'check': 'Boolean',\n      },\n    ],\n    'output': 'Boolean',\n    'style': 'logic_blocks',\n    'tooltip': '%{BKY_LOGIC_NEGATE_TOOLTIP}',\n    'helpUrl': '%{BKY_LOGIC_NEGATE_HELPURL}',\n  },\n  // Block for null data type.\n  {\n    'type': 'logic_null',\n    'message0': '%{BKY_LOGIC_NULL}',\n    'output': null,\n    'style': 'logic_blocks',\n    'tooltip': '%{BKY_LOGIC_NULL_TOOLTIP}',\n    'helpUrl': '%{BKY_LOGIC_NULL_HELPURL}',\n  },\n  // Block for ternary operator.\n  {\n    'type': 'logic_ternary',\n    'message0': '%{BKY_LOGIC_TERNARY_CONDITION} %1',\n    'args0': [\n      {\n        'type': 'input_value',\n        'name': 'IF',\n        'check': 'Boolean',\n      },\n    ],\n    'message1': '%{BKY_LOGIC_TERNARY_IF_TRUE} %1',\n    'args1': [\n      {\n        'type': 'input_value',\n        'name': 'THEN',\n      },\n    ],\n    'message2': '%{BKY_LOGIC_TERNARY_IF_FALSE} %1',\n    'args2': [\n      {\n        'type': 'input_value',\n        'name': 'ELSE',\n      },\n    ],\n    'output': null,\n    'style': 'logic_blocks',\n    'tooltip': '%{BKY_LOGIC_TERNARY_TOOLTIP}',\n    'helpUrl': '%{BKY_LOGIC_TERNARY_HELPURL}',\n    'extensions': ['logic_ternary'],\n  },\n  // Block representing the if statement in the controls_if mutator.\n  {\n    'type': 'controls_if_if',\n    'message0': '%{BKY_CONTROLS_IF_IF_TITLE_IF}',\n    'nextStatement': null,\n    'enableContextMenu': false,\n    'style': 'logic_blocks',\n    'tooltip': '%{BKY_CONTROLS_IF_IF_TOOLTIP}',\n  },\n  // Block representing the else-if statement in the controls_if mutator.\n  {\n    'type': 'controls_if_elseif',\n    'message0': '%{BKY_CONTROLS_IF_ELSEIF_TITLE_ELSEIF}',\n    'previousStatement': null,\n    'nextStatement': null,\n    'enableContextMenu': false,\n    'style': 'logic_blocks',\n    'tooltip': '%{BKY_CONTROLS_IF_ELSEIF_TOOLTIP}',\n  },\n  // Block representing the else statement in the controls_if mutator.\n  {\n    'type': 'controls_if_else',\n    'message0': '%{BKY_CONTROLS_IF_ELSE_TITLE_ELSE}',\n    'previousStatement': null,\n    'enableContextMenu': false,\n    'style': 'logic_blocks',\n    'tooltip': '%{BKY_CONTROLS_IF_ELSE_TOOLTIP}',\n  },\n]);\nexports.blocks = blocks;\n\n/**\n * Tooltip text, keyed by block OP value. Used by logic_compare and\n * logic_operation blocks.\n * @see {Extensions#buildTooltipForDropdown}\n * @readonly\n */\nconst TOOLTIPS_BY_OP = {\n  // logic_compare\n  'EQ': '%{BKY_LOGIC_COMPARE_TOOLTIP_EQ}',\n  'NEQ': '%{BKY_LOGIC_COMPARE_TOOLTIP_NEQ}',\n  'LT': '%{BKY_LOGIC_COMPARE_TOOLTIP_LT}',\n  'LTE': '%{BKY_LOGIC_COMPARE_TOOLTIP_LTE}',\n  'GT': '%{BKY_LOGIC_COMPARE_TOOLTIP_GT}',\n  'GTE': '%{BKY_LOGIC_COMPARE_TOOLTIP_GTE}',\n\n  // logic_operation\n  'AND': '%{BKY_LOGIC_OPERATION_TOOLTIP_AND}',\n  'OR': '%{BKY_LOGIC_OPERATION_TOOLTIP_OR}',\n};\n\nExtensions.register(\n    'logic_op_tooltip',\n    Extensions.buildTooltipForDropdown('OP', TOOLTIPS_BY_OP));\n\n/**\n * Mutator methods added to controls_if blocks.\n * @mixin\n * @augments Block\n * @readonly\n */\nconst CONTROLS_IF_MUTATOR_MIXIN = {\n  elseifCount_: 0,\n  elseCount_: 0,\n\n  /**\n   * Create XML to represent the number of else-if and else inputs.\n   * Backwards compatible serialization implementation.\n   * @return {Element} XML storage element.\n   * @this {Block}\n   */\n  mutationToDom: function() {\n    if (!this.elseifCount_ && !this.elseCount_) {\n      return null;\n    }\n    const container = xmlUtils.createElement('mutation');\n    if (this.elseifCount_) {\n      container.setAttribute('elseif', this.elseifCount_);\n    }\n    if (this.elseCount_) {\n      container.setAttribute('else', 1);\n    }\n    return container;\n  },\n  /**\n   * Parse XML to restore the else-if and else inputs.\n   * Backwards compatible serialization implementation.\n   * @param {!Element} xmlElement XML storage element.\n   * @this {Block}\n   */\n  domToMutation: function(xmlElement) {\n    this.elseifCount_ = parseInt(xmlElement.getAttribute('elseif'), 10) || 0;\n    this.elseCount_ = parseInt(xmlElement.getAttribute('else'), 10) || 0;\n    this.rebuildShape_();\n  },\n  /**\n   * Returns the state of this block as a JSON serializable object.\n   * @return {?{elseIfCount: (number|undefined), haseElse: (boolean|undefined)}}\n   *     The state of this block, ie the else if count and else state.\n   */\n  saveExtraState: function() {\n    if (!this.elseifCount_ && !this.elseCount_) {\n      return null;\n    }\n    const state = Object.create(null);\n    if (this.elseifCount_) {\n      state['elseIfCount'] = this.elseifCount_;\n    }\n    if (this.elseCount_) {\n      state['hasElse'] = true;\n    }\n    return state;\n  },\n  /**\n   * Applies the given state to this block.\n   * @param {*} state The state to apply to this block, ie the else if count and\n   *     else state.\n   */\n  loadExtraState: function(state) {\n    this.elseifCount_ = state['elseIfCount'] || 0;\n    this.elseCount_ = state['hasElse'] ? 1 : 0;\n    this.updateShape_();\n  },\n  /**\n   * Populate the mutator's dialog with this block's components.\n   * @param {!Workspace} workspace Mutator's workspace.\n   * @return {!Block} Root block in mutator.\n   * @this {Block}\n   */\n  decompose: function(workspace) {\n    const containerBlock = workspace.newBlock('controls_if_if');\n    containerBlock.initSvg();\n    let connection = containerBlock.nextConnection;\n    for (let i = 1; i <= this.elseifCount_; i++) {\n      const elseifBlock = workspace.newBlock('controls_if_elseif');\n      elseifBlock.initSvg();\n      connection.connect(elseifBlock.previousConnection);\n      connection = elseifBlock.nextConnection;\n    }\n    if (this.elseCount_) {\n      const elseBlock = workspace.newBlock('controls_if_else');\n      elseBlock.initSvg();\n      connection.connect(elseBlock.previousConnection);\n    }\n    return containerBlock;\n  },\n  /**\n   * Reconfigure this block based on the mutator dialog's components.\n   * @param {!Block} containerBlock Root block in mutator.\n   * @this {Block}\n   */\n  compose: function(containerBlock) {\n    let clauseBlock = containerBlock.nextConnection.targetBlock();\n    // Count number of inputs.\n    this.elseifCount_ = 0;\n    this.elseCount_ = 0;\n    const valueConnections = [null];\n    const statementConnections = [null];\n    let elseStatementConnection = null;\n    while (clauseBlock) {\n      if (clauseBlock.isInsertionMarker()) {\n        clauseBlock = clauseBlock.getNextBlock();\n        continue;\n      }\n      switch (clauseBlock.type) {\n        case 'controls_if_elseif':\n          this.elseifCount_++;\n          valueConnections.push(clauseBlock.valueConnection_);\n          statementConnections.push(clauseBlock.statementConnection_);\n          break;\n        case 'controls_if_else':\n          this.elseCount_++;\n          elseStatementConnection = clauseBlock.statementConnection_;\n          break;\n        default:\n          throw TypeError('Unknown block type: ' + clauseBlock.type);\n      }\n      clauseBlock = clauseBlock.getNextBlock();\n    }\n    this.updateShape_();\n    // Reconnect any child blocks.\n    this.reconnectChildBlocks_(\n        valueConnections, statementConnections, elseStatementConnection);\n  },\n  /**\n   * Store pointers to any connected child blocks.\n   * @param {!Block} containerBlock Root block in mutator.\n   * @this {Block}\n   */\n  saveConnections: function(containerBlock) {\n    let clauseBlock = containerBlock.nextConnection.targetBlock();\n    let i = 1;\n    while (clauseBlock) {\n      if (clauseBlock.isInsertionMarker()) {\n        clauseBlock = clauseBlock.getNextBlock();\n        continue;\n      }\n      switch (clauseBlock.type) {\n        case 'controls_if_elseif': {\n          const inputIf = this.getInput('IF' + i);\n          const inputDo = this.getInput('DO' + i);\n          clauseBlock.valueConnection_ =\n              inputIf && inputIf.connection.targetConnection;\n          clauseBlock.statementConnection_ =\n              inputDo && inputDo.connection.targetConnection;\n          i++;\n          break;\n        }\n        case 'controls_if_else': {\n          const inputDo = this.getInput('ELSE');\n          clauseBlock.statementConnection_ =\n              inputDo && inputDo.connection.targetConnection;\n          break;\n        }\n        default:\n          throw TypeError('Unknown block type: ' + clauseBlock.type);\n      }\n      clauseBlock = clauseBlock.getNextBlock();\n    }\n  },\n  /**\n   * Reconstructs the block with all child blocks attached.\n   * @this {Block}\n   */\n  rebuildShape_: function() {\n    const valueConnections = [null];\n    const statementConnections = [null];\n    let elseStatementConnection = null;\n\n    if (this.getInput('ELSE')) {\n      elseStatementConnection =\n          this.getInput('ELSE').connection.targetConnection;\n    }\n    for (let i = 1; this.getInput('IF' + i); i++) {\n      const inputIf = this.getInput('IF' + i);\n      const inputDo = this.getInput('DO' + i);\n      valueConnections.push(inputIf.connection.targetConnection);\n      statementConnections.push(inputDo.connection.targetConnection);\n    }\n    this.updateShape_();\n    this.reconnectChildBlocks_(\n        valueConnections, statementConnections, elseStatementConnection);\n  },\n  /**\n   * Modify this block to have the correct number of inputs.\n   * @this {Block}\n   * @private\n   */\n  updateShape_: function() {\n    // Delete everything.\n    if (this.getInput('ELSE')) {\n      this.removeInput('ELSE');\n    }\n    for (let i = 1; this.getInput('IF' + i); i++) {\n      this.removeInput('IF' + i);\n      this.removeInput('DO' + i);\n    }\n    // Rebuild block.\n    for (let i = 1; i <= this.elseifCount_; i++) {\n      this.appendValueInput('IF' + i).setCheck('Boolean').appendField(\n          Msg['CONTROLS_IF_MSG_ELSEIF']);\n      this.appendStatementInput('DO' + i).appendField(\n          Msg['CONTROLS_IF_MSG_THEN']);\n    }\n    if (this.elseCount_) {\n      this.appendStatementInput('ELSE').appendField(\n          Msg['CONTROLS_IF_MSG_ELSE']);\n    }\n  },\n  /**\n   * Reconnects child blocks.\n   * @param {!Array<?RenderedConnection>} valueConnections List of\n   * value connections for 'if' input.\n   * @param {!Array<?RenderedConnection>} statementConnections List of\n   * statement connections for 'do' input.\n   * @param {?RenderedConnection} elseStatementConnection Statement\n   * connection for else input.\n   * @this {Block}\n   */\n  reconnectChildBlocks_: function(\n      valueConnections, statementConnections, elseStatementConnection) {\n    for (let i = 1; i <= this.elseifCount_; i++) {\n      Mutator.reconnect(valueConnections[i], this, 'IF' + i);\n      Mutator.reconnect(statementConnections[i], this, 'DO' + i);\n    }\n    Mutator.reconnect(elseStatementConnection, this, 'ELSE');\n  },\n};\n\nExtensions.registerMutator(\n    'controls_if_mutator', CONTROLS_IF_MUTATOR_MIXIN, null,\n    ['controls_if_elseif', 'controls_if_else']);\n/**\n * \"controls_if\" extension function. Adds mutator, shape updating methods, and\n * dynamic tooltip to \"controls_if\" blocks.\n * @this {Block}\n */\nconst CONTROLS_IF_TOOLTIP_EXTENSION = function() {\n  this.setTooltip(function() {\n    if (!this.elseifCount_ && !this.elseCount_) {\n      return Msg['CONTROLS_IF_TOOLTIP_1'];\n    } else if (!this.elseifCount_ && this.elseCount_) {\n      return Msg['CONTROLS_IF_TOOLTIP_2'];\n    } else if (this.elseifCount_ && !this.elseCount_) {\n      return Msg['CONTROLS_IF_TOOLTIP_3'];\n    } else if (this.elseifCount_ && this.elseCount_) {\n      return Msg['CONTROLS_IF_TOOLTIP_4'];\n    }\n    return '';\n  }.bind(this));\n};\n\nExtensions.register('controls_if_tooltip', CONTROLS_IF_TOOLTIP_EXTENSION);\n\n/**\n * Adds dynamic type validation for the left and right sides of a logic_compare\n * block.\n * @mixin\n * @augments Block\n * @readonly\n */\nconst LOGIC_COMPARE_ONCHANGE_MIXIN = {\n  /**\n   * Called whenever anything on the workspace changes.\n   * Prevent mismatched types from being compared.\n   * @param {!AbstractEvent} e Change event.\n   * @this {Block}\n   */\n  onchange: function(e) {\n    if (!this.prevBlocks_) {\n      this.prevBlocks_ = [null, null];\n    }\n\n    const blockA = this.getInputTargetBlock('A');\n    const blockB = this.getInputTargetBlock('B');\n    // Disconnect blocks that existed prior to this change if they don't match.\n    if (blockA && blockB &&\n        !this.workspace.connectionChecker.doTypeChecks(\n            blockA.outputConnection, blockB.outputConnection)) {\n      // Mismatch between two inputs.  Revert the block connections,\n      // bumping away the newly connected block(s).\n      Events.setGroup(e.group);\n      const prevA = this.prevBlocks_[0];\n      if (prevA !== blockA) {\n        blockA.unplug();\n        if (prevA && !prevA.isDisposed() && !prevA.isShadow()) {\n          // The shadow block is automatically replaced during unplug().\n          this.getInput('A').connection.connect(prevA.outputConnection);\n        }\n      }\n      const prevB = this.prevBlocks_[1];\n      if (prevB !== blockB) {\n        blockB.unplug();\n        if (prevB && !prevB.isDisposed() && !prevB.isShadow()) {\n          // The shadow block is automatically replaced during unplug().\n          this.getInput('B').connection.connect(prevB.outputConnection);\n        }\n      }\n      this.bumpNeighbours();\n      Events.setGroup(false);\n    }\n    this.prevBlocks_[0] = this.getInputTargetBlock('A');\n    this.prevBlocks_[1] = this.getInputTargetBlock('B');\n  },\n};\n\n/**\n * \"logic_compare\" extension function. Adds type left and right side type\n * checking to \"logic_compare\" blocks.\n * @this {Block}\n * @readonly\n */\nconst LOGIC_COMPARE_EXTENSION = function() {\n  // Add onchange handler to ensure types are compatible.\n  this.mixin(LOGIC_COMPARE_ONCHANGE_MIXIN);\n};\n\nExtensions.register('logic_compare', LOGIC_COMPARE_EXTENSION);\n\n/**\n * Adds type coordination between inputs and output.\n * @mixin\n * @augments Block\n * @readonly\n */\nconst LOGIC_TERNARY_ONCHANGE_MIXIN = {\n  prevParentConnection_: null,\n\n  /**\n   * Called whenever anything on the workspace changes.\n   * Prevent mismatched types.\n   * @param {!AbstractEvent} e Change event.\n   * @this {Block}\n   */\n  onchange: function(e) {\n    const blockA = this.getInputTargetBlock('THEN');\n    const blockB = this.getInputTargetBlock('ELSE');\n    const parentConnection = this.outputConnection.targetConnection;\n    // Disconnect blocks that existed prior to this change if they don't match.\n    if ((blockA || blockB) && parentConnection) {\n      for (let i = 0; i < 2; i++) {\n        const block = (i === 1) ? blockA : blockB;\n        if (block &&\n            !block.workspace.connectionChecker.doTypeChecks(\n                block.outputConnection, parentConnection)) {\n          // Ensure that any disconnections are grouped with the causing event.\n          Events.setGroup(e.group);\n          if (parentConnection === this.prevParentConnection_) {\n            this.unplug();\n            parentConnection.getSourceBlock().bumpNeighbours();\n          } else {\n            block.unplug();\n            block.bumpNeighbours();\n          }\n          Events.setGroup(false);\n        }\n      }\n    }\n    this.prevParentConnection_ = parentConnection;\n  },\n};\n\nExtensions.registerMixin('logic_ternary', LOGIC_TERNARY_ONCHANGE_MIXIN);\n\n// Register provided blocks.\ndefineBlocks(blocks);\n","/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview List blocks for Blockly.\n * @suppress {checkTypes}\n */\n'use strict';\n\ngoog.module('Blockly.libraryBlocks.lists');\n\nconst xmlUtils = goog.require('Blockly.utils.xml');\nconst Xml = goog.require('Blockly.Xml');\nconst {Align} = goog.require('Blockly.Input');\n/* eslint-disable-next-line no-unused-vars */\nconst {Block} = goog.requireType('Blockly.Block');\n// const {BlockDefinition} = goog.requireType('Blockly.blocks');\n// TODO (6248): Properly import the BlockDefinition type.\n/* eslint-disable-next-line no-unused-vars */\nconst BlockDefinition = Object;\nconst {ConnectionType} = goog.require('Blockly.ConnectionType');\nconst {FieldDropdown} = goog.require('Blockly.FieldDropdown');\nconst {Msg} = goog.require('Blockly.Msg');\nconst {Mutator} = goog.require('Blockly.Mutator');\n/* eslint-disable-next-line no-unused-vars */\nconst {Workspace} = goog.requireType('Blockly.Workspace');\nconst {createBlockDefinitionsFromJsonArray, defineBlocks} = goog.require('Blockly.common');\n/** @suppress {extraRequire} */\ngoog.require('Blockly.FieldDropdown');\n\n\n/**\n * A dictionary of the block definitions provided by this module.\n * @type {!Object<string, !BlockDefinition>}\n */\nconst blocks = createBlockDefinitionsFromJsonArray([\n  // Block for creating an empty list\n  // The 'list_create_with' block is preferred as it is more flexible.\n  // <block type=\"lists_create_with\">\n  //   <mutation items=\"0\"></mutation>\n  // </block>\n  {\n    'type': 'lists_create_empty',\n    'message0': '%{BKY_LISTS_CREATE_EMPTY_TITLE}',\n    'output': 'Array',\n    'style': 'list_blocks',\n    'tooltip': '%{BKY_LISTS_CREATE_EMPTY_TOOLTIP}',\n    'helpUrl': '%{BKY_LISTS_CREATE_EMPTY_HELPURL}',\n  },\n  // Block for creating a list with one element repeated.\n  {\n    'type': 'lists_repeat',\n    'message0': '%{BKY_LISTS_REPEAT_TITLE}',\n    'args0': [\n      {\n        'type': 'input_value',\n        'name': 'ITEM',\n      },\n      {\n        'type': 'input_value',\n        'name': 'NUM',\n        'check': 'Number',\n      },\n    ],\n    'output': 'Array',\n    'style': 'list_blocks',\n    'tooltip': '%{BKY_LISTS_REPEAT_TOOLTIP}',\n    'helpUrl': '%{BKY_LISTS_REPEAT_HELPURL}',\n  },\n  // Block for reversing a list.\n  {\n    'type': 'lists_reverse',\n    'message0': '%{BKY_LISTS_REVERSE_MESSAGE0}',\n    'args0': [\n      {\n        'type': 'input_value',\n        'name': 'LIST',\n        'check': 'Array',\n      },\n    ],\n    'output': 'Array',\n    'inputsInline': true,\n    'style': 'list_blocks',\n    'tooltip': '%{BKY_LISTS_REVERSE_TOOLTIP}',\n    'helpUrl': '%{BKY_LISTS_REVERSE_HELPURL}',\n  },\n  // Block for checking if a list is empty\n  {\n    'type': 'lists_isEmpty',\n    'message0': '%{BKY_LISTS_ISEMPTY_TITLE}',\n    'args0': [\n      {\n        'type': 'input_value',\n        'name': 'VALUE',\n        'check': ['String', 'Array'],\n      },\n    ],\n    'output': 'Boolean',\n    'style': 'list_blocks',\n    'tooltip': '%{BKY_LISTS_ISEMPTY_TOOLTIP}',\n    'helpUrl': '%{BKY_LISTS_ISEMPTY_HELPURL}',\n  },\n  // Block for getting the list length\n  {\n    'type': 'lists_length',\n    'message0': '%{BKY_LISTS_LENGTH_TITLE}',\n    'args0': [\n      {\n        'type': 'input_value',\n        'name': 'VALUE',\n        'check': ['String', 'Array'],\n      },\n    ],\n    'output': 'Number',\n    'style': 'list_blocks',\n    'tooltip': '%{BKY_LISTS_LENGTH_TOOLTIP}',\n    'helpUrl': '%{BKY_LISTS_LENGTH_HELPURL}',\n  },\n]);\nexports.blocks = blocks;\n\nblocks['lists_create_with'] = {\n  /**\n   * Block for creating a list with any number of elements of any type.\n   * @this {Block}\n   */\n  init: function() {\n    this.setHelpUrl(Msg['LISTS_CREATE_WITH_HELPURL']);\n    this.setStyle('list_blocks');\n    this.itemCount_ = 3;\n    this.updateShape_();\n    this.setOutput(true, 'Array');\n    this.setMutator(new Mutator(['lists_create_with_item'], this));\n    this.setTooltip(Msg['LISTS_CREATE_WITH_TOOLTIP']);\n  },\n  /**\n   * Create XML to represent list inputs.\n   * Backwards compatible serialization implementation.\n   * @return {!Element} XML storage element.\n   * @this {Block}\n   */\n  mutationToDom: function() {\n    const container = xmlUtils.createElement('mutation');\n    container.setAttribute('items', this.itemCount_);\n    return container;\n  },\n  /**\n   * Parse XML to restore the list inputs.\n   * Backwards compatible serialization implementation.\n   * @param {!Element} xmlElement XML storage element.\n   * @this {Block}\n   */\n  domToMutation: function(xmlElement) {\n    this.itemCount_ = parseInt(xmlElement.getAttribute('items'), 10);\n    this.updateShape_();\n  },\n  /**\n   * Returns the state of this block as a JSON serializable object.\n   * @return {{itemCount: number}} The state of this block, ie the item count.\n   */\n  saveExtraState: function() {\n    return {\n      'itemCount': this.itemCount_,\n    };\n  },\n  /**\n   * Applies the given state to this block.\n   * @param {*} state The state to apply to this block, ie the item count.\n   */\n  loadExtraState: function(state) {\n    this.itemCount_ = state['itemCount'];\n    this.updateShape_();\n  },\n  /**\n   * Populate the mutator's dialog with this block's components.\n   * @param {!Workspace} workspace Mutator's workspace.\n   * @return {!Block} Root block in mutator.\n   * @this {Block}\n   */\n  decompose: function(workspace) {\n    const containerBlock = workspace.newBlock('lists_create_with_container');\n    containerBlock.initSvg();\n    let connection = containerBlock.getInput('STACK').connection;\n    for (let i = 0; i < this.itemCount_; i++) {\n      const itemBlock = workspace.newBlock('lists_create_with_item');\n      itemBlock.initSvg();\n      connection.connect(itemBlock.previousConnection);\n      connection = itemBlock.nextConnection;\n    }\n    return containerBlock;\n  },\n  /**\n   * Reconfigure this block based on the mutator dialog's components.\n   * @param {!Block} containerBlock Root block in mutator.\n   * @this {Block}\n   */\n  compose: function(containerBlock) {\n    let itemBlock = containerBlock.getInputTargetBlock('STACK');\n    // Count number of inputs.\n    const connections = [];\n    while (itemBlock) {\n      if (itemBlock.isInsertionMarker()) {\n        itemBlock = itemBlock.getNextBlock();\n        continue;\n      }\n      connections.push(itemBlock.valueConnection_);\n      itemBlock = itemBlock.getNextBlock();\n    }\n    // Disconnect any children that don't belong.\n    for (let i = 0; i < this.itemCount_; i++) {\n      const connection = this.getInput('ADD' + i).connection.targetConnection;\n      if (connection && connections.indexOf(connection) === -1) {\n        connection.disconnect();\n      }\n    }\n    this.itemCount_ = connections.length;\n    this.updateShape_();\n    // Reconnect any child blocks.\n    for (let i = 0; i < this.itemCount_; i++) {\n      Mutator.reconnect(connections[i], this, 'ADD' + i);\n    }\n  },\n  /**\n   * Store pointers to any connected child blocks.\n   * @param {!Block} containerBlock Root block in mutator.\n   * @this {Block}\n   */\n  saveConnections: function(containerBlock) {\n    let itemBlock = containerBlock.getInputTargetBlock('STACK');\n    let i = 0;\n    while (itemBlock) {\n      if (itemBlock.isInsertionMarker()) {\n        itemBlock = itemBlock.getNextBlock();\n        continue;\n      }\n      const input = this.getInput('ADD' + i);\n      itemBlock.valueConnection_ = input && input.connection.targetConnection;\n      itemBlock = itemBlock.getNextBlock();\n      i++;\n    }\n  },\n  /**\n   * Modify this block to have the correct number of inputs.\n   * @private\n   * @this {Block}\n   */\n  updateShape_: function() {\n    if (this.itemCount_ && this.getInput('EMPTY')) {\n      this.removeInput('EMPTY');\n    } else if (!this.itemCount_ && !this.getInput('EMPTY')) {\n      this.appendDummyInput('EMPTY').appendField(\n          Msg['LISTS_CREATE_EMPTY_TITLE']);\n    }\n    // Add new inputs.\n    for (let i = 0; i < this.itemCount_; i++) {\n      if (!this.getInput('ADD' + i)) {\n        const input = this.appendValueInput('ADD' + i).setAlign(Align.RIGHT);\n        if (i === 0) {\n          input.appendField(Msg['LISTS_CREATE_WITH_INPUT_WITH']);\n        }\n      }\n    }\n    // Remove deleted inputs.\n    for (let i = this.itemCount_; this.getInput('ADD' + i); i++) {\n      this.removeInput('ADD' + i);\n    }\n  },\n};\n\nblocks['lists_create_with_container'] = {\n  /**\n   * Mutator block for list container.\n   * @this {Block}\n   */\n  init: function() {\n    this.setStyle('list_blocks');\n    this.appendDummyInput().appendField(\n        Msg['LISTS_CREATE_WITH_CONTAINER_TITLE_ADD']);\n    this.appendStatementInput('STACK');\n    this.setTooltip(Msg['LISTS_CREATE_WITH_CONTAINER_TOOLTIP']);\n    this.contextMenu = false;\n  },\n};\n\nblocks['lists_create_with_item'] = {\n  /**\n   * Mutator block for adding items.\n   * @this {Block}\n   */\n  init: function() {\n    this.setStyle('list_blocks');\n    this.appendDummyInput().appendField(Msg['LISTS_CREATE_WITH_ITEM_TITLE']);\n    this.setPreviousStatement(true);\n    this.setNextStatement(true);\n    this.setTooltip(Msg['LISTS_CREATE_WITH_ITEM_TOOLTIP']);\n    this.contextMenu = false;\n  },\n};\n\nblocks['lists_indexOf'] = {\n  /**\n   * Block for finding an item in the list.\n   * @this {Block}\n   */\n  init: function() {\n    const OPERATORS = [\n      [Msg['LISTS_INDEX_OF_FIRST'], 'FIRST'],\n      [Msg['LISTS_INDEX_OF_LAST'], 'LAST'],\n    ];\n    this.setHelpUrl(Msg['LISTS_INDEX_OF_HELPURL']);\n    this.setStyle('list_blocks');\n    this.setOutput(true, 'Number');\n    this.appendValueInput('VALUE').setCheck('Array').appendField(\n        Msg['LISTS_INDEX_OF_INPUT_IN_LIST']);\n    this.appendValueInput('FIND').appendField(\n        new FieldDropdown(OPERATORS), 'END');\n    this.setInputsInline(true);\n    // Assign 'this' to a variable for use in the tooltip closure below.\n    const thisBlock = this;\n    this.setTooltip(function() {\n      return Msg['LISTS_INDEX_OF_TOOLTIP'].replace(\n          '%1', thisBlock.workspace.options.oneBasedIndex ? '0' : '-1');\n    });\n  },\n};\n\nblocks['lists_getIndex'] = {\n  /**\n   * Block for getting element at index.\n   * @this {Block}\n   */\n  init: function() {\n    const MODE = [\n      [Msg['LISTS_GET_INDEX_GET'], 'GET'],\n      [Msg['LISTS_GET_INDEX_GET_REMOVE'], 'GET_REMOVE'],\n      [Msg['LISTS_GET_INDEX_REMOVE'], 'REMOVE'],\n    ];\n    this.WHERE_OPTIONS = [\n      [Msg['LISTS_GET_INDEX_FROM_START'], 'FROM_START'],\n      [Msg['LISTS_GET_INDEX_FROM_END'], 'FROM_END'],\n      [Msg['LISTS_GET_INDEX_FIRST'], 'FIRST'],\n      [Msg['LISTS_GET_INDEX_LAST'], 'LAST'],\n      [Msg['LISTS_GET_INDEX_RANDOM'], 'RANDOM'],\n    ];\n    this.setHelpUrl(Msg['LISTS_GET_INDEX_HELPURL']);\n    this.setStyle('list_blocks');\n    const modeMenu = new FieldDropdown(\n        MODE,\n        /**\n         * @param {*} value The input value.\n         * @this {FieldDropdown}\n         */\n        function(value) {\n          const isStatement = (value === 'REMOVE');\n          this.getSourceBlock().updateStatement_(isStatement);\n        });\n    this.appendValueInput('VALUE').setCheck('Array').appendField(\n        Msg['LISTS_GET_INDEX_INPUT_IN_LIST']);\n    this.appendDummyInput()\n        .appendField(modeMenu, 'MODE')\n        .appendField('', 'SPACE');\n    this.appendDummyInput('AT');\n    if (Msg['LISTS_GET_INDEX_TAIL']) {\n      this.appendDummyInput('TAIL').appendField(Msg['LISTS_GET_INDEX_TAIL']);\n    }\n    this.setInputsInline(true);\n    this.setOutput(true);\n    this.updateAt_(true);\n    // Assign 'this' to a variable for use in the tooltip closure below.\n    const thisBlock = this;\n    this.setTooltip(function() {\n      const mode = thisBlock.getFieldValue('MODE');\n      const where = thisBlock.getFieldValue('WHERE');\n      let tooltip = '';\n      switch (mode + ' ' + where) {\n        case 'GET FROM_START':\n        case 'GET FROM_END':\n          tooltip = Msg['LISTS_GET_INDEX_TOOLTIP_GET_FROM'];\n          break;\n        case 'GET FIRST':\n          tooltip = Msg['LISTS_GET_INDEX_TOOLTIP_GET_FIRST'];\n          break;\n        case 'GET LAST':\n          tooltip = Msg['LISTS_GET_INDEX_TOOLTIP_GET_LAST'];\n          break;\n        case 'GET RANDOM':\n          tooltip = Msg['LISTS_GET_INDEX_TOOLTIP_GET_RANDOM'];\n          break;\n        case 'GET_REMOVE FROM_START':\n        case 'GET_REMOVE FROM_END':\n          tooltip = Msg['LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_FROM'];\n          break;\n        case 'GET_REMOVE FIRST':\n          tooltip = Msg['LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_FIRST'];\n          break;\n        case 'GET_REMOVE LAST':\n          tooltip = Msg['LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_LAST'];\n          break;\n        case 'GET_REMOVE RANDOM':\n          tooltip = Msg['LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_RANDOM'];\n          break;\n        case 'REMOVE FROM_START':\n        case 'REMOVE FROM_END':\n          tooltip = Msg['LISTS_GET_INDEX_TOOLTIP_REMOVE_FROM'];\n          break;\n        case 'REMOVE FIRST':\n          tooltip = Msg['LISTS_GET_INDEX_TOOLTIP_REMOVE_FIRST'];\n          break;\n        case 'REMOVE LAST':\n          tooltip = Msg['LISTS_GET_INDEX_TOOLTIP_REMOVE_LAST'];\n          break;\n        case 'REMOVE RANDOM':\n          tooltip = Msg['LISTS_GET_INDEX_TOOLTIP_REMOVE_RANDOM'];\n          break;\n      }\n      if (where === 'FROM_START' || where === 'FROM_END') {\n        const msg = (where === 'FROM_START') ?\n            Msg['LISTS_INDEX_FROM_START_TOOLTIP'] :\n            Msg['LISTS_INDEX_FROM_END_TOOLTIP'];\n        tooltip += '  ' +\n            msg.replace(\n                '%1', thisBlock.workspace.options.oneBasedIndex ? '#1' : '#0');\n      }\n      return tooltip;\n    });\n  },\n  /**\n   * Create XML to represent whether the block is a statement or a value.\n   * Also represent whether there is an 'AT' input.\n   * @return {!Element} XML storage element.\n   * @this {Block}\n   */\n  mutationToDom: function() {\n    const container = xmlUtils.createElement('mutation');\n    const isStatement = !this.outputConnection;\n    container.setAttribute('statement', isStatement);\n    const isAt = this.getInput('AT').type === ConnectionType.INPUT_VALUE;\n    container.setAttribute('at', isAt);\n    return container;\n  },\n  /**\n   * Parse XML to restore the 'AT' input.\n   * @param {!Element} xmlElement XML storage element.\n   * @this {Block}\n   */\n  domToMutation: function(xmlElement) {\n    // Note: Until January 2013 this block did not have mutations,\n    // so 'statement' defaults to false and 'at' defaults to true.\n    const isStatement = (xmlElement.getAttribute('statement') === 'true');\n    this.updateStatement_(isStatement);\n    const isAt = (xmlElement.getAttribute('at') !== 'false');\n    this.updateAt_(isAt);\n  },\n\n  /**\n   * Returns the state of this block as a JSON serializable object.\n   * Returns null for efficiency if no state is needed (not a statement)\n   * @return {?{isStatement: boolean}} The state of this block, ie whether it's\n   *     a statement.\n   */\n  saveExtraState: function() {\n    if (!this.outputConnection) {\n      return {\n        'isStatement': true,\n      };\n    }\n    return null;\n  },\n\n  /**\n   * Applies the given state to this block.\n   * @param {*} state The state to apply to this block, ie whether it's a\n   *     statement.\n   */\n  loadExtraState: function(state) {\n    if (state['isStatement']) {\n      this.updateStatement_(true);\n    } else if (typeof state === 'string') {\n      // backward compatible for json serialised mutations\n      this.domToMutation(Xml.textToDom(state));\n    }\n  },\n\n  /**\n   * Switch between a value block and a statement block.\n   * @param {boolean} newStatement True if the block should be a statement.\n   *     False if the block should be a value.\n   * @private\n   * @this {Block}\n   */\n  updateStatement_: function(newStatement) {\n    const oldStatement = !this.outputConnection;\n    if (newStatement !== oldStatement) {\n      this.unplug(true, true);\n      if (newStatement) {\n        this.setOutput(false);\n        this.setPreviousStatement(true);\n        this.setNextStatement(true);\n      } else {\n        this.setPreviousStatement(false);\n        this.setNextStatement(false);\n        this.setOutput(true);\n      }\n    }\n  },\n  /**\n   * Create or delete an input for the numeric index.\n   * @param {boolean} isAt True if the input should exist.\n   * @private\n   * @this {Block}\n   */\n  updateAt_: function(isAt) {\n    // Destroy old 'AT' and 'ORDINAL' inputs.\n    this.removeInput('AT');\n    this.removeInput('ORDINAL', true);\n    // Create either a value 'AT' input or a dummy input.\n    if (isAt) {\n      this.appendValueInput('AT').setCheck('Number');\n      if (Msg['ORDINAL_NUMBER_SUFFIX']) {\n        this.appendDummyInput('ORDINAL').appendField(\n            Msg['ORDINAL_NUMBER_SUFFIX']);\n      }\n    } else {\n      this.appendDummyInput('AT');\n    }\n    const menu = new FieldDropdown(\n        this.WHERE_OPTIONS,\n        /**\n         * @param {*} value The input value.\n         * @this {FieldDropdown}\n         * @return {null|undefined} Null if the field has been replaced;\n         *     otherwise undefined.\n         */\n        function(value) {\n          const newAt = (value === 'FROM_START') || (value === 'FROM_END');\n          // The 'isAt' variable is available due to this function being a\n          // closure.\n          if (newAt !== isAt) {\n            const block = this.getSourceBlock();\n            block.updateAt_(newAt);\n            // This menu has been destroyed and replaced.  Update the\n            // replacement.\n            block.setFieldValue(value, 'WHERE');\n            return null;\n          }\n          return undefined;\n        });\n    this.getInput('AT').appendField(menu, 'WHERE');\n    if (Msg['LISTS_GET_INDEX_TAIL']) {\n      this.moveInputBefore('TAIL', null);\n    }\n  },\n};\n\nblocks['lists_setIndex'] = {\n  /**\n   * Block for setting the element at index.\n   * @this {Block}\n   */\n  init: function() {\n    const MODE = [\n      [Msg['LISTS_SET_INDEX_SET'], 'SET'],\n      [Msg['LISTS_SET_INDEX_INSERT'], 'INSERT'],\n    ];\n    this.WHERE_OPTIONS = [\n      [Msg['LISTS_GET_INDEX_FROM_START'], 'FROM_START'],\n      [Msg['LISTS_GET_INDEX_FROM_END'], 'FROM_END'],\n      [Msg['LISTS_GET_INDEX_FIRST'], 'FIRST'],\n      [Msg['LISTS_GET_INDEX_LAST'], 'LAST'],\n      [Msg['LISTS_GET_INDEX_RANDOM'], 'RANDOM'],\n    ];\n    this.setHelpUrl(Msg['LISTS_SET_INDEX_HELPURL']);\n    this.setStyle('list_blocks');\n    this.appendValueInput('LIST').setCheck('Array').appendField(\n        Msg['LISTS_SET_INDEX_INPUT_IN_LIST']);\n    this.appendDummyInput()\n        .appendField(new FieldDropdown(MODE), 'MODE')\n        .appendField('', 'SPACE');\n    this.appendDummyInput('AT');\n    this.appendValueInput('TO').appendField(Msg['LISTS_SET_INDEX_INPUT_TO']);\n    this.setInputsInline(true);\n    this.setPreviousStatement(true);\n    this.setNextStatement(true);\n    this.setTooltip(Msg['LISTS_SET_INDEX_TOOLTIP']);\n    this.updateAt_(true);\n    // Assign 'this' to a variable for use in the tooltip closure below.\n    const thisBlock = this;\n    this.setTooltip(function() {\n      const mode = thisBlock.getFieldValue('MODE');\n      const where = thisBlock.getFieldValue('WHERE');\n      let tooltip = '';\n      switch (mode + ' ' + where) {\n        case 'SET FROM_START':\n        case 'SET FROM_END':\n          tooltip = Msg['LISTS_SET_INDEX_TOOLTIP_SET_FROM'];\n          break;\n        case 'SET FIRST':\n          tooltip = Msg['LISTS_SET_INDEX_TOOLTIP_SET_FIRST'];\n          break;\n        case 'SET LAST':\n          tooltip = Msg['LISTS_SET_INDEX_TOOLTIP_SET_LAST'];\n          break;\n        case 'SET RANDOM':\n          tooltip = Msg['LISTS_SET_INDEX_TOOLTIP_SET_RANDOM'];\n          break;\n        case 'INSERT FROM_START':\n        case 'INSERT FROM_END':\n          tooltip = Msg['LISTS_SET_INDEX_TOOLTIP_INSERT_FROM'];\n          break;\n        case 'INSERT FIRST':\n          tooltip = Msg['LISTS_SET_INDEX_TOOLTIP_INSERT_FIRST'];\n          break;\n        case 'INSERT LAST':\n          tooltip = Msg['LISTS_SET_INDEX_TOOLTIP_INSERT_LAST'];\n          break;\n        case 'INSERT RANDOM':\n          tooltip = Msg['LISTS_SET_INDEX_TOOLTIP_INSERT_RANDOM'];\n          break;\n      }\n      if (where === 'FROM_START' || where === 'FROM_END') {\n        tooltip += '  ' +\n            Msg['LISTS_INDEX_FROM_START_TOOLTIP'].replace(\n                '%1', thisBlock.workspace.options.oneBasedIndex ? '#1' : '#0');\n      }\n      return tooltip;\n    });\n  },\n  /**\n   * Create XML to represent whether there is an 'AT' input.\n   * @return {!Element} XML storage element.\n   * @this {Block}\n   */\n  mutationToDom: function() {\n    const container = xmlUtils.createElement('mutation');\n    const isAt = this.getInput('AT').type === ConnectionType.INPUT_VALUE;\n    container.setAttribute('at', isAt);\n    return container;\n  },\n  /**\n   * Parse XML to restore the 'AT' input.\n   * @param {!Element} xmlElement XML storage element.\n   * @this {Block}\n   */\n  domToMutation: function(xmlElement) {\n    // Note: Until January 2013 this block did not have mutations,\n    // so 'at' defaults to true.\n    const isAt = (xmlElement.getAttribute('at') !== 'false');\n    this.updateAt_(isAt);\n  },\n\n  /**\n   * Returns the state of this block as a JSON serializable object.\n   * This block does not need to serialize any specific state as it is already\n   * encoded in the dropdown values, but must have an implementation to avoid\n   * the backward compatible XML mutations being serialized.\n   * @return {null} The state of this block.\n   */\n  saveExtraState: function() {\n    return null;\n  },\n\n  /**\n   * Applies the given state to this block.\n   * No extra state is needed or expected as it is already encoded in the\n   * dropdown values.\n   */\n  loadExtraState: function() {},\n\n  /**\n   * Create or delete an input for the numeric index.\n   * @param {boolean} isAt True if the input should exist.\n   * @private\n   * @this {Block}\n   */\n  updateAt_: function(isAt) {\n    // Destroy old 'AT' and 'ORDINAL' input.\n    this.removeInput('AT');\n    this.removeInput('ORDINAL', true);\n    // Create either a value 'AT' input or a dummy input.\n    if (isAt) {\n      this.appendValueInput('AT').setCheck('Number');\n      if (Msg['ORDINAL_NUMBER_SUFFIX']) {\n        this.appendDummyInput('ORDINAL').appendField(\n            Msg['ORDINAL_NUMBER_SUFFIX']);\n      }\n    } else {\n      this.appendDummyInput('AT');\n    }\n    const menu = new FieldDropdown(\n        this.WHERE_OPTIONS,\n        /**\n         * @param {*} value The input value.\n         * @this {FieldDropdown}\n         * @return {null|undefined} Null if the field has been replaced;\n         *     otherwise undefined.\n         */\n        function(value) {\n          const newAt = (value === 'FROM_START') || (value === 'FROM_END');\n          // The 'isAt' variable is available due to this function being a\n          // closure.\n          if (newAt !== isAt) {\n            const block = this.getSourceBlock();\n            block.updateAt_(newAt);\n            // This menu has been destroyed and replaced.  Update the\n            // replacement.\n            block.setFieldValue(value, 'WHERE');\n            return null;\n          }\n          return undefined;\n        });\n    this.moveInputBefore('AT', 'TO');\n    if (this.getInput('ORDINAL')) {\n      this.moveInputBefore('ORDINAL', 'TO');\n    }\n\n    this.getInput('AT').appendField(menu, 'WHERE');\n  },\n};\n\nblocks['lists_getSublist'] = {\n  /**\n   * Block for getting sublist.\n   * @this {Block}\n   */\n  init: function() {\n    this['WHERE_OPTIONS_1'] = [\n      [Msg['LISTS_GET_SUBLIST_START_FROM_START'], 'FROM_START'],\n      [Msg['LISTS_GET_SUBLIST_START_FROM_END'], 'FROM_END'],\n      [Msg['LISTS_GET_SUBLIST_START_FIRST'], 'FIRST'],\n    ];\n    this['WHERE_OPTIONS_2'] = [\n      [Msg['LISTS_GET_SUBLIST_END_FROM_START'], 'FROM_START'],\n      [Msg['LISTS_GET_SUBLIST_END_FROM_END'], 'FROM_END'],\n      [Msg['LISTS_GET_SUBLIST_END_LAST'], 'LAST'],\n    ];\n    this.setHelpUrl(Msg['LISTS_GET_SUBLIST_HELPURL']);\n    this.setStyle('list_blocks');\n    this.appendValueInput('LIST').setCheck('Array').appendField(\n        Msg['LISTS_GET_SUBLIST_INPUT_IN_LIST']);\n    this.appendDummyInput('AT1');\n    this.appendDummyInput('AT2');\n    if (Msg['LISTS_GET_SUBLIST_TAIL']) {\n      this.appendDummyInput('TAIL').appendField(Msg['LISTS_GET_SUBLIST_TAIL']);\n    }\n    this.setInputsInline(true);\n    this.setOutput(true, 'Array');\n    this.updateAt_(1, true);\n    this.updateAt_(2, true);\n    this.setTooltip(Msg['LISTS_GET_SUBLIST_TOOLTIP']);\n  },\n  /**\n   * Create XML to represent whether there are 'AT' inputs.\n   * @return {!Element} XML storage element.\n   * @this {Block}\n   */\n  mutationToDom: function() {\n    const container = xmlUtils.createElement('mutation');\n    const isAt1 = this.getInput('AT1').type === ConnectionType.INPUT_VALUE;\n    container.setAttribute('at1', isAt1);\n    const isAt2 = this.getInput('AT2').type === ConnectionType.INPUT_VALUE;\n    container.setAttribute('at2', isAt2);\n    return container;\n  },\n  /**\n   * Parse XML to restore the 'AT' inputs.\n   * @param {!Element} xmlElement XML storage element.\n   * @this {Block}\n   */\n  domToMutation: function(xmlElement) {\n    const isAt1 = (xmlElement.getAttribute('at1') === 'true');\n    const isAt2 = (xmlElement.getAttribute('at2') === 'true');\n    this.updateAt_(1, isAt1);\n    this.updateAt_(2, isAt2);\n  },\n\n  /**\n   * Returns the state of this block as a JSON serializable object.\n   * This block does not need to serialize any specific state as it is already\n   * encoded in the dropdown values, but must have an implementation to avoid\n   * the backward compatible XML mutations being serialized.\n   * @return {null} The state of this block.\n   */\n  saveExtraState: function() {\n    return null;\n  },\n\n  /**\n   * Applies the given state to this block.\n   * No extra state is needed or expected as it is already encoded in the\n   * dropdown values.\n   */\n  loadExtraState: function() {},\n\n  /**\n   * Create or delete an input for a numeric index.\n   * This block has two such inputs, independent of each other.\n   * @param {number} n Specify first or second input (1 or 2).\n   * @param {boolean} isAt True if the input should exist.\n   * @private\n   * @this {Block}\n   */\n  updateAt_: function(n, isAt) {\n    // Create or delete an input for the numeric index.\n    // Destroy old 'AT' and 'ORDINAL' inputs.\n    this.removeInput('AT' + n);\n    this.removeInput('ORDINAL' + n, true);\n    // Create either a value 'AT' input or a dummy input.\n    if (isAt) {\n      this.appendValueInput('AT' + n).setCheck('Number');\n      if (Msg['ORDINAL_NUMBER_SUFFIX']) {\n        this.appendDummyInput('ORDINAL' + n)\n            .appendField(Msg['ORDINAL_NUMBER_SUFFIX']);\n      }\n    } else {\n      this.appendDummyInput('AT' + n);\n    }\n    const menu = new FieldDropdown(\n        this['WHERE_OPTIONS_' + n],\n        /**\n         * @param {*} value The input value.\n         * @this {FieldDropdown}\n         * @return {null|undefined} Null if the field has been replaced;\n         *     otherwise undefined.\n         */\n        function(value) {\n          const newAt = (value === 'FROM_START') || (value === 'FROM_END');\n          // The 'isAt' variable is available due to this function being a\n          // closure.\n          if (newAt !== isAt) {\n            const block = this.getSourceBlock();\n            block.updateAt_(n, newAt);\n            // This menu has been destroyed and replaced.\n            // Update the replacement.\n            block.setFieldValue(value, 'WHERE' + n);\n            return null;\n          }\n        });\n    this.getInput('AT' + n).appendField(menu, 'WHERE' + n);\n    if (n === 1) {\n      this.moveInputBefore('AT1', 'AT2');\n      if (this.getInput('ORDINAL1')) {\n        this.moveInputBefore('ORDINAL1', 'AT2');\n      }\n    }\n    if (Msg['LISTS_GET_SUBLIST_TAIL']) {\n      this.moveInputBefore('TAIL', null);\n    }\n  },\n};\n\nblocks['lists_sort'] = {\n  /**\n   * Block for sorting a list.\n   * @this {Block}\n   */\n  init: function() {\n    this.jsonInit({\n      'message0': '%{BKY_LISTS_SORT_TITLE}',\n      'args0': [\n        {\n          'type': 'field_dropdown',\n          'name': 'TYPE',\n          'options': [\n            ['%{BKY_LISTS_SORT_TYPE_NUMERIC}', 'NUMERIC'],\n            ['%{BKY_LISTS_SORT_TYPE_TEXT}', 'TEXT'],\n            ['%{BKY_LISTS_SORT_TYPE_IGNORECASE}', 'IGNORE_CASE'],\n          ],\n        },\n        {\n          'type': 'field_dropdown',\n          'name': 'DIRECTION',\n          'options': [\n            ['%{BKY_LISTS_SORT_ORDER_ASCENDING}', '1'],\n            ['%{BKY_LISTS_SORT_ORDER_DESCENDING}', '-1'],\n          ],\n        },\n        {\n          'type': 'input_value',\n          'name': 'LIST',\n          'check': 'Array',\n        },\n      ],\n      'output': 'Array',\n      'style': 'list_blocks',\n      'tooltip': '%{BKY_LISTS_SORT_TOOLTIP}',\n      'helpUrl': '%{BKY_LISTS_SORT_HELPURL}',\n    });\n  },\n};\n\nblocks['lists_split'] = {\n  /**\n   * Block for splitting text into a list, or joining a list into text.\n   * @this {Block}\n   */\n  init: function() {\n    // Assign 'this' to a variable for use in the closures below.\n    const thisBlock = this;\n    const dropdown = new FieldDropdown(\n        [\n          [Msg['LISTS_SPLIT_LIST_FROM_TEXT'], 'SPLIT'],\n          [Msg['LISTS_SPLIT_TEXT_FROM_LIST'], 'JOIN'],\n        ],\n        function(newMode) {\n          thisBlock.updateType_(newMode);\n        });\n    this.setHelpUrl(Msg['LISTS_SPLIT_HELPURL']);\n    this.setStyle('list_blocks');\n    this.appendValueInput('INPUT').setCheck('String').appendField(\n        dropdown, 'MODE');\n    this.appendValueInput('DELIM').setCheck('String').appendField(\n        Msg['LISTS_SPLIT_WITH_DELIMITER']);\n    this.setInputsInline(true);\n    this.setOutput(true, 'Array');\n    this.setTooltip(function() {\n      const mode = thisBlock.getFieldValue('MODE');\n      if (mode === 'SPLIT') {\n        return Msg['LISTS_SPLIT_TOOLTIP_SPLIT'];\n      } else if (mode === 'JOIN') {\n        return Msg['LISTS_SPLIT_TOOLTIP_JOIN'];\n      }\n      throw Error('Unknown mode: ' + mode);\n    });\n  },\n  /**\n   * Modify this block to have the correct input and output types.\n   * @param {string} newMode Either 'SPLIT' or 'JOIN'.\n   * @private\n   * @this {Block}\n   */\n  updateType_: function(newMode) {\n    const mode = this.getFieldValue('MODE');\n    if (mode !== newMode) {\n      const inputConnection = this.getInput('INPUT').connection;\n      inputConnection.setShadowDom(null);\n      const inputBlock = inputConnection.targetBlock();\n      if (inputBlock) {\n        inputConnection.disconnect();\n        if (inputBlock.isShadow()) {\n          inputBlock.dispose();\n        } else {\n          this.bumpNeighbours();\n        }\n      }\n    }\n    if (newMode === 'SPLIT') {\n      this.outputConnection.setCheck('Array');\n      this.getInput('INPUT').setCheck('String');\n    } else {\n      this.outputConnection.setCheck('String');\n      this.getInput('INPUT').setCheck('Array');\n    }\n  },\n  /**\n   * Create XML to represent the input and output types.\n   * @return {!Element} XML storage element.\n   * @this {Block}\n   */\n  mutationToDom: function() {\n    const container = xmlUtils.createElement('mutation');\n    container.setAttribute('mode', this.getFieldValue('MODE'));\n    return container;\n  },\n  /**\n   * Parse XML to restore the input and output types.\n   * @param {!Element} xmlElement XML storage element.\n   * @this {Block}\n   */\n  domToMutation: function(xmlElement) {\n    this.updateType_(xmlElement.getAttribute('mode'));\n  },\n\n  /**\n   * Returns the state of this block as a JSON serializable object.\n   * This block does not need to serialize any specific state as it is already\n   * encoded in the dropdown values, but must have an implementation to avoid\n   * the backward compatible XML mutations being serialized.\n   * @return {null} The state of this block.\n   */\n  saveExtraState: function() {\n    return null;\n  },\n\n  /**\n   * Applies the given state to this block.\n   * No extra state is needed or expected as it is already encoded in the\n   * dropdown values.\n   */\n  loadExtraState: function() {},\n};\n\n// Register provided blocks.\ndefineBlocks(blocks);\n","/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview Colour blocks for Blockly.\n */\n'use strict';\n\ngoog.module('Blockly.libraryBlocks.colour');\n\n// const {BlockDefinition} = goog.requireType('Blockly.blocks');\n// TODO (6248): Properly import the BlockDefinition type.\n/* eslint-disable-next-line no-unused-vars */\nconst BlockDefinition = Object;\nconst {createBlockDefinitionsFromJsonArray, defineBlocks} = goog.require('Blockly.common');\n/** @suppress {extraRequire} */\ngoog.require('Blockly.FieldColour');\n\n\n/**\n * A dictionary of the block definitions provided by this module.\n * @type {!Object<string, !BlockDefinition>}\n */\nconst blocks = createBlockDefinitionsFromJsonArray([\n  // Block for colour picker.\n  {\n    'type': 'colour_picker',\n    'message0': '%1',\n    'args0': [\n      {\n        'type': 'field_colour',\n        'name': 'COLOUR',\n        'colour': '#ff0000',\n      },\n    ],\n    'output': 'Colour',\n    'helpUrl': '%{BKY_COLOUR_PICKER_HELPURL}',\n    'style': 'colour_blocks',\n    'tooltip': '%{BKY_COLOUR_PICKER_TOOLTIP}',\n    'extensions': ['parent_tooltip_when_inline'],\n  },\n\n  // Block for random colour.\n  {\n    'type': 'colour_random',\n    'message0': '%{BKY_COLOUR_RANDOM_TITLE}',\n    'output': 'Colour',\n    'helpUrl': '%{BKY_COLOUR_RANDOM_HELPURL}',\n    'style': 'colour_blocks',\n    'tooltip': '%{BKY_COLOUR_RANDOM_TOOLTIP}',\n  },\n\n  // Block for composing a colour from RGB components.\n  {\n    'type': 'colour_rgb',\n    'message0':\n        '%{BKY_COLOUR_RGB_TITLE} %{BKY_COLOUR_RGB_RED} %1 %{BKY_COLOUR_RGB_GREEN} %2 %{BKY_COLOUR_RGB_BLUE} %3',\n    'args0': [\n      {\n        'type': 'input_value',\n        'name': 'RED',\n        'check': 'Number',\n        'align': 'RIGHT',\n      },\n      {\n        'type': 'input_value',\n        'name': 'GREEN',\n        'check': 'Number',\n        'align': 'RIGHT',\n      },\n      {\n        'type': 'input_value',\n        'name': 'BLUE',\n        'check': 'Number',\n        'align': 'RIGHT',\n      },\n    ],\n    'output': 'Colour',\n    'helpUrl': '%{BKY_COLOUR_RGB_HELPURL}',\n    'style': 'colour_blocks',\n    'tooltip': '%{BKY_COLOUR_RGB_TOOLTIP}',\n  },\n\n  // Block for blending two colours together.\n  {\n    'type': 'colour_blend',\n    'message0': '%{BKY_COLOUR_BLEND_TITLE} %{BKY_COLOUR_BLEND_COLOUR1} ' +\n        '%1 %{BKY_COLOUR_BLEND_COLOUR2} %2 %{BKY_COLOUR_BLEND_RATIO} %3',\n    'args0': [\n      {\n        'type': 'input_value',\n        'name': 'COLOUR1',\n        'check': 'Colour',\n        'align': 'RIGHT',\n      },\n      {\n        'type': 'input_value',\n        'name': 'COLOUR2',\n        'check': 'Colour',\n        'align': 'RIGHT',\n      },\n      {\n        'type': 'input_value',\n        'name': 'RATIO',\n        'check': 'Number',\n        'align': 'RIGHT',\n      },\n    ],\n    'output': 'Colour',\n    'helpUrl': '%{BKY_COLOUR_BLEND_HELPURL}',\n    'style': 'colour_blocks',\n    'tooltip': '%{BKY_COLOUR_BLEND_TOOLTIP}',\n  },\n]);\nexports.blocks = blocks;\n\n// Register provided blocks.\ndefineBlocks(blocks);\n","/* eslint-disable */\n;(function(root, factory) {\n  if (typeof define === 'function' && define.amd) { // AMD\n    define(['./blocks_compressed'], factory);\n  } else if (typeof exports === 'object') { // Node.js\n    module.exports = factory(require('./blocks_compressed'));\n  } else { // Browser\n    root.BlocklyBlocks = factory(root.BlocklyBlocks);\n  }\n}(this, function(BlocklyBlocks) {\n/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview Blockly blocks module; just a wrapper for blocks_compressed.js.\n */\n\nreturn BlocklyBlocks;\n}));\n","/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview Complete helper functions for generating JavaScript for\n *     blocks.  This is the entrypoint for javascript_compressed.js.\n * @suppress {extraRequire}\n */\n'use strict';\n\ngoog.module('Blockly.JavaScript.all');\n\nconst moduleExports = goog.require('Blockly.JavaScript');\ngoog.require('Blockly.JavaScript.colour');\ngoog.require('Blockly.JavaScript.lists');\ngoog.require('Blockly.JavaScript.logic');\ngoog.require('Blockly.JavaScript.loops');\ngoog.require('Blockly.JavaScript.math');\ngoog.require('Blockly.JavaScript.procedures');\ngoog.require('Blockly.JavaScript.texts');\ngoog.require('Blockly.JavaScript.variables');\ngoog.require('Blockly.JavaScript.variablesDynamic');\n\nexports = moduleExports;\n","/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview Helper functions for generating JavaScript for blocks.\n * @suppress {checkTypes|globalThis}\n */\n'use strict';\n\ngoog.module('Blockly.JavaScript');\n\nconst Variables = goog.require('Blockly.Variables');\nconst stringUtils = goog.require('Blockly.utils.string');\nconst {Block} = goog.requireType('Blockly.Block');\nconst {CodeGenerator} = goog.require('Blockly.CodeGenerator');\nconst {inputTypes} = goog.require('Blockly.inputTypes');\nconst {Names, NameType} = goog.require('Blockly.Names');\nconst {Workspace} = goog.requireType('Blockly.Workspace');\n\n\n/**\n * JavaScript code generator.\n * @type {!CodeGenerator}\n */\nconst JavaScript = new CodeGenerator('JavaScript');\n\n/**\n * List of illegal variable names.\n * This is not intended to be a security feature.  Blockly is 100% client-side,\n * so bypassing this list is trivial.  This is intended to prevent users from\n * accidentally clobbering a built-in object or function.\n */\nJavaScript.addReservedWords(\n    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Lexical_grammar#Keywords\n    'break,case,catch,class,const,continue,debugger,default,delete,do,else,export,extends,finally,for,function,if,import,in,instanceof,new,return,super,switch,this,throw,try,typeof,var,void,while,with,yield,' +\n    'enum,' +\n    'implements,interface,let,package,private,protected,public,static,' +\n    'await,' +\n    'null,true,false,' +\n    // Magic variable.\n    'arguments,' +\n    // Everything in the current environment (835 items in Chrome, 104 in Node).\n    Object.getOwnPropertyNames(globalThis).join(','));\n\n/**\n * Order of operation ENUMs.\n * https://developer.mozilla.org/en/JavaScript/Reference/Operators/Operator_Precedence\n */\nJavaScript.ORDER_ATOMIC = 0;            // 0 \"\" ...\nJavaScript.ORDER_NEW = 1.1;             // new\nJavaScript.ORDER_MEMBER = 1.2;          // . []\nJavaScript.ORDER_FUNCTION_CALL = 2;     // ()\nJavaScript.ORDER_INCREMENT = 3;         // ++\nJavaScript.ORDER_DECREMENT = 3;         // --\nJavaScript.ORDER_BITWISE_NOT = 4.1;     // ~\nJavaScript.ORDER_UNARY_PLUS = 4.2;      // +\nJavaScript.ORDER_UNARY_NEGATION = 4.3;  // -\nJavaScript.ORDER_LOGICAL_NOT = 4.4;     // !\nJavaScript.ORDER_TYPEOF = 4.5;          // typeof\nJavaScript.ORDER_VOID = 4.6;            // void\nJavaScript.ORDER_DELETE = 4.7;          // delete\nJavaScript.ORDER_AWAIT = 4.8;           // await\nJavaScript.ORDER_EXPONENTIATION = 5.0;  // **\nJavaScript.ORDER_MULTIPLICATION = 5.1;  // *\nJavaScript.ORDER_DIVISION = 5.2;        // /\nJavaScript.ORDER_MODULUS = 5.3;         // %\nJavaScript.ORDER_SUBTRACTION = 6.1;     // -\nJavaScript.ORDER_ADDITION = 6.2;        // +\nJavaScript.ORDER_BITWISE_SHIFT = 7;     // << >> >>>\nJavaScript.ORDER_RELATIONAL = 8;        // < <= > >=\nJavaScript.ORDER_IN = 8;                // in\nJavaScript.ORDER_INSTANCEOF = 8;        // instanceof\nJavaScript.ORDER_EQUALITY = 9;          // == != === !==\nJavaScript.ORDER_BITWISE_AND = 10;      // &\nJavaScript.ORDER_BITWISE_XOR = 11;      // ^\nJavaScript.ORDER_BITWISE_OR = 12;       // |\nJavaScript.ORDER_LOGICAL_AND = 13;      // &&\nJavaScript.ORDER_LOGICAL_OR = 14;       // ||\nJavaScript.ORDER_CONDITIONAL = 15;      // ?:\nJavaScript.ORDER_ASSIGNMENT = 16;       // = += -= **= *= /= %= <<= >>= ...\nJavaScript.ORDER_YIELD = 17;            // yield\nJavaScript.ORDER_COMMA = 18;            // ,\nJavaScript.ORDER_NONE = 99;             // (...)\n\n/**\n * List of outer-inner pairings that do NOT require parentheses.\n * @type {!Array<!Array<number>>}\n */\nJavaScript.ORDER_OVERRIDES = [\n  // (foo()).bar -> foo().bar\n  // (foo())[0] -> foo()[0]\n  [JavaScript.ORDER_FUNCTION_CALL, JavaScript.ORDER_MEMBER],\n  // (foo())() -> foo()()\n  [JavaScript.ORDER_FUNCTION_CALL, JavaScript.ORDER_FUNCTION_CALL],\n  // (foo.bar).baz -> foo.bar.baz\n  // (foo.bar)[0] -> foo.bar[0]\n  // (foo[0]).bar -> foo[0].bar\n  // (foo[0])[1] -> foo[0][1]\n  [JavaScript.ORDER_MEMBER, JavaScript.ORDER_MEMBER],\n  // (foo.bar)() -> foo.bar()\n  // (foo[0])() -> foo[0]()\n  [JavaScript.ORDER_MEMBER, JavaScript.ORDER_FUNCTION_CALL],\n\n  // !(!foo) -> !!foo\n  [JavaScript.ORDER_LOGICAL_NOT, JavaScript.ORDER_LOGICAL_NOT],\n  // a * (b * c) -> a * b * c\n  [JavaScript.ORDER_MULTIPLICATION, JavaScript.ORDER_MULTIPLICATION],\n  // a + (b + c) -> a + b + c\n  [JavaScript.ORDER_ADDITION, JavaScript.ORDER_ADDITION],\n  // a && (b && c) -> a && b && c\n  [JavaScript.ORDER_LOGICAL_AND, JavaScript.ORDER_LOGICAL_AND],\n  // a || (b || c) -> a || b || c\n  [JavaScript.ORDER_LOGICAL_OR, JavaScript.ORDER_LOGICAL_OR]\n];\n\n/**\n * Whether the init method has been called.\n * @type {?boolean}\n */\nJavaScript.isInitialized = false;\n\n/**\n * Initialise the database of variable names.\n * @param {!Workspace} workspace Workspace to generate code from.\n */\nJavaScript.init = function(workspace) {\n  // Call Blockly.CodeGenerator's init.\n  Object.getPrototypeOf(this).init.call(this);\n\n  if (!this.nameDB_) {\n    this.nameDB_ = new Names(this.RESERVED_WORDS_);\n  } else {\n    this.nameDB_.reset();\n  }\n\n  this.nameDB_.setVariableMap(workspace.getVariableMap());\n  this.nameDB_.populateVariables(workspace);\n  this.nameDB_.populateProcedures(workspace);\n\n  const defvars = [];\n  // Add developer variables (not created or named by the user).\n  const devVarList = Variables.allDeveloperVariables(workspace);\n  for (let i = 0; i < devVarList.length; i++) {\n    defvars.push(\n        this.nameDB_.getName(devVarList[i], NameType.DEVELOPER_VARIABLE));\n  }\n\n  // Add user variables, but only ones that are being used.\n  const variables = Variables.allUsedVarModels(workspace);\n  for (let i = 0; i < variables.length; i++) {\n    defvars.push(this.nameDB_.getName(variables[i].getId(), NameType.VARIABLE));\n  }\n\n  // Declare all of the variables.\n  if (defvars.length) {\n    this.definitions_['variables'] = 'var ' + defvars.join(', ') + ';';\n  }\n  this.isInitialized = true;\n};\n\n/**\n * Prepend the generated code with the variable definitions.\n * @param {string} code Generated code.\n * @return {string} Completed code.\n */\nJavaScript.finish = function(code) {\n  // Convert the definitions dictionary into a list.\n  const definitions = Object.values(this.definitions_);\n  // Call Blockly.CodeGenerator's finish.\n  code = Object.getPrototypeOf(this).finish.call(this, code);\n  this.isInitialized = false;\n\n  this.nameDB_.reset();\n  return definitions.join('\\n\\n') + '\\n\\n\\n' + code;\n};\n\n/**\n * Naked values are top-level blocks with outputs that aren't plugged into\n * anything.  A trailing semicolon is needed to make this legal.\n * @param {string} line Line of generated code.\n * @return {string} Legal line of code.\n */\nJavaScript.scrubNakedValue = function(line) {\n  return line + ';\\n';\n};\n\n/**\n * Encode a string as a properly escaped JavaScript string, complete with\n * quotes.\n * @param {string} string Text to encode.\n * @return {string} JavaScript string.\n * @protected\n */\nJavaScript.quote_ = function(string) {\n  // Can't use goog.string.quote since Google's style guide recommends\n  // JS string literals use single quotes.\n  string = string.replace(/\\\\/g, '\\\\\\\\')\n               .replace(/\\n/g, '\\\\\\n')\n               .replace(/'/g, '\\\\\\'');\n  return '\\'' + string + '\\'';\n};\n\n/**\n * Encode a string as a properly escaped multiline JavaScript string, complete\n * with quotes.\n * @param {string} string Text to encode.\n * @return {string} JavaScript string.\n * @protected\n */\nJavaScript.multiline_quote_ = function(string) {\n  // Can't use goog.string.quote since Google's style guide recommends\n  // JS string literals use single quotes.\n  const lines = string.split(/\\n/g).map(this.quote_);\n  return lines.join(' + \\'\\\\n\\' +\\n');\n};\n\n/**\n * Common tasks for generating JavaScript from blocks.\n * Handles comments for the specified block and any connected value blocks.\n * Calls any statements following this block.\n * @param {!Block} block The current block.\n * @param {string} code The JavaScript code created for this block.\n * @param {boolean=} opt_thisOnly True to generate code for only this statement.\n * @return {string} JavaScript code with comments and subsequent blocks added.\n * @protected\n */\nJavaScript.scrub_ = function(block, code, opt_thisOnly) {\n  let commentCode = '';\n  // Only collect comments for blocks that aren't inline.\n  if (!block.outputConnection || !block.outputConnection.targetConnection) {\n    // Collect comment for this block.\n    let comment = block.getCommentText();\n    if (comment) {\n      comment = stringUtils.wrap(comment, this.COMMENT_WRAP - 3);\n      commentCode += this.prefixLines(comment + '\\n', '// ');\n    }\n    // Collect comments for all value arguments.\n    // Don't collect comments for nested statements.\n    for (let i = 0; i < block.inputList.length; i++) {\n      if (block.inputList[i].type === inputTypes.VALUE) {\n        const childBlock = block.inputList[i].connection.targetBlock();\n        if (childBlock) {\n          comment = this.allNestedComments(childBlock);\n          if (comment) {\n            commentCode += this.prefixLines(comment, '// ');\n          }\n        }\n      }\n    }\n  }\n  const nextBlock = block.nextConnection && block.nextConnection.targetBlock();\n  const nextCode = opt_thisOnly ? '' : this.blockToCode(nextBlock);\n  return commentCode + code + nextCode;\n};\n\n/**\n * Gets a property and adjusts the value while taking into account indexing.\n * @param {!Block} block The block.\n * @param {string} atId The property ID of the element to get.\n * @param {number=} opt_delta Value to add.\n * @param {boolean=} opt_negate Whether to negate the value.\n * @param {number=} opt_order The highest order acting on this value.\n * @return {string|number}\n */\nJavaScript.getAdjusted = function(\n    block, atId, opt_delta, opt_negate, opt_order) {\n  let delta = opt_delta || 0;\n  let order = opt_order || this.ORDER_NONE;\n  if (block.workspace.options.oneBasedIndex) {\n    delta--;\n  }\n  const defaultAtIndex = block.workspace.options.oneBasedIndex ? '1' : '0';\n\n  let innerOrder;\n  let outerOrder = order;\n  if (delta > 0) {\n    outerOrder = this.ORDER_ADDITION;\n    innerOrder = this.ORDER_ADDITION;\n  } else if (delta < 0) {\n    outerOrder = this.ORDER_SUBTRACTION;\n    innerOrder = this.ORDER_SUBTRACTION;\n  } else if (opt_negate) {\n    outerOrder = this.ORDER_UNARY_NEGATION;\n    innerOrder = this.ORDER_UNARY_NEGATION;\n  }\n\n  let at = this.valueToCode(block, atId, outerOrder) || defaultAtIndex;\n\n  if (stringUtils.isNumber(at)) {\n    // If the index is a naked number, adjust it right now.\n    at = Number(at) + delta;\n    if (opt_negate) {\n      at = -at;\n    }\n  } else {\n    // If the index is dynamic, adjust it in code.\n    if (delta > 0) {\n      at = at + ' + ' + delta;\n    } else if (delta < 0) {\n      at = at + ' - ' + -delta;\n    }\n    if (opt_negate) {\n      if (delta) {\n        at = '-(' + at + ')';\n      } else {\n        at = '-' + at;\n      }\n    }\n    innerOrder = Math.floor(innerOrder);\n    order = Math.floor(order);\n    if (innerOrder && order >= innerOrder) {\n      at = '(' + at + ')';\n    }\n  }\n  return at;\n};\n\nexports.javascriptGenerator = JavaScript;\n","/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview Generating JavaScript for variable blocks.\n */\n'use strict';\n\ngoog.module('Blockly.JavaScript.variables');\n\nconst {NameType} = goog.require('Blockly.Names');\nconst {javascriptGenerator: JavaScript} = goog.require('Blockly.JavaScript');\n\n\nJavaScript['variables_get'] = function(block) {\n  // Variable getter.\n  const code = JavaScript.nameDB_.getName(block.getFieldValue('VAR'),\n      NameType.VARIABLE);\n  return [code, JavaScript.ORDER_ATOMIC];\n};\n\nJavaScript['variables_set'] = function(block) {\n  // Variable setter.\n  const argument0 = JavaScript.valueToCode(\n                        block, 'VALUE', JavaScript.ORDER_ASSIGNMENT) || '0';\n  const varName = JavaScript.nameDB_.getName(\n      block.getFieldValue('VAR'), NameType.VARIABLE);\n  return varName + ' = ' + argument0 + ';\\n';\n};\n","/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview Generating JavaScript for dynamic variable blocks.\n */\n'use strict';\n\ngoog.module('Blockly.JavaScript.variablesDynamic');\n\nconst {javascriptGenerator: JavaScript} = goog.require('Blockly.JavaScript');\n/** @suppress {extraRequire} */\ngoog.require('Blockly.JavaScript.variables');\n\n\n// JavaScript is dynamically typed.\nJavaScript['variables_get_dynamic'] = JavaScript['variables_get'];\nJavaScript['variables_set_dynamic'] = JavaScript['variables_set'];\n","/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview Generating JavaScript for text blocks.\n */\n'use strict';\n\ngoog.module('Blockly.JavaScript.texts');\n\nconst {NameType} = goog.require('Blockly.Names');\nconst {javascriptGenerator: JavaScript} = goog.require('Blockly.JavaScript');\n\n\n/**\n * Regular expression to detect a single-quoted string literal.\n */\nconst strRegExp = /^\\s*'([^']|\\\\')*'\\s*$/;\n\n/**\n * Enclose the provided value in 'String(...)' function.\n * Leave string literals alone.\n * @param {string} value Code evaluating to a value.\n * @return {Array<string|number>} Array containing code evaluating to a string\n *     and the order of the returned code.[string, number]\n */\nconst forceString = function(value) {\n  if (strRegExp.test(value)) {\n    return [value, JavaScript.ORDER_ATOMIC];\n  }\n  return ['String(' + value + ')', JavaScript.ORDER_FUNCTION_CALL];\n};\n\n/**\n * Returns an expression calculating the index into a string.\n * @param {string} stringName Name of the string, used to calculate length.\n * @param {string} where The method of indexing, selected by dropdown in Blockly\n * @param {string=} opt_at The optional offset when indexing from start/end.\n * @return {string|undefined} Index expression.\n */\nconst getSubstringIndex = function(stringName, where, opt_at) {\n  if (where === 'FIRST') {\n    return '0';\n  } else if (where === 'FROM_END') {\n    return stringName + '.length - 1 - ' + opt_at;\n  } else if (where === 'LAST') {\n    return stringName + '.length - 1';\n  } else {\n    return opt_at;\n  }\n};\n\nJavaScript['text'] = function(block) {\n  // Text value.\n  const code = JavaScript.quote_(block.getFieldValue('TEXT'));\n  return [code, JavaScript.ORDER_ATOMIC];\n};\n\nJavaScript['text_multiline'] = function(block) {\n  // Text value.\n  const code = JavaScript.multiline_quote_(block.getFieldValue('TEXT'));\n  const order = code.indexOf('+') !== -1 ? JavaScript.ORDER_ADDITION :\n      JavaScript.ORDER_ATOMIC;\n  return [code, order];\n};\n\nJavaScript['text_join'] = function(block) {\n  // Create a string made up of any number of elements of any type.\n  switch (block.itemCount_) {\n    case 0:\n      return [\"''\", JavaScript.ORDER_ATOMIC];\n    case 1: {\n      const element = JavaScript.valueToCode(block, 'ADD0',\n          JavaScript.ORDER_NONE) || \"''\";\n      const codeAndOrder = forceString(element);\n      return codeAndOrder;\n    }\n    case 2: {\n      const element0 = JavaScript.valueToCode(block, 'ADD0',\n          JavaScript.ORDER_NONE) || \"''\";\n      const element1 = JavaScript.valueToCode(block, 'ADD1',\n          JavaScript.ORDER_NONE) || \"''\";\n      const code = forceString(element0)[0] +\n          ' + ' + forceString(element1)[0];\n      return [code, JavaScript.ORDER_ADDITION];\n    }\n    default: {\n      const elements = new Array(block.itemCount_);\n      for (let i = 0; i < block.itemCount_; i++) {\n        elements[i] = JavaScript.valueToCode(block, 'ADD' + i,\n            JavaScript.ORDER_NONE) || \"''\";\n      }\n      const code = '[' + elements.join(',') + '].join(\\'\\')';\n      return [code, JavaScript.ORDER_FUNCTION_CALL];\n    }\n  }\n};\n\nJavaScript['text_append'] = function(block) {\n  // Append to a variable in place.\n  const varName = JavaScript.nameDB_.getName(\n      block.getFieldValue('VAR'), NameType.VARIABLE);\n  const value = JavaScript.valueToCode(block, 'TEXT',\n      JavaScript.ORDER_NONE) || \"''\";\n  const code = varName + ' += ' +\n      forceString(value)[0] + ';\\n';\n  return code;\n};\n\nJavaScript['text_length'] = function(block) {\n  // String or array length.\n  const text = JavaScript.valueToCode(block, 'VALUE',\n      JavaScript.ORDER_MEMBER) || \"''\";\n  return [text + '.length', JavaScript.ORDER_MEMBER];\n};\n\nJavaScript['text_isEmpty'] = function(block) {\n  // Is the string null or array empty?\n  const text = JavaScript.valueToCode(block, 'VALUE',\n      JavaScript.ORDER_MEMBER) || \"''\";\n  return ['!' + text + '.length', JavaScript.ORDER_LOGICAL_NOT];\n};\n\nJavaScript['text_indexOf'] = function(block) {\n  // Search the text for a substring.\n  const operator = block.getFieldValue('END') === 'FIRST' ?\n      'indexOf' : 'lastIndexOf';\n  const substring = JavaScript.valueToCode(block, 'FIND',\n      JavaScript.ORDER_NONE) || \"''\";\n  const text = JavaScript.valueToCode(block, 'VALUE',\n      JavaScript.ORDER_MEMBER) || \"''\";\n  const code = text + '.' + operator + '(' + substring + ')';\n  // Adjust index if using one-based indices.\n  if (block.workspace.options.oneBasedIndex) {\n    return [code + ' + 1', JavaScript.ORDER_ADDITION];\n  }\n  return [code, JavaScript.ORDER_FUNCTION_CALL];\n};\n\nJavaScript['text_charAt'] = function(block) {\n  // Get letter at index.\n  // Note: Until January 2013 this block did not have the WHERE input.\n  const where = block.getFieldValue('WHERE') || 'FROM_START';\n  const textOrder = (where === 'RANDOM') ? JavaScript.ORDER_NONE :\n      JavaScript.ORDER_MEMBER;\n  const text = JavaScript.valueToCode(block, 'VALUE', textOrder) || \"''\";\n  switch (where) {\n    case 'FIRST': {\n      const code = text + '.charAt(0)';\n      return [code, JavaScript.ORDER_FUNCTION_CALL];\n    }\n    case 'LAST': {\n      const code = text + '.slice(-1)';\n      return [code, JavaScript.ORDER_FUNCTION_CALL];\n    }\n    case 'FROM_START': {\n      const at = JavaScript.getAdjusted(block, 'AT');\n      // Adjust index if using one-based indices.\n      const code = text + '.charAt(' + at + ')';\n      return [code, JavaScript.ORDER_FUNCTION_CALL];\n    }\n    case 'FROM_END': {\n      const at = JavaScript.getAdjusted(block, 'AT', 1, true);\n      const code = text + '.slice(' + at + ').charAt(0)';\n      return [code, JavaScript.ORDER_FUNCTION_CALL];\n    }\n    case 'RANDOM': {\n      const functionName = JavaScript.provideFunction_('textRandomLetter', `\nfunction ${JavaScript.FUNCTION_NAME_PLACEHOLDER_}(text) {\n  var x = Math.floor(Math.random() * text.length);\n  return text[x];\n}\n`);\n      const code = functionName + '(' + text + ')';\n      return [code, JavaScript.ORDER_FUNCTION_CALL];\n    }\n  }\n  throw Error('Unhandled option (text_charAt).');\n};\n\nJavaScript['text_getSubstring'] = function(block) {\n  // Get substring.\n  const where1 = block.getFieldValue('WHERE1');\n  const where2 = block.getFieldValue('WHERE2');\n  const requiresLengthCall = (where1 !== 'FROM_END' && where1 !== 'LAST' &&\n      where2 !== 'FROM_END' && where2 !== 'LAST');\n  const textOrder = requiresLengthCall ? JavaScript.ORDER_MEMBER :\n      JavaScript.ORDER_NONE;\n  const text = JavaScript.valueToCode(block, 'STRING', textOrder) || \"''\";\n  let code;\n  if (where1 === 'FIRST' && where2 === 'LAST') {\n    code = text;\n    return [code, JavaScript.ORDER_NONE];\n  } else if (text.match(/^'?\\w+'?$/) || requiresLengthCall) {\n    // If the text is a variable or literal or doesn't require a call for\n    // length, don't generate a helper function.\n    let at1;\n    switch (where1) {\n      case 'FROM_START':\n        at1 = JavaScript.getAdjusted(block, 'AT1');\n        break;\n      case 'FROM_END':\n        at1 = JavaScript.getAdjusted(block, 'AT1', 1, false,\n            JavaScript.ORDER_SUBTRACTION);\n        at1 = text + '.length - ' + at1;\n        break;\n      case 'FIRST':\n        at1 = '0';\n        break;\n      default:\n        throw Error('Unhandled option (text_getSubstring).');\n    }\n    let at2;\n    switch (where2) {\n      case 'FROM_START':\n        at2 = JavaScript.getAdjusted(block, 'AT2', 1);\n        break;\n      case 'FROM_END':\n        at2 = JavaScript.getAdjusted(block, 'AT2', 0, false,\n            JavaScript.ORDER_SUBTRACTION);\n        at2 = text + '.length - ' + at2;\n        break;\n      case 'LAST':\n        at2 = text + '.length';\n        break;\n      default:\n        throw Error('Unhandled option (text_getSubstring).');\n    }\n    code = text + '.slice(' + at1 + ', ' + at2 + ')';\n  } else {\n    const at1 = JavaScript.getAdjusted(block, 'AT1');\n    const at2 = JavaScript.getAdjusted(block, 'AT2');\n    const wherePascalCase = {'FIRST': 'First', 'LAST': 'Last',\n      'FROM_START': 'FromStart', 'FROM_END': 'FromEnd'};\n    // The value for 'FROM_END' and'FROM_START' depends on `at` so\n    // we add it as a parameter.\n    const at1Param =\n        (where1 === 'FROM_END' || where1 === 'FROM_START') ? ', at1' : '';\n    const at2Param =\n        (where2 === 'FROM_END' || where2 === 'FROM_START') ? ', at2' : '';\n    const functionName = JavaScript.provideFunction_(\n        'subsequence' + wherePascalCase[where1] + wherePascalCase[where2], `\nfunction ${JavaScript.FUNCTION_NAME_PLACEHOLDER_}(sequence${at1Param}${at2Param}) {\n  var start = ${getSubstringIndex('sequence', where1, 'at1')};\n  var end = ${getSubstringIndex('sequence', where2, 'at2')} + 1;\n  return sequence.slice(start, end);\n}\n`);\n    code = functionName + '(' + text +\n        // The value for 'FROM_END' and 'FROM_START' depends on `at` so we\n        // pass it.\n        ((where1 === 'FROM_END' || where1 === 'FROM_START') ? ', ' + at1 : '') +\n        ((where2 === 'FROM_END' || where2 === 'FROM_START') ? ', ' + at2 : '') +\n        ')';\n  }\n  return [code, JavaScript.ORDER_FUNCTION_CALL];\n};\n\nJavaScript['text_changeCase'] = function(block) {\n  // Change capitalization.\n  const OPERATORS = {\n    'UPPERCASE': '.toUpperCase()',\n    'LOWERCASE': '.toLowerCase()',\n    'TITLECASE': null,\n  };\n  const operator = OPERATORS[block.getFieldValue('CASE')];\n  const textOrder = operator ? JavaScript.ORDER_MEMBER : JavaScript.ORDER_NONE;\n  const text = JavaScript.valueToCode(block, 'TEXT', textOrder) || \"''\";\n  let code;\n  if (operator) {\n    // Upper and lower case are functions built into JavaScript.\n    code = text + operator;\n  } else {\n    // Title case is not a native JavaScript function.  Define one.\n    const functionName = JavaScript.provideFunction_('textToTitleCase', `\nfunction ${JavaScript.FUNCTION_NAME_PLACEHOLDER_}(str) {\n  return str.replace(/\\\\S+/g,\n      function(txt) {return txt[0].toUpperCase() + txt.substring(1).toLowerCase();});\n}\n`);\n    code = functionName + '(' + text + ')';\n  }\n  return [code, JavaScript.ORDER_FUNCTION_CALL];\n};\n\nJavaScript['text_trim'] = function(block) {\n  // Trim spaces.\n  const OPERATORS = {\n    'LEFT': \".replace(/^[\\\\s\\\\xa0]+/, '')\",\n    'RIGHT': \".replace(/[\\\\s\\\\xa0]+$/, '')\",\n    'BOTH': '.trim()',\n  };\n  const operator = OPERATORS[block.getFieldValue('MODE')];\n  const text = JavaScript.valueToCode(block, 'TEXT',\n      JavaScript.ORDER_MEMBER) || \"''\";\n  return [text + operator, JavaScript.ORDER_FUNCTION_CALL];\n};\n\nJavaScript['text_print'] = function(block) {\n  // Print statement.\n  const msg = JavaScript.valueToCode(block, 'TEXT',\n      JavaScript.ORDER_NONE) || \"''\";\n  return 'window.alert(' + msg + ');\\n';\n};\n\nJavaScript['text_prompt_ext'] = function(block) {\n  // Prompt function.\n  let msg;\n  if (block.getField('TEXT')) {\n    // Internal message.\n    msg = JavaScript.quote_(block.getFieldValue('TEXT'));\n  } else {\n    // External message.\n    msg = JavaScript.valueToCode(block, 'TEXT', JavaScript.ORDER_NONE) || \"''\";\n  }\n  let code = 'window.prompt(' + msg + ')';\n  const toNumber = block.getFieldValue('TYPE') === 'NUMBER';\n  if (toNumber) {\n    code = 'Number(' + code + ')';\n  }\n  return [code, JavaScript.ORDER_FUNCTION_CALL];\n};\n\nJavaScript['text_prompt'] = JavaScript['text_prompt_ext'];\n\nJavaScript['text_count'] = function(block) {\n  const text = JavaScript.valueToCode(block, 'TEXT',\n      JavaScript.ORDER_NONE) || \"''\";\n  const sub = JavaScript.valueToCode(block, 'SUB',\n      JavaScript.ORDER_NONE) || \"''\";\n  const functionName = JavaScript.provideFunction_('textCount', `\nfunction ${JavaScript.FUNCTION_NAME_PLACEHOLDER_}(haystack, needle) {\n  if (needle.length === 0) {\n    return haystack.length + 1;\n  } else {\n    return haystack.split(needle).length - 1;\n  }\n}\n`);\n  const code = functionName + '(' + text + ', ' + sub + ')';\n  return [code, JavaScript.ORDER_FUNCTION_CALL];\n};\n\nJavaScript['text_replace'] = function(block) {\n  const text = JavaScript.valueToCode(block, 'TEXT',\n      JavaScript.ORDER_NONE) || \"''\";\n  const from = JavaScript.valueToCode(block, 'FROM',\n      JavaScript.ORDER_NONE) || \"''\";\n  const to = JavaScript.valueToCode(block, 'TO', JavaScript.ORDER_NONE) || \"''\";\n  // The regex escaping code below is taken from the implementation of\n  // goog.string.regExpEscape.\n  const functionName = JavaScript.provideFunction_('textReplace', `\nfunction ${JavaScript.FUNCTION_NAME_PLACEHOLDER_}(haystack, needle, replacement) {\n  needle = needle.replace(/([-()\\\\[\\\\]{}+?*.$\\\\^|,:#<!\\\\\\\\])/g, '\\\\\\\\$1')\n                 .replace(/\\\\x08/g, '\\\\\\\\x08');\n  return haystack.replace(new RegExp(needle, 'g'), replacement);\n}\n`);\n  const code = functionName + '(' + text + ', ' + from + ', ' + to + ')';\n  return [code, JavaScript.ORDER_FUNCTION_CALL];\n};\n\nJavaScript['text_reverse'] = function(block) {\n  const text = JavaScript.valueToCode(block, 'TEXT',\n      JavaScript.ORDER_MEMBER) || \"''\";\n  const code = text + \".split('').reverse().join('')\";\n  return [code, JavaScript.ORDER_FUNCTION_CALL];\n};\n","/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview Generating JavaScript for procedure blocks.\n */\n'use strict';\n\ngoog.module('Blockly.JavaScript.procedures');\n\nconst {NameType} = goog.require('Blockly.Names');\nconst {javascriptGenerator: JavaScript} = goog.require('Blockly.JavaScript');\n\n\nJavaScript['procedures_defreturn'] = function(block) {\n  // Define a procedure with a return value.\n  const funcName = JavaScript.nameDB_.getName(\n      block.getFieldValue('NAME'), NameType.PROCEDURE);\n  let xfix1 = '';\n  if (JavaScript.STATEMENT_PREFIX) {\n    xfix1 += JavaScript.injectId(JavaScript.STATEMENT_PREFIX, block);\n  }\n  if (JavaScript.STATEMENT_SUFFIX) {\n    xfix1 += JavaScript.injectId(JavaScript.STATEMENT_SUFFIX, block);\n  }\n  if (xfix1) {\n    xfix1 = JavaScript.prefixLines(xfix1, JavaScript.INDENT);\n  }\n  let loopTrap = '';\n  if (JavaScript.INFINITE_LOOP_TRAP) {\n    loopTrap = JavaScript.prefixLines(\n        JavaScript.injectId(JavaScript.INFINITE_LOOP_TRAP, block),\n        JavaScript.INDENT);\n  }\n  const branch = JavaScript.statementToCode(block, 'STACK');\n  let returnValue =\n      JavaScript.valueToCode(block, 'RETURN', JavaScript.ORDER_NONE) || '';\n  let xfix2 = '';\n  if (branch && returnValue) {\n    // After executing the function body, revisit this block for the return.\n    xfix2 = xfix1;\n  }\n  if (returnValue) {\n    returnValue = JavaScript.INDENT + 'return ' + returnValue + ';\\n';\n  }\n  const args = [];\n  const variables = block.getVars();\n  for (let i = 0; i < variables.length; i++) {\n    args[i] = JavaScript.nameDB_.getName(variables[i], NameType.VARIABLE);\n  }\n  let code = 'function ' + funcName + '(' + args.join(', ') + ') {\\n' + xfix1 +\n      loopTrap + branch + xfix2 + returnValue + '}';\n  code = JavaScript.scrub_(block, code);\n  // Add % so as not to collide with helper functions in definitions list.\n  JavaScript.definitions_['%' + funcName] = code;\n  return null;\n};\n\n// Defining a procedure without a return value uses the same generator as\n// a procedure with a return value.\nJavaScript['procedures_defnoreturn'] = JavaScript['procedures_defreturn'];\n\nJavaScript['procedures_callreturn'] = function(block) {\n  // Call a procedure with a return value.\n  const funcName = JavaScript.nameDB_.getName(\n      block.getFieldValue('NAME'), NameType.PROCEDURE);\n  const args = [];\n  const variables = block.getVars();\n  for (let i = 0; i < variables.length; i++) {\n    args[i] = JavaScript.valueToCode(block, 'ARG' + i, JavaScript.ORDER_NONE) ||\n        'null';\n  }\n  const code = funcName + '(' + args.join(', ') + ')';\n  return [code, JavaScript.ORDER_FUNCTION_CALL];\n};\n\nJavaScript['procedures_callnoreturn'] = function(block) {\n  // Call a procedure with no return value.\n  // Generated code is for a function call as a statement is the same as a\n  // function call as a value, with the addition of line ending.\n  const tuple = JavaScript['procedures_callreturn'](block);\n  return tuple[0] + ';\\n';\n};\n\nJavaScript['procedures_ifreturn'] = function(block) {\n  // Conditionally return value from a procedure.\n  const condition =\n      JavaScript.valueToCode(block, 'CONDITION', JavaScript.ORDER_NONE) ||\n      'false';\n  let code = 'if (' + condition + ') {\\n';\n  if (JavaScript.STATEMENT_SUFFIX) {\n    // Inject any statement suffix here since the regular one at the end\n    // will not get executed if the return is triggered.\n    code += JavaScript.prefixLines(\n        JavaScript.injectId(JavaScript.STATEMENT_SUFFIX, block),\n        JavaScript.INDENT);\n  }\n  if (block.hasReturnValue_) {\n    const value =\n        JavaScript.valueToCode(block, 'VALUE', JavaScript.ORDER_NONE) || 'null';\n    code += JavaScript.INDENT + 'return ' + value + ';\\n';\n  } else {\n    code += JavaScript.INDENT + 'return;\\n';\n  }\n  code += '}\\n';\n  return code;\n};\n","/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview Generating JavaScript for math blocks.\n * @suppress {missingRequire}\n */\n'use strict';\n\ngoog.module('Blockly.JavaScript.math');\n\nconst {NameType} = goog.require('Blockly.Names');\nconst {javascriptGenerator: JavaScript} = goog.require('Blockly.JavaScript');\n\n\nJavaScript['math_number'] = function(block) {\n  // Numeric value.\n  const code = Number(block.getFieldValue('NUM'));\n  const order = code >= 0 ? JavaScript.ORDER_ATOMIC :\n              JavaScript.ORDER_UNARY_NEGATION;\n  return [code, order];\n};\n\nJavaScript['math_arithmetic'] = function(block) {\n  // Basic arithmetic operators, and power.\n  const OPERATORS = {\n    'ADD': [' + ', JavaScript.ORDER_ADDITION],\n    'MINUS': [' - ', JavaScript.ORDER_SUBTRACTION],\n    'MULTIPLY': [' * ', JavaScript.ORDER_MULTIPLICATION],\n    'DIVIDE': [' / ', JavaScript.ORDER_DIVISION],\n    'POWER': [null, JavaScript.ORDER_NONE],  // Handle power separately.\n  };\n  const tuple = OPERATORS[block.getFieldValue('OP')];\n  const operator = tuple[0];\n  const order = tuple[1];\n  const argument0 = JavaScript.valueToCode(block, 'A', order) || '0';\n  const argument1 = JavaScript.valueToCode(block, 'B', order) || '0';\n  let code;\n  // Power in JavaScript requires a special case since it has no operator.\n  if (!operator) {\n    code = 'Math.pow(' + argument0 + ', ' + argument1 + ')';\n    return [code, JavaScript.ORDER_FUNCTION_CALL];\n  }\n  code = argument0 + operator + argument1;\n  return [code, order];\n};\n\nJavaScript['math_single'] = function(block) {\n  // Math operators with single operand.\n  const operator = block.getFieldValue('OP');\n  let code;\n  let arg;\n  if (operator === 'NEG') {\n    // Negation is a special case given its different operator precedence.\n    arg = JavaScript.valueToCode(block, 'NUM',\n        JavaScript.ORDER_UNARY_NEGATION) || '0';\n    if (arg[0] === '-') {\n      // --3 is not legal in JS.\n      arg = ' ' + arg;\n    }\n    code = '-' + arg;\n    return [code, JavaScript.ORDER_UNARY_NEGATION];\n  }\n  if (operator === 'SIN' || operator === 'COS' || operator === 'TAN') {\n    arg = JavaScript.valueToCode(block, 'NUM',\n        JavaScript.ORDER_DIVISION) || '0';\n  } else {\n    arg = JavaScript.valueToCode(block, 'NUM',\n        JavaScript.ORDER_NONE) || '0';\n  }\n  // First, handle cases which generate values that don't need parentheses\n  // wrapping the code.\n  switch (operator) {\n    case 'ABS':\n      code = 'Math.abs(' + arg + ')';\n      break;\n    case 'ROOT':\n      code = 'Math.sqrt(' + arg + ')';\n      break;\n    case 'LN':\n      code = 'Math.log(' + arg + ')';\n      break;\n    case 'EXP':\n      code = 'Math.exp(' + arg + ')';\n      break;\n    case 'POW10':\n      code = 'Math.pow(10,' + arg + ')';\n      break;\n    case 'ROUND':\n      code = 'Math.round(' + arg + ')';\n      break;\n    case 'ROUNDUP':\n      code = 'Math.ceil(' + arg + ')';\n      break;\n    case 'ROUNDDOWN':\n      code = 'Math.floor(' + arg + ')';\n      break;\n    case 'SIN':\n      code = 'Math.sin(' + arg + ' / 180 * Math.PI)';\n      break;\n    case 'COS':\n      code = 'Math.cos(' + arg + ' / 180 * Math.PI)';\n      break;\n    case 'TAN':\n      code = 'Math.tan(' + arg + ' / 180 * Math.PI)';\n      break;\n  }\n  if (code) {\n    return [code, JavaScript.ORDER_FUNCTION_CALL];\n  }\n  // Second, handle cases which generate values that may need parentheses\n  // wrapping the code.\n  switch (operator) {\n    case 'LOG10':\n      code = 'Math.log(' + arg + ') / Math.log(10)';\n      break;\n    case 'ASIN':\n      code = 'Math.asin(' + arg + ') / Math.PI * 180';\n      break;\n    case 'ACOS':\n      code = 'Math.acos(' + arg + ') / Math.PI * 180';\n      break;\n    case 'ATAN':\n      code = 'Math.atan(' + arg + ') / Math.PI * 180';\n      break;\n    default:\n      throw Error('Unknown math operator: ' + operator);\n  }\n  return [code, JavaScript.ORDER_DIVISION];\n};\n\nJavaScript['math_constant'] = function(block) {\n  // Constants: PI, E, the Golden Ratio, sqrt(2), 1/sqrt(2), INFINITY.\n  const CONSTANTS = {\n    'PI': ['Math.PI', JavaScript.ORDER_MEMBER],\n    'E': ['Math.E', JavaScript.ORDER_MEMBER],\n    'GOLDEN_RATIO': ['(1 + Math.sqrt(5)) / 2', JavaScript.ORDER_DIVISION],\n    'SQRT2': ['Math.SQRT2', JavaScript.ORDER_MEMBER],\n    'SQRT1_2': ['Math.SQRT1_2', JavaScript.ORDER_MEMBER],\n    'INFINITY': ['Infinity', JavaScript.ORDER_ATOMIC],\n  };\n  return CONSTANTS[block.getFieldValue('CONSTANT')];\n};\n\nJavaScript['math_number_property'] = function(block) {\n  // Check if a number is even, odd, prime, whole, positive, or negative\n  // or if it is divisible by certain number. Returns true or false.\n  const PROPERTIES = {\n    'EVEN': [' % 2 === 0', JavaScript.ORDER_MODULUS, JavaScript.ORDER_EQUALITY],\n    'ODD': [' % 2 === 1', JavaScript.ORDER_MODULUS, JavaScript.ORDER_EQUALITY],\n    'WHOLE': [' % 1 === 0', JavaScript.ORDER_MODULUS,\n        JavaScript.ORDER_EQUALITY],\n    'POSITIVE': [' > 0', JavaScript.ORDER_RELATIONAL,\n        JavaScript.ORDER_RELATIONAL],\n    'NEGATIVE': [' < 0', JavaScript.ORDER_RELATIONAL,\n        JavaScript.ORDER_RELATIONAL],\n    'DIVISIBLE_BY': [null, JavaScript.ORDER_MODULUS, JavaScript.ORDER_EQUALITY],\n    'PRIME': [null, JavaScript.ORDER_NONE, JavaScript.ORDER_FUNCTION_CALL],\n  };\n  const dropdownProperty = block.getFieldValue('PROPERTY');\n  const [suffix, inputOrder, outputOrder] = PROPERTIES[dropdownProperty];\n  const numberToCheck = JavaScript.valueToCode(block, 'NUMBER_TO_CHECK',\n      inputOrder) || '0';\n  let code;\n  if (dropdownProperty === 'PRIME') {\n    // Prime is a special case as it is not a one-liner test.\n    const functionName = JavaScript.provideFunction_('mathIsPrime', `\nfunction ${JavaScript.FUNCTION_NAME_PLACEHOLDER_}(n) {\n  // https://en.wikipedia.org/wiki/Primality_test#Naive_methods\n  if (n == 2 || n == 3) {\n    return true;\n  }\n  // False if n is NaN, negative, is 1, or not whole.\n  // And false if n is divisible by 2 or 3.\n  if (isNaN(n) || n <= 1 || n % 1 !== 0 || n % 2 === 0 || n % 3 === 0) {\n    return false;\n  }\n  // Check all the numbers of form 6k +/- 1, up to sqrt(n).\n  for (var x = 6; x <= Math.sqrt(n) + 1; x += 6) {\n    if (n % (x - 1) === 0 || n % (x + 1) === 0) {\n      return false;\n    }\n  }\n  return true;\n}\n`);\n    code = functionName + '(' + numberToCheck + ')';\n  } else if (dropdownProperty === 'DIVISIBLE_BY') {\n    const divisor = JavaScript.valueToCode(block, 'DIVISOR',\n        JavaScript.ORDER_MODULUS) || '0';\n    code = numberToCheck + ' % ' + divisor + ' === 0';\n  } else {\n    code = numberToCheck + suffix;\n  }\n  return [code, outputOrder];\n};\n\nJavaScript['math_change'] = function(block) {\n  // Add to a variable in place.\n  const argument0 = JavaScript.valueToCode(block, 'DELTA',\n      JavaScript.ORDER_ADDITION) || '0';\n  const varName = JavaScript.nameDB_.getName(\n      block.getFieldValue('VAR'), NameType.VARIABLE);\n  return varName + ' = (typeof ' + varName + ' === \\'number\\' ? ' + varName +\n      ' : 0) + ' + argument0 + ';\\n';\n};\n\n// Rounding functions have a single operand.\nJavaScript['math_round'] = JavaScript['math_single'];\n// Trigonometry functions have a single operand.\nJavaScript['math_trig'] = JavaScript['math_single'];\n\nJavaScript['math_on_list'] = function(block) {\n  // Math functions for lists.\n  const func = block.getFieldValue('OP');\n  let list;\n  let code;\n  switch (func) {\n    case 'SUM':\n      list = JavaScript.valueToCode(block, 'LIST',\n          JavaScript.ORDER_MEMBER) || '[]';\n      code = list + '.reduce(function(x, y) {return x + y;}, 0)';\n      break;\n    case 'MIN':\n      list = JavaScript.valueToCode(block, 'LIST',\n          JavaScript.ORDER_NONE) || '[]';\n      code = 'Math.min.apply(null, ' + list + ')';\n      break;\n    case 'MAX':\n      list = JavaScript.valueToCode(block, 'LIST',\n          JavaScript.ORDER_NONE) || '[]';\n      code = 'Math.max.apply(null, ' + list + ')';\n      break;\n    case 'AVERAGE': {\n      // mathMean([null,null,1,3]) === 2.0.\n      const functionName = JavaScript.provideFunction_('mathMean', `\nfunction ${JavaScript.FUNCTION_NAME_PLACEHOLDER_}(myList) {\n  return myList.reduce(function(x, y) {return x + y;}, 0) / myList.length;\n}\n`);\n      list = JavaScript.valueToCode(block, 'LIST',\n          JavaScript.ORDER_NONE) || '[]';\n      code = functionName + '(' + list + ')';\n      break;\n    }\n    case 'MEDIAN': {\n      // mathMedian([null,null,1,3]) === 2.0.\n      const functionName = JavaScript.provideFunction_('mathMedian', `\nfunction ${JavaScript.FUNCTION_NAME_PLACEHOLDER_}(myList) {\n  var localList = myList.filter(function (x) {return typeof x === 'number';});\n  if (!localList.length) return null;\n  localList.sort(function(a, b) {return b - a;});\n  if (localList.length % 2 === 0) {\n    return (localList[localList.length / 2 - 1] + localList[localList.length / 2]) / 2;\n  } else {\n    return localList[(localList.length - 1) / 2];\n  }\n}\n`);\n      list = JavaScript.valueToCode(block, 'LIST',\n          JavaScript.ORDER_NONE) || '[]';\n      code = functionName + '(' + list + ')';\n      break;\n    }\n    case 'MODE': {\n      // As a list of numbers can contain more than one mode,\n      // the returned result is provided as an array.\n      // Mode of [3, 'x', 'x', 1, 1, 2, '3'] -> ['x', 1].\n      const functionName = JavaScript.provideFunction_('mathModes', `\nfunction ${JavaScript.FUNCTION_NAME_PLACEHOLDER_}(values) {\n  var modes = [];\n  var counts = [];\n  var maxCount = 0;\n  for (var i = 0; i < values.length; i++) {\n    var value = values[i];\n    var found = false;\n    var thisCount;\n    for (var j = 0; j < counts.length; j++) {\n      if (counts[j][0] === value) {\n        thisCount = ++counts[j][1];\n        found = true;\n        break;\n      }\n    }\n    if (!found) {\n      counts.push([value, 1]);\n      thisCount = 1;\n    }\n    maxCount = Math.max(thisCount, maxCount);\n  }\n  for (var j = 0; j < counts.length; j++) {\n    if (counts[j][1] === maxCount) {\n        modes.push(counts[j][0]);\n    }\n  }\n  return modes;\n}\n`);\n      list = JavaScript.valueToCode(block, 'LIST',\n          JavaScript.ORDER_NONE) || '[]';\n      code = functionName + '(' + list + ')';\n      break;\n    }\n    case 'STD_DEV': {\n      const functionName = JavaScript.provideFunction_('mathStandardDeviation', `\nfunction ${JavaScript.FUNCTION_NAME_PLACEHOLDER_}(numbers) {\n  var n = numbers.length;\n  if (!n) return null;\n  var mean = numbers.reduce(function(x, y) {return x + y;}) / n;\n  var variance = 0;\n  for (var j = 0; j < n; j++) {\n    variance += Math.pow(numbers[j] - mean, 2);\n  }\n  variance = variance / n;\n  return Math.sqrt(variance);\n}\n`);\n      list = JavaScript.valueToCode(block, 'LIST',\n          JavaScript.ORDER_NONE) || '[]';\n      code = functionName + '(' + list + ')';\n      break;\n    }\n    case 'RANDOM': {\n      const functionName = JavaScript.provideFunction_('mathRandomList', `\nfunction ${JavaScript.FUNCTION_NAME_PLACEHOLDER_}(list) {\n  var x = Math.floor(Math.random() * list.length);\n  return list[x];\n}\n`);\n      list = JavaScript.valueToCode(block, 'LIST',\n          JavaScript.ORDER_NONE) || '[]';\n      code = functionName + '(' + list + ')';\n      break;\n    }\n    default:\n      throw Error('Unknown operator: ' + func);\n  }\n  return [code, JavaScript.ORDER_FUNCTION_CALL];\n};\n\nJavaScript['math_modulo'] = function(block) {\n  // Remainder computation.\n  const argument0 = JavaScript.valueToCode(block, 'DIVIDEND',\n      JavaScript.ORDER_MODULUS) || '0';\n  const argument1 = JavaScript.valueToCode(block, 'DIVISOR',\n      JavaScript.ORDER_MODULUS) || '0';\n  const code = argument0 + ' % ' + argument1;\n  return [code, JavaScript.ORDER_MODULUS];\n};\n\nJavaScript['math_constrain'] = function(block) {\n  // Constrain a number between two limits.\n  const argument0 = JavaScript.valueToCode(block, 'VALUE',\n      JavaScript.ORDER_NONE) || '0';\n  const argument1 = JavaScript.valueToCode(block, 'LOW',\n      JavaScript.ORDER_NONE) || '0';\n  const argument2 = JavaScript.valueToCode(block, 'HIGH',\n      JavaScript.ORDER_NONE) || 'Infinity';\n  const code = 'Math.min(Math.max(' + argument0 + ', ' + argument1 + '), ' +\n      argument2 + ')';\n  return [code, JavaScript.ORDER_FUNCTION_CALL];\n};\n\nJavaScript['math_random_int'] = function(block) {\n  // Random integer between [X] and [Y].\n  const argument0 = JavaScript.valueToCode(block, 'FROM',\n      JavaScript.ORDER_NONE) || '0';\n  const argument1 = JavaScript.valueToCode(block, 'TO',\n      JavaScript.ORDER_NONE) || '0';\n  const functionName = JavaScript.provideFunction_('mathRandomInt', `\nfunction ${JavaScript.FUNCTION_NAME_PLACEHOLDER_}(a, b) {\n  if (a > b) {\n    // Swap a and b to ensure a is smaller.\n    var c = a;\n    a = b;\n    b = c;\n  }\n  return Math.floor(Math.random() * (b - a + 1) + a);\n}\n`);\n  const code = functionName + '(' + argument0 + ', ' + argument1 + ')';\n  return [code, JavaScript.ORDER_FUNCTION_CALL];\n};\n\nJavaScript['math_random_float'] = function(block) {\n  // Random fraction between 0 and 1.\n  return ['Math.random()', JavaScript.ORDER_FUNCTION_CALL];\n};\n\nJavaScript['math_atan2'] = function(block) {\n  // Arctangent of point (X, Y) in degrees from -180 to 180.\n  const argument0 = JavaScript.valueToCode(block, 'X',\n      JavaScript.ORDER_NONE) || '0';\n  const argument1 = JavaScript.valueToCode(block, 'Y',\n      JavaScript.ORDER_NONE) || '0';\n  return ['Math.atan2(' + argument1 + ', ' + argument0 + ') / Math.PI * 180',\n      JavaScript.ORDER_DIVISION];\n};\n","/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview Generating JavaScript for loop blocks.\n */\n'use strict';\n\ngoog.module('Blockly.JavaScript.loops');\n\nconst stringUtils = goog.require('Blockly.utils.string');\nconst {NameType} = goog.require('Blockly.Names');\nconst {javascriptGenerator: JavaScript} = goog.require('Blockly.JavaScript');\n\n\nJavaScript['controls_repeat_ext'] = function(block) {\n  // Repeat n times.\n  let repeats;\n  if (block.getField('TIMES')) {\n    // Internal number.\n    repeats = String(Number(block.getFieldValue('TIMES')));\n  } else {\n    // External number.\n    repeats =\n        JavaScript.valueToCode(block, 'TIMES', JavaScript.ORDER_ASSIGNMENT) ||\n        '0';\n  }\n  let branch = JavaScript.statementToCode(block, 'DO');\n  branch = JavaScript.addLoopTrap(branch, block);\n  let code = '';\n  const loopVar =\n      JavaScript.nameDB_.getDistinctName('count', NameType.VARIABLE);\n  let endVar = repeats;\n  if (!repeats.match(/^\\w+$/) && !stringUtils.isNumber(repeats)) {\n    endVar =\n        JavaScript.nameDB_.getDistinctName('repeat_end', NameType.VARIABLE);\n    code += 'var ' + endVar + ' = ' + repeats + ';\\n';\n  }\n  code += 'for (var ' + loopVar + ' = 0; ' + loopVar + ' < ' + endVar + '; ' +\n      loopVar + '++) {\\n' + branch + '}\\n';\n  return code;\n};\n\nJavaScript['controls_repeat'] = JavaScript['controls_repeat_ext'];\n\nJavaScript['controls_whileUntil'] = function(block) {\n  // Do while/until loop.\n  const until = block.getFieldValue('MODE') === 'UNTIL';\n  let argument0 =\n      JavaScript.valueToCode(\n          block, 'BOOL',\n          until ? JavaScript.ORDER_LOGICAL_NOT : JavaScript.ORDER_NONE) ||\n      'false';\n  let branch = JavaScript.statementToCode(block, 'DO');\n  branch = JavaScript.addLoopTrap(branch, block);\n  if (until) {\n    argument0 = '!' + argument0;\n  }\n  return 'while (' + argument0 + ') {\\n' + branch + '}\\n';\n};\n\nJavaScript['controls_for'] = function(block) {\n  // For loop.\n  const variable0 =\n      JavaScript.nameDB_.getName(block.getFieldValue('VAR'), NameType.VARIABLE);\n  const argument0 =\n      JavaScript.valueToCode(block, 'FROM', JavaScript.ORDER_ASSIGNMENT) || '0';\n  const argument1 =\n      JavaScript.valueToCode(block, 'TO', JavaScript.ORDER_ASSIGNMENT) || '0';\n  const increment =\n      JavaScript.valueToCode(block, 'BY', JavaScript.ORDER_ASSIGNMENT) || '1';\n  let branch = JavaScript.statementToCode(block, 'DO');\n  branch = JavaScript.addLoopTrap(branch, block);\n  let code;\n  if (stringUtils.isNumber(argument0) && stringUtils.isNumber(argument1) &&\n      stringUtils.isNumber(increment)) {\n    // All arguments are simple numbers.\n    const up = Number(argument0) <= Number(argument1);\n    code = 'for (' + variable0 + ' = ' + argument0 + '; ' + variable0 +\n        (up ? ' <= ' : ' >= ') + argument1 + '; ' + variable0;\n    const step = Math.abs(Number(increment));\n    if (step === 1) {\n      code += up ? '++' : '--';\n    } else {\n      code += (up ? ' += ' : ' -= ') + step;\n    }\n    code += ') {\\n' + branch + '}\\n';\n  } else {\n    code = '';\n    // Cache non-trivial values to variables to prevent repeated look-ups.\n    let startVar = argument0;\n    if (!argument0.match(/^\\w+$/) && !stringUtils.isNumber(argument0)) {\n      startVar = JavaScript.nameDB_.getDistinctName(\n          variable0 + '_start', NameType.VARIABLE);\n      code += 'var ' + startVar + ' = ' + argument0 + ';\\n';\n    }\n    let endVar = argument1;\n    if (!argument1.match(/^\\w+$/) && !stringUtils.isNumber(argument1)) {\n      endVar = JavaScript.nameDB_.getDistinctName(\n          variable0 + '_end', NameType.VARIABLE);\n      code += 'var ' + endVar + ' = ' + argument1 + ';\\n';\n    }\n    // Determine loop direction at start, in case one of the bounds\n    // changes during loop execution.\n    const incVar = JavaScript.nameDB_.getDistinctName(\n        variable0 + '_inc', NameType.VARIABLE);\n    code += 'var ' + incVar + ' = ';\n    if (stringUtils.isNumber(increment)) {\n      code += Math.abs(increment) + ';\\n';\n    } else {\n      code += 'Math.abs(' + increment + ');\\n';\n    }\n    code += 'if (' + startVar + ' > ' + endVar + ') {\\n';\n    code += JavaScript.INDENT + incVar + ' = -' + incVar + ';\\n';\n    code += '}\\n';\n    code += 'for (' + variable0 + ' = ' + startVar + '; ' + incVar +\n        ' >= 0 ? ' + variable0 + ' <= ' + endVar + ' : ' + variable0 +\n        ' >= ' + endVar + '; ' + variable0 + ' += ' + incVar + ') {\\n' +\n        branch + '}\\n';\n  }\n  return code;\n};\n\nJavaScript['controls_forEach'] = function(block) {\n  // For each loop.\n  const variable0 =\n      JavaScript.nameDB_.getName(block.getFieldValue('VAR'), NameType.VARIABLE);\n  const argument0 =\n      JavaScript.valueToCode(block, 'LIST', JavaScript.ORDER_ASSIGNMENT) ||\n      '[]';\n  let branch = JavaScript.statementToCode(block, 'DO');\n  branch = JavaScript.addLoopTrap(branch, block);\n  let code = '';\n  // Cache non-trivial values to variables to prevent repeated look-ups.\n  let listVar = argument0;\n  if (!argument0.match(/^\\w+$/)) {\n    listVar = JavaScript.nameDB_.getDistinctName(\n        variable0 + '_list', NameType.VARIABLE);\n    code += 'var ' + listVar + ' = ' + argument0 + ';\\n';\n  }\n  const indexVar = JavaScript.nameDB_.getDistinctName(\n      variable0 + '_index', NameType.VARIABLE);\n  branch = JavaScript.INDENT + variable0 + ' = ' + listVar + '[' + indexVar +\n      '];\\n' + branch;\n  code += 'for (var ' + indexVar + ' in ' + listVar + ') {\\n' + branch + '}\\n';\n  return code;\n};\n\nJavaScript['controls_flow_statements'] = function(block) {\n  // Flow statements: continue, break.\n  let xfix = '';\n  if (JavaScript.STATEMENT_PREFIX) {\n    // Automatic prefix insertion is switched off for this block.  Add manually.\n    xfix += JavaScript.injectId(JavaScript.STATEMENT_PREFIX, block);\n  }\n  if (JavaScript.STATEMENT_SUFFIX) {\n    // Inject any statement suffix here since the regular one at the end\n    // will not get executed if the break/continue is triggered.\n    xfix += JavaScript.injectId(JavaScript.STATEMENT_SUFFIX, block);\n  }\n  if (JavaScript.STATEMENT_PREFIX) {\n    const loop = block.getSurroundLoop();\n    if (loop && !loop.suppressPrefixSuffix) {\n      // Inject loop's statement prefix here since the regular one at the end\n      // of the loop will not get executed if 'continue' is triggered.\n      // In the case of 'break', a prefix is needed due to the loop's suffix.\n      xfix += JavaScript.injectId(JavaScript.STATEMENT_PREFIX, loop);\n    }\n  }\n  switch (block.getFieldValue('FLOW')) {\n    case 'BREAK':\n      return xfix + 'break;\\n';\n    case 'CONTINUE':\n      return xfix + 'continue;\\n';\n  }\n  throw Error('Unknown flow statement.');\n};\n","/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview Generating JavaScript for logic blocks.\n */\n'use strict';\n\ngoog.module('Blockly.JavaScript.logic');\n\nconst {javascriptGenerator: JavaScript} = goog.require('Blockly.JavaScript');\n\n\nJavaScript['controls_if'] = function(block) {\n  // If/elseif/else condition.\n  let n = 0;\n  let code = '';\n  if (JavaScript.STATEMENT_PREFIX) {\n    // Automatic prefix insertion is switched off for this block.  Add manually.\n    code += JavaScript.injectId(JavaScript.STATEMENT_PREFIX, block);\n  }\n  do {\n    const conditionCode =\n        JavaScript.valueToCode(block, 'IF' + n, JavaScript.ORDER_NONE) ||\n        'false';\n    let branchCode = JavaScript.statementToCode(block, 'DO' + n);\n    if (JavaScript.STATEMENT_SUFFIX) {\n      branchCode = JavaScript.prefixLines(\n                       JavaScript.injectId(JavaScript.STATEMENT_SUFFIX, block),\n                       JavaScript.INDENT) +\n          branchCode;\n    }\n    code += (n > 0 ? ' else ' : '') + 'if (' + conditionCode + ') {\\n' +\n        branchCode + '}';\n    n++;\n  } while (block.getInput('IF' + n));\n\n  if (block.getInput('ELSE') || JavaScript.STATEMENT_SUFFIX) {\n    let branchCode = JavaScript.statementToCode(block, 'ELSE');\n    if (JavaScript.STATEMENT_SUFFIX) {\n      branchCode = JavaScript.prefixLines(\n                       JavaScript.injectId(JavaScript.STATEMENT_SUFFIX, block),\n                       JavaScript.INDENT) +\n          branchCode;\n    }\n    code += ' else {\\n' + branchCode + '}';\n  }\n  return code + '\\n';\n};\n\nJavaScript['controls_ifelse'] = JavaScript['controls_if'];\n\nJavaScript['logic_compare'] = function(block) {\n  // Comparison operator.\n  const OPERATORS =\n      {'EQ': '==', 'NEQ': '!=', 'LT': '<', 'LTE': '<=', 'GT': '>', 'GTE': '>='};\n  const operator = OPERATORS[block.getFieldValue('OP')];\n  const order = (operator === '==' || operator === '!=') ?\n      JavaScript.ORDER_EQUALITY :\n      JavaScript.ORDER_RELATIONAL;\n  const argument0 = JavaScript.valueToCode(block, 'A', order) || '0';\n  const argument1 = JavaScript.valueToCode(block, 'B', order) || '0';\n  const code = argument0 + ' ' + operator + ' ' + argument1;\n  return [code, order];\n};\n\nJavaScript['logic_operation'] = function(block) {\n  // Operations 'and', 'or'.\n  const operator = (block.getFieldValue('OP') === 'AND') ? '&&' : '||';\n  const order = (operator === '&&') ? JavaScript.ORDER_LOGICAL_AND :\n                                      JavaScript.ORDER_LOGICAL_OR;\n  let argument0 = JavaScript.valueToCode(block, 'A', order);\n  let argument1 = JavaScript.valueToCode(block, 'B', order);\n  if (!argument0 && !argument1) {\n    // If there are no arguments, then the return value is false.\n    argument0 = 'false';\n    argument1 = 'false';\n  } else {\n    // Single missing arguments have no effect on the return value.\n    const defaultArgument = (operator === '&&') ? 'true' : 'false';\n    if (!argument0) {\n      argument0 = defaultArgument;\n    }\n    if (!argument1) {\n      argument1 = defaultArgument;\n    }\n  }\n  const code = argument0 + ' ' + operator + ' ' + argument1;\n  return [code, order];\n};\n\nJavaScript['logic_negate'] = function(block) {\n  // Negation.\n  const order = JavaScript.ORDER_LOGICAL_NOT;\n  const argument0 = JavaScript.valueToCode(block, 'BOOL', order) || 'true';\n  const code = '!' + argument0;\n  return [code, order];\n};\n\nJavaScript['logic_boolean'] = function(block) {\n  // Boolean values true and false.\n  const code = (block.getFieldValue('BOOL') === 'TRUE') ? 'true' : 'false';\n  return [code, JavaScript.ORDER_ATOMIC];\n};\n\nJavaScript['logic_null'] = function(block) {\n  // Null data type.\n  return ['null', JavaScript.ORDER_ATOMIC];\n};\n\nJavaScript['logic_ternary'] = function(block) {\n  // Ternary operator.\n  const value_if =\n      JavaScript.valueToCode(block, 'IF', JavaScript.ORDER_CONDITIONAL) ||\n      'false';\n  const value_then =\n      JavaScript.valueToCode(block, 'THEN', JavaScript.ORDER_CONDITIONAL) ||\n      'null';\n  const value_else =\n      JavaScript.valueToCode(block, 'ELSE', JavaScript.ORDER_CONDITIONAL) ||\n      'null';\n  const code = value_if + ' ? ' + value_then + ' : ' + value_else;\n  return [code, JavaScript.ORDER_CONDITIONAL];\n};\n","/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview Generating JavaScript for list blocks.\n * @suppress {missingRequire}\n */\n'use strict';\n\ngoog.module('Blockly.JavaScript.lists');\n\nconst {NameType} = goog.require('Blockly.Names');\nconst {javascriptGenerator: JavaScript} = goog.require('Blockly.JavaScript');\n\n\nJavaScript['lists_create_empty'] = function(block) {\n  // Create an empty list.\n  return ['[]', JavaScript.ORDER_ATOMIC];\n};\n\nJavaScript['lists_create_with'] = function(block) {\n  // Create a list with any number of elements of any type.\n  const elements = new Array(block.itemCount_);\n  for (let i = 0; i < block.itemCount_; i++) {\n    elements[i] =\n        JavaScript.valueToCode(block, 'ADD' + i, JavaScript.ORDER_NONE) ||\n        'null';\n  }\n  const code = '[' + elements.join(', ') + ']';\n  return [code, JavaScript.ORDER_ATOMIC];\n};\n\nJavaScript['lists_repeat'] = function(block) {\n  // Create a list with one element repeated.\n  const functionName = JavaScript.provideFunction_('listsRepeat', `\nfunction ${JavaScript.FUNCTION_NAME_PLACEHOLDER_}(value, n) {\n  var array = [];\n  for (var i = 0; i < n; i++) {\n    array[i] = value;\n  }\n  return array;\n}\n`);\n  const element =\n      JavaScript.valueToCode(block, 'ITEM', JavaScript.ORDER_NONE) || 'null';\n  const repeatCount =\n      JavaScript.valueToCode(block, 'NUM', JavaScript.ORDER_NONE) || '0';\n  const code = functionName + '(' + element + ', ' + repeatCount + ')';\n  return [code, JavaScript.ORDER_FUNCTION_CALL];\n};\n\nJavaScript['lists_length'] = function(block) {\n  // String or array length.\n  const list =\n      JavaScript.valueToCode(block, 'VALUE', JavaScript.ORDER_MEMBER) || '[]';\n  return [list + '.length', JavaScript.ORDER_MEMBER];\n};\n\nJavaScript['lists_isEmpty'] = function(block) {\n  // Is the string null or array empty?\n  const list =\n      JavaScript.valueToCode(block, 'VALUE', JavaScript.ORDER_MEMBER) || '[]';\n  return ['!' + list + '.length', JavaScript.ORDER_LOGICAL_NOT];\n};\n\nJavaScript['lists_indexOf'] = function(block) {\n  // Find an item in the list.\n  const operator =\n      block.getFieldValue('END') === 'FIRST' ? 'indexOf' : 'lastIndexOf';\n  const item =\n      JavaScript.valueToCode(block, 'FIND', JavaScript.ORDER_NONE) || \"''\";\n  const list =\n      JavaScript.valueToCode(block, 'VALUE', JavaScript.ORDER_MEMBER) || '[]';\n  const code = list + '.' + operator + '(' + item + ')';\n  if (block.workspace.options.oneBasedIndex) {\n    return [code + ' + 1', JavaScript.ORDER_ADDITION];\n  }\n  return [code, JavaScript.ORDER_FUNCTION_CALL];\n};\n\nJavaScript['lists_getIndex'] = function(block) {\n  // Get element at index.\n  // Note: Until January 2013 this block did not have MODE or WHERE inputs.\n  const mode = block.getFieldValue('MODE') || 'GET';\n  const where = block.getFieldValue('WHERE') || 'FROM_START';\n  const listOrder =\n      (where === 'RANDOM') ? JavaScript.ORDER_NONE : JavaScript.ORDER_MEMBER;\n  const list = JavaScript.valueToCode(block, 'VALUE', listOrder) || '[]';\n\n  switch (where) {\n    case ('FIRST'):\n      if (mode === 'GET') {\n        const code = list + '[0]';\n        return [code, JavaScript.ORDER_MEMBER];\n      } else if (mode === 'GET_REMOVE') {\n        const code = list + '.shift()';\n        return [code, JavaScript.ORDER_MEMBER];\n      } else if (mode === 'REMOVE') {\n        return list + '.shift();\\n';\n      }\n      break;\n    case ('LAST'):\n      if (mode === 'GET') {\n        const code = list + '.slice(-1)[0]';\n        return [code, JavaScript.ORDER_MEMBER];\n      } else if (mode === 'GET_REMOVE') {\n        const code = list + '.pop()';\n        return [code, JavaScript.ORDER_MEMBER];\n      } else if (mode === 'REMOVE') {\n        return list + '.pop();\\n';\n      }\n      break;\n    case ('FROM_START'): {\n      const at = JavaScript.getAdjusted(block, 'AT');\n      if (mode === 'GET') {\n        const code = list + '[' + at + ']';\n        return [code, JavaScript.ORDER_MEMBER];\n      } else if (mode === 'GET_REMOVE') {\n        const code = list + '.splice(' + at + ', 1)[0]';\n        return [code, JavaScript.ORDER_FUNCTION_CALL];\n      } else if (mode === 'REMOVE') {\n        return list + '.splice(' + at + ', 1);\\n';\n      }\n      break;\n    }\n    case ('FROM_END'): {\n      const at = JavaScript.getAdjusted(block, 'AT', 1, true);\n      if (mode === 'GET') {\n        const code = list + '.slice(' + at + ')[0]';\n        return [code, JavaScript.ORDER_FUNCTION_CALL];\n      } else if (mode === 'GET_REMOVE') {\n        const code = list + '.splice(' + at + ', 1)[0]';\n        return [code, JavaScript.ORDER_FUNCTION_CALL];\n      } else if (mode === 'REMOVE') {\n        return list + '.splice(' + at + ', 1);';\n      }\n      break;\n    }\n    case ('RANDOM'): {\n      const functionName = JavaScript.provideFunction_('listsGetRandomItem', `\nfunction ${JavaScript.FUNCTION_NAME_PLACEHOLDER_}(list, remove) {\n  var x = Math.floor(Math.random() * list.length);\n  if (remove) {\n    return list.splice(x, 1)[0];\n  } else {\n    return list[x];\n  }\n}\n`);\n      const code = functionName + '(' + list + ', ' + (mode !== 'GET') + ')';\n      if (mode === 'GET' || mode === 'GET_REMOVE') {\n        return [code, JavaScript.ORDER_FUNCTION_CALL];\n      } else if (mode === 'REMOVE') {\n        return code + ';\\n';\n      }\n      break;\n    }\n  }\n  throw Error('Unhandled combination (lists_getIndex).');\n};\n\nJavaScript['lists_setIndex'] = function(block) {\n  // Set element at index.\n  // Note: Until February 2013 this block did not have MODE or WHERE inputs.\n  let list =\n      JavaScript.valueToCode(block, 'LIST', JavaScript.ORDER_MEMBER) || '[]';\n  const mode = block.getFieldValue('MODE') || 'GET';\n  const where = block.getFieldValue('WHERE') || 'FROM_START';\n  const value =\n      JavaScript.valueToCode(block, 'TO', JavaScript.ORDER_ASSIGNMENT) ||\n      'null';\n  // Cache non-trivial values to variables to prevent repeated look-ups.\n  // Closure, which accesses and modifies 'list'.\n  function cacheList() {\n    if (list.match(/^\\w+$/)) {\n      return '';\n    }\n    const listVar =\n        JavaScript.nameDB_.getDistinctName('tmpList', NameType.VARIABLE);\n    const code = 'var ' + listVar + ' = ' + list + ';\\n';\n    list = listVar;\n    return code;\n  }\n  switch (where) {\n    case ('FIRST'):\n      if (mode === 'SET') {\n        return list + '[0] = ' + value + ';\\n';\n      } else if (mode === 'INSERT') {\n        return list + '.unshift(' + value + ');\\n';\n      }\n      break;\n    case ('LAST'):\n      if (mode === 'SET') {\n        let code = cacheList();\n        code += list + '[' + list + '.length - 1] = ' + value + ';\\n';\n        return code;\n      } else if (mode === 'INSERT') {\n        return list + '.push(' + value + ');\\n';\n      }\n      break;\n    case ('FROM_START'): {\n      const at = JavaScript.getAdjusted(block, 'AT');\n      if (mode === 'SET') {\n        return list + '[' + at + '] = ' + value + ';\\n';\n      } else if (mode === 'INSERT') {\n        return list + '.splice(' + at + ', 0, ' + value + ');\\n';\n      }\n      break;\n    }\n    case ('FROM_END'): {\n      const at = JavaScript.getAdjusted(\n          block, 'AT', 1, false, JavaScript.ORDER_SUBTRACTION);\n      let code = cacheList();\n      if (mode === 'SET') {\n        code += list + '[' + list + '.length - ' + at + '] = ' + value + ';\\n';\n        return code;\n      } else if (mode === 'INSERT') {\n        code += list + '.splice(' + list + '.length - ' + at + ', 0, ' + value +\n            ');\\n';\n        return code;\n      }\n      break;\n    }\n    case ('RANDOM'): {\n      let code = cacheList();\n      const xVar =\n          JavaScript.nameDB_.getDistinctName('tmpX', NameType.VARIABLE);\n      code += 'var ' + xVar + ' = Math.floor(Math.random() * ' + list +\n          '.length);\\n';\n      if (mode === 'SET') {\n        code += list + '[' + xVar + '] = ' + value + ';\\n';\n        return code;\n      } else if (mode === 'INSERT') {\n        code += list + '.splice(' + xVar + ', 0, ' + value + ');\\n';\n        return code;\n      }\n      break;\n    }\n  }\n  throw Error('Unhandled combination (lists_setIndex).');\n};\n\n/**\n * Returns an expression calculating the index into a list.\n * @param {string} listName Name of the list, used to calculate length.\n * @param {string} where The method of indexing, selected by dropdown in Blockly\n * @param {string=} opt_at The optional offset when indexing from start/end.\n * @return {string|undefined} Index expression.\n */\nconst getSubstringIndex = function(listName, where, opt_at) {\n  if (where === 'FIRST') {\n    return '0';\n  } else if (where === 'FROM_END') {\n    return listName + '.length - 1 - ' + opt_at;\n  } else if (where === 'LAST') {\n    return listName + '.length - 1';\n  } else {\n    return opt_at;\n  }\n};\n\nJavaScript['lists_getSublist'] = function(block) {\n  // Get sublist.\n  const list =\n      JavaScript.valueToCode(block, 'LIST', JavaScript.ORDER_MEMBER) || '[]';\n  const where1 = block.getFieldValue('WHERE1');\n  const where2 = block.getFieldValue('WHERE2');\n  let code;\n  if (where1 === 'FIRST' && where2 === 'LAST') {\n    code = list + '.slice(0)';\n  } else if (\n      list.match(/^\\w+$/) ||\n      (where1 !== 'FROM_END' && where2 === 'FROM_START')) {\n    // If the list is a variable or doesn't require a call for length, don't\n    // generate a helper function.\n    let at1;\n    switch (where1) {\n      case 'FROM_START':\n        at1 = JavaScript.getAdjusted(block, 'AT1');\n        break;\n      case 'FROM_END':\n        at1 = JavaScript.getAdjusted(\n            block, 'AT1', 1, false, JavaScript.ORDER_SUBTRACTION);\n        at1 = list + '.length - ' + at1;\n        break;\n      case 'FIRST':\n        at1 = '0';\n        break;\n      default:\n        throw Error('Unhandled option (lists_getSublist).');\n    }\n    let at2;\n    switch (where2) {\n      case 'FROM_START':\n        at2 = JavaScript.getAdjusted(block, 'AT2', 1);\n        break;\n      case 'FROM_END':\n        at2 = JavaScript.getAdjusted(\n            block, 'AT2', 0, false, JavaScript.ORDER_SUBTRACTION);\n        at2 = list + '.length - ' + at2;\n        break;\n      case 'LAST':\n        at2 = list + '.length';\n        break;\n      default:\n        throw Error('Unhandled option (lists_getSublist).');\n    }\n    code = list + '.slice(' + at1 + ', ' + at2 + ')';\n  } else {\n    const at1 = JavaScript.getAdjusted(block, 'AT1');\n    const at2 = JavaScript.getAdjusted(block, 'AT2');\n    const wherePascalCase = {\n      'FIRST': 'First',\n      'LAST': 'Last',\n      'FROM_START': 'FromStart',\n      'FROM_END': 'FromEnd',\n    };\n    // The value for 'FROM_END' and'FROM_START' depends on `at` so\n    // we add it as a parameter.\n    const at1Param =\n        (where1 === 'FROM_END' || where1 === 'FROM_START') ? ', at1' : '';\n    const at2Param =\n        (where2 === 'FROM_END' || where2 === 'FROM_START') ? ', at2' : '';\n    const functionName = JavaScript.provideFunction_(\n        'subsequence' + wherePascalCase[where1] + wherePascalCase[where2], `\nfunction ${JavaScript.FUNCTION_NAME_PLACEHOLDER_}(sequence${at1Param}${at2Param}) {\n  var start = ${getSubstringIndex('sequence', where1, 'at1')};\n  var end = ${getSubstringIndex('sequence', where2, 'at2')} + 1;\n  return sequence.slice(start, end);\n}\n`);\n    code = functionName + '(' + list +\n        // The value for 'FROM_END' and 'FROM_START' depends on `at` so we\n        // pass it.\n        ((where1 === 'FROM_END' || where1 === 'FROM_START') ? ', ' + at1 : '') +\n        ((where2 === 'FROM_END' || where2 === 'FROM_START') ? ', ' + at2 : '') +\n        ')';\n  }\n  return [code, JavaScript.ORDER_FUNCTION_CALL];\n};\n\nJavaScript['lists_sort'] = function(block) {\n  // Block for sorting a list.\n  const list =\n      JavaScript.valueToCode(block, 'LIST', JavaScript.ORDER_FUNCTION_CALL) ||\n      '[]';\n  const direction = block.getFieldValue('DIRECTION') === '1' ? 1 : -1;\n  const type = block.getFieldValue('TYPE');\n  const getCompareFunctionName =\n      JavaScript.provideFunction_('listsGetSortCompare', `\nfunction ${JavaScript.FUNCTION_NAME_PLACEHOLDER_}(type, direction) {\n  var compareFuncs = {\n    'NUMERIC': function(a, b) {\n        return Number(a) - Number(b); },\n    'TEXT': function(a, b) {\n        return a.toString() > b.toString() ? 1 : -1; },\n    'IGNORE_CASE': function(a, b) {\n        return a.toString().toLowerCase() > b.toString().toLowerCase() ? 1 : -1; },\n  };\n  var compare = compareFuncs[type];\n  return function(a, b) { return compare(a, b) * direction; };\n}\n      `);\n  return [\n    list + '.slice().sort(' + getCompareFunctionName + '(\"' + type + '\", ' +\n        direction + '))',\n    JavaScript.ORDER_FUNCTION_CALL\n  ];\n};\n\nJavaScript['lists_split'] = function(block) {\n  // Block for splitting text into a list, or joining a list into text.\n  let input = JavaScript.valueToCode(block, 'INPUT', JavaScript.ORDER_MEMBER);\n  const delimiter =\n      JavaScript.valueToCode(block, 'DELIM', JavaScript.ORDER_NONE) || \"''\";\n  const mode = block.getFieldValue('MODE');\n  let functionName;\n  if (mode === 'SPLIT') {\n    if (!input) {\n      input = \"''\";\n    }\n    functionName = 'split';\n  } else if (mode === 'JOIN') {\n    if (!input) {\n      input = '[]';\n    }\n    functionName = 'join';\n  } else {\n    throw Error('Unknown mode: ' + mode);\n  }\n  const code = input + '.' + functionName + '(' + delimiter + ')';\n  return [code, JavaScript.ORDER_FUNCTION_CALL];\n};\n\nJavaScript['lists_reverse'] = function(block) {\n  // Block for reversing a list.\n  const list =\n      JavaScript.valueToCode(block, 'LIST', JavaScript.ORDER_FUNCTION_CALL) ||\n      '[]';\n  const code = list + '.slice().reverse()';\n  return [code, JavaScript.ORDER_FUNCTION_CALL];\n};\n","/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview Generating JavaScript for colour blocks.\n */\n'use strict';\n\ngoog.module('Blockly.JavaScript.colour');\n\nconst {javascriptGenerator: JavaScript} = goog.require('Blockly.JavaScript');\n\n\nJavaScript['colour_picker'] = function(block) {\n  // Colour picker.\n  const code = JavaScript.quote_(block.getFieldValue('COLOUR'));\n  return [code, JavaScript.ORDER_ATOMIC];\n};\n\nJavaScript['colour_random'] = function(block) {\n  // Generate a random colour.\n  const functionName = JavaScript.provideFunction_('colourRandom', `\nfunction ${JavaScript.FUNCTION_NAME_PLACEHOLDER_}() {\n  var num = Math.floor(Math.random() * Math.pow(2, 24));\n  return '#' + ('00000' + num.toString(16)).substr(-6);\n}\n`);\n  const code = functionName + '()';\n  return [code, JavaScript.ORDER_FUNCTION_CALL];\n};\n\nJavaScript['colour_rgb'] = function(block) {\n  // Compose a colour from RGB components expressed as percentages.\n  const red = JavaScript.valueToCode(block, 'RED', JavaScript.ORDER_NONE) || 0;\n  const green =\n      JavaScript.valueToCode(block, 'GREEN', JavaScript.ORDER_NONE) || 0;\n  const blue =\n      JavaScript.valueToCode(block, 'BLUE', JavaScript.ORDER_NONE) || 0;\n  const functionName = JavaScript.provideFunction_('colourRgb', `\nfunction ${JavaScript.FUNCTION_NAME_PLACEHOLDER_}(r, g, b) {\n  r = Math.max(Math.min(Number(r), 100), 0) * 2.55;\n  g = Math.max(Math.min(Number(g), 100), 0) * 2.55;\n  b = Math.max(Math.min(Number(b), 100), 0) * 2.55;\n  r = ('0' + (Math.round(r) || 0).toString(16)).slice(-2);\n  g = ('0' + (Math.round(g) || 0).toString(16)).slice(-2);\n  b = ('0' + (Math.round(b) || 0).toString(16)).slice(-2);\n  return '#' + r + g + b;\n}\n`);\n  const code = functionName + '(' + red + ', ' + green + ', ' + blue + ')';\n  return [code, JavaScript.ORDER_FUNCTION_CALL];\n};\n\nJavaScript['colour_blend'] = function(block) {\n  // Blend two colours together.\n  const c1 = JavaScript.valueToCode(block, 'COLOUR1', JavaScript.ORDER_NONE) ||\n      \"'#000000'\";\n  const c2 = JavaScript.valueToCode(block, 'COLOUR2', JavaScript.ORDER_NONE) ||\n      \"'#000000'\";\n  const ratio =\n      JavaScript.valueToCode(block, 'RATIO', JavaScript.ORDER_NONE) || 0.5;\n  const functionName = JavaScript.provideFunction_('colourBlend', `\nfunction ${JavaScript.FUNCTION_NAME_PLACEHOLDER_}(c1, c2, ratio) {\n  ratio = Math.max(Math.min(Number(ratio), 1), 0);\n  var r1 = parseInt(c1.substring(1, 3), 16);\n  var g1 = parseInt(c1.substring(3, 5), 16);\n  var b1 = parseInt(c1.substring(5, 7), 16);\n  var r2 = parseInt(c2.substring(1, 3), 16);\n  var g2 = parseInt(c2.substring(3, 5), 16);\n  var b2 = parseInt(c2.substring(5, 7), 16);\n  var r = Math.round(r1 * (1 - ratio) + r2 * ratio);\n  var g = Math.round(g1 * (1 - ratio) + g2 * ratio);\n  var b = Math.round(b1 * (1 - ratio) + b2 * ratio);\n  r = ('0' + (r || 0).toString(16)).slice(-2);\n  g = ('0' + (g || 0).toString(16)).slice(-2);\n  b = ('0' + (b || 0).toString(16)).slice(-2);\n  return '#' + r + g + b;\n}\n`);\n  const code = functionName + '(' + c1 + ', ' + c2 + ', ' + ratio + ')';\n  return [code, JavaScript.ORDER_FUNCTION_CALL];\n};\n","/* eslint-disable */\n;(function(root, factory) {\n  if (typeof define === 'function' && define.amd) { // AMD\n    define(['./core', './javascript_compressed.js'], factory);\n  } else if (typeof exports === 'object') { // Node.js\n    module.exports = factory(require('./core'), require('./javascript_compressed.js'));\n  } else { // Browser\n    root.BlocklyJavaScript = factory(root.Blockly, root.BlocklyJavaScript);\n  }\n}(this, function(Blockly, BlocklyJavaScript) {\n/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview JavaScript Generator module; just a wrapper for\n *     javascript_compressed.js.\n */\n\nreturn BlocklyJavaScript;\n}));\n","/* eslint-disable */\n;(function(root, factory) {\n  if (typeof define === 'function' && define.amd) { // AMD\n    define(['./core-browser', './msg/en', './blocks', './javascript'], factory);\n  } else if (typeof exports === 'object') { // Node.js\n    module.exports = factory(require('./core-browser'), require('./msg/en'), require('./blocks'), require('./javascript'));\n  } else { // Browser\n    root.Blockly = factory(root.Blockly, root.En, root.BlocklyBlocks, root.BlocklyJS);\n  }\n}(this, function(Blockly, En, BlocklyBlocks, BlocklyJS) {\n/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview Blockly module for the browser. This includes Blockly core\n * and built in blocks, the JavaScript code generator and the English block\n * localization files.\n */\n\n/* eslint-disable */\n'use strict';\n\n// Include the EN Locale by default.\nBlockly.setLocale(En);\n\nreturn Blockly;\n}));\n","/* eslint-disable */\n;(function(root, factory) {\n  if (typeof define === 'function' && define.amd) { // AMD\n    define(['./browser'], factory);\n  } else if (typeof exports === 'object') { // Node.js\n    module.exports = factory(require('./node'));\n  } else { // Browser\n    root.Blockly = factory(root.Blockly);\n  }\n}(this, function(Blockly) {\n/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview Blockly module; this is a wrapper which selects\n *     either browser.js or node.js, depending on which environment we\n *     are running in.\n */\n\nreturn Blockly;\n}));\n","import Blockly from 'blockly';\n\nclass BlocklyController {\n\n    toolbox = {\n        \"kind\": \"flyoutToolbox\",\n        \"contents\": [\n            {\n            \"kind\": \"block\",\n            \"type\": \"controls_if\"\n            },\n            {\n            \"kind\": \"block\",\n            \"type\": \"controls_repeat_ext\"\n            },\n            {\n            \"kind\": \"block\",\n            \"type\": \"logic_compare\"\n            },\n            {\n            \"kind\": \"block\",\n            \"type\": \"math_number\"\n            },\n            {\n            \"kind\": \"block\",\n            \"type\": \"math_arithmetic\"\n            },\n            {\n            \"kind\": \"block\",\n            \"type\": \"text\"\n            },\n            {\n            \"kind\": \"block\",\n            \"type\": \"text_print\"\n            },\n        ]\n    }\n\n    constructor(){\n\n    }\n\n    injectBlockly(blocklyDiv){\n        Blockly.inject(blocklyDiv, {toolbox: this.toolbox})\n    }\n}\n\nexport default BlocklyController","'use strict';\nimport BlocklyController from \"./blockly_controller.js\"\n\n\nfunction main(){\n  let bController = new BlocklyController();\n  bController.injectBlockly(\"blockly\")\n}\n\nmain();"]}